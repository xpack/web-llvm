---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/codegenprepare-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `CodeGenPrepare.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/CodeGen/CodeGenPrepare.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/codegenprepare-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PointerIntPair.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BranchProbabilityInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolutionExpressions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/Analysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/analysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/BasicBlockSectionsProfileReader.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionsprofilereader-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/ISDOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/SelectionDAGNodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetLowering.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetPassConfig.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetSubtargetInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/ValueTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/valuetypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGenTypes/MachineValueType.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Config/llvm-config.h"
  permalink=""
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Argument.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GetElementPtrTypeIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/getelementptrtypeiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalValue.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InlineAsm.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/inlineasm-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicsAArch64.h"
  permalink=""
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ProfDataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Statepoint.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BlockFrequency.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Compiler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetOptions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BypassSlowDivision.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/bypassslowdivision-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SimplifyLibCalls.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifylibcalls-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SizeOpts.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="limits"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-">anonymous&#123;CodeGenPrepare.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare">CodeGenPrepare</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass">CodeGenPrepareLegacyPass</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a></>}>
This is an extended version of TargetLowering::AddrMode which holds actual Value&#42;&#39;s for register values. <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a></>}>
This class provides transaction based operation on the IR. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typepromotionaction">TypePromotionAction</a></>}>
This represents the common interface of the individual transaction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typepromotionaction/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/insertionhandler">InsertionHandler</a></>}>
Utility to remember the position of an instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/insertionhandler/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionmovebefore">InstructionMoveBefore</a></>}>
Move an instruction before another. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionmovebefore/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandsetter">OperandSetter</a></>}>
Set the operand of an instruction with a new value. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandsetter/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandshider">OperandsHider</a></>}>
Hide the operands of an instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandshider/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/truncbuilder">TruncBuilder</a></>}>
Build a truncate instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/truncbuilder/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/sextbuilder">SExtBuilder</a></>}>
Build a sign extension instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/sextbuilder/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/zextbuilder">ZExtBuilder</a></>}>
Build a zero extension instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/zextbuilder/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typemutator">TypeMutator</a></>}>
Mutate an instruction to another type. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typemutator/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer">UsesReplacer</a></>}>
Replace the uses of an instruction by another instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer/instructionandidx">InstructionAndIdx</a></>}>
Helper structure to keep track of the replaced uses. <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer/instructionandidx/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionremover">InstructionRemover</a></>}>
Remove an instruction from the IR. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionremover/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher">AddressingModeMatcher</a></>}>
A helper class for matching addressing modes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator">PhiNodeSetIterator</a></>}>
An iterator for <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a>. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a></>}>
Keeps a set of PHINodes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker">SimplificationTracker</a></>}>
Keep track of simplification of Phi nodes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner">AddressingModeCombiner</a></>}>
A helper class for combining addressing modes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper">TypePromotionHelper</a></>}>
Hepler class to perform type promotion. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper">VectorPromoteHelper</a></>}>
Helper class to promote a scalar operation to a vector one. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6536b980547806c6fb158add5334c3ab">adjustIsPower2Test</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL)</>}>
Some targets have better codegen for <code>ctpop(X) u&lt; 2</code> than <code>ctpop(X) == 1</code>. <a href="#a6536b980547806c6fb158add5334c3ab">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8f5b32a03cc4a6072855d8c8cf7c748f">computeBaseDerivedRelocateMap</a> (const SmallVectorImpl&lt; GCRelocateInst &#42; &gt; &amp;AllRelocateCalls, MapVector&lt; GCRelocateInst &#42;, SmallVector&lt; GCRelocateInst &#42;, 0 &gt; &gt; &amp;RelocateInstMap)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a> (DbgValueInst &#42;DVI, BasicBlock::iterator VI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ac8803aa267830622708ede7b732c7ae2">DbgInserterHelper</a> (DbgVariableRecord &#42;DVR, BasicBlock::iterator VI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adfad68845808cb6acd116e50b15bc281">despeculateCountZeros</a> (IntrinsicInst &#42;CountZeros, LoopInfo &amp;LI, const TargetLowering &#42;TLI, const DataLayout &#42;DL, ModifyDT &amp;ModifiedDT, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHugeFunc)</>}>
If counting leading or trailing zeros is an expensive operation and a zero input is defined, add a check for zero to avoid calling the intrinsic. <a href="#adfad68845808cb6acd116e50b15bc281">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a> (Instruction &#42;I, SmallVectorImpl&lt; std::pair&lt; Use &#42;, Type &#42; &gt; &gt; &amp;MemoryUses, SmallPtrSetImpl&lt; Instruction &#42; &gt; &amp;ConsideredInsts, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI, bool OptSize, ProfileSummaryInfo &#42;PSI, BlockFrequencyInfo &#42;BFI, unsigned &amp;SeenInsts)</>}>
Recursively walk all the uses of I until we find a memory use. <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0f0065098f13d0b2ef0e39f9d2e1ecdd">FindAllMemoryUses</a> (Instruction &#42;I, SmallVectorImpl&lt; std::pair&lt; Use &#42;, Type &#42; &gt; &gt; &amp;MemoryUses, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI, bool OptSize, ProfileSummaryInfo &#42;PSI, BlockFrequencyInfo &#42;BFI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1f580ab00002a65787ab52ef2aa9a439">foldFCmpToFPClassTest</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI)</>}>
For pattern like: <a href="#a98c59bcf49cb7343886e8f425d6d877b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af950841a4443ffb7aff66ae75fee8442">foldURemOfLoopIncrement</a> (Instruction &#42;Rem, const DataLayout &#42;DL, const LoopInfo &#42;LI, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHuge)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a> (GetElementPtrInst &#42;GEP)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a> (GetElementPtrInst &#42;GEP, SmallVectorImpl&lt; Value &#42; &gt; &amp;OffsetV)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; std::pair&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &gt;</>}
  name={<><a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a> (const PHINode &#42;PN, const LoopInfo &#42;LI)</>}>
If given <code>PN</code> is an inductive variable with value IVInc coming from the backedge, and on each iteration it gets increased by Step, return pair &lt;IVInc, Step&gt;. <a href="#a50cfddd4c98e75ef287c16996698dc1c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a> (SelectInst &#42;SI, bool isTrue, const SmallPtrSet&lt; const Instruction &#42;, 2 &gt; &amp;Selects)</>}>
If <code>isTrue</code> is true, return the true value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>, otherwise return false value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>. <a href="#a596c5a8a807f6ce192718084a11648de">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a> (Value &#42;Val, const TargetLowering &amp;TLI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if all the uses of <code>Val</code> are equivalent (or free) zero or sign extensions. <a href="#ae965d93aa46ad834c21718eba4b5b78e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aaca449a7620b1306ed7586ba6bdc4faa">INITIALIZE&#95;PASS&#95;BEGIN</a> (CodeGenPrepareLegacyPass, DEBUG&#95;TYPE, &quot;Optimize for code generation&quot;, false, false) INITIALIZE&#95;PASS&#95;END(CodeGenPrepareLegacyPass</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a> (Instruction &#42;User)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the candidates could be combined with a shift instruction, which includes: <a href="#a19e2fd6fce422c4ab3cea555782abbb6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a> (const TargetTransformInfo &#42;TTI, const TargetLowering &#42;TLI, SelectInst &#42;SI)</>}>
Returns true if a <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> should be turned into an explicit branch. <a href="#a4bde686b6506cc9e63919272711713f4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a> (const TargetLibraryInfo &#42;TLInfo, const CallInst &#42;CI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a> (const Value &#42;V, const LoopInfo &#42;LI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a> (Value &#42;V, BasicBlock &#42;BB)</>}>
Return true if the specified values are defined in a different basic block than BB. <a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a> (CallInst &#42;CI, InlineAsm &#42;IA, Value &#42;OpVal, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> to see if all uses of OpVal by the specified inline asm call are due to memory operands. <a href="#a86026627b644e50527898aad0747b3e5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a> (const TargetLowering &amp;TLI, const DataLayout &amp;DL, Value &#42;Val)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> whether or not <code>Val</code> is a legal instruction for <code>TLI</code>. <a href="#aca87c42e8556b7f2e73454d63efa87f2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aaf468add8b9e6811a1643026e25eadb4">isRemOfLoopIncrementWithLoopInvariant</a> (Instruction &#42;Rem, const LoopInfo &#42;LI, Value &#42;&amp;RemAmtOut, Value &#42;&amp;AddInstOut, Value &#42;&amp;AddOffsetOut, PHINode &#42;&amp;LoopIncrPNOut)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a> (const Instruction &#42;IVInc, Instruction &#42;&amp;LHS, Constant &#42;&amp;Step)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a> (CmpInst &#42;Cmp, BinaryOperator &#42;&amp;Add)</>}>
Match special-case patterns that check for unsigned add overflow. <a href="#af23979229be4fb2286896bf920e3e235">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a> (Instruction &#42;I)</>}>
This is a little filter, which returns true if an addressing computation involving I might be folded into a load/store accessing it. <a href="#a9d0372d5a469c089a4f2a299dd679558">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a> (BranchInst &#42;Branch, const TargetLowering &amp;TLI, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHugeFunc)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a> (BinaryOperator &#42;ShiftI, ConstantInt &#42;CI, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
Sink the shift <em>right</em> instruction into user blocks if the uses could potentially be combined with this shift instruction and generate BitExtract instruction. <a href="#a2c05548feac70b16d31caf0cfb225714">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a> (CastInst &#42;CI, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
If the specified cast instruction is a noop copy (e.g. <a href="#a3b82cff474790446f1288f1a086c1cd6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a> (Value &#42;Old, Value &#42;New, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHuge)</>}>
Replace all old uses with new ones, and push the updated BBs into FreshBBs. <a href="#a19e092ecf7889abf7277f13824e0c601">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a> (uint64&#95;t &amp;NewTrue, uint64&#95;t &amp;NewFalse)</>}>
Scale down both weights to fit into uint32&#95;t. <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a> (GCRelocateInst &#42;RelocatedBase, const SmallVectorImpl&lt; GCRelocateInst &#42; &gt; &amp;Targets)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a> (Instruction &#42;AndI, const TargetLowering &amp;TLI, SetOfInstrs &amp;InsertedInsts)</>}>
Duplicate and sink the given &#39;and&#39; instruction into user blocks where it is used in a compare to allow isel to generate better code for targets where this operation can be combined. <a href="#a0049977ff1075a98e9f512bbf4d181a6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a> (CastInst &#42;CI)</>}>
Sink the specified cast instruction into its user blocks. <a href="#a3cc8a3a2506bf528398d0aef0850f31a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI)</>}>
Sink the given <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> into user blocks to reduce the number of virtual registers that must be created and coalesced. <a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a> (const TargetTransformInfo &#42;TTI, Value &#42;V)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if V (an operand of a select instruction) is an expensive instruction that is only used once. <a href="#a10ece31d94cdd66e58cef49d73f2263f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a> (BinaryOperator &#42;ShiftI, Instruction &#42;User, ConstantInt &#42;CI, DenseMap&lt; BasicBlock &#42;, BinaryOperator &#42; &gt; &amp;InsertedShifts, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
Sink both shift and truncate instruction to the use of truncate&#39;s BB. <a href="#a0327169186859791aafa580e4fb547e2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a> (StoreInst &amp;SI, const DataLayout &amp;DL, const TargetLowering &amp;TLI)</>}>
For the instruction sequence of store below, F and I values are bundled together as an i64 value before being stored into memory. <a href="#a3c7e1486d1d466b3be981adcb21a6359">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6059e0984be477af12647e0574a01af0">STATISTIC</a> (NumBlocksElim, &quot;Number of blocks eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa30f41b73332156614f88439d24da8ac">STATISTIC</a> (NumPHIsElim, &quot;Number of trivial PHIs eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab4aba4ac8014186037d27ffc57196ac3">STATISTIC</a> (NumGEPsElim, &quot;Number of GEPs converted to casts&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac922eae769aaa3ee158e915f036129e4">STATISTIC</a> (NumCmpUses, &quot;Number of uses of Cmp expressions replaced with uses of &quot; &quot;sunken Cmps&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a09f1c42adaebc495651949c7d4e64c3c">STATISTIC</a> (NumCastUses, &quot;Number of uses of Cast expressions replaced with uses &quot; &quot;of sunken Casts&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6853dee9da71b8737b7c731c505988d8">STATISTIC</a> (NumMemoryInsts, &quot;Number of memory instructions whose address &quot; &quot;computations were sunk&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aff39dc0be076dc904665065cf5c6ede2">STATISTIC</a> (NumMemoryInstsPhiCreated, &quot;Number of phis created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3c487b469e600b10b65c400de3741735">STATISTIC</a> (NumMemoryInstsSelectCreated, &quot;Number of select created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a382d2cdafa179d7c4561bfe746d2a4ad">STATISTIC</a> (NumExtsMoved, &quot;Number of &#91;s|z&#93;ext instructions combined with loads&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a1c84a6266af376a7dc168db6dd0e1ce4">STATISTIC</a> (NumExtUses, &quot;Number of uses of &#91;s|z&#93;ext instructions optimized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#abc95b24e3dc47ccf0a7afcc846d82c34">STATISTIC</a> (NumAndsAdded, &quot;Number of and mask instructions added to form ext loads&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aaf676a4c39b6a1c7019dbbec6fc89500">STATISTIC</a> (NumAndUses, &quot;Number of uses of and mask instructions optimized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a05852bdf4c63ca1e5306e1422db248f3">STATISTIC</a> (NumRetsDup, &quot;Number of return instructions duplicated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad8d62a4d9ff57ddca8ab070f4e396c0c">STATISTIC</a> (NumDbgValueMoved, &quot;Number of debug value instructions moved&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aee5e95a01071c306a5fa9e6e3e07183c">STATISTIC</a> (NumSelectsExpanded, &quot;Number of selects turned into branches&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4644887cd2ba8fba1a1c6f97d234e7e2">STATISTIC</a> (NumStoreExtractExposed, &quot;Number of store(extractelement) exposed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3fb33a8a29e076405285e5282eba81fd">swapICmpOperandsToExposeCSEOpportunities</a> (CmpInst &#42;Cmp)</>}>
Many architectures use the same instruction for both subtract and cmp. <a href="#a3fb33a8a29e076405285e5282eba81fd">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a> (GetElementPtrInst &#42;GEPI, const TargetTransformInfo &#42;TTI)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a51f303fd2cc8c48e50ab97c59f3558cc">AddrSinkCombineBaseGV</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a3a00df51e1fa276c0c8860fe5ac1f95c">AddrSinkCombineBaseOffs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a44b23d217bd678cd7aef7d152d945537">AddrSinkCombineBaseReg</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a984c73ae4b3ecbd1c9a237c11e38ac62">AddrSinkCombineScaledReg</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#afedfbc99c6b04e20643eb77da796d522">AddrSinkNewPhis</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a732a4fb41e78c56627fb9748f00935ab">AddrSinkNewSelects</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aaabb67aa574169b8cf2db8baf993b9ea">BBSectionsGuidedSectionPrefix</a></>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a030569d5a541b6110f2ae1b6a3413a58">DEBUG&#95;TYPE</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa653d45524ba8feb6e97dd4f961b7c3e">DisableComplexAddrModes</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af6d9ea3fbe9aad1268fdabb3863c336c">DisableDeletePHIs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a337eb74e6c82771bb21ce598a8d3090c">DisableExtLdPromotion</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac23f3d86779d204fbf6db71ce8f41d7b">DisableGCOpts</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a346da4fb7a62e95531402c0b2a85c4fd">DisablePreheaderProtect</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af42b66ae716b910d032498490940ae08">DisableSelectToBranch</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1e6cf6a2bf01ee44a0f0843d8c3512cd">DisableStoreExtract</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#add2019bfb348f5241b4110eb77775410">EnableAndCmpSinking</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa139a070bbd3c66bb6fd2dbdee1dd893">EnableGEPOffsetSplit</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa667cc0d6f6fc39b8d40b9b9828b81bb">EnableICMP&#95;EQToICMP&#95;ST</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a6412f4a5842ffe108c2aa493fa0fe1b1">EnableTypePromotionMerge</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>Optimize <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> code</>}
  name={<><a href="#a82626751cd03ec5db2cc4939a10ad956">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a8ac7126af5085fb735db4c727a0ab4e9">ForceSplitStore</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; uint64&#95;t &gt;</>}
  name={<><a href="#acb1402a601e394cbb3a7b1a1c4e4634f">FreqRatioToSkipMerge</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>Optimize <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> code</>}
  name={<><a href="#a109eb00135035c7badb12cece015c58d">generation</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a6eff5790402995c83be65f9260826b41">HugeFuncThresholdInCGPP</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a1a31871450a2ceec97ef89dbdae54921">MaxAddressUsersToScan</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1d7858eecb954b54795df357b6935414">OptimizePhiTypes</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a6cdb6fbcff4780503fef226b46b6f10b">ProfileGuidedSectionPrefix</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a276112f96ea0d245fec9eaa1306712c0">ProfileUnknownInSpecialSection</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;codegenprepare&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### adjustIsPower2Test() {#a6536b980547806c6fb158add5334c3ab}

<MemberDefinition
  prototype={<>static bool adjustIsPower2Test (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Some targets have better codegen for <code>ctpop(X) u&lt; 2</code> than <code>ctpop(X) == 1</code>.

This function converts <code>ctpop(X) ==/!= 1</code> into <code>ctpop(X) u&lt;/u&gt; 2/1</code> if the result cannot be zero.

Definition at line <a href="#l02155">2155</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### computeBaseDerivedRelocateMap() {#a8f5b32a03cc4a6072855d8c8cf7c748f}

<MemberDefinition
  prototype={<>static void computeBaseDerivedRelocateMap (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42; &gt; &amp; AllRelocateCalls, <a href="/docs/api/classes/llvm/mapvector">MapVector</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;, 0 &gt; &gt; &amp; RelocateInstMap)</>}
  labels = {["static"]}>

Definition at line <a href="#l01201">1201</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DbgInserterHelper() {#a5a43b0bc7c25aaaa14cf3d79d7f13c78}

<MemberDefinition
  prototype={<>static void DbgInserterHelper (<a href="/docs/api/classes/llvm/dbgvalueinst">DbgValueInst</a> &#42; DVI, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI)</>}
  labels = {["static"]}>

Definition at line <a href="#l08904">8904</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DbgInserterHelper() {#ac8803aa267830622708ede7b732c7ae2}

<MemberDefinition
  prototype={<>static void DbgInserterHelper (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; DVR, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI)</>}
  labels = {["static"]}>

Definition at line <a href="#l08912">8912</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### despeculateCountZeros() {#adfad68845808cb6acd116e50b15bc281}

<MemberDefinition
  prototype={<>static bool despeculateCountZeros (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42; CountZeros, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp; LI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42; DL, ModifyDT &amp; ModifiedDT, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHugeFunc)</>}
  labels = {["static"]}>
If counting leading or trailing zeros is an expensive operation and a zero input is defined, add a check for zero to avoid calling the intrinsic.

We want to transform: z = call i64 @llvm.cttz.i64(i64 A, i1 false)

into: entry: cmpz = icmp eq i64 A, 0 br i1 cmpz, label cond.end, label cond.false cond.false: z = call i64 @llvm.cttz.i64(i64 A, i1 true) br label cond.end cond.end: ctz = phi i64 &#91; 64, entry &#93;, &#91; z, cond.false &#93;

If the transform is performed, return true and set ModifiedDT to true.

Definition at line <a href="#l02494">2494</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### FindAllMemoryUses() {#a498962c0029b14cf3cc8fb08c5e20ab2}

<MemberDefinition
  prototype={<>static bool FindAllMemoryUses (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/use">Use</a> &#42;, <a href="/docs/api/classes/llvm/type">Type</a> &#42; &gt; &gt; &amp; MemoryUses, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; ConsideredInsts, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp; TRI, bool OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI, unsigned &amp; SeenInsts)</>}
  labels = {["static"]}>
Recursively walk all the uses of I until we find a memory use.

If we find an obviously non-foldable instruction, return true. Add accessed addresses and types to MemoryUses.

Definition at line <a href="#l05506">5506</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### FindAllMemoryUses() {#a0f0065098f13d0b2ef0e39f9d2e1ecdd}

<MemberDefinition
  prototype={<>static bool FindAllMemoryUses (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/use">Use</a> &#42;, <a href="/docs/api/classes/llvm/type">Type</a> &#42; &gt; &gt; &amp; MemoryUses, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp; TRI, bool OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI)</>}
  labels = {["static"]}>

Definition at line <a href="#l05579">5579</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### foldFCmpToFPClassTest() {#a1f580ab00002a65787ab52ef2aa9a439}

<MemberDefinition
  prototype={<>static bool foldFCmpToFPClassTest (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>

Definition at line <a href="#l01950">1950</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### foldICmpWithDominatingICmp() {#a98c59bcf49cb7343886e8f425d6d877b}

<MemberDefinition
  prototype={<>static bool foldICmpWithDominatingICmp (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
For pattern like:

DomCond = icmp sgt/slt CmpOp0, CmpOp1 (might not be in DomBB) ... DomBB: ... br DomCond, TrueBB, CmpBB CmpBB: (with DomBB being the single predecessor) ... Cmp = icmp eq CmpOp0, CmpOp1 ...

It would use two comparison on targets that lowering of icmp sgt/slt is different from lowering of icmp eq (PowerPC). This function try to convert &#39;Cmp = icmp eq CmpOp0, CmpOp1&#39; to &#39; Cmp = icmp slt/sgt CmpOp0, CmpOp1&#39;. After that, DomCond and Cmp can use the same comparison so reduce one comparison.

Return true if any changes are made.

Definition at line <a href="#l01851">1851</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### foldURemOfLoopIncrement() {#af950841a4443ffb7aff66ae75fee8442}

<MemberDefinition
  prototype={<>static bool foldURemOfLoopIncrement (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Rem, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHuge)</>}
  labels = {["static"]}>

Definition at line <a href="#l02068">2068</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### GEPSequentialConstIndexed() {#ac3e586008202db1f802e906a489d7574}

<MemberDefinition
  prototype={<>static bool GEPSequentialConstIndexed (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42; GEP)</>}
  labels = {["static"]}>

Definition at line <a href="#l08364">8364</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### getGEPSmallConstantIntOffsetV() {#a0e431b29d5cd842ab00f85ec2cdab8b2}

<MemberDefinition
  prototype={<>static bool getGEPSmallConstantIntOffsetV (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42; GEP, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OffsetV)</>}
  labels = {["static"]}>

Definition at line <a href="#l01236">1236</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### getIVIncrement() {#a50cfddd4c98e75ef287c16996698dc1c}

<MemberDefinition
  prototype={<>static std::optional&lt; std::pair&lt; Instruction &#42;, Constant &#42; &gt; &gt; getIVIncrement (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI)</>}
  labels = {["static"]}>
If given <code>PN</code> is an inductive variable with value IVInc coming from the backedge, and on each iteration it gets increased by Step, return pair &lt;IVInc, Step&gt;.

Otherwise, return std::nullopt.

Definition at line <a href="#l01527">1527</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### getTrueOrFalseValue() {#a596c5a8a807f6ce192718084a11648de}

<MemberDefinition
  prototype={<>static Value &#42; getTrueOrFalseValue (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42; SI, bool isTrue, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, 2 &gt; &amp; Selects)</>}
  labels = {["static"]}>
If <code>isTrue</code> is true, return the true value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>, otherwise return false value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>.

If the true/false value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code> is defined by any select instructions in <code>Selects</code>, look through the defining select instruction until the true/false value is not defined in <code>Selects</code>.

Definition at line <a href="#l07330">7330</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### hasSameExtUse() {#ae965d93aa46ad834c21718eba4b5b78e}

<MemberDefinition
  prototype={<>static bool hasSameExtUse (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if all the uses of <code>Val</code> are equivalent (or free) zero or sign extensions.

Definition at line <a href="#l06327">6327</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#aaca449a7620b1306ed7586ba6bdc4faa}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (CodeGenPrepareLegacyPass, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Optimize <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> code generation&quot;, false, false)</>}>

Definition at line <a href="#l00530">530</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isExtractBitsCandidateUse() {#a19e2fd6fce422c4ab3cea555782abbb6}

<MemberDefinition
  prototype={<>static bool isExtractBitsCandidateUse (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; User)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the candidates could be combined with a shift instruction, which includes:

<ul>
<li>Truncate instruction</li>
<li>And instruction and the imm is a mask of the low bits: imm &amp; (imm+1) == 0</li>
</ul>

Definition at line <a href="#l02283">2283</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isFormingBranchFromSelectProfitable() {#a4bde686b6506cc9e63919272711713f4}

<MemberDefinition
  prototype={<>static bool isFormingBranchFromSelectProfitable (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42; TLI, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42; SI)</>}
  labels = {["static"]}>
Returns true if a <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> should be turned into an explicit branch.

Definition at line <a href="#l07285">7285</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isIntrinsicOrLFToBeTailCalled() {#a87548c69480b23599d643d518412895c}

<MemberDefinition
  prototype={<>static bool isIntrinsicOrLFToBeTailCalled (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02810">2810</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isIVIncrement() {#ab0f1e7b38e65d10c01900bd4d458a03b}

<MemberDefinition
  prototype={<>static bool isIVIncrement (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI)</>}
  labels = {["static"]}>

Definition at line <a href="#l01542">1542</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### IsNonLocalValue() {#ad897d4beb50aa8f0d4d2eaa08ac0987d}

<MemberDefinition
  prototype={<>static bool IsNonLocalValue (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
Return true if the specified values are defined in a different basic block than BB.

Definition at line <a href="#l05725">5725</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### IsOperandAMemoryOperand() {#a86026627b644e50527898aad0747b3e5}

<MemberDefinition
  prototype={<>static bool IsOperandAMemoryOperand (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI, <a href="/docs/api/classes/llvm/inlineasm">InlineAsm</a> &#42; IA, <a href="/docs/api/classes/llvm/value">Value</a> &#42; OpVal, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp; TRI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> to see if all uses of OpVal by the specified inline asm call are due to memory operands.

If so, return true, otherwise return false.

Definition at line <a href="#l05481">5481</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isPromotedInstructionLegal() {#aca87c42e8556b7f2e73454d63efa87f2}

<MemberDefinition
  prototype={<>static bool isPromotedInstructionLegal (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> whether or not <code>Val</code> is a legal instruction for <code>TLI</code>.

:::info
<code>Val</code> is assumed to be the product of some type promotion. Therefore if <code>Val</code> has an undefined state in <code>TLI</code>, this is assumed to be legal, as the non-promoted value would have had the same state.
:::

Definition at line <a href="#l04652">4652</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isRemOfLoopIncrementWithLoopInvariant() {#aaf468add8b9e6811a1643026e25eadb4}

<MemberDefinition
  prototype={<>static bool isRemOfLoopIncrementWithLoopInvariant (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Rem, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; RemAmtOut, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; AddInstOut, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; AddOffsetOut, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp; LoopIncrPNOut)</>}
  labels = {["static"]}>

Definition at line <a href="#l01983">1983</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### matchIncrement() {#a9f54e95337782bd4fb335dd547c05ecc}

<MemberDefinition
  prototype={<>static bool matchIncrement (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; IVInc, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; LHS, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp; Step)</>}
  labels = {["static"]}>

Definition at line <a href="#l01508">1508</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### matchUAddWithOverflowConstantEdgeCases() {#af23979229be4fb2286896bf920e3e235}

<MemberDefinition
  prototype={<>static bool matchUAddWithOverflowConstantEdgeCases (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp; Add)</>}
  labels = {["static"]}>
Match special-case patterns that check for unsigned add overflow.

Definition at line <a href="#l01638">1638</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### MightBeFoldableInst() {#a9d0372d5a469c089a4f2a299dd679558}

<MemberDefinition
  prototype={<>static bool MightBeFoldableInst (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>
This is a little filter, which returns true if an addressing computation involving I might be folded into a load/store accessing it.

This doesn&#39;t need to be perfect, but needs to accept at least the set of instructions that MatchOperationAddr can.

Definition at line <a href="#l04621">4621</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### optimizeBranch() {#ad2bfc3e2f7b1661868517e662ac7496c}

<MemberDefinition
  prototype={<>static bool optimizeBranch (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; Branch, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHugeFunc)</>}
  labels = {["static"]}>

Definition at line <a href="#l08532">8532</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### OptimizeExtractBits() {#a2c05548feac70b16d31caf0cfb225714}

<MemberDefinition
  prototype={<>static bool OptimizeExtractBits (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; ShiftI, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Sink the shift <em>right</em> instruction into user blocks if the uses could potentially be combined with this shift instruction and generate BitExtract instruction.

It will only be applied if the architecture supports BitExtract instruction. Here is an example: BB1: x.extract.shift = lshr i64 arg1, 32 BB2: x.extract.trunc = trunc i64 x.extract.shift to i16 ==&gt;

BB2: x.extract.shift.1 = lshr i64 arg1, 32 x.extract.trunc = trunc i64 x.extract.shift.1 to i16

CodeGen will recognize the pattern in BB2 and generate BitExtract instruction. Return true if any changes are made.

Definition at line <a href="#l02392">2392</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### OptimizeNoopCopyExpression() {#a3b82cff474790446f1288f1a086c1cd6}

<MemberDefinition
  prototype={<>static bool OptimizeNoopCopyExpression (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
If the specified cast instruction is a noop copy (e.g.

it&#39;s casting from one pointer type to another, i32-&gt;i8 on <a href="/docs/api/namespaces/llvm/ppc">PPC</a>), sink it into user blocks to reduce the number of virtual registers that must be created and coalesced.

Return true if any changes are made.

Definition at line <a href="#l01465">1465</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### replaceAllUsesWith() {#a19e092ecf7889abf7277f13824e0c601}

<MemberDefinition
  prototype={<>static void replaceAllUsesWith (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Old, <a href="/docs/api/classes/llvm/value">Value</a> &#42; New, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHuge)</>}
  labels = {["static"]}>
Replace all old uses with new ones, and push the updated BBs into FreshBBs.

Definition at line <a href="#l01112">1112</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### scaleWeights() {#a25c5d0cb41bbb1777e779a8da35e7bd4}

<MemberDefinition
  prototype={<>static void scaleWeights (uint64&#95;t &amp; NewTrue, uint64&#95;t &amp; NewFalse)</>}
  labels = {["static"]}>
Scale down both weights to fit into uint32&#95;t.

Definition at line <a href="#l09020">9020</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### simplifyRelocatesOffABase() {#a9364799319bac519aa565ec882986e6d}

<MemberDefinition
  prototype={<>static bool simplifyRelocatesOffABase (<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42; RelocatedBase, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42; &gt; &amp; Targets)</>}
  labels = {["static"]}>

Definition at line <a href="#l01253">1253</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### sinkAndCmp0Expression() {#a0049977ff1075a98e9f512bbf4d181a6}

<MemberDefinition
  prototype={<>static bool sinkAndCmp0Expression (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; AndI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, SetOfInstrs &amp; InsertedInsts)</>}
  labels = {["static"]}>
Duplicate and sink the given &#39;and&#39; instruction into user blocks where it is used in a compare to allow isel to generate better code for targets where this operation can be combined.

Return true if any changes are made.

Definition at line <a href="#l02207">2207</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### SinkCast() {#a3cc8a3a2506bf528398d0aef0850f31a}

<MemberDefinition
  prototype={<>static bool SinkCast (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42; CI)</>}
  labels = {["static"]}>
Sink the specified cast instruction into its user blocks.

Definition at line <a href="#l01397">1397</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### sinkCmpExpression() {#a24a3e4aad4cb2fdde7ce294a531cd52a}

<MemberDefinition
  prototype={<>static bool sinkCmpExpression (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
Sink the given <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> into user blocks to reduce the number of virtual registers that must be created and coalesced.

This is a clear win except on targets with multiple condition code registers (PowerPC), where it might lose; some adjustment may be wanted there.

Return true if any changes are made.

Definition at line <a href="#l01772">1772</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### sinkSelectOperand() {#a10ece31d94cdd66e58cef49d73f2263f}

<MemberDefinition
  prototype={<>static bool sinkSelectOperand (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if V (an operand of a select instruction) is an expensive instruction that is only used once.

Definition at line <a href="#l07276">7276</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### SinkShiftAndTruncate() {#a0327169186859791aafa580e4fb547e2}

<MemberDefinition
  prototype={<>static bool SinkShiftAndTruncate (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; ShiftI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; User, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; CI, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; &gt; &amp; InsertedShifts, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Sink both shift and truncate instruction to the use of truncate&#39;s BB.

Definition at line <a href="#l02299">2299</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### splitMergedValStore() {#a3c7e1486d1d466b3be981adcb21a6359}

<MemberDefinition
  prototype={<>static bool splitMergedValStore (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &amp; SI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
For the instruction sequence of store below, F and I values are bundled together as an i64 value before being stored into memory.

Sometimes it is more efficient to generate separate stores for F and I, which can remove the bitwise instructions or sink them to colder places.

(store (or (zext (bitcast F to i32) to i64), (shl (zext I to i64), 32)), addr) --&gt; (store F, addr) and (store I, addr+4)

Similarly, splitting for other merged store can also be beneficial, like: For pair of &#123;i32, i32&#125;, i64 store --&gt; two i32 stores. For pair of &#123;i32, i16&#125;, i64 store --&gt; two i32 stores. For pair of &#123;i16, i16&#125;, i32 store --&gt; two i16 stores. For pair of &#123;i16, i8&#125;, i32 store --&gt; two i16 stores. For pair of &#123;i8, i8&#125;, i16 store --&gt; two i8 stores.

We allow each target to determine specifically which kind of splitting is supported.

The store patterns are commonly seen from the simple code snippet below if only std::make&#95;pair(...) is sroa transformed before inlined into hoo. void goo(const std::pair&lt;int, float&gt; &amp;); hoo() &#123; ... goo(std::make&#95;pair(tmp, ftmp)); ... &#125;

Although we already have similar splitting in DAG Combine, we duplicate it in <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare">CodeGenPrepare</a> to catch the case in which pattern is across multiple BBs. The logic in DAG Combine is kept to catch case generated during code expansion.

Definition at line <a href="#l08266">8266</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a6059e0984be477af12647e0574a01af0}

<MemberDefinition
  prototype={<>STATISTIC (NumBlocksElim, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a> eliminated&quot;)</>}>

Definition at line <a href="#l00111">111</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aa30f41b73332156614f88439d24da8ac}

<MemberDefinition
  prototype={<>STATISTIC (NumPHIsElim, &quot;Number of trivial PHIs eliminated&quot;)</>}>

Definition at line <a href="#l00112">112</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab4aba4ac8014186037d27ffc57196ac3}

<MemberDefinition
  prototype={<>STATISTIC (NumGEPsElim, &quot;Number of GEPs converted to casts&quot;)</>}>

Definition at line <a href="#l00113">113</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac922eae769aaa3ee158e915f036129e4}

<MemberDefinition
  prototype={<>STATISTIC (NumCmpUses, &quot;Number of uses of Cmp expressions replaced with uses of &quot; &quot;sunken Cmps&quot;)</>}>

Definition at line <a href="#l00114">114</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a09f1c42adaebc495651949c7d4e64c3c}

<MemberDefinition
  prototype={<>STATISTIC (NumCastUses, &quot;Number of uses of Cast expressions replaced with uses &quot; &quot;of sunken Casts&quot;)</>}>

Definition at line <a href="#l00116">116</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a6853dee9da71b8737b7c731c505988d8}

<MemberDefinition
  prototype={<>STATISTIC (NumMemoryInsts, &quot;Number of memory <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> whose address &quot; &quot;computations were sunk&quot;)</>}>

Definition at line <a href="#l00118">118</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aff39dc0be076dc904665065cf5c6ede2}

<MemberDefinition
  prototype={<>STATISTIC (NumMemoryInstsPhiCreated, &quot;Number of phis created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>

Definition at line <a href="#l00120">120</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3c487b469e600b10b65c400de3741735}

<MemberDefinition
  prototype={<>STATISTIC (NumMemoryInstsSelectCreated, &quot;Number of select created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>

Definition at line <a href="#l00123">123</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a382d2cdafa179d7c4561bfe746d2a4ad}

<MemberDefinition
  prototype={<>STATISTIC (NumExtsMoved, &quot;Number of ext <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> combined with loads&quot;)</>}>

Definition at line <a href="#l00126">126</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a1c84a6266af376a7dc168db6dd0e1ce4}

<MemberDefinition
  prototype={<>STATISTIC (NumExtUses, &quot;Number of uses of ext <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> optimized&quot;)</>}>

Definition at line <a href="#l00127">127</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#abc95b24e3dc47ccf0a7afcc846d82c34}

<MemberDefinition
  prototype={<>STATISTIC (NumAndsAdded, &quot;Number of and mask <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> added to form ext loads&quot;)</>}>

Definition at line <a href="#l00128">128</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aaf676a4c39b6a1c7019dbbec6fc89500}

<MemberDefinition
  prototype={<>STATISTIC (NumAndUses, &quot;Number of uses of and mask <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> optimized&quot;)</>}>

Definition at line <a href="#l00130">130</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a05852bdf4c63ca1e5306e1422db248f3}

<MemberDefinition
  prototype={<>STATISTIC (NumRetsDup, &quot;Number of return <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> duplicated&quot;)</>}>

Definition at line <a href="#l00131">131</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad8d62a4d9ff57ddca8ab070f4e396c0c}

<MemberDefinition
  prototype={<>STATISTIC (NumDbgValueMoved, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/x86/lib/target/x86/disassembler/x86disassembler-cpp/#ae0228f36529f75f692753ef96d725012">debug</a> value <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> moved&quot;)</>}>

Definition at line <a href="#l00132">132</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aee5e95a01071c306a5fa9e6e3e07183c}

<MemberDefinition
  prototype={<>STATISTIC (NumSelectsExpanded, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/selectoptimize-cpp/#a3d495d9a0daf7fe32f1b1fb0aa153929">selects</a> turned into branches&quot;)</>}>

Definition at line <a href="#l00133">133</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4644887cd2ba8fba1a1c6f97d234e7e2}

<MemberDefinition
  prototype={<>STATISTIC (NumStoreExtractExposed, &quot;Number of store(extractelement) exposed&quot;)</>}>

Definition at line <a href="#l00134">134</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### swapICmpOperandsToExposeCSEOpportunities() {#a3fb33a8a29e076405285e5282eba81fd}

<MemberDefinition
  prototype={<>static bool swapICmpOperandsToExposeCSEOpportunities (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp)</>}
  labels = {["static"]}>
Many architectures use the same instruction for both subtract and cmp.

Try to swap cmp operands to match subtract operations to allow for CSE.

Definition at line <a href="#l01921">1921</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### tryUnmergingGEPsAcrossIndirectBr() {#a8528dea79f0940669c4fcb751940ca94}

<MemberDefinition
  prototype={<>static bool tryUnmergingGEPsAcrossIndirectBr (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42; GEPI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l08427">8427</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### AddrSinkCombineBaseGV {#a51f303fd2cc8c48e50ab97c59f3558cc}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineBaseGV(&quot;addr-sink-combine-base-gv&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseGV field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00234">234</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkCombineBaseOffs {#a3a00df51e1fa276c0c8860fe5ac1f95c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineBaseOffs(&quot;addr-sink-combine-base-offs&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseOffs field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00238">238</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkCombineBaseReg {#a44b23d217bd678cd7aef7d152d945537}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineBaseReg(&quot;addr-sink-combine-base-reg&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseReg field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00230">230</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkCombineScaledReg {#a984c73ae4b3ecbd1c9a237c11e38ac62}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineScaledReg(&quot;addr-sink-combine-scaled-reg&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of ScaledReg field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00242">242</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkNewPhis {#afedfbc99c6b04e20643eb77da796d522}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkNewPhis(&quot;addr-sink-new-phis&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Allow creation of Phis in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00223">223</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkNewSelects {#a732a4fb41e78c56627fb9748f00935ab}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkNewSelects(&quot;addr-sink-new-select&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow creation of selects in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00226">226</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkUsingGEPs {#a5410093a9a86bd6e68eb3ffb32cbce13}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkUsingGEPs(&quot;addr-sink-using-gep&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Address sinking in CGP using GEPs.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00150">150</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### BBSectionsGuidedSectionPrefix {#aaabb67aa574169b8cf2db8baf993b9ea}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; BBSectionsGuidedSectionPrefix(&quot;bbsections-guided-section-prefix&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Use the basic-block-sections profile to determine the text &quot; &quot;section prefix for hot functions. Functions with &quot; &quot;basic-block-sections profile will be placed in &#96;.text.hot&#96; &quot; &quot;regardless of their FDO profile info. Other functions won&#39;t be &quot; &quot;impacted, i.e., their prefixes will be decided by FDO/sampleFDO &quot; &quot;profiles.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00193">193</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DEBUG&#95;TYPE {#a030569d5a541b6110f2ae1b6a3413a58}

<MemberDefinition
  prototype={<>DEBUG&#95;TYPE</>}>

Definition at line <a href="#l00538">538</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableBranchOpts {#a62cd718328addb93b7bfbfd788fa9c33}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableBranchOpts(&quot;disable-cgp-branch-opts&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable branch optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00136">136</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableComplexAddrModes {#aa653d45524ba8feb6e97dd4f961b7c3e}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableComplexAddrModes(&quot;disable-complex-addr-modes&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disables combining addressing modes with different parts &quot; &quot;in optimizeMemoryInst.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00217">217</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableDeletePHIs {#af6d9ea3fbe9aad1268fdabb3863c336c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableDeletePHIs(&quot;disable-cgp-delete-phis&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable elimination of dead PHI nodes.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00274">274</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableExtLdPromotion {#a337eb74e6c82771bb21ce598a8d3090c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableExtLdPromotion(&quot;disable-cgp-ext-ld-promotion&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable ext(promotable(ld)) -&gt; promoted(ext(ld)) optimization in &quot; &quot;CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00165">165</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableGCOpts {#ac23f3d86779d204fbf6db71ce8f41d7b}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableGCOpts(&quot;disable-cgp-gc-opts&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable GC optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00141">141</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisablePreheaderProtect {#a346da4fb7a62e95531402c0b2a85c4fd}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisablePreheaderProtect(&quot;disable-preheader-prot&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable protection against removing loop preheaders&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00175">175</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableSelectToBranch {#af42b66ae716b910d032498490940ae08}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableSelectToBranch(&quot;disable-cgp-select2branch&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable select to branch conversion.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00145">145</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableStoreExtract {#a1e6cf6a2bf01ee44a0f0843d8c3512cd}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableStoreExtract(&quot;disable-cgp-store-extract&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable store(extract) optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00157">157</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableAndCmpSinking {#add2019bfb348f5241b4110eb77775410}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableAndCmpSinking(&quot;enable-andcmp-sinking&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable sinking and/cmp into branches.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00154">154</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableGEPOffsetSplit {#aa139a070bbd3c66bb6fd2dbdee1dd893}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableGEPOffsetSplit(&quot;cgp-split-large-offset-gep&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable splitting large offset of GEP.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00247">247</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableICMP&#95;EQToICMP&#95;ST {#aa667cc0d6f6fc39b8d40b9b9828b81bb}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableICMP&#95;EQToICMP&#95;ST(&quot;cgp-icmp-eq2icmp-st&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable ICMP&#95;EQ to ICMP&#95;S(L|G)T conversion.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00251">251</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableTypePromotionMerge {#a6412f4a5842ffe108c2aa493fa0fe1b1}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableTypePromotionMerge(&quot;cgp-type-promotion-merge&quot;, cl::Hidden, cl::desc(&quot;Enable merging of redundant sexts when one is dominating&quot; &quot; the other.&quot;), cl::init(true))</>}
  labels = {["static"]}>

Definition at line <a href="#l00211">211</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### false {#a82626751cd03ec5db2cc4939a10ad956}

<MemberDefinition
  prototype="Optimize for code false">

Definition at line <a href="#l00539">539</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### ForceSplitStore {#a8ac7126af5085fb735db4c727a0ab4e9}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceSplitStore(&quot;force-split-store&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Force store splitting no matter what the target query says.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00207">207</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### FreqRatioToSkipMerge {#acb1402a601e394cbb3a7b1a1c4e4634f}

<MemberDefinition
  prototype={<>cl::opt&lt; uint64&#95;t &gt; FreqRatioToSkipMerge(&quot;cgp-freq-ratio-to-skip-merge&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Skip merging empty blocks if (frequency of empty block) / &quot; &quot;(frequency of destination block) is greater than this ratio&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00202">202</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### generation {#a109eb00135035c7badb12cece015c58d}

<MemberDefinition
  prototype="Optimize for code generation">

Definition at line <a href="#l00539">539</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### HugeFuncThresholdInCGPP {#a6eff5790402995c83be65f9260826b41}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; HugeFuncThresholdInCGPP(&quot;cgpp-huge-func&quot;, cl::init(10000), cl::Hidden, cl::desc(&quot;Least BB number of huge function.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00265">265</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### MaxAddressUsersToScan {#a1a31871450a2ceec97ef89dbdae54921}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxAddressUsersToScan(&quot;cgp-max-address-users-to-scan&quot;, cl::init(100), cl::Hidden, cl::desc(&quot;Max number of address users to look at&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00269">269</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### OptimizePhiTypes {#a1d7858eecb954b54795df357b6935414}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; OptimizePhiTypes(&quot;cgp-optimize-phi-types&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable converting phi types in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00261">261</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### ProfileGuidedSectionPrefix {#a6cdb6fbcff4780503fef226b46b6f10b}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ProfileGuidedSectionPrefix(&quot;profile-guided-section-prefix&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Use profile info to add section prefix for hot/cold functions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00179">179</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### ProfileUnknownInSpecialSection {#a276112f96ea0d245fec9eaa1306712c0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ProfileUnknownInSpecialSection(&quot;profile-unknown-in-special-section&quot;, cl::Hidden, cl::desc(&quot;In profiling mode like sampleFDO, if a function doesn&#39;t have &quot; &quot;profile, we cannot tell the function is cold for sure because &quot; &quot;it may be a function newly added without ever being sampled. &quot; &quot;With the flag enabled, compiler can put such profile unknown &quot; &quot;functions into a special section, so runtime system can choose &quot; &quot;to handle it in a different way than .text section, to save &quot; &quot;RAM for example. &quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00183">183</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### StressExtLdPromotion {#aeabb375be2dc51a3d518b9d2a1140fe6}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; StressExtLdPromotion(&quot;stress-cgp-ext-ld-promotion&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Stress test ext(promotable(ld)) -&gt; promoted(ext(ld)) &quot; &quot;optimization in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00170">170</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### StressStoreExtract {#a4a686688e72eafe6375f8ae1ed184123}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; StressStoreExtract(&quot;stress-cgp-store-extract&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Stress test store(extract) optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00161">161</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### VerifyBFIUpdates {#aa67824c7146db82e49933e0a1ac1d3b9}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; VerifyBFIUpdates(&quot;cgp-verify-bfi-updates&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable BFI update verification for &quot; &quot;CodeGenPrepare.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00256">256</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;codegenprepare&quot;</>}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- CodeGenPrepare.cpp - Prepare a function for code generation --------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This pass munges the code in the input function to better prepare it for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SelectionDAG-based code generation. This works around limitations in it&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">// basic-block-at-a-time approach. It should eventually be removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/codegenprepare-h">llvm/CodeGen/CodeGenPrepare.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h">llvm/ADT/PointerIntPair.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h">llvm/Analysis/BranchProbabilityInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/analysis-h">llvm/CodeGen/Analysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionsprofilereader-h">llvm/CodeGen/BasicBlockSectionsProfileReader.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h">llvm/CodeGen/ISDOpcodes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h">llvm/CodeGen/SelectionDAGNodes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h">llvm/CodeGen/TargetLowering.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h">llvm/CodeGen/TargetPassConfig.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/valuetypes-h">llvm/CodeGen/ValueTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h">llvm/CodeGenTypes/MachineValueType.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;llvm/Config/llvm-config.h&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h">llvm/IR/Argument.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/getelementptrtypeiterator-h">llvm/IR/GetElementPtrTypeIterator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h">llvm/IR/GlobalValue.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/inlineasm-h">llvm/IR/InlineAsm.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;llvm/IR/IntrinsicsAArch64.h&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h">llvm/IR/ProfDataUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h">llvm/IR/Statepoint.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuemap-h">llvm/IR/ValueMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h">llvm/Support/BlockFrequency.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h">llvm/Support/Compiler.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h">llvm/Target/TargetOptions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/bypassslowdivision-h">llvm/Transforms/Utils/BypassSlowDivision.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifylibcalls-h">llvm/Transforms/Utils/SimplifyLibCalls.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h">llvm/Transforms/Utils/SizeOpts.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;algorithm&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;iterator&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;limits&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;memory&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;optional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;vector&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;codegenprepare&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111" lineLink="#a6059e0984be477af12647e0574a01af0"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumBlocksElim, </Highlight><Highlight kind="stringliteral">&quot;Number of blocks eliminated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112" lineLink="#aa30f41b73332156614f88439d24da8ac"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPHIsElim, </Highlight><Highlight kind="stringliteral">&quot;Number of trivial PHIs eliminated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="#ab4aba4ac8014186037d27ffc57196ac3"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumGEPsElim, </Highlight><Highlight kind="stringliteral">&quot;Number of GEPs converted to casts&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="#ac922eae769aaa3ee158e915f036129e4"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCmpUses, </Highlight><Highlight kind="stringliteral">&quot;Number of uses of Cmp expressions replaced with uses of &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">                      </Highlight><Highlight kind="stringliteral">&quot;sunken Cmps&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116" lineLink="#a09f1c42adaebc495651949c7d4e64c3c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCastUses, </Highlight><Highlight kind="stringliteral">&quot;Number of uses of Cast expressions replaced with uses &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal">                       </Highlight><Highlight kind="stringliteral">&quot;of sunken Casts&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118" lineLink="#a6853dee9da71b8737b7c731c505988d8"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemoryInsts, </Highlight><Highlight kind="stringliteral">&quot;Number of memory instructions whose address &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">                          </Highlight><Highlight kind="stringliteral">&quot;computations were sunk&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120" lineLink="#aff39dc0be076dc904665065cf5c6ede2"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemoryInstsPhiCreated,</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of phis created when address &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;computations were sunk to memory instructions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="#a3c487b469e600b10b65c400de3741735"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemoryInstsSelectCreated,</Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of select created when address &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;computations were sunk to memory instructions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126" lineLink="#a382d2cdafa179d7c4561bfe746d2a4ad"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumExtsMoved, </Highlight><Highlight kind="stringliteral">&quot;Number of &#91;s|z&#93;ext instructions combined with loads&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127" lineLink="#a1c84a6266af376a7dc168db6dd0e1ce4"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumExtUses, </Highlight><Highlight kind="stringliteral">&quot;Number of uses of &#91;s|z&#93;ext instructions optimized&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="#abc95b24e3dc47ccf0a7afcc846d82c34"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAndsAdded,</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of and mask instructions added to form ext loads&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130" lineLink="#aaf676a4c39b6a1c7019dbbec6fc89500"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAndUses, </Highlight><Highlight kind="stringliteral">&quot;Number of uses of and mask instructions optimized&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131" lineLink="#a05852bdf4c63ca1e5306e1422db248f3"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumRetsDup, </Highlight><Highlight kind="stringliteral">&quot;Number of return instructions duplicated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132" lineLink="#ad8d62a4d9ff57ddca8ab070f4e396c0c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDbgValueMoved, </Highlight><Highlight kind="stringliteral">&quot;Number of debug value instructions moved&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133" lineLink="#aee5e95a01071c306a5fa9e6e3e07183c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSelectsExpanded, </Highlight><Highlight kind="stringliteral">&quot;Number of selects turned into branches&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="#a4644887cd2ba8fba1a1c6f97d234e7e2"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumStoreExtractExposed, </Highlight><Highlight kind="stringliteral">&quot;Number of store(extractelement) exposed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136" lineLink="#a62cd718328addb93b7bfbfd788fa9c33"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a>(</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;disable-cgp-branch-opts&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disable branch optimizations in CodeGenPrepare&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141" lineLink="#ac23f3d86779d204fbf6db71ce8f41d7b"><Highlight kind="normal">    <a href="#ac23f3d86779d204fbf6db71ce8f41d7b">DisableGCOpts</a>(</Highlight><Highlight kind="stringliteral">&quot;disable-cgp-gc-opts&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">                  <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disable GC optimizations in CodeGenPrepare&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145" lineLink="#af42b66ae716b910d032498490940ae08"><Highlight kind="normal">    <a href="#af42b66ae716b910d032498490940ae08">DisableSelectToBranch</a>(</Highlight><Highlight kind="stringliteral">&quot;disable-cgp-select2branch&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">                          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disable select to branch conversion.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150" lineLink="#a5410093a9a86bd6e68eb3ffb32cbce13"><Highlight kind="normal">    <a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a>(</Highlight><Highlight kind="stringliteral">&quot;addr-sink-using-gep&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Address sinking in CGP using GEPs.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154" lineLink="#add2019bfb348f5241b4110eb77775410"><Highlight kind="normal">    <a href="#add2019bfb348f5241b4110eb77775410">EnableAndCmpSinking</a>(</Highlight><Highlight kind="stringliteral">&quot;enable-andcmp-sinking&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">                        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable sinking and/cmp into branches.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157" lineLink="#a1e6cf6a2bf01ee44a0f0843d8c3512cd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a1e6cf6a2bf01ee44a0f0843d8c3512cd">DisableStoreExtract</a>(</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;disable-cgp-store-extract&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disable store(extract) optimizations in CodeGenPrepare&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161" lineLink="#a4a686688e72eafe6375f8ae1ed184123"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a>(</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;stress-cgp-store-extract&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Stress test store(extract) optimizations in CodeGenPrepare&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165" lineLink="#a337eb74e6c82771bb21ce598a8d3090c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a337eb74e6c82771bb21ce598a8d3090c">DisableExtLdPromotion</a>(</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;disable-cgp-ext-ld-promotion&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disable ext(promotable(ld)) -&gt; promoted(ext(ld)) optimization in &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;CodeGenPrepare&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170" lineLink="#aeabb375be2dc51a3d518b9d2a1140fe6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a>(</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;stress-cgp-ext-ld-promotion&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Stress test ext(promotable(ld)) -&gt; promoted(ext(ld)) &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;optimization in CodeGenPrepare&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175" lineLink="#a346da4fb7a62e95531402c0b2a85c4fd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a346da4fb7a62e95531402c0b2a85c4fd">DisablePreheaderProtect</a>(</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;disable-preheader-prot&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disable protection against removing loop preheaders&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179" lineLink="#a6cdb6fbcff4780503fef226b46b6f10b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a6cdb6fbcff4780503fef226b46b6f10b">ProfileGuidedSectionPrefix</a>(</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;profile-guided-section-prefix&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Use profile info to add section prefix for hot/cold functions&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183" lineLink="#a276112f96ea0d245fec9eaa1306712c0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a276112f96ea0d245fec9eaa1306712c0">ProfileUnknownInSpecialSection</a>(</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;profile-unknown-in-special-section&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;In profiling mode like sampleFDO, if a function doesn&#39;t have &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;profile, we cannot tell the function is cold for sure because &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;it may be a function newly added without ever being sampled. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;With the flag enabled, compiler can put such profile unknown &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;functions into a special section, so runtime system can choose &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;to handle it in a different way than .text section, to save &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;RAM for example. &quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193" lineLink="#aaabb67aa574169b8cf2db8baf993b9ea"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aaabb67aa574169b8cf2db8baf993b9ea">BBSectionsGuidedSectionPrefix</a>(</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;bbsections-guided-section-prefix&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Use the basic-block-sections profile to determine the text &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;section prefix for hot functions. Functions with &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;basic-block-sections profile will be placed in &#96;.text.hot&#96; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;regardless of their FDO profile info. Other functions won&#39;t be &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;impacted, i.e., their prefixes will be decided by FDO/sampleFDO &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;profiles.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202" lineLink="#acb1402a601e394cbb3a7b1a1c4e4634f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;uint64&#95;t&gt;</a> <a href="#acb1402a601e394cbb3a7b1a1c4e4634f">FreqRatioToSkipMerge</a>(</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;cgp-freq-ratio-to-skip-merge&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2),</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Skip merging empty blocks if (frequency of empty block) / &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;(frequency of destination block) is greater than this ratio&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207" lineLink="#a8ac7126af5085fb735db4c727a0ab4e9"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a8ac7126af5085fb735db4c727a0ab4e9">ForceSplitStore</a>(</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-split-store&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Force store splitting no matter what the target query says.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211" lineLink="#a6412f4a5842ffe108c2aa493fa0fe1b1"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a6412f4a5842ffe108c2aa493fa0fe1b1">EnableTypePromotionMerge</a>(</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;cgp-type-promotion-merge&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable merging of redundant sexts when one is dominating&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot; the other.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217" lineLink="#aa653d45524ba8feb6e97dd4f961b7c3e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aa653d45524ba8feb6e97dd4f961b7c3e">DisableComplexAddrModes</a>(</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;disable-complex-addr-modes&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disables combining addressing modes with different parts &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;in optimizeMemoryInst.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223" lineLink="#afedfbc99c6b04e20643eb77da796d522"><Highlight kind="normal">    <a href="#afedfbc99c6b04e20643eb77da796d522">AddrSinkNewPhis</a>(</Highlight><Highlight kind="stringliteral">&quot;addr-sink-new-phis&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">                    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow creation of Phis in Address sinking.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226" lineLink="#a732a4fb41e78c56627fb9748f00935ab"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a732a4fb41e78c56627fb9748f00935ab">AddrSinkNewSelects</a>(</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;addr-sink-new-select&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow creation of selects in Address sinking.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230" lineLink="#a44b23d217bd678cd7aef7d152d945537"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a44b23d217bd678cd7aef7d152d945537">AddrSinkCombineBaseReg</a>(</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;addr-sink-combine-base-reg&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow combining of BaseReg field in Address sinking.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234" lineLink="#a51f303fd2cc8c48e50ab97c59f3558cc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a51f303fd2cc8c48e50ab97c59f3558cc">AddrSinkCombineBaseGV</a>(</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;addr-sink-combine-base-gv&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow combining of BaseGV field in Address sinking.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238" lineLink="#a3a00df51e1fa276c0c8860fe5ac1f95c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a3a00df51e1fa276c0c8860fe5ac1f95c">AddrSinkCombineBaseOffs</a>(</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;addr-sink-combine-base-offs&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow combining of BaseOffs field in Address sinking.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242" lineLink="#a984c73ae4b3ecbd1c9a237c11e38ac62"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a984c73ae4b3ecbd1c9a237c11e38ac62">AddrSinkCombineScaledReg</a>(</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;addr-sink-combine-scaled-reg&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow combining of ScaledReg field in Address sinking.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247" lineLink="#aa139a070bbd3c66bb6fd2dbdee1dd893"><Highlight kind="normal">    <a href="#aa139a070bbd3c66bb6fd2dbdee1dd893">EnableGEPOffsetSplit</a>(</Highlight><Highlight kind="stringliteral">&quot;cgp-split-large-offset-gep&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">                         <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">                         <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable splitting large offset of GEP.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251" lineLink="#aa667cc0d6f6fc39b8d40b9b9828b81bb"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aa667cc0d6f6fc39b8d40b9b9828b81bb">EnableICMP&#95;EQToICMP&#95;ST</a>(</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;cgp-icmp-eq2icmp-st&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable ICMP&#95;EQ to ICMP&#95;S(L|G)T conversion.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256" lineLink="#aa67824c7146db82e49933e0a1ac1d3b9"><Highlight kind="normal">    <a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a>(</Highlight><Highlight kind="stringliteral">&quot;cgp-verify-bfi-updates&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">                     <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable BFI update verification for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">                              </Highlight><Highlight kind="stringliteral">&quot;CodeGenPrepare.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261" lineLink="#a1d7858eecb954b54795df357b6935414"><Highlight kind="normal">    <a href="#a1d7858eecb954b54795df357b6935414">OptimizePhiTypes</a>(</Highlight><Highlight kind="stringliteral">&quot;cgp-optimize-phi-types&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">                     <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable converting phi types in CodeGenPrepare&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265" lineLink="#a6eff5790402995c83be65f9260826b41"><Highlight kind="normal">    <a href="#a6eff5790402995c83be65f9260826b41">HugeFuncThresholdInCGPP</a>(</Highlight><Highlight kind="stringliteral">&quot;cgpp-huge-func&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(10000), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal">                            <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Least BB number of huge function.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269" lineLink="#a1a31871450a2ceec97ef89dbdae54921"><Highlight kind="normal">    <a href="#a1a31871450a2ceec97ef89dbdae54921">MaxAddressUsersToScan</a>(</Highlight><Highlight kind="stringliteral">&quot;cgp-max-address-users-to-scan&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(100),</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">                          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Max number of address users to look at&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274" lineLink="#af6d9ea3fbe9aad1268fdabb3863c336c"><Highlight kind="normal">    <a href="#af6d9ea3fbe9aad1268fdabb3863c336c">DisableDeletePHIs</a>(</Highlight><Highlight kind="stringliteral">&quot;disable-cgp-delete-phis&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Disable elimination of dead PHI nodes.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">enum</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> &#123;</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8">ZeroExtension</a>, </Highlight><Highlight kind="comment">// Zero extension has been seen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de">SignExtension</a>, </Highlight><Highlight kind="comment">// Sign extension has been seen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fad4ce99b4684baf70c4310e9a2ae58597"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fad4ce99b4684baf70c4310e9a2ae58597">BothExtension</a>  </Highlight><Highlight kind="comment">// This extension type is used if we saw sext after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">                 </Highlight><Highlight kind="comment">// ZeroExtension had been set, or if we saw zext after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">                 </Highlight><Highlight kind="comment">// SignExtension had been set. It makes the type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">                 </Highlight><Highlight kind="comment">// information of a promoted instruction invalid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379"><Highlight kind="normal"></Highlight><Highlight kind="keyword">enum</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &#123;</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">NotModifyDT</a>, </Highlight><Highlight kind="comment">// Not Modify any DT.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyBBDT</a>,  </Highlight><Highlight kind="comment">// Modify the Basic Block Dominator Tree.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyInstDT</a> </Highlight><Highlight kind="comment">// Modify the Instruction Dominator in a Basic Block,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">               </Highlight><Highlight kind="comment">// This usually means we move/delete/insert instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">               </Highlight><Highlight kind="comment">// in a Basic Block. So we should re-iterate instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">               </Highlight><Highlight kind="comment">// in such Basic Block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> = <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 16&gt;</a>;</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a17cdfc9d4da684f5f8b3c97c8706c28e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a17cdfc9d4da684f5f8b3c97c8706c28e">TypeIsSExt</a> = <a href="/docs/api/classes/llvm/pointerintpair">PointerIntPair&lt;Type &#42;, 2, ExtType&gt;</a>;</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, TypeIsSExt&gt;</a>;</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321">SExts</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 16&gt;</a>;</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a882043c34b485e559cd3e42b1a4274b2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a882043c34b485e559cd3e42b1a4274b2">ValueToSExts</a> = <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Value &#42;, SExts&gt;</a>;</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a>;</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a88c47869c3d6832ba11c5480ba78aa04">CodeGenPrepare</a> &#123;</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#add05b1dba7a9938b30736abfceee94bf"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">friend</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#add05b1dba7a9938b30736abfceee94bf">CodeGenPrepareLegacyPass</a>;</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &#42;TM = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetsubtargetinfo">TargetSubtargetInfo</a> &#42;SubtargetInfo = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42;TLI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;TRI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblocksectionsprofilereader">BasicBlockSectionsProfileReader</a> &#42;BBSectionsProfileReader = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLInfo = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">  std::unique&#95;ptr&lt;BlockFrequencyInfo&gt; BFI;</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">  std::unique&#95;ptr&lt;BranchProbabilityInfo&gt; BPI;</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="comment">  /// As we scan instructions optimizing them, this is the next instruction</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="comment">  /// to optimize. Transforms that can invalidate this should update it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> CurInstIterator;</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="comment">  /// Keeps track of non-local addresses that have been sunk into a block.</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="comment">  /// This allows us to avoid inserting duplicate code for blocks with</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="comment">  /// multiple load/stores of the same address. The usage of WeakTrackingVH</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="comment">  /// enables SunkAddrs to be treated as a cache whose entries can be</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="comment">  /// invalidated if a sunken address computation has been erased.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/valuemap">ValueMap&lt;Value &#42;, WeakTrackingVH&gt;</a> SunkAddrs;</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="comment">  /// Keeps track of all instructions inserted for the current function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> InsertedInsts;</Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="comment">  /// Keeps track of the type of the related instruction before their</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="comment">  /// promotion for the current function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> PromotedInsts;</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="comment">  /// Keep track of instructions removed during promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> RemovedInsts;</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="comment">  /// Keep track of sext chains based on their initial value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Instruction &#42;&gt;</a> SeenChainsForSExt;</Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="comment">  /// Keep track of GEPs accessing the same data structures such as structs or</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="comment">  /// arrays that are candidates to be split later because of their large</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="comment">  /// size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;AssertingVH&lt;Value&gt;</a>,</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;</a>, int64&#95;t&gt;, 32&gt;&gt;</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">      LargeOffsetGEPMap;</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="comment">  /// Keep track of new GEP base after splitting the GEPs having large offset.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;AssertingVH&lt;Value&gt;</a>, 2&gt; NewGEPBases;</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="comment">  /// Map serial numbers to Large offset GEPs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;AssertingVH&lt;GetElementPtrInst&gt;</a>, </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">&gt; LargeOffsetGEPID;</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="comment">  /// Keep track of SExt promoted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a882043c34b485e559cd3e42b1a4274b2">ValueToSExts</a> ValToSExtendedUses;</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="comment">  /// True if the function has the OptSize attribute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptSize;</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="comment">  /// DataLayout for the Function being processed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;DL = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="comment">  /// Building the dominator tree can be expensive, so we only build it</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="comment">  /// lazily and update it when required.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">  std::unique&#95;ptr&lt;DominatorTree&gt; DT;</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a88c47869c3d6832ba11c5480ba78aa04"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a88c47869c3d6832ba11c5480ba78aa04">CodeGenPrepare</a>()&#123;&#125;;</Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a2fab09a0564f5203372a75e51f20b526"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a2fab09a0564f5203372a75e51f20b526">CodeGenPrepare</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &#42;TM) : TM(TM)&#123;&#125;;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="comment">  /// If encounter huge function, we need to limit the build time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="comment">  /// FreshBBs is like worklist, it collected the updated BBs which need</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="comment">  /// to be optimized again.</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="comment">  /// Note: Consider building time in this pass, when a BB updated, we need</Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="comment">  /// to insert such BB into FreshBBs for huge function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>;</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a603cbf2855141608521f6709cdfb126f"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a603cbf2855141608521f6709cdfb126f">releaseMemory</a>() &#123;</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Clear per function information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">    InsertedInsts.clear();</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">    PromotedInsts.clear();</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.clear();</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">    BPI.reset();</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">    BFI.reset();</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> run(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM);</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal"></Highlight><Highlight kind="keyword">private</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">template</Highlight><Highlight kind="normal"> &lt;</Highlight><Highlight kind="keyword">typename</Highlight><Highlight kind="normal"> F&gt;</Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> resetIteratorIfInvalidatedWhileCalling(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> f) &#123;</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Substituting can cause recursive simplifications, which can invalidate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// our iterator.  Use a WeakTrackingVH to hold onto it in case this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// happens.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CurValue = &amp;&#42;CurInstIterator;</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> IterHandle(CurValue);</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">    f();</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the iterator instruction was recursively deleted, start over at the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// start of the block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IterHandle != CurValue) &#123;</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">      CurInstIterator = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">      SunkAddrs.<a href="/docs/api/classes/llvm/valuemap/#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the DominatorTree, building if necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal">  DominatorTree &amp;getDT(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DT)</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">      DT = std::make&#95;unique&lt;DominatorTree&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;DT;</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> removeAllAssertingVHReferences(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V);</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> eliminateAssumptions(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> eliminateFallThrough(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DominatorTree &#42;DT = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> eliminateMostlyEmptyBlocks(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;findDestBlockOfMergeableEmptyBlock(BasicBlock &#42;BB);</Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> canMergeBlocks(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BasicBlock &#42;BB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BasicBlock &#42;DestBB) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> eliminateMostlyEmptyBlock(BasicBlock &#42;BB);</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isMergingEmptyBlockProfitable(BasicBlock &#42;BB, BasicBlock &#42;DestBB,</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">                                     </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isPreheader);</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> makeBitReverse(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/scalarizemaskedmemintrin-cpp/#a50754c809dc6a1aa65e3ab52f63f3467">optimizeBlock</a>(BasicBlock &amp;BB, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeInst(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeMemoryInst(Instruction &#42;MemoryInst, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;AccessTy,</Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">                          </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AddrSpace);</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeGatherScatterInst(Instruction &#42;MemoryInst, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeInlineAsmInst(CallInst &#42;CS);</Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/scalarizemaskedmemintrin-cpp/#a5c59325f9c3c1526f4439392c892fd41">optimizeCallInst</a>(CallInst &#42;CI, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeExt(Instruction &#42;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeExtUses(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeLoadExt(LoadInst &#42;Load);</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeShiftInst(BinaryOperator &#42;BO);</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeFunnelShift(IntrinsicInst &#42;Fsh);</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeSelectInst(SelectInst &#42;SI);</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeShuffleVectorInst(ShuffleVectorInst &#42;SVI);</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeSwitchType(SwitchInst &#42;SI);</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeSwitchPhiConstants(SwitchInst &#42;SI);</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeSwitchInst(SwitchInst &#42;SI);</Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeExtractElementInst(Instruction &#42;Inst);</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> dupRetToEnableTailCallOpts(BasicBlock &#42;BB, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> fixupDbgValue(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> fixupDbgVariableRecord(DbgVariableRecord &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> fixupDbgVariableRecordsOnInst(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> placeDbgValues(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> placePseudoProbes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> canFormExtLd(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;MovedExts,</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">                    LoadInst &#42;&amp;LI, Instruction &#42;&amp;Inst, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasPromoted);</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> tryToPromoteExts(TypePromotionTransaction &amp;TPT,</Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal">                        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;Exts,</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">                        SmallVectorImpl&lt;Instruction &#42;&gt; &amp;ProfitablyMovedExts,</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal">                        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CreatedInstsCost = 0);</Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> mergeSExts(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> splitLargeGEPOffsets();</Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizePhiType(PHINode &#42;Inst, SmallPtrSetImpl&lt;PHINode &#42;&gt; &amp;Visited,</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">                       SmallPtrSetImpl&lt;Instruction &#42;&gt; &amp;DeletedInstrs);</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizePhiTypes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> performAddressTypePromotion(</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">      Instruction &#42;&amp;Inst, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowPromotionWithoutCommonHeader,</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasPromoted, TypePromotionTransaction &amp;TPT,</Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">      SmallVectorImpl&lt;Instruction &#42;&gt; &amp;SpeculativelyMovedExts);</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> splitBranchCondition(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> simplifyOffsetableRelocate(GCStatepointInst &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> tryToSinkFreeOperands(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> replaceMathCmpWithIntrinsic(BinaryOperator &#42;BO, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Arg0, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Arg1,</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">                                   CmpInst &#42;Cmp, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID);</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeCmp(CmpInst &#42;Cmp, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> optimizeURem(Instruction &#42;Rem);</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> combineToUSubWithOverflow(CmpInst &#42;Cmp, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> combineToUAddWithOverflow(CmpInst &#42;Cmp, ModifyDT &amp;ModifiedDT);</Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> verifyBFIUpdates(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#95;run(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a> : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a> &#123;</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998">ID</a>; </Highlight><Highlight kind="comment">// Pass identification, replacement for typeid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>() : <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998">ID</a>) &#123;</Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a49bbe77df41e968c3568041ee2932850">initializeCodeGenPrepareLegacyPassPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/entryexitinstrumenter-cpp/#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4ac0e57f95a82ff11606bb90d5f762c9"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4ac0e57f95a82ff11606bb90d5f762c9">getPassName</a>()</Highlight><Highlight kind="keyword"> const override </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="stringliteral">&quot;CodeGen Prepare&quot;</Highlight><Highlight kind="normal">; &#125;</Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4e6eaa6981139214f5c249f3b365e2a3"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4e6eaa6981139214f5c249f3b365e2a3">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</Highlight><Highlight kind="keyword"> const override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: When we can selectively preserve passes, preserve the domtree.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a>&gt;();</Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/loopinfowrapperpass">LoopInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#aaeddaf79040291b6f3e0db57943aac39">addUsedIfAvailable</a>&lt;<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderwrapperpass">BasicBlockSectionsProfileReaderWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998">CodeGenPrepareLegacyPass::ID</a> = 0;</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a247a6373f131cbd580f94dd0483551b2"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a247a6373f131cbd580f94dd0483551b2">CodeGenPrepareLegacyPass::runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TM = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetPassConfig&gt;</a>().getTM&lt;<a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a>&gt;();</Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare">CodeGenPrepare</a> CGP(TM);</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">  CGP.DL = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">  CGP.SubtargetInfo = TM-&gt;getSubtargetImpl(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">  CGP.TLI = CGP.SubtargetInfo-&gt;getTargetLowering();</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">  CGP.TRI = CGP.SubtargetInfo-&gt;getRegisterInfo();</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">  CGP.TLInfo = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;</a>().getTLI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">  CGP.TTI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetTransformInfoWrapperPass&gt;</a>().getTTI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">  CGP.LI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;LoopInfoWrapperPass&gt;</a>().getLoopInfo();</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal">  CGP.BPI.reset(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;CGP.LI));</Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">  CGP.BFI.reset(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;CGP.BPI, &#42;CGP.LI));</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">  CGP.PSI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;</a>().getPSI();</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BBSPRWP =</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/pass/#af94c014e968489e96c7d4353a84ad7f5">getAnalysisIfAvailable&lt;BasicBlockSectionsProfileReaderWrapperPass&gt;</a>();</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal">  CGP.BBSectionsProfileReader = BBSPRWP ? &amp;BBSPRWP-&gt;getBBSPR() : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CGP.&#95;run(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530" lineLink="#aaca449a7620b1306ed7586ba6bdc4faa"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">                      </Highlight><Highlight kind="stringliteral">&quot;Optimize for code generation&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderwrapperpass">BasicBlockSectionsProfileReaderWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/loopinfowrapperpass">LoopInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a>)</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538" lineLink="#a030569d5a541b6110f2ae1b6a3413a58"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539" lineLink="#a82626751cd03ec5db2cc4939a10ad956"><Highlight kind="normal">                    </Highlight><Highlight kind="stringliteral">&quot;Optimize for code generation&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541" lineLink="/docs/api/namespaces/llvm/#a865ae563bea8062ebf0dcc035ccc2e82"><Highlight kind="normal"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a865ae563bea8062ebf0dcc035ccc2e82">createCodeGenPrepareLegacyPass</a>() &#123;</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>();</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545" lineLink="/docs/api/classes/llvm/codegenpreparepass/#a33f05511e053fdbfa05140b0cd29553a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/codegenpreparepass/#a33f05511e053fdbfa05140b0cd29553a">CodeGenPreparePass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">                                          <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">  CodeGenPrepare CGP(TM);</Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = CGP.run(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, AM);</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PA;</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aa963097f89a02195cba904f74c5e0f71"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aa963097f89a02195cba904f74c5e0f71">CodeGenPrepare::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">  DL = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">  SubtargetInfo = TM-&gt;getSubtargetImpl(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">  TLI = SubtargetInfo-&gt;getTargetLowering();</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal">  TRI = SubtargetInfo-&gt;getRegisterInfo();</Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">  TLInfo = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">  TTI = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">  LI = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal">  BPI.reset(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;LI));</Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">  BFI.reset(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;BPI, &#42;LI));</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MAMProxy = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a2b0ee73723ccffec457f8712220b0c25">ModuleAnalysisManagerFunctionProxy</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">  PSI = MAMProxy.getCachedResult&lt;<a href="/docs/api/classes/llvm/profilesummaryanalysis">ProfileSummaryAnalysis</a>&gt;(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">  BBSectionsProfileReader =</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">      AM.<a href="/docs/api/classes/llvm/analysismanager/#a828ff8185f881fca9e3d534781244041">getCachedResult</a>&lt;<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderanalysis">BasicBlockSectionsProfileReaderAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#95;run(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::&#95;run(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EverMadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">  OptSize = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasOptSize();</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use the basic-block-sections profile to promote hot functions to .text.hot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if requested.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aaabb67aa574169b8cf2db8baf993b9ea">BBSectionsGuidedSectionPrefix</a> &amp;&amp; BBSectionsProfileReader &amp;&amp;</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">      BBSectionsProfileReader-&gt;<a href="/docs/api/classes/llvm/basicblocksectionsprofilereader/#a31414298cda30f1d52c965571b4efc75">isFunctionHot</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName())) &#123;</Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</Highlight><Highlight kind="stringliteral">&quot;hot&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a6cdb6fbcff4780503fef226b46b6f10b">ProfileGuidedSectionPrefix</a>) &#123;</Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The hot attribute overwrites profile count based hotness while profile</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// counts based hotness overwrite the cold attribute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This is a conservative behabvior.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::Hot) ||</Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">        PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a8a527a78e773ac22ca346a7b8ca9201e">isFunctionHotInCallGraph</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;BFI))</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</Highlight><Highlight kind="stringliteral">&quot;hot&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If PSI shows this function is not hot, we will placed the function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// into unlikely section if (1) PSI shows this is a cold function, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (2) the function has a attribute of cold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a1cdf368dd1d358e55f871484b1fec5cc">isFunctionColdInCallGraph</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;BFI) ||</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">             <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::Cold))</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</Highlight><Highlight kind="stringliteral">&quot;unlikely&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a276112f96ea0d245fec9eaa1306712c0">ProfileUnknownInSpecialSection</a> &amp;&amp; PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a9610274171a85158779e7ee6031d2376">hasPartialSampleProfile</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">             PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a215c4f3e485345daeb8e9d68264f388a">isFunctionHotnessUnknown</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</Highlight><Highlight kind="stringliteral">&quot;unknown&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="comment">  /// This optimization identifies DIV instructions that can be</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="comment">  /// profitably bypassed and carried out with a shorter, faster divide.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OptSize &amp;&amp; !PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#ad7a8ced5ff54962319d57208f5d4a57e">hasHugeWorkingSetSize</a>() &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a6ade65d2ea72712ca307ed5d5876dba8">isSlowDivBypassed</a>()) &#123;</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned int, unsigned int&gt;</a> &amp;BypassWidths =</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">        TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#abc6a0c251a75bb3b9b47c79c7ab0e503">getBypassSlowDivWidths</a>();</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (BB != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bypassSlowDivision may create new BBs, but we don&#39;t want to reapply the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// optimization to those blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a> = BB-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>();</Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(BB, PSI, <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get()))</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">        EverMadeChange |= <a href="/docs/api/namespaces/llvm/#ac7a11b9f5656e9697ac700a0e57dbb04">bypassSlowDivision</a>(BB, BypassWidths);</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">      BB = <a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a>;</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get rid of @llvm.assume builtins before attempting to eliminate empty</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// blocks, since there might be blocks that only contain @llvm.assume calls</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (plus arguments that we can get rid of).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">  EverMadeChange |= eliminateAssumptions(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Eliminate blocks that contain only PHI nodes and an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unconditional branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">  EverMadeChange |= eliminateMostlyEmptyBlocks(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>;</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a>)</Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">    EverMadeChange |= splitBranchCondition(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ModifiedDT);</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Split some critical edges where one of the sources is an indirect branch,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to help generate sane code for PHIs involving such edges.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">  EverMadeChange |=</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a502009030bffff8a6992f4e4eb9380f5">SplitIndirectBrCriticalEdges</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </Highlight><Highlight kind="comment">/&#42;IgnoreBlocksWithoutPHI=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we are optimzing huge function, we need to consider the build time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Because the basic algorithm&#39;s complex is near O(N!).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">  IsHugeFunc = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.size() &gt; <a href="#a6eff5790402995c83be65f9260826b41">HugeFuncThresholdInCGPP</a>;</Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Transformations above may invalidate dominator tree and/or loop info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal">  DT.reset();</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">  LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#aea153ce91e791ba0ca4cc59d72c5145c">releaseMemory</a>();</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">  LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a280d02be3ec3eb6527c1ea944d902775">analyze</a>(getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FuncIterated = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (MadeChange) &#123;</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FuncIterated &amp;&amp; !FreshBBs.<a href="/docs/api/classes/llvm/smallset/#ae04ad615dfdd885e85cbddda146787c6">contains</a>(&amp;BB))</Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> ModifiedDTOnIteration = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>;</Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/scalarizemaskedmemintrin-cpp/#a50754c809dc6a1aa65e3ab52f63f3467">optimizeBlock</a>(BB, ModifiedDTOnIteration);</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ModifiedDTOnIteration == <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>)</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">        DT.reset();</Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">      MadeChange |= <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsHugeFunc) &#123;</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the BB is updated, it may still has chance to be optimized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This usually happen at sink optimization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// For example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// bb0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// %and = and i32 %a, 4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// %cmp = icmp eq i32 %and, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the %cmp sink to other BB, the %and will has chance to sink.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">          FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(&amp;BB);</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FuncIterated)</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">          FreshBBs.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(&amp;BB);</Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// For small/normal functions, we restart BB iteration if the dominator</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// tree of the Function was changed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ModifiedDTOnIteration != <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>)</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We have iterated all the BB in the (only work for huge) function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">    FuncIterated = IsHugeFunc;</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a6412f4a5842ffe108c2aa493fa0fe1b1">EnableTypePromotionMerge</a> &amp;&amp; !ValToSExtendedUses.<a href="/docs/api/classes/llvm/mapvector/#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">      MadeChange |= mergeSExts(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">      MadeChange |= splitLargeGEPOffsets();</Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal">    MadeChange |= optimizePhiTypes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MadeChange)</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">      eliminateFallThrough(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT.get());</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MadeChange &amp;&amp; <a href="/docs/api/namespaces/llvm/#a8bf0b85d705bf73d1af85056ef77b9c5">VerifyLoopInfo</a>)</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">      LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a17a8f7aba5cca5c7f9faa779a3c4bc37">verify</a>(getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Really free removed instructions during promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : RemovedInsts)</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;deleteValue();</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">    EverMadeChange |= MadeChange;</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">    SeenChainsForSExt.<a href="/docs/api/classes/llvm/densemapbase/#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">    ValToSExtendedUses.<a href="/docs/api/classes/llvm/mapvector/#ae091b147039557cf8ce505740e7ff7ac">clear</a>();</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">    RemovedInsts.clear();</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">    LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#ae091b147039557cf8ce505740e7ff7ac">clear</a>();</Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">    LargeOffsetGEPID.<a href="/docs/api/classes/llvm/densemapbase/#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">  NewGEPBases.<a href="/docs/api/classes/llvm/smallset/#a76b3fc7c102561fb5210d5151531e409">clear</a>();</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">  SunkAddrs.<a href="/docs/api/classes/llvm/valuemap/#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a>) &#123;</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Use a set vector to get deterministic iteration order. The order the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// blocks are removed may affect whether or not PHI nodes in successors</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// are removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 8&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> Successors(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(&amp;BB));</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">      MadeChange |= <a href="/docs/api/namespaces/llvm/#a152d8c380cc937c9dceb402ceec943b6">ConstantFoldTerminator</a>(&amp;BB, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MadeChange)</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : Successors)</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(Succ))</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">          WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Succ);</Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Delete the dead blocks and any of their dead successors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">    MadeChange |= !WorkList.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>();</Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!WorkList.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = WorkList.<a href="/docs/api/classes/llvm/setvector/#af9880d625c506aacc716ee1c9a29ff8b">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> Successors(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB));</Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(BB);</Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : Successors)</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(Succ))</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">          WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Succ);</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Merge pairs of basic blocks with unconditional branches, connected by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a single edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EverMadeChange || MadeChange)</Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">      MadeChange |= eliminateFallThrough(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal">    EverMadeChange |= MadeChange;</Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ac23f3d86779d204fbf6db71ce8f41d7b">DisableGCOpts</a>) &#123;</Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GCStatepointInst &#42;, 2&gt;</a> Statepoints;</Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB)</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SP = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCStatepointInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">          Statepoints.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SP);</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Statepoints)</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">      EverMadeChange |= simplifyOffsetableRelocate(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do this last to clean up use-before-def scenarios introduced by other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// preparatory transforms.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">  EverMadeChange |= placeDbgValues(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">  EverMadeChange |= placePseudoProbes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a>)</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal">    verifyBFIUpdates(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EverMadeChange;</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::eliminateAssumptions(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">    CurInstIterator = BB.begin();</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (CurInstIterator != BB.end()) &#123;</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &amp;&#42;(CurInstIterator++);</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Assume = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">        MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Operand = <a href="/docs/api/namespaces/llvm/lowertypetests/#a28baf2df0f23eab12b60755416e83adaa4822c96fc1eebe031cde975d10a29e12">Assume</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/lowertypetests/#a28baf2df0f23eab12b60755416e83adaa4822c96fc1eebe031cde975d10a29e12">Assume</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">        resetIteratorIfInvalidatedWhileCalling(&amp;BB, &#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Operand, TLInfo, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">        &#125;);</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="comment">/// An instruction is about to be deleted, so remove all references to it in our</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="comment">/// GEP-tracking data strcutures.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeGenPrepare::removeAllAssertingVHReferences(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal">  LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a3a8171298a7d19a309d599de01906703">erase</a>(V);</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">  NewGEPBases.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(V);</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">  LargeOffsetGEPID.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> VecI = LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VecI == LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a0881334358ff6ff7ff8cea5562c7988e">end</a>())</Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;GEPVector = VecI-&gt;second;</Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(GEPVector, &#91;=&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Elt) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Elt.first == <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>; &#125;);</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPVector.empty())</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">    LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a3a8171298a7d19a309d599de01906703">erase</a>(VecI);</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Verify BFI has been updated correctly by recomputing BFI and comparing them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#acc1c483f4b4ee2f17bb6643a3b353609">LLVM&#95;ATTRIBUTE&#95;UNUSED</a> CodeGenPrepare::verifyBFIUpdates(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> NewDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> NewLI(NewDT);</Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> NewBPI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NewLI, TLInfo);</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> NewBFI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NewBPI, NewLI);</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">  NewBFI.verifyMatch(&#42;BFI);</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="comment">/// Merge basic blocks which are connected by a single edge, where one of the</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="comment">/// basic blocks has a single successor pointing to the other basic block,</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="comment">/// which has a single predecessor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::eliminateFallThrough(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Scan all of the blocks in the function, except for the entry block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use a temporary array to avoid iterator being invalidated when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// deleting blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 16&gt;</a> Blocks;</Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">llvm::drop&#95;begin</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">    Blocks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;WeakTrackingVH, 16&gt;</a> Preds;</Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BB = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BB)</Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the destination block has a single pred, then this is a trivial</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// edge, just collapse it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SinglePred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t merge if BB&#39;s address is taken.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SinglePred || SinglePred == BB || BB-&gt;hasAddressTaken())</Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make an effort to skip unreachable blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DT &amp;&amp; !DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(BB))</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(SinglePred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Term &amp;&amp; !<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a>-&gt;isConditional()) &#123;</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;To merge:\\n&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;BB &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n\\n\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Merge BB into SinglePred and delete it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(BB, </Highlight><Highlight kind="comment">/&#42; DTU &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, LI, </Highlight><Highlight kind="comment">/&#42; MSSAU &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">                                </Highlight><Highlight kind="comment">/&#42; MemDep &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">                                </Highlight><Highlight kind="comment">/&#42; PredecessorWithTwoSuccessors &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, DT);</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">      Preds.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(SinglePred);</Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsHugeFunc) &#123;</Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Update FreshBBs to optimize the merged BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(SinglePred);</Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(BB);</Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (Repeatedly) merging blocks into their predecessors can create redundant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// debug intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pred : Preds)</Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BB = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(Pred))</Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a08f3f942afc0ee9115a8f9fa87e9191d">RemoveRedundantDbgInstrs</a>(BB);</Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="comment">/// Find a destination block from BB if BB is mergeable empty block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CodeGenPrepare::findDestBlockOfMergeableEmptyBlock(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this block doesn&#39;t end with an uncond branch, ignore it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the instruction before the branch (skipping debug info) isn&#39;t a phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// node, then other stuff is happening here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = BI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BBI != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) &#123;</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">    --BBI;</Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BBI)) &#123;</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BBI == BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())</Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal">      --BBI;</Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BBI) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BBI))</Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not break infinite loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DestBB == BB)</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!canMergeBlocks(BB, DestBB))</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">    DestBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> DestBB;</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="comment">/// Eliminate blocks that contain only PHI nodes, debug info directives, and an</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="comment">/// unconditional branch. Passes before isel (e.g. LSR/loopsimplify) often split</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="comment">/// edges in ways that are non-optimal for isel. Start by eliminating these</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="comment">/// blocks so we can split them the way we want them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::eliminateMostlyEmptyBlocks(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> Preheaders;</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Loop &#42;, 16&gt;</a> LoopList(LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ab447b41b9c51151b5c6ef497a60689ae">begin</a>(), LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a4f728602e7d377829675f13446cf6647">end</a>());</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!LoopList.empty()) &#123;</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a> = LoopList.pop&#95;back&#95;val();</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">llvm::append&#95;range</a>(LoopList, &#42;L);</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopPreheader())</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">      Preheaders.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Preheader);</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Copy blocks into a temporary array to avoid iterator invalidation issues</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as we remove them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that this intentionally skips the entry block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 16&gt;</a> Blocks;</Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">llvm::drop&#95;begin</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Delete phi nodes that could block deleting other empty blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#af6d9ea3fbe9aad1268fdabb3863c336c">DisableDeletePHIs</a>)</Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">      MadeChange |= <a href="/docs/api/namespaces/llvm/#a64ecdacbd49f696216e772782a109945">DeleteDeadPHIs</a>(&amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>, TLInfo);</Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">    Blocks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BB)</Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = findDestBlockOfMergeableEmptyBlock(BB);</Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DestBB ||</Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">        !isMergingEmptyBlockProfitable(BB, DestBB, Preheaders.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(BB)))</Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">    eliminateMostlyEmptyBlock(BB);</Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::isMergingEmptyBlockProfitable(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB,</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">                                                   </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isPreheader) &#123;</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not delete loop preheaders if doing so would create a critical edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loop preheaders can be good locations to spill registers. If the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// preheader is deleted and we create a critical edge, registers may be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// spilled in the loop body instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a346da4fb7a62e95531402c0b2a85c4fd">DisablePreheaderProtect</a> &amp;&amp; isPreheader &amp;&amp;</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal">      !(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">        BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>()))</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Skip merging if the block&#39;s successor is also a successor to any callbr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that leads to this block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Is this really needed? Is this a correctness issue?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallBrInst&gt;</a>(Pred-&gt;getTerminator()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Pred), DestBB))</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to skip merging if the unique predecessor of BB is terminated by a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// switch or indirect branch instruction, and BB is used as an incoming block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of PHIs in DestBB. In such case, merging BB and DestBB would cause ISel to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// add COPY instructions in the predecessor of BB instead of BB (if it is not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// merged). Note that the critical edge created by merging such blocks wont be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// split in MachineSink because the jump table is not analyzable. By keeping</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// such empty block (BB), ISel will place COPY instructions in BB, not in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessor of BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>();</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Pred || !(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SwitchInst&gt;</a>(Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) ||</Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())))</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>() != &amp;&#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a50909227135ef69932bff39b8ea3f572">getFirstNonPHIOrDbg</a>())</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We use a simple cost heuristic which determine skipping merging is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// profitable if the cost of skipping merging is less than the cost of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// merging : Cost(skipping merging) &lt; Cost(merging BB), where the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cost(skipping merging) is Freq(BB) &#42; (Cost(Copy) + Cost(Branch)), and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the Cost(merging BB) is Freq(Pred) &#42; Cost(Copy).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Assuming Cost(Copy) == Cost(Branch), we could simplify it to :</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   Freq(Pred) / Freq(BB) &gt; 2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that if there are multiple empty blocks sharing the same incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value for the PHIs in the DestBB, we consider them together. In such</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case, Cost(merging BB) will be the sum of their frequencies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> SameIncomingValueBBs;</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find all other incoming blocks from which incoming values of all PHIs in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// DestBB are the same as the ones from BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBBPred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(DestBB)) &#123;</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DestBBPred == BB)</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>(), &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;DestPN) &#123;</Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">          return DestPN.getIncomingValueForBlock(BB) ==</Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">                 DestPN.getIncomingValueForBlock(DestBBPred);</Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal">      SameIncomingValueBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(DestBBPred);</Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// See if all BB&#39;s incoming values are same as the value from Pred. In this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case, no reason to skip merging because COPYs are expected to be place in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pred already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SameIncomingValueBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Pred))</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> PredFreq = <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(Pred);</Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a> = <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(BB);</Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SameValueBB : SameIncomingValueBBs)</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SameValueBB-&gt;getUniquePredecessor() == Pred &amp;&amp;</Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">        DestBB == findDestBlockOfMergeableEmptyBlock(SameValueBB))</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a> += <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(SameValueBB);</Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">  std::optional&lt;BlockFrequency&gt; Limit = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a>.mul(<a href="#acb1402a601e394cbb3a7b1a1c4e4634f">FreqRatioToSkipMerge</a>);</Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !Limit || PredFreq &lt;= &#42;Limit;</Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="comment">/// Return true if we can merge BB into DestBB if there is a single</Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="comment">/// unconditional branch between them, and BB contains no other non-phi</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="comment">/// instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::canMergeBlocks(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">                                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We only want to eliminate blocks whose phi nodes are used by phi nodes in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the successor.  If there are more complex condition (e.g. preheaders),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// don&#39;t mess around with them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : PN.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != DestBB || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI))</Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If User is inside DestBB block and it is a PHINode then check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// incoming value. If incoming value is not from BB then this is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// a complex condition (e.g. preheaders) we want to avoid here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == DestBB) &#123;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;UPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(UI))</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = UPN-&gt;getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(UPN-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>-&gt;getParent() == BB &amp;&amp;</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">                <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>-&gt;getParent() != UPN-&gt;getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If BB and DestBB contain any common predecessors, then the phi nodes in BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and DestBB may have conflicting incoming values for the block.  If so, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// can&#39;t merge the block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;DestBBPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DestBBPN)</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// no conflict.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect the preds of BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const BasicBlock &#42;, 16&gt;</a> BBPreds;</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;BBPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) &#123;</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// It is faster to get preds from a PHI than with pred&#95;iterator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = BBPN-&gt;getNumIncomingValues(); i != e; ++i)</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">      BBPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BBPN-&gt;getIncomingBlock(i));</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">    BBPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB));</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk the preds of DestBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = DestBBPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = DestBBPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i);</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BBPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Pred)) &#123; </Highlight><Highlight kind="comment">// Common predecessor?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V1 = PN.getIncomingValueForBlock(Pred);</Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = PN.getIncomingValueForBlock(BB);</Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If V2 is a phi node in BB, look up what the mapped value will be.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;V2PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V2))</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V2PN-&gt;getParent() == BB)</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = V2PN-&gt;getIncomingValueForBlock(Pred);</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If there is a conflict, bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V1 != V2)</Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="comment">/// Replace all old uses with new ones, and push the updated BBs into FreshBBs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112" lineLink="#a19e092ecf7889abf7277f13824e0c601"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Old, <a href="/docs/api/classes/llvm/value">Value</a> &#42;New,</Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">                               </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsHuge) &#123;</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OldI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Old);</Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldI) &#123;</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = OldI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = OldI-&gt;user&#95;end();</Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">         UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++UI) &#123;</Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsHuge)</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent());</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">  Old-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="comment">/// Eliminate a basic block that has only phi&#39;s and an unconditional branch in</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="comment">/// it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeGenPrepare::eliminateMostlyEmptyBlock(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;MERGING MOSTLY EMPTY BLOCKS - BEFORE:\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">                    &lt;&lt; &#42;BB &lt;&lt; &#42;DestBB);</Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the destination block has a single pred, then this is a trivial edge,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// just collapse it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SinglePred = DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) &#123;</Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SinglePred != DestBB) &#123;</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SinglePred == BB &amp;&amp;</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Single predecessor not the same as predecessor&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Merge DestBB into SinglePred/BB and delete it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(DestBB);</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Note: BB(=SinglePred) will not be deleted on this path.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// DestBB(=its single successor) is the one that was deleted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;AFTER:\\n&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;SinglePred &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n\\n\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsHugeFunc) &#123;</Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Update FreshBBs to optimize the merged BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(SinglePred);</Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(DestBB);</Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, we have multiple predecessors of BB.  Update the PHIs in DestBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to handle the new incoming edges it is about to have.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove the incoming value for BB, and remember it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = PN.removeIncomingValue(BB, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Two options: either the InVal is a phi node defined in BB or it is some</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// value that dominates BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;InValPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(InVal);</Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InValPhi &amp;&amp; InValPhi-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB) &#123;</Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add all of the input values of the input PHI as inputs of this phi.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = InValPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i)</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">        PN.addIncoming(InValPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i),</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">                       InValPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i));</Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Otherwise, add one instance of the dominating value for each edge that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we will be adding.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;BBPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) &#123;</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = BBPN-&gt;getNumIncomingValues(); i != e; ++i)</Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">          PN.addIncoming(InVal, BBPN-&gt;getIncomingBlock(i));</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">          PN.addIncoming(InVal, Pred);</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Preserve loop Metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a565f546ad95bd3a9bbe9a1e5040803f0">hasMetadata</a>(LLVMContext::MD&#95;loop)) &#123;</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal">      Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;BI, LLVMContext::MD&#95;loop);</Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The PHIs are now updated, change everything that refers to BB to use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// DestBB and remove BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">  BB-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(DestBB);</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">  BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">  ++NumBlocksElim;</Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;AFTER:\\n&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;DestBB &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n\\n\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Computes a map of base pointer relocation instructions to corresponding</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal"></Highlight><Highlight kind="comment">// derived pointer relocation instructions given a vector of all relocate calls</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201" lineLink="#a8f5b32a03cc4a6072855d8c8cf7c748f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8f5b32a03cc4a6072855d8c8cf7c748f">computeBaseDerivedRelocateMap</a>(</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;GCRelocateInst &#42;&gt;</a> &amp;AllRelocateCalls,</Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mapvector">MapVector</a>&lt;<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;, <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GCRelocateInst &#42;, 0&gt;</a>&gt;</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">        &amp;RelocateInstMap) &#123;</Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect information in two maps: one primarily for locating the base object</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// while filling the second map; the second map is the final structure holding</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a mapping between Base and corresponding Derived relocate calls</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;std::pair&lt;unsigned, unsigned&gt;</a>, <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;&gt; RelocateIdxMap;</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ThisRelocate : AllRelocateCalls) &#123;</Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> K = std::make&#95;pair(ThisRelocate-&gt;getBasePtrIndex(),</Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">                            ThisRelocate-&gt;getDerivedPtrIndex());</Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal">    RelocateIdxMap.<a href="/docs/api/classes/llvm/mapvector/#abb6ea6cbdf19ab64bf0c8f65b2e6e8ce">insert</a>(std::make&#95;pair(K, ThisRelocate));</Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Item : RelocateIdxMap) &#123;</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">    std::pair&lt;unsigned, unsigned&gt; <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a> = Item.first;</Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.first == <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.second)</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Base relocation: nothing to insert</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Item.second;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BaseKey = std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.first, <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.first);</Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We&#39;re iterating over RelocateIdxMap so we cannot modify it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaybeBase = RelocateIdxMap.<a href="/docs/api/classes/llvm/mapvector/#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(BaseKey);</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaybeBase == RelocateIdxMap.<a href="/docs/api/classes/llvm/mapvector/#a0881334358ff6ff7ff8cea5562c7988e">end</a>())</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: We might want to insert a new base object relocate and gep off</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that, if there are enough derived object relocates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">    RelocateInstMap&#91;MaybeBase-&gt;second&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Accepts a GEP and extracts the operands into a vector provided they&#39;re all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal"></Highlight><Highlight kind="comment">// small integer constants</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236" lineLink="#a0e431b29d5cd842ab00f85ec2cdab8b2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Value &#42;&gt;</a> &amp;OffsetV) &#123;</Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 1; i &lt; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); i++) &#123;</Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only accept small constant integer operands</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(i));</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> || <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getZExtValue() &gt; 20)</Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 1; i &lt; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); i++)</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">    OffsetV.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(i));</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Takes a RelocatedBase (base pointer relocation instruction) and Targets to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal"></Highlight><Highlight kind="comment">// replace, computes a replacement, and affects it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253" lineLink="#a9364799319bac519aa565ec882986e6d"><Highlight kind="normal"><a href="#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a>(<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;RelocatedBase,</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;GCRelocateInst &#42;&gt;</a> &amp;Targets) &#123;</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We must ensure the relocation of derived pointer is defined after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// relocation of base pointer. If we find a relocation corresponding to base</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// defined earlier than relocation of base then we move relocation of base</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// right before found relocation. We consider only relocation in the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// basic block as relocation of base. Relocations from other basic block will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be skipped by optimization and we do not care about them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> R = RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstInsertionPt();</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">       &amp;&#42;R != RelocatedBase; ++R)</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCRelocateInst&gt;</a>(R))</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RI-&gt;getStatepoint() == RelocatedBase-&gt;<a href="/docs/api/classes/llvm/gcprojectioninst/#a6cffcfabac72ca61185ea24c1208b937">getStatepoint</a>())</Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RI-&gt;getBasePtrIndex() == RelocatedBase-&gt;<a href="/docs/api/classes/llvm/gcrelocateinst/#ae33641b6538b4ab4f3aa3dad2926860f">getBasePtrIndex</a>()) &#123;</Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">          RelocatedBase-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(RI-&gt;getIterator());</Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">          MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;ToReplace : Targets) &#123;</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ToReplace-&gt;getBasePtrIndex() == RelocatedBase-&gt;<a href="/docs/api/classes/llvm/gcrelocateinst/#ae33641b6538b4ab4f3aa3dad2926860f">getBasePtrIndex</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Not relocating a derived object of the original base object&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ToReplace-&gt;getBasePtrIndex() == ToReplace-&gt;getDerivedPtrIndex()) &#123;</Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// A duplicate relocate call. TODO: coalesce duplicates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != ToReplace-&gt;getParent()) &#123;</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Base and derived relocates are in different basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// In this case transform is only valid when base dominates derived</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// relocate. However it would be too expensive to check dominance</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// for each such relocate, so we skip the whole transformation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = ToReplace-&gt;getBasePtr();</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Derived = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(ToReplace-&gt;getDerivedPtr());</Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Derived || Derived-&gt;getPointerOperand() != <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> OffsetV;</Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a>(Derived, OffsetV))</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create a Builder and replace the target callsite with a gep</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Should always have one since it&#39;s not a terminator&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Insert after RelocatedBase</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(ToReplace-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If gc&#95;relocate does not match the actual type, cast it to the right type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In theory, there must be a bitcast after gc&#95;relocate if the type does not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// match, and we should reuse it to get the derived pointer. But it could be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cases like this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bb1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  %g1 = call coldcc i8 addrspace(1)&#42;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  @llvm.experimental.gc.relocate.p1i8(...) br label %merge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bb2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  %g2 = call coldcc i8 addrspace(1)&#42;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  @llvm.experimental.gc.relocate.p1i8(...) br label %merge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// merge:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  %p1 = phi i8 addrspace(1)&#42; &#91; %g1, %bb1 &#93;, &#91; %g2, %bb2 &#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  %cast = bitcast i8 addrspace(1)&#42; %p1 in to i32 addrspace(1)&#42;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In this case, we can not find the bitcast any more. So we insert a new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bitcast no matter there is already one or not. In this way, we can handle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// all cases, and the extra bitcast should be optimized away in later</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// passes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ActualRelocatedBase = RelocatedBase;</Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RelocatedBase-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType()) &#123;</Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal">      ActualRelocatedBase =</Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(RelocatedBase, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Replacement =</Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(Derived-&gt;getSourceElementType(), ActualRelocatedBase,</Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">                          <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>(OffsetV));</Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal">    Replacement-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(ToReplace);</Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the newly generated derived pointer&#39;s type does not match the original</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// derived pointer&#39;s type, cast the new derived pointer to match it. Same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reasoning as above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ActualReplacement = Replacement;</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Replacement-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != ToReplace-&gt;getType()) &#123;</Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">      ActualReplacement =</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Replacement, ToReplace-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">    ToReplace-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ActualReplacement);</Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">    ToReplace-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Turns this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %base = ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %ptr = gep %base + 15</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %tok = statepoint (%fun, i32 0, i32 0, i32 0, %base, %ptr)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %base&#39; = relocate(%tok, i32 4, i32 4)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %ptr&#39; = relocate(%tok, i32 4, i32 5)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %val = load %ptr&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal"></Highlight><Highlight kind="comment">// into this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %base = ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %ptr = gep %base + 15</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %tok = statepoint (%fun, i32 0, i32 0, i32 0, %base, %ptr)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %base&#39; = gc.relocate(%tok, i32 4, i32 4)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %ptr&#39; = gep %base&#39; + 15</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %val = load %ptr&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::simplifyOffsetableRelocate(<a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GCRelocateInst &#42;, 2&gt;</a> AllRelocateCalls;</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users())</Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;Relocate = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCRelocateInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Collect all the relocate calls associated with a statepoint</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">      AllRelocateCalls.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Relocate);</Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need at least one base pointer relocation + one derived pointer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// relocation to mangle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllRelocateCalls.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; 2)</Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// RelocateInstMap is a mapping from the base relocate instruction to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// corresponding derived relocate instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;GCRelocateInst &#42;, SmallVector&lt;GCRelocateInst &#42;, 0&gt;</a>&gt; RelocateInstMap;</Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">  <a href="#a8f5b32a03cc4a6072855d8c8cf7c748f">computeBaseDerivedRelocateMap</a>(AllRelocateCalls, RelocateInstMap);</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RelocateInstMap.<a href="/docs/api/classes/llvm/mapvector/#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Item : RelocateInstMap)</Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Item.first is the RelocatedBase to offset against</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Item.second is the vector of Targets to replace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">    MadeChange = <a href="#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a>(Item.first, Item.second);</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="comment">/// Sink the specified cast instruction into its user blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397" lineLink="#a3cc8a3a2506bf528398d0aef0850f31a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CI) &#123;</Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefBB = CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="comment">  /// InsertedCasts - Only insert a cast in each block once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, CastInst &#42;&gt;</a> InsertedCasts;</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = CI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = CI-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>();</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Figure out which BB this cast is used in.  For PHI&#39;s this is the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// appropriate predecessor block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal">      UserBB = PN-&gt;getIncomingBlock(TheUse);</Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Preincrement use iterator so we don&#39;t invalidate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">    ++UI;</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The first insertion point of a block containing an EH pad is after the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// pad.  If the pad is the user, we cannot sink the cast past the pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the block selected to receive the cast is an EH pad that does not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// allow non-PHI instructions before the terminator, we can&#39;t sink the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a5d3d315f678bc76e43b27d18e5d72829">isEHPad</a>())</Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this user is in the same block as the cast, don&#39;t change the cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB == DefBB)</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have already inserted a cast into this block, use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;&amp;InsertedCast = InsertedCasts&#91;UserBB&#93;;</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsertedCast) &#123;</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal">      InsertedCast = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal">      InsertedCast-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace a use of the cast with a use of the new cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">    TheUse = InsertedCast;</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">    ++NumCastUses;</Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we removed all uses, nuke the cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(&#42;CI);</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">    CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="comment">/// If the specified cast instruction is a noop copy (e.g. it&#39;s casting from</Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="comment">/// one pointer type to another, i32-&gt;i8 on PPC), sink it into user blocks to</Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="comment">/// reduce the number of virtual registers that must be created and coalesced.</Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="comment">/// Return true if any changes are made.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465" lineLink="#a3b82cff474790446f1288f1a086c1cd6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sink only &quot;cheap&quot; (or nop) address-space casts.  This is a weaker condition</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// than sinking only nop casts, but is helpful on some platforms.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ASC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AddrSpaceCastInst&gt;</a>(CI)) &#123;</Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a8e1c8a5721df02cd26c1ffd04320b02c">isFreeAddrSpaceCast</a>(ASC-&gt;getSrcAddressSpace(),</Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal">                                 ASC-&gt;getDestAddressSpace()))</Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is a noop copy,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/evt">EVT</a> SrcVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/evt">EVT</a> DstVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is an fp&lt;-&gt;int conversion?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcVT.<a href="/docs/api/structs/llvm/evt/#af975bf04c49cc895cfe38e7dc126a2f1">isInteger</a>() != DstVT.<a href="/docs/api/structs/llvm/evt/#af975bf04c49cc895cfe38e7dc126a2f1">isInteger</a>())</Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is an extension, it will be a zero or sign extension, which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// isn&#39;t a noop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcVT.<a href="/docs/api/structs/llvm/evt/#a3bf257bfbd279ecfad670be03b00210e">bitsLT</a>(DstVT))</Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If these values will be promoted, find out what they will be promoted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to.  This helps us consider truncates on PPC as noop copies when they</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// are.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#ad859786d7e54bdc5c568ac20c69816e0">getTypeAction</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SrcVT) ==</Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/targetloweringbase/#a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d">TargetLowering::TypePromoteInteger</a>)</Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">    SrcVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a77f7add8733417370a56154e8b560617">getTypeToTransformTo</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SrcVT);</Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#ad859786d7e54bdc5c568ac20c69816e0">getTypeAction</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), DstVT) ==</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/targetloweringbase/#a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d">TargetLowering::TypePromoteInteger</a>)</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal">    DstVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a77f7add8733417370a56154e8b560617">getTypeToTransformTo</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), DstVT);</Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If, after promotion, these are the same types, this is a noop copy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcVT != DstVT)</Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(CI);</Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Match a simple increment by constant operation.  Note that if a sub is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal"></Highlight><Highlight kind="comment">// matched, the step is negated (as if the step had been canonicalized to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal"></Highlight><Highlight kind="comment">// an add, even though we leave the instruction alone.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508" lineLink="#a9f54e95337782bd4fb335dd547c05ecc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVInc, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp;Step) &#123;</Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step))) ||</Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#a445051c482340bacd1e3264406421afb">m&#95;ExtractValue&lt;0&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::uadd&#95;with&#95;overflow&gt;</a>(</Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">                       <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step)))))</Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step))) ||</Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#a445051c482340bacd1e3264406421afb">m&#95;ExtractValue&lt;0&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::usub&#95;with&#95;overflow&gt;</a>(</Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">                       <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step))))) &#123;</Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal">    Step = <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(Step);</Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="comment">/// If given \\p PN is an inductive variable with value IVInc coming from the</Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="comment">/// backedge, and on each iteration it gets increased by Step, return pair</Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="comment">/// &lt;IVInc, Step&gt;. Otherwise, return std::nullopt.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;std::pair&lt;Instruction &#42;, Constant &#42;&gt;&gt;</Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527" lineLink="#a50cfddd4c98e75ef287c16996698dc1c"><Highlight kind="normal"><a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI) &#123;</Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!L || L-&gt;getHeader() != PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() || !L-&gt;getLoopLatch())</Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IVInc =</Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopLatch()));</Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IVInc || LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(IVInc-&gt;getParent()) != L)</Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Step = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a>(IVInc, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, Step) &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == PN)</Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(IVInc, Step);</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542" lineLink="#ab0f1e7b38e65d10c01900bd4d458a03b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI) &#123;</Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Step = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, Step))</Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IVInc = <a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(PN, LI))</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IVInc-&gt;first == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::replaceMathCmpWithIntrinsic(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO,</Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">                                                 <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg0, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg1,</Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">                                                 <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">                                                 <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID) &#123;</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsReplacableIVIncrement = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, &amp;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>&#93;(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO) &#123;</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(BO, LI))</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a> = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;L should not be null after isIVIncrement()&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do not risk on moving increment into a child loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent()) != L)</Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Finally, we need to ensure that the insert point will dominate all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// existing uses of the increment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DT = getDT(&#42;BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent());</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent(), BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we&#39;re moving up the dom tree, all uses are trivially dominated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// (This is the common case for code produced by LSR.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, special case the single use in the phi recurrence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BO-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent(), <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch());</Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent() &amp;&amp; !IsReplacableIVIncrement(BO)) &#123;</Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We used to use a dominator tree here to allow multi-block optimization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// But that was problematic because:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 1 It could cause a perf regression by hoisting the math op into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    critical path.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 2 It could cause a perf regression by creating a value that was live</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    across multiple blocks and increasing register pressure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 3 Use of a dominator tree could cause large compile-time regression.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    This is because we recompute the DT on every change in the main CGP</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    run-loop. The recomputing is probably unnecessary in many cases, so if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    that was fixed, using a DT here would be ok.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// There is one important particular case we still want to handle: if BO is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the IV increment. Important properties that make it profitable:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// - We can speculate IV increment anywhere in the loop (as long as the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   indvar Phi is its only user);</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// - Upon computing Cmp, we effectively compute something equivalent to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   IV increment (despite it loops differently in the IR). So moving it up</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   to the cmp point does not really increase register pressure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We allow matching the canonical IR (add X, C) back to (usubo X, -C).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::Add &amp;&amp;</Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="normal">      IID == Intrinsic::usub&#95;with&#95;overflow) &#123;</Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Arg1) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected input for usubo&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="normal">    Arg1 = <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(Arg1));</Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert at the first instruction of the pair.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Iter : &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent()) &#123;</Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If BO is an XOR, it is not guaranteed that it comes after both inputs to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the overflow intrinsic are defined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::Xor &amp;&amp; &amp;Iter == BO) || &amp;Iter == Cmp) &#123;</Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal">      InsertPt = &amp;<a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a>;</Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Parent block did not contain cmp or binop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertPt);</Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MathOV = Builder.CreateBinaryIntrinsic(IID, Arg0, Arg1);</Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::Xor) &#123;</Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Math = Builder.CreateExtractValue(MathOV, 0, </Highlight><Highlight kind="stringliteral">&quot;math&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(BO, Math, FreshBBs, IsHugeFunc);</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BO-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Patterns with XOr should use the BO only in the compare&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;OV = Builder.CreateExtractValue(MathOV, 1, </Highlight><Highlight kind="stringliteral">&quot;ov&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, OV, FreshBBs, IsHugeFunc);</Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="normal">  BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="comment">/// Match special-case patterns that check for unsigned add overflow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638" lineLink="#af23979229be4fb2286896bf920e3e235"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>) &#123;</Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add = add A, 1; Cmp = icmp eq A,-1 (overflow if A is max val)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add = add A,-1; Cmp = icmp ne A, 0 (overflow if A is non-zero)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = Cmp-&gt;getOperand(0), &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Cmp-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are not expecting non-canonical/degenerate code. Just bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a00ef056813d120034e387417e9cde341">m&#95;AllOnes</a>()))</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = ConstantInt::get(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType(), 1);</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>()))</Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the users of the variable operand of the compare looking for an add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with the adjusted constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="comment">/// Try to combine the compare into a call to the llvm.uadd.with.overflow</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="comment">/// intrinsic. Return true if any changes were made.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::combineToUAddWithOverflow(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="normal">                                               ModifyDT &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EdgeCase = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>;</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp, <a href="/docs/api/namespaces/llvm/patternmatch/#ac8279fa9b06f9d5a57ccc0b71252c260">m&#95;UAddWithOverflow</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>)))) &#123;</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a>(Cmp, <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>))</Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Set A and B in case we match matchUAddWithOverflowConstantEdgeCases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal">    EdgeCase = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a1b6f74fbe8b15567434fa5d20a540c5c">shouldFormOverflowOp</a>(<a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a1ddf36330110b4abea43fe390bea9ef9">ISD::UADDO</a>,</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">                                 TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getType()),</Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;hasNUsesOrMore(EdgeCase ? 1 : 2)))</Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We don&#39;t want to move around uses of condition values this late, so we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// check if it is legal to create the call to the intrinsic in the basic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block containing the icmp.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getParent() != <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!replaceMathCmpWithIntrinsic(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, Cmp,</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal">                                   Intrinsic::uadd&#95;with&#95;overflow))</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reset callers - do not crash by iterating over a dead instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">  ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyDT::ModifyInstDT</a>;</Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::combineToUSubWithOverflow(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal">                                               ModifyDT &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are not expecting non-canonical/degenerate code. Just bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0), &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))</Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Convert (A u&gt; B) to (A u&lt; B) to simplify pattern matching.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate();</Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>) &#123;</Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Convert special-case: (A == 0) is the same as (A u&lt; 1).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>())) &#123;</Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = ConstantInt::get(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType(), 1);</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Convert special-case: (A != 0) is the same as (0 u&lt; A).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>())) &#123;</Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>)</Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk the users of a variable operand of a compare looking for a subtract or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// add with that same operand. Also match the 2nd operand of the compare to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the add/sub, but that may be a negated constant operand of an add.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpVariableOperand = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) ? <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Sub = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CmpVariableOperand-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A - B, A u&lt; B --&gt; usubo(A, B)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">      Sub = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A + (-C), A u&lt; C (canonicalized form of (sub A, C))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;CmpC, &#42;AddC;</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(AddC))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(CmpC)) &amp;&amp; &#42;AddC == -(&#42;CmpC)) &#123;</Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal">      Sub = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Sub)</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a1b6f74fbe8b15567434fa5d20a540c5c">shouldFormOverflowOp</a>(<a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a4ffc75d65231b55461c0ba4f36a3e500">ISD::USUBO</a>,</Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal">                                 TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Sub-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()),</Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">                                 Sub-&gt;<a href="/docs/api/classes/llvm/value/#a72fb137716cff838d389e392b9729dc9">hasNUsesOrMore</a>(1)))</Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!replaceMathCmpWithIntrinsic(Sub, Sub-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Sub-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1),</Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">                                   Cmp, Intrinsic::usub&#95;with&#95;overflow))</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reset callers - do not crash by iterating over a dead instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal">  ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyDT::ModifyInstDT</a>;</Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="comment">/// Sink the given CmpInst into user blocks to reduce the number of virtual</Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="comment">/// registers that must be created and coalesced. This is a clear win except on</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="comment">/// targets with multiple condition code registers (PowerPC), where it might</Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="comment">/// lose; some adjustment may be wanted there.</Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="comment">/// Return true if any changes are made.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772" lineLink="#a24a3e4aad4cb2fdde7ce294a531cd52a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa00abc9ed22bfa32ebd68531b619b005">hasMultipleConditionRegisters</a>())</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Avoid sinking soft-FP comparisons, since this can move them into a loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aca632fc83dfd8f23f3456ef50a49e31a">useSoftFloat</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FCmpInst&gt;</a>(Cmp))</Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only insert a cmp in each block once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, CmpInst &#42;&gt;</a> InsertedCmps;</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = Cmp-&gt;user&#95;begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Cmp-&gt;user&#95;end();</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="normal">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Preincrement use iterator so we don&#39;t invalidate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal">    ++UI;</Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t bother for PHI nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Figure out which BB this cmp is used in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefBB = Cmp-&gt;getParent();</Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this user is in the same block as the cmp, don&#39;t change the cmp.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB == DefBB)</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have already inserted a cmp into this block, use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;&amp;InsertedCmp = InsertedCmps&#91;UserBB&#93;;</Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsertedCmp) &#123;</Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="normal">      InsertedCmp = <a href="/docs/api/classes/llvm/cmpinst/#a62e2cf3675b93f0e6c07a4a00852f7cd">CmpInst::Create</a>(Cmp-&gt;getOpcode(), Cmp-&gt;getPredicate(),</Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal">                                    Cmp-&gt;getOperand(0), Cmp-&gt;getOperand(1), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="normal">      InsertedCmp-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Propagate the debug info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal">      InsertedCmp-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Cmp-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace a use of the cmp with a use of the new cmp.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">    TheUse = InsertedCmp;</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">    ++NumCmpUses;</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we removed all uses, nuke the cmp.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Cmp-&gt;use&#95;empty()) &#123;</Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">    Cmp-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="comment">/// For pattern like:</Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="comment">///   DomCond = icmp sgt/slt CmpOp0, CmpOp1 (might not be in DomBB)</Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="comment">///   ...</Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="comment">/// DomBB:</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="comment">///   ...</Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="comment">///   br DomCond, TrueBB, CmpBB</Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="comment">/// CmpBB: (with DomBB being the single predecessor)</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="comment">///   ...</Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="comment">///   Cmp = icmp eq CmpOp0, CmpOp1</Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="comment">///   ...</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="comment">/// It would use two comparison on targets that lowering of icmp sgt/slt is</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="comment">/// different from lowering of icmp eq (PowerPC). This function try to convert</Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="comment">/// &#39;Cmp = icmp eq CmpOp0, CmpOp1&#39; to &#39; Cmp = icmp slt/sgt CmpOp0, CmpOp1&#39;.</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="comment">/// After that, DomCond and Cmp can use the same comparison so reduce one</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="comment">/// comparison.</Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="comment">/// Return true if any changes are made.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851" lineLink="#a98c59bcf49cb7343886e8f425d6d877b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#aa667cc0d6f6fc39b8d40b9b9828b81bb">EnableICMP&#95;EQToICMP&#95;ST</a> &amp;&amp; TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a18c621c39394892e502cf03313e04bf7">isEqualityCmpFoldedWithSignedCmp</a>())</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If icmp eq has users other than BranchInst and SelectInst, converting it to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// icmp slt/sgt would introduce more redundant LLVM IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Cmp-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(U) &amp;&amp; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(U)-&gt;getCondition() == Cmp)</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is a cheap/incomplete check for dominance - just match a single</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessor with a conditional branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CmpBB = Cmp-&gt;getParent();</Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DomBB = CmpBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DomBB)</Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We want to ensure that the only way control gets to the comparison of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// interest is that a less/greater than comparison on the same operands is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;DomCond;</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB, &#42;FalseBB;</Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(DomBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a811d001fa503a556ac2a48d64366500f">m&#95;Br</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(DomCond), TrueBB, FalseBB)))</Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CmpBB != FalseBB)</Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpOp0 = Cmp-&gt;getOperand(0), &#42;CmpOp1 = Cmp-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> DomPred;</Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(DomCond, <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(DomPred, <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(CmpOp0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(CmpOp1))))</Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DomPred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">ICmpInst::ICMP&#95;SGT</a> &amp;&amp; DomPred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP&#95;SLT</a>)</Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Convert the equality comparison to the opposite of the dominating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// comparison and swap the direction for all branch/select users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We have conceptually converted:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Res = (a &lt; b) ? &lt;LT&#95;RES&gt; : (a == b) ? &lt;EQ&#95;RES&gt; : &lt;GT&#95;RES&gt;;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Res = (a &lt; b) ? &lt;LT&#95;RES&gt; : (a &gt; b)  ? &lt;GT&#95;RES&gt; : &lt;EQ&#95;RES&gt;;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// And similarly for branches.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Cmp-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must be conditional&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Swap operands</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;swapValues();</Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;swapProfMetadata();</Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Must be a branch or a select&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">  Cmp-&gt;setPredicate(<a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(DomPred));</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="comment">/// Many architectures use the same instruction for both subtract and cmp. Try</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="comment">/// to swap cmp operands to match subtract operations to allow for CSE.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921" lineLink="#a3fb33a8a29e076405285e5282eba81fd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a3fb33a8a29e076405285e5282eba81fd">swapICmpOperandsToExposeCSEOpportunities</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp) &#123;</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Cmp-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op1 = Cmp-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Op0) ||</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Op1) || Op0 == Op1)</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If a subtract already has the same operands as a compare, swapping would be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bad. If a subtract has the same operands as a compare but in reverse order,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// then swapping is good.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> GoodToSwap = 0;</Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumInspected = 0;</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : Op0-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Avoid walking many users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (++NumInspected &gt; 128)</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op1), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op0))))</Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal">      GoodToSwap++;</Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op1))))</Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">      GoodToSwap--;</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GoodToSwap &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">    Cmp-&gt;swapOperands();</Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950" lineLink="#a1f580ab00002a65787ab52ef2aa9a439"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a1f580ab00002a65787ab52ef2aa9a439">foldFCmpToFPClassTest</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/fcmpinst">FCmpInst</a> &#42;FCmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FCmpInst&gt;</a>(Cmp);</Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FCmp)</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t fold if the target offers free fabs and the predicate is legal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/evt">EVT</a> VT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Cmp-&gt;getOperand(0)-&gt;getType());</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#af4dac2cd51ca7d7082cabfba3f81dd27">isFAbsFree</a>(VT) &amp;&amp;</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">      TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a7ddfa7ca92088dcd1b6c8936bca6917a">isCondCodeLegal</a>(<a href="/docs/api/namespaces/llvm/#a8b3a8b47a5344da71953bc4eb38c5179">getFCmpCondCode</a>(FCmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>()),</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal">                          VT.<a href="/docs/api/structs/llvm/evt/#a6a81c1cc06a00a0096d839032b5984e9">getSimpleVT</a>()))</Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reverse the canonicalization if it is a FP class test</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ShouldReverseTransform = &#91;&#93;(<a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1d">FPClassTest</a> ClassTest) &#123;</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ClassTest == <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1da00a4419741933f5cb7ec001aaa6e6bb5">fcInf</a> || ClassTest == (<a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1da00a4419741933f5cb7ec001aaa6e6bb5">fcInf</a> | <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1dafe1646e5477c571f7791c524b54b11fe">fcNan</a>);</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;ClassVal, ClassTest&#93; =</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac9ef7edd1261f6570677d850b5cf2cfc">fcmpToClassTest</a>(FCmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), &#42;FCmp-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent(),</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">                      FCmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), FCmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ClassVal)</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ShouldReverseTransform(ClassTest) &amp;&amp; !ShouldReverseTransform(~ClassTest))</Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Cmp);</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IsFPClass = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7fb2c76ce3457d7b38dcdfbe1d5fd051">createIsFPClass</a>(ClassVal, ClassTest);</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">  Cmp-&gt;replaceAllUsesWith(IsFPClass);</Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Cmp);</Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983" lineLink="#aaf468add8b9e6811a1643026e25eadb4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#aaf468add8b9e6811a1643026e25eadb4">isRemOfLoopIncrementWithLoopInvariant</a>(</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Rem, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;RemAmtOut, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;AddInstOut,</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;AddOffsetOut, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp;LoopIncrPNOut) &#123;</Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Incr, &#42;RemAmt;</Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NB: If RemAmt is a power of 2 it &#42;should&#42; have been transformed by now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Rem, <a href="/docs/api/namespaces/llvm/patternmatch/#a11e5bad6c60d5c3cc5e7881bddd0204d">m&#95;URem</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Incr), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(RemAmt))))</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;AddInst, &#42;AddOffset;</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find out loop increment PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Incr);</Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">    AddInst = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">    AddOffset = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Search through a NUW add on top of the loop increment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V0, &#42;V1;</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Incr, <a href="/docs/api/namespaces/llvm/patternmatch/#a0c7ef38b3e115873246f1d5e491d80c3">m&#95;NUWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1))))</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">    AddInst = Incr;</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">    PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V0);</Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal">      AddOffset = V1;</Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">      PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V1);</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal">      AddOffset = V0;</Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PN)</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This isn&#39;t strictly necessary, what we really need is one increment and any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// amount of initial values all being the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN-&gt;getNumIncomingValues() != 2)</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only trivially analyzable loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(PN-&gt;getParent());</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!L || !L-&gt;getLoopPreheader() || !L-&gt;getLoopLatch())</Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Req that the remainder is in the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!L-&gt;contains(Rem))</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only works if the remainder amount is a loop invaraint</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!L-&gt;isLoopInvariant(RemAmt))</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Is the PHI a loop increment?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> LoopIncrInfo = <a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(PN, LI);</Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopIncrInfo)</Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need remainder&#95;amount % increment&#95;amount to be zero. Increment of one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// satisfies that without any special logic and is overwhelmingly the common</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LoopIncrInfo-&gt;second, <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>()))</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Need the increment to not overflow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LoopIncrInfo-&gt;first, <a href="/docs/api/namespaces/llvm/patternmatch/#a33e25e1952cc74de88c6af4d687f404a">m&#95;c&#95;NUWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(PN), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set output variables.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">  RemAmtOut = RemAmt;</Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal">  LoopIncrPNOut = PN;</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">  AddInstOut = AddInst;</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal">  AddOffsetOut = AddOffset;</Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Try to transform:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal"></Highlight><Highlight kind="comment">// for(i = Start; i &lt; End; ++i)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    Rem = (i nuw+ IncrLoopInvariant) u% RemAmtLoopInvariant;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal"></Highlight><Highlight kind="comment">// -&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Rem = (Start nuw+ IncrLoopInvariant) % RemAmtLoopInvariant;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal"></Highlight><Highlight kind="comment">// for(i = Start; i &lt; End; ++i, ++rem)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    Rem = rem == RemAmtLoopInvariant ? 0 : Rem;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068" lineLink="#af950841a4443ffb7aff66ae75fee8442"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#af950841a4443ffb7aff66ae75fee8442">foldURemOfLoopIncrement</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Rem, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal">                                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">                                    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsHuge) &#123;</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;AddOffset, &#42;RemAmt, &#42;AddInst;</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;LoopIncrPN;</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#aaf468add8b9e6811a1643026e25eadb4">isRemOfLoopIncrementWithLoopInvariant</a>(Rem, LI, RemAmt, AddInst,</Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">                                             AddOffset, LoopIncrPN))</Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only non-constant remainder as the extra IV is probably not profitable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in that case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Potential TODO(1): &#96;urem&#96; of a const ends up as &#96;mul&#96; + &#96;shift&#96; + &#96;add&#96;. If</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we can rule out register pressure and ensure this &#96;urem&#96; is executed each</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// iteration, its probably profitable to handle the const case as well.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Potential TODO(2): Should we have a check for how &quot;nested&quot; this remainder</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operation is? The new code runs every iteration so if the remainder is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// guarded behind unlikely conditions this might not be worth it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RemAmt, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>()))</Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Start = LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopPreheader());</Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have add create initial value for remainder.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The logic here is:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (urem (add nuw Start, IncrLoopInvariant), RemAmtLoopInvariant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only proceed if the expression simplifies (otherwise we can&#39;t fully</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// optimize out the urem).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddInst) &#123;</Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AddOffset &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;We found an add but missing values&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Without dom-condition/assumption cache we aren&#39;t likely to get much out</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of a context instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">    Start = <a href="/docs/api/namespaces/llvm/#a5e0af1b16cab9e0efc63a6ce9de2b9cc">simplifyAddInst</a>(Start, AddOffset,</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal">                            <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(AddInst, <a href="/docs/api/namespaces/llvm/patternmatch/#ab65bddcf2ef369ad6d5678882800a7da">m&#95;NSWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())),</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal">                            </Highlight><Highlight kind="comment">/&#42;IsNUW=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Start)</Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we can&#39;t fully optimize out the &#96;rem&#96;, skip this transform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">  Start = <a href="/docs/api/namespaces/llvm/#aecb805c568634be3390c7da36836d63e">simplifyURemInst</a>(Start, RemAmt, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Start)</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create new remainder with induction variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = Rem-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Rem-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LoopIncrPN);</Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewRem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Ty, 2);</Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="normal">      LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopLatch())));</Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#96;(add (urem x, y), 1)&#96; is always nuw.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RemAdd = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a706649daecd068a72d8e06df2fd83549">CreateNUWAdd</a>(NewRem, ConstantInt::get(Ty, 1));</Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RemCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, RemAdd, RemAmt);</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RemSel =</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(RemCmp, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty), RemAdd);</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="normal">  NewRem-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Start, L-&gt;getLoopPreheader());</Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal">  NewRem-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(RemSel, L-&gt;getLoopLatch());</Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert all touched BBs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">  FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">  FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(L-&gt;getLoopLatch());</Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">  FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Rem-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddInst)</Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal">    FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AddInst)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>());</Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Rem, NewRem, FreshBBs, IsHuge);</Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal">  Rem-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddInst &amp;&amp; AddInst-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AddInst)-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeURem(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Rem) &#123;</Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#af950841a4443ffb7aff66ae75fee8442">foldURemOfLoopIncrement</a>(Rem, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, LI, FreshBBs, IsHugeFunc))</Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><Highlight kind="comment">/// Some targets have better codegen for &#96;ctpop(X) u&lt; 2&#96; than &#96;ctpop(X) == 1&#96;.</Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="comment">/// This function converts &#96;ctpop(X) ==/!= 1&#96; into &#96;ctpop(X) u&lt;/u&gt; 2/1&#96; if the</Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="comment">/// result cannot be zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155" lineLink="#a6536b980547806c6fb158add5334c3ab"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a6536b980547806c6fb158add5334c3ab">adjustIsPower2Test</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal">                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp, <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::ctpop&gt;</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>())))</Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">ICmpInst::isEquality</a>(Pred))</Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(Cmp-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>) &#123;</Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal">      Cmp-&gt;setOperand(1, ConstantInt::get(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getType(), 2));</Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">      Cmp-&gt;setPredicate(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>);</Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal">      Cmp-&gt;setPredicate(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>);</Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeCmp(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, ModifyDT &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a>(Cmp, &#42;TLI))</Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (combineToUAddWithOverflow(Cmp, ModifiedDT))</Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (combineToUSubWithOverflow(Cmp, ModifiedDT))</Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a>(Cmp, &#42;TLI))</Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a3fb33a8a29e076405285e5282eba81fd">swapICmpOperandsToExposeCSEOpportunities</a>(Cmp))</Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a1f580ab00002a65787ab52ef2aa9a439">foldFCmpToFPClassTest</a>(Cmp, &#42;TLI, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a6536b980547806c6fb158add5334c3ab">adjustIsPower2Test</a>(Cmp, &#42;TLI, &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="comment">/// Duplicate and sink the given &#39;and&#39; instruction into user blocks where it is</Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="comment">/// used in a compare to allow isel to generate better code for targets where</Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><Highlight kind="comment">/// this operation can be combined.</Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="comment">/// Return true if any changes are made.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207" lineLink="#a0049977ff1075a98e9f512bbf4d181a6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;AndI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="normal">                                  SetOfInstrs &amp;InsertedInsts) &#123;</Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Double-check that we&#39;re not trying to optimize an instruction that was</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// already optimized by some other part of this pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!InsertedInsts.count(AndI) &amp;&amp;</Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Attempting to optimize already optimized and instruction&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="normal">  (void)InsertedInsts;</Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Nothing to do for single use in same basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AndI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal">      AndI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;AndI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>())-&gt;getParent())</Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to avoid cases where sinking/duplicating is likely to increase register</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// pressure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)) &amp;&amp;</Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)) &amp;&amp;</Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal">      AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : AndI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only sink &#39;and&#39; feeding icmp with 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ICmpInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CmpC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CmpC || !CmpC-&gt;<a href="/docs/api/classes/llvm/apint/#a49cd5939942c6665aba4cae8c220dff1">isZero</a>())</Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a1f8d2859994eb10cdca39be26aa929bc">isMaskAndCmp0FoldingBeneficial</a>(&#42;AndI))</Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;found &#39;and&#39; feeding only icmp 0;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(AndI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;dump());</Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Push the &#39;and&#39; into the same block as the icmp 0  There should only be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one (icmp (and, 0)) in each block, since CSE/GVN should have removed any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// others, so we don&#39;t need to keep track of which BBs we insert into.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = AndI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = AndI-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>();</Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Preincrement use iterator so we don&#39;t invalidate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">    ++UI;</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;sinking &#39;and&#39; use: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/classes/llvm/user">User</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Keep the &#39;and&#39; in the same place if the use is already in the same block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt =</Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent() == AndI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() ? AndI : <a href="/docs/api/classes/llvm/user">User</a>;</Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertedAnd = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal">        Instruction::And, AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal">        InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Propagate the debug info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">    InsertedAnd-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(AndI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace a use of the &#39;and&#39; with a use of the new &#39;and&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal">    TheUse = InsertedAnd;</Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal">    ++NumAndUses;</Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent()-&gt;<a href="/docs/api/classes/llvm/value/#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>());</Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We removed all uses, nuke the and.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">  AndI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="comment">/// Check if the candidates could be combined with a shift instruction, which</Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="comment">/// includes:</Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="comment">/// 1 Truncate instruction</Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><Highlight kind="comment">/// 2 And instruction and the imm is a mask of the low bits:</Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="comment">/// imm &amp; (imm+1) == 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283" lineLink="#a19e2fd6fce422c4ab3cea555782abbb6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>) &#123;</Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;getOpcode() != Instruction::And ||</Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;Cimm = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))-&gt;getValue();</Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((Cimm &amp; (Cimm + 1)).getBoolValue())</Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="comment">/// Sink both shift and truncate instruction to the use of truncate&#39;s BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299" lineLink="#a0327169186859791aafa580e4fb547e2"><Highlight kind="normal"><a href="#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;ShiftI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI,</Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BinaryOperator &#42;&gt;</a> &amp;InsertedShifts,</Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, CastInst &#42;&gt;</a> InsertedTruncs;</Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;TruncI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;TruncInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> TruncUI = TruncI-&gt;user&#95;begin(),</Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="normal">                            TruncE = TruncI-&gt;user&#95;end();</Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="normal">       TruncUI != TruncE;) &#123;</Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TruncTheUse = TruncUI.getUse();</Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TruncUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;TruncUI);</Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Preincrement use iterator so we don&#39;t invalidate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="normal">    ++TruncUI;</Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> ISDOpcode = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a025e6664b2f55d2c217543c34eb1f64e">InstructionOpcodeToISD</a>(TruncUser-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ISDOpcode)</Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the use is actually a legal node, there will not be an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// implicit truncate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: always querying the result type is just an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// approximation; some nodes&#39; legality is determined by the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// operand or other means. There&#39;s no good way to find out though.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(</Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal">            ISDOpcode, TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TruncUser-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">)))</Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t bother for PHI nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(TruncUser))</Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TruncUserBB = TruncUser-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB == TruncUserBB)</Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp;InsertedShift = InsertedShifts&#91;TruncUserBB&#93;;</Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;&amp;InsertedTrunc = InsertedTruncs&#91;TruncUserBB&#93;;</Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsertedShift &amp;&amp; !InsertedTrunc) &#123;</Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Sink the shift</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShiftI-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr)</Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal">        InsertedShift =</Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal">            BinaryOperator::CreateAShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal">        InsertedShift =</Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><Highlight kind="normal">            BinaryOperator::CreateLShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(ShiftI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;TruncUserBB, InsertPt);</Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Sink the trunc</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> TruncInsertPt = TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><Highlight kind="normal">      TruncInsertPt++;</Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It will go ahead of any debug-info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><Highlight kind="normal">      TruncInsertPt.setHeadBit(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TruncInsertPt != TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="normal">      InsertedTrunc = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(TruncI-&gt;getOpcode(), InsertedShift,</Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><Highlight kind="normal">                                       TruncI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="normal">      InsertedTrunc-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;TruncUserBB, TruncInsertPt);</Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="normal">      InsertedTrunc-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(TruncI-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">      MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal">      TruncTheUse = InsertedTrunc;</Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="comment">/// Sink the shift &#42;right&#42; instruction into user blocks if the uses could</Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="comment">/// potentially be combined with this shift instruction and generate BitExtract</Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="comment">/// instruction. It will only be applied if the architecture supports BitExtract</Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><Highlight kind="comment">/// instruction. Here is an example:</Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="comment">/// BB1:</Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="comment">///   %x.extract.shift = lshr i64 %arg1, 32</Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="comment">/// BB2:</Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="comment">///   %x.extract.trunc = trunc i64 %x.extract.shift to i16</Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="comment">/// ==&gt;</Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><Highlight kind="comment">/// BB2:</Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="comment">///   %x.extract.shift.1 = lshr i64 %arg1, 32</Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="comment">///   %x.extract.trunc = trunc i64 %x.extract.shift.1 to i16</Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><Highlight kind="comment">/// CodeGen will recognize the pattern in BB2 and generate BitExtract</Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="comment">/// instruction.</Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="comment">/// Return true if any changes are made.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392" lineLink="#a2c05548feac70b16d31caf0cfb225714"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;ShiftI, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI,</Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal">                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefBB = ShiftI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="comment">  /// Only insert instructions in each block once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BinaryOperator &#42;&gt;</a> InsertedShifts;</Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> shiftIsLegal = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>();</Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Preincrement use iterator so we don&#39;t invalidate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><Highlight kind="normal">    ++UI;</Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t bother for PHI nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a>(<a href="/docs/api/classes/llvm/user">User</a>))</Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB == DefBB) &#123;</Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the shift and truncate instruction are in the same BB. The use of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the truncate(TruncUse) may still introduce another truncate if not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// legal. In this case, we would like to sink both shift and truncate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// instruction to the BB of TruncUse.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// for example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// BB1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// i64 shift.result = lshr i64 opnd, imm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// trunc.result = trunc shift.result to i16</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// BB2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   ----&gt; We will have an implicit truncate here if the architecture does</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   not have i16 compare.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// cmp i16 trunc.result, opnd2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal">          shiftIsLegal</Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// If the type of the truncate is legal, no truncate will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// introduced in other basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">          &amp;&amp; (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))))</Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal">        MadeChange =</Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal">            <a href="#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a>(ShiftI, <a href="/docs/api/classes/llvm/user">User</a>, CI, InsertedShifts, TLI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have already inserted a shift into this block, use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp;InsertedShift = InsertedShifts&#91;UserBB&#93;;</Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsertedShift) &#123;</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShiftI-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr)</Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><Highlight kind="normal">        InsertedShift =</Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="normal">            BinaryOperator::CreateAShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="normal">        InsertedShift =</Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="normal">            BinaryOperator::CreateLShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><Highlight kind="normal">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="normal">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(ShiftI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><Highlight kind="normal">      MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace a use of the shift with a use of the new shift.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">    TheUse = InsertedShift;</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we removed all uses, or there are none, nuke the shift.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(&#42;ShiftI);</Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal">    ShiftI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="comment">/// If counting leading or trailing zeros is an expensive operation and a zero</Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="comment">/// input is defined, add a check for zero to avoid calling the intrinsic.</Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="comment">/// We want to transform:</Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="comment">///     %z = call i64 @llvm.cttz.i64(i64 %A, i1 false)</Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="comment">/// into:</Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="comment">///   entry:</Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="comment">///     %cmpz = icmp eq i64 %A, 0</Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="comment">///     br i1 %cmpz, label %cond.end, label %cond.false</Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="comment">///   cond.false:</Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="comment">///     %z = call i64 @llvm.cttz.i64(i64 %A, i1 true)</Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="comment">///     br label %cond.end</Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="comment">///   cond.end:</Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="comment">///     %ctz = phi i64 &#91; 64, %entry &#93;, &#91; %z, %cond.false &#93;</Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><Highlight kind="comment">/// If the transform is performed, return true and set ModifiedDT to true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494" lineLink="#adfad68845808cb6acd116e50b15bc281"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#adfad68845808cb6acd116e50b15bc281">despeculateCountZeros</a>(<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;CountZeros,</Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI,</Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42;TLI,</Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ModifyDT &amp;ModifiedDT,</Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="normal">                                  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsHugeFunc) &#123;</Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If a zero input is undefined, it doesn&#39;t make sense to despeculate that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CountZeros-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>()))</Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If it&#39;s cheap to speculate, there&#39;s nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = CountZeros-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IntrinsicID = CountZeros-&gt;<a href="/docs/api/classes/llvm/intrinsicinst/#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>();</Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((IntrinsicID == Intrinsic::cttz &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a42e6689af9067a1afe64eac0267deb01">isCheapToSpeculateCttz</a>(Ty)) ||</Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">      (IntrinsicID == Intrinsic::ctlz &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#abe9a0c5ce415f4e7498d75deb8de0896">isCheapToSpeculateCtlz</a>(Ty)))</Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only handle legal scalar cases. Anything else requires too much work.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SizeInBits = Ty-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ty-&gt;isVectorTy() || SizeInBits &gt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getLargestLegalIntTypeSizeInBits())</Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bail if the value is never zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = CountZeros-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(0);</Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The intrinsic will be sunk behind a compare against zero and branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;StartBlock = CountZeros-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CallBlock = StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CountZeros, </Highlight><Highlight kind="stringliteral">&quot;cond.false&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsHugeFunc)</Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal">    FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(CallBlock);</Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create another block after the count zero intrinsic. A PHI will be added</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in this block to select the result of the intrinsic or the bit-width</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constant if the input to the intrinsic is zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SplitPt = std::next(<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(CountZeros));</Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Any debug-info after CountZeros should not be included.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal">  SplitPt.setHeadBit(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBlock = CallBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(SplitPt, </Highlight><Highlight kind="stringliteral">&quot;cond.end&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsHugeFunc)</Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="normal">    FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(EndBlock);</Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the LoopInfo. The new blocks are in the same loop as the start</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI.<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(StartBlock)) &#123;</Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">    L-&gt;addBasicBlockToLoop(CallBlock, LI);</Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal">    L-&gt;addBasicBlockToLoop(EndBlock, LI);</Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set up a builder to create a compare, conditional branch, and PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CountZeros-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(CountZeros-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the unconditional branch that was created by the first split with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a compare against zero and a conditional branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Zero = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty);</Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Avoid introducing branch on poison. This also replaces the ctz operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a563ec77bbc82ad22aab9621dd14c01cd">CreateFreeze</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.fr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, Zero, </Highlight><Highlight kind="stringliteral">&quot;cmpz&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(Cmp, EndBlock, CallBlock);</Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><Highlight kind="normal">  StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a PHI in the end block to select either the output of the intrinsic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// or the bit width of the operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EndBlock, EndBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Ty, 2, </Highlight><Highlight kind="stringliteral">&quot;ctz&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(CountZeros, PN, FreshBBs, IsHugeFunc);</Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7c8f643db1fdc579f1aa5320c7a0398">getInt</a>(<a href="/docs/api/classes/llvm/apint">APInt</a>(SizeInBits, SizeInBits));</Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal">  PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, StartBlock);</Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal">  PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(CountZeros, CallBlock);</Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are explicitly handling the zero case, so we can set the intrinsic&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// undefined zero argument to &#39;true&#39;. This will also prevent reprocessing the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// intrinsic; we only despeculate when a zero input is defined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal">  CountZeros-&gt;<a href="/docs/api/classes/llvm/callbase/#abc10b887caad109288ffceb230493a85">setArgOperand</a>(1, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a42ce8aa34864a9d974958b9d3d36ad17">getTrue</a>());</Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal">  ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>;</Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeCallInst(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, ModifyDT &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Lower inline assembly if we can.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we found an inline asm expession, and if the target knows how to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lower it to normal LLVM code, do so now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a018f0394a375233d538109968b76a05a">isInlineAsm</a>()) &#123;</Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#aa394506e609b72337e9c664ef264db8b">ExpandInlineAsm</a>(CI)) &#123;</Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Avoid invalidating the iterator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">      CurInstIterator = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Avoid processing instructions out of order, which could cause</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// reuse before a value is defined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal">      SunkAddrs.<a href="/docs/api/classes/llvm/valuemap/#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Sink address computing for memory operands into the block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (optimizeInlineAsmInst(CI))</Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Align the pointer arguments to this call if the target thinks it&#39;s a good</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// idea</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MinSize;</Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/align">Align</a> PrefAlign;</Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#ae4b84d0bc1e6fcb979dc8bb641b74ae9">shouldAlignPointerArgs</a>(CI, MinSize, PrefAlign)) &#123;</Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Arg : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>()) &#123;</Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We want to align both objects whose address is used directly and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// objects whose address is used in casts and GEPs, though it only makes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// sense for GEPs if the offset is a multiple of the desired alignment and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// if size - offset meets the size threshold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Arg-&gt;getType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexSizeInBits(</Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">                       <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PointerType&gt;</a>(Arg-&gt;getType())-&gt;getAddressSpace()),</Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal">                   0);</Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = Arg-&gt;<a href="/docs/api/classes/llvm/value/#a14f27b1cef50a1f887650a8c79dbb436">stripAndAccumulateInBoundsConstantOffsets</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal">      uint64&#95;t Offset2 = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getLimitedValue();</Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a25f1d7ccf87af8d87fcb950f7ed758b5">isAligned</a>(PrefAlign, Offset2))</Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI;</Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(Val)) &amp;&amp; AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>() &lt; PrefAlign &amp;&amp;</Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSize(AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>()) &gt;= MinSize + Offset2)</Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal">        AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(PrefAlign);</Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Global variables can only be aligned if they are defined in this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// object (i.e. they are uniquely initialized in this object), and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// over-aligning global variables that have an explicit section is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// forbidden.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV;</Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((GV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(Val)) &amp;&amp; GV-&gt;<a href="/docs/api/classes/llvm/globalobject/#af3c010276b401e92a124e50fcef97fe1">canIncreaseAlignment</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal">          GV-&gt;<a href="/docs/api/classes/llvm/value/#a47f5c74e1b14ba4a61db057400644acc">getPointerAlignment</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &lt; PrefAlign &amp;&amp;</Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSize(GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()) &gt;= MinSize + Offset2)</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="normal">        GV-&gt;<a href="/docs/api/classes/llvm/globalobject/#a49b398b1c83ef4d42c8f7756b443f61f">setAlignment</a>(PrefAlign);</Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is a memcpy (or similar) then we may be able to improve the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/memintrinsic">MemIntrinsic</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemIntrinsic&gt;</a>(CI)) &#123;</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/align">Align</a> DestAlign = <a href="/docs/api/namespaces/llvm/#a607b7fac55adc5ea9ed40a78e48a5b00">getKnownAlignment</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDest(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> MIDestAlign = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDestAlign();</Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MIDestAlign || DestAlign &gt; &#42;MIDestAlign)</Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;setDestAlignment(DestAlign);</Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/memtransferinst">MemTransferInst</a> &#42;MTI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemTransferInst&gt;</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> MTISrcAlign = MTI-&gt;getSourceAlign();</Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/align">Align</a> SrcAlign = <a href="/docs/api/namespaces/llvm/#a607b7fac55adc5ea9ed40a78e48a5b00">getKnownAlignment</a>(MTI-&gt;getSource(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MTISrcAlign || SrcAlign &gt; &#42;MTISrcAlign)</Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal">        MTI-&gt;setSourceAlignment(SrcAlign);</Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have a cold call site, try to sink addressing computation into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cold block.  This interacts with our handling for loads and stores to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ensure that we can fold all uses of a potential addressing computation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into their uses.  TODO: generalize this to work over profiling data</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2fbfe5377a984518a7c03d8558df726d">hasFnAttr</a>(Attribute::Cold) &amp;&amp;</Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(BB, PSI, <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get()))</Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Arg : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>()) &#123;</Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Arg-&gt;getType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = Arg-&gt;getType()-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (optimizeMemoryInst(CI, Arg, Arg-&gt;getType(), AS))</Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(CI);</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::assume:</Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;llvm.assume should have been removed already&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::allow&#95;runtime&#95;check:</Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::allow&#95;ubsan&#95;check:</Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::experimental&#95;widenable&#95;condition: &#123;</Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Give up on future widening opportunities so that we can fold away dead</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// paths and merge blocks before going into block-local instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// selection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;use&#95;empty()) &#123;</Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;RetVal = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getContext());</Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="normal">      resetIteratorIfInvalidatedWhileCalling(BB, &#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a66a40e8dfb026aef2f90764d2e49a8f1">replaceAndRecursivelySimplify</a>(CI, RetVal, TLInfo, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::objectsize:</Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;llvm.objectsize.&#42; should have been lowered already&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::is&#95;constant:</Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;llvm.is.constant.&#42; should have been lowered already&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::aarch64&#95;stlxr:</Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::aarch64&#95;stxr: &#123;</Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/zextinst">ZExtInst</a> &#42;ExtVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ZExtInst&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0));</Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExtVal || !ExtVal-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() ||</Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal">          ExtVal-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Sink a zext feeding stlxr/stxr before it, so it can be folded into it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal">      ExtVal-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Mark this instruction as &quot;inserted by CGP&quot;, so that other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// optimizations don&#39;t touch it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><Highlight kind="normal">      InsertedInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ExtVal);</Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::launder&#95;invariant&#95;group:</Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::strip&#95;invariant&#95;group: &#123;</Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ArgVal = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0);</Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> it = LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (it != LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a0881334358ff6ff7ff8cea5562c7988e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Merge entries in LargeOffsetGEPMap to reflect the RAUW.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Make sure not to have to deal with iterator invalidation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// after possibly adding ArgVal to LargeOffsetGEPMap.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GEPs = std::move(it-&gt;second);</Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal">        LargeOffsetGEPMap&#91;ArgVal&#93;.append(GEPs.begin(), GEPs.end());</Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal">        LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a3a8171298a7d19a309d599de01906703">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, ArgVal, FreshBBs, IsHugeFunc);</Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::cttz:</Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::ctlz:</Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If counting zeros is expensive, try to avoid it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#adfad68845808cb6acd116e50b15bc281">despeculateCountZeros</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, &#42;LI, TLI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ModifiedDT, FreshBBs,</Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="normal">                                   IsHugeFunc);</Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::fshl:</Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::fshr:</Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeFunnelShift(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::dbg&#95;assign:</Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::dbg&#95;value:</Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> fixupDbgValue(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::masked&#95;gather:</Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeGatherScatterInst(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0));</Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::masked&#95;scatter:</Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeGatherScatterInst(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(1));</Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> PtrOps;</Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy;</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#ab8f2a9189ca5cab7a1fe0d09bc67ba34">getAddrModeArguments</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, PtrOps, AccessTy))</Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!PtrOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;PtrVal = PtrOps.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = PtrVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (optimizeMemoryInst(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, PtrVal, AccessTy, AS))</Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// From here on out we&#39;re working with named functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bac8ff9e15a93f800c74c05e7b37364816">Callee</a> = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Callee)</Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Lower all default uses of &#95;chk calls.  This is very similar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to what InstCombineCalls does, but here we are only lowering calls</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to fortified library functions (e.g. &#95;&#95;memcpy&#95;chk) that have the default</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &quot;don&#39;t know&quot; as the objectsize.  Anything else should be left alone.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/fortifiedlibcallsimplifier">FortifiedLibCallSimplifier</a> Simplifier(TLInfo, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CI);</Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = Simplifier.optimizeCall(CI, Builder)) &#123;</Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(CI, V, FreshBBs, IsHugeFunc);</Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal">    CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// SCCP may have propagated, among other things, C++ static variables across</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// calls. If this happens to be the case, we may want to undo it in order to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// avoid redundant pointer computation of the constant, as the function method</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// returning the constant needs to be executed anyways.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetUniformReturnValue = &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getReturnType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;UniformValue = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;BB : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(RI-&gt;getReturnValue())) &#123;</Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UniformValue)</Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal">            UniformValue = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V != UniformValue)</Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UniformValue;</Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bac8ff9e15a93f800c74c05e7b37364816">Callee</a>-&gt;hasExactDefinition()) &#123;</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;RV = GetUniformReturnValue(Callee)) &#123;</Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(RV-&gt;uses())) &#123;</Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser());</Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &#123;</Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Limit to the same basic block to avoid extending the call-site live</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// range, which otherwise could increase register pressure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a784097fca76abad9e815cf1692de79c4">comesBefore</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.set(CI);</Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal">          MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810" lineLink="#a87548c69480b23599d643d518412895c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLInfo,</Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><Highlight kind="normal">                                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI) &#123;</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>());</Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(CI))</Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::memset:</Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::memcpy:</Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::memmove:</Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> LF;</Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Callee &amp;&amp; TLInfo &amp;&amp; TLInfo-&gt;<a href="/docs/api/classes/llvm/targetlibraryinfo/#a97cfbbed8869e3582142012a071a9052">getLibFunc</a>(&#42;Callee, LF))</Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (LF) &#123;</Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> LibFunc&#95;strcpy:</Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> LibFunc&#95;strncpy:</Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> LibFunc&#95;strcat:</Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> LibFunc&#95;strncat:</Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="comment">/// Look for opportunities to duplicate return instructions to the predecessor</Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="comment">/// to enable tail call optimizations. The case it is currently looking for is</Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="comment">/// the following one. Known intrinsics or library function that may be tail</Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="comment">/// called are taken into account as well.</Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="comment">/// @code</Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="comment">/// bb0:</Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="comment">///   %tmp0 = tail call i32 @f0()</Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="comment">///   br label %return</Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="comment">/// bb1:</Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="comment">///   %tmp1 = tail call i32 @f1()</Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="comment">///   br label %return</Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="comment">/// bb2:</Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="comment">///   %tmp2 = tail call i32 @f2()</Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="comment">///   br label %return</Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="comment">/// return:</Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="comment">///   %retval = phi i32 &#91; %tmp0, %bb0 &#93;, &#91; %tmp1, %bb1 &#93;, &#91; %tmp2, %bb2 &#93;</Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="comment">///   ret i32 %retval</Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><Highlight kind="comment">/// @endcode</Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="comment">/// =&gt;</Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="comment">/// @code</Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="comment">/// bb0:</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="comment">///   %tmp0 = tail call i32 @f0()</Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="comment">///   ret i32 %tmp0</Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><Highlight kind="comment">/// bb1:</Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="comment">///   %tmp1 = tail call i32 @f1()</Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="comment">///   ret i32 %tmp1</Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="comment">/// bb2:</Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="comment">///   %tmp2 = tail call i32 @f2()</Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="comment">///   ret i32 %tmp2</Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="comment">/// @endcode</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::dupRetToEnableTailCallOpts(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal">                                                ModifyDT &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RetI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RetI)</Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(BB) == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;A return block cannot be in a loop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/extractvalueinst">ExtractValueInst</a> &#42;EVI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BCI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = RetI-&gt;<a href="/docs/api/classes/llvm/returninst/#a6c2dee0852138a5cb8a4fef5883db9ec">getReturnValue</a>();</Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V) &#123;</Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">    BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BCI)</Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = BCI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">    EVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractValueInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EVI) &#123;</Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = EVI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(EVI-&gt;<a href="/docs/api/classes/llvm/extractvalueinst/#a767130a28a6a9148ab3f2cf451fc9375">indices</a>(), &#91;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> idx) &#123; return idx == 0; &#125;))</Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal">    PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V);</Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN &amp;&amp; PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB)</Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> isLifetimeEndOrBitCastFor = &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(Inst);</Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BC &amp;&amp; BC-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal">      Inst = BC-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>();</Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(Inst))</Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::lifetime&#95;end;</Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const IntrinsicInst &#42;, 4&gt;</a> FakeUses;</Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> isFakeUse = &#91;&amp;FakeUses&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(Inst);</Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::fake&#95;use) &#123;</Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Record the instruction so it can be preserved when the exit block is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// removed. Do not preserve the fake use that uses the result of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// PHI instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Do not copy fake uses that use the result of a PHI node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// FIXME: If we do want to copy the fake use into the return blocks, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// have to figure out which of the PHI node operands to use for each</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// copy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getOperand(0))) &#123;</Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">        FakeUses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure there are no instructions between the first instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and return.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a42a7d51fdde6913db72d098356c2c019">BasicBlock::const&#95;iterator</a> BI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</Highlight></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Skip over debug and the bitcast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BI) || &amp;&#42;BI == BCI || &amp;&#42;BI == EVI ||</Highlight></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PseudoProbeInst&gt;</a>(BI) || isLifetimeEndOrBitCastFor(&amp;&#42;BI) ||</Highlight></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><Highlight kind="normal">         isFakeUse(&amp;&#42;BI))</Highlight></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><Highlight kind="normal">    BI = std::next(BI);</Highlight></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;&#42;BI != RetI)</Highlight></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><Highlight kind="comment">  /// Only dup the ReturnInst if the CallInst is likely to be emitted as a tail</Highlight></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><Highlight kind="comment">  /// call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 4&gt;</a> TailCallBBs;</Highlight></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Record the call instructions so we can insert any fake uses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that need to be preserved before them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;CallInst &#42;, 4&gt;</a> CallInsts;</Highlight></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN) &#123;</Highlight></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Look through bitcasts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(IncomingVal);</Highlight></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Make sure the phi value is indeed produced by the tail call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == PredBB &amp;&amp;</Highlight></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><Highlight kind="normal">          TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</Highlight></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, &#42;TLI)) &#123;</Highlight></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><Highlight kind="normal">        TailCallBBs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredBB);</Highlight></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><Highlight kind="normal">        CallInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</Highlight></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Consider the cases in which the phi value is indirectly produced by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the tail call, for example when encountering memset(), memmove(),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// strcpy(), whose return value may have been optimized out. In such</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// cases, the value needs to be the first function argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// bb0:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//   tail call void @llvm.memset.p0.i64(ptr %0, i8 0, i64 %1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//   br label %return</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// return:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//   %phi = phi ptr &#91; %0, %bb0 &#93;, &#91; %2, %entry &#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PredBB &amp;&amp; PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == BB)</Highlight></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><Highlight kind="normal">          CI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(</Highlight></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><Highlight kind="normal">              PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a512494b857b0644c1f722531e3ee5495">getPrevNonDebugInstruction</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><Highlight kind="normal">            <a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a>(TLInfo, CI) &amp;&amp;</Highlight></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><Highlight kind="normal">            IncomingVal == CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0) &amp;&amp;</Highlight></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><Highlight kind="normal">            TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</Highlight></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, &#42;TLI)) &#123;</Highlight></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><Highlight kind="normal">          TailCallBBs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredBB);</Highlight></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><Highlight kind="normal">          CallInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</Highlight></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 4&gt;</a> VisitedBBs;</Highlight></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</Highlight></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VisitedBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Pred).second)</Highlight></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Pred-&gt;rbegin()-&gt;<a href="/docs/api/classes/llvm/instruction/#a512494b857b0644c1f722531e3ee5495">getPrevNonDebugInstruction</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">)) &#123;</Highlight></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</Highlight></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, &#42;TLI)) &#123;</Highlight></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Either we return void or the return value must be the first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// argument of a known intrinsic or library function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!V || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(V) ||</Highlight></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><Highlight kind="normal">              (<a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a>(TLInfo, CI) &amp;&amp;</Highlight></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><Highlight kind="normal">               V == CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0))) &#123;</Highlight></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><Highlight kind="normal">            TailCallBBs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Pred);</Highlight></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><Highlight kind="normal">            CallInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</Highlight></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> &amp;TailCallBB : TailCallBBs) &#123;</Highlight></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure the call instruction is followed by an unconditional branch to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the return block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TailCallBB-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() || BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BB)</Highlight></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Duplicate the return into TailCallBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><Highlight kind="normal">    (void)<a href="/docs/api/namespaces/llvm/#a2e4b18daaf5f20f1ade3a9f66b86d843">FoldReturnIntoUncondBranch</a>(RetI, BB, TailCallBB);</Highlight></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a> ||</Highlight></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(BB) &gt;= <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(TailCallBB));</Highlight></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;setBlockFreq(BB,</Highlight></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><Highlight kind="normal">                      (<a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(BB) - <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(TailCallBB)));</Highlight></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><Highlight kind="normal">    ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>;</Highlight></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><Highlight kind="normal">    ++NumRetsDup;</Highlight></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we eliminated all predecessors of the block, delete the block now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> &amp;&amp; !BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(BB)) &#123;</Highlight></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Copy the fake uses found in the original return block to all blocks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that contain tail calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI : CallInsts) &#123;</Highlight></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> &#42;FakeUse : FakeUses) &#123;</Highlight></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ClonedInst = FakeUse-&gt;clone();</Highlight></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><Highlight kind="normal">        ClonedInst-&gt;insertBefore(CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><Highlight kind="normal">    BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Memory Optimization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><Highlight kind="comment">/// This is an extended version of TargetLowering::AddrMode</Highlight></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><Highlight kind="comment">/// which holds actual Value&#42;&#39;s for register values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a> : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/targetloweringbase/addrmode">TargetLowering::AddrMode</a> &#123;</Highlight></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f">OriginalValue</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">enum</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> &#123;</Highlight></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">NoField</a> = 0x00,</Highlight></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">BaseRegField</a> = 0x01,</Highlight></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">BaseGVField</a> = 0x02,</Highlight></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">BaseOffsField</a> = 0x04,</Highlight></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ScaledRegField</a> = 0x08,</Highlight></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101">ScaleField</a> = 0x10,</Highlight></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a> = 255</Highlight></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb"><Highlight kind="normal">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a>() = </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a50bf746ca1858c0e272e3a802fc27942">print</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a03503773241005f01b090b9862aad304">dump</a>() </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace From in ExtAddrMode with To.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// E.g., SExt insts may be promoted and deleted. We should replace them with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the promoted values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afcc64bfd52afa9a6094a07cc91922630"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afcc64bfd52afa9a6094a07cc91922630">replaceWith</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;From, <a href="/docs/api/classes/llvm/value">Value</a> &#42;To) &#123;</Highlight></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> == From)</Highlight></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><Highlight kind="normal">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = To;</Highlight></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a0cd7231f32d51864a9e307330e798de9"><Highlight kind="normal">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a0cd7231f32d51864a9e307330e798de9">compare</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a> &amp;other) &#123;</Highlight></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// First check that the types are the same on each field, as differing types</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is something we can&#39;t cope with later on.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> &amp;&amp; other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><Highlight kind="normal">        <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>-&gt;getType() != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</Highlight></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</Highlight></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseGV &amp;&amp; other.BaseGV &amp;&amp; BaseGV-&gt;getType() != other.BaseGV-&gt;getType())</Highlight></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</Highlight></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> &amp;&amp; other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><Highlight kind="normal">        <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>-&gt;getType() != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</Highlight></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</Highlight></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Conservatively reject &#39;inbounds&#39; mismatches.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a> != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a>)</Highlight></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</Highlight></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check each field to see if it differs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Result = <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">NoField</a>;</Highlight></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>)</Highlight></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><Highlight kind="normal">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">BaseRegField</a>;</Highlight></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseGV != other.BaseGV)</Highlight></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><Highlight kind="normal">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">BaseGVField</a>;</Highlight></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseOffs != other.BaseOffs)</Highlight></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><Highlight kind="normal">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">BaseOffsField</a>;</Highlight></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>)</Highlight></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><Highlight kind="normal">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ScaledRegField</a>;</Highlight></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t count 0 as being a different scale, because that actually means</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// unscaled (which will already be counted by having no ScaledReg).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> &amp;&amp; other.Scale &amp;&amp; <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> != other.Scale)</Highlight></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><Highlight kind="normal">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101">ScaleField</a>;</Highlight></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0eea77e7bfa82e0219d2ec7b4efbc94f">llvm::popcount</a>(Result) &gt; 1)</Highlight></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</Highlight></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a></Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(Result);</Highlight></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// An AddrMode is trivial if it involves no calculation i.e. it is just a base</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with no offset.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af16961a6894c56bc7f08641a2538167d"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af16961a6894c56bc7f08641a2538167d">isTrivial</a>() &#123;</Highlight></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// An AddrMode is (BaseGV + BaseReg + BaseOffs + ScaleReg &#42; Scale) so it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// trivial if at most one of these terms is nonzero, except that BaseGV and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// BaseReg both being zero actually means a null pointer value, which we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// consider to be &#39;non-zero&#39; here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !BaseOffs &amp;&amp; !<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> &amp;&amp; !(BaseGV &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>);</Highlight></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a98c66d9b5e8ace6575527d88e08fe378"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a98c66d9b5e8ace6575527d88e08fe378">GetFieldAsValue</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntPtrTy) &#123;</Highlight></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>) &#123;</Highlight></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">BaseRegField</a>:</Highlight></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>;</Highlight></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">BaseGVField</a>:</Highlight></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BaseGV;</Highlight></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ScaledRegField</a>:</Highlight></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>;</Highlight></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">BaseOffsField</a>:</Highlight></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ConstantInt::get(IntPtrTy, BaseOffs);</Highlight></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af313a30da49e08d08e305c3e72b32619"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af313a30da49e08d08e305c3e72b32619">SetCombinedField</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</Highlight></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><Highlight kind="normal">                        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ExtAddrMode&gt;</a> &amp;AddrModes) &#123;</Highlight></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>) &#123;</Highlight></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Unhandled fields are expected to be rejected earlier&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">ExtAddrMode::BaseRegField</a>:</Highlight></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><Highlight kind="normal">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> = V;</Highlight></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">ExtAddrMode::BaseGVField</a>:</Highlight></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// A combined BaseGV is an Instruction, not a GlobalValue, so it goes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// in the BaseReg field.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><Highlight kind="normal">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> = V;</Highlight></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><Highlight kind="normal">      BaseGV = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ExtAddrMode::ScaledRegField</a>:</Highlight></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><Highlight kind="normal">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = V;</Highlight></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we have a mix of scaled and unscaled addrmodes then we want scale</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to be the scale and not zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a>)</Highlight></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a> &amp;AM : AddrModes)</Highlight></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AM.Scale) &#123;</Highlight></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><Highlight kind="normal">            <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> = AM.Scale;</Highlight></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">ExtAddrMode::BaseOffsField</a>:</Highlight></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The offset is no longer a constant, so it goes in ScaledReg with a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// scale of 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><Highlight kind="normal">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = V;</Highlight></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> = 1;</Highlight></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><Highlight kind="normal">      BaseOffs = 0;</Highlight></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#ab24147fe07c79ebc39df89376d939778"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">inline</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;<a href="/docs/api/namespaces/llvm/#ab89f1db02887aa569176f0e29622eb47">operator&lt;&lt;</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AM) &#123;</Highlight></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><Highlight kind="normal">  AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a13013613b2600aea6438d155a7e4c21b">print</a>(OS);</Highlight></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OS;</Highlight></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#if !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a13013613b2600aea6438d155a7e4c21b"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a13013613b2600aea6438d155a7e4c21b">ExtAddrMode::print</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedPlus = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#91;&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a>)</Highlight></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><Highlight kind="normal">    OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;inbounds &quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseGV) &#123;</Highlight></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><Highlight kind="normal">    OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;GV:&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><Highlight kind="normal">    BaseGV-&gt;printAsOperand(OS, </Highlight><Highlight kind="comment">/&#42;PrintType=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><Highlight kind="normal">    NeedPlus = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseOffs) &#123;</Highlight></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><Highlight kind="normal">    OS &lt;&lt; (NeedPlus ? </Highlight><Highlight kind="stringliteral">&quot; + &quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">) &lt;&lt; BaseOffs;</Highlight></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><Highlight kind="normal">    NeedPlus = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>) &#123;</Highlight></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><Highlight kind="normal">    OS &lt;&lt; (NeedPlus ? </Highlight><Highlight kind="stringliteral">&quot; + &quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Base:&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>-&gt;printAsOperand(OS, </Highlight><Highlight kind="comment">/&#42;PrintType=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><Highlight kind="normal">    NeedPlus = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a>) &#123;</Highlight></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><Highlight kind="normal">    OS &lt;&lt; (NeedPlus ? </Highlight><Highlight kind="stringliteral">&quot; + &quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">) &lt;&lt; <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#42;&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>-&gt;printAsOperand(OS, </Highlight><Highlight kind="comment">/&#42;PrintType=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;&#93;&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af97ad85fa4c9caf49c807470d137a67d"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af97ad85fa4c9caf49c807470d137a67d">ExtAddrMode::dump</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a50bf746ca1858c0e272e3a802fc27942">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</Highlight></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><Highlight kind="comment">/// This class provides transaction based operation on the IR.</Highlight></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><Highlight kind="comment">/// Every change made through this class is recorded in the internal state and</Highlight></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><Highlight kind="comment">/// can be undone (rollback) until commit is called.</Highlight></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><Highlight kind="comment">/// CGP does not check if instructions could be speculatively executed when</Highlight></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><Highlight kind="comment">/// moved. Preserving the original location would pessimize the debugging</Highlight></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><Highlight kind="comment">/// experience, as well as negatively impact the quality of sample PGO.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a3f64f3705ad6de53221d46f95196acb7">TypePromotionTransaction</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><Highlight kind="comment">  /// This represents the common interface of the individual transaction.</Highlight></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><Highlight kind="comment">  /// Each class implements the logic for doing one specific modification on</Highlight></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><Highlight kind="comment">  /// the IR via the TypePromotionTransaction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">TypePromotionAction &#123;</Highlight></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">protected</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><Highlight kind="comment">    /// The Instruction modified.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst;</Highlight></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><Highlight kind="comment">    /// Constructor of the action.</Highlight></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><Highlight kind="comment">    /// The constructor performs the related action on the IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><Highlight kind="normal">    TypePromotionAction(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) : Inst(Inst) &#123;&#125;</Highlight></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> ~TypePromotionAction() = </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><Highlight kind="comment">    /// Undo the modification done by this action.</Highlight></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><Highlight kind="comment">    /// When this method is called, the IR must be in the same state as it was</Highlight></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><Highlight kind="comment">    /// before this action was applied.</Highlight></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><Highlight kind="comment">    /// \\pre Undoing the action works if and only if the IR is in the exact same</Highlight></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><Highlight kind="comment">    /// state as it was directly after this action was applied.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo() = 0;</Highlight></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><Highlight kind="comment">    /// Advocate every change made by this action.</Highlight></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><Highlight kind="comment">    /// When the results on the IR of the action are to be kept, it is important</Highlight></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><Highlight kind="comment">    /// to call this function, otherwise hidden information may be kept forever.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a990fcc2525f7ebe5d3dae3aa10434fa0">commit</a>() &#123;</Highlight></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Nothing to be done, this action is not doing anything.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><Highlight kind="comment">  /// Utility to remember the position of an instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">InsertionHandler &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><Highlight kind="comment">    /// Position of an instruction.</Highlight></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><Highlight kind="comment">    /// Either an instruction:</Highlight></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><Highlight kind="comment">    /// - Is the first in a basic block: BB is used.</Highlight></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><Highlight kind="comment">    /// - Has a previous instruction: PrevInst is used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> PrevInst;</Highlight></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB;</Highlight></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><Highlight kind="normal">    &#125; Point;</Highlight></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><Highlight kind="normal">    std::optional&lt;DbgRecord::self&#95;iterator&gt; BeforeDbgRecord = std::nullopt;</Highlight></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><Highlight kind="comment">    /// Remember whether or not the instruction had a previous instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasPrevInstruction;</Highlight></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><Highlight kind="comment">    /// Record the position of \\p Inst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><Highlight kind="normal">    InsertionHandler(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</Highlight></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><Highlight kind="normal">      HasPrevInstruction = (Inst != &amp;&#42;(Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;begin()));</Highlight></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Record where we would have to re-insert the instruction in the sequence</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// of DbgRecords, if we ended up reinserting.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab571b8358a3a8b6db1327d06bdc5e9f4">IsNewDbgInfoFormat</a>)</Highlight></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><Highlight kind="normal">        BeforeDbgRecord = Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ad99db073c46dd0de2c530c64baf77cb7">getDbgReinsertionPosition</a>();</Highlight></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasPrevInstruction) &#123;</Highlight></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><Highlight kind="normal">        Point.PrevInst = std::prev(Inst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><Highlight kind="normal">        Point.BB = BB;</Highlight></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><Highlight kind="comment">    /// Insert \\p Inst at the recorded position.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> insert(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</Highlight></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasPrevInstruction) &#123;</Highlight></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><Highlight kind="normal">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</Highlight></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><Highlight kind="normal">        Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(Point.PrevInst);</Highlight></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Position = Point.BB-&gt;getFirstInsertionPt();</Highlight></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><Highlight kind="normal">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&#42;Point.BB, Position);</Highlight></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><Highlight kind="normal">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;Point.BB, Position);</Highlight></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;reinsertInstInDbgRecords(Inst, BeforeDbgRecord);</Highlight></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><Highlight kind="comment">  /// Move an instruction before another.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">InstructionMoveBefore : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><Highlight kind="comment">    /// Original position of the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><Highlight kind="normal">    InsertionHandler Position;</Highlight></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><Highlight kind="comment">    /// Move \\p Inst before \\p Before.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><Highlight kind="normal">    InstructionMoveBefore(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa9060587edeb01a63e3d3edc959678d1e">Before</a>)</Highlight></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><Highlight kind="normal">        : TypePromotionAction(Inst), Position(Inst) &#123;</Highlight></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: move: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\nbefore: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa9060587edeb01a63e3d3edc959678d1e">Before</a></Highlight></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa9060587edeb01a63e3d3edc959678d1e">Before</a>);</Highlight></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><Highlight kind="comment">    /// Move the instruction back to its original position.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: moveBefore: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><Highlight kind="normal">      Position.insert(Inst);</Highlight></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><Highlight kind="comment">  /// Set the operand of an instruction with a new value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">OperandSetter : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><Highlight kind="comment">    /// Original operand of the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Origin;</Highlight></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><Highlight kind="comment">    /// Index of the modified instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx;</Highlight></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><Highlight kind="comment">    /// Set \\p Idx operand of \\p Inst with \\p NewVal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><Highlight kind="normal">    OperandSetter(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal)</Highlight></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><Highlight kind="normal">        : TypePromotionAction(Inst), Idx(Idx) &#123;</Highlight></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: setOperand: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Idx &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;for:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;with:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;NewVal &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><Highlight kind="normal">      Origin = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Idx);</Highlight></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Idx, NewVal);</Highlight></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><Highlight kind="comment">    /// Restore the original value of the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: setOperand:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Idx &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;for: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;with: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Origin &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Idx, Origin);</Highlight></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><Highlight kind="comment">  /// Hide the operands of an instruction.</Highlight></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><Highlight kind="comment">  /// Do as if this instruction was not using any of its operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">OperandsHider : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><Highlight kind="comment">    /// The list of original operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> OriginalValues;</Highlight></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><Highlight kind="comment">    /// Remove \\p Inst from the uses of the operands of \\p Inst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><Highlight kind="normal">    OperandsHider(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) : TypePromotionAction(Inst) &#123;</Highlight></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: OperandsHider: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumOpnds = Inst-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>();</Highlight></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><Highlight kind="normal">      OriginalValues.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(NumOpnds);</Highlight></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> It = 0; It &lt; NumOpnds; ++It) &#123;</Highlight></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Save the current operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(It);</Highlight></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><Highlight kind="normal">        OriginalValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Val);</Highlight></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Set a dummy one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We could use OperandSetter here, but that would imply an overhead</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// that we are not willing to pay.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><Highlight kind="normal">        Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(It, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Val-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><Highlight kind="comment">    /// Restore the original list of uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: OperandsHider: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> It = 0, EndIt = OriginalValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); It != EndIt; ++It)</Highlight></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><Highlight kind="normal">        Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(It, OriginalValues&#91;It&#93;);</Highlight></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><Highlight kind="comment">  /// Build a truncate instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">TruncBuilder : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</Highlight></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><Highlight kind="comment">    /// Build a truncate instruction of \\p Opnd producing a \\p Ty</Highlight></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><Highlight kind="comment">    /// result.</Highlight></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><Highlight kind="comment">    /// trunc Opnd to Ty.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><Highlight kind="normal">    TruncBuilder(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) : TypePromotionAction(Opnd) &#123;</Highlight></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Opnd);</Highlight></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><Highlight kind="normal">      Val = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(Opnd, Ty, </Highlight><Highlight kind="stringliteral">&quot;promoted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: TruncBuilder: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Val &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><Highlight kind="comment">    /// Get the built value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;getBuiltValue() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Val; &#125;</Highlight></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><Highlight kind="comment">    /// Remove the built instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: TruncBuilder: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Val &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val))</Highlight></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><Highlight kind="normal">        IVal-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><Highlight kind="comment">  /// Build a sign extension instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">SExtBuilder : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</Highlight></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><Highlight kind="comment">    /// Build a sign extension instruction of \\p Opnd producing a \\p Ty</Highlight></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><Highlight kind="comment">    /// result.</Highlight></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><Highlight kind="comment">    /// sext Opnd to Ty.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><Highlight kind="normal">    SExtBuilder(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty)</Highlight></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><Highlight kind="normal">        : TypePromotionAction(InsertPt) &#123;</Highlight></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertPt);</Highlight></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><Highlight kind="normal">      Val = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5253081f40ffcad9c0e8ba6a5c437006">CreateSExt</a>(Opnd, Ty, </Highlight><Highlight kind="stringliteral">&quot;promoted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: SExtBuilder: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Val &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><Highlight kind="comment">    /// Get the built value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;getBuiltValue() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Val; &#125;</Highlight></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><Highlight kind="comment">    /// Remove the built instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: SExtBuilder: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Val &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val))</Highlight></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><Highlight kind="normal">        IVal-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><Highlight kind="comment">  /// Build a zero extension instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">ZExtBuilder : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</Highlight></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><Highlight kind="comment">    /// Build a zero extension instruction of \\p Opnd producing a \\p Ty</Highlight></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><Highlight kind="comment">    /// result.</Highlight></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><Highlight kind="comment">    /// zext Opnd to Ty.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><Highlight kind="normal">    ZExtBuilder(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty)</Highlight></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><Highlight kind="normal">        : TypePromotionAction(InsertPt) &#123;</Highlight></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertPt);</Highlight></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><Highlight kind="normal">      Val = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(Opnd, Ty, </Highlight><Highlight kind="stringliteral">&quot;promoted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: ZExtBuilder: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Val &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><Highlight kind="comment">    /// Get the built value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;getBuiltValue() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Val; &#125;</Highlight></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><Highlight kind="comment">    /// Remove the built instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: ZExtBuilder: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Val &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val))</Highlight></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><Highlight kind="normal">        IVal-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><Highlight kind="comment">  /// Mutate an instruction to another type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">TypeMutator : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><Highlight kind="comment">    /// Record the original type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;OrigTy;</Highlight></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><Highlight kind="comment">    /// Mutate the type of \\p Inst into \\p NewTy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><Highlight kind="normal">    TypeMutator(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy)</Highlight></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><Highlight kind="normal">        : TypePromotionAction(Inst), OrigTy(Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</Highlight></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: MutateType: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;NewTy</Highlight></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/value/#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(NewTy);</Highlight></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><Highlight kind="comment">    /// Mutate the instruction back to its original type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: MutateType: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;OrigTy</Highlight></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/value/#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(OrigTy);</Highlight></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><Highlight kind="comment">  /// Replace the uses of an instruction by another instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">UsesReplacer : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><Highlight kind="comment">    /// Helper structure to keep track of the replaced uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal">InstructionAndIdx &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><Highlight kind="comment">      /// The instruction using the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst;</Highlight></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><Highlight kind="comment">      /// The index where this instruction is used for Inst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx;</Highlight></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><Highlight kind="normal">      InstructionAndIdx(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx)</Highlight></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><Highlight kind="normal">          : Inst(Inst), Idx(Idx) &#123;&#125;</Highlight></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><Highlight kind="comment">    /// Keep track of the original uses (pair Instruction, Index).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;InstructionAndIdx, 4&gt;</a> OriginalUses;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><Highlight kind="comment">    /// Keep track of the debug users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgValueInst &#42;, 1&gt;</a> DbgValues;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><Highlight kind="comment">    /// And non-instruction debug-users too.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 1&gt;</a> DbgVariableRecords;</Highlight></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><Highlight kind="comment">    /// Keep track of the new value so that we can undo it by replacing</Highlight></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><Highlight kind="comment">    /// instances of the new value with the original value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;New;</Highlight></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">use&#95;iterator = <a href="/docs/api/classes/llvm/smallvectorimpl/#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;InstructionAndIdx&gt;::iterator</a>;</Highlight></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><Highlight kind="comment">    /// Replace all the use of \\p Inst by \\p New.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><Highlight kind="normal">    UsesReplacer(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;New)</Highlight></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><Highlight kind="normal">        : TypePromotionAction(Inst), New(New) &#123;</Highlight></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: UsersReplacer: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;New</Highlight></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Record the original uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : Inst-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</Highlight></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</Highlight></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><Highlight kind="normal">        OriginalUses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(InstructionAndIdx(UserI, U.getOperandNo()));</Highlight></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Record the debug uses separately. They are not in the instruction&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// use list, but they are replaced by RAUW.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a4d7448a42ae4db532d3ba40e250ec825">findDbgValues</a>(DbgValues, Inst, &amp;DbgVariableRecords);</Highlight></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Now, we can replace the uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</Highlight></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><Highlight kind="comment">    /// Reassign the original uses of Inst to Inst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: UsersReplacer: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (InstructionAndIdx &amp;<a href="/docs/api/classes/llvm/use">Use</a> : OriginalUses)</Highlight></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/use">Use</a>.Inst-&gt;setOperand(<a href="/docs/api/classes/llvm/use">Use</a>.Idx, Inst);</Highlight></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// RAUW has replaced all original uses with references to the new value,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// including the debug uses. Since we are undoing the replacements,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the original debug uses must also be reinstated to maintain the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// correctness and utility of debug value instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DVI : DbgValues)</Highlight></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><Highlight kind="normal">        DVI-&gt;replaceVariableLocationOp(New, Inst);</Highlight></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Similar story with DbgVariableRecords, the non-instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// representation of dbg.values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR : DbgVariableRecords)</Highlight></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><Highlight kind="normal">        DVR-&gt;replaceVariableLocationOp(New, Inst);</Highlight></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><Highlight kind="comment">  /// Remove an instruction from the IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">InstructionRemover : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> TypePromotionAction &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><Highlight kind="comment">    /// Original position of the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><Highlight kind="normal">    InsertionHandler Inserter;</Highlight></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><Highlight kind="comment">    /// Helper structure to hide all the link to the instruction. In other</Highlight></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><Highlight kind="comment">    /// words, this helps to do as if the instruction was removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><Highlight kind="normal">    OperandsHider Hider;</Highlight></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><Highlight kind="comment">    /// Keep track of the uses replaced, if any.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><Highlight kind="normal">    UsesReplacer &#42;Replacer = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><Highlight kind="comment">    /// Keep track of instructions removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts;</Highlight></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><Highlight kind="comment">    /// Remove all reference of \\p Inst and optionally replace all its</Highlight></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><Highlight kind="comment">    /// uses with New.</Highlight></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><Highlight kind="comment">    /// \\p RemovedInsts Keep track of the instructions removed by this Action.</Highlight></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><Highlight kind="comment">    /// \\pre If !Inst-&gt;use&#95;empty(), then New != nullptr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><Highlight kind="normal">    InstructionRemover(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts,</Highlight></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><Highlight kind="normal">                       <a href="/docs/api/classes/llvm/value">Value</a> &#42;New = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><Highlight kind="normal">        : TypePromotionAction(Inst), Inserter(Inst), Hider(Inst),</Highlight></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><Highlight kind="normal">          RemovedInsts(RemovedInsts) &#123;</Highlight></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (New)</Highlight></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><Highlight kind="normal">        Replacer = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> UsesReplacer(Inst, New);</Highlight></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Do: InstructionRemover: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><Highlight kind="normal">      RemovedInsts.insert(Inst);</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><Highlight kind="comment">      /// The instructions removed here will be freed after completing</Highlight></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><Highlight kind="comment">      /// optimizeBlock() for all blocks as we need to keep track of the</Highlight></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><Highlight kind="comment">      /// removed instructions during promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><Highlight kind="normal">      Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</Highlight></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><Highlight kind="normal">    ~InstructionRemover()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keyword">delete</Highlight><Highlight kind="normal"> Replacer; &#125;</Highlight></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><Highlight kind="normal">    InstructionRemover &amp;operator=(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> InstructionRemover &amp;other) = </Highlight><Highlight kind="keyword">delete</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><Highlight kind="normal">    InstructionRemover(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> InstructionRemover &amp;other) = </Highlight><Highlight kind="keyword">delete</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><Highlight kind="comment">    /// Resurrect the instruction and reassign it to the proper uses if</Highlight></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><Highlight kind="comment">    /// new value was provided when build this action.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> undo()</Highlight><Highlight kind="keyword"> override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Undo: InstructionRemover: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><Highlight kind="normal">      Inserter.insert(Inst);</Highlight></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Replacer)</Highlight></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><Highlight kind="normal">        Replacer-&gt;undo();</Highlight></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><Highlight kind="normal">      Hider.undo();</Highlight></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><Highlight kind="normal">      RemovedInsts.erase(Inst);</Highlight></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><Highlight kind="comment">  /// Restoration point.</Highlight></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><Highlight kind="comment">  /// The restoration point is a pointer to an action instead of an iterator</Highlight></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><Highlight kind="comment">  /// because the iterator may be invalidated but not the pointer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">ConstRestorationPt</a> = </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> TypePromotionAction &#42;;</Highlight></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a3f64f3705ad6de53221d46f95196acb7"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a3f64f3705ad6de53221d46f95196acb7">TypePromotionTransaction</a>(<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts)</Highlight></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><Highlight kind="normal">      : RemovedInsts(RemovedInsts) &#123;&#125;</Highlight></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><Highlight kind="comment">  /// Advocate every changes made in that transaction. Return true if any change</Highlight></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><Highlight kind="comment">  /// happen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> commit();</Highlight></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><Highlight kind="comment">  /// Undo all the changes made after the given point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> rollback(ConstRestorationPt Point);</Highlight></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><Highlight kind="comment">  /// Get the current restoration point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><Highlight kind="normal">  ConstRestorationPt getRestorationPoint() </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><Highlight kind="comment">  /// \\name API for IR modification with state keeping to support rollback.</Highlight></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><Highlight kind="comment">  /// @&#123;</Highlight></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><Highlight kind="comment">  /// Same as Instruction::setOperand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> setOperand(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal);</Highlight></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><Highlight kind="comment">  /// Same as Instruction::eraseFromParent.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp/#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><Highlight kind="comment">  /// Same as Value::replaceAllUsesWith.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;New);</Highlight></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><Highlight kind="comment">  /// Same as Value::mutateType.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> mutateType(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy);</Highlight></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><Highlight kind="comment">  /// Same as IRBuilder::createTrunc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;createTrunc(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty);</Highlight></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><Highlight kind="comment">  /// Same as IRBuilder::createSExt.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;createSExt(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty);</Highlight></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><Highlight kind="comment">  /// Same as IRBuilder::createZExt.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;createZExt(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty);</Highlight></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><Highlight kind="normal"></Highlight><Highlight kind="keyword">private</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><Highlight kind="comment">  /// The ordered list of actions made so far.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::unique&#95;ptr&lt;TypePromotionAction&gt;</a>, 16&gt; Actions;</Highlight></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">CommitPt =</Highlight></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;std::unique&#95;ptr&lt;TypePromotionAction&gt;</a>&gt;<a href="/docs/api/classes/llvm/iplist">::iterator</a>;</Highlight></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts;</Highlight></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a5a651fca694e060abd7d17d6cf34fe51"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a5a651fca694e060abd7d17d6cf34fe51">TypePromotionTransaction::setOperand</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx,</Highlight></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal) &#123;</Highlight></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><Highlight kind="normal">  Actions.push&#95;back(std::make&#95;unique&lt;TypePromotionTransaction::OperandSetter&gt;(</Highlight></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><Highlight kind="normal">      Inst, Idx, NewVal));</Highlight></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">TypePromotionTransaction::eraseInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</Highlight></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal) &#123;</Highlight></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><Highlight kind="normal">  Actions.push&#95;back(</Highlight></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><Highlight kind="normal">      std::make&#95;unique&lt;TypePromotionTransaction::InstructionRemover&gt;(</Highlight></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><Highlight kind="normal">          Inst, RemovedInsts, NewVal));</Highlight></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ad7595fd2ce173a5034cbc5f2376978e6"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ad7595fd2ce173a5034cbc5f2376978e6">TypePromotionTransaction::replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</Highlight></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><Highlight kind="normal">                                                  <a href="/docs/api/classes/llvm/value">Value</a> &#42;New) &#123;</Highlight></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><Highlight kind="normal">  Actions.push&#95;back(</Highlight></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><Highlight kind="normal">      std::make&#95;unique&lt;TypePromotionTransaction::UsesReplacer&gt;(Inst, New));</Highlight></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a78fd7692f642fa4792119f0eabf67c12"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a78fd7692f642fa4792119f0eabf67c12">TypePromotionTransaction::mutateType</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy) &#123;</Highlight></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"><Highlight kind="normal">  Actions.push&#95;back(</Highlight></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><Highlight kind="normal">      std::make&#95;unique&lt;TypePromotionTransaction::TypeMutator&gt;(Inst, NewTy));</Highlight></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#aa69a48966533c3b656b4ac37819bdcca"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#aa69a48966533c3b656b4ac37819bdcca">TypePromotionTransaction::createTrunc</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</Highlight></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><Highlight kind="normal">  std::unique&#95;ptr&lt;TruncBuilder&gt; <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> TruncBuilder(Opnd, Ty));</Highlight></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</Highlight></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><Highlight kind="normal">  Actions.push&#95;back(std::move(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</Highlight></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Val;</Highlight></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a377ef6bb6c1215b043f7835ac91f04c0"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a377ef6bb6c1215b043f7835ac91f04c0">TypePromotionTransaction::createSExt</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd,</Highlight></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</Highlight></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><Highlight kind="normal">  std::unique&#95;ptr&lt;SExtBuilder&gt; <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> SExtBuilder(Inst, Opnd, Ty));</Highlight></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</Highlight></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><Highlight kind="normal">  Actions.push&#95;back(std::move(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</Highlight></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Val;</Highlight></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a40e7a7b00ec46903a6a39e28b30da046"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a40e7a7b00ec46903a6a39e28b30da046">TypePromotionTransaction::createZExt</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd,</Highlight></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</Highlight></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><Highlight kind="normal">  std::unique&#95;ptr&lt;ZExtBuilder&gt; <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> ZExtBuilder(Inst, Opnd, Ty));</Highlight></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</Highlight></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><Highlight kind="normal">  Actions.push&#95;back(std::move(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</Highlight></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Val;</Highlight></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a></Highlight></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a09325594fe227adf9958691601147da9"><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a09325594fe227adf9958691601147da9">TypePromotionTransaction::getRestorationPoint</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !Actions.empty() ? Actions.back().get() : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a990fcc2525f7ebe5d3dae3aa10434fa0"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a990fcc2525f7ebe5d3dae3aa10434fa0">TypePromotionTransaction::commit</a>() &#123;</Highlight></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::unique&#95;ptr&lt;TypePromotionAction&gt; &amp;Action : Actions)</Highlight></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><Highlight kind="normal">    Action-&gt;commit();</Highlight></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = !Actions.empty();</Highlight></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><Highlight kind="normal">  Actions.clear();</Highlight></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a7bba09bd30b547542b3316d2c93a5647"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a7bba09bd30b547542b3316d2c93a5647">TypePromotionTransaction::rollback</a>(</Highlight></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> Point) &#123;</Highlight></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Actions.empty() &amp;&amp; Point != Actions.back().get()) &#123;</Highlight></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><Highlight kind="normal">    std::unique&#95;ptr&lt;TypePromotionAction&gt; Curr = Actions.pop&#95;back&#95;val();</Highlight></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><Highlight kind="normal">    Curr-&gt;undo();</Highlight></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><Highlight kind="comment">/// A helper class for matching addressing modes.</Highlight></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><Highlight kind="comment">/// This encapsulates the logic for matching the target-legal addressing modes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">AddressingModeMatcher &#123;</Highlight></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;AddrModeInsts;</Highlight></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI;</Highlight></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;TRI;</Highlight></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</Highlight></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI;</Highlight></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::function&lt;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;()&gt; getDTFn;</Highlight></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><Highlight kind="comment">  /// AccessTy/MemoryInst - This is the type for the access (e.g. double) and</Highlight></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><Highlight kind="comment">  /// the memory instruction that we&#39;re computing this address for.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy;</Highlight></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AddrSpace;</Highlight></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;MemoryInst;</Highlight></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><Highlight kind="comment">  /// This is the addressing mode that we&#39;re building up. This is</Highlight></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><Highlight kind="comment">  /// part of the return value of this addressing mode matching stuff.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><Highlight kind="normal">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</Highlight></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><Highlight kind="comment">  /// The instructions inserted by other CodeGenPrepare optimizations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts;</Highlight></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><Highlight kind="comment">  /// A map from the instructions to their type before promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts;</Highlight></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><Highlight kind="comment">  /// The ongoing transaction where every action should be registered.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT;</Highlight></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A GEP which has too large offset to be folded into the addressing mode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><Highlight kind="normal">  std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt; &amp;LargeOffsetGEP;</Highlight></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><Highlight kind="comment">  /// This is set to true when we should not do profitability checks.</Highlight></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><Highlight kind="comment">  /// When true, IsProfitableToFoldIntoAddressingMode always returns true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IgnoreProfitability;</Highlight></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><Highlight kind="comment">  /// True if we are optimizing for size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptSize = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI;</Highlight></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI;</Highlight></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><Highlight kind="normal">  AddressingModeMatcher(</Highlight></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;AMI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;TRI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI,</Highlight></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::function&lt;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;()&gt; getDTFn, <a href="/docs/api/classes/llvm/type">Type</a> &#42;AT,</Highlight></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AM,</Highlight></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</Highlight></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><Highlight kind="normal">      std::pair&lt;<a href="/docs/api/classes/llvm/assertingvh">AssertingVH&lt;GetElementPtrInst&gt;</a>, int64&#95;t&gt; &amp;LargeOffsetGEP,</Highlight></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI)</Highlight></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><Highlight kind="normal">      : AddrModeInsts(AMI), TLI(TLI), <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>(TRI),</Highlight></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDataLayout()), LI(LI), getDTFn(getDTFn),</Highlight></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><Highlight kind="normal">        AccessTy(AT), AddrSpace(AS), MemoryInst(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>), <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>(AM),</Highlight></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><Highlight kind="normal">        InsertedInsts(InsertedInsts), PromotedInsts(PromotedInsts), TPT(TPT),</Highlight></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><Highlight kind="normal">        LargeOffsetGEP(LargeOffsetGEP), OptSize(OptSize), PSI(PSI), BFI(BFI) &#123;</Highlight></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><Highlight kind="normal">    IgnoreProfitability = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><Highlight kind="comment">  /// Find the maximal addressing mode that a load/store of V can fold,</Highlight></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><Highlight kind="comment">  /// give an access type of AccessTy.  This returns a list of involved</Highlight></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><Highlight kind="comment">  /// instructions in AddrModeInsts.</Highlight></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><Highlight kind="comment">  /// \\p InsertedInsts The instructions inserted by other CodeGenPrepare</Highlight></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><Highlight kind="comment">  /// optimizations.</Highlight></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><Highlight kind="comment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</Highlight></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><Highlight kind="comment">  /// \\p The ongoing transaction where every action should be registered.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a></Highlight></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#a592ce6f54154b0ca1d672869951cad6b"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#a592ce6f54154b0ca1d672869951cad6b">Match</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;MemoryInst,</Highlight></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;AddrModeInsts,</Highlight></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI,</Highlight></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::function&lt;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;()&gt; getDTFn,</Highlight></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;TRI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts,</Highlight></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><Highlight kind="normal">        <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><Highlight kind="normal">        std::pair&lt;<a href="/docs/api/classes/llvm/assertingvh">AssertingVH&lt;GetElementPtrInst&gt;</a>, int64&#95;t&gt; &amp;LargeOffsetGEP,</Highlight></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI) &#123;</Highlight></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> Result;</Highlight></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> = AddressingModeMatcher(AddrModeInsts, TLI, TRI, LI, getDTFn,</Highlight></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><Highlight kind="normal">                                         AccessTy, AS, MemoryInst, Result,</Highlight></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><Highlight kind="normal">                                         InsertedInsts, PromotedInsts, TPT,</Highlight></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><Highlight kind="normal">                                         LargeOffsetGEP, OptSize, PSI, BFI)</Highlight></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><Highlight kind="normal">                       .matchAddr(V, 0);</Highlight></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><Highlight kind="normal">    (void)<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a>;</Highlight></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Couldn&#39;t select &#42;anything&#42;?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><Highlight kind="normal"></Highlight><Highlight kind="keyword">private</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> matchScaledValue(<a href="/docs/api/classes/llvm/value">Value</a> &#42;ScaleReg, int64&#95;t Scale, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> matchAddr(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Addr, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> matchOperationAddr(<a href="/docs/api/classes/llvm/user">User</a> &#42;AddrInst, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</Highlight></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><Highlight kind="normal">                          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#42;MovedAway = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isProfitableToFoldIntoAddressingMode(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><Highlight kind="normal">                                            <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMBefore,</Highlight></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><Highlight kind="normal">                                            <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMAfter);</Highlight></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> valueAlreadyLiveAtInst(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val, <a href="/docs/api/classes/llvm/value">Value</a> &#42;KnownLive1, <a href="/docs/api/classes/llvm/value">Value</a> &#42;KnownLive2);</Highlight></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isPromotionProfitable(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NewCost, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OldCost,</Highlight></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/value">Value</a> &#42;PromotedOperand) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal">PhiNodeSet;</Highlight></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><Highlight kind="comment">/// An iterator for PhiNodeSet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &#123;</Highlight></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Set;</Highlight></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> CurrentIndex = 0;</Highlight></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><Highlight kind="comment">  /// The constructor. Start should point to either a valid element, or be equal</Highlight></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><Highlight kind="comment">  /// to the size of the underlying SmallVector of the PhiNodeSet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Set, </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> Start);</Highlight></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/namespaces/llvm/#a2366b4a30c90d2207626fb717dfb778d">operator&#42;</a>() </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a438449b3174971956b5dd708baaa94f5">operator++</a>();</Highlight></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a4d812a2dd18aa186c164447e20e348e7">operator==</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a2f883c895f4d244f4ed56ed8a8c160c1">operator!=</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><Highlight kind="comment">/// Keeps a set of PHINodes.</Highlight></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><Highlight kind="comment">/// This is a minimal set implementation for a specific use case:</Highlight></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><Highlight kind="comment">/// It is very fast when there are very few elements, but also provides good</Highlight></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><Highlight kind="comment">/// performance when there are many. It is similar to SmallPtrSet, but also</Highlight></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><Highlight kind="comment">/// provides iteration by insertion order, which is deterministic and stable</Highlight></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><Highlight kind="comment">/// across runs. It is also similar to SmallSetVector, but provides removing</Highlight></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><Highlight kind="comment">/// elements in O(1) time. This is achieved by not actually removing the element</Highlight></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><Highlight kind="comment">/// from the underlying vector, so comes at the cost of using more memory, but</Highlight></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><Highlight kind="comment">/// that is fine, since PhiNodeSets are used as short lived objects.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#123;</Highlight></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">friend</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>;</Highlight></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">MapType = <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;PHINode &#42;, size&#95;t, 32&gt;</a>;</Highlight></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">iterator = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>;</Highlight></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><Highlight kind="comment">  /// Keeps the elements in the order of their insertion in the underlying</Highlight></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><Highlight kind="comment">  /// vector. To achieve constant time removal, it never deletes any element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 32&gt;</a> NodeList;</Highlight></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><Highlight kind="comment">  /// Keeps the elements in the underlying set implementation. This (and not the</Highlight></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><Highlight kind="comment">  /// NodeList defined above) is the source of truth on whether an element</Highlight></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><Highlight kind="comment">  /// is actually in the collection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"><Highlight kind="normal">  MapType NodeMap;</Highlight></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><Highlight kind="comment">  /// Points to the first valid (not deleted) element when the set is not empty</Highlight></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><Highlight kind="comment">  /// and the value is not zero. Equals to the size of the underlying vector</Highlight></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><Highlight kind="comment">  /// when the set is empty. When the value is 0, as in the beginning, the</Highlight></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"><Highlight kind="comment">  /// first element may or may not be valid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> FirstValidElement = 0;</Highlight></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><Highlight kind="comment">  /// Inserts a new element to the collection.</Highlight></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><Highlight kind="comment">  /// \\returns true if the element is actually added, i.e. was not in the</Highlight></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><Highlight kind="comment">  /// collection before the operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a43f3dcfddac1a12f607ebf72f1a8d0e1"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a43f3dcfddac1a12f607ebf72f1a8d0e1">insert</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</Highlight></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NodeMap.insert(std::make&#95;pair(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, NodeList.size())).second) &#123;</Highlight></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><Highlight kind="normal">      NodeList.push&#95;back(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"><Highlight kind="comment">  /// Removes the element from the collection.</Highlight></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><Highlight kind="comment">  /// \\returns whether the element is actually removed, i.e. was in the</Highlight></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><Highlight kind="comment">  /// collection before the operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a3111b51f006f1833e4fecfeef0318afb"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a3111b51f006f1833e4fecfeef0318afb">erase</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</Highlight></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NodeMap.erase(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) &#123;</Highlight></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><Highlight kind="normal">      SkipRemovedElements(FirstValidElement);</Highlight></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><Highlight kind="comment">  /// Removes all elements and clears the collection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#ab2d3905e7ebf372e3a39250a5996352b"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#ab2d3905e7ebf372e3a39250a5996352b">clear</a>() &#123;</Highlight></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><Highlight kind="normal">    NodeMap.clear();</Highlight></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><Highlight kind="normal">    NodeList.clear();</Highlight></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><Highlight kind="normal">    FirstValidElement = 0;</Highlight></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><Highlight kind="comment">  /// \\returns an iterator that will iterate the elements in the order of</Highlight></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><Highlight kind="comment">  /// insertion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6f13e5c0f27b4c9cfc9cf8b5cc566a8d"><Highlight kind="normal">  iterator <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6f13e5c0f27b4c9cfc9cf8b5cc566a8d">begin</a>() &#123;</Highlight></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstValidElement == 0)</Highlight></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><Highlight kind="normal">      SkipRemovedElements(FirstValidElement);</Highlight></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>(</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, FirstValidElement);</Highlight></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"><Highlight kind="comment">  /// \\returns an iterator that points to the end of the collection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6aec8829d91ec29a4e5cbeb6245ed043"><Highlight kind="normal">  iterator <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6aec8829d91ec29a4e5cbeb6245ed043">end</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>(</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, NodeList.size()); &#125;</Highlight></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><Highlight kind="comment">  /// Returns the number of elements in the collection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a07c214df8becbb8a7dda21ce1edf723e"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a07c214df8becbb8a7dda21ce1edf723e">size</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NodeMap.size(); &#125;</Highlight></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><Highlight kind="comment">  /// \\returns 1 if the given element is in the collection, and 0 if otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aeea2f32da818130992720bbc84ad2dd8"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aeea2f32da818130992720bbc84ad2dd8">count</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NodeMap.count(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>); &#125;</Highlight></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><Highlight kind="normal"></Highlight><Highlight kind="keyword">private</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><Highlight kind="comment">  /// Updates the CurrentIndex so that it will point to a valid element.</Highlight></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><Highlight kind="comment">  /// If the element of NodeList at CurrentIndex is valid, it does not</Highlight></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><Highlight kind="comment">  /// change it. If there are no more valid elements, it updates CurrentIndex</Highlight></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><Highlight kind="comment">  /// to point to the end of the NodeList.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> SkipRemovedElements(</Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> &amp;CurrentIndex) &#123;</Highlight></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (CurrentIndex &lt; <a href="/docs/api/structs/nodelist">NodeList</a>.size()) &#123;</Highlight></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> it = NodeMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/structs/nodelist">NodeList</a>&#91;CurrentIndex&#93;);</Highlight></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the element has been deleted and added again later, NodeMap will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// point to a different index, so CurrentIndex will still be invalid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (it != NodeMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; it-&gt;second == CurrentIndex)</Highlight></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><Highlight kind="normal">      ++CurrentIndex;</Highlight></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee"><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator::PhiNodeSetIterator</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Set, </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> Start)</Highlight></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"><Highlight kind="normal">    : Set(Set), CurrentIndex(Start) &#123;&#125;</Highlight></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a6c9f931e2de047a28ce47c0bcc685996"><Highlight kind="normal"><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a6c9f931e2de047a28ce47c0bcc685996">PhiNodeSetIterator::operator&#42;</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrentIndex &lt; Set-&gt;<a href="/docs/api/structs/nodelist">NodeList</a>.size() &amp;&amp;</Highlight></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;PhiNodeSet access out of range&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Set-&gt;NodeList&#91;CurrentIndex&#93;;</Highlight></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a438449b3174971956b5dd708baaa94f5"><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a438449b3174971956b5dd708baaa94f5">PhiNodeSetIterator::operator++</a>() &#123;</Highlight></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrentIndex &lt; Set-&gt;<a href="/docs/api/structs/nodelist">NodeList</a>.size() &amp;&amp;</Highlight></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;PhiNodeSet access out of range&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><Highlight kind="normal">  ++CurrentIndex;</Highlight></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><Highlight kind="normal">  Set-&gt;SkipRemovedElements(CurrentIndex);</Highlight></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac376b169181845ba2cfdec5cebb9977a"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac376b169181845ba2cfdec5cebb9977a">PhiNodeSetIterator::operator==</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CurrentIndex == RHS.CurrentIndex;</Highlight></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a899d3d313258e6cda9bfed86f677775e"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a899d3d313258e6cda9bfed86f677775e">PhiNodeSetIterator::operator!=</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !((&#42;this) == RHS);</Highlight></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><Highlight kind="comment">/// Keep track of simplification of Phi nodes.</Highlight></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><Highlight kind="comment">/// Accept the set of all phi nodes and erase phi node from this set</Highlight></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><Highlight kind="comment">/// if it is simplified.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad7916c415b8025174aee1fd76cc49791">SimplificationTracker</a> &#123;</Highlight></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> Storage;</Highlight></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;SQ;</Highlight></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Tracks newly created Phi nodes. The elements are iterated by insertion</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> AllPhiNodes;</Highlight></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Tracks newly created Select nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;SelectInst &#42;, 32&gt;</a> AllSelectNodes;</Highlight></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad7916c415b8025174aee1fd76cc49791"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad7916c415b8025174aee1fd76cc49791">SimplificationTracker</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;sq) : SQ(sq) &#123;&#125;</Highlight></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SV = Storage.find(V);</Highlight></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SV == Storage.end())</Highlight></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> V;</Highlight></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><Highlight kind="normal">      V = SV-&gt;second;</Highlight></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ac632fa4ac33de997f4fc1b02b416462c"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ac632fa4ac33de997f4fc1b02b416462c">Simplify</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val) &#123;</Highlight></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 32&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 32&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><Highlight kind="normal">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Val);</Highlight></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>).second)</Highlight></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>))</Highlight></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PI), SQ)) &#123;</Highlight></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : PI-&gt;users())</Highlight></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><Highlight kind="normal">            WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Value&gt;</a>(U));</Highlight></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"><Highlight kind="normal">          <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e">Put</a>(PI, V);</Highlight></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"><Highlight kind="normal">          PI-&gt;replaceAllUsesWith(V);</Highlight></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(PI))</Highlight></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><Highlight kind="normal">            AllPhiNodes.erase(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</Highlight></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(PI))</Highlight></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><Highlight kind="normal">            AllSelectNodes.erase(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</Highlight></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"><Highlight kind="normal">          PI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(Val);</Highlight></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e">Put</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;From, <a href="/docs/api/classes/llvm/value">Value</a> &#42;To) &#123; Storage.insert(&#123;From, To&#125;); &#125;</Highlight></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad39fccc0304ca0ff35a57687380ca595"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad39fccc0304ca0ff35a57687380ca595">ReplacePhi</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;From, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;To) &#123;</Highlight></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OldReplacement = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(From);</Highlight></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (OldReplacement != From) &#123;</Highlight></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><Highlight kind="normal">      From = To;</Highlight></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><Highlight kind="normal">      To = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(OldReplacement);</Highlight></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><Highlight kind="normal">      OldReplacement = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(From);</Highlight></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(To &amp;&amp; <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(To) == To &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Replacement PHI node is already replaced.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e">Put</a>(From, To);</Highlight></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"><Highlight kind="normal">    From-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(To);</Highlight></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><Highlight kind="normal">    AllPhiNodes.erase(From);</Highlight></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><Highlight kind="normal">    From-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a97045da401020466ebf377db4daff677"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a97045da401020466ebf377db4daff677">newPhiNodes</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AllPhiNodes; &#125;</Highlight></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a171be14e737571f0ced63e6e045c3d09"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a171be14e737571f0ced63e6e045c3d09">insertNewPhi</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123; AllPhiNodes.insert(PN); &#125;</Highlight></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a686670a8c9fa5a87c2b290dde33c6e9a"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a686670a8c9fa5a87c2b290dde33c6e9a">insertNewSelect</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123; AllSelectNodes.insert(<a href="/docs/api/namespaces/llvm/si">SI</a>); &#125;</Highlight></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ae0734c5a43308ef23875b8f8cfea21f5"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ae0734c5a43308ef23875b8f8cfea21f5">countNewPhiNodes</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AllPhiNodes.size(); &#125;</Highlight></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#afed3db6a950184377c563f40bef74317"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#afed3db6a950184377c563f40bef74317">countNewSelectNodes</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AllSelectNodes.size(); &#125;</Highlight></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a510bd9f9dcdaa582836018148bc749c0"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a510bd9f9dcdaa582836018148bc749c0">destroyNewNodes</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;CommonType) &#123;</Highlight></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For safe erasing, replace the uses with dummy value first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Dummy = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CommonType);</Highlight></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AllPhiNodes) &#123;</Highlight></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Dummy);</Highlight></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><Highlight kind="normal">    AllPhiNodes.clear();</Highlight></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AllSelectNodes) &#123;</Highlight></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Dummy);</Highlight></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><Highlight kind="normal">    AllSelectNodes.clear();</Highlight></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><Highlight kind="comment">/// A helper class for combining addressing modes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a12d7bf62cc9469dcc8776c045ad91169">AddressingModeCombiner</a> &#123;</Highlight></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">typedef</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> FoldAddrToValueMapping;</Highlight></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">typedef</Highlight><Highlight kind="normal"> std::pair&lt;PHINode &#42;, PHINode &#42;&gt; PHIPair;</Highlight></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><Highlight kind="normal"></Highlight><Highlight kind="keyword">private</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"><Highlight kind="comment">  /// The addressing modes we&#39;ve collected.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ExtAddrMode, 16&gt;</a> AddrModes;</Highlight></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"><Highlight kind="comment">  /// The field in which the AddrModes differ, when we have more than one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><Highlight kind="normal">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">ExtAddrMode::FieldName</a> DifferentField = <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">ExtAddrMode::NoField</a>;</Highlight></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><Highlight kind="comment">  /// Are the AddrModes that we have all just equal to their original values?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllAddrModesTrivial = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><Highlight kind="comment">  /// Common Type for all different fields in addressing modes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CommonType = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><Highlight kind="comment">  /// SimplifyQuery for simplifyInstruction utility.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;SQ;</Highlight></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"><Highlight kind="comment">  /// Original Address.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Original;</Highlight></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><Highlight kind="comment">  /// Common value among addresses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CommonValue = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a12d7bf62cc9469dcc8776c045ad91169"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a12d7bf62cc9469dcc8776c045ad91169">AddressingModeCombiner</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;&#95;SQ, <a href="/docs/api/classes/llvm/value">Value</a> &#42;OriginalValue)</Highlight></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"><Highlight kind="normal">      : SQ(&#95;SQ), Original(OriginalValue) &#123;&#125;</Highlight></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a11b3fca9e6b5a0a86f833919280c8d6d"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a11b3fca9e6b5a0a86f833919280c8d6d">~AddressingModeCombiner</a>() &#123; eraseCommonValueIfDead(); &#125;</Highlight></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><Highlight kind="comment">  /// Get the combined AddrMode</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#ad554dafe341161df27c6e4762ce5ac82"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#ad554dafe341161df27c6e4762ce5ac82">getAddrMode</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AddrModes&#91;0&#93;; &#125;</Highlight></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><Highlight kind="comment">  /// Add a new AddrMode if it&#39;s compatible with the AddrModes we already</Highlight></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><Highlight kind="comment">  /// have.</Highlight></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><Highlight kind="comment">  /// \\return True iff we succeeded in doing so.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a68677e52356488f3516d001f127588a5"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a68677e52356488f3516d001f127588a5">addNewAddrMode</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;NewAddrMode) &#123;</Highlight></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Take note of if we have any non-trivial AddrModes, as we need to detect</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// when all AddrModes are trivial as then we would introduce a phi or select</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// which just duplicates what&#39;s already there.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><Highlight kind="normal">    AllAddrModesTrivial = AllAddrModesTrivial &amp;&amp; NewAddrMode.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af16961a6894c56bc7f08641a2538167d">isTrivial</a>();</Highlight></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is the first addrmode then everything is fine.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrModes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"><Highlight kind="normal">      AddrModes.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(NewAddrMode);</Highlight></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Figure out how different this is from the other address modes, which we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// can do just by comparing against the first one given that we only care</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// about the cumulative difference.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><Highlight kind="normal">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">ExtAddrMode::FieldName</a> ThisDifferentField =</Highlight></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><Highlight kind="normal">        AddrModes&#91;0&#93;.compare(NewAddrMode);</Highlight></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DifferentField == <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">ExtAddrMode::NoField</a>)</Highlight></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><Highlight kind="normal">      DifferentField = ThisDifferentField;</Highlight></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DifferentField != ThisDifferentField)</Highlight></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><Highlight kind="normal">      DifferentField = <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">ExtAddrMode::MultipleFields</a>;</Highlight></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If NewAddrMode differs in more than one dimension we cannot handle it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CanHandle = DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">ExtAddrMode::MultipleFields</a>;</Highlight></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If Scale Field is different then we reject.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><Highlight kind="normal">    CanHandle = CanHandle &amp;&amp; DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101">ExtAddrMode::ScaleField</a>;</Highlight></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We also must reject the case when base offset is different and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scale reg is not null, we cannot handle this case due to merge of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// different offsets will be used as ScaleReg.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"><Highlight kind="normal">    CanHandle = CanHandle &amp;&amp; (DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">ExtAddrMode::BaseOffsField</a> ||</Highlight></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><Highlight kind="normal">                              !NewAddrMode.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>);</Highlight></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We also must reject the case when GV is different and BaseReg installed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// due to we want to use base reg as a merge of GV values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><Highlight kind="normal">    CanHandle = CanHandle &amp;&amp; (DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">ExtAddrMode::BaseGVField</a> ||</Highlight></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><Highlight kind="normal">                              !NewAddrMode.HasBaseReg);</Highlight></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Even if NewAddMode is the same we still need to collect it due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// original value is different. And later we will need all original values</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as anchors during finding the common Phi node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CanHandle)</Highlight></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"><Highlight kind="normal">      AddrModes.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(NewAddrMode);</Highlight></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><Highlight kind="normal">      AddrModes.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CanHandle;</Highlight></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"><Highlight kind="comment">  /// Combine the addressing modes we&#39;ve collected into a single</Highlight></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><Highlight kind="comment">  /// addressing mode.</Highlight></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><Highlight kind="comment">  /// \\return True iff we successfully combined them or we only had one so</Highlight></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"><Highlight kind="comment">  /// didn&#39;t need to combine them anyway.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a063d1fe1021fb19338b10705adb5f075"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a063d1fe1021fb19338b10705adb5f075">combineAddrModes</a>() &#123;</Highlight></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have no AddrModes then they can&#39;t be combined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrModes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0)</Highlight></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A single AddrMode can trivially be combined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrModes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 || DifferentField == <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">ExtAddrMode::NoField</a>)</Highlight></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the AddrModes we collected are all just equal to the value they are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// derived from then combining them wouldn&#39;t do anything useful.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllAddrModesTrivial)</Highlight></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!addrModeCombiningAllowed())</Highlight></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Build a map between &lt;original value, basic block where we saw it&gt; to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// value of base register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Bail out if there is no common type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><Highlight kind="normal">    FoldAddrToValueMapping Map;</Highlight></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!initializeMap(Map))</Highlight></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><Highlight kind="normal">    CommonValue = findCommon(Map);</Highlight></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CommonValue)</Highlight></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><Highlight kind="normal">      AddrModes&#91;0&#93;.SetCombinedField(DifferentField, CommonValue, AddrModes);</Highlight></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CommonValue != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><Highlight kind="normal"></Highlight><Highlight kind="keyword">private</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"><Highlight kind="comment">  /// &#96;CommonValue&#96; may be a placeholder inserted by us.</Highlight></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><Highlight kind="comment">  /// If the placeholder is not used, we should remove this dead instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> eraseCommonValueIfDead() &#123;</Highlight></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CommonValue &amp;&amp; CommonValue-&gt;<a href="/docs/api/classes/llvm/value/#aba0055050d741f60b6e0523507a2c79f">getNumUses</a>() == 0)</Highlight></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CommonInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(CommonValue))</Highlight></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><Highlight kind="normal">        CommonInst-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><Highlight kind="comment">  /// Initialize Map with anchor values. For address seen</Highlight></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><Highlight kind="comment">  /// we set the value of different field saw in this address.</Highlight></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"><Highlight kind="comment">  /// At the same time we find a common type for different field we will</Highlight></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><Highlight kind="comment">  /// use to create new Phi/Select nodes. Keep it in CommonType field.</Highlight></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><Highlight kind="comment">  /// Return false if there is no common type found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> initializeMap(FoldAddrToValueMapping &amp;Map) &#123;</Highlight></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Keep track of keys where the value is null. We will need to replace it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// with constant null when we know the common type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> NullValue;</Highlight></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntPtrTy = SQ.<a href="/docs/api/structs/llvm/simplifyquery/#a0ffb6d79f6befe2030328bd1d7110feb">DL</a>.<a href="/docs/api/classes/llvm/datalayout/#a7a2619d0e489a4ba9c19a0d86a041d59">getIntPtrType</a>(AddrModes&#91;0&#93;.OriginalValue-&gt;getType());</Highlight></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;AM : AddrModes) &#123;</Highlight></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;DV = AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a98c66d9b5e8ace6575527d88e08fe378">GetFieldAsValue</a>(DifferentField, IntPtrTy);</Highlight></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DV) &#123;</Highlight></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/classes/llvm/type">Type</a> = DV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CommonType &amp;&amp; CommonType != <a href="/docs/api/classes/llvm/type">Type</a>)</Highlight></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><Highlight kind="normal">        CommonType = <a href="/docs/api/classes/llvm/type">Type</a>;</Highlight></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><Highlight kind="normal">        Map&#91;AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f">OriginalValue</a>&#93; = DV;</Highlight></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><Highlight kind="normal">        NullValue.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f">OriginalValue</a>);</Highlight></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CommonType &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;At least one non-null value must be!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V : NullValue)</Highlight></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>&#93; = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(CommonType);</Highlight></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"><Highlight kind="comment">  /// We have mapping between value A and other value B where B was a field in</Highlight></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><Highlight kind="comment">  /// addressing mode represented by A. Also we have an original value C</Highlight></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"><Highlight kind="comment">  /// representing an address we start with. Traversing from C through phi and</Highlight></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><Highlight kind="comment">  /// selects we ended up with A&#39;s in a map. This utility function tries to find</Highlight></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><Highlight kind="comment">  /// a value V which is a field in addressing mode C and traversing through phi</Highlight></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><Highlight kind="comment">  /// nodes and selects we will end up in corresponded values B in a map.</Highlight></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><Highlight kind="comment">  /// The utility will create a new Phi/Selects if needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The simple example looks as follows:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   p1 = b1 + 40</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   br cond BB2, BB3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   p2 = b2 + 40</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   br BB3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB3:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   p = phi &#91;p1, BB1&#93;, &#91;p2, BB2&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   v = load p</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Map is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   p1 -&gt; b1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   p2 -&gt; b2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Request is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   p -&gt; ?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The function tries to find or build phi &#91;b1, BB1&#93;, &#91;b2, BB2&#93; in BB3.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;findCommon(FoldAddrToValueMapping &amp;Map) &#123;</Highlight></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Tracks the simplification of newly created phi nodes. The reason we use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this mapping is because we will add new created Phi nodes in AddrToBase.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Simplification of Phi nodes is recursive, so some Phi node may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// be simplified after we added it to AddrToBase. In reality this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// simplification is possible only if original phi/selects were not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// simplified yet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Using this mapping we can find the current value in AddrToBase.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><Highlight kind="normal">    SimplificationTracker <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>(SQ);</Highlight></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// First step, DFS to create PHI nodes for all intermediate blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Also fill traverse order for the second step.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><Highlight kind="normal">    SmallVector&lt;Value &#42;, 32&gt; TraverseOrder;</Highlight></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><Highlight kind="normal">    InsertPlaceholders(Map, TraverseOrder, ST);</Highlight></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Second Step, fill new nodes by merged values and simplify if possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><Highlight kind="normal">    FillPlaceholders(Map, TraverseOrder, ST);</Highlight></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a732a4fb41e78c56627fb9748f00935ab">AddrSinkNewSelects</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewSelectNodes() &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.destroyNewNodes(CommonType);</Highlight></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now we&#39;d like to match New Phi nodes to existed ones.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> PhiNotMatchedCount = 0;</Highlight></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MatchPhiSet(ST, <a href="#afedfbc99c6b04e20643eb77da796d522">AddrSinkNewPhis</a>, PhiNotMatchedCount)) &#123;</Highlight></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.destroyNewNodes(CommonType);</Highlight></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(Original)-&gt;second);</Highlight></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result) &#123;</Highlight></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><Highlight kind="normal">      NumMemoryInstsPhiCreated += <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewPhiNodes() + PhiNotMatchedCount;</Highlight></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"><Highlight kind="normal">      NumMemoryInstsSelectCreated += <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewSelectNodes();</Highlight></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"><Highlight kind="comment">  /// Try to match PHI node to Candidate.</Highlight></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><Highlight kind="comment">  /// Matcher tracks the matched Phi nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MatchPhiNode(PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, PHINode &#42;Candidate,</Highlight></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><Highlight kind="normal">                    SmallSetVector&lt;PHIPair, 8&gt; &amp;Matcher,</Highlight></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><Highlight kind="normal">                    PhiNodeSet &amp;PhiNodesToMatch) &#123;</Highlight></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;PHIPair, 8&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><Highlight kind="normal">    Matcher.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&#123;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, Candidate&#125;);</Highlight></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><Highlight kind="normal">    SmallSet&lt;PHINode &#42;, 8&gt; MatchedPHIs;</Highlight></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"><Highlight kind="normal">    MatchedPHIs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</Highlight></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"><Highlight kind="normal">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, Candidate&#125;);</Highlight></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><Highlight kind="normal">    SmallSet&lt;PHIPair, 8&gt; Visited;</Highlight></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Item = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Item).second)</Highlight></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We iterate over all incoming values to Phi to compare them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If values are different and both of them Phi and the first one is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Phi we added (subject to match) and both of them is in the same basic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// block then we can match our pair if values match. So we state that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// these values match and add it to work list to verify that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : Item.first-&gt;blocks()) &#123;</Highlight></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FirstValue = Item.first-&gt;getIncomingValueForBlock(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SecondValue = Item.second-&gt;getIncomingValueForBlock(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstValue == SecondValue)</Highlight></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><Highlight kind="normal">        PHINode &#42;FirstPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(FirstValue);</Highlight></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><Highlight kind="normal">        PHINode &#42;SecondPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(SecondValue);</Highlight></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// One of them is not Phi or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The first one is not Phi node from the set we&#39;d like to match or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Phi nodes from different basic blocks then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// we will not be able to match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FirstPhi || !SecondPhi || !PhiNodesToMatch.count(FirstPhi) ||</Highlight></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326"><Highlight kind="normal">            FirstPhi-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != SecondPhi-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we already matched them then continue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Matcher.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(&#123;FirstPhi, SecondPhi&#125;))</Highlight></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// So the values are different and does not match. So we need them to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// match. (But we register no more than one match per PHI node, so that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// we won&#39;t later try to replace them twice.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MatchedPHIs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(FirstPhi).second)</Highlight></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><Highlight kind="normal">          Matcher.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&#123;FirstPhi, SecondPhi&#125;);</Highlight></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// But me must check it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><Highlight kind="normal">        WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;FirstPhi, SecondPhi&#125;);</Highlight></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><Highlight kind="comment">  /// For the given set of PHI nodes (in the SimplificationTracker) try</Highlight></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><Highlight kind="comment">  /// to find their equivalents.</Highlight></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"><Highlight kind="comment">  /// Returns false if this matching fails and creation of new Phi is disabled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MatchPhiSet(SimplificationTracker &amp;ST, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowNewPhiNodes,</Highlight></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><Highlight kind="normal">                   </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;PhiNotMatchedCount) &#123;</Highlight></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Matched and PhiNodesToMatch iterate their elements in a deterministic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// order, so the replacements (ReplacePhi) are also done in a deterministic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><Highlight kind="normal">    SmallSetVector&lt;PHIPair, 8&gt; Matched;</Highlight></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><Highlight kind="normal">    SmallPtrSet&lt;PHINode &#42;, 8&gt; WillNotMatch;</Highlight></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><Highlight kind="normal">    PhiNodeSet &amp;PhiNodesToMatch = <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.newPhiNodes();</Highlight></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (PhiNodesToMatch.size()) &#123;</Highlight></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><Highlight kind="normal">      PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = &#42;PhiNodesToMatch.begin();</Highlight></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add us, if no Phi nodes in the basic block we do not match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><Highlight kind="normal">      WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</Highlight></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><Highlight kind="normal">      WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</Highlight></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Traverse all Phis until we found equivalent or fail to do that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsMatched = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent()-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Skip new Phi nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PhiNodesToMatch.count(&amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>))</Highlight></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((IsMatched = MatchPhiNode(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, Matched, PhiNodesToMatch)))</Highlight></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If it does not match, collect all Phi nodes from matcher.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// if we end up with no match, them all these Phi nodes will not match</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> M : Matched)</Highlight></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><Highlight kind="normal">          WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.first);</Highlight></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><Highlight kind="normal">        Matched.clear();</Highlight></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsMatched) &#123;</Highlight></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Replace all matched values and erase them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MV : Matched)</Highlight></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.ReplacePhi(MV.first, MV.second);</Highlight></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><Highlight kind="normal">        Matched.clear();</Highlight></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we are not allowed to create new nodes then bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllowNewPhiNodes)</Highlight></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Just remove all seen values in matcher. They will not match anything.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><Highlight kind="normal">      PhiNotMatchedCount += WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>();</Highlight></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : WillNotMatch)</Highlight></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><Highlight kind="normal">        PhiNodesToMatch.erase(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</Highlight></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><Highlight kind="normal">  &#125;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><Highlight kind="comment">  /// Fill the placeholders with values from predecessors and simplify them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> FillPlaceholders(FoldAddrToValueMapping &amp;Map,</Highlight></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><Highlight kind="normal">                        SmallVectorImpl&lt;Value &#42;&gt; &amp;TraverseOrder,</Highlight></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><Highlight kind="normal">                        SimplificationTracker &amp;ST) &#123;</Highlight></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!TraverseOrder.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Current = TraverseOrder.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(Current) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No node to fill!!!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93;;</Highlight></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SelectInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// CurrentValue also must be Select.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CurrentSelect = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(Current);</Highlight></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;TrueValue = CurrentSelect-&gt;getTrueValue();</Highlight></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(TrueValue) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No True Value!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;setTrueValue(<a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map&#91;TrueValue&#93;));</Highlight></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FalseValue = CurrentSelect-&gt;getFalseValue();</Highlight></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(FalseValue) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No False Value!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;setFalseValue(<a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map&#91;FalseValue&#93;));</Highlight></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Must be a Phi node then.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(V);</Highlight></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Fill the Phi node with values from predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent())) &#123;</Highlight></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(Current)-&gt;getIncomingValueForBlock(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(PV) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No predecessor Value!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(<a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map&#91;PV&#93;), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93; = <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Simplify(V);</Highlight></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><Highlight kind="comment">  /// Starting from original value recursively iterates over def-use chain up to</Highlight></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><Highlight kind="comment">  /// known ending values represented in a map. For each traversed phi/select</Highlight></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><Highlight kind="comment">  /// inserts a placeholder Phi or Select.</Highlight></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><Highlight kind="comment">  /// Reports all new created Phi/Select nodes by adding them to set.</Highlight></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"><Highlight kind="comment">  /// Also reports and order in what values have been traversed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> InsertPlaceholders(FoldAddrToValueMapping &amp;Map,</Highlight></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><Highlight kind="normal">                          SmallVectorImpl&lt;Value &#42;&gt; &amp;TraverseOrder,</Highlight></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><Highlight kind="normal">                          SimplificationTracker &amp;ST) &#123;</Highlight></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><Highlight kind="normal">    SmallVector&lt;Value &#42;, 32&gt; Worklist;</Highlight></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Original) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(Original)) &amp;&amp;</Highlight></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Address must be a Phi or Select node&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/nvptxisd/#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a> = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CommonType);</Highlight></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Original);</Highlight></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Current = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// if it is already visited or it is an ending value then skip it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(Current))</Highlight></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><Highlight kind="normal">      TraverseOrder.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Current);</Highlight></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// CurrentValue must be a Phi node or select. All others must be covered</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// by anchors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SelectInst &#42;CurrentSelect = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Current)) &#123;</Highlight></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Is it OK to get metadata from OrigSelect?!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Create a Select placeholder with dummy value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><Highlight kind="normal">        SelectInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> =</Highlight></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(CurrentSelect-&gt;getCondition(), Dummy, Dummy,</Highlight></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><Highlight kind="normal">                               CurrentSelect-&gt;getName(),</Highlight></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><Highlight kind="normal">                               CurrentSelect-&gt;getIterator(), CurrentSelect);</Highlight></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93; = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>;</Highlight></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.insertNewSelect(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</Highlight></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We are interested in True and False values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurrentSelect-&gt;getTrueValue());</Highlight></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurrentSelect-&gt;getFalseValue());</Highlight></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// It must be a Phi node then.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><Highlight kind="normal">        PHINode &#42;CurrentPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(Current);</Highlight></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> PredCount = CurrentPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</Highlight></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><Highlight kind="normal">        PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> =</Highlight></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(CommonType, PredCount, </Highlight><Highlight kind="stringliteral">&quot;sunk&#95;phi&quot;</Highlight><Highlight kind="normal">, CurrentPhi-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93; = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</Highlight></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.insertNewPhi(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</Highlight></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Worklist, CurrentPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>());</Highlight></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> addrModeCombiningAllowed() &#123;</Highlight></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aa653d45524ba8feb6e97dd4f961b7c3e">DisableComplexAddrModes</a>)</Highlight></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (DifferentField) &#123;</Highlight></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">ExtAddrMode::BaseRegField</a>:</Highlight></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a44b23d217bd678cd7aef7d152d945537">AddrSinkCombineBaseReg</a>;</Highlight></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">ExtAddrMode::BaseGVField</a>:</Highlight></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a51f303fd2cc8c48e50ab97c59f3558cc">AddrSinkCombineBaseGV</a>;</Highlight></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">ExtAddrMode::BaseOffsField</a>:</Highlight></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a3a00df51e1fa276c0c8860fe5ac1f95c">AddrSinkCombineBaseOffs</a>;</Highlight></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ExtAddrMode::ScaledRegField</a>:</Highlight></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a984c73ae4b3ecbd1c9a237c11e38ac62">AddrSinkCombineScaledReg</a>;</Highlight></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><Highlight kind="comment">/// Try adding ScaleReg&#42;Scale to the current addressing mode.</Highlight></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><Highlight kind="comment">/// Return true and update AddrMode if this addr mode is legal for the target,</Highlight></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><Highlight kind="comment">/// false if not.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddressingModeMatcher::matchScaledValue(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ScaleReg, int64&#95;t Scale,</Highlight></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><Highlight kind="normal">                                             </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) &#123;</Highlight></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If Scale is 1, then this is the same as adding ScaleReg to the addressing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mode.  Just process that directly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Scale == 1)</Highlight></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> matchAddr(ScaleReg, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the scale is 0, it takes nothing to add this.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Scale == 0)</Highlight></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we already have a scale of this value, we can add to it, otherwise, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// need an available scale field.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrMode.Scale != 0 &amp;&amp; AddrMode.ScaledReg != ScaleReg)</Highlight></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><Highlight kind="normal">  ExtAddrMode TestAddrMode = AddrMode;</Highlight></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add scale to turn X&#42;4+X&#42;3 -&gt; X&#42;7.  This could also do things like</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#91;A+B + A&#42;7&#93; -&gt; &#91;B+A&#42;8&#93;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><Highlight kind="normal">  TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> += Scale;</Highlight></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><Highlight kind="normal">  TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = ScaleReg;</Highlight></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the new address isn&#39;t legal, bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI.isLegalAddressingMode(DL, TestAddrMode, AccessTy, AddrSpace))</Highlight></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It was legal, so commit it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><Highlight kind="normal">  AddrMode = TestAddrMode;</Highlight></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Okay, we decided that we can add ScaleReg+Scale to AddrMode.  Check now</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to see if ScaleReg is actually X+C.  If so, we can turn this into adding</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// X&#42;Scale + C&#42;Scale to addr mode. If we found available IV increment, do not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// go any further: we can reuse it and cannot eliminate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><Highlight kind="normal">  ConstantInt &#42;CI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AddLHS = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(ScaleReg) &amp;&amp; </Highlight><Highlight kind="comment">// not a constant expr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScaleReg, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(AddLHS), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(CI))) &amp;&amp;</Highlight></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><Highlight kind="normal">      !<a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(ScaleReg, &amp;LI) &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a87d50d10274efe9688166584391ae489">isSignedIntN</a>(64)) &#123;</Highlight></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"><Highlight kind="normal">    TestAddrMode.InBounds = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><Highlight kind="normal">    TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = AddLHS;</Highlight></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"><Highlight kind="normal">    TestAddrMode.BaseOffs += CI-&gt;<a href="/docs/api/classes/llvm/constantint/#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>() &#42; TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a>;</Highlight></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this addressing mode is legal, commit it and remember that we folded</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.isLegalAddressingMode(DL, TestAddrMode, AccessTy, AddrSpace)) &#123;</Highlight></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><Highlight kind="normal">      AddrModeInsts.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ScaleReg));</Highlight></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><Highlight kind="normal">      AddrMode = TestAddrMode;</Highlight></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Restore status quo.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><Highlight kind="normal">    TestAddrMode = AddrMode;</Highlight></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is an add recurrence with a constant step, return the increment</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction and the canonicalized step.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetConstantStep =</Highlight></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><Highlight kind="normal">      &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>) -&gt; std::optional&lt;std::pair&lt;Instruction &#42;, APInt&gt;&gt; &#123;</Highlight></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V);</Highlight></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PN)</Highlight></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IVInc = <a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(PN, &amp;LI);</Highlight></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IVInc)</Highlight></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: The result of the intrinsics above is two-complement. However when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// IV inc is expressed as add or sub, iv.next is potentially a poison value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If it has nuw or nsw flags, we need to make sure that these flags are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inferrable at the point of memory instruction. Otherwise we are replacing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// well-defined two-complement computation with poison. Currently, to avoid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// potentially complex analysis needed to prove this, we reject such cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OIVInc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(IVInc-&gt;first))</Highlight></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OIVInc-&gt;hasNoSignedWrap() || OIVInc-&gt;hasNoUnsignedWrap())</Highlight></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ConstantStep = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(IVInc-&gt;second))</Highlight></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(IVInc-&gt;first, ConstantStep-&gt;getValue());</Highlight></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to account for the following special case:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 ScaleReg is an inductive variable;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 We use it with non-zero offset;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3 IV&#39;s increment is available at the point of memory instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In this case, we may reuse the IV increment instead of the IV Phi to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// achieve the following advantages:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 If IV step matches the offset, we will have no need in the offset;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 Even if they don&#39;t match, we will reduce the overlap of living IV</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    and IV increment, that will potentially lead to better register</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    assignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrMode.BaseOffs) &#123;</Highlight></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IVStep = GetConstantStep(ScaleReg)) &#123;</Highlight></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;IVInc = IVStep-&gt;first;</Highlight></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The following assert is important to ensure a lack of infinite loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This transforms is (intentionally) the inverse of the one just above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If they don&#39;t agree on the definition of an increment, we&#39;d alternate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// back and forth indefinitely.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(IVInc, &amp;LI) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;implied by GetConstantStep&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><Highlight kind="normal">      APInt Step = IVStep-&gt;second;</Highlight></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><Highlight kind="normal">      APInt <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = Step &#42; AddrMode.Scale;</Highlight></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.isSignedIntN(64)) &#123;</Highlight></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><Highlight kind="normal">        TestAddrMode.InBounds = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><Highlight kind="normal">        TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = IVInc;</Highlight></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><Highlight kind="normal">        TestAddrMode.BaseOffs -= <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getLimitedValue();</Highlight></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If this addressing mode is legal, commit it..</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// (Note that we defer the (expensive) domtree base legality check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to the very last possible point.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.isLegalAddressingMode(DL, TestAddrMode, AccessTy, AddrSpace) &amp;&amp;</Highlight></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><Highlight kind="normal">            getDTFn().<a href="/docs/api/files/lib/lib/codegen/regallocfast-cpp/#a73ba38b119a12eb092295458fde44f52">dominates</a>(IVInc, MemoryInst)) &#123;</Highlight></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><Highlight kind="normal">          AddrModeInsts.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(IVInc));</Highlight></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><Highlight kind="normal">          AddrMode = TestAddrMode;</Highlight></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Restore status quo.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><Highlight kind="normal">        TestAddrMode = AddrMode;</Highlight></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, just return what we have.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><Highlight kind="comment">/// This is a little filter, which returns true if an addressing computation</Highlight></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><Highlight kind="comment">/// involving I might be folded into a load/store accessing it.</Highlight></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><Highlight kind="comment">/// This doesn&#39;t need to be perfect, but needs to accept at least</Highlight></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><Highlight kind="comment">/// the set of instructions that MatchOperationAddr can.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621" lineLink="#a9d0372d5a469c089a4f2a299dd679558"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::BitCast:</Highlight></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AddrSpaceCast:</Highlight></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t touch identity bitcasts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType())</Highlight></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isIntOrPtrTy();</Highlight></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::PtrToInt:</Highlight></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// PtrToInt is always a noop, as we know that the int type is pointer sized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::IntToPtr:</Highlight></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We know the input is intptr&#95;t, so this is foldable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl:</Highlight></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Can only handle X&#42;C and X &lt;&lt; C.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::GetElementPtr:</Highlight></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"><Highlight kind="comment">/// Check whether or not \\p Val is a legal instruction for \\p TLI.</Highlight></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649"><Highlight kind="comment">/// \\note \\p Val is assumed to be the product of some type promotion.</Highlight></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"><Highlight kind="comment">/// Therefore if \\p Val has an undefined state in \\p TLI, this is assumed</Highlight></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"><Highlight kind="comment">/// to be legal, as the non-promoted value would have had the same state.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652" lineLink="#aca87c42e8556b7f2e73454d63efa87f2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val) &#123;</Highlight></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PromotedInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val);</Highlight></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PromotedInst)</Highlight></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> ISDOpcode = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a025e6664b2f55d2c217543c34eb1f64e">InstructionOpcodeToISD</a>(PromotedInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</Highlight></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the ISDOpcode is undefined, it was undefined before the promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ISDOpcode)</Highlight></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, check if the promoted instruction is legal or not.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(</Highlight></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><Highlight kind="normal">      ISDOpcode, TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, PromotedInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><Highlight kind="comment">/// Hepler class to perform type promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper">TypePromotionHelper</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"><Highlight kind="comment">  /// Utility function to add a promoted instruction \\p ExtOpnd to</Highlight></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><Highlight kind="comment">  /// \\p PromotedInsts and record the type of extension we have seen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> addPromotedInst(<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</Highlight></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"><Highlight kind="normal">                              <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExtOpnd, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt) &#123;</Highlight></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> ExtTy = IsSExt ? <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de">SignExtension</a> : <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8">ZeroExtension</a>;</Highlight></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemapbase/#a214e872d61db2ea8cb023f127cafd0b9">InstrToOrigTy::iterator</a> It = PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(ExtOpnd);</Highlight></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It != PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the new extension is same as original, the information in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// PromotedInsts&#91;ExtOpnd&#93; is still correct.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It-&gt;second.getInt() == ExtTy)</Highlight></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Now the new extension is different from old extension, we make</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the type information invalid by setting extension type to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// BothExtension.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><Highlight kind="normal">      ExtTy = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fad4ce99b4684baf70c4310e9a2ae58597">BothExtension</a>;</Highlight></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"><Highlight kind="normal">    PromotedInsts&#91;ExtOpnd&#93; = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a17cdfc9d4da684f5f8b3c97c8706c28e">TypeIsSExt</a>(ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), ExtTy);</Highlight></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"><Highlight kind="comment">  /// Utility function to query the original type of instruction \\p Opnd</Highlight></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"><Highlight kind="comment">  /// with a matched extension type. If the extension doesn&#39;t match, we</Highlight></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><Highlight kind="comment">  /// cannot use the information we had on the original type.</Highlight></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><Highlight kind="comment">  /// BothExtension doesn&#39;t match any extension type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;getOrigType(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</Highlight></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt) &#123;</Highlight></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> ExtTy = IsSExt ? <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de">SignExtension</a> : <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8">ZeroExtension</a>;</Highlight></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemapbase/#a5784c312872bef21d9344dae0a0e8fc0">InstrToOrigTy::const&#95;iterator</a> It = PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Opnd);</Highlight></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It != PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; It-&gt;second.getInt() == ExtTy)</Highlight></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> It-&gt;second.getPointer();</Highlight></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"><Highlight kind="comment">  /// Utility function to check whether or not a sign or zero extension</Highlight></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"><Highlight kind="comment">  /// of \\p Inst with \\p ConsideredExtType can be moved through \\p Inst by</Highlight></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><Highlight kind="comment">  /// either using the operands of \\p Inst or promoting \\p Inst.</Highlight></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"><Highlight kind="comment">  /// The type of the extension is defined by \\p IsSExt.</Highlight></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><Highlight kind="comment">  /// In other words, check if:</Highlight></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"><Highlight kind="comment">  /// ext (Ty Inst opnd1 opnd2 ... opndN) to ConsideredExtType.</Highlight></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><Highlight kind="comment">  /// #1 Promotion applies:</Highlight></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"><Highlight kind="comment">  /// ConsideredExtType Inst (ext opnd1 to ConsideredExtType, ...).</Highlight></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711"><Highlight kind="comment">  /// #2 Operand reuses:</Highlight></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712"><Highlight kind="comment">  /// ext opnd1 to ConsideredExtType.</Highlight></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><Highlight kind="comment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> canGetThrough(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ConsideredExtType,</Highlight></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"><Highlight kind="normal">                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt);</Highlight></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><Highlight kind="comment">  /// Utility function to determine if \\p OpIdx should be promoted when</Highlight></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><Highlight kind="comment">  /// promoting \\p Inst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> shouldExtOperand(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> OpIdx) &#123;</Highlight></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(Inst) &amp;&amp; OpIdx == 0);</Highlight></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><Highlight kind="comment">  /// Utility function to promote the operand of \\p Ext when this</Highlight></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><Highlight kind="comment">  /// operand is a promotable trunc or sext or zext.</Highlight></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"><Highlight kind="comment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</Highlight></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><Highlight kind="comment">  /// \\p CreatedInstsCost&#91;out&#93; contains the cost of all instructions</Highlight></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"><Highlight kind="comment">  /// created to promote the operand of Ext.</Highlight></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><Highlight kind="comment">  /// Newly added extensions are inserted in \\p Exts.</Highlight></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"><Highlight kind="comment">  /// Newly added truncates are inserted in \\p Truncs.</Highlight></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><Highlight kind="comment">  /// Should never be called directly.</Highlight></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><Highlight kind="comment">  /// \\return The promoted value which is used instead of Ext.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;promoteOperandForTruncAndAnyExt(</Highlight></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</Highlight></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI);</Highlight></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"><Highlight kind="comment">  /// Utility function to promote the operand of \\p Ext when this</Highlight></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"><Highlight kind="comment">  /// operand is promotable and is not a supported trunc or sext.</Highlight></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><Highlight kind="comment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</Highlight></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"><Highlight kind="comment">  /// \\p CreatedInstsCost&#91;out&#93; contains the cost of all the instructions</Highlight></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"><Highlight kind="comment">  /// created to promote the operand of Ext.</Highlight></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><Highlight kind="comment">  /// Newly added extensions are inserted in \\p Exts.</Highlight></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"><Highlight kind="comment">  /// Newly added truncates are inserted in \\p Truncs.</Highlight></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><Highlight kind="comment">  /// Should never be called directly.</Highlight></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"><Highlight kind="comment">  /// \\return The promoted value which is used instead of Ext.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;promoteOperandForOther(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext,</Highlight></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"><Highlight kind="normal">                                       <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><Highlight kind="normal">                                       <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</Highlight></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><Highlight kind="normal">                                       </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</Highlight></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs,</Highlight></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt);</Highlight></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><Highlight kind="comment">  /// \\see promoteOperandForOther.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;signExtendOperandForOther(</Highlight></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</Highlight></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> promoteOperandForOther(Ext, TPT, PromotedInsts, CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><Highlight kind="normal">                                  Exts, Truncs, TLI, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><Highlight kind="comment">  /// \\see promoteOperandForOther.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;zeroExtendOperandForOther(</Highlight></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</Highlight></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> promoteOperandForOther(Ext, TPT, PromotedInsts, CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><Highlight kind="normal">                                  Exts, Truncs, TLI, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><Highlight kind="comment">  /// Type for the utility function that promotes the operand of Ext.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">Action</a> = <a href="/docs/api/classes/llvm/value">Value</a> &#42;(&#42;)(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"><Highlight kind="normal">                            <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</Highlight></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"><Highlight kind="normal">                            </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</Highlight></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs,</Highlight></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"><Highlight kind="normal">                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI);</Highlight></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"><Highlight kind="comment">  /// Given a sign/zero extend instruction \\p Ext, return the appropriate</Highlight></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"><Highlight kind="comment">  /// action to promote the operand of \\p Ext instead of using Ext.</Highlight></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786"><Highlight kind="comment">  /// \\return NULL if no promotable action is possible with the current</Highlight></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><Highlight kind="comment">  /// sign extension.</Highlight></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"><Highlight kind="comment">  /// \\p InsertedInsts keeps track of all the instructions inserted by the</Highlight></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><Highlight kind="comment">  /// other CodeGenPrepare optimizations. This information is important</Highlight></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"><Highlight kind="comment">  /// because we do not want to promote these instructions as CodeGenPrepare</Highlight></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"><Highlight kind="comment">  /// will reinsert them later. Thus creating an infinite loop: create/remove.</Highlight></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"><Highlight kind="comment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">Action</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">getAction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts,</Highlight></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><Highlight kind="normal">                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"><Highlight kind="normal">                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts);</Highlight></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> TypePromotionHelper::canGetThrough(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</Highlight></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/type">Type</a> &#42;ConsideredExtType,</Highlight></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><Highlight kind="normal">                                        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</Highlight></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt) &#123;</Highlight></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The promotion helper does not know how to deal with vector types yet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To be able to fix that, we would need to fix the places where we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// statically extend, e.g., constants and such.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</Highlight></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can always get through zext.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Inst))</Highlight></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// sext(sext) is ok too.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsSExt &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Inst))</Highlight></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can get through binary operator, if it is legal. In other words, the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// binary operator must have a nuw or nsw flag.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(Inst))</Highlight></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;OverflowingBinaryOperator&gt;</a>(BinOp) &amp;&amp;</Highlight></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"><Highlight kind="normal">        ((!IsSExt &amp;&amp; BinOp-&gt;hasNoUnsignedWrap()) ||</Highlight></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><Highlight kind="normal">         (IsSExt &amp;&amp; BinOp-&gt;hasNoSignedWrap())))</Highlight></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ext(and(opnd, cst)) --&gt; and(ext(opnd), ext(cst))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::And ||</Highlight></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"><Highlight kind="normal">       Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Or))</Highlight></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ext(xor(opnd, cst)) --&gt; xor(ext(opnd), ext(cst))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Xor) &#123;</Highlight></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure it is not a NOT.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</Highlight></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cst-&gt;getValue().isAllOnes())</Highlight></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// zext(shrl(opnd, cst)) --&gt; shrl(zext(opnd), zext(cst))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It may change a poisoned value into a regular value, like</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     zext i32 (shrl i8 %val, 12)  --&gt;  shrl i32 (zext i8 %val), 12</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//          poisoned value                    regular value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It should be OK since undef covers valid value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::LShr &amp;&amp; !IsSExt)</Highlight></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and(ext(shl(opnd, cst)), cst) --&gt; and(shl(ext(opnd), ext(cst)), cst)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It may change a poisoned value into a regular value, like</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     zext i32 (shl i8 %val, 12)  --&gt;  shl i32 (zext i8 %val), 12</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//          poisoned value                    regular value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It should be OK since undef covers valid value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Shl &amp;&amp; Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</Highlight></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;const Instruction&gt;</a>(&#42;Inst-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>());</Highlight></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtInst-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AndInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;const Instruction&gt;</a>(&#42;ExtInst-&gt;user&#95;begin());</Highlight></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AndInst &amp;&amp; AndInst-&gt;getOpcode() == Instruction::And) &#123;</Highlight></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AndInst-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Cst &amp;&amp;</Highlight></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"><Highlight kind="normal">            Cst-&gt;getValue().isIntN(Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()))</Highlight></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we can do the following simplification.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ext(trunc(opnd)) --&gt; ext(opnd)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Inst))</Highlight></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OpndVal = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we can use this operand in the extension.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the type is larger than the result type of the extension, we cannot.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OpndVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</Highlight></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><Highlight kind="normal">      OpndVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;</Highlight></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><Highlight kind="normal">          ConsideredExtType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>())</Highlight></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the operand of the truncate is not an instruction, we will not have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any information on the dropped bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (Actually we could for constant but it is not worth the extra logic).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;Opnd = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(OpndVal);</Highlight></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Opnd)</Highlight></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the source of the type is narrow enough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// I.e., check that trunc just drops extended bits of the same kind of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the extension.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// #1 get the type of the operand and check the kind of the extended bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;OpndType = getOrigType(PromotedInsts, Opnd, IsSExt);</Highlight></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpndType)</Highlight></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"><Highlight kind="normal">    ;</Highlight></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((IsSExt &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Opnd)) || (!IsSExt &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Opnd)))</Highlight></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><Highlight kind="normal">    OpndType = Opnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// #2 check that the truncate just drops extended bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;=</Highlight></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"><Highlight kind="normal">         OpndType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>();</Highlight></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581"><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">TypePromotionHelper::Action</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">TypePromotionHelper::getAction</a>(</Highlight></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts,</Highlight></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts) &#123;</Highlight></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Ext) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Ext)) &amp;&amp;</Highlight></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Unexpected instruction type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExtOpnd = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Ext-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ExtTy = Ext-&gt;getType();</Highlight></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Ext);</Highlight></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the operand of the extension is not an instruction, we cannot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// get through.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If it, check we can get through.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExtOpnd || !canGetThrough(ExtOpnd, ExtTy, PromotedInsts, IsSExt))</Highlight></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not promote if the operand has been added by codegenprepare.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, it means we are undoing an optimization that is likely to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// redone, thus causing potential infinite loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(ExtOpnd) &amp;&amp; InsertedInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(ExtOpnd))</Highlight></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// SExt or Trunc instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Return the related handler.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(ExtOpnd) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(ExtOpnd) ||</Highlight></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(ExtOpnd))</Highlight></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> promoteOperandForTruncAndAnyExt;</Highlight></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Regular instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Abort early if we will have to insert non-free instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a6f992bc4ca89f1b5f0b34f5b29978c31">isTruncateFree</a>(ExtTy, ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</Highlight></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IsSExt ? signExtendOperandForOther : zeroExtendOperandForOther;</Highlight></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;TypePromotionHelper::promoteOperandForTruncAndAnyExt(</Highlight></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;SExt, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</Highlight></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// By construction, the operand of SExt is an instruction. Otherwise we cannot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// get through it and this method should not be called.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;SExtOpnd = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(SExt-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtVal = SExt;</Highlight></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasMergedNonFreeExt = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(SExtOpnd)) &#123;</Highlight></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace s|zext(zext(opnd))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// =&gt; zext(opnd).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"><Highlight kind="normal">    HasMergedNonFreeExt = !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(SExtOpnd);</Highlight></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ZExt =</Highlight></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><Highlight kind="normal">        TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a40e7a7b00ec46903a6a39e28b30da046">createZExt</a>(SExt, SExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), SExt-&gt;getType());</Highlight></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"><Highlight kind="normal">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ad7595fd2ce173a5034cbc5f2376978e6">replaceAllUsesWith</a>(SExt, ZExt);</Highlight></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><Highlight kind="normal">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">eraseInstruction</a>(SExt);</Highlight></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><Highlight kind="normal">    ExtVal = ZExt;</Highlight></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace z|sext(trunc(opnd)) or sext(sext(opnd))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// =&gt; z|sext(opnd).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><Highlight kind="normal">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a5a651fca694e060abd7d17d6cf34fe51">setOperand</a>(SExt, 0, SExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"><Highlight kind="normal">  CreatedInstsCost = 0;</Highlight></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove dead code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</Highlight></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><Highlight kind="normal">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">eraseInstruction</a>(SExtOpnd);</Highlight></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the extension is still needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(ExtVal);</Highlight></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExtInst || ExtInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != ExtInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</Highlight></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtInst) &#123;</Highlight></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Exts)</Highlight></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><Highlight kind="normal">        Exts-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ExtInst);</Highlight></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"><Highlight kind="normal">      CreatedInstsCost = !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(ExtInst) &amp;&amp; !HasMergedNonFreeExt;</Highlight></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ExtVal;</Highlight></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// At this point we have: ext ty opnd to ty.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reassign the uses of ExtInst to the opnd and remove ExtInst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NextVal = ExtInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"><Highlight kind="normal">  TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">eraseInstruction</a>(ExtInst, NextVal);</Highlight></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NextVal;</Highlight></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TypePromotionHelper::promoteOperandForOther(</Highlight></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><Highlight kind="normal">    Instruction &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;CreatedInstsCost,</Highlight></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"><Highlight kind="normal">    SmallVectorImpl&lt;Instruction &#42;&gt; &#42;Exts,</Highlight></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"><Highlight kind="normal">    SmallVectorImpl&lt;Instruction &#42;&gt; &#42;Truncs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> TargetLowering &amp;TLI,</Highlight></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt) &#123;</Highlight></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// By construction, the operand of Ext is an instruction. Otherwise we cannot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// get through it and this method should not be called.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtOpnd = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><Highlight kind="normal">  CreatedInstsCost = 0;</Highlight></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</Highlight></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ExtOpnd will be promoted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All its uses, but Ext, will need to use a truncated value of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// promoted version.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create the truncate now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Trunc = TPT.createTrunc(Ext, ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Instruction &#42;ITrunc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Trunc)) &#123;</Highlight></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Insert it just after the definition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"><Highlight kind="normal">      ITrunc-&gt;moveAfter(ExtOpnd);</Highlight></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Truncs)</Highlight></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><Highlight kind="normal">        Truncs-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ITrunc);</Highlight></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><Highlight kind="normal">    TPT.replaceAllUsesWith(ExtOpnd, Trunc);</Highlight></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Restore the operand of Ext (which has been replaced by the previous call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to replaceAllUsesWith) to avoid creating a cycle trunc &lt;-&gt; sext.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><Highlight kind="normal">    TPT.setOperand(Ext, 0, ExtOpnd);</Highlight></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get through the Instruction:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 Update its type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 Replace the uses of Ext by Inst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3 Extend each operand that needs to be extended.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remember the original type of the instruction before promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is useful to know that the high bits are sign extended bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"><Highlight kind="normal">  addPromotedInst(PromotedInsts, ExtOpnd, IsSExt);</Highlight></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Step #1.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"><Highlight kind="normal">  TPT.mutateType(ExtOpnd, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Step #2.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023"><Highlight kind="normal">  TPT.replaceAllUsesWith(Ext, ExtOpnd);</Highlight></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Step #3.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Propagate Ext to operands\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> OpIdx = 0, EndOpIdx = ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); OpIdx != EndOpIdx;</Highlight></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"><Highlight kind="normal">       ++OpIdx) &#123;</Highlight></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Operand:\\n&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;(ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OpIdx)) &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OpIdx)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType() ||</Highlight></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"><Highlight kind="normal">        !shouldExtOperand(ExtOpnd, OpIdx)) &#123;</Highlight></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;No need to propagate\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if we can statically extend the operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Opnd = ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OpIdx);</Highlight></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ConstantInt &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Opnd)) &#123;</Highlight></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Statically extend\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType()-&gt;getIntegerBitWidth();</Highlight></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039"><Highlight kind="normal">      APInt CstVal = IsSExt ? Cst-&gt;getValue().sext(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)</Highlight></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><Highlight kind="normal">                            : Cst-&gt;getValue().zext(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>);</Highlight></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"><Highlight kind="normal">      TPT.setOperand(ExtOpnd, OpIdx, ConstantInt::get(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType(), CstVal));</Highlight></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// UndefValue are typed, so we have to statically sign extend them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Opnd)) &#123;</Highlight></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Statically extend\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><Highlight kind="normal">      TPT.setOperand(ExtOpnd, OpIdx, <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType()));</Highlight></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise we have to explicitly sign extend the operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ValForExtOpnd = IsSExt</Highlight></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"><Highlight kind="normal">                               ? TPT.createSExt(ExtOpnd, Opnd, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType())</Highlight></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><Highlight kind="normal">                               : TPT.createZExt(ExtOpnd, Opnd, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"><Highlight kind="normal">    TPT.setOperand(ExtOpnd, OpIdx, ValForExtOpnd);</Highlight></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;InstForExtOpnd = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(ValForExtOpnd);</Highlight></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InstForExtOpnd)</Highlight></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Exts)</Highlight></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"><Highlight kind="normal">      Exts-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(InstForExtOpnd);</Highlight></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><Highlight kind="normal">    CreatedInstsCost += !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(InstForExtOpnd);</Highlight></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Extension is useless now\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><Highlight kind="normal">  TPT.eraseInstruction(Ext);</Highlight></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ExtOpnd;</Highlight></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><Highlight kind="comment">/// Check whether or not promoting an instruction to a wider type is profitable.</Highlight></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"><Highlight kind="comment">/// \\p NewCost gives the cost of extension instructions created by the</Highlight></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"><Highlight kind="comment">/// promotion.</Highlight></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><Highlight kind="comment">/// \\p OldCost gives the cost of extension instructions before the promotion</Highlight></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><Highlight kind="comment">/// plus the number of instructions that have been</Highlight></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><Highlight kind="comment">/// matched in the addressing mode the promotion.</Highlight></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><Highlight kind="comment">/// \\p PromotedOperand is the value that has been promoted.</Highlight></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"><Highlight kind="comment">/// \\return True if the promotion is profitable, false otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddressingModeMatcher::isPromotionProfitable(</Highlight></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NewCost, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OldCost, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PromotedOperand)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;OldCost: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; OldCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\tNewCost: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; NewCost</Highlight></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The cost of the new extensions is greater than the cost of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// old extension plus what we folded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is not profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewCost &gt; OldCost)</Highlight></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewCost &lt; OldCost)</Highlight></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The promotion is neutral but it may help folding the sign extension in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loads for instance.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that we did not create an illegal instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(TLI, DL, PromotedOperand);</Highlight></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><Highlight kind="comment">/// Given an instruction or constant expr, see if we can fold the operation</Highlight></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"><Highlight kind="comment">/// into the addressing mode. If so, update the addressing mode and return</Highlight></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><Highlight kind="comment">/// true, otherwise return false without modifying AddrMode.</Highlight></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"><Highlight kind="comment">/// If \\p MovedAway is not NULL, it contains the information of whether or</Highlight></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"><Highlight kind="comment">/// not AddrInst has to be folded into the addressing mode on success.</Highlight></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"><Highlight kind="comment">/// If \\p MovedAway == true, \\p AddrInst will not be part of the addressing</Highlight></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><Highlight kind="comment">/// because it has been moved away.</Highlight></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><Highlight kind="comment">/// Thus AddrInst must not be added in the matched instructions.</Highlight></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><Highlight kind="comment">/// This state can happen when AddrInst is a sext, since it may be moved away.</Highlight></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"><Highlight kind="comment">/// Therefore, AddrInst may not be valid when MovedAway is true and it must</Highlight></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><Highlight kind="comment">/// not be referenced anymore.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddressingModeMatcher::matchOperationAddr(User &#42;AddrInst, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode,</Highlight></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"><Highlight kind="normal">                                               </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</Highlight></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><Highlight kind="normal">                                               </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#42;MovedAway) &#123;</Highlight></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Avoid exponential behavior on extremely deep expression trees.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt;= 5)</Highlight></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// By default, all matched instructions stay in place.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MovedAway)</Highlight></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"><Highlight kind="normal">    &#42;MovedAway = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Opcode) &#123;</Highlight></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::PtrToInt:</Highlight></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// PtrToInt is always a noop, as we know that the int type is pointer sized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::IntToPtr: &#123;</Highlight></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AS = AddrInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</Highlight></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> PtrTy = <a href="/docs/api/classes/llvm/mvt/#aded931e298cfa08b5038ca2b63c06bb8">MVT::getIntegerVT</a>(DL.getPointerSizeInBits(AS));</Highlight></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This inttoptr is a no-op if the integer type is pointer sized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.getValueType(DL, AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) == PtrTy)</Highlight></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::BitCast:</Highlight></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// BitCast is always a noop, and we can handle it as long as it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// int-&gt;int or pointer-&gt;pointer (we don&#39;t want int&lt;-&gt;fp or something).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#abf313eff420b7c6c8e322a2e9c53cd90">isIntOrPtrTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Don&#39;t touch identity bitcasts.  These were probably put here by LSR,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// and we don&#39;t want to mess around with them.  Assume it knows what it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// is doing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><Highlight kind="normal">        AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != AddrInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</Highlight></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AddrSpaceCast: &#123;</Highlight></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SrcAS =</Highlight></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"><Highlight kind="normal">        AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</Highlight></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> DestAS = AddrInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</Highlight></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.getTargetMachine().isNoopAddrSpaceCast(SrcAS, DestAS))</Highlight></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add: &#123;</Highlight></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check to see if we can merge in one operand, then the other.  If so, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// win.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><Highlight kind="normal">    ExtAddrMode BackupAddrMode = AddrMode;</Highlight></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OldSize = AddrModeInsts.size();</Highlight></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Start a transaction at this point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The LHS may match but not the RHS.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Therefore, we need a higher level restoration point to undo partially</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// matched operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</Highlight></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><Highlight kind="normal">        TPT.getRestorationPoint();</Highlight></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to match an integer constant second to increase its chance of ending</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// up in &#96;BaseOffs&#96;, resp. decrease its chance of ending up in &#96;BaseReg&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a> = 0, Second = 1;</Highlight></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>))</Highlight></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><Highlight kind="normal">      &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Second)))</Highlight></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"><Highlight kind="normal">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>, Second);</Highlight></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"><Highlight kind="normal">    AddrMode.InBounds = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1) &amp;&amp;</Highlight></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"><Highlight kind="normal">        matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Second), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</Highlight></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Restore the old addr mode info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"><Highlight kind="normal">    AddrMode = BackupAddrMode;</Highlight></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"><Highlight kind="normal">    AddrModeInsts.resize(OldSize);</Highlight></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><Highlight kind="normal">    TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise this was over-aggressive.  Try merging operands in the opposite</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Second), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1) &amp;&amp;</Highlight></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><Highlight kind="normal">        matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</Highlight></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise we definitely can&#39;t merge the ADD in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"><Highlight kind="normal">    AddrMode = BackupAddrMode;</Highlight></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"><Highlight kind="normal">    AddrModeInsts.resize(OldSize);</Highlight></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"><Highlight kind="normal">    TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case Instruction::Or:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  TODO: We can handle &quot;Or Val, Imm&quot; iff this OR is equivalent to an ADD.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// break;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl: &#123;</Highlight></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Can only handle X&#42;C and X &lt;&lt; C.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><Highlight kind="normal">    AddrMode.InBounds = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"><Highlight kind="normal">    ConstantInt &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> || <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getBitWidth() &gt; 64)</Highlight></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"><Highlight kind="normal">    int64&#95;t Scale = Opcode == Instruction::Shl</Highlight></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"><Highlight kind="normal">                        ? 1LL &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getLimitedValue(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getBitWidth() - 1)</Highlight></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"><Highlight kind="normal">                        : <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getSExtValue();</Highlight></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> matchScaledValue(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Scale, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::GetElementPtr: &#123;</Highlight></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Scan the GEP.  We check it if it contains constant offsets and at most</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// one variable offset.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> VariableOperand = -1;</Highlight></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VariableScale = 0;</Highlight></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"><Highlight kind="normal">    int64&#95;t ConstantOffset = 0;</Highlight></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a81c0916829c13ba5279ca0e5480aef0c">gep&#95;type&#95;iterator</a> GTI = <a href="/docs/api/namespaces/llvm/#ac828b9b52935f87659a4adf237f820a3">gep&#95;type&#95;begin</a>(AddrInst);</Highlight></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 1, e = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); i != e; ++i, ++GTI) &#123;</Highlight></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructType &#42;STy = GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#a5a2edfe3b8475d07b1088799fd2df172">getStructTypeOrNull</a>()) &#123;</Highlight></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> StructLayout &#42;SL = DL.getStructLayout(STy);</Highlight></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx =</Highlight></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(i))-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"><Highlight kind="normal">        ConstantOffset += SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a3932cc53acb297750961bfdaa86425bc">getElementOffset</a>(Idx);</Highlight></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><Highlight kind="normal">        TypeSize TS = GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#ae3d47d990ab77e9659cc0fc35c9353de">getSequentialElementStride</a>(DL);</Highlight></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TS.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a5cafb166cf7c4937f5647a084c4eaee2">isNonZero</a>()) &#123;</Highlight></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// The optimisations below currently only work for fixed offsets.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TS.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"><Highlight kind="normal">          int64&#95;t TypeSize = TS.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</Highlight></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ConstantInt &#42;CI =</Highlight></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"><Highlight kind="normal">                  <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(i))) &#123;</Highlight></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> APInt &amp;CVal = CI-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>();</Highlight></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CVal.<a href="/docs/api/classes/llvm/apint/#a9f78d7e839322a6bfc0c665d29052242">getSignificantBits</a>() &lt;= 64) &#123;</Highlight></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"><Highlight kind="normal">              ConstantOffset += CVal.<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>() &#42; TypeSize;</Highlight></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We only allow one variable index at the moment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VariableOperand != -1)</Highlight></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Remember the variable index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"><Highlight kind="normal">          VariableOperand = i;</Highlight></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"><Highlight kind="normal">          VariableScale = TypeSize;</Highlight></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A common case is for the GEP to only do a constant offset.  In this case,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// just add it to the disp field and check validity.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VariableOperand == -1) &#123;</Highlight></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"><Highlight kind="normal">      AddrMode.BaseOffs += ConstantOffset;</Highlight></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1)) &#123;</Highlight></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(AddrInst)-&gt;isInBounds())</Highlight></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><Highlight kind="normal">            AddrMode.InBounds = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"><Highlight kind="normal">      AddrMode.BaseOffs -= ConstantOffset;</Highlight></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aa139a070bbd3c66bb6fd2dbdee1dd893">EnableGEPOffsetSplit</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(AddrInst) &amp;&amp;</Highlight></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><Highlight kind="normal">          TLI.shouldConsiderGEPOffsetSplit() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><Highlight kind="normal">          ConstantOffset &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Record GEPs with non-zero offsets as candidates for splitting in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// the event that the offset cannot fit into the r+i addressing mode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Simple and common case that only one GEP is used in calculating the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// address for the memory access.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BaseI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</Highlight></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(AddrInst);</Highlight></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) ||</Highlight></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><Highlight kind="normal">              (BaseI &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CastInst&gt;</a>(BaseI) &amp;&amp;</Highlight></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><Highlight kind="normal">               !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(BaseI))) &#123;</Highlight></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Make sure the parent block allows inserting non-PHI instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// before the terminator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Parent = BaseI ? BaseI-&gt;getParent()</Highlight></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"><Highlight kind="normal">                                       : &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getFunction()-&gt;getEntryBlock();</Highlight></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Parent-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a5d3d315f678bc76e43b27d18e5d72829">isEHPad</a>())</Highlight></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"><Highlight kind="normal">            LargeOffsetGEP = std::make&#95;pair(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, ConstantOffset);</Highlight></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Save the valid addressing mode in case we can&#39;t match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><Highlight kind="normal">    ExtAddrMode BackupAddrMode = AddrMode;</Highlight></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OldSize = AddrModeInsts.size();</Highlight></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// See if the scale and offset amount is valid for this target.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><Highlight kind="normal">    AddrMode.BaseOffs += ConstantOffset;</Highlight></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(AddrInst)-&gt;isInBounds())</Highlight></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><Highlight kind="normal">      AddrMode.InBounds = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Match the base operand of the GEP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1)) &#123;</Highlight></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If it couldn&#39;t be matched, just stuff the value in a register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrMode.HasBaseReg) &#123;</Highlight></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><Highlight kind="normal">        AddrMode = BackupAddrMode;</Highlight></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"><Highlight kind="normal">        AddrModeInsts.resize(OldSize);</Highlight></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><Highlight kind="normal">      AddrMode.HasBaseReg = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"><Highlight kind="normal">      AddrMode.BaseReg = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Match the remaining variable portion of the GEP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!matchScaledValue(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(VariableOperand), VariableScale,</Highlight></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) &#123;</Highlight></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If it couldn&#39;t be matched, try stuffing the base into a register</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// instead of matching it, and retrying the match of the scale.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><Highlight kind="normal">      AddrMode = BackupAddrMode;</Highlight></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306"><Highlight kind="normal">      AddrModeInsts.resize(OldSize);</Highlight></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrMode.HasBaseReg)</Highlight></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><Highlight kind="normal">      AddrMode.HasBaseReg = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"><Highlight kind="normal">      AddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a> = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311"><Highlight kind="normal">      AddrMode.BaseOffs += ConstantOffset;</Highlight></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!matchScaledValue(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(VariableOperand),</Highlight></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"><Highlight kind="normal">                            VariableScale, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) &#123;</Highlight></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If even that didn&#39;t work, bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><Highlight kind="normal">        AddrMode = BackupAddrMode;</Highlight></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><Highlight kind="normal">        AddrModeInsts.resize(OldSize);</Highlight></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SExt:</Highlight></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ZExt: &#123;</Highlight></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(AddrInst);</Highlight></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ext)</Highlight></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to move this ext out of the way of the addressing mode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ask for a method for doing so.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">TypePromotionHelper::Action</a> TPH =</Highlight></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><Highlight kind="normal">        <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">TypePromotionHelper::getAction</a>(Ext, InsertedInsts, TLI, PromotedInsts);</Highlight></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TPH)</Highlight></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</Highlight></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><Highlight kind="normal">        TPT.getRestorationPoint();</Highlight></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CreatedInstsCost = 0;</Highlight></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExtCost = !TLI.isExtFree(Ext);</Highlight></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PromotedOperand =</Highlight></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"><Highlight kind="normal">        TPH(Ext, TPT, PromotedInsts, CreatedInstsCost, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, TLI);</Highlight></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// SExt has been moved away.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Thus either it will be rematched later in the recursive calls or it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// gone. Anyway, we must not fold it into the addressing mode at this point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// E.g.,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// op = add opnd, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// idx = ext op</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// addr = gep base, idx</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is now:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// promotedOpnd = ext opnd            &lt;- no match here</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// op = promoted&#95;add promotedOpnd, 1  &lt;- match (later in recursive calls)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// addr = gep base, op                &lt;- match</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MovedAway)</Highlight></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><Highlight kind="normal">      &#42;MovedAway = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromotedOperand &amp;&amp;</Highlight></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;TypePromotionHelper should have filtered out those cases&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><Highlight kind="normal">    ExtAddrMode BackupAddrMode = AddrMode;</Highlight></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OldSize = AddrModeInsts.size();</Highlight></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!matchAddr(PromotedOperand, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) ||</Highlight></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The total of the new cost is equal to the cost of the created</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The total of the old cost is equal to the cost of the extension plus</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// what we have saved in the addressing mode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367"><Highlight kind="normal">        !isPromotionProfitable(CreatedInstsCost,</Highlight></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><Highlight kind="normal">                               ExtCost + (AddrModeInsts.size() - OldSize),</Highlight></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><Highlight kind="normal">                               PromotedOperand)) &#123;</Highlight></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"><Highlight kind="normal">      AddrMode = BackupAddrMode;</Highlight></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><Highlight kind="normal">      AddrModeInsts.resize(OldSize);</Highlight></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Sign extension does not pay off: rollback\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><Highlight kind="normal">      TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// SExt has been deleted. Make sure it is not referenced by the AddrMode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><Highlight kind="normal">    AddrMode.replaceWith(Ext, PromotedOperand);</Highlight></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Call:</Highlight></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrinsicInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(AddrInst)) &#123;</Highlight></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::threadlocal&#95;address) &#123;</Highlight></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"><Highlight kind="normal">        GlobalValue &amp;GV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GlobalValue&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0));</Highlight></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.addressingModeSupportsTLS(GV))</Highlight></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><Highlight kind="comment">/// If we can, try to add the value of &#39;Addr&#39; into the current addressing mode.</Highlight></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"><Highlight kind="comment">/// If Addr can&#39;t be added to AddrMode this returns false and leaves AddrMode</Highlight></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><Highlight kind="comment">/// unmodified. This assumes that Addr is either a pointer type or intptr&#95;t</Highlight></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"><Highlight kind="comment">/// for the target.</Highlight></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddressingModeMatcher::matchAddr(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) &#123;</Highlight></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Start a transaction at this point that we will rollback if the matching</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fails.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</Highlight></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"><Highlight kind="normal">      TPT.getRestorationPoint();</Highlight></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ConstantInt &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Addr)) &#123;</Highlight></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a87d50d10274efe9688166584391ae489">isSignedIntN</a>(64)) &#123;</Highlight></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Fold in immediates if legal for the target.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><Highlight kind="normal">      AddrMode.BaseOffs += CI-&gt;<a href="/docs/api/classes/llvm/constantint/#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>();</Highlight></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</Highlight></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><Highlight kind="normal">      AddrMode.BaseOffs -= CI-&gt;<a href="/docs/api/classes/llvm/constantint/#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>();</Highlight></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GlobalValue &#42;GV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalValue&gt;</a>(Addr)) &#123;</Highlight></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is a global variable, try to fold it into the addressing mode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AddrMode.BaseGV) &#123;</Highlight></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"><Highlight kind="normal">      AddrMode.BaseGV = GV;</Highlight></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</Highlight></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><Highlight kind="normal">      AddrMode.BaseGV = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Addr)) &#123;</Highlight></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><Highlight kind="normal">    ExtAddrMode BackupAddrMode = AddrMode;</Highlight></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OldSize = AddrModeInsts.size();</Highlight></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check to see if it is possible to fold this operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MovedAway = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (matchOperationAddr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>, &amp;MovedAway)) &#123;</Highlight></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This instruction may have been moved away. If so, there is nothing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to check here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MovedAway)</Highlight></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Okay, it&#39;s possible to fold this.  Check to see if it is actually</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// &#42;profitable&#42; to do so.  We use a simple cost model to avoid increasing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// register pressure too much.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() ||</Highlight></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><Highlight kind="normal">          isProfitableToFoldIntoAddressingMode(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BackupAddrMode, AddrMode)) &#123;</Highlight></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><Highlight kind="normal">        AddrModeInsts.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It isn&#39;t profitable to do this, roll back.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"><Highlight kind="normal">      AddrMode = BackupAddrMode;</Highlight></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><Highlight kind="normal">      AddrModeInsts.resize(OldSize);</Highlight></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><Highlight kind="normal">      TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ConstantExpr &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(Addr)) &#123;</Highlight></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (matchOperationAddr(CE, <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getOpcode(), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><Highlight kind="normal">    TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(Addr)) &#123;</Highlight></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Null pointer gets folded without affecting the addressing mode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Worse case, the target should support &#91;reg&#93; addressing modes. :)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AddrMode.HasBaseReg) &#123;</Highlight></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><Highlight kind="normal">    AddrMode.HasBaseReg = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><Highlight kind="normal">    AddrMode.BaseReg = Addr;</Highlight></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Still check for legality in case the target supports &#91;imm&#93; but not &#91;i+r&#93;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</Highlight></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><Highlight kind="normal">    AddrMode.HasBaseReg = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><Highlight kind="normal">    AddrMode.BaseReg = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the base register is already taken, see if we can do &#91;r+r&#93;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrMode.Scale == 0) &#123;</Highlight></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><Highlight kind="normal">    AddrMode.Scale = 1;</Highlight></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"><Highlight kind="normal">    AddrMode.ScaledReg = Addr;</Highlight></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</Highlight></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><Highlight kind="normal">    AddrMode.Scale = 0;</Highlight></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"><Highlight kind="normal">    AddrMode.ScaledReg = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Couldn&#39;t match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"><Highlight kind="normal">  TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"><Highlight kind="comment">/// Check to see if all uses of OpVal by the specified inline asm call are due</Highlight></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480"><Highlight kind="comment">/// to memory operands. If so, return true, otherwise return false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481" lineLink="#a86026627b644e50527898aad0747b3e5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/inlineasm">InlineAsm</a> &#42;IA, <a href="/docs/api/classes/llvm/value">Value</a> &#42;OpVal,</Highlight></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482"><Highlight kind="normal">                                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"><Highlight kind="normal">                                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) &#123;</Highlight></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</Highlight></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targetlowering/#a3db162658a7687e8a5df34f5a6aaa840">TargetLowering::AsmOperandInfoVector</a> TargetConstraints =</Highlight></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"><Highlight kind="normal">      TLI.<a href="/docs/api/classes/llvm/targetlowering/#a1c5e8b6aef41aead06d61ff0530ed9c2">ParseConstraints</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout(), &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, &#42;CI);</Highlight></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (TargetLowering::AsmOperandInfo &amp;OpInfo : TargetConstraints) &#123;</Highlight></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the constraint code and ConstraintType to use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"><Highlight kind="normal">    TLI.<a href="/docs/api/classes/llvm/targetlowering/#a279a7f92d056886ac713c0f06cc73045">ComputeConstraintToUse</a>(OpInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>());</Highlight></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this asm operand is our Value&#42;, and if it isn&#39;t an indirect memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// operand, we can&#39;t fold it!  TODO: Also handle C&#95;Address?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpInfo.CallOperandVal == OpVal &amp;&amp;</Highlight></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><Highlight kind="normal">        (OpInfo.ConstraintType != <a href="/docs/api/classes/llvm/targetlowering/#a0b0176781cd4fd9f45cc739f1d007116a420d729d2e7d056ec884c094ccdc4467">TargetLowering::C&#95;Memory</a> ||</Highlight></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496"><Highlight kind="normal">         !OpInfo.isIndirect))</Highlight></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><Highlight kind="comment">/// Recursively walk all the uses of I until we find a memory use.</Highlight></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504"><Highlight kind="comment">/// If we find an obviously non-foldable instruction, return true.</Highlight></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><Highlight kind="comment">/// Add accessed addresses and types to MemoryUses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506" lineLink="#a498962c0029b14cf3cc8fb08c5e20ab2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(</Highlight></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;Use &#42;, Type &#42;&gt;&gt; &amp;MemoryUses,</Highlight></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;ConsideredInsts, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI,</Highlight></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;SeenInsts) &#123;</Highlight></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we already considered this instruction, we&#39;re done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ConsideredInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</Highlight></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is an obviously unfoldable instruction, bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loop over all the uses, recursively processing them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) &#123;</Highlight></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Conservatively return true if we&#39;re seeing a large number or a deep chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of users. This avoids excessive compilation times in pathological cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SeenInsts++ &gt;= <a href="#a1a31871450a2ceec97ef89dbdae54921">MaxAddressUsersToScan</a>)</Highlight></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</Highlight></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(UserI)) &#123;</Highlight></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"><Highlight kind="normal">      MemoryUses.push&#95;back(&#123;&amp;U, LI-&gt;getType()&#125;);</Highlight></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(UserI)) &#123;</Highlight></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U.getOperandNo() != <a href="/docs/api/classes/llvm/storeinst/#add13b402166ae4d70f5b93c3c4cfba99">StoreInst::getPointerOperandIndex</a>())</Highlight></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Storing addr, not into addr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"><Highlight kind="normal">      MemoryUses.push&#95;back(&#123;&amp;U, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType()&#125;);</Highlight></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/atomicrmwinst">AtomicRMWInst</a> &#42;RMW = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicRMWInst&gt;</a>(UserI)) &#123;</Highlight></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U.getOperandNo() != <a href="/docs/api/classes/llvm/atomicrmwinst/#a2f8f88574a509cf4545cd6420b405aaf">AtomicRMWInst::getPointerOperandIndex</a>())</Highlight></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Storing addr, not into addr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"><Highlight kind="normal">      MemoryUses.push&#95;back(&#123;&amp;U, RMW-&gt;getValOperand()-&gt;getType()&#125;);</Highlight></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/atomiccmpxchginst">AtomicCmpXchgInst</a> &#42;CmpX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicCmpXchgInst&gt;</a>(UserI)) &#123;</Highlight></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U.getOperandNo() != <a href="/docs/api/classes/llvm/atomiccmpxchginst/#ad11e8ccbd7550fb3b77f1d2cbc921b50">AtomicCmpXchgInst::getPointerOperandIndex</a>())</Highlight></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Storing addr, not into addr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><Highlight kind="normal">      MemoryUses.push&#95;back(&#123;&amp;U, CmpX-&gt;getCompareOperand()-&gt;getType()&#125;);</Highlight></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(UserI)) &#123;</Highlight></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;hasFnAttr(Attribute::Cold)) &#123;</Highlight></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If this is a cold call, we can sink the addressing calculation into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the cold path.  See optimizeCallInst</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(CI-&gt;getParent(), PSI, BFI))</Highlight></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/inlineasm">InlineAsm</a> &#42;IA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InlineAsm&gt;</a>(CI-&gt;getCalledOperand());</Highlight></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IA)</Highlight></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is a memory operand, we&#39;re cool, otherwise bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a>(CI, IA, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>))</Highlight></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(UserI, MemoryUses, ConsideredInsts, TLI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OptSize,</Highlight></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"><Highlight kind="normal">                          PSI, BFI, SeenInsts))</Highlight></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579" lineLink="#a0f0065098f13d0b2ef0e39f9d2e1ecdd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(</Highlight></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;Use &#42;, Type &#42;&gt;&gt; &amp;MemoryUses,</Highlight></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptSize,</Highlight></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI) &#123;</Highlight></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SeenInsts = 0;</Highlight></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 16&gt;</a> ConsideredInsts;</Highlight></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MemoryUses, ConsideredInsts, TLI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OptSize,</Highlight></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586"><Highlight kind="normal">                           PSI, BFI, SeenInsts);</Highlight></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><Highlight kind="comment">/// Return true if Val is already known to be live at the use site that we&#39;re</Highlight></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"><Highlight kind="comment">/// folding it into. If so, there is no cost to include it in the addressing</Highlight></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"><Highlight kind="comment">/// mode. KnownLive1 and KnownLive2 are two values that we know are live at the</Highlight></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><Highlight kind="comment">/// instruction already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddressingModeMatcher::valueAlreadyLiveAtInst(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Val,</Highlight></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><Highlight kind="normal">                                                   <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;KnownLive1,</Highlight></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"><Highlight kind="normal">                                                   <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;KnownLive2) &#123;</Highlight></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If Val is either of the known-live values, we know it is live!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Val == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> || Val == KnownLive1 || Val == KnownLive2)</Highlight></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All values other than instructions and arguments (e.g. constants) are live.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Val) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(Val))</Highlight></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If Val is a constant sized alloca in the entry block, it is live, this is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// true because it is just a reference to the stack/frame pointer, which is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// live for the whole function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllocaInst &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(Val))</Highlight></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a36e31f42170be95fc392dad696d9ba19">isStaticAlloca</a>())</Highlight></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check to see if this value is already used in the memory instruction&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block.  If so, it&#39;s already live into the block at the very least, so we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// can reasonably fold it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Val-&gt;<a href="/docs/api/classes/llvm/value/#a55bba6bcd9b098e1c227011e6cd66300">isUsedInBasicBlock</a>(MemoryInst-&gt;getParent());</Highlight></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><Highlight kind="comment">/// It is possible for the addressing mode of the machine to fold the specified</Highlight></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"><Highlight kind="comment">/// instruction into a load or store that ultimately uses it.</Highlight></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><Highlight kind="comment">/// However, the specified instruction has multiple uses.</Highlight></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><Highlight kind="comment">/// Given this, it may actually increase register pressure to fold it</Highlight></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"><Highlight kind="comment">/// into the load. For example, consider this code:</Highlight></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><Highlight kind="comment">///     X = ...</Highlight></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><Highlight kind="comment">///     Y = X+1</Highlight></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"><Highlight kind="comment">///     use(Y)   -&gt; nonload/store</Highlight></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"><Highlight kind="comment">///     Z = Y+1</Highlight></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"><Highlight kind="comment">///     load Z</Highlight></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><Highlight kind="comment">/// In this case, Y has multiple uses, and can be folded into the load of Z</Highlight></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><Highlight kind="comment">/// (yielding load &#91;X+2&#93;).  However, doing this will cause both &quot;X&quot; and &quot;X+1&quot; to</Highlight></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"><Highlight kind="comment">/// be live at the use(Y) line.  If we don&#39;t fold Y into load Z, we use one</Highlight></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"><Highlight kind="comment">/// fewer register.  Since Y can&#39;t be folded into &quot;use(Y)&quot; we don&#39;t increase the</Highlight></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634"><Highlight kind="comment">/// number of computations either.</Highlight></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"><Highlight kind="comment">/// Note that this (like most of CodeGenPrepare) is just a rough heuristic.  If</Highlight></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"><Highlight kind="comment">/// X was live across &#39;load Z&#39; for other reasons, we actually &#42;would&#42; want to</Highlight></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><Highlight kind="comment">/// fold the addressing mode in the Z case.  This would make Y die earlier.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddressingModeMatcher::isProfitableToFoldIntoAddressingMode(</Highlight></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><Highlight kind="normal">    Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMBefore, <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMAfter) &#123;</Highlight></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IgnoreProfitability)</Highlight></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// AMBefore is the addressing mode before this instruction was folded into it,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and AMAfter is the addressing mode after the instruction was folded.  Get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the set of registers referenced by AMAfter and subtract out those</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// referenced by AMBefore: this is the set of values which folding in this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// address extends the lifetime of.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that there are only two potential values being referenced here,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BaseReg and ScaleReg (global addresses are always available, as are any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// folded immediates).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseReg = AMAfter.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, &#42;ScaledReg = AMAfter.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>;</Highlight></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the BaseReg or ScaledReg was referenced by the previous addrmode, their</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lifetime wasn&#39;t extended by adding this instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (valueAlreadyLiveAtInst(BaseReg, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>))</Highlight></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><Highlight kind="normal">    BaseReg = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (valueAlreadyLiveAtInst(ScaledReg, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>))</Highlight></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><Highlight kind="normal">    ScaledReg = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If folding this instruction (and it&#39;s subexprs) didn&#39;t extend any live</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ranges, we&#39;re ok with it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BaseReg &amp;&amp; !ScaledReg)</Highlight></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If all uses of this instruction can have the address mode sunk into them,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we can remove the addressing mode and effectively trade one live register</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for another (at worst.)  In this context, folding an addressing mode into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the use is just a particularly nice way of sinking it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;std::pair&lt;Use &#42;, Type &#42;&gt;</a>, 16&gt; MemoryUses;</Highlight></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MemoryUses, TLI, TRI, OptSize, PSI, BFI))</Highlight></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Has a non-memory, non-foldable use!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that we know that all uses of this instruction are part of a chain of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// computation involving only operations that could theoretically be folded</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into a memory use, loop over each of these memory operation uses and see</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if they could  &#42;actually&#42; fold the instruction.  The assumption is that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// addressing modes are cheap and that duplicating the computation involved</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// many times is worthwhile, even on a fastpath. For sinking candidates</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (i.e. cold call sites), this serves as a way to prevent excessive code</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// growth since most architectures have some reasonable small and fast way to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// compute an effective address.  (i.e LEA on x86)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Instruction &#42;, 32&gt;</a> MatchedAddrModeInsts;</Highlight></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::pair&lt;Use &#42;, Type &#42;&gt; &amp;Pair : MemoryUses) &#123;</Highlight></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a> = Pair.first-&gt;get();</Highlight></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Pair.first-&gt;getUser());</Highlight></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;AddressAccessTy = Pair.second;</Highlight></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a>-&gt;getType()-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do a match against the root of this address, ignoring profitability. This</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// will tell us if the addressing mode for the memory operation will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#42;actually&#42; cover the shared instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><Highlight kind="normal">    ExtAddrMode <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695"><Highlight kind="normal">    std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt; LargeOffsetGEP(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696"><Highlight kind="normal">                                                                      0);</Highlight></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</Highlight></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"><Highlight kind="normal">        TPT.getRestorationPoint();</Highlight></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699"><Highlight kind="normal">    AddressingModeMatcher Matcher(MatchedAddrModeInsts, TLI, TRI, LI, getDTFn,</Highlight></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><Highlight kind="normal">                                  AddressAccessTy, AS, UserI, Result,</Highlight></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"><Highlight kind="normal">                                  InsertedInsts, PromotedInsts, TPT,</Highlight></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><Highlight kind="normal">                                  LargeOffsetGEP, OptSize, PSI, BFI);</Highlight></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703"><Highlight kind="normal">    Matcher.IgnoreProfitability = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> = Matcher.matchAddr(<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a>, 0);</Highlight></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><Highlight kind="normal">    (void)<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a>;</Highlight></CodeLine>
<Link id="l05706" /><CodeLine lineNumber="5706"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Couldn&#39;t select &#42;anything&#42;?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05707" /><CodeLine lineNumber="5707"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05708" /><CodeLine lineNumber="5708"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The match was to check the profitability, the changes made are not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05709" /><CodeLine lineNumber="5709"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// part of the original matcher. Therefore, they should be dropped</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05710" /><CodeLine lineNumber="5710"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// otherwise the original matcher will not present the right state.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05711" /><CodeLine lineNumber="5711"><Highlight kind="normal">    TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05712" /><CodeLine lineNumber="5712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05713" /><CodeLine lineNumber="5713"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the match didn&#39;t cover I, then it won&#39;t be shared by it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05714" /><CodeLine lineNumber="5714"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(MatchedAddrModeInsts, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l05715" /><CodeLine lineNumber="5715"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05716" /><CodeLine lineNumber="5716"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05717" /><CodeLine lineNumber="5717"><Highlight kind="normal">    MatchedAddrModeInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l05718" /><CodeLine lineNumber="5718"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05719" /><CodeLine lineNumber="5719"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05720" /><CodeLine lineNumber="5720"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05721" /><CodeLine lineNumber="5721"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05722" /><CodeLine lineNumber="5722"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05723" /><CodeLine lineNumber="5723"><Highlight kind="comment">/// Return true if the specified values are defined in a</Highlight></CodeLine>
<Link id="l05724" /><CodeLine lineNumber="5724"><Highlight kind="comment">/// different basic block than BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05725" /><CodeLine lineNumber="5725" lineLink="#ad897d4beb50aa8f0d4d2eaa08ac0987d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l05726" /><CodeLine lineNumber="5726"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V))</Highlight></CodeLine>
<Link id="l05727" /><CodeLine lineNumber="5727"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != BB;</Highlight></CodeLine>
<Link id="l05728" /><CodeLine lineNumber="5728"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05729" /><CodeLine lineNumber="5729"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05730" /><CodeLine lineNumber="5730"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05731" /><CodeLine lineNumber="5731"><Highlight kind="comment">/// Sink addressing mode computation immediate before MemoryInst if doing so</Highlight></CodeLine>
<Link id="l05732" /><CodeLine lineNumber="5732"><Highlight kind="comment">/// can be done without increasing register pressure.  The need for the</Highlight></CodeLine>
<Link id="l05733" /><CodeLine lineNumber="5733"><Highlight kind="comment">/// register pressure constraint means this can end up being an all or nothing</Highlight></CodeLine>
<Link id="l05734" /><CodeLine lineNumber="5734"><Highlight kind="comment">/// decision for all uses of the same addressing computation.</Highlight></CodeLine>
<Link id="l05735" /><CodeLine lineNumber="5735"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05736" /><CodeLine lineNumber="5736"><Highlight kind="comment">/// Load and Store Instructions often have addressing modes that can do</Highlight></CodeLine>
<Link id="l05737" /><CodeLine lineNumber="5737"><Highlight kind="comment">/// significant amounts of computation. As such, instruction selection will try</Highlight></CodeLine>
<Link id="l05738" /><CodeLine lineNumber="5738"><Highlight kind="comment">/// to get the load or store to do as much computation as possible for the</Highlight></CodeLine>
<Link id="l05739" /><CodeLine lineNumber="5739"><Highlight kind="comment">/// program. The problem is that isel can only see within a single block. As</Highlight></CodeLine>
<Link id="l05740" /><CodeLine lineNumber="5740"><Highlight kind="comment">/// such, we sink as much legal addressing mode work into the block as possible.</Highlight></CodeLine>
<Link id="l05741" /><CodeLine lineNumber="5741"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05742" /><CodeLine lineNumber="5742"><Highlight kind="comment">/// This method is used to optimize both load/store and inline asms with memory</Highlight></CodeLine>
<Link id="l05743" /><CodeLine lineNumber="5743"><Highlight kind="comment">/// operands.  It&#39;s also used to sink addressing computations feeding into cold</Highlight></CodeLine>
<Link id="l05744" /><CodeLine lineNumber="5744"><Highlight kind="comment">/// call sites into their (cold) basic block.</Highlight></CodeLine>
<Link id="l05745" /><CodeLine lineNumber="5745"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05746" /><CodeLine lineNumber="5746"><Highlight kind="comment">/// The motivation for handling sinking into cold blocks is that doing so can</Highlight></CodeLine>
<Link id="l05747" /><CodeLine lineNumber="5747"><Highlight kind="comment">/// both enable other address mode sinking (by satisfying the register pressure</Highlight></CodeLine>
<Link id="l05748" /><CodeLine lineNumber="5748"><Highlight kind="comment">/// constraint above), and reduce register pressure globally (by removing the</Highlight></CodeLine>
<Link id="l05749" /><CodeLine lineNumber="5749"><Highlight kind="comment">/// addressing mode computation from the fast path entirely.).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05750" /><CodeLine lineNumber="5750"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeMemoryInst(Instruction &#42;MemoryInst, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr,</Highlight></CodeLine>
<Link id="l05751" /><CodeLine lineNumber="5751"><Highlight kind="normal">                                        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;AccessTy, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AddrSpace) &#123;</Highlight></CodeLine>
<Link id="l05752" /><CodeLine lineNumber="5752"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Repl = Addr;</Highlight></CodeLine>
<Link id="l05753" /><CodeLine lineNumber="5753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05754" /><CodeLine lineNumber="5754"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to collapse single-value PHI nodes.  This is necessary to undo</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05755" /><CodeLine lineNumber="5755"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unprofitable PRE transformations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05756" /><CodeLine lineNumber="5756"><Highlight kind="normal">  SmallVector&lt;Value &#42;, 8&gt; worklist;</Highlight></CodeLine>
<Link id="l05757" /><CodeLine lineNumber="5757"><Highlight kind="normal">  SmallPtrSet&lt;Value &#42;, 16&gt; Visited;</Highlight></CodeLine>
<Link id="l05758" /><CodeLine lineNumber="5758"><Highlight kind="normal">  worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Addr);</Highlight></CodeLine>
<Link id="l05759" /><CodeLine lineNumber="5759"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05760" /><CodeLine lineNumber="5760"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use a worklist to iteratively look through PHI and select nodes, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05761" /><CodeLine lineNumber="5761"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ensure that the addressing mode obtained from the non-PHI/select roots of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05762" /><CodeLine lineNumber="5762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the graph are compatible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05763" /><CodeLine lineNumber="5763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> PhiOrSelectSeen = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05764" /><CodeLine lineNumber="5764"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 16&gt; AddrModeInsts;</Highlight></CodeLine>
<Link id="l05765" /><CodeLine lineNumber="5765"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SimplifyQuery SQ(&#42;DL, TLInfo);</Highlight></CodeLine>
<Link id="l05766" /><CodeLine lineNumber="5766"><Highlight kind="normal">  AddressingModeCombiner AddrModes(SQ, Addr);</Highlight></CodeLine>
<Link id="l05767" /><CodeLine lineNumber="5767"><Highlight kind="normal">  TypePromotionTransaction TPT(RemovedInsts);</Highlight></CodeLine>
<Link id="l05768" /><CodeLine lineNumber="5768"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</Highlight></CodeLine>
<Link id="l05769" /><CodeLine lineNumber="5769"><Highlight kind="normal">      TPT.getRestorationPoint();</Highlight></CodeLine>
<Link id="l05770" /><CodeLine lineNumber="5770"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l05771" /><CodeLine lineNumber="5771"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l05772" /><CodeLine lineNumber="5772"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05773" /><CodeLine lineNumber="5773"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We allow traversing cyclic Phi nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05774" /><CodeLine lineNumber="5774"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In case of success after this loop we ensure that traversing through</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05775" /><CodeLine lineNumber="5775"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Phi nodes ends up with all cases to compute address of the form</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05776" /><CodeLine lineNumber="5776"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    BaseGV + Base + Scale &#42; Index + Offset</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05777" /><CodeLine lineNumber="5777"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// where Scale and Offset are constans and BaseGV, Base and Index</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05778" /><CodeLine lineNumber="5778"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// are exactly the same Values in all cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05779" /><CodeLine lineNumber="5779"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// It means that BaseGV, Scale and Offset dominate our memory instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05780" /><CodeLine lineNumber="5780"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and have the same value as they had in address computation represented</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05781" /><CodeLine lineNumber="5781"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as Phi. So we can safely sink address computation to memory instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05782" /><CodeLine lineNumber="5782"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(V).second)</Highlight></CodeLine>
<Link id="l05783" /><CodeLine lineNumber="5783"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05784" /><CodeLine lineNumber="5784"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05785" /><CodeLine lineNumber="5785"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For a PHI node, push all of its incoming values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05786" /><CodeLine lineNumber="5786"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHINode &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l05787" /><CodeLine lineNumber="5787"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(worklist, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;incoming&#95;values());</Highlight></CodeLine>
<Link id="l05788" /><CodeLine lineNumber="5788"><Highlight kind="normal">      PhiOrSelectSeen = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05789" /><CodeLine lineNumber="5789"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05790" /><CodeLine lineNumber="5790"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05791" /><CodeLine lineNumber="5791"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Similar for select.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05792" /><CodeLine lineNumber="5792"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SelectInst &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l05793" /><CodeLine lineNumber="5793"><Highlight kind="normal">      worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getFalseValue());</Highlight></CodeLine>
<Link id="l05794" /><CodeLine lineNumber="5794"><Highlight kind="normal">      worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getTrueValue());</Highlight></CodeLine>
<Link id="l05795" /><CodeLine lineNumber="5795"><Highlight kind="normal">      PhiOrSelectSeen = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05796" /><CodeLine lineNumber="5796"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05797" /><CodeLine lineNumber="5797"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05798" /><CodeLine lineNumber="5798"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05799" /><CodeLine lineNumber="5799"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For non-PHIs, determine the addressing mode being computed.  Note that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05800" /><CodeLine lineNumber="5800"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the result may differ depending on what other uses our candidate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05801" /><CodeLine lineNumber="5801"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// addressing instructions might have.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05802" /><CodeLine lineNumber="5802"><Highlight kind="normal">    AddrModeInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l05803" /><CodeLine lineNumber="5803"><Highlight kind="normal">    std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt; LargeOffsetGEP(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l05804" /><CodeLine lineNumber="5804"><Highlight kind="normal">                                                                      0);</Highlight></CodeLine>
<Link id="l05805" /><CodeLine lineNumber="5805"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Defer the query (and possible computation of) the dom tree to point of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05806" /><CodeLine lineNumber="5806"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// actual use.  It&#39;s expected that most address matches don&#39;t actually need</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05807" /><CodeLine lineNumber="5807"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the domtree.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05808" /><CodeLine lineNumber="5808"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> getDTFn = &#91;MemoryInst, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;() -&gt; </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> DominatorTree &amp; &#123;</Highlight></CodeLine>
<Link id="l05809" /><CodeLine lineNumber="5809"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = MemoryInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent();</Highlight></CodeLine>
<Link id="l05810" /><CodeLine lineNumber="5810"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> this-&gt;getDT(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05811" /><CodeLine lineNumber="5811"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l05812" /><CodeLine lineNumber="5812"><Highlight kind="normal">    ExtAddrMode NewAddrMode = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#a592ce6f54154b0ca1d672869951cad6b">AddressingModeMatcher::Match</a>(</Highlight></CodeLine>
<Link id="l05813" /><CodeLine lineNumber="5813"><Highlight kind="normal">        V, AccessTy, AddrSpace, MemoryInst, AddrModeInsts, &#42;TLI, &#42;LI, getDTFn,</Highlight></CodeLine>
<Link id="l05814" /><CodeLine lineNumber="5814"><Highlight kind="normal">        &#42;TRI, InsertedInsts, PromotedInsts, TPT, LargeOffsetGEP, OptSize, PSI,</Highlight></CodeLine>
<Link id="l05815" /><CodeLine lineNumber="5815"><Highlight kind="normal">        BFI.get());</Highlight></CodeLine>
<Link id="l05816" /><CodeLine lineNumber="5816"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05817" /><CodeLine lineNumber="5817"><Highlight kind="normal">    GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = LargeOffsetGEP.first;</Highlight></CodeLine>
<Link id="l05818" /><CodeLine lineNumber="5818"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> &amp;&amp; !NewGEPBases.count(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)) &#123;</Highlight></CodeLine>
<Link id="l05819" /><CodeLine lineNumber="5819"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If splitting the underlying data structure can reduce the offset of a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05820" /><CodeLine lineNumber="5820"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// GEP, collect the GEP.  Skip the GEPs that are the new bases of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05821" /><CodeLine lineNumber="5821"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// previously split data structures.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05822" /><CodeLine lineNumber="5822"><Highlight kind="normal">      LargeOffsetGEPMap&#91;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand()&#93;.push&#95;back(LargeOffsetGEP);</Highlight></CodeLine>
<Link id="l05823" /><CodeLine lineNumber="5823"><Highlight kind="normal">      LargeOffsetGEPID.insert(std::make&#95;pair(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, LargeOffsetGEPID.size()));</Highlight></CodeLine>
<Link id="l05824" /><CodeLine lineNumber="5824"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05825" /><CodeLine lineNumber="5825"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05826" /><CodeLine lineNumber="5826"><Highlight kind="normal">    NewAddrMode.OriginalValue = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l05827" /><CodeLine lineNumber="5827"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AddrModes.addNewAddrMode(NewAddrMode))</Highlight></CodeLine>
<Link id="l05828" /><CodeLine lineNumber="5828"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05829" /><CodeLine lineNumber="5829"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05830" /><CodeLine lineNumber="5830"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05831" /><CodeLine lineNumber="5831"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to combine the AddrModes we&#39;ve collected. If we couldn&#39;t collect any,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05832" /><CodeLine lineNumber="5832"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// or we have multiple but either couldn&#39;t combine them or combining them</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05833" /><CodeLine lineNumber="5833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// wouldn&#39;t do anything useful, bail out now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05834" /><CodeLine lineNumber="5834"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AddrModes.combineAddrModes()) &#123;</Highlight></CodeLine>
<Link id="l05835" /><CodeLine lineNumber="5835"><Highlight kind="normal">    TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l05836" /><CodeLine lineNumber="5836"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05837" /><CodeLine lineNumber="5837"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05838" /><CodeLine lineNumber="5838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = TPT.commit();</Highlight></CodeLine>
<Link id="l05839" /><CodeLine lineNumber="5839"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05840" /><CodeLine lineNumber="5840"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the combined AddrMode (or the only AddrMode, if we only had one).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05841" /><CodeLine lineNumber="5841"><Highlight kind="normal">  ExtAddrMode <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = AddrModes.getAddrMode();</Highlight></CodeLine>
<Link id="l05842" /><CodeLine lineNumber="5842"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05843" /><CodeLine lineNumber="5843"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If all the instructions matched are already in this BB, don&#39;t do anything.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05844" /><CodeLine lineNumber="5844"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we saw a Phi node then it is not local definitely, and if we saw a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05845" /><CodeLine lineNumber="5845"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// select then we want to push the address calculation past it even if it&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05846" /><CodeLine lineNumber="5846"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// already in this BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05847" /><CodeLine lineNumber="5847"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiOrSelectSeen &amp;&amp; <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(AddrModeInsts, &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l05848" /><CodeLine lineNumber="5848"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a>(V, MemoryInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l05849" /><CodeLine lineNumber="5849"><Highlight kind="normal">      &#125;)) &#123;</Highlight></CodeLine>
<Link id="l05850" /><CodeLine lineNumber="5850"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;CGP: Found      local addrmode: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></Highlight></CodeLine>
<Link id="l05851" /><CodeLine lineNumber="5851"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05852" /><CodeLine lineNumber="5852"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l05853" /><CodeLine lineNumber="5853"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05854" /><CodeLine lineNumber="5854"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05855" /><CodeLine lineNumber="5855"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert this computation right after this user.  Since our caller is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05856" /><CodeLine lineNumber="5856"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// scanning from the top of the BB to the bottom, reuse of the expr are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05857" /><CodeLine lineNumber="5857"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// guaranteed to happen later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05858" /><CodeLine lineNumber="5858"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(MemoryInst);</Highlight></CodeLine>
<Link id="l05859" /><CodeLine lineNumber="5859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05860" /><CodeLine lineNumber="5860"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that we determined the addressing expression we want to use and know</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05861" /><CodeLine lineNumber="5861"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that we have to sink it into this block.  Check to see if we have already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05862" /><CodeLine lineNumber="5862"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// done this for some other load/store instr in this block.  If so, reuse</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05863" /><CodeLine lineNumber="5863"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the computation.  Before attempting reuse, check if the address is valid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05864" /><CodeLine lineNumber="5864"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as it may have been erased.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05865" /><CodeLine lineNumber="5865"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05866" /><CodeLine lineNumber="5866"><Highlight kind="normal">  WeakTrackingVH SunkAddrVH = SunkAddrs&#91;Addr&#93;;</Highlight></CodeLine>
<Link id="l05867" /><CodeLine lineNumber="5867"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05868" /><CodeLine lineNumber="5868"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SunkAddr = SunkAddrVH.<a href="/docs/api/classes/llvm/weaktrackingvh/#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05869" /><CodeLine lineNumber="5869"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IntPtrTy = DL-&gt;getIntPtrType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l05870" /><CodeLine lineNumber="5870"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAddr) &#123;</Highlight></CodeLine>
<Link id="l05871" /><CodeLine lineNumber="5871"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;CGP: Reusing nonlocal addrmode: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></Highlight></CodeLine>
<Link id="l05872" /><CodeLine lineNumber="5872"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;MemoryInst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05873" /><CodeLine lineNumber="5873"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</Highlight></CodeLine>
<Link id="l05874" /><CodeLine lineNumber="5874"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() !=</Highlight></CodeLine>
<Link id="l05875" /><CodeLine lineNumber="5875"><Highlight kind="normal">              Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05876" /><CodeLine lineNumber="5876"><Highlight kind="normal">          !DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</Highlight></CodeLine>
<Link id="l05877" /><CodeLine lineNumber="5877"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// There are two reasons the address spaces might not match: a no-op</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05878" /><CodeLine lineNumber="5878"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// addrspacecast, or a ptrtoint/inttoptr pair. Either way, we emit a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05879" /><CodeLine lineNumber="5879"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// ptrtoint/inttoptr pair to ensure we match the original semantics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05880" /><CodeLine lineNumber="5880"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// TODO: allow bitcast between different address space pointers with the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05881" /><CodeLine lineNumber="5881"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// same size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05882" /><CodeLine lineNumber="5882"><Highlight kind="normal">        SunkAddr = Builder.CreatePtrToInt(SunkAddr, IntPtrTy, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05883" /><CodeLine lineNumber="5883"><Highlight kind="normal">        SunkAddr =</Highlight></CodeLine>
<Link id="l05884" /><CodeLine lineNumber="5884"><Highlight kind="normal">            Builder.CreateIntToPtr(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05885" /><CodeLine lineNumber="5885"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05886" /><CodeLine lineNumber="5886"><Highlight kind="normal">        SunkAddr = Builder.CreatePointerCast(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l05887" /><CodeLine lineNumber="5887"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05888" /><CodeLine lineNumber="5888"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a> || (!<a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a>.<a href="/docs/api/classes/llvm/cl/option/#a2dc75fafb68e7669e776e19da7857cdf">getNumOccurrences</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05889" /><CodeLine lineNumber="5889"><Highlight kind="normal">                                   SubtargetInfo-&gt;addrSinkUsingGEPs())) &#123;</Highlight></CodeLine>
<Link id="l05890" /><CodeLine lineNumber="5890"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// By default, we use the GEP-based method when AA is used later. This</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05891" /><CodeLine lineNumber="5891"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// prevents new inttoptr/ptrtoint pairs from degrading AA capabilities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05892" /><CodeLine lineNumber="5892"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;CGP: SINKING nonlocal addrmode: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></Highlight></CodeLine>
<Link id="l05893" /><CodeLine lineNumber="5893"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;MemoryInst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05894" /><CodeLine lineNumber="5894"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ResultPtr = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;ResultIndex = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05895" /><CodeLine lineNumber="5895"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05896" /><CodeLine lineNumber="5896"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// First, find the pointer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05897" /><CodeLine lineNumber="5897"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg-&gt;getType()-&gt;isPointerTy()) &#123;</Highlight></CodeLine>
<Link id="l05898" /><CodeLine lineNumber="5898"><Highlight kind="normal">      ResultPtr = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</Highlight></CodeLine>
<Link id="l05899" /><CodeLine lineNumber="5899"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05900" /><CodeLine lineNumber="5900"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05901" /><CodeLine lineNumber="5901"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05902" /><CodeLine lineNumber="5902"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType()-&gt;isPointerTy()) &#123;</Highlight></CodeLine>
<Link id="l05903" /><CodeLine lineNumber="5903"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We can&#39;t add more than one pointer together, nor can we scale a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05904" /><CodeLine lineNumber="5904"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// pointer (both of which seem meaningless).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05905" /><CodeLine lineNumber="5905"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ResultPtr || <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</Highlight></CodeLine>
<Link id="l05906" /><CodeLine lineNumber="5906"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l05907" /><CodeLine lineNumber="5907"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05908" /><CodeLine lineNumber="5908"><Highlight kind="normal">      ResultPtr = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</Highlight></CodeLine>
<Link id="l05909" /><CodeLine lineNumber="5909"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 0;</Highlight></CodeLine>
<Link id="l05910" /><CodeLine lineNumber="5910"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05911" /><CodeLine lineNumber="5911"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05912" /><CodeLine lineNumber="5912"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// It is only safe to sign extend the BaseReg if we know that the math</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05913" /><CodeLine lineNumber="5913"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// required to create it did not overflow before we extend it. Since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05914" /><CodeLine lineNumber="5914"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the original IR value was tossed in favor of a constant back when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05915" /><CodeLine lineNumber="5915"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the AddrMode was created we need to bail out gracefully if widths</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05916" /><CodeLine lineNumber="5916"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// do not match instead of extending it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05917" /><CodeLine lineNumber="5917"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05918" /><CodeLine lineNumber="5918"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (See below for code to add the scale.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05919" /><CodeLine lineNumber="5919"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) &#123;</Highlight></CodeLine>
<Link id="l05920" /><CodeLine lineNumber="5920"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScaledRegTy = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType();</Highlight></CodeLine>
<Link id="l05921" /><CodeLine lineNumber="5921"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IntPtrTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &gt;</Highlight></CodeLine>
<Link id="l05922" /><CodeLine lineNumber="5922"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(ScaledRegTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>())</Highlight></CodeLine>
<Link id="l05923" /><CodeLine lineNumber="5923"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l05924" /><CodeLine lineNumber="5924"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05925" /><CodeLine lineNumber="5925"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05926" /><CodeLine lineNumber="5926"><Highlight kind="normal">    GlobalValue &#42;BaseGV = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV;</Highlight></CodeLine>
<Link id="l05927" /><CodeLine lineNumber="5927"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseGV != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l05928" /><CodeLine lineNumber="5928"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ResultPtr)</Highlight></CodeLine>
<Link id="l05929" /><CodeLine lineNumber="5929"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l05930" /><CodeLine lineNumber="5930"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05931" /><CodeLine lineNumber="5931"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a239427c2c3a01e23bd15b29633696536">isThreadLocal</a>()) &#123;</Highlight></CodeLine>
<Link id="l05932" /><CodeLine lineNumber="5932"><Highlight kind="normal">        ResultPtr = Builder.CreateThreadLocalAddress(BaseGV);</Highlight></CodeLine>
<Link id="l05933" /><CodeLine lineNumber="5933"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05934" /><CodeLine lineNumber="5934"><Highlight kind="normal">        ResultPtr = BaseGV;</Highlight></CodeLine>
<Link id="l05935" /><CodeLine lineNumber="5935"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05936" /><CodeLine lineNumber="5936"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05937" /><CodeLine lineNumber="5937"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05938" /><CodeLine lineNumber="5938"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the real base value actually came from an inttoptr, then the matcher</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05939" /><CodeLine lineNumber="5939"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// will look through it and provide only the integer value. In that case,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05940" /><CodeLine lineNumber="5940"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// use it here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05941" /><CodeLine lineNumber="5941"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</Highlight></CodeLine>
<Link id="l05942" /><CodeLine lineNumber="5942"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ResultPtr &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) &#123;</Highlight></CodeLine>
<Link id="l05943" /><CodeLine lineNumber="5943"><Highlight kind="normal">        ResultPtr = Builder.CreateIntToPtr(<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l05944" /><CodeLine lineNumber="5944"><Highlight kind="normal">                                           </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05945" /><CodeLine lineNumber="5945"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05946" /><CodeLine lineNumber="5946"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ResultPtr &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale == 1) &#123;</Highlight></CodeLine>
<Link id="l05947" /><CodeLine lineNumber="5947"><Highlight kind="normal">        ResultPtr = Builder.CreateIntToPtr(<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l05948" /><CodeLine lineNumber="5948"><Highlight kind="normal">                                           </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05949" /><CodeLine lineNumber="5949"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 0;</Highlight></CodeLine>
<Link id="l05950" /><CodeLine lineNumber="5950"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05951" /><CodeLine lineNumber="5951"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05952" /><CodeLine lineNumber="5952"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05953" /><CodeLine lineNumber="5953"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ResultPtr &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale &amp;&amp;</Highlight></CodeLine>
<Link id="l05954" /><CodeLine lineNumber="5954"><Highlight kind="normal">        !<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) &#123;</Highlight></CodeLine>
<Link id="l05955" /><CodeLine lineNumber="5955"><Highlight kind="normal">      SunkAddr = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l05956" /><CodeLine lineNumber="5956"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ResultPtr) &#123;</Highlight></CodeLine>
<Link id="l05957" /><CodeLine lineNumber="5957"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l05958" /><CodeLine lineNumber="5958"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05959" /><CodeLine lineNumber="5959"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I8PtrTy =</Highlight></CodeLine>
<Link id="l05960" /><CodeLine lineNumber="5960"><Highlight kind="normal">          Builder.getPtrTy(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>());</Highlight></CodeLine>
<Link id="l05961" /><CodeLine lineNumber="5961"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05962" /><CodeLine lineNumber="5962"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Start with the base register. Do this first so that subsequent address</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05963" /><CodeLine lineNumber="5963"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// matching finds it last, which will prevent it from trying to match it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05964" /><CodeLine lineNumber="5964"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// as the scaled value in case it happens to be a mul. That would be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05965" /><CodeLine lineNumber="5965"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// problematic if we&#39;ve sunk a different mul for the scale, because then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05966" /><CodeLine lineNumber="5966"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we&#39;d end up sinking both muls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05967" /><CodeLine lineNumber="5967"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) &#123;</Highlight></CodeLine>
<Link id="l05968" /><CodeLine lineNumber="5968"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</Highlight></CodeLine>
<Link id="l05969" /><CodeLine lineNumber="5969"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() != IntPtrTy)</Highlight></CodeLine>
<Link id="l05970" /><CodeLine lineNumber="5970"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateIntCast(V, IntPtrTy, </Highlight><Highlight kind="comment">/&#42;isSigned=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05971" /><CodeLine lineNumber="5971"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05972" /><CodeLine lineNumber="5972"><Highlight kind="normal">        ResultIndex = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l05973" /><CodeLine lineNumber="5973"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05974" /><CodeLine lineNumber="5974"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05975" /><CodeLine lineNumber="5975"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add the scale value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05976" /><CodeLine lineNumber="5976"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) &#123;</Highlight></CodeLine>
<Link id="l05977" /><CodeLine lineNumber="5977"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</Highlight></CodeLine>
<Link id="l05978" /><CodeLine lineNumber="5978"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() == IntPtrTy) &#123;</Highlight></CodeLine>
<Link id="l05979" /><CodeLine lineNumber="5979"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05980" /><CodeLine lineNumber="5980"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05981" /><CodeLine lineNumber="5981"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IntPtrTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &lt;</Highlight></CodeLine>
<Link id="l05982" /><CodeLine lineNumber="5982"><Highlight kind="normal">                     <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType())-&gt;getBitWidth() &amp;&amp;</Highlight></CodeLine>
<Link id="l05983" /><CodeLine lineNumber="5983"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;We can&#39;t transform if ScaledReg is too narrow&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05984" /><CodeLine lineNumber="5984"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateTrunc(V, IntPtrTy, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05985" /><CodeLine lineNumber="5985"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05986" /><CodeLine lineNumber="5986"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05987" /><CodeLine lineNumber="5987"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</Highlight></CodeLine>
<Link id="l05988" /><CodeLine lineNumber="5988"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateMul(V, ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale),</Highlight></CodeLine>
<Link id="l05989" /><CodeLine lineNumber="5989"><Highlight kind="normal">                                </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05990" /><CodeLine lineNumber="5990"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ResultIndex)</Highlight></CodeLine>
<Link id="l05991" /><CodeLine lineNumber="5991"><Highlight kind="normal">          ResultIndex = Builder.CreateAdd(ResultIndex, V, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05992" /><CodeLine lineNumber="5992"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05993" /><CodeLine lineNumber="5993"><Highlight kind="normal">          ResultIndex = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l05994" /><CodeLine lineNumber="5994"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05995" /><CodeLine lineNumber="5995"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05996" /><CodeLine lineNumber="5996"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add in the Base Offset if present.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05997" /><CodeLine lineNumber="5997"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) &#123;</Highlight></CodeLine>
<Link id="l05998" /><CodeLine lineNumber="5998"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs);</Highlight></CodeLine>
<Link id="l05999" /><CodeLine lineNumber="5999"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ResultIndex) &#123;</Highlight></CodeLine>
<Link id="l06000" /><CodeLine lineNumber="6000"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We need to add this separately from the scale above to help with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06001" /><CodeLine lineNumber="6001"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// SDAG consecutive load/store merging.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06002" /><CodeLine lineNumber="6002"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ResultPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != I8PtrTy)</Highlight></CodeLine>
<Link id="l06003" /><CodeLine lineNumber="6003"><Highlight kind="normal">            ResultPtr = Builder.CreatePointerCast(ResultPtr, I8PtrTy);</Highlight></CodeLine>
<Link id="l06004" /><CodeLine lineNumber="6004"><Highlight kind="normal">          ResultPtr = Builder.CreatePtrAdd(ResultPtr, ResultIndex, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06005" /><CodeLine lineNumber="6005"><Highlight kind="normal">                                           <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds);</Highlight></CodeLine>
<Link id="l06006" /><CodeLine lineNumber="6006"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06007" /><CodeLine lineNumber="6007"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06008" /><CodeLine lineNumber="6008"><Highlight kind="normal">        ResultIndex = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l06009" /><CodeLine lineNumber="6009"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06010" /><CodeLine lineNumber="6010"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06011" /><CodeLine lineNumber="6011"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ResultIndex) &#123;</Highlight></CodeLine>
<Link id="l06012" /><CodeLine lineNumber="6012"><Highlight kind="normal">        SunkAddr = ResultPtr;</Highlight></CodeLine>
<Link id="l06013" /><CodeLine lineNumber="6013"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06014" /><CodeLine lineNumber="6014"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ResultPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != I8PtrTy)</Highlight></CodeLine>
<Link id="l06015" /><CodeLine lineNumber="6015"><Highlight kind="normal">          ResultPtr = Builder.CreatePointerCast(ResultPtr, I8PtrTy);</Highlight></CodeLine>
<Link id="l06016" /><CodeLine lineNumber="6016"><Highlight kind="normal">        SunkAddr = Builder.CreatePtrAdd(ResultPtr, ResultIndex, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06017" /><CodeLine lineNumber="6017"><Highlight kind="normal">                                        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds);</Highlight></CodeLine>
<Link id="l06018" /><CodeLine lineNumber="6018"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06019" /><CodeLine lineNumber="6019"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06020" /><CodeLine lineNumber="6020"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</Highlight></CodeLine>
<Link id="l06021" /><CodeLine lineNumber="6021"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() !=</Highlight></CodeLine>
<Link id="l06022" /><CodeLine lineNumber="6022"><Highlight kind="normal">                Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l06023" /><CodeLine lineNumber="6023"><Highlight kind="normal">            !DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</Highlight></CodeLine>
<Link id="l06024" /><CodeLine lineNumber="6024"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// There are two reasons the address spaces might not match: a no-op</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06025" /><CodeLine lineNumber="6025"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// addrspacecast, or a ptrtoint/inttoptr pair. Either way, we emit a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06026" /><CodeLine lineNumber="6026"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// ptrtoint/inttoptr pair to ensure we match the original semantics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06027" /><CodeLine lineNumber="6027"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// TODO: allow bitcast between different address space pointers with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06028" /><CodeLine lineNumber="6028"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// the same size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06029" /><CodeLine lineNumber="6029"><Highlight kind="normal">          SunkAddr = Builder.CreatePtrToInt(SunkAddr, IntPtrTy, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06030" /><CodeLine lineNumber="6030"><Highlight kind="normal">          SunkAddr =</Highlight></CodeLine>
<Link id="l06031" /><CodeLine lineNumber="6031"><Highlight kind="normal">              Builder.CreateIntToPtr(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06032" /><CodeLine lineNumber="6032"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06033" /><CodeLine lineNumber="6033"><Highlight kind="normal">          SunkAddr = Builder.CreatePointerCast(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l06034" /><CodeLine lineNumber="6034"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06035" /><CodeLine lineNumber="6035"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06036" /><CodeLine lineNumber="6036"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06037" /><CodeLine lineNumber="6037"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We&#39;d require a ptrtoint/inttoptr down the line, which we can&#39;t do for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06038" /><CodeLine lineNumber="6038"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// non-integral pointers, so in that case bail out now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06039" /><CodeLine lineNumber="6039"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;BaseTy = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg ? <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg-&gt;getType() : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06040" /><CodeLine lineNumber="6040"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScaleTy = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale ? <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType() : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06041" /><CodeLine lineNumber="6041"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;BasePtrTy = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;PointerType&gt;</a>(BaseTy);</Highlight></CodeLine>
<Link id="l06042" /><CodeLine lineNumber="6042"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;ScalePtrTy = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;PointerType&gt;</a>(ScaleTy);</Highlight></CodeLine>
<Link id="l06043" /><CodeLine lineNumber="6043"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) ||</Highlight></CodeLine>
<Link id="l06044" /><CodeLine lineNumber="6044"><Highlight kind="normal">        (BasePtrTy &amp;&amp; DL-&gt;isNonIntegralPointerType(BasePtrTy)) ||</Highlight></CodeLine>
<Link id="l06045" /><CodeLine lineNumber="6045"><Highlight kind="normal">        (ScalePtrTy &amp;&amp; DL-&gt;isNonIntegralPointerType(ScalePtrTy)) ||</Highlight></CodeLine>
<Link id="l06046" /><CodeLine lineNumber="6046"><Highlight kind="normal">        (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV &amp;&amp;</Highlight></CodeLine>
<Link id="l06047" /><CodeLine lineNumber="6047"><Highlight kind="normal">         DL-&gt;isNonIntegralPointerType(<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV-&gt;getType())))</Highlight></CodeLine>
<Link id="l06048" /><CodeLine lineNumber="6048"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l06049" /><CodeLine lineNumber="6049"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06050" /><CodeLine lineNumber="6050"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;CGP: SINKING nonlocal addrmode: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></Highlight></CodeLine>
<Link id="l06051" /><CodeLine lineNumber="6051"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;MemoryInst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06052" /><CodeLine lineNumber="6052"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IntPtrTy = DL-&gt;getIntPtrType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l06053" /><CodeLine lineNumber="6053"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06054" /><CodeLine lineNumber="6054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06055" /><CodeLine lineNumber="6055"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Start with the base register. Do this first so that subsequent address</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06056" /><CodeLine lineNumber="6056"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// matching finds it last, which will prevent it from trying to match it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06057" /><CodeLine lineNumber="6057"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as the scaled value in case it happens to be a mul. That would be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06058" /><CodeLine lineNumber="6058"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// problematic if we&#39;ve sunk a different mul for the scale, because then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06059" /><CodeLine lineNumber="6059"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we&#39;d end up sinking both muls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06060" /><CodeLine lineNumber="6060"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) &#123;</Highlight></CodeLine>
<Link id="l06061" /><CodeLine lineNumber="6061"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</Highlight></CodeLine>
<Link id="l06062" /><CodeLine lineNumber="6062"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l06063" /><CodeLine lineNumber="6063"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreatePtrToInt(V, IntPtrTy, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06064" /><CodeLine lineNumber="6064"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() != IntPtrTy)</Highlight></CodeLine>
<Link id="l06065" /><CodeLine lineNumber="6065"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateIntCast(V, IntPtrTy, </Highlight><Highlight kind="comment">/&#42;isSigned=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06066" /><CodeLine lineNumber="6066"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l06067" /><CodeLine lineNumber="6067"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06068" /><CodeLine lineNumber="6068"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06069" /><CodeLine lineNumber="6069"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add the scale value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06070" /><CodeLine lineNumber="6070"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) &#123;</Highlight></CodeLine>
<Link id="l06071" /><CodeLine lineNumber="6071"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</Highlight></CodeLine>
<Link id="l06072" /><CodeLine lineNumber="6072"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() == IntPtrTy) &#123;</Highlight></CodeLine>
<Link id="l06073" /><CodeLine lineNumber="6073"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06074" /><CodeLine lineNumber="6074"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isPointerTy()) &#123;</Highlight></CodeLine>
<Link id="l06075" /><CodeLine lineNumber="6075"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreatePtrToInt(V, IntPtrTy, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06076" /><CodeLine lineNumber="6076"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IntPtrTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &lt;</Highlight></CodeLine>
<Link id="l06077" /><CodeLine lineNumber="6077"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType())-&gt;getBitWidth()) &#123;</Highlight></CodeLine>
<Link id="l06078" /><CodeLine lineNumber="6078"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateTrunc(V, IntPtrTy, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06079" /><CodeLine lineNumber="6079"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06080" /><CodeLine lineNumber="6080"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// It is only safe to sign extend the BaseReg if we know that the math</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06081" /><CodeLine lineNumber="6081"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// required to create it did not overflow before we extend it. Since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06082" /><CodeLine lineNumber="6082"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the original IR value was tossed in favor of a constant back when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06083" /><CodeLine lineNumber="6083"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the AddrMode was created we need to bail out gracefully if widths</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06084" /><CodeLine lineNumber="6084"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// do not match instead of extending it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06085" /><CodeLine lineNumber="6085"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(Result);</Highlight></CodeLine>
<Link id="l06086" /><CodeLine lineNumber="6086"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; (Result != <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg))</Highlight></CodeLine>
<Link id="l06087" /><CodeLine lineNumber="6087"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l06088" /><CodeLine lineNumber="6088"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l06089" /><CodeLine lineNumber="6089"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06090" /><CodeLine lineNumber="6090"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</Highlight></CodeLine>
<Link id="l06091" /><CodeLine lineNumber="6091"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateMul(V, ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale),</Highlight></CodeLine>
<Link id="l06092" /><CodeLine lineNumber="6092"><Highlight kind="normal">                              </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06093" /><CodeLine lineNumber="6093"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result)</Highlight></CodeLine>
<Link id="l06094" /><CodeLine lineNumber="6094"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Builder.CreateAdd(Result, V, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06095" /><CodeLine lineNumber="6095"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06096" /><CodeLine lineNumber="6096"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l06097" /><CodeLine lineNumber="6097"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06098" /><CodeLine lineNumber="6098"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06099" /><CodeLine lineNumber="6099"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add in the BaseGV if present.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06100" /><CodeLine lineNumber="6100"><Highlight kind="normal">    GlobalValue &#42;BaseGV = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV;</Highlight></CodeLine>
<Link id="l06101" /><CodeLine lineNumber="6101"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseGV != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l06102" /><CodeLine lineNumber="6102"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseGVPtr;</Highlight></CodeLine>
<Link id="l06103" /><CodeLine lineNumber="6103"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BaseGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a239427c2c3a01e23bd15b29633696536">isThreadLocal</a>()) &#123;</Highlight></CodeLine>
<Link id="l06104" /><CodeLine lineNumber="6104"><Highlight kind="normal">        BaseGVPtr = Builder.CreateThreadLocalAddress(BaseGV);</Highlight></CodeLine>
<Link id="l06105" /><CodeLine lineNumber="6105"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06106" /><CodeLine lineNumber="6106"><Highlight kind="normal">        BaseGVPtr = BaseGV;</Highlight></CodeLine>
<Link id="l06107" /><CodeLine lineNumber="6107"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06108" /><CodeLine lineNumber="6108"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreatePtrToInt(BaseGVPtr, IntPtrTy, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06109" /><CodeLine lineNumber="6109"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result)</Highlight></CodeLine>
<Link id="l06110" /><CodeLine lineNumber="6110"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Builder.CreateAdd(Result, V, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06111" /><CodeLine lineNumber="6111"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06112" /><CodeLine lineNumber="6112"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l06113" /><CodeLine lineNumber="6113"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06114" /><CodeLine lineNumber="6114"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06115" /><CodeLine lineNumber="6115"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add in the Base Offset if present.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06116" /><CodeLine lineNumber="6116"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) &#123;</Highlight></CodeLine>
<Link id="l06117" /><CodeLine lineNumber="6117"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs);</Highlight></CodeLine>
<Link id="l06118" /><CodeLine lineNumber="6118"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result)</Highlight></CodeLine>
<Link id="l06119" /><CodeLine lineNumber="6119"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Builder.CreateAdd(Result, V, </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06120" /><CodeLine lineNumber="6120"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06121" /><CodeLine lineNumber="6121"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l06122" /><CodeLine lineNumber="6122"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06123" /><CodeLine lineNumber="6123"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06124" /><CodeLine lineNumber="6124"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result)</Highlight></CodeLine>
<Link id="l06125" /><CodeLine lineNumber="6125"><Highlight kind="normal">      SunkAddr = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l06126" /><CodeLine lineNumber="6126"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06127" /><CodeLine lineNumber="6127"><Highlight kind="normal">      SunkAddr = Builder.CreateIntToPtr(Result, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </Highlight><Highlight kind="stringliteral">&quot;sunkaddr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06128" /><CodeLine lineNumber="6128"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06129" /><CodeLine lineNumber="6129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06130" /><CodeLine lineNumber="6130"><Highlight kind="normal">  MemoryInst-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(Repl, SunkAddr);</Highlight></CodeLine>
<Link id="l06131" /><CodeLine lineNumber="6131"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Store the newly computed address into the cache. In the case we reused a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06132" /><CodeLine lineNumber="6132"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value, this should be idempotent.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06133" /><CodeLine lineNumber="6133"><Highlight kind="normal">  SunkAddrs&#91;Addr&#93; = WeakTrackingVH(SunkAddr);</Highlight></CodeLine>
<Link id="l06134" /><CodeLine lineNumber="6134"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06135" /><CodeLine lineNumber="6135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have no uses, recursively delete the value and all dead instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06136" /><CodeLine lineNumber="6136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// using it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06137" /><CodeLine lineNumber="6137"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Repl-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l06138" /><CodeLine lineNumber="6138"><Highlight kind="normal">    resetIteratorIfInvalidatedWhileCalling(CurInstIterator-&gt;getParent(), &#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l06139" /><CodeLine lineNumber="6139"><Highlight kind="normal">      RecursivelyDeleteTriviallyDeadInstructions(</Highlight></CodeLine>
<Link id="l06140" /><CodeLine lineNumber="6140"><Highlight kind="normal">          Repl, TLInfo, nullptr,</Highlight></CodeLine>
<Link id="l06141" /><CodeLine lineNumber="6141"><Highlight kind="normal">          &#91;&amp;&#93;(Value &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</Highlight></CodeLine>
<Link id="l06142" /><CodeLine lineNumber="6142"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l06143" /><CodeLine lineNumber="6143"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06144" /><CodeLine lineNumber="6144"><Highlight kind="normal">  ++NumMemoryInsts;</Highlight></CodeLine>
<Link id="l06145" /><CodeLine lineNumber="6145"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06146" /><CodeLine lineNumber="6146"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06147" /><CodeLine lineNumber="6147"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06148" /><CodeLine lineNumber="6148"><Highlight kind="comment">/// Rewrite GEP input to gather/scatter to enable SelectionDAGBuilder to find</Highlight></CodeLine>
<Link id="l06149" /><CodeLine lineNumber="6149"><Highlight kind="comment">/// a uniform base to use for ISD::MGATHER/MSCATTER. SelectionDAGBuilder can</Highlight></CodeLine>
<Link id="l06150" /><CodeLine lineNumber="6150"><Highlight kind="comment">/// only handle a 2 operand GEP in the same basic block or a splat constant</Highlight></CodeLine>
<Link id="l06151" /><CodeLine lineNumber="6151"><Highlight kind="comment">/// vector. The 2 operands to the GEP must have a scalar pointer and a vector</Highlight></CodeLine>
<Link id="l06152" /><CodeLine lineNumber="6152"><Highlight kind="comment">/// index.</Highlight></CodeLine>
<Link id="l06153" /><CodeLine lineNumber="6153"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l06154" /><CodeLine lineNumber="6154"><Highlight kind="comment">/// If the existing GEP has a vector base pointer that is splat, we can look</Highlight></CodeLine>
<Link id="l06155" /><CodeLine lineNumber="6155"><Highlight kind="comment">/// through the splat to find the scalar pointer. If we can&#39;t find a scalar</Highlight></CodeLine>
<Link id="l06156" /><CodeLine lineNumber="6156"><Highlight kind="comment">/// pointer there&#39;s nothing we can do.</Highlight></CodeLine>
<Link id="l06157" /><CodeLine lineNumber="6157"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l06158" /><CodeLine lineNumber="6158"><Highlight kind="comment">/// If we have a GEP with more than 2 indices where the middle indices are all</Highlight></CodeLine>
<Link id="l06159" /><CodeLine lineNumber="6159"><Highlight kind="comment">/// zeroes, we can replace it with 2 GEPs where the second has 2 operands.</Highlight></CodeLine>
<Link id="l06160" /><CodeLine lineNumber="6160"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l06161" /><CodeLine lineNumber="6161"><Highlight kind="comment">/// If the final index isn&#39;t a vector or is a splat, we can emit a scalar GEP</Highlight></CodeLine>
<Link id="l06162" /><CodeLine lineNumber="6162"><Highlight kind="comment">/// followed by a GEP with an all zeroes vector index. This will enable</Highlight></CodeLine>
<Link id="l06163" /><CodeLine lineNumber="6163"><Highlight kind="comment">/// SelectionDAGBuilder to use the scalar GEP as the uniform base and have a</Highlight></CodeLine>
<Link id="l06164" /><CodeLine lineNumber="6164"><Highlight kind="comment">/// zero index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06165" /><CodeLine lineNumber="6165"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeGatherScatterInst(Instruction &#42;MemoryInst,</Highlight></CodeLine>
<Link id="l06166" /><CodeLine lineNumber="6166"><Highlight kind="normal">                                               <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</Highlight></CodeLine>
<Link id="l06167" /><CodeLine lineNumber="6167"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewAddr;</Highlight></CodeLine>
<Link id="l06168" /><CodeLine lineNumber="6168"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06169" /><CodeLine lineNumber="6169"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) &#123;</Highlight></CodeLine>
<Link id="l06170" /><CodeLine lineNumber="6170"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t optimize GEPs that don&#39;t have indices.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06171" /><CodeLine lineNumber="6171"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasIndices())</Highlight></CodeLine>
<Link id="l06172" /><CodeLine lineNumber="6172"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06173" /><CodeLine lineNumber="6173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06174" /><CodeLine lineNumber="6174"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the GEP and the gather/scatter aren&#39;t in the same BB, don&#39;t optimize.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06175" /><CodeLine lineNumber="6175"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: We should support this by sinking the GEP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06176" /><CodeLine lineNumber="6176"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemoryInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getParent())</Highlight></CodeLine>
<Link id="l06177" /><CodeLine lineNumber="6177"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06178" /><CodeLine lineNumber="6178"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06179" /><CodeLine lineNumber="6179"><Highlight kind="normal">    SmallVector&lt;Value &#42;, 2&gt; <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;operands());</Highlight></CodeLine>
<Link id="l06180" /><CodeLine lineNumber="6180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06181" /><CodeLine lineNumber="6181"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RewriteGEP = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06182" /><CodeLine lineNumber="6182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06183" /><CodeLine lineNumber="6183"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;isVectorTy()) &#123;</Highlight></CodeLine>
<Link id="l06184" /><CodeLine lineNumber="6184"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93; = <a href="/docs/api/namespaces/llvm/#a48fc95f799e976fb8bf571d61e6337f5">getSplatValue</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;);</Highlight></CodeLine>
<Link id="l06185" /><CodeLine lineNumber="6185"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;)</Highlight></CodeLine>
<Link id="l06186" /><CodeLine lineNumber="6186"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06187" /><CodeLine lineNumber="6187"><Highlight kind="normal">      RewriteGEP = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06188" /><CodeLine lineNumber="6188"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06189" /><CodeLine lineNumber="6189"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06190" /><CodeLine lineNumber="6190"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> FinalIndex = <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.size() - 1;</Highlight></CodeLine>
<Link id="l06191" /><CodeLine lineNumber="6191"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06192" /><CodeLine lineNumber="6192"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ensure all but the last index is 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06193" /><CodeLine lineNumber="6193"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: This isn&#39;t strictly required. All that&#39;s required is that they are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06194" /><CodeLine lineNumber="6194"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// all scalars or splats.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06195" /><CodeLine lineNumber="6195"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 1; i &lt; FinalIndex; ++i) &#123;</Highlight></CodeLine>
<Link id="l06196" /><CodeLine lineNumber="6196"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;i&#93;);</Highlight></CodeLine>
<Link id="l06197" /><CodeLine lineNumber="6197"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l06198" /><CodeLine lineNumber="6198"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06199" /><CodeLine lineNumber="6199"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()))</Highlight></CodeLine>
<Link id="l06200" /><CodeLine lineNumber="6200"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getSplatValue();</Highlight></CodeLine>
<Link id="l06201" /><CodeLine lineNumber="6201"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l06202" /><CodeLine lineNumber="6202"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI || !CI-&gt;<a href="/docs/api/classes/llvm/constantint/#a882d55a6aa2028e1a5ad708b275334e0">isZero</a>())</Highlight></CodeLine>
<Link id="l06203" /><CodeLine lineNumber="6203"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06204" /><CodeLine lineNumber="6204"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Scalarize the index if needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06205" /><CodeLine lineNumber="6205"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;i&#93; = CI;</Highlight></CodeLine>
<Link id="l06206" /><CodeLine lineNumber="6206"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06207" /><CodeLine lineNumber="6207"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06208" /><CodeLine lineNumber="6208"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to scalarize the final index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06209" /><CodeLine lineNumber="6209"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;isVectorTy()) &#123;</Highlight></CodeLine>
<Link id="l06210" /><CodeLine lineNumber="6210"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a48fc95f799e976fb8bf571d61e6337f5">getSplatValue</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;)) &#123;</Highlight></CodeLine>
<Link id="l06211" /><CodeLine lineNumber="6211"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(V);</Highlight></CodeLine>
<Link id="l06212" /><CodeLine lineNumber="6212"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Don&#39;t scalarize all zeros vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06213" /><CodeLine lineNumber="6213"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> || !<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isZero()) &#123;</Highlight></CodeLine>
<Link id="l06214" /><CodeLine lineNumber="6214"><Highlight kind="normal">          <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93; = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</Highlight></CodeLine>
<Link id="l06215" /><CodeLine lineNumber="6215"><Highlight kind="normal">          RewriteGEP = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06216" /><CodeLine lineNumber="6216"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06217" /><CodeLine lineNumber="6217"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06218" /><CodeLine lineNumber="6218"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06219" /><CodeLine lineNumber="6219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06220" /><CodeLine lineNumber="6220"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we made any changes or the we have extra operands, we need to generate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06221" /><CodeLine lineNumber="6221"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// new instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06222" /><CodeLine lineNumber="6222"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RewriteGEP &amp;&amp; <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.size() == 2)</Highlight></CodeLine>
<Link id="l06223" /><CodeLine lineNumber="6223"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06224" /><CodeLine lineNumber="6224"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06225" /><CodeLine lineNumber="6225"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType())-&gt;getElementCount();</Highlight></CodeLine>
<Link id="l06226" /><CodeLine lineNumber="6226"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06227" /><CodeLine lineNumber="6227"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(MemoryInst);</Highlight></CodeLine>
<Link id="l06228" /><CodeLine lineNumber="6228"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06229" /><CodeLine lineNumber="6229"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SourceTy = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType();</Highlight></CodeLine>
<Link id="l06230" /><CodeLine lineNumber="6230"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScalarIndexTy = DL-&gt;getIndexType(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;getScalarType());</Highlight></CodeLine>
<Link id="l06231" /><CodeLine lineNumber="6231"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06232" /><CodeLine lineNumber="6232"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the final index isn&#39;t a vector, emit a scalar GEP containing all ops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06233" /><CodeLine lineNumber="6233"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and a vector GEP with all zeroes final index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06234" /><CodeLine lineNumber="6234"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;isVectorTy()) &#123;</Highlight></CodeLine>
<Link id="l06235" /><CodeLine lineNumber="6235"><Highlight kind="normal">      NewAddr = Builder.CreateGEP(SourceTy, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</Highlight></CodeLine>
<Link id="l06236" /><CodeLine lineNumber="6236"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndexTy = VectorType::get(ScalarIndexTy, NumElts);</Highlight></CodeLine>
<Link id="l06237" /><CodeLine lineNumber="6237"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SecondTy = <a href="/docs/api/classes/llvm/getelementptrinst/#a99d4bfe49182f8d80abb1960f2c12d46">GetElementPtrInst::getIndexedType</a>(</Highlight></CodeLine>
<Link id="l06238" /><CodeLine lineNumber="6238"><Highlight kind="normal">          SourceTy, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</Highlight></CodeLine>
<Link id="l06239" /><CodeLine lineNumber="6239"><Highlight kind="normal">      NewAddr =</Highlight></CodeLine>
<Link id="l06240" /><CodeLine lineNumber="6240"><Highlight kind="normal">          Builder.CreateGEP(SecondTy, NewAddr, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(IndexTy));</Highlight></CodeLine>
<Link id="l06241" /><CodeLine lineNumber="6241"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06242" /><CodeLine lineNumber="6242"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;;</Highlight></CodeLine>
<Link id="l06243" /><CodeLine lineNumber="6243"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;;</Highlight></CodeLine>
<Link id="l06244" /><CodeLine lineNumber="6244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06245" /><CodeLine lineNumber="6245"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Create a scalar GEP if there are more than 2 operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06246" /><CodeLine lineNumber="6246"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.size() != 2) &#123;</Highlight></CodeLine>
<Link id="l06247" /><CodeLine lineNumber="6247"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Replace the last index with 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06248" /><CodeLine lineNumber="6248"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93; =</Highlight></CodeLine>
<Link id="l06249" /><CodeLine lineNumber="6249"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;getScalarType());</Highlight></CodeLine>
<Link id="l06250" /><CodeLine lineNumber="6250"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Builder.CreateGEP(SourceTy, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</Highlight></CodeLine>
<Link id="l06251" /><CodeLine lineNumber="6251"><Highlight kind="normal">        SourceTy = <a href="/docs/api/classes/llvm/getelementptrinst/#a99d4bfe49182f8d80abb1960f2c12d46">GetElementPtrInst::getIndexedType</a>(</Highlight></CodeLine>
<Link id="l06252" /><CodeLine lineNumber="6252"><Highlight kind="normal">            SourceTy, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</Highlight></CodeLine>
<Link id="l06253" /><CodeLine lineNumber="6253"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06254" /><CodeLine lineNumber="6254"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06255" /><CodeLine lineNumber="6255"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Now create the GEP with scalar pointer and vector index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06256" /><CodeLine lineNumber="6256"><Highlight kind="normal">      NewAddr = Builder.CreateGEP(SourceTy, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, Index);</Highlight></CodeLine>
<Link id="l06257" /><CodeLine lineNumber="6257"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06258" /><CodeLine lineNumber="6258"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) &#123;</Highlight></CodeLine>
<Link id="l06259" /><CodeLine lineNumber="6259"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Not a GEP, maybe its a splat and we can create a GEP to enable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06260" /><CodeLine lineNumber="6260"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// SelectionDAGBuilder to use it as a uniform base.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06261" /><CodeLine lineNumber="6261"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/#a48fc95f799e976fb8bf571d61e6337f5">getSplatValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l06262" /><CodeLine lineNumber="6262"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!V)</Highlight></CodeLine>
<Link id="l06263" /><CodeLine lineNumber="6263"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06264" /><CodeLine lineNumber="6264"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06265" /><CodeLine lineNumber="6265"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType())-&gt;getElementCount();</Highlight></CodeLine>
<Link id="l06266" /><CodeLine lineNumber="6266"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06267" /><CodeLine lineNumber="6267"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(MemoryInst);</Highlight></CodeLine>
<Link id="l06268" /><CodeLine lineNumber="6268"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06269" /><CodeLine lineNumber="6269"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Emit a vector GEP with a scalar pointer and all 0s vector index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06270" /><CodeLine lineNumber="6270"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScalarIndexTy = DL-&gt;getIndexType(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;getScalarType());</Highlight></CodeLine>
<Link id="l06271" /><CodeLine lineNumber="6271"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndexTy = VectorType::get(ScalarIndexTy, NumElts);</Highlight></CodeLine>
<Link id="l06272" /><CodeLine lineNumber="6272"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScalarTy;</Highlight></CodeLine>
<Link id="l06273" /><CodeLine lineNumber="6273"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(MemoryInst)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>() ==</Highlight></CodeLine>
<Link id="l06274" /><CodeLine lineNumber="6274"><Highlight kind="normal">        Intrinsic::masked&#95;gather) &#123;</Highlight></CodeLine>
<Link id="l06275" /><CodeLine lineNumber="6275"><Highlight kind="normal">      ScalarTy = MemoryInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</Highlight></CodeLine>
<Link id="l06276" /><CodeLine lineNumber="6276"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06277" /><CodeLine lineNumber="6277"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(MemoryInst)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>() ==</Highlight></CodeLine>
<Link id="l06278" /><CodeLine lineNumber="6278"><Highlight kind="normal">             Intrinsic::masked&#95;scatter);</Highlight></CodeLine>
<Link id="l06279" /><CodeLine lineNumber="6279"><Highlight kind="normal">      ScalarTy = MemoryInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</Highlight></CodeLine>
<Link id="l06280" /><CodeLine lineNumber="6280"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06281" /><CodeLine lineNumber="6281"><Highlight kind="normal">    NewAddr = Builder.CreateGEP(ScalarTy, V, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(IndexTy));</Highlight></CodeLine>
<Link id="l06282" /><CodeLine lineNumber="6282"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06283" /><CodeLine lineNumber="6283"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Constant, SelectionDAGBuilder knows to check if its a splat.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06284" /><CodeLine lineNumber="6284"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06285" /><CodeLine lineNumber="6285"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06286" /><CodeLine lineNumber="6286"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06287" /><CodeLine lineNumber="6287"><Highlight kind="normal">  MemoryInst-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, NewAddr);</Highlight></CodeLine>
<Link id="l06288" /><CodeLine lineNumber="6288"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06289" /><CodeLine lineNumber="6289"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have no uses, recursively delete the value and all dead instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06290" /><CodeLine lineNumber="6290"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// using it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06291" /><CodeLine lineNumber="6291"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;use&#95;empty())</Highlight></CodeLine>
<Link id="l06292" /><CodeLine lineNumber="6292"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</Highlight></CodeLine>
<Link id="l06293" /><CodeLine lineNumber="6293"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, TLInfo, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06294" /><CodeLine lineNumber="6294"><Highlight kind="normal">        &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</Highlight></CodeLine>
<Link id="l06295" /><CodeLine lineNumber="6295"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06296" /><CodeLine lineNumber="6296"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06297" /><CodeLine lineNumber="6297"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06298" /><CodeLine lineNumber="6298"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06299" /><CodeLine lineNumber="6299"><Highlight kind="comment">/// If there are any memory operands, use OptimizeMemoryInst to sink their</Highlight></CodeLine>
<Link id="l06300" /><CodeLine lineNumber="6300"><Highlight kind="comment">/// address computing into the block when possible / profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06301" /><CodeLine lineNumber="6301"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeInlineAsmInst(CallInst &#42;CS) &#123;</Highlight></CodeLine>
<Link id="l06302" /><CodeLine lineNumber="6302"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06303" /><CodeLine lineNumber="6303"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06304" /><CodeLine lineNumber="6304"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> TargetRegisterInfo &#42;TRI =</Highlight></CodeLine>
<Link id="l06305" /><CodeLine lineNumber="6305"><Highlight kind="normal">      TM-&gt;getSubtargetImpl(&#42;CS-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())-&gt;getRegisterInfo();</Highlight></CodeLine>
<Link id="l06306" /><CodeLine lineNumber="6306"><Highlight kind="normal">  TargetLowering::AsmOperandInfoVector TargetConstraints =</Highlight></CodeLine>
<Link id="l06307" /><CodeLine lineNumber="6307"><Highlight kind="normal">      TLI-&gt;ParseConstraints(&#42;DL, TRI, &#42;CS);</Highlight></CodeLine>
<Link id="l06308" /><CodeLine lineNumber="6308"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgNo = 0;</Highlight></CodeLine>
<Link id="l06309" /><CodeLine lineNumber="6309"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (TargetLowering::AsmOperandInfo &amp;OpInfo : TargetConstraints) &#123;</Highlight></CodeLine>
<Link id="l06310" /><CodeLine lineNumber="6310"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the constraint code and ConstraintType to use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06311" /><CodeLine lineNumber="6311"><Highlight kind="normal">    TLI-&gt;ComputeConstraintToUse(OpInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>());</Highlight></CodeLine>
<Link id="l06312" /><CodeLine lineNumber="6312"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06313" /><CodeLine lineNumber="6313"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Also handle C&#95;Address?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06314" /><CodeLine lineNumber="6314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpInfo.ConstraintType == TargetLowering::C&#95;Memory &amp;&amp;</Highlight></CodeLine>
<Link id="l06315" /><CodeLine lineNumber="6315"><Highlight kind="normal">        OpInfo.isIndirect) &#123;</Highlight></CodeLine>
<Link id="l06316" /><CodeLine lineNumber="6316"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OpVal = CS-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(ArgNo++);</Highlight></CodeLine>
<Link id="l06317" /><CodeLine lineNumber="6317"><Highlight kind="normal">      MadeChange |= optimizeMemoryInst(CS, OpVal, OpVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), ~0u);</Highlight></CodeLine>
<Link id="l06318" /><CodeLine lineNumber="6318"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpInfo.Type == <a href="/docs/api/classes/llvm/inlineasm/#a511f48809ad14f13e50b957a137a9d34a79ca3881430605a6c7da5227cfb115d6">InlineAsm::isInput</a>)</Highlight></CodeLine>
<Link id="l06319" /><CodeLine lineNumber="6319"><Highlight kind="normal">      ArgNo++;</Highlight></CodeLine>
<Link id="l06320" /><CodeLine lineNumber="6320"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06321" /><CodeLine lineNumber="6321"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06322" /><CodeLine lineNumber="6322"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l06323" /><CodeLine lineNumber="6323"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06324" /><CodeLine lineNumber="6324"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06325" /><CodeLine lineNumber="6325"><Highlight kind="comment">/// Check if all the uses of \\p Val are equivalent (or free) zero or</Highlight></CodeLine>
<Link id="l06326" /><CodeLine lineNumber="6326"><Highlight kind="comment">/// sign extensions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06327" /><CodeLine lineNumber="6327" lineLink="#ae965d93aa46ad834c21718eba4b5b78e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l06328" /><CodeLine lineNumber="6328"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Val-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Input must have at least one use&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06329" /><CodeLine lineNumber="6329"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FirstUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;Val-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>());</Highlight></CodeLine>
<Link id="l06330" /><CodeLine lineNumber="6330"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSExt = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(FirstUser);</Highlight></CodeLine>
<Link id="l06331" /><CodeLine lineNumber="6331"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ExtTy = FirstUser-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l06332" /><CodeLine lineNumber="6332"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : Val-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l06333" /><CodeLine lineNumber="6333"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l06334" /><CodeLine lineNumber="6334"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((IsSExt &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(UI)) || (!IsSExt &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(UI)))</Highlight></CodeLine>
<Link id="l06335" /><CodeLine lineNumber="6335"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06336" /><CodeLine lineNumber="6336"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;CurTy = UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l06337" /><CodeLine lineNumber="6337"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Same input and output types: Same instruction after CSE.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06338" /><CodeLine lineNumber="6338"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurTy == ExtTy)</Highlight></CodeLine>
<Link id="l06339" /><CodeLine lineNumber="6339"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06340" /><CodeLine lineNumber="6340"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06341" /><CodeLine lineNumber="6341"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If IsSExt is true, we are in this situation:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06342" /><CodeLine lineNumber="6342"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a = Val</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06343" /><CodeLine lineNumber="6343"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// b = sext ty1 a to ty2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06344" /><CodeLine lineNumber="6344"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// c = sext ty1 a to ty3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06345" /><CodeLine lineNumber="6345"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Assuming ty2 is shorter than ty3, this could be turned into:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06346" /><CodeLine lineNumber="6346"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a = Val</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06347" /><CodeLine lineNumber="6347"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// b = sext ty1 a to ty2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06348" /><CodeLine lineNumber="6348"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// c = sext ty2 b to ty3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06349" /><CodeLine lineNumber="6349"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// However, the last sext is not free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06350" /><CodeLine lineNumber="6350"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsSExt)</Highlight></CodeLine>
<Link id="l06351" /><CodeLine lineNumber="6351"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06352" /><CodeLine lineNumber="6352"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06353" /><CodeLine lineNumber="6353"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This is a ZExt, maybe this is free to extend from one type to another.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06354" /><CodeLine lineNumber="6354"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In that case, we would not account for a different use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06355" /><CodeLine lineNumber="6355"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;NarrowTy;</Highlight></CodeLine>
<Link id="l06356" /><CodeLine lineNumber="6356"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;LargeTy;</Highlight></CodeLine>
<Link id="l06357" /><CodeLine lineNumber="6357"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;</Highlight></CodeLine>
<Link id="l06358" /><CodeLine lineNumber="6358"><Highlight kind="normal">        CurTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()) &#123;</Highlight></CodeLine>
<Link id="l06359" /><CodeLine lineNumber="6359"><Highlight kind="normal">      NarrowTy = CurTy;</Highlight></CodeLine>
<Link id="l06360" /><CodeLine lineNumber="6360"><Highlight kind="normal">      LargeTy = ExtTy;</Highlight></CodeLine>
<Link id="l06361" /><CodeLine lineNumber="6361"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06362" /><CodeLine lineNumber="6362"><Highlight kind="normal">      NarrowTy = ExtTy;</Highlight></CodeLine>
<Link id="l06363" /><CodeLine lineNumber="6363"><Highlight kind="normal">      LargeTy = CurTy;</Highlight></CodeLine>
<Link id="l06364" /><CodeLine lineNumber="6364"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06365" /><CodeLine lineNumber="6365"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06366" /><CodeLine lineNumber="6366"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a342be90695496b88a8854a775dfd030f">isZExtFree</a>(NarrowTy, LargeTy))</Highlight></CodeLine>
<Link id="l06367" /><CodeLine lineNumber="6367"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06368" /><CodeLine lineNumber="6368"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06369" /><CodeLine lineNumber="6369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All uses are the same or can be derived from one another for free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06370" /><CodeLine lineNumber="6370"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06371" /><CodeLine lineNumber="6371"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06372" /><CodeLine lineNumber="6372"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06373" /><CodeLine lineNumber="6373"><Highlight kind="comment">/// Try to speculatively promote extensions in \\p Exts and continue</Highlight></CodeLine>
<Link id="l06374" /><CodeLine lineNumber="6374"><Highlight kind="comment">/// promoting through newly promoted operands recursively as far as doing so is</Highlight></CodeLine>
<Link id="l06375" /><CodeLine lineNumber="6375"><Highlight kind="comment">/// profitable. Save extensions profitably moved up, in \\p ProfitablyMovedExts.</Highlight></CodeLine>
<Link id="l06376" /><CodeLine lineNumber="6376"><Highlight kind="comment">/// When some promotion happened, \\p TPT contains the proper state to revert</Highlight></CodeLine>
<Link id="l06377" /><CodeLine lineNumber="6377"><Highlight kind="comment">/// them.</Highlight></CodeLine>
<Link id="l06378" /><CodeLine lineNumber="6378"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l06379" /><CodeLine lineNumber="6379"><Highlight kind="comment">/// \\return true if some promotion happened, false otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06380" /><CodeLine lineNumber="6380"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::tryToPromoteExts(</Highlight></CodeLine>
<Link id="l06381" /><CodeLine lineNumber="6381"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;Exts,</Highlight></CodeLine>
<Link id="l06382" /><CodeLine lineNumber="6382"><Highlight kind="normal">    SmallVectorImpl&lt;Instruction &#42;&gt; &amp;ProfitablyMovedExts,</Highlight></CodeLine>
<Link id="l06383" /><CodeLine lineNumber="6383"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CreatedInstsCost) &#123;</Highlight></CodeLine>
<Link id="l06384" /><CodeLine lineNumber="6384"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Promoted = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06385" /><CodeLine lineNumber="6385"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06386" /><CodeLine lineNumber="6386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over all the extensions to try to promote them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06387" /><CodeLine lineNumber="6387"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Exts) &#123;</Highlight></CodeLine>
<Link id="l06388" /><CodeLine lineNumber="6388"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Early check if we directly have ext(load).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06389" /><CodeLine lineNumber="6389"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0))) &#123;</Highlight></CodeLine>
<Link id="l06390" /><CodeLine lineNumber="6390"><Highlight kind="normal">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06391" /><CodeLine lineNumber="6391"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06392" /><CodeLine lineNumber="6392"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06393" /><CodeLine lineNumber="6393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06394" /><CodeLine lineNumber="6394"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check whether or not we want to do any promotion.  The reason we have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06395" /><CodeLine lineNumber="6395"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this check inside the for loop is to catch the case where an extension</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06396" /><CodeLine lineNumber="6396"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is directly fed by a load because in such case the extension can be moved</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06397" /><CodeLine lineNumber="6397"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// up without any promotion on its operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06398" /><CodeLine lineNumber="6398"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;enableExtLdPromotion() || <a href="#a337eb74e6c82771bb21ce598a8d3090c">DisableExtLdPromotion</a>)</Highlight></CodeLine>
<Link id="l06399" /><CodeLine lineNumber="6399"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06400" /><CodeLine lineNumber="6400"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06401" /><CodeLine lineNumber="6401"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get the action to perform the promotion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06402" /><CodeLine lineNumber="6402"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">TypePromotionHelper::Action</a> TPH =</Highlight></CodeLine>
<Link id="l06403" /><CodeLine lineNumber="6403"><Highlight kind="normal">        <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">TypePromotionHelper::getAction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, InsertedInsts, &#42;TLI, PromotedInsts);</Highlight></CodeLine>
<Link id="l06404" /><CodeLine lineNumber="6404"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if we can promote.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06405" /><CodeLine lineNumber="6405"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TPH) &#123;</Highlight></CodeLine>
<Link id="l06406" /><CodeLine lineNumber="6406"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Save the current extension as we cannot move up through its operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06407" /><CodeLine lineNumber="6407"><Highlight kind="normal">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06408" /><CodeLine lineNumber="6408"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06409" /><CodeLine lineNumber="6409"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06410" /><CodeLine lineNumber="6410"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06411" /><CodeLine lineNumber="6411"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Save the current state.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06412" /><CodeLine lineNumber="6412"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</Highlight></CodeLine>
<Link id="l06413" /><CodeLine lineNumber="6413"><Highlight kind="normal">        TPT.getRestorationPoint();</Highlight></CodeLine>
<Link id="l06414" /><CodeLine lineNumber="6414"><Highlight kind="normal">    SmallVector&lt;Instruction &#42;, 4&gt; NewExts;</Highlight></CodeLine>
<Link id="l06415" /><CodeLine lineNumber="6415"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NewCreatedInstsCost = 0;</Highlight></CodeLine>
<Link id="l06416" /><CodeLine lineNumber="6416"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExtCost = !TLI-&gt;isExtFree(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06417" /><CodeLine lineNumber="6417"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Promote.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06418" /><CodeLine lineNumber="6418"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PromotedVal = TPH(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TPT, PromotedInsts, NewCreatedInstsCost,</Highlight></CodeLine>
<Link id="l06419" /><CodeLine lineNumber="6419"><Highlight kind="normal">                             &amp;NewExts, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;TLI);</Highlight></CodeLine>
<Link id="l06420" /><CodeLine lineNumber="6420"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromotedVal &amp;&amp;</Highlight></CodeLine>
<Link id="l06421" /><CodeLine lineNumber="6421"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;TypePromotionHelper should have filtered out those cases&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06422" /><CodeLine lineNumber="6422"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06423" /><CodeLine lineNumber="6423"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We would be able to merge only one extension in a load.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06424" /><CodeLine lineNumber="6424"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Therefore, if we have more than 1 new extension we heuristically</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06425" /><CodeLine lineNumber="6425"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cut this search path, because it means we degrade the code quality.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06426" /><CodeLine lineNumber="6426"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// With exactly 2, the transformation is neutral, because we will merge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06427" /><CodeLine lineNumber="6427"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// one extension but leave one. However, we optimistically keep going,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06428" /><CodeLine lineNumber="6428"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// because the new extension may be removed too. Also avoid replacing a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06429" /><CodeLine lineNumber="6429"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// single free extension with multiple extensions, as this increases the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06430" /><CodeLine lineNumber="6430"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// number of IR instructions while not providing any savings.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06431" /><CodeLine lineNumber="6431"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">long</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">long</Highlight><Highlight kind="normal"> TotalCreatedInstsCost = CreatedInstsCost + NewCreatedInstsCost;</Highlight></CodeLine>
<Link id="l06432" /><CodeLine lineNumber="6432"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: It would be possible to propagate a negative value instead of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06433" /><CodeLine lineNumber="6433"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// conservatively ceiling it to 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06434" /><CodeLine lineNumber="6434"><Highlight kind="normal">    TotalCreatedInstsCost =</Highlight></CodeLine>
<Link id="l06435" /><CodeLine lineNumber="6435"><Highlight kind="normal">        std::max((</Highlight><Highlight kind="keywordtype">long</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">long</Highlight><Highlight kind="normal">)0, (TotalCreatedInstsCost - ExtCost));</Highlight></CodeLine>
<Link id="l06436" /><CodeLine lineNumber="6436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l06437" /><CodeLine lineNumber="6437"><Highlight kind="normal">        (TotalCreatedInstsCost &gt; 1 ||</Highlight></CodeLine>
<Link id="l06438" /><CodeLine lineNumber="6438"><Highlight kind="normal">         !<a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(&#42;TLI, &#42;DL, PromotedVal) ||</Highlight></CodeLine>
<Link id="l06439" /><CodeLine lineNumber="6439"><Highlight kind="normal">         (ExtCost == 0 &amp;&amp; NewExts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 1))) &#123;</Highlight></CodeLine>
<Link id="l06440" /><CodeLine lineNumber="6440"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This promotion is not profitable, rollback to the previous state, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06441" /><CodeLine lineNumber="6441"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// save the current extension in ProfitablyMovedExts as the latest</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06442" /><CodeLine lineNumber="6442"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// speculative promotion turned out to be unprofitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06443" /><CodeLine lineNumber="6443"><Highlight kind="normal">      TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l06444" /><CodeLine lineNumber="6444"><Highlight kind="normal">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06445" /><CodeLine lineNumber="6445"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06446" /><CodeLine lineNumber="6446"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06447" /><CodeLine lineNumber="6447"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Continue promoting NewExts as far as doing so is profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06448" /><CodeLine lineNumber="6448"><Highlight kind="normal">    SmallVector&lt;Instruction &#42;, 2&gt; NewlyMovedExts;</Highlight></CodeLine>
<Link id="l06449" /><CodeLine lineNumber="6449"><Highlight kind="normal">    (void)tryToPromoteExts(TPT, NewExts, NewlyMovedExts, TotalCreatedInstsCost);</Highlight></CodeLine>
<Link id="l06450" /><CodeLine lineNumber="6450"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NewPromoted = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06451" /><CodeLine lineNumber="6451"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtInst : NewlyMovedExts) &#123;</Highlight></CodeLine>
<Link id="l06452" /><CodeLine lineNumber="6452"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;MovedExt = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ExtInst);</Highlight></CodeLine>
<Link id="l06453" /><CodeLine lineNumber="6453"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ExtOperand = MovedExt-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l06454" /><CodeLine lineNumber="6454"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we have reached to a load, we need this extra profitability check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06455" /><CodeLine lineNumber="6455"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// as it could potentially be merged into an ext(load).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06456" /><CodeLine lineNumber="6456"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(ExtOperand) &amp;&amp;</Highlight></CodeLine>
<Link id="l06457" /><CodeLine lineNumber="6457"><Highlight kind="normal">          !(<a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a> || NewCreatedInstsCost &lt;= ExtCost ||</Highlight></CodeLine>
<Link id="l06458" /><CodeLine lineNumber="6458"><Highlight kind="normal">            (ExtOperand-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || <a href="#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a>(ExtOperand, &#42;TLI))))</Highlight></CodeLine>
<Link id="l06459" /><CodeLine lineNumber="6459"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06460" /><CodeLine lineNumber="6460"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06461" /><CodeLine lineNumber="6461"><Highlight kind="normal">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MovedExt);</Highlight></CodeLine>
<Link id="l06462" /><CodeLine lineNumber="6462"><Highlight kind="normal">      NewPromoted = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06463" /><CodeLine lineNumber="6463"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06464" /><CodeLine lineNumber="6464"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06465" /><CodeLine lineNumber="6465"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If none of speculative promotions for NewExts is profitable, rollback</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06466" /><CodeLine lineNumber="6466"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and save the current extension (I) as the last profitable extension.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06467" /><CodeLine lineNumber="6467"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewPromoted) &#123;</Highlight></CodeLine>
<Link id="l06468" /><CodeLine lineNumber="6468"><Highlight kind="normal">      TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l06469" /><CodeLine lineNumber="6469"><Highlight kind="normal">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06470" /><CodeLine lineNumber="6470"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06471" /><CodeLine lineNumber="6471"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06472" /><CodeLine lineNumber="6472"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The promotion is profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06473" /><CodeLine lineNumber="6473"><Highlight kind="normal">    Promoted = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06474" /><CodeLine lineNumber="6474"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06475" /><CodeLine lineNumber="6475"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Promoted;</Highlight></CodeLine>
<Link id="l06476" /><CodeLine lineNumber="6476"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06477" /><CodeLine lineNumber="6477"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06478" /><CodeLine lineNumber="6478"><Highlight kind="comment">/// Merging redundant sexts when one is dominating the other.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06479" /><CodeLine lineNumber="6479"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::mergeSExts(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l06480" /><CodeLine lineNumber="6480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06481" /><CodeLine lineNumber="6481"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Entry : ValToSExtendedUses) &#123;</Highlight></CodeLine>
<Link id="l06482" /><CodeLine lineNumber="6482"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321">SExts</a> &amp;Insts = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.second;</Highlight></CodeLine>
<Link id="l06483" /><CodeLine lineNumber="6483"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321">SExts</a> CurPts;</Highlight></CodeLine>
<Link id="l06484" /><CodeLine lineNumber="6484"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;Inst : Insts) &#123;</Highlight></CodeLine>
<Link id="l06485" /><CodeLine lineNumber="6485"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RemovedInsts.count(Inst) || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Inst) ||</Highlight></CodeLine>
<Link id="l06486" /><CodeLine lineNumber="6486"><Highlight kind="normal">          Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first)</Highlight></CodeLine>
<Link id="l06487" /><CodeLine lineNumber="6487"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06488" /><CodeLine lineNumber="6488"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> inserted = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06489" /><CodeLine lineNumber="6489"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pt : CurPts) &#123;</Highlight></CodeLine>
<Link id="l06490" /><CodeLine lineNumber="6490"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).<a href="/docs/api/files/lib/lib/codegen/regallocfast-cpp/#a73ba38b119a12eb092295458fde44f52">dominates</a>(Inst, Pt)) &#123;</Highlight></CodeLine>
<Link id="l06491" /><CodeLine lineNumber="6491"><Highlight kind="normal">          <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Pt, Inst, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l06492" /><CodeLine lineNumber="6492"><Highlight kind="normal">          RemovedInsts.insert(Pt);</Highlight></CodeLine>
<Link id="l06493" /><CodeLine lineNumber="6493"><Highlight kind="normal">          Pt-&gt;removeFromParent();</Highlight></CodeLine>
<Link id="l06494" /><CodeLine lineNumber="6494"><Highlight kind="normal">          Pt = Inst;</Highlight></CodeLine>
<Link id="l06495" /><CodeLine lineNumber="6495"><Highlight kind="normal">          inserted = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06496" /><CodeLine lineNumber="6496"><Highlight kind="normal">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06497" /><CodeLine lineNumber="6497"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06498" /><CodeLine lineNumber="6498"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06499" /><CodeLine lineNumber="6499"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).<a href="/docs/api/files/lib/lib/codegen/regallocfast-cpp/#a73ba38b119a12eb092295458fde44f52">dominates</a>(Pt, Inst))</Highlight></CodeLine>
<Link id="l06500" /><CodeLine lineNumber="6500"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Give up if we need to merge in a common dominator as the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06501" /><CodeLine lineNumber="6501"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// experiments show it is not profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06502" /><CodeLine lineNumber="6502"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06503" /><CodeLine lineNumber="6503"><Highlight kind="normal">        <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Inst, Pt, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l06504" /><CodeLine lineNumber="6504"><Highlight kind="normal">        RemovedInsts.insert(Inst);</Highlight></CodeLine>
<Link id="l06505" /><CodeLine lineNumber="6505"><Highlight kind="normal">        Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</Highlight></CodeLine>
<Link id="l06506" /><CodeLine lineNumber="6506"><Highlight kind="normal">        inserted = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06507" /><CodeLine lineNumber="6507"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06508" /><CodeLine lineNumber="6508"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06509" /><CodeLine lineNumber="6509"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06510" /><CodeLine lineNumber="6510"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!inserted)</Highlight></CodeLine>
<Link id="l06511" /><CodeLine lineNumber="6511"><Highlight kind="normal">        CurPts.push&#95;back(Inst);</Highlight></CodeLine>
<Link id="l06512" /><CodeLine lineNumber="6512"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06513" /><CodeLine lineNumber="6513"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06514" /><CodeLine lineNumber="6514"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l06515" /><CodeLine lineNumber="6515"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06516" /><CodeLine lineNumber="6516"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06517" /><CodeLine lineNumber="6517"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Splitting large data structures so that the GEPs accessing them can have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06518" /><CodeLine lineNumber="6518"><Highlight kind="normal"></Highlight><Highlight kind="comment">// smaller offsets so that they can be sunk to the same blocks as their users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06519" /><CodeLine lineNumber="6519"><Highlight kind="normal"></Highlight><Highlight kind="comment">// For example, a large struct starting from %base is split into two parts</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06520" /><CodeLine lineNumber="6520"><Highlight kind="normal"></Highlight><Highlight kind="comment">// where the second part starts from %new&#95;base.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06521" /><CodeLine lineNumber="6521"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06522" /><CodeLine lineNumber="6522"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Before:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06523" /><CodeLine lineNumber="6523"><Highlight kind="normal"></Highlight><Highlight kind="comment">// BB0:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06524" /><CodeLine lineNumber="6524"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %base     =</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06525" /><CodeLine lineNumber="6525"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06526" /><CodeLine lineNumber="6526"><Highlight kind="normal"></Highlight><Highlight kind="comment">// BB1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06527" /><CodeLine lineNumber="6527"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %gep0     = gep %base, off0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06528" /><CodeLine lineNumber="6528"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %gep1     = gep %base, off1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06529" /><CodeLine lineNumber="6529"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %gep2     = gep %base, off2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06530" /><CodeLine lineNumber="6530"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06531" /><CodeLine lineNumber="6531"><Highlight kind="normal"></Highlight><Highlight kind="comment">// BB2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06532" /><CodeLine lineNumber="6532"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %load1    = load %gep0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06533" /><CodeLine lineNumber="6533"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %load2    = load %gep1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06534" /><CodeLine lineNumber="6534"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %load3    = load %gep2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06535" /><CodeLine lineNumber="6535"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06536" /><CodeLine lineNumber="6536"><Highlight kind="normal"></Highlight><Highlight kind="comment">// After:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06537" /><CodeLine lineNumber="6537"><Highlight kind="normal"></Highlight><Highlight kind="comment">// BB0:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06538" /><CodeLine lineNumber="6538"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %base     =</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06539" /><CodeLine lineNumber="6539"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %new&#95;base = gep %base, off0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06540" /><CodeLine lineNumber="6540"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06541" /><CodeLine lineNumber="6541"><Highlight kind="normal"></Highlight><Highlight kind="comment">// BB1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06542" /><CodeLine lineNumber="6542"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %new&#95;gep0 = %new&#95;base</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06543" /><CodeLine lineNumber="6543"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %new&#95;gep1 = gep %new&#95;base, off1 - off0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06544" /><CodeLine lineNumber="6544"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %new&#95;gep2 = gep %new&#95;base, off2 - off0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06545" /><CodeLine lineNumber="6545"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06546" /><CodeLine lineNumber="6546"><Highlight kind="normal"></Highlight><Highlight kind="comment">// BB2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06547" /><CodeLine lineNumber="6547"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %load1    = load i32, i32&#42; %new&#95;gep0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06548" /><CodeLine lineNumber="6548"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %load2    = load i32, i32&#42; %new&#95;gep1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06549" /><CodeLine lineNumber="6549"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %load3    = load i32, i32&#42; %new&#95;gep2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06550" /><CodeLine lineNumber="6550"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06551" /><CodeLine lineNumber="6551"><Highlight kind="normal"></Highlight><Highlight kind="comment">// %new&#95;gep1 and %new&#95;gep2 can be sunk to BB2 now after the splitting because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06552" /><CodeLine lineNumber="6552"><Highlight kind="normal"></Highlight><Highlight kind="comment">// their offsets are smaller enough to fit into the addressing mode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06553" /><CodeLine lineNumber="6553"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::splitLargeGEPOffsets() &#123;</Highlight></CodeLine>
<Link id="l06554" /><CodeLine lineNumber="6554"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06555" /><CodeLine lineNumber="6555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Entry : LargeOffsetGEPMap) &#123;</Highlight></CodeLine>
<Link id="l06556" /><CodeLine lineNumber="6556"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldBase = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first;</Highlight></CodeLine>
<Link id="l06557" /><CodeLine lineNumber="6557"><Highlight kind="normal">    SmallVectorImpl&lt;std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt;&gt;</Highlight></CodeLine>
<Link id="l06558" /><CodeLine lineNumber="6558"><Highlight kind="normal">        &amp;LargeOffsetGEPs = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.second;</Highlight></CodeLine>
<Link id="l06559" /><CodeLine lineNumber="6559"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> compareGEPOffset =</Highlight></CodeLine>
<Link id="l06560" /><CodeLine lineNumber="6560"><Highlight kind="normal">        &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::pair&lt;GetElementPtrInst &#42;, int64&#95;t&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</Highlight></CodeLine>
<Link id="l06561" /><CodeLine lineNumber="6561"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::pair&lt;GetElementPtrInst &#42;, int64&#95;t&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l06562" /><CodeLine lineNumber="6562"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.first == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.first)</Highlight></CodeLine>
<Link id="l06563" /><CodeLine lineNumber="6563"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06564" /><CodeLine lineNumber="6564"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.second != <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.second)</Highlight></CodeLine>
<Link id="l06565" /><CodeLine lineNumber="6565"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.second &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.second;</Highlight></CodeLine>
<Link id="l06566" /><CodeLine lineNumber="6566"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> LargeOffsetGEPID&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.first&#93; &lt; LargeOffsetGEPID&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.first&#93;;</Highlight></CodeLine>
<Link id="l06567" /><CodeLine lineNumber="6567"><Highlight kind="normal">        &#125;;</Highlight></CodeLine>
<Link id="l06568" /><CodeLine lineNumber="6568"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Sorting all the GEPs of the same data structures based on the offsets.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06569" /><CodeLine lineNumber="6569"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(LargeOffsetGEPs, compareGEPOffset);</Highlight></CodeLine>
<Link id="l06570" /><CodeLine lineNumber="6570"><Highlight kind="normal">    LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(<a href="/docs/api/namespaces/llvm/#a48f85da577c6ce7d9aed90437dc0d07c">llvm::unique</a>(LargeOffsetGEPs), LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l06571" /><CodeLine lineNumber="6571"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip if all the GEPs have the same offsets.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06572" /><CodeLine lineNumber="6572"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>().second == LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second)</Highlight></CodeLine>
<Link id="l06573" /><CodeLine lineNumber="6573"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06574" /><CodeLine lineNumber="6574"><Highlight kind="normal">    GetElementPtrInst &#42;BaseGEP = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()-&gt;first;</Highlight></CodeLine>
<Link id="l06575" /><CodeLine lineNumber="6575"><Highlight kind="normal">    int64&#95;t BaseOffset = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()-&gt;second;</Highlight></CodeLine>
<Link id="l06576" /><CodeLine lineNumber="6576"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewBaseGEP = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06577" /><CodeLine lineNumber="6577"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06578" /><CodeLine lineNumber="6578"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> createNewBase = &#91;&amp;&#93;(int64&#95;t BaseOffset, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldBase,</Highlight></CodeLine>
<Link id="l06579" /><CodeLine lineNumber="6579"><Highlight kind="normal">                             GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) &#123;</Highlight></CodeLine>
<Link id="l06580" /><CodeLine lineNumber="6580"><Highlight kind="normal">      LLVMContext &amp;Ctx = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getContext();</Highlight></CodeLine>
<Link id="l06581" /><CodeLine lineNumber="6581"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PtrIdxTy = DL-&gt;getIndexType(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l06582" /><CodeLine lineNumber="6582"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I8PtrTy =</Highlight></CodeLine>
<Link id="l06583" /><CodeLine lineNumber="6583"><Highlight kind="normal">          PointerType::get(Ctx, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType()-&gt;getPointerAddressSpace());</Highlight></CodeLine>
<Link id="l06584" /><CodeLine lineNumber="6584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06585" /><CodeLine lineNumber="6585"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> NewBaseInsertPt;</Highlight></CodeLine>
<Link id="l06586" /><CodeLine lineNumber="6586"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewBaseInsertBB;</Highlight></CodeLine>
<Link id="l06587" /><CodeLine lineNumber="6587"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BaseI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(OldBase)) &#123;</Highlight></CodeLine>
<Link id="l06588" /><CodeLine lineNumber="6588"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the base of the struct is an instruction, the new base will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06589" /><CodeLine lineNumber="6589"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// inserted close to it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06590" /><CodeLine lineNumber="6590"><Highlight kind="normal">        NewBaseInsertBB = BaseI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l06591" /><CodeLine lineNumber="6591"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BaseI))</Highlight></CodeLine>
<Link id="l06592" /><CodeLine lineNumber="6592"><Highlight kind="normal">          NewBaseInsertPt = NewBaseInsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l06593" /><CodeLine lineNumber="6593"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InvokeInst &#42;Invoke = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(BaseI)) &#123;</Highlight></CodeLine>
<Link id="l06594" /><CodeLine lineNumber="6594"><Highlight kind="normal">          NewBaseInsertBB =</Highlight></CodeLine>
<Link id="l06595" /><CodeLine lineNumber="6595"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#adf83581f514774264d616eef5706cf6e">SplitEdge</a>(NewBaseInsertBB, Invoke-&gt;getNormalDest(), DT.get(), LI);</Highlight></CodeLine>
<Link id="l06596" /><CodeLine lineNumber="6596"><Highlight kind="normal">          NewBaseInsertPt = NewBaseInsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l06597" /><CodeLine lineNumber="6597"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06598" /><CodeLine lineNumber="6598"><Highlight kind="normal">          NewBaseInsertPt = std::next(BaseI-&gt;getIterator());</Highlight></CodeLine>
<Link id="l06599" /><CodeLine lineNumber="6599"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06600" /><CodeLine lineNumber="6600"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the current base is an argument or global value, the new base</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06601" /><CodeLine lineNumber="6601"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// will be inserted to the entry block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06602" /><CodeLine lineNumber="6602"><Highlight kind="normal">        NewBaseInsertBB = &amp;BaseGEP-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>();</Highlight></CodeLine>
<Link id="l06603" /><CodeLine lineNumber="6603"><Highlight kind="normal">        NewBaseInsertPt = NewBaseInsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l06604" /><CodeLine lineNumber="6604"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06605" /><CodeLine lineNumber="6605"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> NewBaseBuilder(NewBaseInsertBB, NewBaseInsertPt);</Highlight></CodeLine>
<Link id="l06606" /><CodeLine lineNumber="6606"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Create a new base.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06607" /><CodeLine lineNumber="6607"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseIndex = ConstantInt::get(PtrIdxTy, BaseOffset);</Highlight></CodeLine>
<Link id="l06608" /><CodeLine lineNumber="6608"><Highlight kind="normal">      NewBaseGEP = OldBase;</Highlight></CodeLine>
<Link id="l06609" /><CodeLine lineNumber="6609"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewBaseGEP-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != I8PtrTy)</Highlight></CodeLine>
<Link id="l06610" /><CodeLine lineNumber="6610"><Highlight kind="normal">        NewBaseGEP = NewBaseBuilder.CreatePointerCast(NewBaseGEP, I8PtrTy);</Highlight></CodeLine>
<Link id="l06611" /><CodeLine lineNumber="6611"><Highlight kind="normal">      NewBaseGEP =</Highlight></CodeLine>
<Link id="l06612" /><CodeLine lineNumber="6612"><Highlight kind="normal">          NewBaseBuilder.CreatePtrAdd(NewBaseGEP, BaseIndex, </Highlight><Highlight kind="stringliteral">&quot;splitgep&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06613" /><CodeLine lineNumber="6613"><Highlight kind="normal">      NewGEPBases.insert(NewBaseGEP);</Highlight></CodeLine>
<Link id="l06614" /><CodeLine lineNumber="6614"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06615" /><CodeLine lineNumber="6615"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l06616" /><CodeLine lineNumber="6616"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06617" /><CodeLine lineNumber="6617"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check whether all the offsets can be encoded with prefered common base.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06618" /><CodeLine lineNumber="6618"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (int64&#95;t PreferBase = TLI-&gt;getPreferredLargeGEPBaseOffset(</Highlight></CodeLine>
<Link id="l06619" /><CodeLine lineNumber="6619"><Highlight kind="normal">            LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>().second, LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second)) &#123;</Highlight></CodeLine>
<Link id="l06620" /><CodeLine lineNumber="6620"><Highlight kind="normal">      BaseOffset = PreferBase;</Highlight></CodeLine>
<Link id="l06621" /><CodeLine lineNumber="6621"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Create a new base if the offset of the BaseGEP can be decoded with one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06622" /><CodeLine lineNumber="6622"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06623" /><CodeLine lineNumber="6623"><Highlight kind="normal">      createNewBase(BaseOffset, OldBase, BaseGEP);</Highlight></CodeLine>
<Link id="l06624" /><CodeLine lineNumber="6624"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06625" /><CodeLine lineNumber="6625"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06626" /><CodeLine lineNumber="6626"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LargeOffsetGEP = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>();</Highlight></CodeLine>
<Link id="l06627" /><CodeLine lineNumber="6627"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (LargeOffsetGEP != LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l06628" /><CodeLine lineNumber="6628"><Highlight kind="normal">      GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = LargeOffsetGEP-&gt;first;</Highlight></CodeLine>
<Link id="l06629" /><CodeLine lineNumber="6629"><Highlight kind="normal">      int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = LargeOffsetGEP-&gt;second;</Highlight></CodeLine>
<Link id="l06630" /><CodeLine lineNumber="6630"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != BaseOffset) &#123;</Highlight></CodeLine>
<Link id="l06631" /><CodeLine lineNumber="6631"><Highlight kind="normal">        TargetLowering::AddrMode <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</Highlight></CodeLine>
<Link id="l06632" /><CodeLine lineNumber="6632"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06633" /><CodeLine lineNumber="6633"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - BaseOffset;</Highlight></CodeLine>
<Link id="l06634" /><CodeLine lineNumber="6634"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The result type of the GEP might not be the type of the memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06635" /><CodeLine lineNumber="6635"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// access.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06636" /><CodeLine lineNumber="6636"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;isLegalAddressingMode(&#42;DL, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>,</Highlight></CodeLine>
<Link id="l06637" /><CodeLine lineNumber="6637"><Highlight kind="normal">                                        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getResultElementType(),</Highlight></CodeLine>
<Link id="l06638" /><CodeLine lineNumber="6638"><Highlight kind="normal">                                        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getAddressSpace())) &#123;</Highlight></CodeLine>
<Link id="l06639" /><CodeLine lineNumber="6639"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We need to create a new base if the offset to the current base is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06640" /><CodeLine lineNumber="6640"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// too large to fit into the addressing mode. So, a very large struct</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06641" /><CodeLine lineNumber="6641"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// may be split into several parts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06642" /><CodeLine lineNumber="6642"><Highlight kind="normal">          BaseGEP = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</Highlight></CodeLine>
<Link id="l06643" /><CodeLine lineNumber="6643"><Highlight kind="normal">          BaseOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</Highlight></CodeLine>
<Link id="l06644" /><CodeLine lineNumber="6644"><Highlight kind="normal">          NewBaseGEP = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06645" /><CodeLine lineNumber="6645"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06646" /><CodeLine lineNumber="6646"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06647" /><CodeLine lineNumber="6647"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06648" /><CodeLine lineNumber="6648"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Generate a new GEP to replace the current one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06649" /><CodeLine lineNumber="6649"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PtrIdxTy = DL-&gt;getIndexType(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l06650" /><CodeLine lineNumber="6650"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06651" /><CodeLine lineNumber="6651"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewBaseGEP) &#123;</Highlight></CodeLine>
<Link id="l06652" /><CodeLine lineNumber="6652"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Create a new base if we don&#39;t have one yet.  Find the insertion</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06653" /><CodeLine lineNumber="6653"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// pointer for the new base first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06654" /><CodeLine lineNumber="6654"><Highlight kind="normal">        createNewBase(BaseOffset, OldBase, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l06655" /><CodeLine lineNumber="6655"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06656" /><CodeLine lineNumber="6656"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06657" /><CodeLine lineNumber="6657"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l06658" /><CodeLine lineNumber="6658"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewGEP = NewBaseGEP;</Highlight></CodeLine>
<Link id="l06659" /><CodeLine lineNumber="6659"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != BaseOffset) &#123;</Highlight></CodeLine>
<Link id="l06660" /><CodeLine lineNumber="6660"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Calculate the new offset for the new GEP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06661" /><CodeLine lineNumber="6661"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = ConstantInt::get(PtrIdxTy, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - BaseOffset);</Highlight></CodeLine>
<Link id="l06662" /><CodeLine lineNumber="6662"><Highlight kind="normal">        NewGEP = Builder.CreatePtrAdd(NewBaseGEP, Index);</Highlight></CodeLine>
<Link id="l06663" /><CodeLine lineNumber="6663"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06664" /><CodeLine lineNumber="6664"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, NewGEP, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l06665" /><CodeLine lineNumber="6665"><Highlight kind="normal">      LargeOffsetGEPID.erase(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l06666" /><CodeLine lineNumber="6666"><Highlight kind="normal">      LargeOffsetGEP = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(LargeOffsetGEP);</Highlight></CodeLine>
<Link id="l06667" /><CodeLine lineNumber="6667"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l06668" /><CodeLine lineNumber="6668"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06669" /><CodeLine lineNumber="6669"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06670" /><CodeLine lineNumber="6670"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06671" /><CodeLine lineNumber="6671"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l06672" /><CodeLine lineNumber="6672"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06673" /><CodeLine lineNumber="6673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06674" /><CodeLine lineNumber="6674"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizePhiType(</Highlight></CodeLine>
<Link id="l06675" /><CodeLine lineNumber="6675"><Highlight kind="normal">    PHINode &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SmallPtrSetImpl&lt;PHINode &#42;&gt; &amp;Visited,</Highlight></CodeLine>
<Link id="l06676" /><CodeLine lineNumber="6676"><Highlight kind="normal">    SmallPtrSetImpl&lt;Instruction &#42;&gt; &amp;DeletedInstrs) &#123;</Highlight></CodeLine>
<Link id="l06677" /><CodeLine lineNumber="6677"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are looking for a collection on interconnected phi nodes that together</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06678" /><CodeLine lineNumber="6678"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// only use loads/bitcasts and are used by stores/bitcasts, and the bitcasts</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06679" /><CodeLine lineNumber="6679"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// are of the same type. Convert the whole set of nodes to the type of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06680" /><CodeLine lineNumber="6680"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bitcast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06681" /><CodeLine lineNumber="6681"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PhiTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l06682" /><CodeLine lineNumber="6682"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ConvertTy = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06683" /><CodeLine lineNumber="6683"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l06684" /><CodeLine lineNumber="6684"><Highlight kind="normal">      (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isIntegerTy() &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isFloatingPointTy()))</Highlight></CodeLine>
<Link id="l06685" /><CodeLine lineNumber="6685"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06686" /><CodeLine lineNumber="6686"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06687" /><CodeLine lineNumber="6687"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 4&gt; Worklist;</Highlight></CodeLine>
<Link id="l06688" /><CodeLine lineNumber="6688"><Highlight kind="normal">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l06689" /><CodeLine lineNumber="6689"><Highlight kind="normal">  SmallPtrSet&lt;PHINode &#42;, 4&gt; PhiNodes;</Highlight></CodeLine>
<Link id="l06690" /><CodeLine lineNumber="6690"><Highlight kind="normal">  SmallPtrSet&lt;ConstantData &#42;, 4&gt; <a href="/docs/api/namespaces/llvm/dwarf/#ab4fde659cfd2ad21ef1920dca7f22255">Constants</a>;</Highlight></CodeLine>
<Link id="l06691" /><CodeLine lineNumber="6691"><Highlight kind="normal">  PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06692" /><CodeLine lineNumber="6692"><Highlight kind="normal">  Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06693" /><CodeLine lineNumber="6693"><Highlight kind="normal">  SmallPtrSet&lt;Instruction &#42;, 4&gt; Defs;</Highlight></CodeLine>
<Link id="l06694" /><CodeLine lineNumber="6694"><Highlight kind="normal">  SmallPtrSet&lt;Instruction &#42;, 4&gt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</Highlight></CodeLine>
<Link id="l06695" /><CodeLine lineNumber="6695"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This works by adding extra bitcasts between load/stores and removing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06696" /><CodeLine lineNumber="6696"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// existing bicasts. If we have a phi(bitcast(load)) or a store(bitcast(phi))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06697" /><CodeLine lineNumber="6697"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we can get in the situation where we remove a bitcast in one iteration</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06698" /><CodeLine lineNumber="6698"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// just to add it again in the next. We need to ensure that at least one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06699" /><CodeLine lineNumber="6699"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bitcast we remove are anchored to something that will not change back.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06700" /><CodeLine lineNumber="6700"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AnyAnchored = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06701" /><CodeLine lineNumber="6701"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06702" /><CodeLine lineNumber="6702"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l06703" /><CodeLine lineNumber="6703"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l06704" /><CodeLine lineNumber="6704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06705" /><CodeLine lineNumber="6705"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)) &#123;</Highlight></CodeLine>
<Link id="l06706" /><CodeLine lineNumber="6706"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Handle Defs, which might also be PHI&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06707" /><CodeLine lineNumber="6707"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;incoming&#95;values()) &#123;</Highlight></CodeLine>
<Link id="l06708" /><CodeLine lineNumber="6708"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l06709" /><CodeLine lineNumber="6709"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi)) &#123;</Highlight></CodeLine>
<Link id="l06710" /><CodeLine lineNumber="6710"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi).second)</Highlight></CodeLine>
<Link id="l06711" /><CodeLine lineNumber="6711"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06712" /><CodeLine lineNumber="6712"><Highlight kind="normal">            PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi);</Highlight></CodeLine>
<Link id="l06713" /><CodeLine lineNumber="6713"><Highlight kind="normal">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpPhi);</Highlight></CodeLine>
<Link id="l06714" /><CodeLine lineNumber="6714"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l06715" /><CodeLine lineNumber="6715"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpLoad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l06716" /><CodeLine lineNumber="6716"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OpLoad-&gt;isSimple())</Highlight></CodeLine>
<Link id="l06717" /><CodeLine lineNumber="6717"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06718" /><CodeLine lineNumber="6718"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Defs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpLoad).second)</Highlight></CodeLine>
<Link id="l06719" /><CodeLine lineNumber="6719"><Highlight kind="normal">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpLoad);</Highlight></CodeLine>
<Link id="l06720" /><CodeLine lineNumber="6720"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpEx = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractElementInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l06721" /><CodeLine lineNumber="6721"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Defs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpEx).second)</Highlight></CodeLine>
<Link id="l06722" /><CodeLine lineNumber="6722"><Highlight kind="normal">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpEx);</Highlight></CodeLine>
<Link id="l06723" /><CodeLine lineNumber="6723"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l06724" /><CodeLine lineNumber="6724"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ConvertTy)</Highlight></CodeLine>
<Link id="l06725" /><CodeLine lineNumber="6725"><Highlight kind="normal">            ConvertTy = OpBC-&gt;getOperand(0)-&gt;getType();</Highlight></CodeLine>
<Link id="l06726" /><CodeLine lineNumber="6726"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpBC-&gt;getOperand(0)-&gt;getType() != ConvertTy)</Highlight></CodeLine>
<Link id="l06727" /><CodeLine lineNumber="6727"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06728" /><CodeLine lineNumber="6728"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Defs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpBC).second) &#123;</Highlight></CodeLine>
<Link id="l06729" /><CodeLine lineNumber="6729"><Highlight kind="normal">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpBC);</Highlight></CodeLine>
<Link id="l06730" /><CodeLine lineNumber="6730"><Highlight kind="normal">            AnyAnchored |= !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(OpBC-&gt;getOperand(0)) &amp;&amp;</Highlight></CodeLine>
<Link id="l06731" /><CodeLine lineNumber="6731"><Highlight kind="normal">                           !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(OpBC-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l06732" /><CodeLine lineNumber="6732"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l06733" /><CodeLine lineNumber="6733"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantData&gt;</a>(V))</Highlight></CodeLine>
<Link id="l06734" /><CodeLine lineNumber="6734"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/dwarf/#ab4fde659cfd2ad21ef1920dca7f22255">Constants</a>.insert(OpC);</Highlight></CodeLine>
<Link id="l06735" /><CodeLine lineNumber="6735"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06736" /><CodeLine lineNumber="6736"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06737" /><CodeLine lineNumber="6737"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06738" /><CodeLine lineNumber="6738"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06739" /><CodeLine lineNumber="6739"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06740" /><CodeLine lineNumber="6740"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle uses which might also be phi&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06741" /><CodeLine lineNumber="6741"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;V : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l06742" /><CodeLine lineNumber="6742"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l06743" /><CodeLine lineNumber="6743"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi)) &#123;</Highlight></CodeLine>
<Link id="l06744" /><CodeLine lineNumber="6744"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi))</Highlight></CodeLine>
<Link id="l06745" /><CodeLine lineNumber="6745"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06746" /><CodeLine lineNumber="6746"><Highlight kind="normal">          PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi);</Highlight></CodeLine>
<Link id="l06747" /><CodeLine lineNumber="6747"><Highlight kind="normal">          Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi);</Highlight></CodeLine>
<Link id="l06748" /><CodeLine lineNumber="6748"><Highlight kind="normal">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpPhi);</Highlight></CodeLine>
<Link id="l06749" /><CodeLine lineNumber="6749"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06750" /><CodeLine lineNumber="6750"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpStore = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l06751" /><CodeLine lineNumber="6751"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OpStore-&gt;isSimple() || OpStore-&gt;getOperand(0) != <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</Highlight></CodeLine>
<Link id="l06752" /><CodeLine lineNumber="6752"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06753" /><CodeLine lineNumber="6753"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.insert(OpStore);</Highlight></CodeLine>
<Link id="l06754" /><CodeLine lineNumber="6754"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l06755" /><CodeLine lineNumber="6755"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ConvertTy)</Highlight></CodeLine>
<Link id="l06756" /><CodeLine lineNumber="6756"><Highlight kind="normal">          ConvertTy = OpBC-&gt;getType();</Highlight></CodeLine>
<Link id="l06757" /><CodeLine lineNumber="6757"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpBC-&gt;getType() != ConvertTy)</Highlight></CodeLine>
<Link id="l06758" /><CodeLine lineNumber="6758"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06759" /><CodeLine lineNumber="6759"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.insert(OpBC);</Highlight></CodeLine>
<Link id="l06760" /><CodeLine lineNumber="6760"><Highlight kind="normal">        AnyAnchored |=</Highlight></CodeLine>
<Link id="l06761" /><CodeLine lineNumber="6761"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OpBC-&gt;users(), &#91;&#93;(User &#42;U) &#123; return !isa&lt;StoreInst&gt;(U); &#125;);</Highlight></CodeLine>
<Link id="l06762" /><CodeLine lineNumber="6762"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06763" /><CodeLine lineNumber="6763"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06764" /><CodeLine lineNumber="6764"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06765" /><CodeLine lineNumber="6765"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06766" /><CodeLine lineNumber="6766"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06767" /><CodeLine lineNumber="6767"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06768" /><CodeLine lineNumber="6768"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ConvertTy || !AnyAnchored ||</Highlight></CodeLine>
<Link id="l06769" /><CodeLine lineNumber="6769"><Highlight kind="normal">      !TLI-&gt;shouldConvertPhiType(PhiTy, ConvertTy))</Highlight></CodeLine>
<Link id="l06770" /><CodeLine lineNumber="6770"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06771" /><CodeLine lineNumber="6771"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06772" /><CodeLine lineNumber="6772"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Converting &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n  and connected nodes to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06773" /><CodeLine lineNumber="6773"><Highlight kind="normal">                    &lt;&lt; &#42;ConvertTy &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06774" /><CodeLine lineNumber="6774"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06775" /><CodeLine lineNumber="6775"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create all the new phi nodes of the new type, and bitcast any loads to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06776" /><CodeLine lineNumber="6776"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// correct type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06777" /><CodeLine lineNumber="6777"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#afab3631a764c3f3a60ca9b1c0d7d5967">ValueToValueMap</a> ValMap;</Highlight></CodeLine>
<Link id="l06778" /><CodeLine lineNumber="6778"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (ConstantData &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : Constants)</Highlight></CodeLine>
<Link id="l06779" /><CodeLine lineNumber="6779"><Highlight kind="normal">    ValMap&#91;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>&#93; = <a href="/docs/api/classes/llvm/constantexpr/#ae79d05dd3d0b05e080e08f8c5c33f880">ConstantExpr::getBitCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, ConvertTy);</Highlight></CodeLine>
<Link id="l06780" /><CodeLine lineNumber="6780"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> : Defs) &#123;</Highlight></CodeLine>
<Link id="l06781" /><CodeLine lineNumber="6781"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>)) &#123;</Highlight></CodeLine>
<Link id="l06782" /><CodeLine lineNumber="6782"><Highlight kind="normal">      ValMap&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>&#93; = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l06783" /><CodeLine lineNumber="6783"><Highlight kind="normal">      DeletedInstrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>);</Highlight></CodeLine>
<Link id="l06784" /><CodeLine lineNumber="6784"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06785" /><CodeLine lineNumber="6785"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> insertPt = std::next(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l06786" /><CodeLine lineNumber="6786"><Highlight kind="normal">      ValMap&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>&#93; = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> BitCastInst(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, ConvertTy, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.bc&quot;</Highlight><Highlight kind="normal">, insertPt);</Highlight></CodeLine>
<Link id="l06787" /><CodeLine lineNumber="6787"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06788" /><CodeLine lineNumber="6788"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06789" /><CodeLine lineNumber="6789"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (PHINode &#42;Phi : PhiNodes)</Highlight></CodeLine>
<Link id="l06790" /><CodeLine lineNumber="6790"><Highlight kind="normal">    ValMap&#91;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>&#93; = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(ConvertTy, <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues(),</Highlight></CodeLine>
<Link id="l06791" /><CodeLine lineNumber="6791"><Highlight kind="normal">                                  <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.tc&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l06792" /><CodeLine lineNumber="6792"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pipe together all the PhiNodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06793" /><CodeLine lineNumber="6793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (PHINode &#42;Phi : PhiNodes) &#123;</Highlight></CodeLine>
<Link id="l06794" /><CodeLine lineNumber="6794"><Highlight kind="normal">    PHINode &#42;NewPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(ValMap&#91;Phi&#93;);</Highlight></CodeLine>
<Link id="l06795" /><CodeLine lineNumber="6795"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> i = 0, e = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues(); i &lt; e; i++)</Highlight></CodeLine>
<Link id="l06796" /><CodeLine lineNumber="6796"><Highlight kind="normal">      NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(ValMap&#91;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingValue(i)&#93;,</Highlight></CodeLine>
<Link id="l06797" /><CodeLine lineNumber="6797"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingBlock(i));</Highlight></CodeLine>
<Link id="l06798" /><CodeLine lineNumber="6798"><Highlight kind="normal">    Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(NewPhi);</Highlight></CodeLine>
<Link id="l06799" /><CodeLine lineNumber="6799"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06800" /><CodeLine lineNumber="6800"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// And finally pipe up the stores and bitcasts</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06801" /><CodeLine lineNumber="6801"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;U : <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>) &#123;</Highlight></CodeLine>
<Link id="l06802" /><CodeLine lineNumber="6802"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l06803" /><CodeLine lineNumber="6803"><Highlight kind="normal">      DeletedInstrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(U);</Highlight></CodeLine>
<Link id="l06804" /><CodeLine lineNumber="6804"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(U, ValMap&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getOperand(0)&#93;, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l06805" /><CodeLine lineNumber="6805"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06806" /><CodeLine lineNumber="6806"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;setOperand(0, </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> BitCastInst(ValMap&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getOperand(0)&#93;, PhiTy, </Highlight><Highlight kind="stringliteral">&quot;bc&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06807" /><CodeLine lineNumber="6807"><Highlight kind="normal">                                       <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getIterator()));</Highlight></CodeLine>
<Link id="l06808" /><CodeLine lineNumber="6808"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06809" /><CodeLine lineNumber="6809"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06810" /><CodeLine lineNumber="6810"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06811" /><CodeLine lineNumber="6811"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Save the removed phis to be deleted later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06812" /><CodeLine lineNumber="6812"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (PHINode &#42;Phi : PhiNodes)</Highlight></CodeLine>
<Link id="l06813" /><CodeLine lineNumber="6813"><Highlight kind="normal">    DeletedInstrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Phi);</Highlight></CodeLine>
<Link id="l06814" /><CodeLine lineNumber="6814"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06815" /><CodeLine lineNumber="6815"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06816" /><CodeLine lineNumber="6816"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06817" /><CodeLine lineNumber="6817"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizePhiTypes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l06818" /><CodeLine lineNumber="6818"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a1d7858eecb954b54795df357b6935414">OptimizePhiTypes</a>)</Highlight></CodeLine>
<Link id="l06819" /><CodeLine lineNumber="6819"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06820" /><CodeLine lineNumber="6820"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06821" /><CodeLine lineNumber="6821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06822" /><CodeLine lineNumber="6822"><Highlight kind="normal">  SmallPtrSet&lt;PHINode &#42;, 4&gt; Visited;</Highlight></CodeLine>
<Link id="l06823" /><CodeLine lineNumber="6823"><Highlight kind="normal">  SmallPtrSet&lt;Instruction &#42;, 4&gt; DeletedInstrs;</Highlight></CodeLine>
<Link id="l06824" /><CodeLine lineNumber="6824"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06825" /><CodeLine lineNumber="6825"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Attempt to optimize all the phis in the functions to the correct type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06826" /><CodeLine lineNumber="6826"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l06827" /><CodeLine lineNumber="6827"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Phi : BB.<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</Highlight></CodeLine>
<Link id="l06828" /><CodeLine lineNumber="6828"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= optimizePhiType(&amp;Phi, Visited, DeletedInstrs);</Highlight></CodeLine>
<Link id="l06829" /><CodeLine lineNumber="6829"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06830" /><CodeLine lineNumber="6830"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove any old phi&#39;s that have been converted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06831" /><CodeLine lineNumber="6831"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DeletedInstrs) &#123;</Highlight></CodeLine>
<Link id="l06832" /><CodeLine lineNumber="6832"><Highlight kind="normal">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()), <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l06833" /><CodeLine lineNumber="6833"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l06834" /><CodeLine lineNumber="6834"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06835" /><CodeLine lineNumber="6835"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06836" /><CodeLine lineNumber="6836"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l06837" /><CodeLine lineNumber="6837"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06838" /><CodeLine lineNumber="6838"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06839" /><CodeLine lineNumber="6839"><Highlight kind="comment">/// Return true, if an ext(load) can be formed from an extension in</Highlight></CodeLine>
<Link id="l06840" /><CodeLine lineNumber="6840"><Highlight kind="comment">/// \\p MovedExts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06841" /><CodeLine lineNumber="6841"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::canFormExtLd(</Highlight></CodeLine>
<Link id="l06842" /><CodeLine lineNumber="6842"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;MovedExts, LoadInst &#42;&amp;LI,</Highlight></CodeLine>
<Link id="l06843" /><CodeLine lineNumber="6843"><Highlight kind="normal">    Instruction &#42;&amp;Inst, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasPromoted) &#123;</Highlight></CodeLine>
<Link id="l06844" /><CodeLine lineNumber="6844"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MovedExtInst : MovedExts) &#123;</Highlight></CodeLine>
<Link id="l06845" /><CodeLine lineNumber="6845"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(MovedExtInst-&gt;getOperand(0))) &#123;</Highlight></CodeLine>
<Link id="l06846" /><CodeLine lineNumber="6846"><Highlight kind="normal">      LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(MovedExtInst-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l06847" /><CodeLine lineNumber="6847"><Highlight kind="normal">      Inst = MovedExtInst;</Highlight></CodeLine>
<Link id="l06848" /><CodeLine lineNumber="6848"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06849" /><CodeLine lineNumber="6849"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06850" /><CodeLine lineNumber="6850"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06851" /><CodeLine lineNumber="6851"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LI)</Highlight></CodeLine>
<Link id="l06852" /><CodeLine lineNumber="6852"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06853" /><CodeLine lineNumber="6853"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06854" /><CodeLine lineNumber="6854"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If they&#39;re already in the same block, there&#39;s nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06855" /><CodeLine lineNumber="6855"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make the cheap checks first if we did not promote.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06856" /><CodeLine lineNumber="6856"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we promoted, we need to check if it is indeed profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06857" /><CodeLine lineNumber="6857"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HasPromoted &amp;&amp; LI-&gt;getParent() == Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l06858" /><CodeLine lineNumber="6858"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06859" /><CodeLine lineNumber="6859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06860" /><CodeLine lineNumber="6860"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TLI-&gt;isExtLoad(LI, Inst, &#42;DL);</Highlight></CodeLine>
<Link id="l06861" /><CodeLine lineNumber="6861"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06862" /><CodeLine lineNumber="6862"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06863" /><CodeLine lineNumber="6863"><Highlight kind="comment">/// Move a zext or sext fed by a load into the same basic block as the load,</Highlight></CodeLine>
<Link id="l06864" /><CodeLine lineNumber="6864"><Highlight kind="comment">/// unless conditions are unfavorable. This allows SelectionDAG to fold the</Highlight></CodeLine>
<Link id="l06865" /><CodeLine lineNumber="6865"><Highlight kind="comment">/// extend into the load.</Highlight></CodeLine>
<Link id="l06866" /><CodeLine lineNumber="6866"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l06867" /><CodeLine lineNumber="6867"><Highlight kind="comment">/// E.g.,</Highlight></CodeLine>
<Link id="l06868" /><CodeLine lineNumber="6868"><Highlight kind="comment">/// \\code</Highlight></CodeLine>
<Link id="l06869" /><CodeLine lineNumber="6869"><Highlight kind="comment">/// %ld = load i32&#42; %addr</Highlight></CodeLine>
<Link id="l06870" /><CodeLine lineNumber="6870"><Highlight kind="comment">/// %add = add nuw i32 %ld, 4</Highlight></CodeLine>
<Link id="l06871" /><CodeLine lineNumber="6871"><Highlight kind="comment">/// %zext = zext i32 %add to i64</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06872" /><CodeLine lineNumber="6872"><Highlight kind="normal"></Highlight><Highlight kind="comment">// \\endcode</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06873" /><CodeLine lineNumber="6873"><Highlight kind="comment">/// =&gt;</Highlight></CodeLine>
<Link id="l06874" /><CodeLine lineNumber="6874"><Highlight kind="comment">/// \\code</Highlight></CodeLine>
<Link id="l06875" /><CodeLine lineNumber="6875"><Highlight kind="comment">/// %ld = load i32&#42; %addr</Highlight></CodeLine>
<Link id="l06876" /><CodeLine lineNumber="6876"><Highlight kind="comment">/// %zext = zext i32 %ld to i64</Highlight></CodeLine>
<Link id="l06877" /><CodeLine lineNumber="6877"><Highlight kind="comment">/// %add = add nuw i64 %zext, 4</Highlight></CodeLine>
<Link id="l06878" /><CodeLine lineNumber="6878"><Highlight kind="comment">/// \\encode</Highlight></CodeLine>
<Link id="l06879" /><CodeLine lineNumber="6879"><Highlight kind="comment">/// Note that the promotion in %add to i64 is done in tryToPromoteExts(), which</Highlight></CodeLine>
<Link id="l06880" /><CodeLine lineNumber="6880"><Highlight kind="comment">/// allow us to match zext(load i32&#42;) to i64.</Highlight></CodeLine>
<Link id="l06881" /><CodeLine lineNumber="6881"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l06882" /><CodeLine lineNumber="6882"><Highlight kind="comment">/// Also, try to promote the computations used to obtain a sign extended</Highlight></CodeLine>
<Link id="l06883" /><CodeLine lineNumber="6883"><Highlight kind="comment">/// value used into memory accesses.</Highlight></CodeLine>
<Link id="l06884" /><CodeLine lineNumber="6884"><Highlight kind="comment">/// E.g.,</Highlight></CodeLine>
<Link id="l06885" /><CodeLine lineNumber="6885"><Highlight kind="comment">/// \\code</Highlight></CodeLine>
<Link id="l06886" /><CodeLine lineNumber="6886"><Highlight kind="comment">/// a = add nsw i32 b, 3</Highlight></CodeLine>
<Link id="l06887" /><CodeLine lineNumber="6887"><Highlight kind="comment">/// d = sext i32 a to i64</Highlight></CodeLine>
<Link id="l06888" /><CodeLine lineNumber="6888"><Highlight kind="comment">/// e = getelementptr ..., i64 d</Highlight></CodeLine>
<Link id="l06889" /><CodeLine lineNumber="6889"><Highlight kind="comment">/// \\endcode</Highlight></CodeLine>
<Link id="l06890" /><CodeLine lineNumber="6890"><Highlight kind="comment">/// =&gt;</Highlight></CodeLine>
<Link id="l06891" /><CodeLine lineNumber="6891"><Highlight kind="comment">/// \\code</Highlight></CodeLine>
<Link id="l06892" /><CodeLine lineNumber="6892"><Highlight kind="comment">/// f = sext i32 b to i64</Highlight></CodeLine>
<Link id="l06893" /><CodeLine lineNumber="6893"><Highlight kind="comment">/// a = add nsw i64 f, 3</Highlight></CodeLine>
<Link id="l06894" /><CodeLine lineNumber="6894"><Highlight kind="comment">/// e = getelementptr ..., i64 a</Highlight></CodeLine>
<Link id="l06895" /><CodeLine lineNumber="6895"><Highlight kind="comment">/// \\endcode</Highlight></CodeLine>
<Link id="l06896" /><CodeLine lineNumber="6896"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l06897" /><CodeLine lineNumber="6897"><Highlight kind="comment">/// \\p Inst&#91;in/out&#93; the extension may be modified during the process if some</Highlight></CodeLine>
<Link id="l06898" /><CodeLine lineNumber="6898"><Highlight kind="comment">/// promotions apply.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06899" /><CodeLine lineNumber="6899"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeExt(Instruction &#42;&amp;Inst) &#123;</Highlight></CodeLine>
<Link id="l06900" /><CodeLine lineNumber="6900"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowPromotionWithoutCommonHeader = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l06901" /><CodeLine lineNumber="6901"><Highlight kind="comment">  /// See if it is an interesting sext operations for the address type</Highlight></CodeLine>
<Link id="l06902" /><CodeLine lineNumber="6902"><Highlight kind="comment">  /// promotion before trying to promote it, e.g., the ones with the right</Highlight></CodeLine>
<Link id="l06903" /><CodeLine lineNumber="6903"><Highlight kind="comment">  /// type and used in memory accesses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06904" /><CodeLine lineNumber="6904"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ATPConsiderable = TTI-&gt;shouldConsiderAddressTypePromotion(</Highlight></CodeLine>
<Link id="l06905" /><CodeLine lineNumber="6905"><Highlight kind="normal">      &#42;Inst, AllowPromotionWithoutCommonHeader);</Highlight></CodeLine>
<Link id="l06906" /><CodeLine lineNumber="6906"><Highlight kind="normal">  TypePromotionTransaction TPT(RemovedInsts);</Highlight></CodeLine>
<Link id="l06907" /><CodeLine lineNumber="6907"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</Highlight></CodeLine>
<Link id="l06908" /><CodeLine lineNumber="6908"><Highlight kind="normal">      TPT.getRestorationPoint();</Highlight></CodeLine>
<Link id="l06909" /><CodeLine lineNumber="6909"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 1&gt; Exts;</Highlight></CodeLine>
<Link id="l06910" /><CodeLine lineNumber="6910"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 2&gt; SpeculativelyMovedExts;</Highlight></CodeLine>
<Link id="l06911" /><CodeLine lineNumber="6911"><Highlight kind="normal">  Exts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Inst);</Highlight></CodeLine>
<Link id="l06912" /><CodeLine lineNumber="6912"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06913" /><CodeLine lineNumber="6913"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasPromoted = tryToPromoteExts(TPT, Exts, SpeculativelyMovedExts);</Highlight></CodeLine>
<Link id="l06914" /><CodeLine lineNumber="6914"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06915" /><CodeLine lineNumber="6915"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look for a load being extended.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06916" /><CodeLine lineNumber="6916"><Highlight kind="normal">  LoadInst &#42;LI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06917" /><CodeLine lineNumber="6917"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtFedByLoad;</Highlight></CodeLine>
<Link id="l06918" /><CodeLine lineNumber="6918"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06919" /><CodeLine lineNumber="6919"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to promote a chain of computation if it allows to form an extended</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06920" /><CodeLine lineNumber="6920"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// load.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06921" /><CodeLine lineNumber="6921"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (canFormExtLd(SpeculativelyMovedExts, LI, ExtFedByLoad, HasPromoted)) &#123;</Highlight></CodeLine>
<Link id="l06922" /><CodeLine lineNumber="6922"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI &amp;&amp; ExtFedByLoad &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expect a valid load and extension&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06923" /><CodeLine lineNumber="6923"><Highlight kind="normal">    TPT.commit();</Highlight></CodeLine>
<Link id="l06924" /><CodeLine lineNumber="6924"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Move the extend into the same block as the load.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06925" /><CodeLine lineNumber="6925"><Highlight kind="normal">    ExtFedByLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#a54507f01d7d06127068ee0663233511d">moveAfter</a>(LI);</Highlight></CodeLine>
<Link id="l06926" /><CodeLine lineNumber="6926"><Highlight kind="normal">    ++NumExtsMoved;</Highlight></CodeLine>
<Link id="l06927" /><CodeLine lineNumber="6927"><Highlight kind="normal">    Inst = ExtFedByLoad;</Highlight></CodeLine>
<Link id="l06928" /><CodeLine lineNumber="6928"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06929" /><CodeLine lineNumber="6929"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06930" /><CodeLine lineNumber="6930"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06931" /><CodeLine lineNumber="6931"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Continue promoting SExts if known as considerable depending on targets.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06932" /><CodeLine lineNumber="6932"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ATPConsiderable &amp;&amp;</Highlight></CodeLine>
<Link id="l06933" /><CodeLine lineNumber="6933"><Highlight kind="normal">      performAddressTypePromotion(Inst, AllowPromotionWithoutCommonHeader,</Highlight></CodeLine>
<Link id="l06934" /><CodeLine lineNumber="6934"><Highlight kind="normal">                                  HasPromoted, TPT, SpeculativelyMovedExts))</Highlight></CodeLine>
<Link id="l06935" /><CodeLine lineNumber="6935"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06936" /><CodeLine lineNumber="6936"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06937" /><CodeLine lineNumber="6937"><Highlight kind="normal">  TPT.rollback(LastKnownGood);</Highlight></CodeLine>
<Link id="l06938" /><CodeLine lineNumber="6938"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06939" /><CodeLine lineNumber="6939"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06940" /><CodeLine lineNumber="6940"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06941" /><CodeLine lineNumber="6941"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Perform address type promotion if doing so is profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06942" /><CodeLine lineNumber="6942"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If AllowPromotionWithoutCommonHeader == false, we should find other sext</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06943" /><CodeLine lineNumber="6943"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instructions that sign extended the same initial value. However, if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06944" /><CodeLine lineNumber="6944"><Highlight kind="normal"></Highlight><Highlight kind="comment">// AllowPromotionWithoutCommonHeader == true, we expect promoting the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06945" /><CodeLine lineNumber="6945"><Highlight kind="normal"></Highlight><Highlight kind="comment">// extension is just profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06946" /><CodeLine lineNumber="6946"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::performAddressTypePromotion(</Highlight></CodeLine>
<Link id="l06947" /><CodeLine lineNumber="6947"><Highlight kind="normal">    Instruction &#42;&amp;Inst, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowPromotionWithoutCommonHeader,</Highlight></CodeLine>
<Link id="l06948" /><CodeLine lineNumber="6948"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasPromoted, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</Highlight></CodeLine>
<Link id="l06949" /><CodeLine lineNumber="6949"><Highlight kind="normal">    SmallVectorImpl&lt;Instruction &#42;&gt; &amp;SpeculativelyMovedExts) &#123;</Highlight></CodeLine>
<Link id="l06950" /><CodeLine lineNumber="6950"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Promoted = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06951" /><CodeLine lineNumber="6951"><Highlight kind="normal">  SmallPtrSet&lt;Instruction &#42;, 1&gt; UnhandledExts;</Highlight></CodeLine>
<Link id="l06952" /><CodeLine lineNumber="6952"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllSeenFirst = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06953" /><CodeLine lineNumber="6953"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) &#123;</Highlight></CodeLine>
<Link id="l06954" /><CodeLine lineNumber="6954"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l06955" /><CodeLine lineNumber="6955"><Highlight kind="normal">    DenseMap&lt;Value &#42;, Instruction &#42;&gt;::iterator AlreadySeen =</Highlight></CodeLine>
<Link id="l06956" /><CodeLine lineNumber="6956"><Highlight kind="normal">        SeenChainsForSExt.find(HeadOfChain);</Highlight></CodeLine>
<Link id="l06957" /><CodeLine lineNumber="6957"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there is an unhandled SExt which has the same header, try to promote</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06958" /><CodeLine lineNumber="6958"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// it as well.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06959" /><CodeLine lineNumber="6959"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AlreadySeen != SeenChainsForSExt.end()) &#123;</Highlight></CodeLine>
<Link id="l06960" /><CodeLine lineNumber="6960"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AlreadySeen-&gt;second != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l06961" /><CodeLine lineNumber="6961"><Highlight kind="normal">        UnhandledExts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(AlreadySeen-&gt;second);</Highlight></CodeLine>
<Link id="l06962" /><CodeLine lineNumber="6962"><Highlight kind="normal">      AllSeenFirst = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06963" /><CodeLine lineNumber="6963"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06964" /><CodeLine lineNumber="6964"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06965" /><CodeLine lineNumber="6965"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06966" /><CodeLine lineNumber="6966"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllSeenFirst || (AllowPromotionWithoutCommonHeader &amp;&amp;</Highlight></CodeLine>
<Link id="l06967" /><CodeLine lineNumber="6967"><Highlight kind="normal">                        SpeculativelyMovedExts.size() == 1)) &#123;</Highlight></CodeLine>
<Link id="l06968" /><CodeLine lineNumber="6968"><Highlight kind="normal">    TPT.commit();</Highlight></CodeLine>
<Link id="l06969" /><CodeLine lineNumber="6969"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasPromoted)</Highlight></CodeLine>
<Link id="l06970" /><CodeLine lineNumber="6970"><Highlight kind="normal">      Promoted = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06971" /><CodeLine lineNumber="6971"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) &#123;</Highlight></CodeLine>
<Link id="l06972" /><CodeLine lineNumber="6972"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l06973" /><CodeLine lineNumber="6973"><Highlight kind="normal">      SeenChainsForSExt&#91;HeadOfChain&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06974" /><CodeLine lineNumber="6974"><Highlight kind="normal">      ValToSExtendedUses&#91;HeadOfChain&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06975" /><CodeLine lineNumber="6975"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06976" /><CodeLine lineNumber="6976"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update Inst as promotion happen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06977" /><CodeLine lineNumber="6977"><Highlight kind="normal">    Inst = SpeculativelyMovedExts.pop&#95;back&#95;val();</Highlight></CodeLine>
<Link id="l06978" /><CodeLine lineNumber="6978"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06979" /><CodeLine lineNumber="6979"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This is the first chain visited from the header, keep the current chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06980" /><CodeLine lineNumber="6980"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as unhandled. Defer to promote this until we encounter another SExt</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06981" /><CodeLine lineNumber="6981"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// chain derived from the same header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06982" /><CodeLine lineNumber="6982"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) &#123;</Highlight></CodeLine>
<Link id="l06983" /><CodeLine lineNumber="6983"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l06984" /><CodeLine lineNumber="6984"><Highlight kind="normal">      SeenChainsForSExt&#91;HeadOfChain&#93; = Inst;</Highlight></CodeLine>
<Link id="l06985" /><CodeLine lineNumber="6985"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06986" /><CodeLine lineNumber="6986"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06987" /><CodeLine lineNumber="6987"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06988" /><CodeLine lineNumber="6988"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06989" /><CodeLine lineNumber="6989"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllSeenFirst &amp;&amp; !UnhandledExts.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>())</Highlight></CodeLine>
<Link id="l06990" /><CodeLine lineNumber="6990"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VisitedSExt : UnhandledExts) &#123;</Highlight></CodeLine>
<Link id="l06991" /><CodeLine lineNumber="6991"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RemovedInsts.count(VisitedSExt))</Highlight></CodeLine>
<Link id="l06992" /><CodeLine lineNumber="6992"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06993" /><CodeLine lineNumber="6993"><Highlight kind="normal">      TypePromotionTransaction TPT(RemovedInsts);</Highlight></CodeLine>
<Link id="l06994" /><CodeLine lineNumber="6994"><Highlight kind="normal">      SmallVector&lt;Instruction &#42;, 1&gt; Exts;</Highlight></CodeLine>
<Link id="l06995" /><CodeLine lineNumber="6995"><Highlight kind="normal">      SmallVector&lt;Instruction &#42;, 2&gt; Chains;</Highlight></CodeLine>
<Link id="l06996" /><CodeLine lineNumber="6996"><Highlight kind="normal">      Exts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VisitedSExt);</Highlight></CodeLine>
<Link id="l06997" /><CodeLine lineNumber="6997"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasPromoted = tryToPromoteExts(TPT, Exts, Chains);</Highlight></CodeLine>
<Link id="l06998" /><CodeLine lineNumber="6998"><Highlight kind="normal">      TPT.commit();</Highlight></CodeLine>
<Link id="l06999" /><CodeLine lineNumber="6999"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasPromoted)</Highlight></CodeLine>
<Link id="l07000" /><CodeLine lineNumber="7000"><Highlight kind="normal">        Promoted = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07001" /><CodeLine lineNumber="7001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Chains) &#123;</Highlight></CodeLine>
<Link id="l07002" /><CodeLine lineNumber="7002"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l07003" /><CodeLine lineNumber="7003"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Mark this as handled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07004" /><CodeLine lineNumber="7004"><Highlight kind="normal">        SeenChainsForSExt&#91;HeadOfChain&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07005" /><CodeLine lineNumber="7005"><Highlight kind="normal">        ValToSExtendedUses&#91;HeadOfChain&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07006" /><CodeLine lineNumber="7006"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07007" /><CodeLine lineNumber="7007"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07008" /><CodeLine lineNumber="7008"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Promoted;</Highlight></CodeLine>
<Link id="l07009" /><CodeLine lineNumber="7009"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07010" /><CodeLine lineNumber="7010"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07011" /><CodeLine lineNumber="7011"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeExtUses(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l07012" /><CodeLine lineNumber="7012"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DefBB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l07013" /><CodeLine lineNumber="7013"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07014" /><CodeLine lineNumber="7014"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the result of a &#123;s|z&#125;ext and its source are both live out, rewrite all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07015" /><CodeLine lineNumber="7015"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// other uses of the source with result of extension.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07016" /><CodeLine lineNumber="7016"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l07017" /><CodeLine lineNumber="7017"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l07018" /><CodeLine lineNumber="7018"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07019" /><CodeLine lineNumber="7019"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07020" /><CodeLine lineNumber="7020"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only do this xform if truncating is free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07021" /><CodeLine lineNumber="7021"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;isTruncateFree(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;getType()))</Highlight></CodeLine>
<Link id="l07022" /><CodeLine lineNumber="7022"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07023" /><CodeLine lineNumber="7023"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07024" /><CodeLine lineNumber="7024"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only safe to perform the optimization if the source is also defined in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07025" /><CodeLine lineNumber="7025"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07026" /><CodeLine lineNumber="7026"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Src) || DefBB != <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Src)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>())</Highlight></CodeLine>
<Link id="l07027" /><CodeLine lineNumber="7027"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07028" /><CodeLine lineNumber="7028"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07029" /><CodeLine lineNumber="7029"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> DefIsLiveOut = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07030" /><CodeLine lineNumber="7030"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l07031" /><CodeLine lineNumber="7031"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l07032" /><CodeLine lineNumber="7032"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07033" /><CodeLine lineNumber="7033"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Figure out which BB this ext is used in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07034" /><CodeLine lineNumber="7034"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;UserBB = UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l07035" /><CodeLine lineNumber="7035"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB == DefBB)</Highlight></CodeLine>
<Link id="l07036" /><CodeLine lineNumber="7036"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07037" /><CodeLine lineNumber="7037"><Highlight kind="normal">    DefIsLiveOut = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07038" /><CodeLine lineNumber="7038"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07039" /><CodeLine lineNumber="7039"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07040" /><CodeLine lineNumber="7040"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DefIsLiveOut)</Highlight></CodeLine>
<Link id="l07041" /><CodeLine lineNumber="7041"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07042" /><CodeLine lineNumber="7042"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07043" /><CodeLine lineNumber="7043"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure none of the uses are PHI nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07044" /><CodeLine lineNumber="7044"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;U : <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l07045" /><CodeLine lineNumber="7045"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l07046" /><CodeLine lineNumber="7046"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;UserBB = UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l07047" /><CodeLine lineNumber="7047"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB == DefBB)</Highlight></CodeLine>
<Link id="l07048" /><CodeLine lineNumber="7048"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07049" /><CodeLine lineNumber="7049"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Be conservative. We don&#39;t want this xform to end up introducing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07050" /><CodeLine lineNumber="7050"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reloads just before load / store instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07051" /><CodeLine lineNumber="7051"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(UI) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(UI))</Highlight></CodeLine>
<Link id="l07052" /><CodeLine lineNumber="7052"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07053" /><CodeLine lineNumber="7053"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07054" /><CodeLine lineNumber="7054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07055" /><CodeLine lineNumber="7055"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// InsertedTruncs - Only insert one trunc in each block once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07056" /><CodeLine lineNumber="7056"><Highlight kind="normal">  DenseMap&lt;BasicBlock &#42;, Instruction &#42;&gt; InsertedTruncs;</Highlight></CodeLine>
<Link id="l07057" /><CodeLine lineNumber="7057"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07058" /><CodeLine lineNumber="7058"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07059" /><CodeLine lineNumber="7059"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Use &amp;U : <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;uses()) &#123;</Highlight></CodeLine>
<Link id="l07060" /><CodeLine lineNumber="7060"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser());</Highlight></CodeLine>
<Link id="l07061" /><CodeLine lineNumber="7061"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07062" /><CodeLine lineNumber="7062"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Figure out which BB this ext is used in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07063" /><CodeLine lineNumber="7063"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;UserBB = <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">User</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l07064" /><CodeLine lineNumber="7064"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserBB == DefBB)</Highlight></CodeLine>
<Link id="l07065" /><CodeLine lineNumber="7065"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07066" /><CodeLine lineNumber="7066"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07067" /><CodeLine lineNumber="7067"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Both src and def are live in this block. Rewrite the use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07068" /><CodeLine lineNumber="7068"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;&amp;InsertedTrunc = InsertedTruncs&#91;UserBB&#93;;</Highlight></CodeLine>
<Link id="l07069" /><CodeLine lineNumber="7069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07070" /><CodeLine lineNumber="7070"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsertedTrunc) &#123;</Highlight></CodeLine>
<Link id="l07071" /><CodeLine lineNumber="7071"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l07072" /><CodeLine lineNumber="7072"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l07073" /><CodeLine lineNumber="7073"><Highlight kind="normal">      InsertedTrunc = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> TruncInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;getType(), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07074" /><CodeLine lineNumber="7074"><Highlight kind="normal">      InsertedTrunc-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</Highlight></CodeLine>
<Link id="l07075" /><CodeLine lineNumber="7075"><Highlight kind="normal">      InsertedInsts.insert(InsertedTrunc);</Highlight></CodeLine>
<Link id="l07076" /><CodeLine lineNumber="7076"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07077" /><CodeLine lineNumber="7077"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07078" /><CodeLine lineNumber="7078"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace a use of the &#123;s|z&#125;ext source with a use of the result.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07079" /><CodeLine lineNumber="7079"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a> = InsertedTrunc;</Highlight></CodeLine>
<Link id="l07080" /><CodeLine lineNumber="7080"><Highlight kind="normal">    ++NumExtUses;</Highlight></CodeLine>
<Link id="l07081" /><CodeLine lineNumber="7081"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07082" /><CodeLine lineNumber="7082"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07083" /><CodeLine lineNumber="7083"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07084" /><CodeLine lineNumber="7084"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l07085" /><CodeLine lineNumber="7085"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07086" /><CodeLine lineNumber="7086"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07087" /><CodeLine lineNumber="7087"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Find loads whose uses only use some of the loaded value&#39;s bits.  Add an &quot;and&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07088" /><CodeLine lineNumber="7088"><Highlight kind="normal"></Highlight><Highlight kind="comment">// just after the load if the target can fold this into one extload instruction,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07089" /><CodeLine lineNumber="7089"><Highlight kind="normal"></Highlight><Highlight kind="comment">// with the hope of eliminating some of the other later &quot;and&quot; instructions using</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07090" /><CodeLine lineNumber="7090"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the loaded value.  &quot;and&quot;s that are made trivially redundant by the insertion</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07091" /><CodeLine lineNumber="7091"><Highlight kind="normal"></Highlight><Highlight kind="comment">// of the new &quot;and&quot; are removed by this function, while others (e.g. those whose</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07092" /><CodeLine lineNumber="7092"><Highlight kind="normal"></Highlight><Highlight kind="comment">// path from the load goes through a phi) are left for isel to potentially</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07093" /><CodeLine lineNumber="7093"><Highlight kind="normal"></Highlight><Highlight kind="comment">// remove.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07094" /><CodeLine lineNumber="7094"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07095" /><CodeLine lineNumber="7095"><Highlight kind="normal"></Highlight><Highlight kind="comment">// For example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07096" /><CodeLine lineNumber="7096"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07097" /><CodeLine lineNumber="7097"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b0:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07098" /><CodeLine lineNumber="7098"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x = load i32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07099" /><CodeLine lineNumber="7099"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07100" /><CodeLine lineNumber="7100"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07101" /><CodeLine lineNumber="7101"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   y = and x, 255</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07102" /><CodeLine lineNumber="7102"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   z = use y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07103" /><CodeLine lineNumber="7103"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07104" /><CodeLine lineNumber="7104"><Highlight kind="normal"></Highlight><Highlight kind="comment">// becomes:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07105" /><CodeLine lineNumber="7105"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07106" /><CodeLine lineNumber="7106"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b0:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07107" /><CodeLine lineNumber="7107"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x = load i32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07108" /><CodeLine lineNumber="7108"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x&#39; = and x, 255</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07109" /><CodeLine lineNumber="7109"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07110" /><CodeLine lineNumber="7110"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07111" /><CodeLine lineNumber="7111"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   z = use x&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07112" /><CodeLine lineNumber="7112"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07113" /><CodeLine lineNumber="7113"><Highlight kind="normal"></Highlight><Highlight kind="comment">// whereas:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07114" /><CodeLine lineNumber="7114"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07115" /><CodeLine lineNumber="7115"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b0:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07116" /><CodeLine lineNumber="7116"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x1 = load i32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07117" /><CodeLine lineNumber="7117"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07118" /><CodeLine lineNumber="7118"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07119" /><CodeLine lineNumber="7119"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x2 = load i32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07120" /><CodeLine lineNumber="7120"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07121" /><CodeLine lineNumber="7121"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07122" /><CodeLine lineNumber="7122"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x = phi x1, x2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07123" /><CodeLine lineNumber="7123"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   y = and x, 255</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07124" /><CodeLine lineNumber="7124"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07125" /><CodeLine lineNumber="7125"><Highlight kind="normal"></Highlight><Highlight kind="comment">// becomes (after a call to optimizeLoadExt for each load):</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07126" /><CodeLine lineNumber="7126"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07127" /><CodeLine lineNumber="7127"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b0:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07128" /><CodeLine lineNumber="7128"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x1 = load i32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07129" /><CodeLine lineNumber="7129"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x1&#39; = and x1, 255</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07130" /><CodeLine lineNumber="7130"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07131" /><CodeLine lineNumber="7131"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07132" /><CodeLine lineNumber="7132"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x2 = load i32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07133" /><CodeLine lineNumber="7133"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x2&#39; = and x2, 255</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07134" /><CodeLine lineNumber="7134"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07135" /><CodeLine lineNumber="7135"><Highlight kind="normal"></Highlight><Highlight kind="comment">// b2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07136" /><CodeLine lineNumber="7136"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   x = phi x1&#39;, x2&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07137" /><CodeLine lineNumber="7137"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   y = and x, 255</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07138" /><CodeLine lineNumber="7138"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeLoadExt(LoadInst &#42;Load) &#123;</Highlight></CodeLine>
<Link id="l07139" /><CodeLine lineNumber="7139"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;isSimple() || !<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType()-&gt;isIntOrPtrTy())</Highlight></CodeLine>
<Link id="l07140" /><CodeLine lineNumber="7140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07141" /><CodeLine lineNumber="7141"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07142" /><CodeLine lineNumber="7142"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Skip loads we&#39;ve already transformed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07143" /><CodeLine lineNumber="7143"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;hasOneUse() &amp;&amp;</Highlight></CodeLine>
<Link id="l07144" /><CodeLine lineNumber="7144"><Highlight kind="normal">      InsertedInsts.count(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;user&#95;begin())))</Highlight></CodeLine>
<Link id="l07145" /><CodeLine lineNumber="7145"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07146" /><CodeLine lineNumber="7146"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07147" /><CodeLine lineNumber="7147"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look at all uses of Load, looking through phis, to determine how many bits</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07148" /><CodeLine lineNumber="7148"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the loaded value are needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07149" /><CodeLine lineNumber="7149"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 8&gt; WorkList;</Highlight></CodeLine>
<Link id="l07150" /><CodeLine lineNumber="7150"><Highlight kind="normal">  SmallPtrSet&lt;Instruction &#42;, 16&gt; Visited;</Highlight></CodeLine>
<Link id="l07151" /><CodeLine lineNumber="7151"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 8&gt; AndsToMaybeRemove;</Highlight></CodeLine>
<Link id="l07152" /><CodeLine lineNumber="7152"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 8&gt; DropFlags;</Highlight></CodeLine>
<Link id="l07153" /><CodeLine lineNumber="7153"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;users())</Highlight></CodeLine>
<Link id="l07154" /><CodeLine lineNumber="7154"><Highlight kind="normal">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</Highlight></CodeLine>
<Link id="l07155" /><CodeLine lineNumber="7155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07156" /><CodeLine lineNumber="7156"><Highlight kind="normal">  EVT LoadResultVT = TLI-&gt;getValueType(&#42;DL, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l07157" /><CodeLine lineNumber="7157"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = LoadResultVT.<a href="/docs/api/structs/llvm/evt/#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>();</Highlight></CodeLine>
<Link id="l07158" /><CodeLine lineNumber="7158"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the BitWidth is 0, do not try to optimize the type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07159" /><CodeLine lineNumber="7159"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> == 0)</Highlight></CodeLine>
<Link id="l07160" /><CodeLine lineNumber="7160"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07161" /><CodeLine lineNumber="7161"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07162" /><CodeLine lineNumber="7162"><Highlight kind="normal">  APInt DemandBits(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 0);</Highlight></CodeLine>
<Link id="l07163" /><CodeLine lineNumber="7163"><Highlight kind="normal">  APInt WidestAndBits(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 0);</Highlight></CodeLine>
<Link id="l07164" /><CodeLine lineNumber="7164"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07165" /><CodeLine lineNumber="7165"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l07166" /><CodeLine lineNumber="7166"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l07167" /><CodeLine lineNumber="7167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07168" /><CodeLine lineNumber="7168"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Break use-def graph loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07169" /><CodeLine lineNumber="7169"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</Highlight></CodeLine>
<Link id="l07170" /><CodeLine lineNumber="7170"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07171" /><CodeLine lineNumber="7171"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07172" /><CodeLine lineNumber="7172"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For a PHI node, push all of its users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07173" /><CodeLine lineNumber="7173"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l07174" /><CodeLine lineNumber="7174"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;users())</Highlight></CodeLine>
<Link id="l07175" /><CodeLine lineNumber="7175"><Highlight kind="normal">        WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</Highlight></CodeLine>
<Link id="l07176" /><CodeLine lineNumber="7176"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07177" /><CodeLine lineNumber="7177"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07178" /><CodeLine lineNumber="7178"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07179" /><CodeLine lineNumber="7179"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l07180" /><CodeLine lineNumber="7180"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::And: &#123;</Highlight></CodeLine>
<Link id="l07181" /><CodeLine lineNumber="7181"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AndC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l07182" /><CodeLine lineNumber="7182"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AndC)</Highlight></CodeLine>
<Link id="l07183" /><CodeLine lineNumber="7183"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07184" /><CodeLine lineNumber="7184"><Highlight kind="normal">      APInt AndBits = AndC-&gt;getValue();</Highlight></CodeLine>
<Link id="l07185" /><CodeLine lineNumber="7185"><Highlight kind="normal">      DemandBits |= AndBits;</Highlight></CodeLine>
<Link id="l07186" /><CodeLine lineNumber="7186"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Keep track of the widest and mask we see.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07187" /><CodeLine lineNumber="7187"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AndBits.<a href="/docs/api/classes/llvm/apint/#a46a7cbf3724080a5f4f4c7e7a4551e26">ugt</a>(WidestAndBits))</Highlight></CodeLine>
<Link id="l07188" /><CodeLine lineNumber="7188"><Highlight kind="normal">        WidestAndBits = AndBits;</Highlight></CodeLine>
<Link id="l07189" /><CodeLine lineNumber="7189"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AndBits == WidestAndBits &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0) == Load)</Highlight></CodeLine>
<Link id="l07190" /><CodeLine lineNumber="7190"><Highlight kind="normal">        AndsToMaybeRemove.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07191" /><CodeLine lineNumber="7191"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07192" /><CodeLine lineNumber="7192"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07193" /><CodeLine lineNumber="7193"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07194" /><CodeLine lineNumber="7194"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl: &#123;</Highlight></CodeLine>
<Link id="l07195" /><CodeLine lineNumber="7195"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ShlC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l07196" /><CodeLine lineNumber="7196"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ShlC)</Highlight></CodeLine>
<Link id="l07197" /><CodeLine lineNumber="7197"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07198" /><CodeLine lineNumber="7198"><Highlight kind="normal">      uint64&#95;t ShiftAmt = ShlC-&gt;getLimitedValue(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - 1);</Highlight></CodeLine>
<Link id="l07199" /><CodeLine lineNumber="7199"><Highlight kind="normal">      DemandBits.setLowBits(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - ShiftAmt);</Highlight></CodeLine>
<Link id="l07200" /><CodeLine lineNumber="7200"><Highlight kind="normal">      DropFlags.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07201" /><CodeLine lineNumber="7201"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07202" /><CodeLine lineNumber="7202"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07203" /><CodeLine lineNumber="7203"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07204" /><CodeLine lineNumber="7204"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Trunc: &#123;</Highlight></CodeLine>
<Link id="l07205" /><CodeLine lineNumber="7205"><Highlight kind="normal">      EVT TruncVT = TLI-&gt;getValueType(&#42;DL, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l07206" /><CodeLine lineNumber="7206"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TruncBitWidth = TruncVT.<a href="/docs/api/structs/llvm/evt/#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>();</Highlight></CodeLine>
<Link id="l07207" /><CodeLine lineNumber="7207"><Highlight kind="normal">      DemandBits.setLowBits(TruncBitWidth);</Highlight></CodeLine>
<Link id="l07208" /><CodeLine lineNumber="7208"><Highlight kind="normal">      DropFlags.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07209" /><CodeLine lineNumber="7209"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07210" /><CodeLine lineNumber="7210"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07211" /><CodeLine lineNumber="7211"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07212" /><CodeLine lineNumber="7212"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l07213" /><CodeLine lineNumber="7213"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07214" /><CodeLine lineNumber="7214"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07215" /><CodeLine lineNumber="7215"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07216" /><CodeLine lineNumber="7216"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07217" /><CodeLine lineNumber="7217"><Highlight kind="normal">  uint32&#95;t ActiveBits = DemandBits.getActiveBits();</Highlight></CodeLine>
<Link id="l07218" /><CodeLine lineNumber="7218"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Avoid hoisting (and (load x) 1) since it is unlikely to be folded by the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07219" /><CodeLine lineNumber="7219"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// target even if isLoadExtLegal says an i1 EXTLOAD is valid.  For example,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07220" /><CodeLine lineNumber="7220"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for the AArch64 target isLoadExtLegal(ZEXTLOAD, i32, i1) returns true, but</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07221" /><CodeLine lineNumber="7221"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (and (load x) 1) is not matched as a single instruction, rather as a LDR</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07222" /><CodeLine lineNumber="7222"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// followed by an AND.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07223" /><CodeLine lineNumber="7223"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Look into removing this restriction by fixing backends to either</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07224" /><CodeLine lineNumber="7224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// return false for isLoadExtLegal for i1 or have them select this pattern to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07225" /><CodeLine lineNumber="7225"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a single instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07226" /><CodeLine lineNumber="7226"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07227" /><CodeLine lineNumber="7227"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Also avoid hoisting if we didn&#39;t see any ands with the exact DemandBits</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07228" /><CodeLine lineNumber="7228"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mask, since these are the only ands that will be removed by isel.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07229" /><CodeLine lineNumber="7229"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ActiveBits &lt;= 1 || !DemandBits.isMask(ActiveBits) ||</Highlight></CodeLine>
<Link id="l07230" /><CodeLine lineNumber="7230"><Highlight kind="normal">      WidestAndBits != DemandBits)</Highlight></CodeLine>
<Link id="l07231" /><CodeLine lineNumber="7231"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07232" /><CodeLine lineNumber="7232"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07233" /><CodeLine lineNumber="7233"><Highlight kind="normal">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType()-&gt;getContext();</Highlight></CodeLine>
<Link id="l07234" /><CodeLine lineNumber="7234"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TruncTy = Type::getIntNTy(Ctx, ActiveBits);</Highlight></CodeLine>
<Link id="l07235" /><CodeLine lineNumber="7235"><Highlight kind="normal">  EVT TruncVT = TLI-&gt;getValueType(&#42;DL, TruncTy);</Highlight></CodeLine>
<Link id="l07236" /><CodeLine lineNumber="7236"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07237" /><CodeLine lineNumber="7237"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reject cases that won&#39;t be matched as extloads.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07238" /><CodeLine lineNumber="7238"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoadResultVT.<a href="/docs/api/structs/llvm/evt/#a3ad406477784397709a339d5a2957b43">bitsGT</a>(TruncVT) || !TruncVT.<a href="/docs/api/structs/llvm/evt/#ab41e50273c70287914ded0ae668bc507">isRound</a>() ||</Highlight></CodeLine>
<Link id="l07239" /><CodeLine lineNumber="7239"><Highlight kind="normal">      !TLI-&gt;isLoadExtLegal(<a href="/docs/api/namespaces/llvm/isd/#ad4d48171b87ca51ff54c10a436bac4d7a8d89c7da4444d9ec11667aa369abc5f7">ISD::ZEXTLOAD</a>, LoadResultVT, TruncVT))</Highlight></CodeLine>
<Link id="l07240" /><CodeLine lineNumber="7240"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07241" /><CodeLine lineNumber="7241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07242" /><CodeLine lineNumber="7242"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getNextNonDebugInstruction());</Highlight></CodeLine>
<Link id="l07243" /><CodeLine lineNumber="7243"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewAnd = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</Highlight></CodeLine>
<Link id="l07244" /><CodeLine lineNumber="7244"><Highlight kind="normal">      Builder.CreateAnd(Load, ConstantInt::get(Ctx, DemandBits)));</Highlight></CodeLine>
<Link id="l07245" /><CodeLine lineNumber="7245"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Mark this instruction as &quot;inserted by CGP&quot;, so that other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07246" /><CodeLine lineNumber="7246"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// optimizations don&#39;t touch it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07247" /><CodeLine lineNumber="7247"><Highlight kind="normal">  InsertedInsts.insert(NewAnd);</Highlight></CodeLine>
<Link id="l07248" /><CodeLine lineNumber="7248"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07249" /><CodeLine lineNumber="7249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace all uses of load with new and (except for the use of load in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07250" /><CodeLine lineNumber="7250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// new and itself).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07251" /><CodeLine lineNumber="7251"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Load, NewAnd, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l07252" /><CodeLine lineNumber="7252"><Highlight kind="normal">  NewAnd-&gt;setOperand(0, Load);</Highlight></CodeLine>
<Link id="l07253" /><CodeLine lineNumber="7253"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07254" /><CodeLine lineNumber="7254"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove any and instructions that are now redundant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07255" /><CodeLine lineNumber="7255"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> : AndsToMaybeRemove)</Highlight></CodeLine>
<Link id="l07256" /><CodeLine lineNumber="7256"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check that the and mask is the same as the one we decided to put on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07257" /><CodeLine lineNumber="7257"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// new and.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07258" /><CodeLine lineNumber="7258"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getOperand(1))-&gt;getValue() == DemandBits) &#123;</Highlight></CodeLine>
<Link id="l07259" /><CodeLine lineNumber="7259"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, NewAnd, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l07260" /><CodeLine lineNumber="7260"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;&#42;CurInstIterator == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>)</Highlight></CodeLine>
<Link id="l07261" /><CodeLine lineNumber="7261"><Highlight kind="normal">        CurInstIterator = std::next(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l07262" /><CodeLine lineNumber="7262"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l07263" /><CodeLine lineNumber="7263"><Highlight kind="normal">      ++NumAndUses;</Highlight></CodeLine>
<Link id="l07264" /><CodeLine lineNumber="7264"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07265" /><CodeLine lineNumber="7265"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07266" /><CodeLine lineNumber="7266"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NSW flags may not longer hold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07267" /><CodeLine lineNumber="7267"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inst : DropFlags)</Highlight></CodeLine>
<Link id="l07268" /><CodeLine lineNumber="7268"><Highlight kind="normal">    Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4166b451a572b1e5d3fea7250af53653">setHasNoSignedWrap</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07269" /><CodeLine lineNumber="7269"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07270" /><CodeLine lineNumber="7270"><Highlight kind="normal">  ++NumAndsAdded;</Highlight></CodeLine>
<Link id="l07271" /><CodeLine lineNumber="7271"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07272" /><CodeLine lineNumber="7272"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07273" /><CodeLine lineNumber="7273"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07274" /><CodeLine lineNumber="7274"><Highlight kind="comment">/// Check if V (an operand of a select instruction) is an expensive instruction</Highlight></CodeLine>
<Link id="l07275" /><CodeLine lineNumber="7275"><Highlight kind="comment">/// that is only used once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07276" /><CodeLine lineNumber="7276" lineLink="#a10ece31d94cdd66e58cef49d73f2263f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l07277" /><CodeLine lineNumber="7277"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l07278" /><CodeLine lineNumber="7278"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If it&#39;s safe to speculatively execute, then it should not have side</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07279" /><CodeLine lineNumber="7279"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// effects; therefore, it&#39;s safe to sink and possibly &#42;not&#42; execute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07280" /><CodeLine lineNumber="7280"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l07281" /><CodeLine lineNumber="7281"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;isExpensiveToSpeculativelyExecute(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07282" /><CodeLine lineNumber="7282"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07283" /><CodeLine lineNumber="7283"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07284" /><CodeLine lineNumber="7284"><Highlight kind="comment">/// Returns true if a SelectInst should be turned into an explicit branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07285" /><CodeLine lineNumber="7285" lineLink="#a4bde686b6506cc9e63919272711713f4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l07286" /><CodeLine lineNumber="7286"><Highlight kind="normal">                                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42;TLI,</Highlight></CodeLine>
<Link id="l07287" /><CodeLine lineNumber="7287"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</Highlight></CodeLine>
<Link id="l07288" /><CodeLine lineNumber="7288"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If even a predictable select is cheap, then a branch can&#39;t be cheaper.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07289" /><CodeLine lineNumber="7289"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#aa9f4cbd152c2c5d84007f3ad710ee895">isPredictableSelectExpensive</a>())</Highlight></CodeLine>
<Link id="l07290" /><CodeLine lineNumber="7290"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07291" /><CodeLine lineNumber="7291"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07292" /><CodeLine lineNumber="7292"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: This should use the same heuristics as IfConversion to determine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07293" /><CodeLine lineNumber="7293"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// whether a select is better represented as a branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07294" /><CodeLine lineNumber="7294"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07295" /><CodeLine lineNumber="7295"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If metadata tells us that the select condition is obviously predictable,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07296" /><CodeLine lineNumber="7296"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// then we want to replace the select with a branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07297" /><CodeLine lineNumber="7297"><Highlight kind="normal">  uint64&#95;t TrueWeight, FalseWeight;</Highlight></CodeLine>
<Link id="l07298" /><CodeLine lineNumber="7298"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, TrueWeight, FalseWeight)) &#123;</Highlight></CodeLine>
<Link id="l07299" /><CodeLine lineNumber="7299"><Highlight kind="normal">    uint64&#95;t Max = std::max(TrueWeight, FalseWeight);</Highlight></CodeLine>
<Link id="l07300" /><CodeLine lineNumber="7300"><Highlight kind="normal">    uint64&#95;t Sum = TrueWeight + FalseWeight;</Highlight></CodeLine>
<Link id="l07301" /><CodeLine lineNumber="7301"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Sum != 0) &#123;</Highlight></CodeLine>
<Link id="l07302" /><CodeLine lineNumber="7302"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Probability = <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(Max, Sum);</Highlight></CodeLine>
<Link id="l07303" /><CodeLine lineNumber="7303"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Probability &gt; <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getPredictableBranchThreshold())</Highlight></CodeLine>
<Link id="l07304" /><CodeLine lineNumber="7304"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07305" /><CodeLine lineNumber="7305"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07306" /><CodeLine lineNumber="7306"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07307" /><CodeLine lineNumber="7307"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07308" /><CodeLine lineNumber="7308"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</Highlight></CodeLine>
<Link id="l07309" /><CodeLine lineNumber="7309"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07310" /><CodeLine lineNumber="7310"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If a branch is predictable, an out-of-order CPU can avoid blocking on its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07311" /><CodeLine lineNumber="7311"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// comparison condition. If the compare has more than one use, there&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07312" /><CodeLine lineNumber="7312"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// probably another cmov or setcc around, so it&#39;s not worth emitting a branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07313" /><CodeLine lineNumber="7313"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cmp || !Cmp-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l07314" /><CodeLine lineNumber="7314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07315" /><CodeLine lineNumber="7315"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07316" /><CodeLine lineNumber="7316"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If either operand of the select is expensive and only needed on one side</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07317" /><CodeLine lineNumber="7317"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the select, we should form a branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07318" /><CodeLine lineNumber="7318"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue()) ||</Highlight></CodeLine>
<Link id="l07319" /><CodeLine lineNumber="7319"><Highlight kind="normal">      <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue()))</Highlight></CodeLine>
<Link id="l07320" /><CodeLine lineNumber="7320"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07321" /><CodeLine lineNumber="7321"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07322" /><CodeLine lineNumber="7322"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07323" /><CodeLine lineNumber="7323"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07324" /><CodeLine lineNumber="7324"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07325" /><CodeLine lineNumber="7325"><Highlight kind="comment">/// If \\p isTrue is true, return the true value of \\p SI, otherwise return</Highlight></CodeLine>
<Link id="l07326" /><CodeLine lineNumber="7326"><Highlight kind="comment">/// false value of \\p SI. If the true/false value of \\p SI is defined by any</Highlight></CodeLine>
<Link id="l07327" /><CodeLine lineNumber="7327"><Highlight kind="comment">/// select instructions in \\p Selects, look through the defining select</Highlight></CodeLine>
<Link id="l07328" /><CodeLine lineNumber="7328"><Highlight kind="comment">/// instruction until the true/false value is not defined in \\p Selects.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07329" /><CodeLine lineNumber="7329"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;</Highlight></CodeLine>
<Link id="l07330" /><CodeLine lineNumber="7330" lineLink="#a596c5a8a807f6ce192718084a11648de"><Highlight kind="normal"><a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isTrue,</Highlight></CodeLine>
<Link id="l07331" /><CodeLine lineNumber="7331"><Highlight kind="normal">                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 2&gt;</a> &amp;Selects) &#123;</Highlight></CodeLine>
<Link id="l07332" /><CodeLine lineNumber="7332"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07333" /><CodeLine lineNumber="7333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07334" /><CodeLine lineNumber="7334"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;DefSI = <a href="/docs/api/namespaces/llvm/si">SI</a>; DefSI != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; Selects.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(DefSI);</Highlight></CodeLine>
<Link id="l07335" /><CodeLine lineNumber="7335"><Highlight kind="normal">       DefSI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l07336" /><CodeLine lineNumber="7336"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DefSI-&gt;getCondition() == <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition() &amp;&amp;</Highlight></CodeLine>
<Link id="l07337" /><CodeLine lineNumber="7337"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;The condition of DefSI does not match with SI&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07338" /><CodeLine lineNumber="7338"><Highlight kind="normal">    V = (isTrue ? DefSI-&gt;getTrueValue() : DefSI-&gt;getFalseValue());</Highlight></CodeLine>
<Link id="l07339" /><CodeLine lineNumber="7339"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07340" /><CodeLine lineNumber="7340"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07341" /><CodeLine lineNumber="7341"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Failed to get select true/false value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07342" /><CodeLine lineNumber="7342"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> V;</Highlight></CodeLine>
<Link id="l07343" /><CodeLine lineNumber="7343"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07344" /><CodeLine lineNumber="7344"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07345" /><CodeLine lineNumber="7345"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeShiftInst(BinaryOperator &#42;Shift) &#123;</Highlight></CodeLine>
<Link id="l07346" /><CodeLine lineNumber="7346"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shift-&gt;<a href="/docs/api/classes/llvm/instruction/#ac5984d6827f6e6922bed00bf03ba9552">isShift</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a shift&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07347" /><CodeLine lineNumber="7347"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07348" /><CodeLine lineNumber="7348"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is (1) a vector shift, (2) shifts by scalars are cheaper than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07349" /><CodeLine lineNumber="7349"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// general vector shifts, and (3) the shift amount is a select-of-splatted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07350" /><CodeLine lineNumber="7350"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// values, hoist the shifts before the select:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07351" /><CodeLine lineNumber="7351"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   shift Op0, (select Cond, TVal, FVal) --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07352" /><CodeLine lineNumber="7352"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   select Cond, (shift Op0, TVal), (shift Op0, FVal)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07353" /><CodeLine lineNumber="7353"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07354" /><CodeLine lineNumber="7354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is inverting a generic IR transform when we know that the cost of a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07355" /><CodeLine lineNumber="7355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// general vector shift is more than the cost of 2 shift-by-scalars.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07356" /><CodeLine lineNumber="7356"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can&#39;t do this effectively in SDAG because we may not be able to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07357" /><CodeLine lineNumber="7357"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// determine if the select operands are splats from within a basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07358" /><CodeLine lineNumber="7358"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty = Shift-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l07359" /><CodeLine lineNumber="7359"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ty-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !TTI-&gt;isVectorShiftByScalarCheap(Ty))</Highlight></CodeLine>
<Link id="l07360" /><CodeLine lineNumber="7360"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07361" /><CodeLine lineNumber="7361"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;TVal, &#42;FVal;</Highlight></CodeLine>
<Link id="l07362" /><CodeLine lineNumber="7362"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shift-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1),</Highlight></CodeLine>
<Link id="l07363" /><CodeLine lineNumber="7363"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(TVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(FVal)))))</Highlight></CodeLine>
<Link id="l07364" /><CodeLine lineNumber="7364"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07365" /><CodeLine lineNumber="7365"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(TVal) || !<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(FVal))</Highlight></CodeLine>
<Link id="l07366" /><CodeLine lineNumber="7366"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07367" /><CodeLine lineNumber="7367"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07368" /><CodeLine lineNumber="7368"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(Shift);</Highlight></CodeLine>
<Link id="l07369" /><CodeLine lineNumber="7369"><Highlight kind="normal">  BinaryOperator::BinaryOps Opcode = Shift-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</Highlight></CodeLine>
<Link id="l07370" /><CodeLine lineNumber="7370"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewTVal = Builder.CreateBinOp(Opcode, Shift-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), TVal);</Highlight></CodeLine>
<Link id="l07371" /><CodeLine lineNumber="7371"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewFVal = Builder.CreateBinOp(Opcode, Shift-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), FVal);</Highlight></CodeLine>
<Link id="l07372" /><CodeLine lineNumber="7372"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewSel = Builder.CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NewTVal, NewFVal);</Highlight></CodeLine>
<Link id="l07373" /><CodeLine lineNumber="7373"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Shift, NewSel, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l07374" /><CodeLine lineNumber="7374"><Highlight kind="normal">  Shift-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l07375" /><CodeLine lineNumber="7375"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07376" /><CodeLine lineNumber="7376"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07377" /><CodeLine lineNumber="7377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07378" /><CodeLine lineNumber="7378"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeFunnelShift(IntrinsicInst &#42;Fsh) &#123;</Highlight></CodeLine>
<Link id="l07379" /><CodeLine lineNumber="7379"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> Opcode = Fsh-&gt;<a href="/docs/api/classes/llvm/intrinsicinst/#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>();</Highlight></CodeLine>
<Link id="l07380" /><CodeLine lineNumber="7380"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == Intrinsic::fshl || Opcode == Intrinsic::fshr) &amp;&amp;</Highlight></CodeLine>
<Link id="l07381" /><CodeLine lineNumber="7381"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expected a funnel shift&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07382" /><CodeLine lineNumber="7382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07383" /><CodeLine lineNumber="7383"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is (1) a vector funnel shift, (2) shifts by scalars are cheaper</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07384" /><CodeLine lineNumber="7384"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// than general vector shifts, and (3) the shift amount is select-of-splatted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07385" /><CodeLine lineNumber="7385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// values, hoist the funnel shifts before the select:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07386" /><CodeLine lineNumber="7386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   fsh Op0, Op1, (select Cond, TVal, FVal) --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07387" /><CodeLine lineNumber="7387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   select Cond, (fsh Op0, Op1, TVal), (fsh Op0, Op1, FVal)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07388" /><CodeLine lineNumber="7388"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07389" /><CodeLine lineNumber="7389"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is inverting a generic IR transform when we know that the cost of a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07390" /><CodeLine lineNumber="7390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// general vector shift is more than the cost of 2 shift-by-scalars.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07391" /><CodeLine lineNumber="7391"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can&#39;t do this effectively in SDAG because we may not be able to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07392" /><CodeLine lineNumber="7392"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// determine if the select operands are splats from within a basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07393" /><CodeLine lineNumber="7393"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty = Fsh-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l07394" /><CodeLine lineNumber="7394"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ty-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !TTI-&gt;isVectorShiftByScalarCheap(Ty))</Highlight></CodeLine>
<Link id="l07395" /><CodeLine lineNumber="7395"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07396" /><CodeLine lineNumber="7396"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;TVal, &#42;FVal;</Highlight></CodeLine>
<Link id="l07397" /><CodeLine lineNumber="7397"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Fsh-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2),</Highlight></CodeLine>
<Link id="l07398" /><CodeLine lineNumber="7398"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(TVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(FVal)))))</Highlight></CodeLine>
<Link id="l07399" /><CodeLine lineNumber="7399"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07400" /><CodeLine lineNumber="7400"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(TVal) || !<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(FVal))</Highlight></CodeLine>
<Link id="l07401" /><CodeLine lineNumber="7401"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07402" /><CodeLine lineNumber="7402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07403" /><CodeLine lineNumber="7403"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(Fsh);</Highlight></CodeLine>
<Link id="l07404" /><CodeLine lineNumber="7404"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Fsh-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = Fsh-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l07405" /><CodeLine lineNumber="7405"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewTVal = Builder.CreateIntrinsic(Opcode, Ty, &#123;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, TVal&#125;);</Highlight></CodeLine>
<Link id="l07406" /><CodeLine lineNumber="7406"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewFVal = Builder.CreateIntrinsic(Opcode, Ty, &#123;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, FVal&#125;);</Highlight></CodeLine>
<Link id="l07407" /><CodeLine lineNumber="7407"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewSel = Builder.CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NewTVal, NewFVal);</Highlight></CodeLine>
<Link id="l07408" /><CodeLine lineNumber="7408"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Fsh, NewSel, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l07409" /><CodeLine lineNumber="7409"><Highlight kind="normal">  Fsh-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l07410" /><CodeLine lineNumber="7410"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07411" /><CodeLine lineNumber="7411"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07412" /><CodeLine lineNumber="7412"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07413" /><CodeLine lineNumber="7413"><Highlight kind="comment">/// If we have a SelectInst that will likely profit from branch prediction,</Highlight></CodeLine>
<Link id="l07414" /><CodeLine lineNumber="7414"><Highlight kind="comment">/// turn it into a branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07415" /><CodeLine lineNumber="7415"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeSelectInst(SelectInst &#42;SI) &#123;</Highlight></CodeLine>
<Link id="l07416" /><CodeLine lineNumber="7416"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#af42b66ae716b910d032498490940ae08">DisableSelectToBranch</a>)</Highlight></CodeLine>
<Link id="l07417" /><CodeLine lineNumber="7417"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07418" /><CodeLine lineNumber="7418"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07419" /><CodeLine lineNumber="7419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the SelectOptimize pass is enabled, selects have already been optimized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07420" /><CodeLine lineNumber="7420"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#aff30786f1ea13c3ea475acce504571e4">getCGPassBuilderOption</a>().<a href="/docs/api/files/lib/lib/codegen/targetpassconfig-cpp/#a7e81429317cf832a7e2367c98629474f">DisableSelectOptimize</a>)</Highlight></CodeLine>
<Link id="l07421" /><CodeLine lineNumber="7421"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07422" /><CodeLine lineNumber="7422"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07423" /><CodeLine lineNumber="7423"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find all consecutive select instructions that share the same condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07424" /><CodeLine lineNumber="7424"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;SelectInst &#42;, 2&gt;</a> ASI;</Highlight></CodeLine>
<Link id="l07425" /><CodeLine lineNumber="7425"><Highlight kind="normal">  ASI.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SI);</Highlight></CodeLine>
<Link id="l07426" /><CodeLine lineNumber="7426"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = ++<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(SI);</Highlight></CodeLine>
<Link id="l07427" /><CodeLine lineNumber="7427"><Highlight kind="normal">       It != <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent()-&gt;<a href="/docs/api/namespaces/llvm/sandboxir/#a64ac61287490361f2183faf1d7639ee9">end</a>(); ++It) &#123;</Highlight></CodeLine>
<Link id="l07428" /><CodeLine lineNumber="7428"><Highlight kind="normal">    SelectInst &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(&amp;&#42;It);</Highlight></CodeLine>
<Link id="l07429" /><CodeLine lineNumber="7429"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCondition()) &#123;</Highlight></CodeLine>
<Link id="l07430" /><CodeLine lineNumber="7430"><Highlight kind="normal">      ASI.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07431" /><CodeLine lineNumber="7431"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l07432" /><CodeLine lineNumber="7432"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07433" /><CodeLine lineNumber="7433"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07434" /><CodeLine lineNumber="7434"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07435" /><CodeLine lineNumber="7435"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07436" /><CodeLine lineNumber="7436"><Highlight kind="normal">  SelectInst &#42;LastSI = ASI.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>();</Highlight></CodeLine>
<Link id="l07437" /><CodeLine lineNumber="7437"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Increment the current iterator to skip all the rest of select instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07438" /><CodeLine lineNumber="7438"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// because they will be either &quot;not lowered&quot; or &quot;all lowered&quot; to branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07439" /><CodeLine lineNumber="7439"><Highlight kind="normal">  CurInstIterator = std::next(LastSI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l07440" /><CodeLine lineNumber="7440"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Examine debug-info attached to the consecutive select instructions. They</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07441" /><CodeLine lineNumber="7441"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// won&#39;t be individually optimised by optimizeInst, so we need to perform</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07442" /><CodeLine lineNumber="7442"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// DbgVariableRecord maintenence here instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07443" /><CodeLine lineNumber="7443"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (SelectInst &#42;SI : <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(ASI).drop&#95;front())</Highlight></CodeLine>
<Link id="l07444" /><CodeLine lineNumber="7444"><Highlight kind="normal">    fixupDbgVariableRecordsOnInst(&#42;SI);</Highlight></CodeLine>
<Link id="l07445" /><CodeLine lineNumber="7445"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07446" /><CodeLine lineNumber="7446"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VectorCond = !<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition()-&gt;getType()-&gt;isIntegerTy(1);</Highlight></CodeLine>
<Link id="l07447" /><CodeLine lineNumber="7447"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07448" /><CodeLine lineNumber="7448"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can we convert the &#39;select&#39; to CF ?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07449" /><CodeLine lineNumber="7449"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorCond || <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getMetadata(LLVMContext::MD&#95;unpredictable))</Highlight></CodeLine>
<Link id="l07450" /><CodeLine lineNumber="7450"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07451" /><CodeLine lineNumber="7451"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07452" /><CodeLine lineNumber="7452"><Highlight kind="normal">  TargetLowering::SelectSupportKind SelectKind;</Highlight></CodeLine>
<Link id="l07453" /><CodeLine lineNumber="7453"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getType()-&gt;isVectorTy())</Highlight></CodeLine>
<Link id="l07454" /><CodeLine lineNumber="7454"><Highlight kind="normal">    SelectKind = TargetLowering::ScalarCondVectorVal;</Highlight></CodeLine>
<Link id="l07455" /><CodeLine lineNumber="7455"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07456" /><CodeLine lineNumber="7456"><Highlight kind="normal">    SelectKind = TargetLowering::ScalarValSelect;</Highlight></CodeLine>
<Link id="l07457" /><CodeLine lineNumber="7457"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07458" /><CodeLine lineNumber="7458"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI-&gt;isSelectSupported(SelectKind) &amp;&amp;</Highlight></CodeLine>
<Link id="l07459" /><CodeLine lineNumber="7459"><Highlight kind="normal">      (!<a href="#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a>(TTI, TLI, SI) ||</Highlight></CodeLine>
<Link id="l07460" /><CodeLine lineNumber="7460"><Highlight kind="normal">       <a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent(), PSI, BFI.get())))</Highlight></CodeLine>
<Link id="l07461" /><CodeLine lineNumber="7461"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07462" /><CodeLine lineNumber="7462"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07463" /><CodeLine lineNumber="7463"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The DominatorTree needs to be rebuilt by any consumers after this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07464" /><CodeLine lineNumber="7464"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// transformation. We simply reset here rather than setting the ModifiedDT</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07465" /><CodeLine lineNumber="7465"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// flag to avoid restarting the function walk in runOnFunction for each</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07466" /><CodeLine lineNumber="7466"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// select optimized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07467" /><CodeLine lineNumber="7467"><Highlight kind="normal">  DT.reset();</Highlight></CodeLine>
<Link id="l07468" /><CodeLine lineNumber="7468"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07469" /><CodeLine lineNumber="7469"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Transform a sequence like this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07470" /><CodeLine lineNumber="7470"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    start:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07471" /><CodeLine lineNumber="7471"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       %cmp = cmp uge i32 %a, %b</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07472" /><CodeLine lineNumber="7472"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       %sel = select i1 %cmp, i32 %c, i32 %d</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07473" /><CodeLine lineNumber="7473"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07474" /><CodeLine lineNumber="7474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Into:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07475" /><CodeLine lineNumber="7475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    start:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07476" /><CodeLine lineNumber="7476"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       %cmp = cmp uge i32 %a, %b</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07477" /><CodeLine lineNumber="7477"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       %cmp.frozen = freeze %cmp</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07478" /><CodeLine lineNumber="7478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       br i1 %cmp.frozen, label %select.true, label %select.false</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07479" /><CodeLine lineNumber="7479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    select.true:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07480" /><CodeLine lineNumber="7480"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       br label %select.end</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07481" /><CodeLine lineNumber="7481"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    select.false:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07482" /><CodeLine lineNumber="7482"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       br label %select.end</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07483" /><CodeLine lineNumber="7483"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    select.end:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07484" /><CodeLine lineNumber="7484"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       %sel = phi i32 &#91; %c, %select.true &#93;, &#91; %d, %select.false &#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07485" /><CodeLine lineNumber="7485"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07486" /><CodeLine lineNumber="7486"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// %cmp should be frozen, otherwise it may introduce undefined behavior.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07487" /><CodeLine lineNumber="7487"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In addition, we may sink instructions that produce %c or %d from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07488" /><CodeLine lineNumber="7488"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the entry block into the destination(s) of the new branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07489" /><CodeLine lineNumber="7489"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the true or false blocks do not contain a sunken instruction, that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07490" /><CodeLine lineNumber="7490"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block and its branch may be optimized away. In that case, one side of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07491" /><CodeLine lineNumber="7491"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// first branch will point directly to select.end, and the corresponding PHI</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07492" /><CodeLine lineNumber="7492"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessor block will be the start block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07493" /><CodeLine lineNumber="7493"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07494" /><CodeLine lineNumber="7494"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect values that go on the true side and the values that go on the false</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07495" /><CodeLine lineNumber="7495"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// side.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07496" /><CodeLine lineNumber="7496"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;&gt; TrueInstrs, FalseInstrs;</Highlight></CodeLine>
<Link id="l07497" /><CodeLine lineNumber="7497"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (SelectInst &#42;SI : ASI) &#123;</Highlight></CodeLine>
<Link id="l07498" /><CodeLine lineNumber="7498"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getTrueValue(); <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(TTI, V))</Highlight></CodeLine>
<Link id="l07499" /><CodeLine lineNumber="7499"><Highlight kind="normal">      TrueInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V));</Highlight></CodeLine>
<Link id="l07500" /><CodeLine lineNumber="7500"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getFalseValue(); <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(TTI, V))</Highlight></CodeLine>
<Link id="l07501" /><CodeLine lineNumber="7501"><Highlight kind="normal">      FalseInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V));</Highlight></CodeLine>
<Link id="l07502" /><CodeLine lineNumber="7502"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07503" /><CodeLine lineNumber="7503"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07504" /><CodeLine lineNumber="7504"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Split the select block, according to how many (if any) values go on each</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07505" /><CodeLine lineNumber="7505"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// side.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07506" /><CodeLine lineNumber="7506"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;StartBlock = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l07507" /><CodeLine lineNumber="7507"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SplitPt = std::next(<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(LastSI));</Highlight></CodeLine>
<Link id="l07508" /><CodeLine lineNumber="7508"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We should split before any debug-info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07509" /><CodeLine lineNumber="7509"><Highlight kind="normal">  SplitPt.setHeadBit(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07510" /><CodeLine lineNumber="7510"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07511" /><CodeLine lineNumber="7511"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">IB</a>(SI);</Highlight></CodeLine>
<Link id="l07512" /><CodeLine lineNumber="7512"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CondFr = <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">IB</a>.CreateFreeze(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition(), <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.frozen&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07513" /><CodeLine lineNumber="7513"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07514" /><CodeLine lineNumber="7514"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TrueBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07515" /><CodeLine lineNumber="7515"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FalseBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07516" /><CodeLine lineNumber="7516"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EndBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07517" /><CodeLine lineNumber="7517"><Highlight kind="normal">  BranchInst &#42;TrueBranch = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07518" /><CodeLine lineNumber="7518"><Highlight kind="normal">  BranchInst &#42;FalseBranch = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07519" /><CodeLine lineNumber="7519"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TrueInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0) &#123;</Highlight></CodeLine>
<Link id="l07520" /><CodeLine lineNumber="7520"><Highlight kind="normal">    FalseBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#a35593f403e6311f92924141d2fdca50c">SplitBlockAndInsertIfElse</a>(</Highlight></CodeLine>
<Link id="l07521" /><CodeLine lineNumber="7521"><Highlight kind="normal">        CondFr, SplitPt, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, LI));</Highlight></CodeLine>
<Link id="l07522" /><CodeLine lineNumber="7522"><Highlight kind="normal">    FalseBlock = FalseBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l07523" /><CodeLine lineNumber="7523"><Highlight kind="normal">    EndBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(FalseBranch-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l07524" /><CodeLine lineNumber="7524"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FalseInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0) &#123;</Highlight></CodeLine>
<Link id="l07525" /><CodeLine lineNumber="7525"><Highlight kind="normal">    TrueBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ad957413955739c91204c96e33e0cc933">SplitBlockAndInsertIfThen</a>(</Highlight></CodeLine>
<Link id="l07526" /><CodeLine lineNumber="7526"><Highlight kind="normal">        CondFr, SplitPt, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, LI));</Highlight></CodeLine>
<Link id="l07527" /><CodeLine lineNumber="7527"><Highlight kind="normal">    TrueBlock = TrueBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l07528" /><CodeLine lineNumber="7528"><Highlight kind="normal">    EndBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(TrueBranch-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l07529" /><CodeLine lineNumber="7529"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l07530" /><CodeLine lineNumber="7530"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ThenTerm = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07531" /><CodeLine lineNumber="7531"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ElseTerm = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07532" /><CodeLine lineNumber="7532"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7ac00229d8c59902686f52ed061cdc80">SplitBlockAndInsertIfThenElse</a>(CondFr, SplitPt, &amp;ThenTerm, &amp;ElseTerm,</Highlight></CodeLine>
<Link id="l07533" /><CodeLine lineNumber="7533"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, LI);</Highlight></CodeLine>
<Link id="l07534" /><CodeLine lineNumber="7534"><Highlight kind="normal">    TrueBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ThenTerm);</Highlight></CodeLine>
<Link id="l07535" /><CodeLine lineNumber="7535"><Highlight kind="normal">    FalseBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ElseTerm);</Highlight></CodeLine>
<Link id="l07536" /><CodeLine lineNumber="7536"><Highlight kind="normal">    TrueBlock = TrueBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l07537" /><CodeLine lineNumber="7537"><Highlight kind="normal">    FalseBlock = FalseBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l07538" /><CodeLine lineNumber="7538"><Highlight kind="normal">    EndBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(TrueBranch-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l07539" /><CodeLine lineNumber="7539"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07540" /><CodeLine lineNumber="7540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07541" /><CodeLine lineNumber="7541"><Highlight kind="normal">  EndBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;select.end&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07542" /><CodeLine lineNumber="7542"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TrueBlock)</Highlight></CodeLine>
<Link id="l07543" /><CodeLine lineNumber="7543"><Highlight kind="normal">    TrueBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;select.true.sink&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07544" /><CodeLine lineNumber="7544"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FalseBlock)</Highlight></CodeLine>
<Link id="l07545" /><CodeLine lineNumber="7545"><Highlight kind="normal">    FalseBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(FalseInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0 ? </Highlight><Highlight kind="stringliteral">&quot;select.false&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07546" /><CodeLine lineNumber="7546"><Highlight kind="normal">                                                : </Highlight><Highlight kind="stringliteral">&quot;select.false.sink&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07547" /><CodeLine lineNumber="7547"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07548" /><CodeLine lineNumber="7548"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>) &#123;</Highlight></CodeLine>
<Link id="l07549" /><CodeLine lineNumber="7549"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TrueBlock)</Highlight></CodeLine>
<Link id="l07550" /><CodeLine lineNumber="7550"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(TrueBlock);</Highlight></CodeLine>
<Link id="l07551" /><CodeLine lineNumber="7551"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FalseBlock)</Highlight></CodeLine>
<Link id="l07552" /><CodeLine lineNumber="7552"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(FalseBlock);</Highlight></CodeLine>
<Link id="l07553" /><CodeLine lineNumber="7553"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(EndBlock);</Highlight></CodeLine>
<Link id="l07554" /><CodeLine lineNumber="7554"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07555" /><CodeLine lineNumber="7555"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07556" /><CodeLine lineNumber="7556"><Highlight kind="normal">  BFI-&gt;setBlockFreq(EndBlock, BFI-&gt;getBlockFreq(StartBlock));</Highlight></CodeLine>
<Link id="l07557" /><CodeLine lineNumber="7557"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07558" /><CodeLine lineNumber="7558"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MD&#91;&#93; = &#123;</Highlight></CodeLine>
<Link id="l07559" /><CodeLine lineNumber="7559"><Highlight kind="normal">      LLVMContext::MD&#95;prof, LLVMContext::MD&#95;unpredictable,</Highlight></CodeLine>
<Link id="l07560" /><CodeLine lineNumber="7560"><Highlight kind="normal">      LLVMContext::MD&#95;make&#95;implicit, LLVMContext::MD&#95;dbg&#125;;</Highlight></CodeLine>
<Link id="l07561" /><CodeLine lineNumber="7561"><Highlight kind="normal">  StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;SI, MD);</Highlight></CodeLine>
<Link id="l07562" /><CodeLine lineNumber="7562"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07563" /><CodeLine lineNumber="7563"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sink expensive instructions into the conditional blocks to avoid executing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07564" /><CodeLine lineNumber="7564"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// them speculatively.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07565" /><CodeLine lineNumber="7565"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : TrueInstrs)</Highlight></CodeLine>
<Link id="l07566" /><CodeLine lineNumber="7566"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(TrueBranch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l07567" /><CodeLine lineNumber="7567"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : FalseInstrs)</Highlight></CodeLine>
<Link id="l07568" /><CodeLine lineNumber="7568"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(FalseBranch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l07569" /><CodeLine lineNumber="7569"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07570" /><CodeLine lineNumber="7570"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we did not create a new block for one of the &#39;true&#39; or &#39;false&#39; paths</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07571" /><CodeLine lineNumber="7571"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the condition, it means that side of the branch goes to the end block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07572" /><CodeLine lineNumber="7572"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// directly and the path originates from the start block from the point of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07573" /><CodeLine lineNumber="7573"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// view of the new PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07574" /><CodeLine lineNumber="7574"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TrueBlock == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l07575" /><CodeLine lineNumber="7575"><Highlight kind="normal">    TrueBlock = StartBlock;</Highlight></CodeLine>
<Link id="l07576" /><CodeLine lineNumber="7576"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FalseBlock == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l07577" /><CodeLine lineNumber="7577"><Highlight kind="normal">    FalseBlock = StartBlock;</Highlight></CodeLine>
<Link id="l07578" /><CodeLine lineNumber="7578"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07579" /><CodeLine lineNumber="7579"><Highlight kind="normal">  SmallPtrSet&lt;const Instruction &#42;, 2&gt; INS;</Highlight></CodeLine>
<Link id="l07580" /><CodeLine lineNumber="7580"><Highlight kind="normal">  INS.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ASI.begin(), ASI.end());</Highlight></CodeLine>
<Link id="l07581" /><CodeLine lineNumber="7581"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use reverse iterator because later select may use the value of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07582" /><CodeLine lineNumber="7582"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// earlier select, and we need to propagate value through earlier select</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07583" /><CodeLine lineNumber="7583"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to get the PHI operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07584" /><CodeLine lineNumber="7584"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (SelectInst &#42;SI : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(ASI)) &#123;</Highlight></CodeLine>
<Link id="l07585" /><CodeLine lineNumber="7585"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The select itself is replaced with a PHI Node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07586" /><CodeLine lineNumber="7586"><Highlight kind="normal">    PHINode &#42;PN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getType(), 2, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07587" /><CodeLine lineNumber="7587"><Highlight kind="normal">    PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(EndBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l07588" /><CodeLine lineNumber="7588"><Highlight kind="normal">    PN-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(SI);</Highlight></CodeLine>
<Link id="l07589" /><CodeLine lineNumber="7589"><Highlight kind="normal">    PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a>(SI, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, INS), TrueBlock);</Highlight></CodeLine>
<Link id="l07590" /><CodeLine lineNumber="7590"><Highlight kind="normal">    PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a>(SI, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, INS), FalseBlock);</Highlight></CodeLine>
<Link id="l07591" /><CodeLine lineNumber="7591"><Highlight kind="normal">    PN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l07592" /><CodeLine lineNumber="7592"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07593" /><CodeLine lineNumber="7593"><Highlight kind="normal">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(SI, PN, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l07594" /><CodeLine lineNumber="7594"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l07595" /><CodeLine lineNumber="7595"><Highlight kind="normal">    INS.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(SI);</Highlight></CodeLine>
<Link id="l07596" /><CodeLine lineNumber="7596"><Highlight kind="normal">    ++NumSelectsExpanded;</Highlight></CodeLine>
<Link id="l07597" /><CodeLine lineNumber="7597"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07598" /><CodeLine lineNumber="7598"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07599" /><CodeLine lineNumber="7599"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Instruct OptimizeBlock to skip to the next block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07600" /><CodeLine lineNumber="7600"><Highlight kind="normal">  CurInstIterator = StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</Highlight></CodeLine>
<Link id="l07601" /><CodeLine lineNumber="7601"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07602" /><CodeLine lineNumber="7602"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07603" /><CodeLine lineNumber="7603"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07604" /><CodeLine lineNumber="7604"><Highlight kind="comment">/// Some targets only accept certain types for splat inputs. For example a VDUP</Highlight></CodeLine>
<Link id="l07605" /><CodeLine lineNumber="7605"><Highlight kind="comment">/// in MVE takes a GPR (integer) register, and the instruction that incorporate</Highlight></CodeLine>
<Link id="l07606" /><CodeLine lineNumber="7606"><Highlight kind="comment">/// a VDUP (such as a VADD qd, qm, rm) also require a gpr register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07607" /><CodeLine lineNumber="7607"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeShuffleVectorInst(ShuffleVectorInst &#42;SVI) &#123;</Highlight></CodeLine>
<Link id="l07608" /><CodeLine lineNumber="7608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Accept shuf(insertelem(undef/poison, val, 0), undef/poison, &lt;0,0,..&gt;) only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07609" /><CodeLine lineNumber="7609"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>()),</Highlight></CodeLine>
<Link id="l07610" /><CodeLine lineNumber="7610"><Highlight kind="normal">                            <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>(), m&#95;ZeroMask())))</Highlight></CodeLine>
<Link id="l07611" /><CodeLine lineNumber="7611"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07612" /><CodeLine lineNumber="7612"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;NewType = TLI-&gt;shouldConvertSplatType(SVI);</Highlight></CodeLine>
<Link id="l07613" /><CodeLine lineNumber="7613"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewType)</Highlight></CodeLine>
<Link id="l07614" /><CodeLine lineNumber="7614"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07615" /><CodeLine lineNumber="7615"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07616" /><CodeLine lineNumber="7616"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SVIVecType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SVI-&gt;<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</Highlight></CodeLine>
<Link id="l07617" /><CodeLine lineNumber="7617"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!NewType-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a scalar type!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07618" /><CodeLine lineNumber="7618"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == SVIVecType-&gt;getScalarSizeInBits() &amp;&amp;</Highlight></CodeLine>
<Link id="l07619" /><CodeLine lineNumber="7619"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expected a type of the same size!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07620" /><CodeLine lineNumber="7620"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewVecType =</Highlight></CodeLine>
<Link id="l07621" /><CodeLine lineNumber="7621"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(NewType, SVIVecType-&gt;getNumElements());</Highlight></CodeLine>
<Link id="l07622" /><CodeLine lineNumber="7622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07623" /><CodeLine lineNumber="7623"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a bitcast (shuffle (insert (bitcast(..))))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07624" /><CodeLine lineNumber="7624"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(SVI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l07625" /><CodeLine lineNumber="7625"><Highlight kind="normal">  Builder.SetInsertPoint(SVI);</Highlight></CodeLine>
<Link id="l07626" /><CodeLine lineNumber="7626"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BC1 = Builder.CreateBitCast(</Highlight></CodeLine>
<Link id="l07627" /><CodeLine lineNumber="7627"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(SVI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))-&gt;getOperand(1), NewType);</Highlight></CodeLine>
<Link id="l07628" /><CodeLine lineNumber="7628"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Shuffle = Builder.CreateVectorSplat(NewVecType-&gt;getNumElements(), BC1);</Highlight></CodeLine>
<Link id="l07629" /><CodeLine lineNumber="7629"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BC2 = Builder.CreateBitCast(Shuffle, SVIVecType);</Highlight></CodeLine>
<Link id="l07630" /><CodeLine lineNumber="7630"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07631" /><CodeLine lineNumber="7631"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(SVI, BC2, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l07632" /><CodeLine lineNumber="7632"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</Highlight></CodeLine>
<Link id="l07633" /><CodeLine lineNumber="7633"><Highlight kind="normal">      SVI, TLInfo, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l07634" /><CodeLine lineNumber="7634"><Highlight kind="normal">      &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</Highlight></CodeLine>
<Link id="l07635" /><CodeLine lineNumber="7635"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07636" /><CodeLine lineNumber="7636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Also hoist the bitcast up to its operand if it they are not in the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07637" /><CodeLine lineNumber="7637"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07638" /><CodeLine lineNumber="7638"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BC1))</Highlight></CodeLine>
<Link id="l07639" /><CodeLine lineNumber="7639"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BCI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</Highlight></CodeLine>
<Link id="l07640" /><CodeLine lineNumber="7640"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BCI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getParent() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l07641" /><CodeLine lineNumber="7641"><Highlight kind="normal">          !<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isTerminator() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l07642" /><CodeLine lineNumber="7642"><Highlight kind="normal">        BCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a54507f01d7d06127068ee0663233511d">moveAfter</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l07643" /><CodeLine lineNumber="7643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07644" /><CodeLine lineNumber="7644"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07645" /><CodeLine lineNumber="7645"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07646" /><CodeLine lineNumber="7646"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07647" /><CodeLine lineNumber="7647"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::tryToSinkFreeOperands(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l07648" /><CodeLine lineNumber="7648"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the operands of I can be folded into a target instruction together with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07649" /><CodeLine lineNumber="7649"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// I, duplicate and sink them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07650" /><CodeLine lineNumber="7650"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Use &#42;, 4&gt;</a> OpsToSink;</Highlight></CodeLine>
<Link id="l07651" /><CodeLine lineNumber="7651"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TTI-&gt;isProfitableToSinkOperands(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OpsToSink))</Highlight></CodeLine>
<Link id="l07652" /><CodeLine lineNumber="7652"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07653" /><CodeLine lineNumber="7653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07654" /><CodeLine lineNumber="7654"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// OpsToSink can contain multiple uses in a use chain (e.g.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07655" /><CodeLine lineNumber="7655"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (%u1 with %u1 = shufflevector), (%u2 with %u2 = zext %u1)). The dominating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07656" /><CodeLine lineNumber="7656"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// uses must come first, so we process the ops in reverse order so as to not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07657" /><CodeLine lineNumber="7657"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// create invalid IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07658" /><CodeLine lineNumber="7658"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TargetBB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l07659" /><CodeLine lineNumber="7659"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07660" /><CodeLine lineNumber="7660"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Use &#42;, 4&gt;</a> ToReplace;</Highlight></CodeLine>
<Link id="l07661" /><CodeLine lineNumber="7661"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;InsertPoint = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l07662" /><CodeLine lineNumber="7662"><Highlight kind="normal">  DenseMap&lt;const Instruction &#42;, unsigned long&gt; InstOrdering;</Highlight></CodeLine>
<Link id="l07663" /><CodeLine lineNumber="7663"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">long</Highlight><Highlight kind="normal"> InstNumber = 0;</Highlight></CodeLine>
<Link id="l07664" /><CodeLine lineNumber="7664"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;TargetBB)</Highlight></CodeLine>
<Link id="l07665" /><CodeLine lineNumber="7665"><Highlight kind="normal">    InstOrdering&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = InstNumber++;</Highlight></CodeLine>
<Link id="l07666" /><CodeLine lineNumber="7666"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07667" /><CodeLine lineNumber="7667"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Use &#42;U : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(OpsToSink)) &#123;</Highlight></CodeLine>
<Link id="l07668" /><CodeLine lineNumber="7668"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;get());</Highlight></CodeLine>
<Link id="l07669" /><CodeLine lineNumber="7669"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI))</Highlight></CodeLine>
<Link id="l07670" /><CodeLine lineNumber="7670"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07671" /><CodeLine lineNumber="7671"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == TargetBB) &#123;</Highlight></CodeLine>
<Link id="l07672" /><CodeLine lineNumber="7672"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InstOrdering&#91;UI&#93; &lt; InstOrdering&#91;InsertPoint&#93;)</Highlight></CodeLine>
<Link id="l07673" /><CodeLine lineNumber="7673"><Highlight kind="normal">        InsertPoint = UI;</Highlight></CodeLine>
<Link id="l07674" /><CodeLine lineNumber="7674"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07675" /><CodeLine lineNumber="7675"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07676" /><CodeLine lineNumber="7676"><Highlight kind="normal">    ToReplace.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(U);</Highlight></CodeLine>
<Link id="l07677" /><CodeLine lineNumber="7677"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07678" /><CodeLine lineNumber="7678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07679" /><CodeLine lineNumber="7679"><Highlight kind="normal">  SetVector&lt;Instruction &#42;&gt; MaybeDead;</Highlight></CodeLine>
<Link id="l07680" /><CodeLine lineNumber="7680"><Highlight kind="normal">  DenseMap&lt;Instruction &#42;, Instruction &#42;&gt; NewInstructions;</Highlight></CodeLine>
<Link id="l07681" /><CodeLine lineNumber="7681"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Use &#42;U : ToReplace) &#123;</Highlight></CodeLine>
<Link id="l07682" /><CodeLine lineNumber="7682"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;get());</Highlight></CodeLine>
<Link id="l07683" /><CodeLine lineNumber="7683"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;NI = UI-&gt;<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>();</Highlight></CodeLine>
<Link id="l07684" /><CodeLine lineNumber="7684"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07685" /><CodeLine lineNumber="7685"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>) &#123;</Highlight></CodeLine>
<Link id="l07686" /><CodeLine lineNumber="7686"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Now we clone an instruction, its operands&#39; defs may sink to this BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07687" /><CodeLine lineNumber="7687"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// now. So we put the operands defs&#39; BBs into FreshBBs to do optimization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07688" /><CodeLine lineNumber="7688"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : NI-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>())</Highlight></CodeLine>
<Link id="l07689" /><CodeLine lineNumber="7689"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpDef = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l07690" /><CodeLine lineNumber="7690"><Highlight kind="normal">          <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(OpDef-&gt;getParent());</Highlight></CodeLine>
<Link id="l07691" /><CodeLine lineNumber="7691"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07692" /><CodeLine lineNumber="7692"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07693" /><CodeLine lineNumber="7693"><Highlight kind="normal">    NewInstructions&#91;UI&#93; = NI;</Highlight></CodeLine>
<Link id="l07694" /><CodeLine lineNumber="7694"><Highlight kind="normal">    MaybeDead.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(UI);</Highlight></CodeLine>
<Link id="l07695" /><CodeLine lineNumber="7695"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Sinking &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;UI &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to user &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07696" /><CodeLine lineNumber="7696"><Highlight kind="normal">    NI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(InsertPoint-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l07697" /><CodeLine lineNumber="7697"><Highlight kind="normal">    InsertPoint = NI;</Highlight></CodeLine>
<Link id="l07698" /><CodeLine lineNumber="7698"><Highlight kind="normal">    InsertedInsts.insert(NI);</Highlight></CodeLine>
<Link id="l07699" /><CodeLine lineNumber="7699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07700" /><CodeLine lineNumber="7700"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update the use for the new instruction, making sure that we update the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07701" /><CodeLine lineNumber="7701"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// sunk instruction uses, if it is part of a chain that has already been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07702" /><CodeLine lineNumber="7702"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// sunk.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07703" /><CodeLine lineNumber="7703"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;OldI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getUser());</Highlight></CodeLine>
<Link id="l07704" /><CodeLine lineNumber="7704"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = NewInstructions.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(OldI); It != NewInstructions.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l07705" /><CodeLine lineNumber="7705"><Highlight kind="normal">      It-&gt;second-&gt;setOperand(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getOperandNo(), NI);</Highlight></CodeLine>
<Link id="l07706" /><CodeLine lineNumber="7706"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07707" /><CodeLine lineNumber="7707"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;set(NI);</Highlight></CodeLine>
<Link id="l07708" /><CodeLine lineNumber="7708"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07709" /><CodeLine lineNumber="7709"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07710" /><CodeLine lineNumber="7710"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07711" /><CodeLine lineNumber="7711"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove instructions that are dead after sinking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07712" /><CodeLine lineNumber="7712"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : MaybeDead) &#123;</Highlight></CodeLine>
<Link id="l07713" /><CodeLine lineNumber="7713"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasNUsesOrMore(1)) &#123;</Highlight></CodeLine>
<Link id="l07714" /><CodeLine lineNumber="7714"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Removing dead instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07715" /><CodeLine lineNumber="7715"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l07716" /><CodeLine lineNumber="7716"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07717" /><CodeLine lineNumber="7717"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07718" /><CodeLine lineNumber="7718"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07719" /><CodeLine lineNumber="7719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l07720" /><CodeLine lineNumber="7720"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07721" /><CodeLine lineNumber="7721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07722" /><CodeLine lineNumber="7722"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeSwitchType(SwitchInst &#42;SI) &#123;</Highlight></CodeLine>
<Link id="l07723" /><CodeLine lineNumber="7723"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition();</Highlight></CodeLine>
<Link id="l07724" /><CodeLine lineNumber="7724"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;OldType = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l07725" /><CodeLine lineNumber="7725"><Highlight kind="normal">  LLVMContext &amp;Context = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getContext();</Highlight></CodeLine>
<Link id="l07726" /><CodeLine lineNumber="7726"><Highlight kind="normal">  EVT OldVT = TLI-&gt;getValueType(&#42;DL, OldType);</Highlight></CodeLine>
<Link id="l07727" /><CodeLine lineNumber="7727"><Highlight kind="normal">  MVT RegType = TLI-&gt;getPreferredSwitchConditionType(Context, OldVT);</Highlight></CodeLine>
<Link id="l07728" /><CodeLine lineNumber="7728"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> RegWidth = RegType.<a href="/docs/api/classes/llvm/mvt/#a7be7c6dd92efc0d6f866d4a3b433eed0">getSizeInBits</a>();</Highlight></CodeLine>
<Link id="l07729" /><CodeLine lineNumber="7729"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07730" /><CodeLine lineNumber="7730"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RegWidth &lt;= <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(OldType)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>())</Highlight></CodeLine>
<Link id="l07731" /><CodeLine lineNumber="7731"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07732" /><CodeLine lineNumber="7732"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07733" /><CodeLine lineNumber="7733"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the register width is greater than the type width, expand the condition</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07734" /><CodeLine lineNumber="7734"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the switch instruction and each case constant to the width of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07735" /><CodeLine lineNumber="7735"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// register. By widening the type of the switch condition, subsequent</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07736" /><CodeLine lineNumber="7736"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// comparisons (for case comparisons) will not need to be extended to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07737" /><CodeLine lineNumber="7737"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// preferred register width, so we will potentially eliminate N-1 extends,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07738" /><CodeLine lineNumber="7738"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// where N is the number of cases in the switch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07739" /><CodeLine lineNumber="7739"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewType = Type::getIntNTy(Context, RegWidth);</Highlight></CodeLine>
<Link id="l07740" /><CodeLine lineNumber="7740"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07741" /><CodeLine lineNumber="7741"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Extend the switch condition and case constants using the target preferred</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07742" /><CodeLine lineNumber="7742"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extend unless the switch condition is a function argument with an extend</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07743" /><CodeLine lineNumber="7743"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// attribute. In that case, we can avoid an unnecessary mask/extension by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07744" /><CodeLine lineNumber="7744"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// matching the argument extension instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07745" /><CodeLine lineNumber="7745"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::ZExt;</Highlight></CodeLine>
<Link id="l07746" /><CodeLine lineNumber="7746"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Some targets prefer SExt over ZExt.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07747" /><CodeLine lineNumber="7747"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI-&gt;isSExtCheaperThanZExt(OldVT, RegType))</Highlight></CodeLine>
<Link id="l07748" /><CodeLine lineNumber="7748"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::SExt;</Highlight></CodeLine>
<Link id="l07749" /><CodeLine lineNumber="7749"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07750" /><CodeLine lineNumber="7750"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Arg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l07751" /><CodeLine lineNumber="7751"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Arg-&gt;hasSExtAttr())</Highlight></CodeLine>
<Link id="l07752" /><CodeLine lineNumber="7752"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::SExt;</Highlight></CodeLine>
<Link id="l07753" /><CodeLine lineNumber="7753"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Arg-&gt;hasZExtAttr())</Highlight></CodeLine>
<Link id="l07754" /><CodeLine lineNumber="7754"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::ZExt;</Highlight></CodeLine>
<Link id="l07755" /><CodeLine lineNumber="7755"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07756" /><CodeLine lineNumber="7756"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07757" /><CodeLine lineNumber="7757"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtInst = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NewType);</Highlight></CodeLine>
<Link id="l07758" /><CodeLine lineNumber="7758"><Highlight kind="normal">  ExtInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l07759" /><CodeLine lineNumber="7759"><Highlight kind="normal">  ExtInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l07760" /><CodeLine lineNumber="7760"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;setCondition(ExtInst);</Highlight></CodeLine>
<Link id="l07761" /><CodeLine lineNumber="7761"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Case : <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;cases()) &#123;</Highlight></CodeLine>
<Link id="l07762" /><CodeLine lineNumber="7762"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> APInt &amp;NarrowConst = Case.getCaseValue()-&gt;getValue();</Highlight></CodeLine>
<Link id="l07763" /><CodeLine lineNumber="7763"><Highlight kind="normal">    APInt WideConst = (<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> == Instruction::ZExt)</Highlight></CodeLine>
<Link id="l07764" /><CodeLine lineNumber="7764"><Highlight kind="normal">                          ? NarrowConst.<a href="/docs/api/classes/llvm/apint/#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(RegWidth)</Highlight></CodeLine>
<Link id="l07765" /><CodeLine lineNumber="7765"><Highlight kind="normal">                          : NarrowConst.<a href="/docs/api/classes/llvm/apint/#aca8fce65eb69a82aa10a635e2e79877a">sext</a>(RegWidth);</Highlight></CodeLine>
<Link id="l07766" /><CodeLine lineNumber="7766"><Highlight kind="normal">    Case.setValue(ConstantInt::get(Context, WideConst));</Highlight></CodeLine>
<Link id="l07767" /><CodeLine lineNumber="7767"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07768" /><CodeLine lineNumber="7768"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07769" /><CodeLine lineNumber="7769"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07770" /><CodeLine lineNumber="7770"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07771" /><CodeLine lineNumber="7771"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07772" /><CodeLine lineNumber="7772"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeSwitchPhiConstants(SwitchInst &#42;SI) &#123;</Highlight></CodeLine>
<Link id="l07773" /><CodeLine lineNumber="7773"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The SCCP optimization tends to produce code like this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07774" /><CodeLine lineNumber="7774"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   switch(x) &#123; case 42: phi(42, ...) &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07775" /><CodeLine lineNumber="7775"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Materializing the constant for the phi-argument needs instructions; So we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07776" /><CodeLine lineNumber="7776"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// change the code to:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07777" /><CodeLine lineNumber="7777"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   switch(x) &#123; case 42: phi(x, ...) &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07778" /><CodeLine lineNumber="7778"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07779" /><CodeLine lineNumber="7779"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Condition = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition();</Highlight></CodeLine>
<Link id="l07780" /><CodeLine lineNumber="7780"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Avoid endless loop in degenerate case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07781" /><CodeLine lineNumber="7781"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(&#42;Condition))</Highlight></CodeLine>
<Link id="l07782" /><CodeLine lineNumber="7782"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07783" /><CodeLine lineNumber="7783"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07784" /><CodeLine lineNumber="7784"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07785" /><CodeLine lineNumber="7785"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;SwitchBB = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l07786" /><CodeLine lineNumber="7786"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ConditionType = Condition-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l07787" /><CodeLine lineNumber="7787"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07788" /><CodeLine lineNumber="7788"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SwitchInst::CaseHandle &amp;Case : <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;cases()) &#123;</Highlight></CodeLine>
<Link id="l07789" /><CodeLine lineNumber="7789"><Highlight kind="normal">    ConstantInt &#42;CaseValue = Case.getCaseValue();</Highlight></CodeLine>
<Link id="l07790" /><CodeLine lineNumber="7790"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CaseBB = Case.getCaseSuccessor();</Highlight></CodeLine>
<Link id="l07791" /><CodeLine lineNumber="7791"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Set to true if we previously checked that &#96;CaseBB&#96; is only reached by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07792" /><CodeLine lineNumber="7792"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a single case from this switch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07793" /><CodeLine lineNumber="7793"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CheckedForSinglePred = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07794" /><CodeLine lineNumber="7794"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (PHINode &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : CaseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l07795" /><CodeLine lineNumber="7795"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PHIType = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getType();</Highlight></CodeLine>
<Link id="l07796" /><CodeLine lineNumber="7796"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If ZExt is free then we can also catch patterns like this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07797" /><CodeLine lineNumber="7797"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   switch((i32)x) &#123; case 42: phi((i64)42, ...); &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07798" /><CodeLine lineNumber="7798"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// and replace &#96;(i64)42&#96; with &#96;zext i32 %x to i64&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07799" /><CodeLine lineNumber="7799"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> TryZExt =</Highlight></CodeLine>
<Link id="l07800" /><CodeLine lineNumber="7800"><Highlight kind="normal">          PHIType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l07801" /><CodeLine lineNumber="7801"><Highlight kind="normal">          PHIType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt; ConditionType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l07802" /><CodeLine lineNumber="7802"><Highlight kind="normal">          TLI-&gt;isZExtFree(ConditionType, PHIType);</Highlight></CodeLine>
<Link id="l07803" /><CodeLine lineNumber="7803"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHIType == ConditionType || TryZExt) &#123;</Highlight></CodeLine>
<Link id="l07804" /><CodeLine lineNumber="7804"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Set to true to skip this case because of multiple preds.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07805" /><CodeLine lineNumber="7805"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> SkipCase = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07806" /><CodeLine lineNumber="7806"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Replacement = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07807" /><CodeLine lineNumber="7807"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</Highlight></CodeLine>
<Link id="l07808" /><CodeLine lineNumber="7808"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PHIValue = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07809" /><CodeLine lineNumber="7809"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHIValue != CaseValue) &#123;</Highlight></CodeLine>
<Link id="l07810" /><CodeLine lineNumber="7810"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TryZExt)</Highlight></CodeLine>
<Link id="l07811" /><CodeLine lineNumber="7811"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07812" /><CodeLine lineNumber="7812"><Highlight kind="normal">            ConstantInt &#42;PHIValueInt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(PHIValue);</Highlight></CodeLine>
<Link id="l07813" /><CodeLine lineNumber="7813"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PHIValueInt ||</Highlight></CodeLine>
<Link id="l07814" /><CodeLine lineNumber="7814"><Highlight kind="normal">                PHIValueInt-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() !=</Highlight></CodeLine>
<Link id="l07815" /><CodeLine lineNumber="7815"><Highlight kind="normal">                    CaseValue-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(PHIType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()))</Highlight></CodeLine>
<Link id="l07816" /><CodeLine lineNumber="7816"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07817" /><CodeLine lineNumber="7817"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l07818" /><CodeLine lineNumber="7818"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != SwitchBB)</Highlight></CodeLine>
<Link id="l07819" /><CodeLine lineNumber="7819"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07820" /><CodeLine lineNumber="7820"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We cannot optimize if there are multiple case labels jumping to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07821" /><CodeLine lineNumber="7821"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// this block.  This check may get expensive when there are many</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07822" /><CodeLine lineNumber="7822"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// case labels so we test for it last.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07823" /><CodeLine lineNumber="7823"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CheckedForSinglePred) &#123;</Highlight></CodeLine>
<Link id="l07824" /><CodeLine lineNumber="7824"><Highlight kind="normal">            CheckedForSinglePred = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07825" /><CodeLine lineNumber="7825"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;findCaseDest(CaseBB) == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l07826" /><CodeLine lineNumber="7826"><Highlight kind="normal">              SkipCase = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07827" /><CodeLine lineNumber="7827"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07828" /><CodeLine lineNumber="7828"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l07829" /><CodeLine lineNumber="7829"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l07830" /><CodeLine lineNumber="7830"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07831" /><CodeLine lineNumber="7831"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Replacement == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l07832" /><CodeLine lineNumber="7832"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHIValue == CaseValue) &#123;</Highlight></CodeLine>
<Link id="l07833" /><CodeLine lineNumber="7833"><Highlight kind="normal">              Replacement = Condition;</Highlight></CodeLine>
<Link id="l07834" /><CodeLine lineNumber="7834"><Highlight kind="normal">            &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l07835" /><CodeLine lineNumber="7835"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(SI);</Highlight></CodeLine>
<Link id="l07836" /><CodeLine lineNumber="7836"><Highlight kind="normal">              Replacement = Builder.CreateZExt(Condition, PHIType);</Highlight></CodeLine>
<Link id="l07837" /><CodeLine lineNumber="7837"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l07838" /><CodeLine lineNumber="7838"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l07839" /><CodeLine lineNumber="7839"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.setIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Replacement);</Highlight></CodeLine>
<Link id="l07840" /><CodeLine lineNumber="7840"><Highlight kind="normal">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07841" /><CodeLine lineNumber="7841"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l07842" /><CodeLine lineNumber="7842"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SkipCase)</Highlight></CodeLine>
<Link id="l07843" /><CodeLine lineNumber="7843"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07844" /><CodeLine lineNumber="7844"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07845" /><CodeLine lineNumber="7845"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07846" /><CodeLine lineNumber="7846"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07847" /><CodeLine lineNumber="7847"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l07848" /><CodeLine lineNumber="7848"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07849" /><CodeLine lineNumber="7849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07850" /><CodeLine lineNumber="7850"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeSwitchInst(SwitchInst &#42;SI) &#123;</Highlight></CodeLine>
<Link id="l07851" /><CodeLine lineNumber="7851"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = optimizeSwitchType(SI);</Highlight></CodeLine>
<Link id="l07852" /><CodeLine lineNumber="7852"><Highlight kind="normal">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= optimizeSwitchPhiConstants(SI);</Highlight></CodeLine>
<Link id="l07853" /><CodeLine lineNumber="7853"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l07854" /><CodeLine lineNumber="7854"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07855" /><CodeLine lineNumber="7855"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07856" /><CodeLine lineNumber="7856"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07857" /><CodeLine lineNumber="7857"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07858" /><CodeLine lineNumber="7858"><Highlight kind="comment">/// Helper class to promote a scalar operation to a vector one.</Highlight></CodeLine>
<Link id="l07859" /><CodeLine lineNumber="7859"><Highlight kind="comment">/// This class is used to move downward extractelement transition.</Highlight></CodeLine>
<Link id="l07860" /><CodeLine lineNumber="7860"><Highlight kind="comment">/// E.g.,</Highlight></CodeLine>
<Link id="l07861" /><CodeLine lineNumber="7861"><Highlight kind="comment">/// a = vector&#95;op &lt;2 x i32&gt;</Highlight></CodeLine>
<Link id="l07862" /><CodeLine lineNumber="7862"><Highlight kind="comment">/// b = extractelement &lt;2 x i32&gt; a, i32 0</Highlight></CodeLine>
<Link id="l07863" /><CodeLine lineNumber="7863"><Highlight kind="comment">/// c = scalar&#95;op b</Highlight></CodeLine>
<Link id="l07864" /><CodeLine lineNumber="7864"><Highlight kind="comment">/// store c</Highlight></CodeLine>
<Link id="l07865" /><CodeLine lineNumber="7865"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l07866" /><CodeLine lineNumber="7866"><Highlight kind="comment">/// =&gt;</Highlight></CodeLine>
<Link id="l07867" /><CodeLine lineNumber="7867"><Highlight kind="comment">/// a = vector&#95;op &lt;2 x i32&gt;</Highlight></CodeLine>
<Link id="l07868" /><CodeLine lineNumber="7868"><Highlight kind="comment">/// c = vector&#95;op a (equivalent to scalar&#95;op on the related lane)</Highlight></CodeLine>
<Link id="l07869" /><CodeLine lineNumber="7869"><Highlight kind="comment">/// &#42; d = extractelement &lt;2 x i32&gt; c, i32 0</Highlight></CodeLine>
<Link id="l07870" /><CodeLine lineNumber="7870"><Highlight kind="comment">/// &#42; store d</Highlight></CodeLine>
<Link id="l07871" /><CodeLine lineNumber="7871"><Highlight kind="comment">/// Assuming both extractelement and store can be combine, we get rid of the</Highlight></CodeLine>
<Link id="l07872" /><CodeLine lineNumber="7872"><Highlight kind="comment">/// transition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07873" /><CodeLine lineNumber="7873" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a07696175d8a3e65a0c79186f2ec8a58a">VectorPromoteHelper</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07874" /><CodeLine lineNumber="7874"><Highlight kind="comment">  /// DataLayout associated with the current module.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07875" /><CodeLine lineNumber="7875"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</Highlight></CodeLine>
<Link id="l07876" /><CodeLine lineNumber="7876"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07877" /><CodeLine lineNumber="7877"><Highlight kind="comment">  /// Used to perform some checks on the legality of vector operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07878" /><CodeLine lineNumber="7878"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI;</Highlight></CodeLine>
<Link id="l07879" /><CodeLine lineNumber="7879"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07880" /><CodeLine lineNumber="7880"><Highlight kind="comment">  /// Used to estimated the cost of the promoted chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07881" /><CodeLine lineNumber="7881"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI;</Highlight></CodeLine>
<Link id="l07882" /><CodeLine lineNumber="7882"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07883" /><CodeLine lineNumber="7883"><Highlight kind="comment">  /// The transition being moved downwards.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07884" /><CodeLine lineNumber="7884"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Transition;</Highlight></CodeLine>
<Link id="l07885" /><CodeLine lineNumber="7885"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07886" /><CodeLine lineNumber="7886"><Highlight kind="comment">  /// The sequence of instructions to be promoted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07887" /><CodeLine lineNumber="7887"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> InstsToBePromoted;</Highlight></CodeLine>
<Link id="l07888" /><CodeLine lineNumber="7888"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07889" /><CodeLine lineNumber="7889"><Highlight kind="comment">  /// Cost of combining a store and an extract.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07890" /><CodeLine lineNumber="7890"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> StoreExtractCombineCost;</Highlight></CodeLine>
<Link id="l07891" /><CodeLine lineNumber="7891"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07892" /><CodeLine lineNumber="7892"><Highlight kind="comment">  /// Instruction that will be combined with the transition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07893" /><CodeLine lineNumber="7893"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CombineInst = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07894" /><CodeLine lineNumber="7894"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07895" /><CodeLine lineNumber="7895"><Highlight kind="comment">  /// The instruction that represents the current end of the transition.</Highlight></CodeLine>
<Link id="l07896" /><CodeLine lineNumber="7896"><Highlight kind="comment">  /// Since we are faking the promotion until we reach the end of the chain</Highlight></CodeLine>
<Link id="l07897" /><CodeLine lineNumber="7897"><Highlight kind="comment">  /// of computation, we need a way to get the current end of the transition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07898" /><CodeLine lineNumber="7898"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;getEndOfTransition()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07899" /><CodeLine lineNumber="7899"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InstsToBePromoted.empty())</Highlight></CodeLine>
<Link id="l07900" /><CodeLine lineNumber="7900"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Transition;</Highlight></CodeLine>
<Link id="l07901" /><CodeLine lineNumber="7901"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> InstsToBePromoted.back();</Highlight></CodeLine>
<Link id="l07902" /><CodeLine lineNumber="7902"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07903" /><CodeLine lineNumber="7903"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07904" /><CodeLine lineNumber="7904"><Highlight kind="comment">  /// Return the index of the original value in the transition.</Highlight></CodeLine>
<Link id="l07905" /><CodeLine lineNumber="7905"><Highlight kind="comment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 1&quot; the original value,</Highlight></CodeLine>
<Link id="l07906" /><CodeLine lineNumber="7906"><Highlight kind="comment">  /// c, is at index 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07907" /><CodeLine lineNumber="7907"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> getTransitionOriginalValueIdx()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07908" /><CodeLine lineNumber="7908"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(Transition) &amp;&amp;</Highlight></CodeLine>
<Link id="l07909" /><CodeLine lineNumber="7909"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Other kind of transitions are not supported yet&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07910" /><CodeLine lineNumber="7910"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l07911" /><CodeLine lineNumber="7911"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07912" /><CodeLine lineNumber="7912"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07913" /><CodeLine lineNumber="7913"><Highlight kind="comment">  /// Return the index of the index in the transition.</Highlight></CodeLine>
<Link id="l07914" /><CodeLine lineNumber="7914"><Highlight kind="comment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 0&quot; the index</Highlight></CodeLine>
<Link id="l07915" /><CodeLine lineNumber="7915"><Highlight kind="comment">  /// is at index 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07916" /><CodeLine lineNumber="7916"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> getTransitionIdx()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07917" /><CodeLine lineNumber="7917"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(Transition) &amp;&amp;</Highlight></CodeLine>
<Link id="l07918" /><CodeLine lineNumber="7918"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Other kind of transitions are not supported yet&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07919" /><CodeLine lineNumber="7919"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l07920" /><CodeLine lineNumber="7920"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07921" /><CodeLine lineNumber="7921"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07922" /><CodeLine lineNumber="7922"><Highlight kind="comment">  /// Get the type of the transition.</Highlight></CodeLine>
<Link id="l07923" /><CodeLine lineNumber="7923"><Highlight kind="comment">  /// This is the type of the original value.</Highlight></CodeLine>
<Link id="l07924" /><CodeLine lineNumber="7924"><Highlight kind="comment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 1&quot; the type of the</Highlight></CodeLine>
<Link id="l07925" /><CodeLine lineNumber="7925"><Highlight kind="comment">  /// transition is &lt;2 x i32&gt;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07926" /><CodeLine lineNumber="7926"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;getTransitionType()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07927" /><CodeLine lineNumber="7927"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Transition-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(getTransitionOriginalValueIdx())-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l07928" /><CodeLine lineNumber="7928"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07929" /><CodeLine lineNumber="7929"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07930" /><CodeLine lineNumber="7930"><Highlight kind="comment">  /// Promote \\p ToBePromoted by moving \\p Def downward through.</Highlight></CodeLine>
<Link id="l07931" /><CodeLine lineNumber="7931"><Highlight kind="comment">  /// I.e., we have the following sequence:</Highlight></CodeLine>
<Link id="l07932" /><CodeLine lineNumber="7932"><Highlight kind="comment">  /// Def = Transition &lt;ty1&gt; a to &lt;ty2&gt;</Highlight></CodeLine>
<Link id="l07933" /><CodeLine lineNumber="7933"><Highlight kind="comment">  /// b = ToBePromoted &lt;ty2&gt; Def, ...</Highlight></CodeLine>
<Link id="l07934" /><CodeLine lineNumber="7934"><Highlight kind="comment">  /// =&gt;</Highlight></CodeLine>
<Link id="l07935" /><CodeLine lineNumber="7935"><Highlight kind="comment">  /// b = ToBePromoted &lt;ty1&gt; a, ...</Highlight></CodeLine>
<Link id="l07936" /><CodeLine lineNumber="7936"><Highlight kind="comment">  /// Def = Transition &lt;ty1&gt; ToBePromoted to &lt;ty2&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07937" /><CodeLine lineNumber="7937"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> promoteImpl(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted);</Highlight></CodeLine>
<Link id="l07938" /><CodeLine lineNumber="7938"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07939" /><CodeLine lineNumber="7939"><Highlight kind="comment">  /// Check whether or not it is profitable to promote all the</Highlight></CodeLine>
<Link id="l07940" /><CodeLine lineNumber="7940"><Highlight kind="comment">  /// instructions enqueued to be promoted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07941" /><CodeLine lineNumber="7941"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isProfitableToPromote() &#123;</Highlight></CodeLine>
<Link id="l07942" /><CodeLine lineNumber="7942"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValIdx = Transition-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(getTransitionOriginalValueIdx());</Highlight></CodeLine>
<Link id="l07943" /><CodeLine lineNumber="7943"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Index = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(ValIdx)</Highlight></CodeLine>
<Link id="l07944" /><CodeLine lineNumber="7944"><Highlight kind="normal">                         ? <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(ValIdx)-&gt;getZExtValue()</Highlight></CodeLine>
<Link id="l07945" /><CodeLine lineNumber="7945"><Highlight kind="normal">                         : -1;</Highlight></CodeLine>
<Link id="l07946" /><CodeLine lineNumber="7946"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;PromotedType = getTransitionType();</Highlight></CodeLine>
<Link id="l07947" /><CodeLine lineNumber="7947"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07948" /><CodeLine lineNumber="7948"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;ST = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(CombineInst);</Highlight></CodeLine>
<Link id="l07949" /><CodeLine lineNumber="7949"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = ST-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l07950" /><CodeLine lineNumber="7950"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if this store is supported.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07951" /><CodeLine lineNumber="7951"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI.allowsMisalignedMemoryAccesses(</Highlight></CodeLine>
<Link id="l07952" /><CodeLine lineNumber="7952"><Highlight kind="normal">            TLI.getValueType(DL, ST-&gt;getValueOperand()-&gt;getType()), AS,</Highlight></CodeLine>
<Link id="l07953" /><CodeLine lineNumber="7953"><Highlight kind="normal">            ST-&gt;getAlign())) &#123;</Highlight></CodeLine>
<Link id="l07954" /><CodeLine lineNumber="7954"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is not supported, there is no way we can combine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07955" /><CodeLine lineNumber="7955"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the extract with the store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07956" /><CodeLine lineNumber="7956"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07957" /><CodeLine lineNumber="7957"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07958" /><CodeLine lineNumber="7958"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07959" /><CodeLine lineNumber="7959"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The scalar chain of computation has to pay for the transition</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07960" /><CodeLine lineNumber="7960"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalar to vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07961" /><CodeLine lineNumber="7961"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The vector chain has to account for the combining cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07962" /><CodeLine lineNumber="7962"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">enum</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a> =</Highlight></CodeLine>
<Link id="l07963" /><CodeLine lineNumber="7963"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TargetTransformInfo::TCK&#95;RecipThroughput</a>;</Highlight></CodeLine>
<Link id="l07964" /><CodeLine lineNumber="7964"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost =</Highlight></CodeLine>
<Link id="l07965" /><CodeLine lineNumber="7965"><Highlight kind="normal">        TTI.getVectorInstrCost(&#42;Transition, PromotedType, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>, Index);</Highlight></CodeLine>
<Link id="l07966" /><CodeLine lineNumber="7966"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> VectorCost = StoreExtractCombineCost;</Highlight></CodeLine>
<Link id="l07967" /><CodeLine lineNumber="7967"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Inst : InstsToBePromoted) &#123;</Highlight></CodeLine>
<Link id="l07968" /><CodeLine lineNumber="7968"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Compute the cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07969" /><CodeLine lineNumber="7969"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// By construction, all instructions being promoted are arithmetic ones.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07970" /><CodeLine lineNumber="7970"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Moreover, one argument is a constant that can be viewed as a splat</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07971" /><CodeLine lineNumber="7971"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07972" /><CodeLine lineNumber="7972"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg0 = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l07973" /><CodeLine lineNumber="7973"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsArg0Constant = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Arg0) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Arg0) ||</Highlight></CodeLine>
<Link id="l07974" /><CodeLine lineNumber="7974"><Highlight kind="normal">                            <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Arg0);</Highlight></CodeLine>
<Link id="l07975" /><CodeLine lineNumber="7975"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo">TargetTransformInfo::OperandValueInfo</a> Arg0Info, Arg1Info;</Highlight></CodeLine>
<Link id="l07976" /><CodeLine lineNumber="7976"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsArg0Constant)</Highlight></CodeLine>
<Link id="l07977" /><CodeLine lineNumber="7977"><Highlight kind="normal">        Arg0Info.<a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo/#a930b0b2be537d928348aa0946f61dcd6">Kind</a> = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca76d8855d96b8e66b9411ed74737ca8f7">TargetTransformInfo::OK&#95;UniformConstantValue</a>;</Highlight></CodeLine>
<Link id="l07978" /><CodeLine lineNumber="7978"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07979" /><CodeLine lineNumber="7979"><Highlight kind="normal">        Arg1Info.<a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo/#a930b0b2be537d928348aa0946f61dcd6">Kind</a> = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca76d8855d96b8e66b9411ed74737ca8f7">TargetTransformInfo::OK&#95;UniformConstantValue</a>;</Highlight></CodeLine>
<Link id="l07980" /><CodeLine lineNumber="7980"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07981" /><CodeLine lineNumber="7981"><Highlight kind="normal">      ScalarCost += TTI.getArithmeticInstrCost(</Highlight></CodeLine>
<Link id="l07982" /><CodeLine lineNumber="7982"><Highlight kind="normal">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>, Arg0Info, Arg1Info);</Highlight></CodeLine>
<Link id="l07983" /><CodeLine lineNumber="7983"><Highlight kind="normal">      VectorCost += TTI.getArithmeticInstrCost(Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), PromotedType,</Highlight></CodeLine>
<Link id="l07984" /><CodeLine lineNumber="7984"><Highlight kind="normal">                                               <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>, Arg0Info, Arg1Info);</Highlight></CodeLine>
<Link id="l07985" /><CodeLine lineNumber="7985"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07986" /><CodeLine lineNumber="7986"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l07987" /><CodeLine lineNumber="7987"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Estimated cost of computation to be promoted:\\nScalar: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07988" /><CodeLine lineNumber="7988"><Highlight kind="normal">               &lt;&lt; ScalarCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\nVector: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VectorCost &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07989" /><CodeLine lineNumber="7989"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ScalarCost &gt; VectorCost;</Highlight></CodeLine>
<Link id="l07990" /><CodeLine lineNumber="7990"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07991" /><CodeLine lineNumber="7991"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07992" /><CodeLine lineNumber="7992"><Highlight kind="comment">  /// Generate a constant vector with \\p Val with the same</Highlight></CodeLine>
<Link id="l07993" /><CodeLine lineNumber="7993"><Highlight kind="comment">  /// number of elements as the transition.</Highlight></CodeLine>
<Link id="l07994" /><CodeLine lineNumber="7994"><Highlight kind="comment">  /// \\p UseSplat defines whether or not \\p Val should be replicated</Highlight></CodeLine>
<Link id="l07995" /><CodeLine lineNumber="7995"><Highlight kind="comment">  /// across the whole vector.</Highlight></CodeLine>
<Link id="l07996" /><CodeLine lineNumber="7996"><Highlight kind="comment">  /// In other words, if UseSplat == true, we generate &lt;Val, Val, ..., Val&gt;,</Highlight></CodeLine>
<Link id="l07997" /><CodeLine lineNumber="7997"><Highlight kind="comment">  /// otherwise we generate a vector with as many poison as possible:</Highlight></CodeLine>
<Link id="l07998" /><CodeLine lineNumber="7998"><Highlight kind="comment">  /// &lt;poison, ..., poison, Val, poison, ..., poison&gt; where \\p Val is only</Highlight></CodeLine>
<Link id="l07999" /><CodeLine lineNumber="7999"><Highlight kind="comment">  /// used at the index of the extract.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08000" /><CodeLine lineNumber="8000"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;getConstantVector(<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Val, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UseSplat)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l08001" /><CodeLine lineNumber="8001"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExtractIdx = std::numeric&#95;limits&lt;unsigned&gt;::max();</Highlight></CodeLine>
<Link id="l08002" /><CodeLine lineNumber="8002"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UseSplat) &#123;</Highlight></CodeLine>
<Link id="l08003" /><CodeLine lineNumber="8003"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we cannot determine where the constant must be, we have to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08004" /><CodeLine lineNumber="8004"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// use a splat constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08005" /><CodeLine lineNumber="8005"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValExtractIdx = Transition-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(getTransitionIdx());</Highlight></CodeLine>
<Link id="l08006" /><CodeLine lineNumber="8006"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CstVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(ValExtractIdx))</Highlight></CodeLine>
<Link id="l08007" /><CodeLine lineNumber="8007"><Highlight kind="normal">        ExtractIdx = CstVal-&gt;<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>();</Highlight></CodeLine>
<Link id="l08008" /><CodeLine lineNumber="8008"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08009" /><CodeLine lineNumber="8009"><Highlight kind="normal">        UseSplat = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08010" /><CodeLine lineNumber="8010"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08011" /><CodeLine lineNumber="8011"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08012" /><CodeLine lineNumber="8012"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(getTransitionType())-&gt;getElementCount();</Highlight></CodeLine>
<Link id="l08013" /><CodeLine lineNumber="8013"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseSplat)</Highlight></CodeLine>
<Link id="l08014" /><CodeLine lineNumber="8014"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantvector/#aa3b241b35b0039b413faf1ef4e873eb7">ConstantVector::getSplat</a>(EC, Val);</Highlight></CodeLine>
<Link id="l08015" /><CodeLine lineNumber="8015"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08016" /><CodeLine lineNumber="8016"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EC.isScalable()) &#123;</Highlight></CodeLine>
<Link id="l08017" /><CodeLine lineNumber="8017"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 4&gt;</a> ConstVec;</Highlight></CodeLine>
<Link id="l08018" /><CodeLine lineNumber="8018"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/poisonvalue">PoisonValue</a> &#42;PoisonVal = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Val-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l08019" /><CodeLine lineNumber="8019"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0; Idx != EC.getKnownMinValue(); ++Idx) &#123;</Highlight></CodeLine>
<Link id="l08020" /><CodeLine lineNumber="8020"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Idx == ExtractIdx)</Highlight></CodeLine>
<Link id="l08021" /><CodeLine lineNumber="8021"><Highlight kind="normal">          ConstVec.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Val);</Highlight></CodeLine>
<Link id="l08022" /><CodeLine lineNumber="8022"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08023" /><CodeLine lineNumber="8023"><Highlight kind="normal">          ConstVec.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PoisonVal);</Highlight></CodeLine>
<Link id="l08024" /><CodeLine lineNumber="8024"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08025" /><CodeLine lineNumber="8025"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantvector/#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(ConstVec);</Highlight></CodeLine>
<Link id="l08026" /><CodeLine lineNumber="8026"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08027" /><CodeLine lineNumber="8027"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight></CodeLine>
<Link id="l08028" /><CodeLine lineNumber="8028"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Generate scalable vector for non-splat is unimplemented&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08029" /><CodeLine lineNumber="8029"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08030" /><CodeLine lineNumber="8030"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08031" /><CodeLine lineNumber="8031"><Highlight kind="comment">  /// Check if promoting to a vector type an operand at \\p OperandIdx</Highlight></CodeLine>
<Link id="l08032" /><CodeLine lineNumber="8032"><Highlight kind="comment">  /// in \\p Use can trigger undefined behavior.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08033" /><CodeLine lineNumber="8033"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> canCauseUndefinedBehavior(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/use">Use</a>,</Highlight></CodeLine>
<Link id="l08034" /><CodeLine lineNumber="8034"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OperandIdx) &#123;</Highlight></CodeLine>
<Link id="l08035" /><CodeLine lineNumber="8035"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This is not safe to introduce undef when the operand is on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08036" /><CodeLine lineNumber="8036"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the right hand side of a division-like instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08037" /><CodeLine lineNumber="8037"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OperandIdx != 1)</Highlight></CodeLine>
<Link id="l08038" /><CodeLine lineNumber="8038"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08039" /><CodeLine lineNumber="8039"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l08040" /><CodeLine lineNumber="8040"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l08041" /><CodeLine lineNumber="8041"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08042" /><CodeLine lineNumber="8042"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l08043" /><CodeLine lineNumber="8043"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l08044" /><CodeLine lineNumber="8044"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l08045" /><CodeLine lineNumber="8045"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l08046" /><CodeLine lineNumber="8046"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08047" /><CodeLine lineNumber="8047"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FDiv:</Highlight></CodeLine>
<Link id="l08048" /><CodeLine lineNumber="8048"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FRem:</Highlight></CodeLine>
<Link id="l08049" /><CodeLine lineNumber="8049"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/classes/llvm/use">Use</a>-&gt;hasNoNaNs();</Highlight></CodeLine>
<Link id="l08050" /><CodeLine lineNumber="8050"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08051" /><CodeLine lineNumber="8051"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08052" /><CodeLine lineNumber="8052"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08053" /><CodeLine lineNumber="8053"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08054" /><CodeLine lineNumber="8054"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l08055" /><CodeLine lineNumber="8055" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a07696175d8a3e65a0c79186f2ec8a58a"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a07696175d8a3e65a0c79186f2ec8a58a">VectorPromoteHelper</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l08056" /><CodeLine lineNumber="8056"><Highlight kind="normal">                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Transition,</Highlight></CodeLine>
<Link id="l08057" /><CodeLine lineNumber="8057"><Highlight kind="normal">                      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CombineCost)</Highlight></CodeLine>
<Link id="l08058" /><CodeLine lineNumber="8058"><Highlight kind="normal">      : DL(DL), TLI(TLI), TTI(TTI), Transition(Transition),</Highlight></CodeLine>
<Link id="l08059" /><CodeLine lineNumber="8059"><Highlight kind="normal">        StoreExtractCombineCost(CombineCost) &#123;</Highlight></CodeLine>
<Link id="l08060" /><CodeLine lineNumber="8060"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Transition &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Do not know how to promote null&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08061" /><CodeLine lineNumber="8061"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08062" /><CodeLine lineNumber="8062"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08063" /><CodeLine lineNumber="8063"><Highlight kind="comment">  /// Check if we can promote \\p ToBePromoted to \\p Type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08064" /><CodeLine lineNumber="8064" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a6bb4d1b66785c3b2bb7204fa7b13b559"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a6bb4d1b66785c3b2bb7204fa7b13b559">canPromote</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l08065" /><CodeLine lineNumber="8065"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We could support CastInst too.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08066" /><CodeLine lineNumber="8066"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(ToBePromoted);</Highlight></CodeLine>
<Link id="l08067" /><CodeLine lineNumber="8067"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08068" /><CodeLine lineNumber="8068"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08069" /><CodeLine lineNumber="8069"><Highlight kind="comment">  /// Check if it is profitable to promote \\p ToBePromoted</Highlight></CodeLine>
<Link id="l08070" /><CodeLine lineNumber="8070"><Highlight kind="comment">  /// by moving downward the transition through.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08071" /><CodeLine lineNumber="8071" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#aa46482c59b5d71b890df4cfaada1e6c7"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#aa46482c59b5d71b890df4cfaada1e6c7">shouldPromote</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l08072" /><CodeLine lineNumber="8072"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Promote only if all the operands can be statically expanded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08073" /><CodeLine lineNumber="8073"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Indeed, we do not want to introduce any new kind of transitions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08074" /><CodeLine lineNumber="8074"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;U : ToBePromoted-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</Highlight></CodeLine>
<Link id="l08075" /><CodeLine lineNumber="8075"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = U.get();</Highlight></CodeLine>
<Link id="l08076" /><CodeLine lineNumber="8076"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Val == getEndOfTransition()) &#123;</Highlight></CodeLine>
<Link id="l08077" /><CodeLine lineNumber="8077"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the use is a division and the transition is on the rhs,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08078" /><CodeLine lineNumber="8078"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// we cannot promote the operation, otherwise we may create a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08079" /><CodeLine lineNumber="8079"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// division by zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08080" /><CodeLine lineNumber="8080"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (canCauseUndefinedBehavior(ToBePromoted, U.getOperandNo()))</Highlight></CodeLine>
<Link id="l08081" /><CodeLine lineNumber="8081"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08082" /><CodeLine lineNumber="8082"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08083" /><CodeLine lineNumber="8083"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08084" /><CodeLine lineNumber="8084"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Val) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val) &amp;&amp;</Highlight></CodeLine>
<Link id="l08085" /><CodeLine lineNumber="8085"><Highlight kind="normal">          !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Val))</Highlight></CodeLine>
<Link id="l08086" /><CodeLine lineNumber="8086"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08087" /><CodeLine lineNumber="8087"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08088" /><CodeLine lineNumber="8088"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check that the resulting operation is legal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08089" /><CodeLine lineNumber="8089"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> ISDOpcode = TLI.InstructionOpcodeToISD(ToBePromoted-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</Highlight></CodeLine>
<Link id="l08090" /><CodeLine lineNumber="8090"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ISDOpcode)</Highlight></CodeLine>
<Link id="l08091" /><CodeLine lineNumber="8091"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08092" /><CodeLine lineNumber="8092"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a> ||</Highlight></CodeLine>
<Link id="l08093" /><CodeLine lineNumber="8093"><Highlight kind="normal">           TLI.isOperationLegalOrCustom(</Highlight></CodeLine>
<Link id="l08094" /><CodeLine lineNumber="8094"><Highlight kind="normal">               ISDOpcode, TLI.getValueType(DL, getTransitionType(), </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l08095" /><CodeLine lineNumber="8095"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08096" /><CodeLine lineNumber="8096"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08097" /><CodeLine lineNumber="8097"><Highlight kind="comment">  /// Check whether or not \\p Use can be combined</Highlight></CodeLine>
<Link id="l08098" /><CodeLine lineNumber="8098"><Highlight kind="comment">  /// with the transition.</Highlight></CodeLine>
<Link id="l08099" /><CodeLine lineNumber="8099"><Highlight kind="comment">  /// I.e., is it possible to do Use(Transition) =&gt; AnotherUse?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08100" /><CodeLine lineNumber="8100" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a50c710a774d51aa99714743554845ce8"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a50c710a774d51aa99714743554845ce8">canCombine</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/use">Use</a>) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>); &#125;</Highlight></CodeLine>
<Link id="l08101" /><CodeLine lineNumber="8101"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08102" /><CodeLine lineNumber="8102"><Highlight kind="comment">  /// Record \\p ToBePromoted as part of the chain to be promoted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08103" /><CodeLine lineNumber="8103" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a1c8dbcd42d4bca1cab2648c861a0e41a"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a1c8dbcd42d4bca1cab2648c861a0e41a">enqueueForPromotion</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted) &#123;</Highlight></CodeLine>
<Link id="l08104" /><CodeLine lineNumber="8104"><Highlight kind="normal">    InstsToBePromoted.push&#95;back(ToBePromoted);</Highlight></CodeLine>
<Link id="l08105" /><CodeLine lineNumber="8105"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08106" /><CodeLine lineNumber="8106"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08107" /><CodeLine lineNumber="8107"><Highlight kind="comment">  /// Set the instruction that will be combined with the transition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08108" /><CodeLine lineNumber="8108" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac69dbe5c53040d38e1f1d94ad4585e9f"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac69dbe5c53040d38e1f1d94ad4585e9f">recordCombineInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBeCombined) &#123;</Highlight></CodeLine>
<Link id="l08109" /><CodeLine lineNumber="8109"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a50c710a774d51aa99714743554845ce8">canCombine</a>(ToBeCombined) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unsupported instruction to combine&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08110" /><CodeLine lineNumber="8110"><Highlight kind="normal">    CombineInst = ToBeCombined;</Highlight></CodeLine>
<Link id="l08111" /><CodeLine lineNumber="8111"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08112" /><CodeLine lineNumber="8112"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08113" /><CodeLine lineNumber="8113"><Highlight kind="comment">  /// Promote all the instructions enqueued for promotion if it is</Highlight></CodeLine>
<Link id="l08114" /><CodeLine lineNumber="8114"><Highlight kind="comment">  /// is profitable.</Highlight></CodeLine>
<Link id="l08115" /><CodeLine lineNumber="8115"><Highlight kind="comment">  /// \\return True if the promotion happened, false otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08116" /><CodeLine lineNumber="8116" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac167b63805ec9effafeefa7b6d7e4777"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac167b63805ec9effafeefa7b6d7e4777">promote</a>() &#123;</Highlight></CodeLine>
<Link id="l08117" /><CodeLine lineNumber="8117"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if there is something to promote.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08118" /><CodeLine lineNumber="8118"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Right now, if we do not have anything to combine with,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08119" /><CodeLine lineNumber="8119"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we assume the promotion is not profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08120" /><CodeLine lineNumber="8120"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InstsToBePromoted.empty() || !CombineInst)</Highlight></CodeLine>
<Link id="l08121" /><CodeLine lineNumber="8121"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08122" /><CodeLine lineNumber="8122"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08123" /><CodeLine lineNumber="8123"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08124" /><CodeLine lineNumber="8124"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a> &amp;&amp; !isProfitableToPromote())</Highlight></CodeLine>
<Link id="l08125" /><CodeLine lineNumber="8125"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08126" /><CodeLine lineNumber="8126"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08127" /><CodeLine lineNumber="8127"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Promote.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08128" /><CodeLine lineNumber="8128"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ToBePromoted : InstsToBePromoted)</Highlight></CodeLine>
<Link id="l08129" /><CodeLine lineNumber="8129"><Highlight kind="normal">      promoteImpl(ToBePromoted);</Highlight></CodeLine>
<Link id="l08130" /><CodeLine lineNumber="8130"><Highlight kind="normal">    InstsToBePromoted.clear();</Highlight></CodeLine>
<Link id="l08131" /><CodeLine lineNumber="8131"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08132" /><CodeLine lineNumber="8132"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08133" /><CodeLine lineNumber="8133"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l08134" /><CodeLine lineNumber="8134"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08135" /><CodeLine lineNumber="8135"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08136" /><CodeLine lineNumber="8136"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08137" /><CodeLine lineNumber="8137"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> VectorPromoteHelper::promoteImpl(Instruction &#42;ToBePromoted) &#123;</Highlight></CodeLine>
<Link id="l08138" /><CodeLine lineNumber="8138"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// At this point, we know that all the operands of ToBePromoted but Def</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08139" /><CodeLine lineNumber="8139"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// can be statically promoted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08140" /><CodeLine lineNumber="8140"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For Def, we need to use its parameter in ToBePromoted:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08141" /><CodeLine lineNumber="8141"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// b = ToBePromoted ty1 a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08142" /><CodeLine lineNumber="8142"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Def = Transition ty1 b to ty2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08143" /><CodeLine lineNumber="8143"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Move the transition down.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08144" /><CodeLine lineNumber="8144"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 Replace all uses of the promoted operation by the transition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08145" /><CodeLine lineNumber="8145"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// = ... b =&gt; = ... Def.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08146" /><CodeLine lineNumber="8146"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ToBePromoted-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == Transition-&gt;getType() &amp;&amp;</Highlight></CodeLine>
<Link id="l08147" /><CodeLine lineNumber="8147"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;The type of the result of the transition does not match &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08148" /><CodeLine lineNumber="8148"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;the final type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08149" /><CodeLine lineNumber="8149"><Highlight kind="normal">  ToBePromoted-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Transition);</Highlight></CodeLine>
<Link id="l08150" /><CodeLine lineNumber="8150"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 Update the type of the uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08151" /><CodeLine lineNumber="8151"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// b = ToBePromoted ty2 Def =&gt; b = ToBePromoted ty1 Def.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08152" /><CodeLine lineNumber="8152"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TransitionTy = getTransitionType();</Highlight></CodeLine>
<Link id="l08153" /><CodeLine lineNumber="8153"><Highlight kind="normal">  ToBePromoted-&gt;<a href="/docs/api/classes/llvm/value/#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(TransitionTy);</Highlight></CodeLine>
<Link id="l08154" /><CodeLine lineNumber="8154"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3 Update all the operands of the promoted operation with promoted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08155" /><CodeLine lineNumber="8155"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08156" /><CodeLine lineNumber="8156"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// b = ToBePromoted ty1 Def =&gt; b = ToBePromoted ty1 a.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08157" /><CodeLine lineNumber="8157"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Use &amp;U : ToBePromoted-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</Highlight></CodeLine>
<Link id="l08158" /><CodeLine lineNumber="8158"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Val = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.get();</Highlight></CodeLine>
<Link id="l08159" /><CodeLine lineNumber="8159"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewVal = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08160" /><CodeLine lineNumber="8160"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Val == Transition)</Highlight></CodeLine>
<Link id="l08161" /><CodeLine lineNumber="8161"><Highlight kind="normal">      NewVal = Transition-&gt;getOperand(getTransitionOriginalValueIdx());</Highlight></CodeLine>
<Link id="l08162" /><CodeLine lineNumber="8162"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Val) ||</Highlight></CodeLine>
<Link id="l08163" /><CodeLine lineNumber="8163"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Val)) &#123;</Highlight></CodeLine>
<Link id="l08164" /><CodeLine lineNumber="8164"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Use a splat constant if it is not safe to use undef.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08165" /><CodeLine lineNumber="8165"><Highlight kind="normal">      NewVal = getConstantVector(</Highlight></CodeLine>
<Link id="l08166" /><CodeLine lineNumber="8166"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(Val),</Highlight></CodeLine>
<Link id="l08167" /><CodeLine lineNumber="8167"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val) ||</Highlight></CodeLine>
<Link id="l08168" /><CodeLine lineNumber="8168"><Highlight kind="normal">              canCauseUndefinedBehavior(ToBePromoted, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getOperandNo()));</Highlight></CodeLine>
<Link id="l08169" /><CodeLine lineNumber="8169"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08170" /><CodeLine lineNumber="8170"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Did you modified shouldPromote and forgot to update &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08171" /><CodeLine lineNumber="8171"><Highlight kind="normal">                       </Highlight><Highlight kind="stringliteral">&quot;this?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08172" /><CodeLine lineNumber="8172"><Highlight kind="normal">    ToBePromoted-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getOperandNo(), NewVal);</Highlight></CodeLine>
<Link id="l08173" /><CodeLine lineNumber="8173"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08174" /><CodeLine lineNumber="8174"><Highlight kind="normal">  Transition-&gt;moveAfter(ToBePromoted);</Highlight></CodeLine>
<Link id="l08175" /><CodeLine lineNumber="8175"><Highlight kind="normal">  Transition-&gt;setOperand(getTransitionOriginalValueIdx(), ToBePromoted);</Highlight></CodeLine>
<Link id="l08176" /><CodeLine lineNumber="8176"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08177" /><CodeLine lineNumber="8177"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08178" /><CodeLine lineNumber="8178"><Highlight kind="comment">/// Some targets can do store(extractelement) with one instruction.</Highlight></CodeLine>
<Link id="l08179" /><CodeLine lineNumber="8179"><Highlight kind="comment">/// Try to push the extractelement towards the stores when the target</Highlight></CodeLine>
<Link id="l08180" /><CodeLine lineNumber="8180"><Highlight kind="comment">/// has this feature and this is profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08181" /><CodeLine lineNumber="8181"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeExtractElementInst(Instruction &#42;Inst) &#123;</Highlight></CodeLine>
<Link id="l08182" /><CodeLine lineNumber="8182"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CombineCost = std::numeric&#95;limits&lt;unsigned&gt;::max();</Highlight></CodeLine>
<Link id="l08183" /><CodeLine lineNumber="8183"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a1e6cf6a2bf01ee44a0f0843d8c3512cd">DisableStoreExtract</a> ||</Highlight></CodeLine>
<Link id="l08184" /><CodeLine lineNumber="8184"><Highlight kind="normal">      (!<a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l08185" /><CodeLine lineNumber="8185"><Highlight kind="normal">       !TLI-&gt;canCombineStoreAndExtract(Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l08186" /><CodeLine lineNumber="8186"><Highlight kind="normal">                                       Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), CombineCost)))</Highlight></CodeLine>
<Link id="l08187" /><CodeLine lineNumber="8187"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08188" /><CodeLine lineNumber="8188"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08189" /><CodeLine lineNumber="8189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// At this point we know that Inst is a vector to scalar transition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08190" /><CodeLine lineNumber="8190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to move it down the def-use chain, until:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08191" /><CodeLine lineNumber="8191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - We can combine the transition with its single use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08192" /><CodeLine lineNumber="8192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   =&gt; we got rid of the transition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08193" /><CodeLine lineNumber="8193"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - We escape the current basic block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08194" /><CodeLine lineNumber="8194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   =&gt; we would need to check that we are moving it at a cheaper place and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08195" /><CodeLine lineNumber="8195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      we do not do that for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08196" /><CodeLine lineNumber="8196"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Parent = Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l08197" /><CodeLine lineNumber="8197"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Found an interesting transition: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08198" /><CodeLine lineNumber="8198"><Highlight kind="normal">  VectorPromoteHelper VPH(&#42;DL, &#42;TLI, &#42;TTI, Inst, CombineCost);</Highlight></CodeLine>
<Link id="l08199" /><CodeLine lineNumber="8199"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the transition has more than one use, assume this is not going to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08200" /><CodeLine lineNumber="8200"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// beneficial.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08201" /><CodeLine lineNumber="8201"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</Highlight></CodeLine>
<Link id="l08202" /><CodeLine lineNumber="8202"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ToBePromoted = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;Inst-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>());</Highlight></CodeLine>
<Link id="l08203" /><CodeLine lineNumber="8203"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Use: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;ToBePromoted &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08204" /><CodeLine lineNumber="8204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08205" /><CodeLine lineNumber="8205"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ToBePromoted-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Parent) &#123;</Highlight></CodeLine>
<Link id="l08206" /><CodeLine lineNumber="8206"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Instruction to promote is in a different block (&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08207" /><CodeLine lineNumber="8207"><Highlight kind="normal">                        &lt;&lt; ToBePromoted-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getName()</Highlight></CodeLine>
<Link id="l08208" /><CodeLine lineNumber="8208"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;) than the transition (&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Parent-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</Highlight></CodeLine>
<Link id="l08209" /><CodeLine lineNumber="8209"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;).\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08210" /><CodeLine lineNumber="8210"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08211" /><CodeLine lineNumber="8211"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08212" /><CodeLine lineNumber="8212"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08213" /><CodeLine lineNumber="8213"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPH.canCombine(ToBePromoted)) &#123;</Highlight></CodeLine>
<Link id="l08214" /><CodeLine lineNumber="8214"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Assume &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08215" /><CodeLine lineNumber="8215"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;will be combined with: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;ToBePromoted &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08216" /><CodeLine lineNumber="8216"><Highlight kind="normal">      VPH.recordCombineInstruction(ToBePromoted);</Highlight></CodeLine>
<Link id="l08217" /><CodeLine lineNumber="8217"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = VPH.promote();</Highlight></CodeLine>
<Link id="l08218" /><CodeLine lineNumber="8218"><Highlight kind="normal">      NumStoreExtractExposed += <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l08219" /><CodeLine lineNumber="8219"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l08220" /><CodeLine lineNumber="8220"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08221" /><CodeLine lineNumber="8221"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08222" /><CodeLine lineNumber="8222"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Try promoting.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08223" /><CodeLine lineNumber="8223"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VPH.canPromote(ToBePromoted) || !VPH.shouldPromote(ToBePromoted))</Highlight></CodeLine>
<Link id="l08224" /><CodeLine lineNumber="8224"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08225" /><CodeLine lineNumber="8225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08226" /><CodeLine lineNumber="8226"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Promoting is possible... Enqueue for promotion!\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08227" /><CodeLine lineNumber="8227"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08228" /><CodeLine lineNumber="8228"><Highlight kind="normal">    VPH.enqueueForPromotion(ToBePromoted);</Highlight></CodeLine>
<Link id="l08229" /><CodeLine lineNumber="8229"><Highlight kind="normal">    Inst = ToBePromoted;</Highlight></CodeLine>
<Link id="l08230" /><CodeLine lineNumber="8230"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08231" /><CodeLine lineNumber="8231"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08232" /><CodeLine lineNumber="8232"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08233" /><CodeLine lineNumber="8233"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08234" /><CodeLine lineNumber="8234"><Highlight kind="comment">/// For the instruction sequence of store below, F and I values</Highlight></CodeLine>
<Link id="l08235" /><CodeLine lineNumber="8235"><Highlight kind="comment">/// are bundled together as an i64 value before being stored into memory.</Highlight></CodeLine>
<Link id="l08236" /><CodeLine lineNumber="8236"><Highlight kind="comment">/// Sometimes it is more efficient to generate separate stores for F and I,</Highlight></CodeLine>
<Link id="l08237" /><CodeLine lineNumber="8237"><Highlight kind="comment">/// which can remove the bitwise instructions or sink them to colder places.</Highlight></CodeLine>
<Link id="l08238" /><CodeLine lineNumber="8238"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l08239" /><CodeLine lineNumber="8239"><Highlight kind="comment">///   (store (or (zext (bitcast F to i32) to i64),</Highlight></CodeLine>
<Link id="l08240" /><CodeLine lineNumber="8240"><Highlight kind="comment">///              (shl (zext I to i64), 32)), addr)  --&gt;</Highlight></CodeLine>
<Link id="l08241" /><CodeLine lineNumber="8241"><Highlight kind="comment">///   (store F, addr) and (store I, addr+4)</Highlight></CodeLine>
<Link id="l08242" /><CodeLine lineNumber="8242"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l08243" /><CodeLine lineNumber="8243"><Highlight kind="comment">/// Similarly, splitting for other merged store can also be beneficial, like:</Highlight></CodeLine>
<Link id="l08244" /><CodeLine lineNumber="8244"><Highlight kind="comment">/// For pair of &#123;i32, i32&#125;, i64 store --&gt; two i32 stores.</Highlight></CodeLine>
<Link id="l08245" /><CodeLine lineNumber="8245"><Highlight kind="comment">/// For pair of &#123;i32, i16&#125;, i64 store --&gt; two i32 stores.</Highlight></CodeLine>
<Link id="l08246" /><CodeLine lineNumber="8246"><Highlight kind="comment">/// For pair of &#123;i16, i16&#125;, i32 store --&gt; two i16 stores.</Highlight></CodeLine>
<Link id="l08247" /><CodeLine lineNumber="8247"><Highlight kind="comment">/// For pair of &#123;i16, i8&#125;,  i32 store --&gt; two i16 stores.</Highlight></CodeLine>
<Link id="l08248" /><CodeLine lineNumber="8248"><Highlight kind="comment">/// For pair of &#123;i8, i8&#125;,   i16 store --&gt; two i8 stores.</Highlight></CodeLine>
<Link id="l08249" /><CodeLine lineNumber="8249"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l08250" /><CodeLine lineNumber="8250"><Highlight kind="comment">/// We allow each target to determine specifically which kind of splitting is</Highlight></CodeLine>
<Link id="l08251" /><CodeLine lineNumber="8251"><Highlight kind="comment">/// supported.</Highlight></CodeLine>
<Link id="l08252" /><CodeLine lineNumber="8252"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l08253" /><CodeLine lineNumber="8253"><Highlight kind="comment">/// The store patterns are commonly seen from the simple code snippet below</Highlight></CodeLine>
<Link id="l08254" /><CodeLine lineNumber="8254"><Highlight kind="comment">/// if only std::make&#95;pair(...) is sroa transformed before inlined into hoo.</Highlight></CodeLine>
<Link id="l08255" /><CodeLine lineNumber="8255"><Highlight kind="comment">///   void goo(const std::pair&lt;int, float&gt; &amp;);</Highlight></CodeLine>
<Link id="l08256" /><CodeLine lineNumber="8256"><Highlight kind="comment">///   hoo() &#123;</Highlight></CodeLine>
<Link id="l08257" /><CodeLine lineNumber="8257"><Highlight kind="comment">///     ...</Highlight></CodeLine>
<Link id="l08258" /><CodeLine lineNumber="8258"><Highlight kind="comment">///     goo(std::make&#95;pair(tmp, ftmp));</Highlight></CodeLine>
<Link id="l08259" /><CodeLine lineNumber="8259"><Highlight kind="comment">///     ...</Highlight></CodeLine>
<Link id="l08260" /><CodeLine lineNumber="8260"><Highlight kind="comment">///   &#125;</Highlight></CodeLine>
<Link id="l08261" /><CodeLine lineNumber="8261"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l08262" /><CodeLine lineNumber="8262"><Highlight kind="comment">/// Although we already have similar splitting in DAG Combine, we duplicate</Highlight></CodeLine>
<Link id="l08263" /><CodeLine lineNumber="8263"><Highlight kind="comment">/// it in CodeGenPrepare to catch the case in which pattern is across</Highlight></CodeLine>
<Link id="l08264" /><CodeLine lineNumber="8264"><Highlight kind="comment">/// multiple BBs. The logic in DAG Combine is kept to catch case generated</Highlight></CodeLine>
<Link id="l08265" /><CodeLine lineNumber="8265"><Highlight kind="comment">/// during code expansion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08266" /><CodeLine lineNumber="8266" lineLink="#a3c7e1486d1d466b3be981adcb21a6359"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a>(<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l08267" /><CodeLine lineNumber="8267"><Highlight kind="normal">                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l08268" /><CodeLine lineNumber="8268"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle simple but common cases only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08269" /><CodeLine lineNumber="8269"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;StoreType = <a href="/docs/api/namespaces/llvm/si">SI</a>.getValueOperand()-&gt;getType();</Highlight></CodeLine>
<Link id="l08270" /><CodeLine lineNumber="8270"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08271" /><CodeLine lineNumber="8271"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The code below assumes shifting a value by &lt;number of bits&gt;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08272" /><CodeLine lineNumber="8272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// whereas scalable vectors would have to be shifted by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08273" /><CodeLine lineNumber="8273"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &lt;2log(vscale) + number of bits&gt; in order to store the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08274" /><CodeLine lineNumber="8274"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// low/high parts. Bailing out for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08275" /><CodeLine lineNumber="8275"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StoreType-&gt;<a href="/docs/api/classes/llvm/type/#a2ff127c9924cd3337080c4445c324aea">isScalableTy</a>())</Highlight></CodeLine>
<Link id="l08276" /><CodeLine lineNumber="8276"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08277" /><CodeLine lineNumber="8277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08278" /><CodeLine lineNumber="8278"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(StoreType) ||</Highlight></CodeLine>
<Link id="l08279" /><CodeLine lineNumber="8279"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(StoreType) == 0)</Highlight></CodeLine>
<Link id="l08280" /><CodeLine lineNumber="8280"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08281" /><CodeLine lineNumber="8281"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08282" /><CodeLine lineNumber="8282"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> HalfValBitSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(StoreType) / 2;</Highlight></CodeLine>
<Link id="l08283" /><CodeLine lineNumber="8283"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SplitStoreType = <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext(), HalfValBitSize);</Highlight></CodeLine>
<Link id="l08284" /><CodeLine lineNumber="8284"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(SplitStoreType))</Highlight></CodeLine>
<Link id="l08285" /><CodeLine lineNumber="8285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08286" /><CodeLine lineNumber="8286"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08287" /><CodeLine lineNumber="8287"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t split the store if it is volatile.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08288" /><CodeLine lineNumber="8288"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.isVolatile())</Highlight></CodeLine>
<Link id="l08289" /><CodeLine lineNumber="8289"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08290" /><CodeLine lineNumber="8290"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08291" /><CodeLine lineNumber="8291"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Match the following patterns:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08292" /><CodeLine lineNumber="8292"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (store (or (zext LValue to i64),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08293" /><CodeLine lineNumber="8293"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//            (shl (zext HValue to i64), 32)), HalfValBitSize)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08294" /><CodeLine lineNumber="8294"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08295" /><CodeLine lineNumber="8295"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (store (or (shl (zext HValue to i64), 32)), HalfValBitSize)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08296" /><CodeLine lineNumber="8296"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//            (zext LValue to i64),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08297" /><CodeLine lineNumber="8297"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Expect both operands of OR and the first operand of SHL have only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08298" /><CodeLine lineNumber="8298"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08299" /><CodeLine lineNumber="8299"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>, &#42;HValue;</Highlight></CodeLine>
<Link id="l08300" /><CodeLine lineNumber="8300"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getValueOperand(),</Highlight></CodeLine>
<Link id="l08301" /><CodeLine lineNumber="8301"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#ae80cbfea2025ff7bd0770f30be6e050a">m&#95;c&#95;Or</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>))),</Highlight></CodeLine>
<Link id="l08302" /><CodeLine lineNumber="8302"><Highlight kind="normal">                    <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(HValue))),</Highlight></CodeLine>
<Link id="l08303" /><CodeLine lineNumber="8303"><Highlight kind="normal">                                   <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(HalfValBitSize))))))</Highlight></CodeLine>
<Link id="l08304" /><CodeLine lineNumber="8304"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08305" /><CodeLine lineNumber="8305"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08306" /><CodeLine lineNumber="8306"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check LValue and HValue are int with size less or equal than 32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08307" /><CodeLine lineNumber="8307"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType()-&gt;isIntegerTy() ||</Highlight></CodeLine>
<Link id="l08308" /><CodeLine lineNumber="8308"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType()) &gt; HalfValBitSize ||</Highlight></CodeLine>
<Link id="l08309" /><CodeLine lineNumber="8309"><Highlight kind="normal">      !HValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</Highlight></CodeLine>
<Link id="l08310" /><CodeLine lineNumber="8310"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(HValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &gt; HalfValBitSize)</Highlight></CodeLine>
<Link id="l08311" /><CodeLine lineNumber="8311"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08312" /><CodeLine lineNumber="8312"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08313" /><CodeLine lineNumber="8313"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If LValue/HValue is a bitcast instruction, use the EVT before bitcast</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08314" /><CodeLine lineNumber="8314"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as the input of target query.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08315" /><CodeLine lineNumber="8315"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>);</Highlight></CodeLine>
<Link id="l08316" /><CodeLine lineNumber="8316"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;HBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(HValue);</Highlight></CodeLine>
<Link id="l08317" /><CodeLine lineNumber="8317"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/evt">EVT</a> LowTy = LBC ? <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(LBC-&gt;getOperand(0)-&gt;getType())</Highlight></CodeLine>
<Link id="l08318" /><CodeLine lineNumber="8318"><Highlight kind="normal">                  : <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l08319" /><CodeLine lineNumber="8319"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/evt">EVT</a> HighTy = HBC ? <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(HBC-&gt;getOperand(0)-&gt;getType())</Highlight></CodeLine>
<Link id="l08320" /><CodeLine lineNumber="8320"><Highlight kind="normal">                   : <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(HValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l08321" /><CodeLine lineNumber="8321"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a8ac7126af5085fb735db4c727a0ab4e9">ForceSplitStore</a> &amp;&amp; !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#ab068741575ed8c7f6bd4fe059edabd14">isMultiStoresCheaperThanBitsMerge</a>(LowTy, HighTy))</Highlight></CodeLine>
<Link id="l08322" /><CodeLine lineNumber="8322"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08323" /><CodeLine lineNumber="8323"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08324" /><CodeLine lineNumber="8324"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Start to split store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08325" /><CodeLine lineNumber="8325"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext());</Highlight></CodeLine>
<Link id="l08326" /><CodeLine lineNumber="8326"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;<a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l08327" /><CodeLine lineNumber="8327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08328" /><CodeLine lineNumber="8328"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If LValue/HValue is a bitcast in another BB, create a new one in current</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08329" /><CodeLine lineNumber="8329"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB so it may be merged with the splitted stores by dag combiner.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08330" /><CodeLine lineNumber="8330"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LBC &amp;&amp; LBC-&gt;getParent() != <a href="/docs/api/namespaces/llvm/si">SI</a>.getParent())</Highlight></CodeLine>
<Link id="l08331" /><CodeLine lineNumber="8331"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(LBC-&gt;getOperand(0), LBC-&gt;getType());</Highlight></CodeLine>
<Link id="l08332" /><CodeLine lineNumber="8332"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HBC &amp;&amp; HBC-&gt;getParent() != <a href="/docs/api/namespaces/llvm/si">SI</a>.getParent())</Highlight></CodeLine>
<Link id="l08333" /><CodeLine lineNumber="8333"><Highlight kind="normal">    HValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(HBC-&gt;getOperand(0), HBC-&gt;getType());</Highlight></CodeLine>
<Link id="l08334" /><CodeLine lineNumber="8334"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08335" /><CodeLine lineNumber="8335"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsLE = <a href="/docs/api/namespaces/llvm/si">SI</a>.getDataLayout().isLittleEndian();</Highlight></CodeLine>
<Link id="l08336" /><CodeLine lineNumber="8336"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CreateSplitStore = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>) &#123;</Highlight></CodeLine>
<Link id="l08337" /><CodeLine lineNumber="8337"><Highlight kind="normal">    V = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a0032ae544ae429aaf1053767da90426d">CreateZExtOrBitCast</a>(V, SplitStoreType);</Highlight></CodeLine>
<Link id="l08338" /><CodeLine lineNumber="8338"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Addr = <a href="/docs/api/namespaces/llvm/si">SI</a>.getPointerOperand();</Highlight></CodeLine>
<Link id="l08339" /><CodeLine lineNumber="8339"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/si">SI</a>.getAlign();</Highlight></CodeLine>
<Link id="l08340" /><CodeLine lineNumber="8340"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsOffsetStore = (IsLE &amp;&amp; <a href="/docs/api/namespaces/llvm/#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>) || (!IsLE &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>);</Highlight></CodeLine>
<Link id="l08341" /><CodeLine lineNumber="8341"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsOffsetStore) &#123;</Highlight></CodeLine>
<Link id="l08342" /><CodeLine lineNumber="8342"><Highlight kind="normal">      Addr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(</Highlight></CodeLine>
<Link id="l08343" /><CodeLine lineNumber="8343"><Highlight kind="normal">          SplitStoreType, Addr,</Highlight></CodeLine>
<Link id="l08344" /><CodeLine lineNumber="8344"><Highlight kind="normal">          ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext()), 1));</Highlight></CodeLine>
<Link id="l08345" /><CodeLine lineNumber="8345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08346" /><CodeLine lineNumber="8346"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// When splitting the store in half, naturally one half will retain the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08347" /><CodeLine lineNumber="8347"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// alignment of the original wider store, regardless of whether it was</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08348" /><CodeLine lineNumber="8348"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// over-aligned or not, while the other will require adjustment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08349" /><CodeLine lineNumber="8349"><Highlight kind="normal">      Alignment = <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(Alignment, HalfValBitSize / 8);</Highlight></CodeLine>
<Link id="l08350" /><CodeLine lineNumber="8350"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08351" /><CodeLine lineNumber="8351"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(V, Addr, Alignment);</Highlight></CodeLine>
<Link id="l08352" /><CodeLine lineNumber="8352"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l08353" /><CodeLine lineNumber="8353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08354" /><CodeLine lineNumber="8354"><Highlight kind="normal">  CreateSplitStore(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08355" /><CodeLine lineNumber="8355"><Highlight kind="normal">  CreateSplitStore(HValue, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08356" /><CodeLine lineNumber="8356"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08357" /><CodeLine lineNumber="8357"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Delete the old store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08358" /><CodeLine lineNumber="8358"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.eraseFromParent();</Highlight></CodeLine>
<Link id="l08359" /><CodeLine lineNumber="8359"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08360" /><CodeLine lineNumber="8360"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08361" /><CodeLine lineNumber="8361"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08362" /><CodeLine lineNumber="8362"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Return true if the GEP has two operands, the first operand is of a sequential</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08363" /><CodeLine lineNumber="8363"><Highlight kind="normal"></Highlight><Highlight kind="comment">// type, and the second operand is a constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08364" /><CodeLine lineNumber="8364" lineLink="#ac3e586008202db1f802e906a489d7574"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) &#123;</Highlight></CodeLine>
<Link id="l08365" /><CodeLine lineNumber="8365"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a81c0916829c13ba5279ca0e5480aef0c">gep&#95;type&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac828b9b52935f87659a4adf237f820a3">gep&#95;type&#95;begin</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l08366" /><CodeLine lineNumber="8366"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands() == 2 &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isSequential() &amp;&amp;</Highlight></CodeLine>
<Link id="l08367" /><CodeLine lineNumber="8367"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l08368" /><CodeLine lineNumber="8368"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08369" /><CodeLine lineNumber="8369"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08370" /><CodeLine lineNumber="8370"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Try unmerging GEPs to reduce liveness interference (register pressure) across</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08371" /><CodeLine lineNumber="8371"><Highlight kind="normal"></Highlight><Highlight kind="comment">// IndirectBr edges. Since IndirectBr edges tend to touch on many blocks,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08372" /><CodeLine lineNumber="8372"><Highlight kind="normal"></Highlight><Highlight kind="comment">// reducing liveness interference across those edges benefits global register</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08373" /><CodeLine lineNumber="8373"><Highlight kind="normal"></Highlight><Highlight kind="comment">// allocation. Currently handles only certain cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08374" /><CodeLine lineNumber="8374"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08375" /><CodeLine lineNumber="8375"><Highlight kind="normal"></Highlight><Highlight kind="comment">// For example, unmerge %GEPI and %UGEPI as below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08376" /><CodeLine lineNumber="8376"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08377" /><CodeLine lineNumber="8377"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ---------- BEFORE ----------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08378" /><CodeLine lineNumber="8378"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SrcBlock:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08379" /><CodeLine lineNumber="8379"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08380" /><CodeLine lineNumber="8380"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %GEPIOp = ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08381" /><CodeLine lineNumber="8381"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08382" /><CodeLine lineNumber="8382"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %GEPI = gep %GEPIOp, Idx</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08383" /><CodeLine lineNumber="8383"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08384" /><CodeLine lineNumber="8384"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   indirectbr ... &#91; label %DstB0, label %DstB1, ... label %DstBi ... &#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08385" /><CodeLine lineNumber="8385"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   (&#42; %GEPI is alive on the indirectbr edges due to other uses ahead)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08386" /><CodeLine lineNumber="8386"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   (&#42; %GEPIOp is alive on the indirectbr edges only because of it&#39;s used by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08387" /><CodeLine lineNumber="8387"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %UGEPI)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08388" /><CodeLine lineNumber="8388"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08389" /><CodeLine lineNumber="8389"><Highlight kind="normal"></Highlight><Highlight kind="comment">// DstB0: ... (there may be a gep similar to %UGEPI to be unmerged)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08390" /><CodeLine lineNumber="8390"><Highlight kind="normal"></Highlight><Highlight kind="comment">// DstB1: ... (there may be a gep similar to %UGEPI to be unmerged)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08391" /><CodeLine lineNumber="8391"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08392" /><CodeLine lineNumber="8392"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08393" /><CodeLine lineNumber="8393"><Highlight kind="normal"></Highlight><Highlight kind="comment">// DstBi:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08394" /><CodeLine lineNumber="8394"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08395" /><CodeLine lineNumber="8395"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %UGEPI = gep %GEPIOp, UIdx</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08396" /><CodeLine lineNumber="8396"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08397" /><CodeLine lineNumber="8397"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ---------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08398" /><CodeLine lineNumber="8398"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08399" /><CodeLine lineNumber="8399"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ---------- AFTER ----------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08400" /><CodeLine lineNumber="8400"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SrcBlock:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08401" /><CodeLine lineNumber="8401"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ... (same as above)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08402" /><CodeLine lineNumber="8402"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    (&#42; %GEPI is still alive on the indirectbr edges)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08403" /><CodeLine lineNumber="8403"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    (&#42; %GEPIOp is no longer alive on the indirectbr edges as a result of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08404" /><CodeLine lineNumber="8404"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    unmerging)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08405" /><CodeLine lineNumber="8405"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08406" /><CodeLine lineNumber="8406"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08407" /><CodeLine lineNumber="8407"><Highlight kind="normal"></Highlight><Highlight kind="comment">// DstBi:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08408" /><CodeLine lineNumber="8408"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08409" /><CodeLine lineNumber="8409"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %UGEPI = gep %GEPI, (UIdx-Idx)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08410" /><CodeLine lineNumber="8410"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08411" /><CodeLine lineNumber="8411"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ---------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08412" /><CodeLine lineNumber="8412"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08413" /><CodeLine lineNumber="8413"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The register pressure on the IndirectBr edges is reduced because %GEPIOp is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08414" /><CodeLine lineNumber="8414"><Highlight kind="normal"></Highlight><Highlight kind="comment">// no longer alive on them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08415" /><CodeLine lineNumber="8415"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08416" /><CodeLine lineNumber="8416"><Highlight kind="normal"></Highlight><Highlight kind="comment">// We try to unmerge GEPs here in CodGenPrepare, as opposed to limiting merging</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08417" /><CodeLine lineNumber="8417"><Highlight kind="normal"></Highlight><Highlight kind="comment">// of GEPs in the first place in InstCombiner::visitGetElementPtrInst() so as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08418" /><CodeLine lineNumber="8418"><Highlight kind="normal"></Highlight><Highlight kind="comment">// not to disable further simplications and optimizations as a result of GEP</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08419" /><CodeLine lineNumber="8419"><Highlight kind="normal"></Highlight><Highlight kind="comment">// merging.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08420" /><CodeLine lineNumber="8420"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08421" /><CodeLine lineNumber="8421"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Note this unmerging may increase the length of the data flow critical path</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08422" /><CodeLine lineNumber="8422"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (the path from %GEPIOp to %UGEPI would go through %GEPI), which is a tradeoff</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08423" /><CodeLine lineNumber="8423"><Highlight kind="normal"></Highlight><Highlight kind="comment">// between the register pressure and the length of data-flow critical</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08424" /><CodeLine lineNumber="8424"><Highlight kind="normal"></Highlight><Highlight kind="comment">// path. Restricting this to the uncommon IndirectBr case would minimize the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08425" /><CodeLine lineNumber="8425"><Highlight kind="normal"></Highlight><Highlight kind="comment">// impact of potentially longer critical path, if any, and the impact on compile</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08426" /><CodeLine lineNumber="8426"><Highlight kind="normal"></Highlight><Highlight kind="comment">// time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08427" /><CodeLine lineNumber="8427" lineLink="#a8528dea79f0940669c4fcb751940ca94"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;GEPI,</Highlight></CodeLine>
<Link id="l08428" /><CodeLine lineNumber="8428"><Highlight kind="normal">                                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</Highlight></CodeLine>
<Link id="l08429" /><CodeLine lineNumber="8429"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SrcBlock = GEPI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l08430" /><CodeLine lineNumber="8430"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that SrcBlock ends with an IndirectBr. If not, give up. The common</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08431" /><CodeLine lineNumber="8431"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (non-IndirectBr) cases exit early here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08432" /><CodeLine lineNumber="8432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(SrcBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</Highlight></CodeLine>
<Link id="l08433" /><CodeLine lineNumber="8433"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08434" /><CodeLine lineNumber="8434"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that GEPI is a simple gep with a single constant index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08435" /><CodeLine lineNumber="8435"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(GEPI))</Highlight></CodeLine>
<Link id="l08436" /><CodeLine lineNumber="8436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08437" /><CodeLine lineNumber="8437"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;GEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(GEPI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l08438" /><CodeLine lineNumber="8438"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that GEPI is a cheap one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08439" /><CodeLine lineNumber="8439"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getIntImmCost(GEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>(), GEPIIdx-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l08440" /><CodeLine lineNumber="8440"><Highlight kind="normal">                         <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>) &gt;</Highlight></CodeLine>
<Link id="l08441" /><CodeLine lineNumber="8441"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</Highlight></CodeLine>
<Link id="l08442" /><CodeLine lineNumber="8442"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08443" /><CodeLine lineNumber="8443"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;GEPIOp = GEPI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l08444" /><CodeLine lineNumber="8444"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that GEPIOp is an instruction that&#39;s also defined in SrcBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08445" /><CodeLine lineNumber="8445"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(GEPIOp))</Highlight></CodeLine>
<Link id="l08446" /><CodeLine lineNumber="8446"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08447" /><CodeLine lineNumber="8447"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GEPIOpI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(GEPIOp);</Highlight></CodeLine>
<Link id="l08448" /><CodeLine lineNumber="8448"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPIOpI-&gt;getParent() != SrcBlock)</Highlight></CodeLine>
<Link id="l08449" /><CodeLine lineNumber="8449"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08450" /><CodeLine lineNumber="8450"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that GEP is used outside the block, meaning it&#39;s alive on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08451" /><CodeLine lineNumber="8451"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// IndirectBr edge(s).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08452" /><CodeLine lineNumber="8452"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none&#95;of</a>(GEPI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;Usr) &#123;</Highlight></CodeLine>
<Link id="l08453" /><CodeLine lineNumber="8453"><Highlight kind="normal">        if (auto &#42;I = dyn&#95;cast&lt;Instruction&gt;(Usr)) &#123;</Highlight></CodeLine>
<Link id="l08454" /><CodeLine lineNumber="8454"><Highlight kind="normal">          if (I-&gt;getParent() != SrcBlock) &#123;</Highlight></CodeLine>
<Link id="l08455" /><CodeLine lineNumber="8455"><Highlight kind="normal">            return true;</Highlight></CodeLine>
<Link id="l08456" /><CodeLine lineNumber="8456"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l08457" /><CodeLine lineNumber="8457"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l08458" /><CodeLine lineNumber="8458"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08459" /><CodeLine lineNumber="8459"><Highlight kind="normal">      &#125;))</Highlight></CodeLine>
<Link id="l08460" /><CodeLine lineNumber="8460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08461" /><CodeLine lineNumber="8461"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The second elements of the GEP chains to be unmerged.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08462" /><CodeLine lineNumber="8462"><Highlight kind="normal">  std::vector&lt;GetElementPtrInst &#42;&gt; UGEPIs;</Highlight></CodeLine>
<Link id="l08463" /><CodeLine lineNumber="8463"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check each user of GEPIOp to check if unmerging would make GEPIOp not alive</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08464" /><CodeLine lineNumber="8464"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// on IndirectBr edges.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08465" /><CodeLine lineNumber="8465"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;Usr : GEPIOp-&gt;<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#ac2f338c3f467b3d09613e190d73044a5">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l08466" /><CodeLine lineNumber="8466"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Usr == GEPI)</Highlight></CodeLine>
<Link id="l08467" /><CodeLine lineNumber="8467"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08468" /><CodeLine lineNumber="8468"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if Usr is an Instruction. If not, give up.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08469" /><CodeLine lineNumber="8469"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Usr))</Highlight></CodeLine>
<Link id="l08470" /><CodeLine lineNumber="8470"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08471" /><CodeLine lineNumber="8471"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Usr);</Highlight></CodeLine>
<Link id="l08472" /><CodeLine lineNumber="8472"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if Usr in the same block as GEPIOp, which is fine, skip.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08473" /><CodeLine lineNumber="8473"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == SrcBlock)</Highlight></CodeLine>
<Link id="l08474" /><CodeLine lineNumber="8474"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08475" /><CodeLine lineNumber="8475"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if Usr is a GEP. If not, give up.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08476" /><CodeLine lineNumber="8476"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(Usr))</Highlight></CodeLine>
<Link id="l08477" /><CodeLine lineNumber="8477"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08478" /><CodeLine lineNumber="8478"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UGEPI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(Usr);</Highlight></CodeLine>
<Link id="l08479" /><CodeLine lineNumber="8479"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if UGEPI is a simple gep with a single constant index and GEPIOp is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08480" /><CodeLine lineNumber="8480"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the pointer operand to it. If so, record it in the vector. If not, give</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08481" /><CodeLine lineNumber="8481"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// up.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08482" /><CodeLine lineNumber="8482"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(UGEPI))</Highlight></CodeLine>
<Link id="l08483" /><CodeLine lineNumber="8483"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08484" /><CodeLine lineNumber="8484"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UGEPI-&gt;getOperand(0) != GEPIOp)</Highlight></CodeLine>
<Link id="l08485" /><CodeLine lineNumber="8485"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08486" /><CodeLine lineNumber="8486"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UGEPI-&gt;getSourceElementType() != GEPI-&gt;getSourceElementType())</Highlight></CodeLine>
<Link id="l08487" /><CodeLine lineNumber="8487"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08488" /><CodeLine lineNumber="8488"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPIIdx-&gt;getType() !=</Highlight></CodeLine>
<Link id="l08489" /><CodeLine lineNumber="8489"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1))-&gt;getType())</Highlight></CodeLine>
<Link id="l08490" /><CodeLine lineNumber="8490"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08491" /><CodeLine lineNumber="8491"><Highlight kind="normal">    ConstantInt &#42;UGEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l08492" /><CodeLine lineNumber="8492"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;<a href="/docs/api/classes/llvm/targettransforminfo/#a8f708e28c4cf4fcdbbe363849b779a00">getIntImmCost</a>(UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>(), UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l08493" /><CodeLine lineNumber="8493"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>) &gt;</Highlight></CodeLine>
<Link id="l08494" /><CodeLine lineNumber="8494"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</Highlight></CodeLine>
<Link id="l08495" /><CodeLine lineNumber="8495"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08496" /><CodeLine lineNumber="8496"><Highlight kind="normal">    UGEPIs.push&#95;back(UGEPI);</Highlight></CodeLine>
<Link id="l08497" /><CodeLine lineNumber="8497"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08498" /><CodeLine lineNumber="8498"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UGEPIs.size() == 0)</Highlight></CodeLine>
<Link id="l08499" /><CodeLine lineNumber="8499"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08500" /><CodeLine lineNumber="8500"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the materializing cost of (Uidx-Idx).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08501" /><CodeLine lineNumber="8501"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (GetElementPtrInst &#42;UGEPI : UGEPIs) &#123;</Highlight></CodeLine>
<Link id="l08502" /><CodeLine lineNumber="8502"><Highlight kind="normal">    ConstantInt &#42;UGEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l08503" /><CodeLine lineNumber="8503"><Highlight kind="normal">    APInt NewIdx = UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() - GEPIIdx-&gt;getValue();</Highlight></CodeLine>
<Link id="l08504" /><CodeLine lineNumber="8504"><Highlight kind="normal">    InstructionCost ImmCost = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;<a href="/docs/api/classes/llvm/targettransforminfo/#a8f708e28c4cf4fcdbbe363849b779a00">getIntImmCost</a>(</Highlight></CodeLine>
<Link id="l08505" /><CodeLine lineNumber="8505"><Highlight kind="normal">        NewIdx, GEPIIdx-&gt;getType(), <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>);</Highlight></CodeLine>
<Link id="l08506" /><CodeLine lineNumber="8506"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ImmCost &gt; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</Highlight></CodeLine>
<Link id="l08507" /><CodeLine lineNumber="8507"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08508" /><CodeLine lineNumber="8508"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08509" /><CodeLine lineNumber="8509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now unmerge between GEPI and UGEPIs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08510" /><CodeLine lineNumber="8510"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (GetElementPtrInst &#42;UGEPI : UGEPIs) &#123;</Highlight></CodeLine>
<Link id="l08511" /><CodeLine lineNumber="8511"><Highlight kind="normal">    UGEPI-&gt;setOperand(0, GEPI);</Highlight></CodeLine>
<Link id="l08512" /><CodeLine lineNumber="8512"><Highlight kind="normal">    ConstantInt &#42;UGEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l08513" /><CodeLine lineNumber="8513"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;NewUGEPIIdx = ConstantInt::get(</Highlight></CodeLine>
<Link id="l08514" /><CodeLine lineNumber="8514"><Highlight kind="normal">        GEPIIdx-&gt;getType(), UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() - GEPIIdx-&gt;getValue());</Highlight></CodeLine>
<Link id="l08515" /><CodeLine lineNumber="8515"><Highlight kind="normal">    UGEPI-&gt;setOperand(1, NewUGEPIIdx);</Highlight></CodeLine>
<Link id="l08516" /><CodeLine lineNumber="8516"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If GEPI is not inbounds but UGEPI is inbounds, change UGEPI to not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08517" /><CodeLine lineNumber="8517"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inbounds to avoid UB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08518" /><CodeLine lineNumber="8518"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GEPI-&gt;isInBounds()) &#123;</Highlight></CodeLine>
<Link id="l08519" /><CodeLine lineNumber="8519"><Highlight kind="normal">      UGEPI-&gt;setIsInBounds(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08520" /><CodeLine lineNumber="8520"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08521" /><CodeLine lineNumber="8521"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08522" /><CodeLine lineNumber="8522"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// After unmerging, verify that GEPIOp is actually only used in SrcBlock (not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08523" /><CodeLine lineNumber="8523"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// alive on IndirectBr edges).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08524" /><CodeLine lineNumber="8524"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none&#95;of</a>(GEPIOp-&gt;users(),</Highlight></CodeLine>
<Link id="l08525" /><CodeLine lineNumber="8525"><Highlight kind="normal">                       &#91;&amp;&#93;(User &#42;Usr) &#123;</Highlight></CodeLine>
<Link id="l08526" /><CodeLine lineNumber="8526"><Highlight kind="normal">                         return cast&lt;Instruction&gt;(Usr)-&gt;getParent() != SrcBlock;</Highlight></CodeLine>
<Link id="l08527" /><CodeLine lineNumber="8527"><Highlight kind="normal">                       &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l08528" /><CodeLine lineNumber="8528"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;GEPIOp is used outside SrcBlock&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08529" /><CodeLine lineNumber="8529"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08530" /><CodeLine lineNumber="8530"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08531" /><CodeLine lineNumber="8531"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08532" /><CodeLine lineNumber="8532" lineLink="#ad2bfc3e2f7b1661868517e662ac7496c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;Branch, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l08533" /><CodeLine lineNumber="8533"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</Highlight></CodeLine>
<Link id="l08534" /><CodeLine lineNumber="8534"><Highlight kind="normal">                           </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsHugeFunc) &#123;</Highlight></CodeLine>
<Link id="l08535" /><CodeLine lineNumber="8535"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try and convert</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08536" /><CodeLine lineNumber="8536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  %c = icmp ult %x, 8</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08537" /><CodeLine lineNumber="8537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  br %c, bla, blb</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08538" /><CodeLine lineNumber="8538"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  %tc = lshr %x, 3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08539" /><CodeLine lineNumber="8539"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08540" /><CodeLine lineNumber="8540"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  %tc = lshr %x, 3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08541" /><CodeLine lineNumber="8541"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  %c = icmp eq %tc, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08542" /><CodeLine lineNumber="8542"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  br %c, bla, blb</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08543" /><CodeLine lineNumber="8543"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Creating the cmp to zero can be better for the backend, especially if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08544" /><CodeLine lineNumber="8544"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lshr produces flags that can be used automatically.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08545" /><CodeLine lineNumber="8545"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#af7763c45db027300e49b43037e5a1a60">preferZeroCompareBranch</a>() || !Branch-&gt;isConditional())</Highlight></CodeLine>
<Link id="l08546" /><CodeLine lineNumber="8546"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08547" /><CodeLine lineNumber="8547"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08548" /><CodeLine lineNumber="8548"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(Branch-&gt;getCondition());</Highlight></CodeLine>
<Link id="l08549" /><CodeLine lineNumber="8549"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cmp || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Cmp-&gt;getOperand(1)) || !Cmp-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l08550" /><CodeLine lineNumber="8550"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08551" /><CodeLine lineNumber="8551"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08552" /><CodeLine lineNumber="8552"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Cmp-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l08553" /><CodeLine lineNumber="8553"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> CmpC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(Cmp-&gt;getOperand(1))-&gt;getValue();</Highlight></CodeLine>
<Link id="l08554" /><CodeLine lineNumber="8554"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08555" /><CodeLine lineNumber="8555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l08556" /><CodeLine lineNumber="8556"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l08557" /><CodeLine lineNumber="8557"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A quick dominance check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08558" /><CodeLine lineNumber="8558"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UI ||</Highlight></CodeLine>
<Link id="l08559" /><CodeLine lineNumber="8559"><Highlight kind="normal">        (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent() &amp;&amp;</Highlight></CodeLine>
<Link id="l08560" /><CodeLine lineNumber="8560"><Highlight kind="normal">         UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getSuccessor(0) &amp;&amp;</Highlight></CodeLine>
<Link id="l08561" /><CodeLine lineNumber="8561"><Highlight kind="normal">         UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getSuccessor(1)) ||</Highlight></CodeLine>
<Link id="l08562" /><CodeLine lineNumber="8562"><Highlight kind="normal">        (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent() &amp;&amp;</Highlight></CodeLine>
<Link id="l08563" /><CodeLine lineNumber="8563"><Highlight kind="normal">         !UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getSinglePredecessor()))</Highlight></CodeLine>
<Link id="l08564" /><CodeLine lineNumber="8564"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08565" /><CodeLine lineNumber="8565"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08566" /><CodeLine lineNumber="8566"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CmpC.<a href="/docs/api/classes/llvm/apint/#ad1b0513de876d1c85cf6268ca21b2c86">isPowerOf2</a>() &amp;&amp; Cmp-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l08567" /><CodeLine lineNumber="8567"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a href="/docs/api/namespaces/llvm/patternmatch/#a310fbeb4d6c1b137dfd8713d354f3d76">m&#95;Shr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(CmpC.<a href="/docs/api/classes/llvm/apint/#aae3b959a0a2981340fd03c29f528f2f0">logBase2</a>())))) &#123;</Highlight></CodeLine>
<Link id="l08568" /><CodeLine lineNumber="8568"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Branch);</Highlight></CodeLine>
<Link id="l08569" /><CodeLine lineNumber="8569"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent())</Highlight></CodeLine>
<Link id="l08570" /><CodeLine lineNumber="8570"><Highlight kind="normal">        UI-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(Branch-&gt;getIterator());</Highlight></CodeLine>
<Link id="l08571" /><CodeLine lineNumber="8571"><Highlight kind="normal">      UI-&gt;<a href="/docs/api/classes/llvm/instruction/#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</Highlight></CodeLine>
<Link id="l08572" /><CodeLine lineNumber="8572"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a843d43d070f0b1c6a133403edce488ef">CreateCmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, UI,</Highlight></CodeLine>
<Link id="l08573" /><CodeLine lineNumber="8573"><Highlight kind="normal">                                        ConstantInt::get(UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0));</Highlight></CodeLine>
<Link id="l08574" /><CodeLine lineNumber="8574"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Converting &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Cmp &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08575" /><CodeLine lineNumber="8575"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to compare on zero: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;NewCmp &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08576" /><CodeLine lineNumber="8576"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, NewCmp, FreshBBs, IsHugeFunc);</Highlight></CodeLine>
<Link id="l08577" /><CodeLine lineNumber="8577"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08578" /><CodeLine lineNumber="8578"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08579" /><CodeLine lineNumber="8579"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Cmp-&gt;isEquality() &amp;&amp;</Highlight></CodeLine>
<Link id="l08580" /><CodeLine lineNumber="8580"><Highlight kind="normal">        (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(-CmpC))) ||</Highlight></CodeLine>
<Link id="l08581" /><CodeLine lineNumber="8581"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(CmpC))))) &#123;</Highlight></CodeLine>
<Link id="l08582" /><CodeLine lineNumber="8582"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Branch);</Highlight></CodeLine>
<Link id="l08583" /><CodeLine lineNumber="8583"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent())</Highlight></CodeLine>
<Link id="l08584" /><CodeLine lineNumber="8584"><Highlight kind="normal">        UI-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(Branch-&gt;getIterator());</Highlight></CodeLine>
<Link id="l08585" /><CodeLine lineNumber="8585"><Highlight kind="normal">      UI-&gt;<a href="/docs/api/classes/llvm/instruction/#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</Highlight></CodeLine>
<Link id="l08586" /><CodeLine lineNumber="8586"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a843d43d070f0b1c6a133403edce488ef">CreateCmp</a>(Cmp-&gt;getPredicate(), UI,</Highlight></CodeLine>
<Link id="l08587" /><CodeLine lineNumber="8587"><Highlight kind="normal">                                        ConstantInt::get(UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0));</Highlight></CodeLine>
<Link id="l08588" /><CodeLine lineNumber="8588"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Converting &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Cmp &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08589" /><CodeLine lineNumber="8589"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to compare on zero: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;NewCmp &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08590" /><CodeLine lineNumber="8590"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, NewCmp, FreshBBs, IsHugeFunc);</Highlight></CodeLine>
<Link id="l08591" /><CodeLine lineNumber="8591"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08592" /><CodeLine lineNumber="8592"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08593" /><CodeLine lineNumber="8593"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08594" /><CodeLine lineNumber="8594"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08595" /><CodeLine lineNumber="8595"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08596" /><CodeLine lineNumber="8596"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08597" /><CodeLine lineNumber="8597"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeInst(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l08598" /><CodeLine lineNumber="8598"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AnyChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08599" /><CodeLine lineNumber="8599"><Highlight kind="normal">  AnyChange = fixupDbgVariableRecordsOnInst(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l08600" /><CodeLine lineNumber="8600"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08601" /><CodeLine lineNumber="8601"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bail out if we inserted the instruction to prevent optimizations from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08602" /><CodeLine lineNumber="8602"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stepping on each other&#39;s toes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08603" /><CodeLine lineNumber="8603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsertedInsts.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l08604" /><CodeLine lineNumber="8604"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08605" /><CodeLine lineNumber="8605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08606" /><CodeLine lineNumber="8606"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Move into the switch on opcode below here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08607" /><CodeLine lineNumber="8607"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHINode &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08608" /><CodeLine lineNumber="8608"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// It is possible for very late stage optimizations (such as SimplifyCFG)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08609" /><CodeLine lineNumber="8609"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to introduce PHI nodes too late to be cleaned up.  If we detect such a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08610" /><CodeLine lineNumber="8610"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// trivial PHI, go ahead and zap it here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08611" /><CodeLine lineNumber="8611"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, &#123;&#42;DL, TLInfo&#125;)) &#123;</Highlight></CodeLine>
<Link id="l08612" /><CodeLine lineNumber="8612"><Highlight kind="normal">      LargeOffsetGEPMap.erase(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</Highlight></CodeLine>
<Link id="l08613" /><CodeLine lineNumber="8613"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, V, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l08614" /><CodeLine lineNumber="8614"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l08615" /><CodeLine lineNumber="8615"><Highlight kind="normal">      ++NumPHIsElim;</Highlight></CodeLine>
<Link id="l08616" /><CodeLine lineNumber="8616"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08617" /><CodeLine lineNumber="8617"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08618" /><CodeLine lineNumber="8618"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08619" /><CodeLine lineNumber="8619"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08620" /><CodeLine lineNumber="8620"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08621" /><CodeLine lineNumber="8621"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CastInst &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08622" /><CodeLine lineNumber="8622"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the source of the cast is a constant, then this should have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08623" /><CodeLine lineNumber="8623"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// already been constant folded.  The only reason NOT to constant fold</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08624" /><CodeLine lineNumber="8624"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// it is if something (e.g. LSR) was careful to place the constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08625" /><CodeLine lineNumber="8625"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// evaluation in a block other than then one that uses it (e.g. to hoist</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08626" /><CodeLine lineNumber="8626"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the address of globals out of a loop).  If this is the case, we don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08627" /><CodeLine lineNumber="8627"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// want to forward-subst the cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08628" /><CodeLine lineNumber="8628"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</Highlight></CodeLine>
<Link id="l08629" /><CodeLine lineNumber="8629"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08630" /><CodeLine lineNumber="8630"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08631" /><CodeLine lineNumber="8631"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a>(CI, &#42;TLI, &#42;DL))</Highlight></CodeLine>
<Link id="l08632" /><CodeLine lineNumber="8632"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08633" /><CodeLine lineNumber="8633"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08634" /><CodeLine lineNumber="8634"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UIToFPInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SIToFPInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPToUIInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l08635" /><CodeLine lineNumber="8635"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l08636" /><CodeLine lineNumber="8636"><Highlight kind="normal">        TLI-&gt;optimizeExtendOrTruncateConversion(</Highlight></CodeLine>
<Link id="l08637" /><CodeLine lineNumber="8637"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LI-&gt;getLoopFor(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), &#42;TTI))</Highlight></CodeLine>
<Link id="l08638" /><CodeLine lineNumber="8638"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08639" /><CodeLine lineNumber="8639"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08640" /><CodeLine lineNumber="8640"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08641" /><CodeLine lineNumber="8641"><Highlight kind="comment">      /// Sink a zext or sext into its user blocks if the target type doesn&#39;t</Highlight></CodeLine>
<Link id="l08642" /><CodeLine lineNumber="8642"><Highlight kind="comment">      /// fit in one register</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08643" /><CodeLine lineNumber="8643"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI-&gt;getTypeAction(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(),</Highlight></CodeLine>
<Link id="l08644" /><CodeLine lineNumber="8644"><Highlight kind="normal">                             TLI-&gt;getValueType(&#42;DL, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) ==</Highlight></CodeLine>
<Link id="l08645" /><CodeLine lineNumber="8645"><Highlight kind="normal">          TargetLowering::TypeExpandInteger) &#123;</Highlight></CodeLine>
<Link id="l08646" /><CodeLine lineNumber="8646"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(CI);</Highlight></CodeLine>
<Link id="l08647" /><CodeLine lineNumber="8647"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08648" /><CodeLine lineNumber="8648"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TLI-&gt;optimizeExtendOrTruncateConversion(</Highlight></CodeLine>
<Link id="l08649" /><CodeLine lineNumber="8649"><Highlight kind="normal">                <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LI-&gt;getLoopFor(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), &#42;TTI))</Highlight></CodeLine>
<Link id="l08650" /><CodeLine lineNumber="8650"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08651" /><CodeLine lineNumber="8651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08652" /><CodeLine lineNumber="8652"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = optimizeExt(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l08653" /><CodeLine lineNumber="8653"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange | optimizeExtUses(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l08654" /><CodeLine lineNumber="8654"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08655" /><CodeLine lineNumber="8655"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08656" /><CodeLine lineNumber="8656"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08657" /><CodeLine lineNumber="8657"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08658" /><CodeLine lineNumber="8658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08659" /><CodeLine lineNumber="8659"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l08660" /><CodeLine lineNumber="8660"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (optimizeCmp(Cmp, ModifiedDT))</Highlight></CodeLine>
<Link id="l08661" /><CodeLine lineNumber="8661"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08662" /><CodeLine lineNumber="8662"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08663" /><CodeLine lineNumber="8663"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a11e5bad6c60d5c3cc5e7881bddd0204d">m&#95;URem</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</Highlight></CodeLine>
<Link id="l08664" /><CodeLine lineNumber="8664"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (optimizeURem(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l08665" /><CodeLine lineNumber="8665"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08666" /><CodeLine lineNumber="8666"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08667" /><CodeLine lineNumber="8667"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoadInst &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08668" /><CodeLine lineNumber="8668"><Highlight kind="normal">    LI-&gt;setMetadata(LLVMContext::MD&#95;invariant&#95;group, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08669" /><CodeLine lineNumber="8669"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = optimizeLoadExt(LI);</Highlight></CodeLine>
<Link id="l08670" /><CodeLine lineNumber="8670"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = LI-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l08671" /><CodeLine lineNumber="8671"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), LI-&gt;getType(), AS);</Highlight></CodeLine>
<Link id="l08672" /><CodeLine lineNumber="8672"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</Highlight></CodeLine>
<Link id="l08673" /><CodeLine lineNumber="8673"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08674" /><CodeLine lineNumber="8674"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08675" /><CodeLine lineNumber="8675"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StoreInst &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08676" /><CodeLine lineNumber="8676"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a>(&#42;SI, &#42;DL, &#42;TLI))</Highlight></CodeLine>
<Link id="l08677" /><CodeLine lineNumber="8677"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08678" /><CodeLine lineNumber="8678"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;setMetadata(LLVMContext::MD&#95;invariant&#95;group, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08679" /><CodeLine lineNumber="8679"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l08680" /><CodeLine lineNumber="8680"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperand(1),</Highlight></CodeLine>
<Link id="l08681" /><CodeLine lineNumber="8681"><Highlight kind="normal">                              <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperand(0)-&gt;getType(), AS);</Highlight></CodeLine>
<Link id="l08682" /><CodeLine lineNumber="8682"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08683" /><CodeLine lineNumber="8683"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08684" /><CodeLine lineNumber="8684"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AtomicRMWInst &#42;RMW = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicRMWInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08685" /><CodeLine lineNumber="8685"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = RMW-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l08686" /><CodeLine lineNumber="8686"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, RMW-&gt;getPointerOperand(), RMW-&gt;getType(), AS);</Highlight></CodeLine>
<Link id="l08687" /><CodeLine lineNumber="8687"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08688" /><CodeLine lineNumber="8688"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08689" /><CodeLine lineNumber="8689"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AtomicCmpXchgInst &#42;CmpX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicCmpXchgInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08690" /><CodeLine lineNumber="8690"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = CmpX-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l08691" /><CodeLine lineNumber="8691"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CmpX-&gt;getPointerOperand(),</Highlight></CodeLine>
<Link id="l08692" /><CodeLine lineNumber="8692"><Highlight kind="normal">                              CmpX-&gt;getCompareOperand()-&gt;getType(), AS);</Highlight></CodeLine>
<Link id="l08693" /><CodeLine lineNumber="8693"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08694" /><CodeLine lineNumber="8694"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08695" /><CodeLine lineNumber="8695"><Highlight kind="normal">  BinaryOperator &#42;BinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l08696" /><CodeLine lineNumber="8696"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08697" /><CodeLine lineNumber="8697"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BinOp &amp;&amp; BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::And &amp;&amp; <a href="#add2019bfb348f5241b4110eb77775410">EnableAndCmpSinking</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l08698" /><CodeLine lineNumber="8698"><Highlight kind="normal">      <a href="#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a>(BinOp, &#42;TLI, InsertedInsts))</Highlight></CodeLine>
<Link id="l08699" /><CodeLine lineNumber="8699"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08700" /><CodeLine lineNumber="8700"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08701" /><CodeLine lineNumber="8701"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Move this into the switch on opcode - it handles shifts already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08702" /><CodeLine lineNumber="8702"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BinOp &amp;&amp; (BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr ||</Highlight></CodeLine>
<Link id="l08703" /><CodeLine lineNumber="8703"><Highlight kind="normal">                BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::LShr)) &#123;</Highlight></CodeLine>
<Link id="l08704" /><CodeLine lineNumber="8704"><Highlight kind="normal">    ConstantInt &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(BinOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l08705" /><CodeLine lineNumber="8705"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI &amp;&amp; TLI-&gt;hasExtractBitsInsn())</Highlight></CodeLine>
<Link id="l08706" /><CodeLine lineNumber="8706"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a>(BinOp, CI, &#42;TLI, &#42;DL))</Highlight></CodeLine>
<Link id="l08707" /><CodeLine lineNumber="8707"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08708" /><CodeLine lineNumber="8708"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08709" /><CodeLine lineNumber="8709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08710" /><CodeLine lineNumber="8710"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GetElementPtrInst &#42;GEPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08711" /><CodeLine lineNumber="8711"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPI-&gt;hasAllZeroIndices()) &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08712" /><CodeLine lineNumber="8712"><Highlight kind="comment">      /// The GEP operand must be a pointer, so must its result -&gt; BitCast</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08713" /><CodeLine lineNumber="8713"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a> = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> BitCastInst(GEPI-&gt;getOperand(0), GEPI-&gt;getType(),</Highlight></CodeLine>
<Link id="l08714" /><CodeLine lineNumber="8714"><Highlight kind="normal">                                        GEPI-&gt;getName(), GEPI-&gt;getIterator());</Highlight></CodeLine>
<Link id="l08715" /><CodeLine lineNumber="8715"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a>-&gt;setDebugLoc(GEPI-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08716" /><CodeLine lineNumber="8716"><Highlight kind="normal">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(GEPI, <a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l08717" /><CodeLine lineNumber="8717"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</Highlight></CodeLine>
<Link id="l08718" /><CodeLine lineNumber="8718"><Highlight kind="normal">          GEPI, TLInfo, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l08719" /><CodeLine lineNumber="8719"><Highlight kind="normal">          &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</Highlight></CodeLine>
<Link id="l08720" /><CodeLine lineNumber="8720"><Highlight kind="normal">      ++NumGEPsElim;</Highlight></CodeLine>
<Link id="l08721" /><CodeLine lineNumber="8721"><Highlight kind="normal">      optimizeInst(<a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a>, ModifiedDT);</Highlight></CodeLine>
<Link id="l08722" /><CodeLine lineNumber="8722"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08723" /><CodeLine lineNumber="8723"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08724" /><CodeLine lineNumber="8724"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a>(GEPI, TTI)) &#123;</Highlight></CodeLine>
<Link id="l08725" /><CodeLine lineNumber="8725"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08726" /><CodeLine lineNumber="8726"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08727" /><CodeLine lineNumber="8727"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08728" /><CodeLine lineNumber="8728"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08729" /><CodeLine lineNumber="8729"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FreezeInst &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FreezeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08730" /><CodeLine lineNumber="8730"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// freeze(icmp a, const)) -&gt; icmp (freeze a), const</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08731" /><CodeLine lineNumber="8731"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This helps generate efficient conditional jumps.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08732" /><CodeLine lineNumber="8732"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CmpI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08733" /><CodeLine lineNumber="8733"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ICmpInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(FI-&gt;getOperand(0)))</Highlight></CodeLine>
<Link id="l08734" /><CodeLine lineNumber="8734"><Highlight kind="normal">      CmpI = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>;</Highlight></CodeLine>
<Link id="l08735" /><CodeLine lineNumber="8735"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FCmpInst &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FCmpInst&gt;</a>(FI-&gt;getOperand(0)))</Highlight></CodeLine>
<Link id="l08736" /><CodeLine lineNumber="8736"><Highlight kind="normal">      CmpI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>().<a href="/docs/api/classes/llvm/fastmathflags/#a3c72e480015b1ffdcd0382fa46437806">none</a>() ? <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08737" /><CodeLine lineNumber="8737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08738" /><CodeLine lineNumber="8738"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CmpI &amp;&amp; CmpI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</Highlight></CodeLine>
<Link id="l08739" /><CodeLine lineNumber="8739"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Op0 = CmpI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Op1 = CmpI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l08740" /><CodeLine lineNumber="8740"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Const0 = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Op0) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Op0) ||</Highlight></CodeLine>
<Link id="l08741" /><CodeLine lineNumber="8741"><Highlight kind="normal">                    <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(Op0);</Highlight></CodeLine>
<Link id="l08742" /><CodeLine lineNumber="8742"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Const1 = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Op1) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Op1) ||</Highlight></CodeLine>
<Link id="l08743" /><CodeLine lineNumber="8743"><Highlight kind="normal">                    <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(Op1);</Highlight></CodeLine>
<Link id="l08744" /><CodeLine lineNumber="8744"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Const0 || Const1) &#123;</Highlight></CodeLine>
<Link id="l08745" /><CodeLine lineNumber="8745"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Const0 || !Const1) &#123;</Highlight></CodeLine>
<Link id="l08746" /><CodeLine lineNumber="8746"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> FreezeInst(Const0 ? Op1 : Op0, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, CmpI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l08747" /><CodeLine lineNumber="8747"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;takeName(FI);</Highlight></CodeLine>
<Link id="l08748" /><CodeLine lineNumber="8748"><Highlight kind="normal">          CmpI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Const0 ? 1 : 0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l08749" /><CodeLine lineNumber="8749"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l08750" /><CodeLine lineNumber="8750"><Highlight kind="normal">        <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(FI, CmpI, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l08751" /><CodeLine lineNumber="8751"><Highlight kind="normal">        FI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l08752" /><CodeLine lineNumber="8752"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08753" /><CodeLine lineNumber="8753"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08754" /><CodeLine lineNumber="8754"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08755" /><CodeLine lineNumber="8755"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08756" /><CodeLine lineNumber="8756"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08757" /><CodeLine lineNumber="8757"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08758" /><CodeLine lineNumber="8758"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (tryToSinkFreeOperands(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l08759" /><CodeLine lineNumber="8759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08760" /><CodeLine lineNumber="8760"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08761" /><CodeLine lineNumber="8761"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l08762" /><CodeLine lineNumber="8762"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl:</Highlight></CodeLine>
<Link id="l08763" /><CodeLine lineNumber="8763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::LShr:</Highlight></CodeLine>
<Link id="l08764" /><CodeLine lineNumber="8764"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AShr:</Highlight></CodeLine>
<Link id="l08765" /><CodeLine lineNumber="8765"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeShiftInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l08766" /><CodeLine lineNumber="8766"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Call:</Highlight></CodeLine>
<Link id="l08767" /><CodeLine lineNumber="8767"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeCallInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), ModifiedDT);</Highlight></CodeLine>
<Link id="l08768" /><CodeLine lineNumber="8768"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Select:</Highlight></CodeLine>
<Link id="l08769" /><CodeLine lineNumber="8769"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeSelectInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l08770" /><CodeLine lineNumber="8770"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ShuffleVector:</Highlight></CodeLine>
<Link id="l08771" /><CodeLine lineNumber="8771"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeShuffleVectorInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l08772" /><CodeLine lineNumber="8772"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Switch:</Highlight></CodeLine>
<Link id="l08773" /><CodeLine lineNumber="8773"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeSwitchInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l08774" /><CodeLine lineNumber="8774"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ExtractElement:</Highlight></CodeLine>
<Link id="l08775" /><CodeLine lineNumber="8775"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> optimizeExtractElementInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ExtractElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l08776" /><CodeLine lineNumber="8776"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Br:</Highlight></CodeLine>
<Link id="l08777" /><CodeLine lineNumber="8777"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), &#42;TLI, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l08778" /><CodeLine lineNumber="8778"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08779" /><CodeLine lineNumber="8779"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08780" /><CodeLine lineNumber="8780"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08781" /><CodeLine lineNumber="8781"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08782" /><CodeLine lineNumber="8782"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08783" /><CodeLine lineNumber="8783"><Highlight kind="comment">/// Given an OR instruction, check to see if this is a bitreverse</Highlight></CodeLine>
<Link id="l08784" /><CodeLine lineNumber="8784"><Highlight kind="comment">/// idiom. If so, insert the new intrinsic and return true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08785" /><CodeLine lineNumber="8785"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::makeBitReverse(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l08786" /><CodeLine lineNumber="8786"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isIntegerTy() ||</Highlight></CodeLine>
<Link id="l08787" /><CodeLine lineNumber="8787"><Highlight kind="normal">      !TLI-&gt;isOperationLegalOrCustom(<a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aeea401cc0b7fa5aa6f4d3a0612140e1d">ISD::BITREVERSE</a>,</Highlight></CodeLine>
<Link id="l08788" /><CodeLine lineNumber="8788"><Highlight kind="normal">                                     TLI-&gt;getValueType(&#42;DL, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">)))</Highlight></CodeLine>
<Link id="l08789" /><CodeLine lineNumber="8789"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08790" /><CodeLine lineNumber="8790"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08791" /><CodeLine lineNumber="8791"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 4&gt; Insts;</Highlight></CodeLine>
<Link id="l08792" /><CodeLine lineNumber="8792"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a6c402f49fa595af618c5ad1500565d92">recognizeBSwapOrBitReverseIdiom</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, Insts))</Highlight></CodeLine>
<Link id="l08793" /><CodeLine lineNumber="8793"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08794" /><CodeLine lineNumber="8794"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;LastInst = Insts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>();</Highlight></CodeLine>
<Link id="l08795" /><CodeLine lineNumber="8795"><Highlight kind="normal">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LastInst, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</Highlight></CodeLine>
<Link id="l08796" /><CodeLine lineNumber="8796"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</Highlight></CodeLine>
<Link id="l08797" /><CodeLine lineNumber="8797"><Highlight kind="normal">      &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLInfo, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l08798" /><CodeLine lineNumber="8798"><Highlight kind="normal">      &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</Highlight></CodeLine>
<Link id="l08799" /><CodeLine lineNumber="8799"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08800" /><CodeLine lineNumber="8800"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08801" /><CodeLine lineNumber="8801"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08802" /><CodeLine lineNumber="8802"><Highlight kind="normal"></Highlight><Highlight kind="comment">// In this pass we look for GEP and cast instructions that are used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08803" /><CodeLine lineNumber="8803"><Highlight kind="normal"></Highlight><Highlight kind="comment">// across basic blocks and rewrite them to improve basic-block-at-a-time</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08804" /><CodeLine lineNumber="8804"><Highlight kind="normal"></Highlight><Highlight kind="comment">// selection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08805" /><CodeLine lineNumber="8805"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::optimizeBlock(BasicBlock &amp;BB, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l08806" /><CodeLine lineNumber="8806"><Highlight kind="normal">  SunkAddrs.clear();</Highlight></CodeLine>
<Link id="l08807" /><CodeLine lineNumber="8807"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08808" /><CodeLine lineNumber="8808"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08809" /><CodeLine lineNumber="8809"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08810" /><CodeLine lineNumber="8810"><Highlight kind="normal">    CurInstIterator = BB.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l08811" /><CodeLine lineNumber="8811"><Highlight kind="normal">    ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>;</Highlight></CodeLine>
<Link id="l08812" /><CodeLine lineNumber="8812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (CurInstIterator != BB.<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l08813" /><CodeLine lineNumber="8813"><Highlight kind="normal">      MadeChange |= optimizeInst(&amp;&#42;CurInstIterator++, ModifiedDT);</Highlight></CodeLine>
<Link id="l08814" /><CodeLine lineNumber="8814"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ModifiedDT != <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>) &#123;</Highlight></CodeLine>
<Link id="l08815" /><CodeLine lineNumber="8815"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// For huge function we tend to quickly go though the inner optmization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08816" /><CodeLine lineNumber="8816"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// opportunities in the BB. So we go back to the BB head to re-optimize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08817" /><CodeLine lineNumber="8817"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// each instruction instead of go back to the function head.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08818" /><CodeLine lineNumber="8818"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>) &#123;</Highlight></CodeLine>
<Link id="l08819" /><CodeLine lineNumber="8819"><Highlight kind="normal">          DT.reset();</Highlight></CodeLine>
<Link id="l08820" /><CodeLine lineNumber="8820"><Highlight kind="normal">          getDT(&#42;BB.<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</Highlight></CodeLine>
<Link id="l08821" /><CodeLine lineNumber="8821"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08822" /><CodeLine lineNumber="8822"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08823" /><CodeLine lineNumber="8823"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08824" /><CodeLine lineNumber="8824"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l08825" /><CodeLine lineNumber="8825"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08826" /><CodeLine lineNumber="8826"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08827" /><CodeLine lineNumber="8827"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (ModifiedDT == <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyDT::ModifyInstDT</a>);</Highlight></CodeLine>
<Link id="l08828" /><CodeLine lineNumber="8828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08829" /><CodeLine lineNumber="8829"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeBitReverse = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08830" /><CodeLine lineNumber="8830"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (MadeBitReverse) &#123;</Highlight></CodeLine>
<Link id="l08831" /><CodeLine lineNumber="8831"><Highlight kind="normal">    MadeBitReverse = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08832" /><CodeLine lineNumber="8832"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(BB)) &#123;</Highlight></CodeLine>
<Link id="l08833" /><CodeLine lineNumber="8833"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (makeBitReverse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08834" /><CodeLine lineNumber="8834"><Highlight kind="normal">        MadeBitReverse = MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08835" /><CodeLine lineNumber="8835"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08836" /><CodeLine lineNumber="8836"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08837" /><CodeLine lineNumber="8837"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08838" /><CodeLine lineNumber="8838"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08839" /><CodeLine lineNumber="8839"><Highlight kind="normal">  MadeChange |= dupRetToEnableTailCallOpts(&amp;BB, ModifiedDT);</Highlight></CodeLine>
<Link id="l08840" /><CodeLine lineNumber="8840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08841" /><CodeLine lineNumber="8841"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l08842" /><CodeLine lineNumber="8842"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08843" /><CodeLine lineNumber="8843"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08844" /><CodeLine lineNumber="8844"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Some CGP optimizations may move or alter what&#39;s computed in a block. Check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08845" /><CodeLine lineNumber="8845"><Highlight kind="normal"></Highlight><Highlight kind="comment">// whether a dbg.value intrinsic could be pointed at a more appropriate operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08846" /><CodeLine lineNumber="8846"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::fixupDbgValue(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l08847" /><CodeLine lineNumber="8847"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgValueInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l08848" /><CodeLine lineNumber="8848"><Highlight kind="normal">  DbgValueInst &amp;DVI = &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgValueInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l08849" /><CodeLine lineNumber="8849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08850" /><CodeLine lineNumber="8850"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Does this dbg.value refer to a sunk address calculation?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08851" /><CodeLine lineNumber="8851"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AnyChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08852" /><CodeLine lineNumber="8852"><Highlight kind="normal">  SmallDenseSet&lt;Value &#42;&gt; LocationOps(DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a1aee0a03668ffd951c891317d8a0c30e">location&#95;ops</a>().begin(),</Highlight></CodeLine>
<Link id="l08853" /><CodeLine lineNumber="8853"><Highlight kind="normal">                                     DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a1aee0a03668ffd951c891317d8a0c30e">location&#95;ops</a>().end());</Highlight></CodeLine>
<Link id="l08854" /><CodeLine lineNumber="8854"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Location : LocationOps) &#123;</Highlight></CodeLine>
<Link id="l08855" /><CodeLine lineNumber="8855"><Highlight kind="normal">    WeakTrackingVH SunkAddrVH = SunkAddrs&#91;<a href="/docs/api/namespaces/anonymous-x86discriminatememops-cpp-/#aa0e9eb09c84a691bb23afcad7d960e03">Location</a>&#93;;</Highlight></CodeLine>
<Link id="l08856" /><CodeLine lineNumber="8856"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SunkAddr = SunkAddrVH.<a href="/docs/api/classes/llvm/weaktrackingvh/#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08857" /><CodeLine lineNumber="8857"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAddr) &#123;</Highlight></CodeLine>
<Link id="l08858" /><CodeLine lineNumber="8858"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Point dbg.value at locally computed address, which should give the best</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08859" /><CodeLine lineNumber="8859"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// opportunity to be accurately lowered. This update may change the type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08860" /><CodeLine lineNumber="8860"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// of pointer being referred to; however this makes no difference to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08861" /><CodeLine lineNumber="8861"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// debugging information, and we can&#39;t generate bitcasts that may affect</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08862" /><CodeLine lineNumber="8862"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// codegen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08863" /><CodeLine lineNumber="8863"><Highlight kind="normal">      DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a3d995a069d73ebebbd6a4aace342ef76">replaceVariableLocationOp</a>(Location, SunkAddr);</Highlight></CodeLine>
<Link id="l08864" /><CodeLine lineNumber="8864"><Highlight kind="normal">      AnyChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08865" /><CodeLine lineNumber="8865"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08866" /><CodeLine lineNumber="8866"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08867" /><CodeLine lineNumber="8867"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08868" /><CodeLine lineNumber="8868"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08869" /><CodeLine lineNumber="8869"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08870" /><CodeLine lineNumber="8870"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::fixupDbgVariableRecordsOnInst(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l08871" /><CodeLine lineNumber="8871"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AnyChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08872" /><CodeLine lineNumber="8872"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (DbgVariableRecord &amp;DVR : <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDbgRecordRange()))</Highlight></CodeLine>
<Link id="l08873" /><CodeLine lineNumber="8873"><Highlight kind="normal">    AnyChange |= fixupDbgVariableRecord(DVR);</Highlight></CodeLine>
<Link id="l08874" /><CodeLine lineNumber="8874"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08875" /><CodeLine lineNumber="8875"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08876" /><CodeLine lineNumber="8876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08877" /><CodeLine lineNumber="8877"><Highlight kind="normal"></Highlight><Highlight kind="comment">// FIXME: should updating debug-info really cause the &quot;changed&quot; flag to fire,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08878" /><CodeLine lineNumber="8878"><Highlight kind="normal"></Highlight><Highlight kind="comment">// which can cause a function to be reprocessed?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08879" /><CodeLine lineNumber="8879"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::fixupDbgVariableRecord(DbgVariableRecord &amp;DVR) &#123;</Highlight></CodeLine>
<Link id="l08880" /><CodeLine lineNumber="8880"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a3412d15543a66c3770500c3f2ba181c3">Type</a> != DbgVariableRecord::LocationType::Value &amp;&amp;</Highlight></CodeLine>
<Link id="l08881" /><CodeLine lineNumber="8881"><Highlight kind="normal">      DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a3412d15543a66c3770500c3f2ba181c3">Type</a> != DbgVariableRecord::LocationType::Assign)</Highlight></CodeLine>
<Link id="l08882" /><CodeLine lineNumber="8882"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08883" /><CodeLine lineNumber="8883"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08884" /><CodeLine lineNumber="8884"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Does this DbgVariableRecord refer to a sunk address calculation?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08885" /><CodeLine lineNumber="8885"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AnyChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08886" /><CodeLine lineNumber="8886"><Highlight kind="normal">  SmallDenseSet&lt;Value &#42;&gt; LocationOps(DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#afd3574da4a2a86d1540dbdfcef171dd8">location&#95;ops</a>().begin(),</Highlight></CodeLine>
<Link id="l08887" /><CodeLine lineNumber="8887"><Highlight kind="normal">                                     DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#afd3574da4a2a86d1540dbdfcef171dd8">location&#95;ops</a>().end());</Highlight></CodeLine>
<Link id="l08888" /><CodeLine lineNumber="8888"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Location : LocationOps) &#123;</Highlight></CodeLine>
<Link id="l08889" /><CodeLine lineNumber="8889"><Highlight kind="normal">    WeakTrackingVH SunkAddrVH = SunkAddrs&#91;<a href="/docs/api/namespaces/anonymous-x86discriminatememops-cpp-/#aa0e9eb09c84a691bb23afcad7d960e03">Location</a>&#93;;</Highlight></CodeLine>
<Link id="l08890" /><CodeLine lineNumber="8890"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SunkAddr = SunkAddrVH.<a href="/docs/api/classes/llvm/weaktrackingvh/#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08891" /><CodeLine lineNumber="8891"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAddr) &#123;</Highlight></CodeLine>
<Link id="l08892" /><CodeLine lineNumber="8892"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Point dbg.value at locally computed address, which should give the best</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08893" /><CodeLine lineNumber="8893"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// opportunity to be accurately lowered. This update may change the type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08894" /><CodeLine lineNumber="8894"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// of pointer being referred to; however this makes no difference to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08895" /><CodeLine lineNumber="8895"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// debugging information, and we can&#39;t generate bitcasts that may affect</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08896" /><CodeLine lineNumber="8896"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// codegen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08897" /><CodeLine lineNumber="8897"><Highlight kind="normal">      DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#ae0ac412244054beacd97e316ded0fed3">replaceVariableLocationOp</a>(Location, SunkAddr);</Highlight></CodeLine>
<Link id="l08898" /><CodeLine lineNumber="8898"><Highlight kind="normal">      AnyChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08899" /><CodeLine lineNumber="8899"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08900" /><CodeLine lineNumber="8900"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08901" /><CodeLine lineNumber="8901"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AnyChange;</Highlight></CodeLine>
<Link id="l08902" /><CodeLine lineNumber="8902"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08903" /><CodeLine lineNumber="8903"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08904" /><CodeLine lineNumber="8904" lineLink="#a5a43b0bc7c25aaaa14cf3d79d7f13c78"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a>(<a href="/docs/api/classes/llvm/dbgvalueinst">DbgValueInst</a> &#42;DVI, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI) &#123;</Highlight></CodeLine>
<Link id="l08905" /><CodeLine lineNumber="8905"><Highlight kind="normal">  DVI-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</Highlight></CodeLine>
<Link id="l08906" /><CodeLine lineNumber="8906"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(VI))</Highlight></CodeLine>
<Link id="l08907" /><CodeLine lineNumber="8907"><Highlight kind="normal">    DVI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(VI-&gt;getParent()-&gt;getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l08908" /><CodeLine lineNumber="8908"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08909" /><CodeLine lineNumber="8909"><Highlight kind="normal">    DVI-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(VI);</Highlight></CodeLine>
<Link id="l08910" /><CodeLine lineNumber="8910"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08911" /><CodeLine lineNumber="8911"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08912" /><CodeLine lineNumber="8912" lineLink="#ac8803aa267830622708ede7b732c7ae2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a>(<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI) &#123;</Highlight></CodeLine>
<Link id="l08913" /><CodeLine lineNumber="8913"><Highlight kind="normal">  DVR-&gt;<a href="/docs/api/classes/llvm/dbgrecord/#a04a8b2dc4d72db72e1f87bdec4074973">removeFromParent</a>();</Highlight></CodeLine>
<Link id="l08914" /><CodeLine lineNumber="8914"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;VIBB = VI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l08915" /><CodeLine lineNumber="8915"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(VI))</Highlight></CodeLine>
<Link id="l08916" /><CodeLine lineNumber="8916"><Highlight kind="normal">    VIBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a365301682c41f8a7094218176d712cda">insertDbgRecordBefore</a>(DVR, VIBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</Highlight></CodeLine>
<Link id="l08917" /><CodeLine lineNumber="8917"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08918" /><CodeLine lineNumber="8918"><Highlight kind="normal">    VIBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a930f97c50e2e4eddb8a6cd55a4dfd5bd">insertDbgRecordAfter</a>(DVR, &amp;&#42;VI);</Highlight></CodeLine>
<Link id="l08919" /><CodeLine lineNumber="8919"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08920" /><CodeLine lineNumber="8920"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08921" /><CodeLine lineNumber="8921"><Highlight kind="normal"></Highlight><Highlight kind="comment">// A llvm.dbg.value may be using a value before its definition, due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08922" /><CodeLine lineNumber="8922"><Highlight kind="normal"></Highlight><Highlight kind="comment">// optimizations in this pass and others. Scan for such dbg.values, and rescue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08923" /><CodeLine lineNumber="8923"><Highlight kind="normal"></Highlight><Highlight kind="comment">// them by moving the dbg.value to immediately after the value definition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08924" /><CodeLine lineNumber="8924"><Highlight kind="normal"></Highlight><Highlight kind="comment">// FIXME: Ideally this should never be necessary, and this has the potential</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08925" /><CodeLine lineNumber="8925"><Highlight kind="normal"></Highlight><Highlight kind="comment">// to re-order dbg.value intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08926" /><CodeLine lineNumber="8926"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::placeDbgValues(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l08927" /><CodeLine lineNumber="8927"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08928" /><CodeLine lineNumber="8928"><Highlight kind="normal">  DominatorTree DT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l08929" /><CodeLine lineNumber="8929"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08930" /><CodeLine lineNumber="8930"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DbgProcessor = &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DbgItem, <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/anonymous-simemorylegalizer-cpp-/#a9e7ad3c4e4254ff96b3ddbd4a6515dc2">Position</a>) &#123;</Highlight></CodeLine>
<Link id="l08931" /><CodeLine lineNumber="8931"><Highlight kind="normal">    SmallVector&lt;Instruction &#42;, 4&gt; VIs;</Highlight></CodeLine>
<Link id="l08932" /><CodeLine lineNumber="8932"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V : DbgItem-&gt;location&#95;ops())</Highlight></CodeLine>
<Link id="l08933" /><CodeLine lineNumber="8933"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Instruction &#42;VI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(V))</Highlight></CodeLine>
<Link id="l08934" /><CodeLine lineNumber="8934"><Highlight kind="normal">        VIs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VI);</Highlight></CodeLine>
<Link id="l08935" /><CodeLine lineNumber="8935"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08936" /><CodeLine lineNumber="8936"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This item may depend on multiple instructions, complicating any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08937" /><CodeLine lineNumber="8937"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// potential sink. This block takes the defensive approach, opting to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08938" /><CodeLine lineNumber="8938"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &quot;undef&quot; the item if it has more than one instruction and any of them do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08939" /><CodeLine lineNumber="8939"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// not dominate iem.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08940" /><CodeLine lineNumber="8940"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;VI : VIs) &#123;</Highlight></CodeLine>
<Link id="l08941" /><CodeLine lineNumber="8941"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a4a23b2b2d70dd9f7a94a1215e62cb0a0">VI</a>-&gt;isTerminator())</Highlight></CodeLine>
<Link id="l08942" /><CodeLine lineNumber="8942"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08943" /><CodeLine lineNumber="8943"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08944" /><CodeLine lineNumber="8944"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If VI is a phi in a block with an EHPad terminator, we can&#39;t insert</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08945" /><CodeLine lineNumber="8945"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// after it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08946" /><CodeLine lineNumber="8946"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(VI) &amp;&amp; <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a4a23b2b2d70dd9f7a94a1215e62cb0a0">VI</a>-&gt;getParent()-&gt;getTerminator()-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l08947" /><CodeLine lineNumber="8947"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08948" /><CodeLine lineNumber="8948"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08949" /><CodeLine lineNumber="8949"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the defining instruction dominates the dbg.value, we do not need</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08950" /><CodeLine lineNumber="8950"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to move the dbg.value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08951" /><CodeLine lineNumber="8951"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DT.dominates(VI, Position))</Highlight></CodeLine>
<Link id="l08952" /><CodeLine lineNumber="8952"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08953" /><CodeLine lineNumber="8953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08954" /><CodeLine lineNumber="8954"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we depend on multiple instructions and any of them doesn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08955" /><CodeLine lineNumber="8955"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// dominate this DVI, we probably can&#39;t salvage it: moving it to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08956" /><CodeLine lineNumber="8956"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// after any of the instructions could cause us to lose the others.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08957" /><CodeLine lineNumber="8957"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VIs.size() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l08958" /><CodeLine lineNumber="8958"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l08959" /><CodeLine lineNumber="8959"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l08960" /><CodeLine lineNumber="8960"><Highlight kind="normal">            &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Unable to find valid location for Debug Value, undefing:\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08961" /><CodeLine lineNumber="8961"><Highlight kind="normal">            &lt;&lt; &#42;DbgItem);</Highlight></CodeLine>
<Link id="l08962" /><CodeLine lineNumber="8962"><Highlight kind="normal">        DbgItem-&gt;setKillLocation();</Highlight></CodeLine>
<Link id="l08963" /><CodeLine lineNumber="8963"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08964" /><CodeLine lineNumber="8964"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08965" /><CodeLine lineNumber="8965"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08966" /><CodeLine lineNumber="8966"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Moving Debug Value before :\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08967" /><CodeLine lineNumber="8967"><Highlight kind="normal">                        &lt;&lt; &#42;DbgItem &lt;&lt; </Highlight><Highlight kind="charliteral">&#39; &#39;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;VI);</Highlight></CodeLine>
<Link id="l08968" /><CodeLine lineNumber="8968"><Highlight kind="normal">      <a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a>(DbgItem, <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a4a23b2b2d70dd9f7a94a1215e62cb0a0">VI</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l08969" /><CodeLine lineNumber="8969"><Highlight kind="normal">      MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08970" /><CodeLine lineNumber="8970"><Highlight kind="normal">      ++NumDbgValueMoved;</Highlight></CodeLine>
<Link id="l08971" /><CodeLine lineNumber="8971"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08972" /><CodeLine lineNumber="8972"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l08973" /><CodeLine lineNumber="8973"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08974" /><CodeLine lineNumber="8974"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l08975" /><CodeLine lineNumber="8975"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(BB)) &#123;</Highlight></CodeLine>
<Link id="l08976" /><CodeLine lineNumber="8976"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Process dbg.value intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08977" /><CodeLine lineNumber="8977"><Highlight kind="normal">      DbgValueInst &#42;DVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgValueInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>);</Highlight></CodeLine>
<Link id="l08978" /><CodeLine lineNumber="8978"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVI) &#123;</Highlight></CodeLine>
<Link id="l08979" /><CodeLine lineNumber="8979"><Highlight kind="normal">        DbgProcessor(DVI, DVI);</Highlight></CodeLine>
<Link id="l08980" /><CodeLine lineNumber="8980"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08981" /><CodeLine lineNumber="8981"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08982" /><CodeLine lineNumber="8982"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08983" /><CodeLine lineNumber="8983"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this isn&#39;t a dbg.value, process any attached DbgVariableRecord</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08984" /><CodeLine lineNumber="8984"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// records attached to this instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08985" /><CodeLine lineNumber="8985"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (DbgVariableRecord &amp;DVR : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(</Highlight></CodeLine>
<Link id="l08986" /><CodeLine lineNumber="8986"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>.getDbgRecordRange()))) &#123;</Highlight></CodeLine>
<Link id="l08987" /><CodeLine lineNumber="8987"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a3412d15543a66c3770500c3f2ba181c3">Type</a> != DbgVariableRecord::LocationType::Value)</Highlight></CodeLine>
<Link id="l08988" /><CodeLine lineNumber="8988"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08989" /><CodeLine lineNumber="8989"><Highlight kind="normal">        DbgProcessor(&amp;DVR, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>);</Highlight></CodeLine>
<Link id="l08990" /><CodeLine lineNumber="8990"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l08991" /><CodeLine lineNumber="8991"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08992" /><CodeLine lineNumber="8992"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08993" /><CodeLine lineNumber="8993"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08994" /><CodeLine lineNumber="8994"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l08995" /><CodeLine lineNumber="8995"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08996" /><CodeLine lineNumber="8996"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08997" /><CodeLine lineNumber="8997"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Group scattered pseudo probes in a block to favor SelectionDAG. Scattered</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08998" /><CodeLine lineNumber="8998"><Highlight kind="normal"></Highlight><Highlight kind="comment">// probes can be chained dependencies of other regular DAG nodes and block DAG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08999" /><CodeLine lineNumber="8999"><Highlight kind="normal"></Highlight><Highlight kind="comment">// combine optimizations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09000" /><CodeLine lineNumber="9000"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::placePseudoProbes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l09001" /><CodeLine lineNumber="9001"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09002" /><CodeLine lineNumber="9002"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l09003" /><CodeLine lineNumber="9003"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Move the rest probes to the beginning of the block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09004" /><CodeLine lineNumber="9004"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FirstInst = <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.getFirstInsertionPt();</Highlight></CodeLine>
<Link id="l09005" /><CodeLine lineNumber="9005"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (FirstInst != <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.end() &amp;&amp; FirstInst-&gt;isDebugOrPseudoInst())</Highlight></CodeLine>
<Link id="l09006" /><CodeLine lineNumber="9006"><Highlight kind="normal">      ++FirstInst;</Highlight></CodeLine>
<Link id="l09007" /><CodeLine lineNumber="9007"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>(FirstInst);</Highlight></CodeLine>
<Link id="l09008" /><CodeLine lineNumber="9008"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</Highlight></CodeLine>
<Link id="l09009" /><CodeLine lineNumber="9009"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.end()) &#123;</Highlight></CodeLine>
<Link id="l09010" /><CodeLine lineNumber="9010"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PseudoProbeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++)) &#123;</Highlight></CodeLine>
<Link id="l09011" /><CodeLine lineNumber="9011"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;moveBefore(FirstInst);</Highlight></CodeLine>
<Link id="l09012" /><CodeLine lineNumber="9012"><Highlight kind="normal">        MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09013" /><CodeLine lineNumber="9013"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09014" /><CodeLine lineNumber="9014"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09015" /><CodeLine lineNumber="9015"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09016" /><CodeLine lineNumber="9016"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l09017" /><CodeLine lineNumber="9017"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09018" /><CodeLine lineNumber="9018"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l09019" /><CodeLine lineNumber="9019"><Highlight kind="comment">/// Scale down both weights to fit into uint32&#95;t.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09020" /><CodeLine lineNumber="9020" lineLink="#a25c5d0cb41bbb1777e779a8da35e7bd4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(uint64&#95;t &amp;NewTrue, uint64&#95;t &amp;NewFalse) &#123;</Highlight></CodeLine>
<Link id="l09021" /><CodeLine lineNumber="9021"><Highlight kind="normal">  uint64&#95;t NewMax = (NewTrue &gt; NewFalse) ? NewTrue : NewFalse;</Highlight></CodeLine>
<Link id="l09022" /><CodeLine lineNumber="9022"><Highlight kind="normal">  uint32&#95;t Scale = (NewMax / std::numeric&#95;limits&lt;uint32&#95;t&gt;::max()) + 1;</Highlight></CodeLine>
<Link id="l09023" /><CodeLine lineNumber="9023"><Highlight kind="normal">  NewTrue = NewTrue / Scale;</Highlight></CodeLine>
<Link id="l09024" /><CodeLine lineNumber="9024"><Highlight kind="normal">  NewFalse = NewFalse / Scale;</Highlight></CodeLine>
<Link id="l09025" /><CodeLine lineNumber="9025"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09026" /><CodeLine lineNumber="9026"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l09027" /><CodeLine lineNumber="9027"><Highlight kind="comment">/// Some targets prefer to split a conditional branch like:</Highlight></CodeLine>
<Link id="l09028" /><CodeLine lineNumber="9028"><Highlight kind="comment">/// \\code</Highlight></CodeLine>
<Link id="l09029" /><CodeLine lineNumber="9029"><Highlight kind="comment">///   %0 = icmp ne i32 %a, 0</Highlight></CodeLine>
<Link id="l09030" /><CodeLine lineNumber="9030"><Highlight kind="comment">///   %1 = icmp ne i32 %b, 0</Highlight></CodeLine>
<Link id="l09031" /><CodeLine lineNumber="9031"><Highlight kind="comment">///   %or.cond = or i1 %0, %1</Highlight></CodeLine>
<Link id="l09032" /><CodeLine lineNumber="9032"><Highlight kind="comment">///   br i1 %or.cond, label %TrueBB, label %FalseBB</Highlight></CodeLine>
<Link id="l09033" /><CodeLine lineNumber="9033"><Highlight kind="comment">/// \\endcode</Highlight></CodeLine>
<Link id="l09034" /><CodeLine lineNumber="9034"><Highlight kind="comment">/// into multiple branch instructions like:</Highlight></CodeLine>
<Link id="l09035" /><CodeLine lineNumber="9035"><Highlight kind="comment">/// \\code</Highlight></CodeLine>
<Link id="l09036" /><CodeLine lineNumber="9036"><Highlight kind="comment">///   bb1:</Highlight></CodeLine>
<Link id="l09037" /><CodeLine lineNumber="9037"><Highlight kind="comment">///     %0 = icmp ne i32 %a, 0</Highlight></CodeLine>
<Link id="l09038" /><CodeLine lineNumber="9038"><Highlight kind="comment">///     br i1 %0, label %TrueBB, label %bb2</Highlight></CodeLine>
<Link id="l09039" /><CodeLine lineNumber="9039"><Highlight kind="comment">///   bb2:</Highlight></CodeLine>
<Link id="l09040" /><CodeLine lineNumber="9040"><Highlight kind="comment">///     %1 = icmp ne i32 %b, 0</Highlight></CodeLine>
<Link id="l09041" /><CodeLine lineNumber="9041"><Highlight kind="comment">///     br i1 %1, label %TrueBB, label %FalseBB</Highlight></CodeLine>
<Link id="l09042" /><CodeLine lineNumber="9042"><Highlight kind="comment">/// \\endcode</Highlight></CodeLine>
<Link id="l09043" /><CodeLine lineNumber="9043"><Highlight kind="comment">/// This usually allows instruction selection to do even further optimizations</Highlight></CodeLine>
<Link id="l09044" /><CodeLine lineNumber="9044"><Highlight kind="comment">/// and combine the compare with the branch instruction. Currently this is</Highlight></CodeLine>
<Link id="l09045" /><CodeLine lineNumber="9045"><Highlight kind="comment">/// applied for targets which have &quot;cheap&quot; jump instructions.</Highlight></CodeLine>
<Link id="l09046" /><CodeLine lineNumber="9046"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l09047" /><CodeLine lineNumber="9047"><Highlight kind="comment">/// FIXME: Remove the (equivalent?) implementation in SelectionDAG.</Highlight></CodeLine>
<Link id="l09048" /><CodeLine lineNumber="9048"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09049" /><CodeLine lineNumber="9049"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CodeGenPrepare::splitBranchCondition(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &amp;ModifiedDT) &#123;</Highlight></CodeLine>
<Link id="l09050" /><CodeLine lineNumber="9050"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TM-&gt;Options.EnableFastISel || TLI-&gt;isJumpExpensive())</Highlight></CodeLine>
<Link id="l09051" /><CodeLine lineNumber="9051"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09052" /><CodeLine lineNumber="9052"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09053" /><CodeLine lineNumber="9053"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09054" /><CodeLine lineNumber="9054"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l09055" /><CodeLine lineNumber="9055"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Does this BB end with the following?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09056" /><CodeLine lineNumber="9056"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   %cond1 = icmp|fcmp|binary instruction ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09057" /><CodeLine lineNumber="9057"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   %cond2 = icmp|fcmp|binary instruction ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09058" /><CodeLine lineNumber="9058"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   %cond.or = or|and i1 %cond1, cond2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09059" /><CodeLine lineNumber="9059"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   br i1 %cond.or label %dest1, label %dest2&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09060" /><CodeLine lineNumber="9060"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;LogicOp;</Highlight></CodeLine>
<Link id="l09061" /><CodeLine lineNumber="9061"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, &#42;FBB;</Highlight></CodeLine>
<Link id="l09062" /><CodeLine lineNumber="9062"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</Highlight></CodeLine>
<Link id="l09063" /><CodeLine lineNumber="9063"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/patternmatch/#a811d001fa503a556ac2a48d64366500f">m&#95;Br</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(LogicOp)), <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB)))</Highlight></CodeLine>
<Link id="l09064" /><CodeLine lineNumber="9064"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09065" /><CodeLine lineNumber="9065"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09066" /><CodeLine lineNumber="9066"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Br1 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l09067" /><CodeLine lineNumber="9067"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Br1-&gt;getMetadata(LLVMContext::MD&#95;unpredictable))</Highlight></CodeLine>
<Link id="l09068" /><CodeLine lineNumber="9068"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09069" /><CodeLine lineNumber="9069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09070" /><CodeLine lineNumber="9070"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The merging of mostly empty BB can cause a degenerate branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09071" /><CodeLine lineNumber="9071"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> == FBB)</Highlight></CodeLine>
<Link id="l09072" /><CodeLine lineNumber="9072"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09073" /><CodeLine lineNumber="9073"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09074" /><CodeLine lineNumber="9074"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opc;</Highlight></CodeLine>
<Link id="l09075" /><CodeLine lineNumber="9075"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Cond1, &#42;Cond2;</Highlight></CodeLine>
<Link id="l09076" /><CodeLine lineNumber="9076"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LogicOp,</Highlight></CodeLine>
<Link id="l09077" /><CodeLine lineNumber="9077"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond1)), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond2)))))</Highlight></CodeLine>
<Link id="l09078" /><CodeLine lineNumber="9078"><Highlight kind="normal">      Opc = Instruction::And;</Highlight></CodeLine>
<Link id="l09079" /><CodeLine lineNumber="9079"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LogicOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond1)),</Highlight></CodeLine>
<Link id="l09080" /><CodeLine lineNumber="9080"><Highlight kind="normal">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond2)))))</Highlight></CodeLine>
<Link id="l09081" /><CodeLine lineNumber="9081"><Highlight kind="normal">      Opc = Instruction::Or;</Highlight></CodeLine>
<Link id="l09082" /><CodeLine lineNumber="9082"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09083" /><CodeLine lineNumber="9083"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09084" /><CodeLine lineNumber="9084"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09085" /><CodeLine lineNumber="9085"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsGoodCond = &#91;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &#123;</Highlight></CodeLine>
<Link id="l09086" /><CodeLine lineNumber="9086"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</Highlight></CodeLine>
<Link id="l09087" /><CodeLine lineNumber="9087"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>,</Highlight></CodeLine>
<Link id="l09088" /><CodeLine lineNumber="9088"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a7d9ab823fe85606fa795c0c6fc75aca6">m&#95;Cmp</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()),</Highlight></CodeLine>
<Link id="l09089" /><CodeLine lineNumber="9089"><Highlight kind="normal">                                           <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))));</Highlight></CodeLine>
<Link id="l09090" /><CodeLine lineNumber="9090"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l09091" /><CodeLine lineNumber="9091"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsGoodCond(Cond1) || !IsGoodCond(Cond2))</Highlight></CodeLine>
<Link id="l09092" /><CodeLine lineNumber="9092"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09093" /><CodeLine lineNumber="9093"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09094" /><CodeLine lineNumber="9094"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Before branch condition splitting\\n&quot;</Highlight><Highlight kind="normal">; BB.<a href="/docs/api/classes/llvm/value/#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>());</Highlight></CodeLine>
<Link id="l09095" /><CodeLine lineNumber="9095"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09096" /><CodeLine lineNumber="9096"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create a new BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09097" /><CodeLine lineNumber="9097"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;TmpBB =</Highlight></CodeLine>
<Link id="l09098" /><CodeLine lineNumber="9098"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), BB.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.cond.split&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l09099" /><CodeLine lineNumber="9099"><Highlight kind="normal">                           BB.<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), BB.<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</Highlight></CodeLine>
<Link id="l09100" /><CodeLine lineNumber="9100"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>)</Highlight></CodeLine>
<Link id="l09101" /><CodeLine lineNumber="9101"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(TmpBB);</Highlight></CodeLine>
<Link id="l09102" /><CodeLine lineNumber="9102"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09103" /><CodeLine lineNumber="9103"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update original basic block by using the first condition directly by the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09104" /><CodeLine lineNumber="9104"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// branch instruction and removing the no longer needed and/or instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09105" /><CodeLine lineNumber="9105"><Highlight kind="normal">    Br1-&gt;setCondition(Cond1);</Highlight></CodeLine>
<Link id="l09106" /><CodeLine lineNumber="9106"><Highlight kind="normal">    LogicOp-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l09107" /><CodeLine lineNumber="9107"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09108" /><CodeLine lineNumber="9108"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Depending on the condition we have to either replace the true or the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09109" /><CodeLine lineNumber="9109"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// false successor of the original branch instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09110" /><CodeLine lineNumber="9110"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opc == Instruction::And)</Highlight></CodeLine>
<Link id="l09111" /><CodeLine lineNumber="9111"><Highlight kind="normal">      Br1-&gt;setSuccessor(0, TmpBB);</Highlight></CodeLine>
<Link id="l09112" /><CodeLine lineNumber="9112"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09113" /><CodeLine lineNumber="9113"><Highlight kind="normal">      Br1-&gt;setSuccessor(1, TmpBB);</Highlight></CodeLine>
<Link id="l09114" /><CodeLine lineNumber="9114"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09115" /><CodeLine lineNumber="9115"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Fill in the new basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09116" /><CodeLine lineNumber="9116"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Br2 = <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a>(TmpBB).CreateCondBr(Cond2, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB);</Highlight></CodeLine>
<Link id="l09117" /><CodeLine lineNumber="9117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Cond2)) &#123;</Highlight></CodeLine>
<Link id="l09118" /><CodeLine lineNumber="9118"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;removeFromParent();</Highlight></CodeLine>
<Link id="l09119" /><CodeLine lineNumber="9119"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;insertBefore(Br2-&gt;getIterator());</Highlight></CodeLine>
<Link id="l09120" /><CodeLine lineNumber="9120"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09121" /><CodeLine lineNumber="9121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09122" /><CodeLine lineNumber="9122"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update PHI nodes in both successors. The original BB needs to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09123" /><CodeLine lineNumber="9123"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// replaced in one successor&#39;s PHI nodes, because the branch comes now from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09124" /><CodeLine lineNumber="9124"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the newly generated BB (NewBB). In the other successor we need to add one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09125" /><CodeLine lineNumber="9125"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// incoming edge to the PHI nodes, because both branch instructions target</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09126" /><CodeLine lineNumber="9126"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// now the same successor. Depending on the original branch condition</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09127" /><CodeLine lineNumber="9127"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (and/or) we have to swap the successors (TrueDest, FalseDest), so that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09128" /><CodeLine lineNumber="9128"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we perform the correct update for the PHI nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09129" /><CodeLine lineNumber="9129"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This doesn&#39;t change the successor order of the just created branch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09130" /><CodeLine lineNumber="9130"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction (or any other instruction).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09131" /><CodeLine lineNumber="9131"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opc == Instruction::Or)</Highlight></CodeLine>
<Link id="l09132" /><CodeLine lineNumber="9132"><Highlight kind="normal">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB);</Highlight></CodeLine>
<Link id="l09133" /><CodeLine lineNumber="9133"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09134" /><CodeLine lineNumber="9134"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace the old BB with the new BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09135" /><CodeLine lineNumber="9135"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>-&gt;replacePhiUsesWith(&amp;BB, TmpBB);</Highlight></CodeLine>
<Link id="l09136" /><CodeLine lineNumber="9136"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09137" /><CodeLine lineNumber="9137"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add another incoming edge from the new BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09138" /><CodeLine lineNumber="9138"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (PHINode &amp;PN : FBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l09139" /><CodeLine lineNumber="9139"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Val = PN.<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(&amp;BB);</Highlight></CodeLine>
<Link id="l09140" /><CodeLine lineNumber="9140"><Highlight kind="normal">      PN.<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Val, TmpBB);</Highlight></CodeLine>
<Link id="l09141" /><CodeLine lineNumber="9141"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09142" /><CodeLine lineNumber="9142"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09143" /><CodeLine lineNumber="9143"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update the branch weights (from SelectionDAGBuilder::</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09144" /><CodeLine lineNumber="9144"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FindMergedConditions).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09145" /><CodeLine lineNumber="9145"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opc == Instruction::Or) &#123;</Highlight></CodeLine>
<Link id="l09146" /><CodeLine lineNumber="9146"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Codegen X | Y as:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09147" /><CodeLine lineNumber="9147"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// BB1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09148" /><CodeLine lineNumber="9148"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp&#95;if&#95;X TBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09149" /><CodeLine lineNumber="9149"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp TmpBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09150" /><CodeLine lineNumber="9150"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TmpBB:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09151" /><CodeLine lineNumber="9151"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp&#95;if&#95;Y TBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09152" /><CodeLine lineNumber="9152"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp FBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09153" /><CodeLine lineNumber="9153"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09154" /><CodeLine lineNumber="9154"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09155" /><CodeLine lineNumber="9155"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We have flexibility in setting Prob for BB1 and Prob for NewBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09156" /><CodeLine lineNumber="9156"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The requirement is that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09157" /><CodeLine lineNumber="9157"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   TrueProb for BB1 + (FalseProb for BB1 &#42; TrueProb for TmpBB)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09158" /><CodeLine lineNumber="9158"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//     = TrueProb for original BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09159" /><CodeLine lineNumber="9159"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Assuming the original weights are A and B, one choice is to set BB1&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09160" /><CodeLine lineNumber="9160"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// weights to A and A+2B, and set TmpBB&#39;s weights to A and 2B. This choice</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09161" /><CodeLine lineNumber="9161"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// assumes that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09162" /><CodeLine lineNumber="9162"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   TrueProb for BB1 == FalseProb for BB1 &#42; TrueProb for TmpBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09163" /><CodeLine lineNumber="9163"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Another choice is to assume TrueProb for BB1 equals to TrueProb for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09164" /><CodeLine lineNumber="9164"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TmpBB, but the math is more complicated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09165" /><CodeLine lineNumber="9165"><Highlight kind="normal">      uint64&#95;t TrueWeight, FalseWeight;</Highlight></CodeLine>
<Link id="l09166" /><CodeLine lineNumber="9166"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;Br1, TrueWeight, FalseWeight)) &#123;</Highlight></CodeLine>
<Link id="l09167" /><CodeLine lineNumber="9167"><Highlight kind="normal">        uint64&#95;t NewTrueWeight = TrueWeight;</Highlight></CodeLine>
<Link id="l09168" /><CodeLine lineNumber="9168"><Highlight kind="normal">        uint64&#95;t NewFalseWeight = TrueWeight + 2 &#42; FalseWeight;</Highlight></CodeLine>
<Link id="l09169" /><CodeLine lineNumber="9169"><Highlight kind="normal">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</Highlight></CodeLine>
<Link id="l09170" /><CodeLine lineNumber="9170"><Highlight kind="normal">        Br1-&gt;setMetadata(LLVMContext::MD&#95;prof,</Highlight></CodeLine>
<Link id="l09171" /><CodeLine lineNumber="9171"><Highlight kind="normal">                         MDBuilder(Br1-&gt;getContext())</Highlight></CodeLine>
<Link id="l09172" /><CodeLine lineNumber="9172"><Highlight kind="normal">                             .createBranchWeights(TrueWeight, FalseWeight,</Highlight></CodeLine>
<Link id="l09173" /><CodeLine lineNumber="9173"><Highlight kind="normal">                                                  <a href="/docs/api/namespaces/llvm/#a4a3bd60427b33355559566bdec3c9f90">hasBranchWeightOrigin</a>(&#42;Br1)));</Highlight></CodeLine>
<Link id="l09174" /><CodeLine lineNumber="9174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09175" /><CodeLine lineNumber="9175"><Highlight kind="normal">        NewTrueWeight = TrueWeight;</Highlight></CodeLine>
<Link id="l09176" /><CodeLine lineNumber="9176"><Highlight kind="normal">        NewFalseWeight = 2 &#42; FalseWeight;</Highlight></CodeLine>
<Link id="l09177" /><CodeLine lineNumber="9177"><Highlight kind="normal">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</Highlight></CodeLine>
<Link id="l09178" /><CodeLine lineNumber="9178"><Highlight kind="normal">        Br2-&gt;setMetadata(LLVMContext::MD&#95;prof,</Highlight></CodeLine>
<Link id="l09179" /><CodeLine lineNumber="9179"><Highlight kind="normal">                         MDBuilder(Br2-&gt;getContext())</Highlight></CodeLine>
<Link id="l09180" /><CodeLine lineNumber="9180"><Highlight kind="normal">                             .createBranchWeights(TrueWeight, FalseWeight));</Highlight></CodeLine>
<Link id="l09181" /><CodeLine lineNumber="9181"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09182" /><CodeLine lineNumber="9182"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l09183" /><CodeLine lineNumber="9183"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Codegen X &amp; Y as:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09184" /><CodeLine lineNumber="9184"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// BB1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09185" /><CodeLine lineNumber="9185"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp&#95;if&#95;X TmpBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09186" /><CodeLine lineNumber="9186"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp FBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09187" /><CodeLine lineNumber="9187"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TmpBB:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09188" /><CodeLine lineNumber="9188"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp&#95;if&#95;Y TBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09189" /><CodeLine lineNumber="9189"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   jmp FBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09190" /><CodeLine lineNumber="9190"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09191" /><CodeLine lineNumber="9191"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//  This requires creation of TmpBB after CurBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09192" /><CodeLine lineNumber="9192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09193" /><CodeLine lineNumber="9193"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We have flexibility in setting Prob for BB1 and Prob for TmpBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09194" /><CodeLine lineNumber="9194"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The requirement is that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09195" /><CodeLine lineNumber="9195"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   FalseProb for BB1 + (TrueProb for BB1 &#42; FalseProb for TmpBB)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09196" /><CodeLine lineNumber="9196"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//     = FalseProb for original BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09197" /><CodeLine lineNumber="9197"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Assuming the original weights are A and B, one choice is to set BB1&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09198" /><CodeLine lineNumber="9198"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// weights to 2A+B and B, and set TmpBB&#39;s weights to 2A and B. This choice</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09199" /><CodeLine lineNumber="9199"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// assumes that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09200" /><CodeLine lineNumber="9200"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   FalseProb for BB1 == TrueProb for BB1 &#42; FalseProb for TmpBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09201" /><CodeLine lineNumber="9201"><Highlight kind="normal">      uint64&#95;t TrueWeight, FalseWeight;</Highlight></CodeLine>
<Link id="l09202" /><CodeLine lineNumber="9202"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;Br1, TrueWeight, FalseWeight)) &#123;</Highlight></CodeLine>
<Link id="l09203" /><CodeLine lineNumber="9203"><Highlight kind="normal">        uint64&#95;t NewTrueWeight = 2 &#42; TrueWeight + FalseWeight;</Highlight></CodeLine>
<Link id="l09204" /><CodeLine lineNumber="9204"><Highlight kind="normal">        uint64&#95;t NewFalseWeight = FalseWeight;</Highlight></CodeLine>
<Link id="l09205" /><CodeLine lineNumber="9205"><Highlight kind="normal">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</Highlight></CodeLine>
<Link id="l09206" /><CodeLine lineNumber="9206"><Highlight kind="normal">        Br1-&gt;setMetadata(LLVMContext::MD&#95;prof,</Highlight></CodeLine>
<Link id="l09207" /><CodeLine lineNumber="9207"><Highlight kind="normal">                         MDBuilder(Br1-&gt;getContext())</Highlight></CodeLine>
<Link id="l09208" /><CodeLine lineNumber="9208"><Highlight kind="normal">                             .createBranchWeights(TrueWeight, FalseWeight));</Highlight></CodeLine>
<Link id="l09209" /><CodeLine lineNumber="9209"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09210" /><CodeLine lineNumber="9210"><Highlight kind="normal">        NewTrueWeight = 2 &#42; TrueWeight;</Highlight></CodeLine>
<Link id="l09211" /><CodeLine lineNumber="9211"><Highlight kind="normal">        NewFalseWeight = FalseWeight;</Highlight></CodeLine>
<Link id="l09212" /><CodeLine lineNumber="9212"><Highlight kind="normal">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</Highlight></CodeLine>
<Link id="l09213" /><CodeLine lineNumber="9213"><Highlight kind="normal">        Br2-&gt;setMetadata(LLVMContext::MD&#95;prof,</Highlight></CodeLine>
<Link id="l09214" /><CodeLine lineNumber="9214"><Highlight kind="normal">                         MDBuilder(Br2-&gt;getContext())</Highlight></CodeLine>
<Link id="l09215" /><CodeLine lineNumber="9215"><Highlight kind="normal">                             .createBranchWeights(TrueWeight, FalseWeight));</Highlight></CodeLine>
<Link id="l09216" /><CodeLine lineNumber="9216"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09217" /><CodeLine lineNumber="9217"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09218" /><CodeLine lineNumber="9218"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09219" /><CodeLine lineNumber="9219"><Highlight kind="normal">    ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>;</Highlight></CodeLine>
<Link id="l09220" /><CodeLine lineNumber="9220"><Highlight kind="normal">    MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09221" /><CodeLine lineNumber="9221"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09222" /><CodeLine lineNumber="9222"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;After branch condition splitting\\n&quot;</Highlight><Highlight kind="normal">; BB.<a href="/docs/api/classes/llvm/value/#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>();</Highlight></CodeLine>
<Link id="l09223" /><CodeLine lineNumber="9223"><Highlight kind="normal">               TmpBB-&gt;dump());</Highlight></CodeLine>
<Link id="l09224" /><CodeLine lineNumber="9224"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09225" /><CodeLine lineNumber="9225"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l09226" /><CodeLine lineNumber="9226"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
