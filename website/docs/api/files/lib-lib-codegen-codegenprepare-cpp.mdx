---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/codegenprepare-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `CodeGenPrepare.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/CodeGen/CodeGenPrepare.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/codegenprepare-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PointerIntPair.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BranchProbabilityInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolutionExpressions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/Analysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/analysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/BasicBlockSectionsProfileReader.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionsprofilereader-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/ISDOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/SelectionDAGNodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetLowering.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetPassConfig.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetSubtargetInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/ValueTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/valuetypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGenTypes/MachineValueType.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Config/llvm-config.h"
  permalink=""
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Argument.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GetElementPtrTypeIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/getelementptrtypeiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalValue.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InlineAsm.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/inlineasm-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicsAArch64.h"
  permalink=""
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ProfDataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Statepoint.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BlockFrequency.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Compiler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetOptions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BypassSlowDivision.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/bypassslowdivision-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SimplifyLibCalls.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifylibcalls-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SizeOpts.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="limits"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-">anonymous&#123;CodeGenPrepare.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare">CodeGenPrepare</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass">CodeGenPrepareLegacyPass</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a></>}>
This is an extended version of TargetLowering::AddrMode which holds actual Value&#42;&#39;s for register values. <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a></>}>
This class provides transaction based operation on the IR. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typepromotionaction">TypePromotionAction</a></>}>
This represents the common interface of the individual transaction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typepromotionaction/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/insertionhandler">InsertionHandler</a></>}>
Utility to remember the position of an instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/insertionhandler/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionmovebefore">InstructionMoveBefore</a></>}>
Move an instruction before another. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionmovebefore/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandsetter">OperandSetter</a></>}>
Set the operand of an instruction with a new value. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandsetter/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandshider">OperandsHider</a></>}>
Hide the operands of an instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/operandshider/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/truncbuilder">TruncBuilder</a></>}>
Build a truncate instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/truncbuilder/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/sextbuilder">SExtBuilder</a></>}>
Build a sign extension instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/sextbuilder/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/zextbuilder">ZExtBuilder</a></>}>
Build a zero extension instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/zextbuilder/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typemutator">TypeMutator</a></>}>
Mutate an instruction to another type. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/typemutator/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer">UsesReplacer</a></>}>
Replace the uses of an instruction by another instruction. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer/instructionandidx">InstructionAndIdx</a></>}>
Helper structure to keep track of the replaced uses. <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/usesreplacer/instructionandidx/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionremover">InstructionRemover</a></>}>
Remove an instruction from the IR. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/instructionremover/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher">AddressingModeMatcher</a></>}>
A helper class for matching addressing modes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator">PhiNodeSetIterator</a></>}>
An iterator for <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a>. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a></>}>
Keeps a set of PHINodes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker">SimplificationTracker</a></>}>
Keep track of simplification of Phi nodes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner">AddressingModeCombiner</a></>}>
A helper class for combining addressing modes. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper">TypePromotionHelper</a></>}>
Hepler class to perform type promotion. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper">VectorPromoteHelper</a></>}>
Helper class to promote a scalar operation to a vector one. <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6536b980547806c6fb158add5334c3ab">adjustIsPower2Test</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL)</>}>
Some targets have better codegen for <code>ctpop(X) u&lt; 2</code> than <code>ctpop(X) == 1</code>. <a href="#a6536b980547806c6fb158add5334c3ab">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8f5b32a03cc4a6072855d8c8cf7c748f">computeBaseDerivedRelocateMap</a> (const SmallVectorImpl&lt; GCRelocateInst &#42; &gt; &amp;AllRelocateCalls, MapVector&lt; GCRelocateInst &#42;, SmallVector&lt; GCRelocateInst &#42;, 0 &gt; &gt; &amp;RelocateInstMap)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a> (DbgValueInst &#42;DVI, BasicBlock::iterator VI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ac8803aa267830622708ede7b732c7ae2">DbgInserterHelper</a> (DbgVariableRecord &#42;DVR, BasicBlock::iterator VI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adfad68845808cb6acd116e50b15bc281">despeculateCountZeros</a> (IntrinsicInst &#42;CountZeros, LoopInfo &amp;LI, const TargetLowering &#42;TLI, const DataLayout &#42;DL, ModifyDT &amp;ModifiedDT, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHugeFunc)</>}>
If counting leading or trailing zeros is an expensive operation and a zero input is defined, add a check for zero to avoid calling the intrinsic. <a href="#adfad68845808cb6acd116e50b15bc281">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a> (Instruction &#42;I, SmallVectorImpl&lt; std::pair&lt; Use &#42;, Type &#42; &gt; &gt; &amp;MemoryUses, SmallPtrSetImpl&lt; Instruction &#42; &gt; &amp;ConsideredInsts, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI, bool OptSize, ProfileSummaryInfo &#42;PSI, BlockFrequencyInfo &#42;BFI, unsigned &amp;SeenInsts)</>}>
Recursively walk all the uses of I until we find a memory use. <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0f0065098f13d0b2ef0e39f9d2e1ecdd">FindAllMemoryUses</a> (Instruction &#42;I, SmallVectorImpl&lt; std::pair&lt; Use &#42;, Type &#42; &gt; &gt; &amp;MemoryUses, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI, bool OptSize, ProfileSummaryInfo &#42;PSI, BlockFrequencyInfo &#42;BFI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1f580ab00002a65787ab52ef2aa9a439">foldFCmpToFPClassTest</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI)</>}>
For pattern like: <a href="#a98c59bcf49cb7343886e8f425d6d877b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af950841a4443ffb7aff66ae75fee8442">foldURemOfLoopIncrement</a> (Instruction &#42;Rem, const DataLayout &#42;DL, const LoopInfo &#42;LI, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHuge)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a> (GetElementPtrInst &#42;GEP)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a> (GetElementPtrInst &#42;GEP, SmallVectorImpl&lt; Value &#42; &gt; &amp;OffsetV)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; std::pair&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &gt;</>}
  name={<><a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a> (const PHINode &#42;PN, const LoopInfo &#42;LI)</>}>
If given <code>PN</code> is an inductive variable with value IVInc coming from the backedge, and on each iteration it gets increased by Step, return pair &lt;IVInc, Step&gt;. <a href="#a50cfddd4c98e75ef287c16996698dc1c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a> (SelectInst &#42;SI, bool isTrue, const SmallPtrSet&lt; const Instruction &#42;, 2 &gt; &amp;Selects)</>}>
If <code>isTrue</code> is true, return the true value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>, otherwise return false value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>. <a href="#a596c5a8a807f6ce192718084a11648de">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a> (Value &#42;Val, const TargetLowering &amp;TLI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if all the uses of <code>Val</code> are equivalent (or free) zero or sign extensions. <a href="#ae965d93aa46ad834c21718eba4b5b78e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aaca449a7620b1306ed7586ba6bdc4faa">INITIALIZE&#95;PASS&#95;BEGIN</a> (CodeGenPrepareLegacyPass, DEBUG&#95;TYPE, &quot;Optimize for code generation&quot;, false, false) INITIALIZE&#95;PASS&#95;END(CodeGenPrepareLegacyPass</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a> (Instruction &#42;User)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the candidates could be combined with a shift instruction, which includes: <a href="#a19e2fd6fce422c4ab3cea555782abbb6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a> (const TargetTransformInfo &#42;TTI, const TargetLowering &#42;TLI, SelectInst &#42;SI)</>}>
Returns true if a <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> should be turned into an explicit branch. <a href="#a4bde686b6506cc9e63919272711713f4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a> (const TargetLibraryInfo &#42;TLInfo, const CallInst &#42;CI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a> (const Value &#42;V, const LoopInfo &#42;LI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a> (Value &#42;V, BasicBlock &#42;BB)</>}>
Return true if the specified values are defined in a different basic block than BB. <a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a> (CallInst &#42;CI, InlineAsm &#42;IA, Value &#42;OpVal, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> to see if all uses of OpVal by the specified inline asm call are due to memory operands. <a href="#a86026627b644e50527898aad0747b3e5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a> (const TargetLowering &amp;TLI, const DataLayout &amp;DL, Value &#42;Val)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> whether or not <code>Val</code> is a legal instruction for <code>TLI</code>. <a href="#aca87c42e8556b7f2e73454d63efa87f2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aaf468add8b9e6811a1643026e25eadb4">isRemOfLoopIncrementWithLoopInvariant</a> (Instruction &#42;Rem, const LoopInfo &#42;LI, Value &#42;&amp;RemAmtOut, Value &#42;&amp;AddInstOut, Value &#42;&amp;AddOffsetOut, PHINode &#42;&amp;LoopIncrPNOut)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a> (const Instruction &#42;IVInc, Instruction &#42;&amp;LHS, Constant &#42;&amp;Step)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a> (CmpInst &#42;Cmp, BinaryOperator &#42;&amp;Add)</>}>
Match special-case patterns that check for unsigned add overflow. <a href="#af23979229be4fb2286896bf920e3e235">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a> (Instruction &#42;I)</>}>
This is a little filter, which returns true if an addressing computation involving I might be folded into a load/store accessing it. <a href="#a9d0372d5a469c089a4f2a299dd679558">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a> (BranchInst &#42;Branch, const TargetLowering &amp;TLI, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHugeFunc)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a> (BinaryOperator &#42;ShiftI, ConstantInt &#42;CI, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
Sink the shift <em>right</em> instruction into user blocks if the uses could potentially be combined with this shift instruction and generate BitExtract instruction. <a href="#a2c05548feac70b16d31caf0cfb225714">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a> (CastInst &#42;CI, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
If the specified cast instruction is a noop copy (e.g. <a href="#a3b82cff474790446f1288f1a086c1cd6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a> (Value &#42;Old, Value &#42;New, SmallSet&lt; BasicBlock &#42;, 32 &gt; &amp;FreshBBs, bool IsHuge)</>}>
Replace all old uses with new ones, and push the updated BBs into FreshBBs. <a href="#a19e092ecf7889abf7277f13824e0c601">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a> (uint64&#95;t &amp;NewTrue, uint64&#95;t &amp;NewFalse)</>}>
Scale down both weights to fit into uint32&#95;t. <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a> (GCRelocateInst &#42;RelocatedBase, const SmallVectorImpl&lt; GCRelocateInst &#42; &gt; &amp;Targets)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a> (Instruction &#42;AndI, const TargetLowering &amp;TLI, SetOfInstrs &amp;InsertedInsts)</>}>
Duplicate and sink the given &#39;and&#39; instruction into user blocks where it is used in a compare to allow isel to generate better code for targets where this operation can be combined. <a href="#a0049977ff1075a98e9f512bbf4d181a6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a> (CastInst &#42;CI)</>}>
Sink the specified cast instruction into its user blocks. <a href="#a3cc8a3a2506bf528398d0aef0850f31a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a> (CmpInst &#42;Cmp, const TargetLowering &amp;TLI)</>}>
Sink the given <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> into user blocks to reduce the number of virtual registers that must be created and coalesced. <a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a> (const TargetTransformInfo &#42;TTI, Value &#42;V)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if V (an operand of a select instruction) is an expensive instruction that is only used once. <a href="#a10ece31d94cdd66e58cef49d73f2263f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a> (BinaryOperator &#42;ShiftI, Instruction &#42;User, ConstantInt &#42;CI, DenseMap&lt; BasicBlock &#42;, BinaryOperator &#42; &gt; &amp;InsertedShifts, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</>}>
Sink both shift and truncate instruction to the use of truncate&#39;s BB. <a href="#a0327169186859791aafa580e4fb547e2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a> (StoreInst &amp;SI, const DataLayout &amp;DL, const TargetLowering &amp;TLI)</>}>
For the instruction sequence of store below, F and I values are bundled together as an i64 value before being stored into memory. <a href="#a3c7e1486d1d466b3be981adcb21a6359">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6059e0984be477af12647e0574a01af0">STATISTIC</a> (NumBlocksElim, &quot;Number of blocks eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa30f41b73332156614f88439d24da8ac">STATISTIC</a> (NumPHIsElim, &quot;Number of trivial PHIs eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab4aba4ac8014186037d27ffc57196ac3">STATISTIC</a> (NumGEPsElim, &quot;Number of GEPs converted to casts&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac922eae769aaa3ee158e915f036129e4">STATISTIC</a> (NumCmpUses, &quot;Number of uses of Cmp expressions replaced with uses of &quot; &quot;sunken Cmps&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a09f1c42adaebc495651949c7d4e64c3c">STATISTIC</a> (NumCastUses, &quot;Number of uses of Cast expressions replaced with uses &quot; &quot;of sunken Casts&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6853dee9da71b8737b7c731c505988d8">STATISTIC</a> (NumMemoryInsts, &quot;Number of memory instructions whose address &quot; &quot;computations were sunk&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aff39dc0be076dc904665065cf5c6ede2">STATISTIC</a> (NumMemoryInstsPhiCreated, &quot;Number of phis created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3c487b469e600b10b65c400de3741735">STATISTIC</a> (NumMemoryInstsSelectCreated, &quot;Number of select created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a382d2cdafa179d7c4561bfe746d2a4ad">STATISTIC</a> (NumExtsMoved, &quot;Number of &#91;s|z&#93;ext instructions combined with loads&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a1c84a6266af376a7dc168db6dd0e1ce4">STATISTIC</a> (NumExtUses, &quot;Number of uses of &#91;s|z&#93;ext instructions optimized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#abc95b24e3dc47ccf0a7afcc846d82c34">STATISTIC</a> (NumAndsAdded, &quot;Number of and mask instructions added to form ext loads&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aaf676a4c39b6a1c7019dbbec6fc89500">STATISTIC</a> (NumAndUses, &quot;Number of uses of and mask instructions optimized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a05852bdf4c63ca1e5306e1422db248f3">STATISTIC</a> (NumRetsDup, &quot;Number of return instructions duplicated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad8d62a4d9ff57ddca8ab070f4e396c0c">STATISTIC</a> (NumDbgValueMoved, &quot;Number of debug value instructions moved&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aee5e95a01071c306a5fa9e6e3e07183c">STATISTIC</a> (NumSelectsExpanded, &quot;Number of selects turned into branches&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4644887cd2ba8fba1a1c6f97d234e7e2">STATISTIC</a> (NumStoreExtractExposed, &quot;Number of store(extractelement) exposed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3fb33a8a29e076405285e5282eba81fd">swapICmpOperandsToExposeCSEOpportunities</a> (CmpInst &#42;Cmp)</>}>
Many architectures use the same instruction for both subtract and cmp. <a href="#a3fb33a8a29e076405285e5282eba81fd">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a> (GetElementPtrInst &#42;GEPI, const TargetTransformInfo &#42;TTI)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a51f303fd2cc8c48e50ab97c59f3558cc">AddrSinkCombineBaseGV</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a3a00df51e1fa276c0c8860fe5ac1f95c">AddrSinkCombineBaseOffs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a44b23d217bd678cd7aef7d152d945537">AddrSinkCombineBaseReg</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a984c73ae4b3ecbd1c9a237c11e38ac62">AddrSinkCombineScaledReg</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#afedfbc99c6b04e20643eb77da796d522">AddrSinkNewPhis</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a732a4fb41e78c56627fb9748f00935ab">AddrSinkNewSelects</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aaabb67aa574169b8cf2db8baf993b9ea">BBSectionsGuidedSectionPrefix</a></>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a030569d5a541b6110f2ae1b6a3413a58">DEBUG&#95;TYPE</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa653d45524ba8feb6e97dd4f961b7c3e">DisableComplexAddrModes</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af6d9ea3fbe9aad1268fdabb3863c336c">DisableDeletePHIs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a337eb74e6c82771bb21ce598a8d3090c">DisableExtLdPromotion</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac23f3d86779d204fbf6db71ce8f41d7b">DisableGCOpts</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a346da4fb7a62e95531402c0b2a85c4fd">DisablePreheaderProtect</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af42b66ae716b910d032498490940ae08">DisableSelectToBranch</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1e6cf6a2bf01ee44a0f0843d8c3512cd">DisableStoreExtract</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#add2019bfb348f5241b4110eb77775410">EnableAndCmpSinking</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa139a070bbd3c66bb6fd2dbdee1dd893">EnableGEPOffsetSplit</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa667cc0d6f6fc39b8d40b9b9828b81bb">EnableICMP&#95;EQToICMP&#95;ST</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a6412f4a5842ffe108c2aa493fa0fe1b1">EnableTypePromotionMerge</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>Optimize <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> code</>}
  name={<><a href="#a82626751cd03ec5db2cc4939a10ad956">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a8ac7126af5085fb735db4c727a0ab4e9">ForceSplitStore</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; uint64&#95;t &gt;</>}
  name={<><a href="#acb1402a601e394cbb3a7b1a1c4e4634f">FreqRatioToSkipMerge</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>Optimize <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> code</>}
  name={<><a href="#a109eb00135035c7badb12cece015c58d">generation</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a6eff5790402995c83be65f9260826b41">HugeFuncThresholdInCGPP</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a1a31871450a2ceec97ef89dbdae54921">MaxAddressUsersToScan</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1d7858eecb954b54795df357b6935414">OptimizePhiTypes</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a6cdb6fbcff4780503fef226b46b6f10b">ProfileGuidedSectionPrefix</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a276112f96ea0d245fec9eaa1306712c0">ProfileUnknownInSpecialSection</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;codegenprepare&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### adjustIsPower2Test() {#a6536b980547806c6fb158add5334c3ab}

<MemberDefinition
  prototype={<>static bool adjustIsPower2Test (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Some targets have better codegen for <code>ctpop(X) u&lt; 2</code> than <code>ctpop(X) == 1</code>.

This function converts <code>ctpop(X) ==/!= 1</code> into <code>ctpop(X) u&lt;/u&gt; 2/1</code> if the result cannot be zero.

Definition at line <a href="#l02155">2155</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### computeBaseDerivedRelocateMap() {#a8f5b32a03cc4a6072855d8c8cf7c748f}

<MemberDefinition
  prototype={<>static void computeBaseDerivedRelocateMap (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42; &gt; &amp; AllRelocateCalls, <a href="/docs/api/classes/llvm/mapvector">MapVector</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;, 0 &gt; &gt; &amp; RelocateInstMap)</>}
  labels = {["static"]}>

Definition at line <a href="#l01201">1201</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DbgInserterHelper() {#a5a43b0bc7c25aaaa14cf3d79d7f13c78}

<MemberDefinition
  prototype={<>static void DbgInserterHelper (<a href="/docs/api/classes/llvm/dbgvalueinst">DbgValueInst</a> &#42; DVI, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI)</>}
  labels = {["static"]}>

Definition at line <a href="#l08904">8904</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DbgInserterHelper() {#ac8803aa267830622708ede7b732c7ae2}

<MemberDefinition
  prototype={<>static void DbgInserterHelper (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; DVR, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI)</>}
  labels = {["static"]}>

Definition at line <a href="#l08912">8912</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### despeculateCountZeros() {#adfad68845808cb6acd116e50b15bc281}

<MemberDefinition
  prototype={<>static bool despeculateCountZeros (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42; CountZeros, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp; LI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42; DL, ModifyDT &amp; ModifiedDT, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHugeFunc)</>}
  labels = {["static"]}>
If counting leading or trailing zeros is an expensive operation and a zero input is defined, add a check for zero to avoid calling the intrinsic.

We want to transform: z = call i64 @llvm.cttz.i64(i64 A, i1 false)

into: entry: cmpz = icmp eq i64 A, 0 br i1 cmpz, label cond.end, label cond.false cond.false: z = call i64 @llvm.cttz.i64(i64 A, i1 true) br label cond.end cond.end: ctz = phi i64 &#91; 64, entry &#93;, &#91; z, cond.false &#93;

If the transform is performed, return true and set ModifiedDT to true.

Definition at line <a href="#l02494">2494</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### FindAllMemoryUses() {#a498962c0029b14cf3cc8fb08c5e20ab2}

<MemberDefinition
  prototype={<>static bool FindAllMemoryUses (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/use">Use</a> &#42;, <a href="/docs/api/classes/llvm/type">Type</a> &#42; &gt; &gt; &amp; MemoryUses, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; ConsideredInsts, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp; TRI, bool OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI, unsigned &amp; SeenInsts)</>}
  labels = {["static"]}>
Recursively walk all the uses of I until we find a memory use.

If we find an obviously non-foldable instruction, return true. Add accessed addresses and types to MemoryUses.

Definition at line <a href="#l05506">5506</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### FindAllMemoryUses() {#a0f0065098f13d0b2ef0e39f9d2e1ecdd}

<MemberDefinition
  prototype={<>static bool FindAllMemoryUses (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/use">Use</a> &#42;, <a href="/docs/api/classes/llvm/type">Type</a> &#42; &gt; &gt; &amp; MemoryUses, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp; TRI, bool OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI)</>}
  labels = {["static"]}>

Definition at line <a href="#l05579">5579</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### foldFCmpToFPClassTest() {#a1f580ab00002a65787ab52ef2aa9a439}

<MemberDefinition
  prototype={<>static bool foldFCmpToFPClassTest (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>

Definition at line <a href="#l01950">1950</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### foldICmpWithDominatingICmp() {#a98c59bcf49cb7343886e8f425d6d877b}

<MemberDefinition
  prototype={<>static bool foldICmpWithDominatingICmp (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
For pattern like:

DomCond = icmp sgt/slt CmpOp0, CmpOp1 (might not be in DomBB) ... DomBB: ... br DomCond, TrueBB, CmpBB CmpBB: (with DomBB being the single predecessor) ... Cmp = icmp eq CmpOp0, CmpOp1 ...

It would use two comparison on targets that lowering of icmp sgt/slt is different from lowering of icmp eq (PowerPC). This function try to convert &#39;Cmp = icmp eq CmpOp0, CmpOp1&#39; to &#39; Cmp = icmp slt/sgt CmpOp0, CmpOp1&#39;. After that, DomCond and Cmp can use the same comparison so reduce one comparison.

Return true if any changes are made.

Definition at line <a href="#l01851">1851</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### foldURemOfLoopIncrement() {#af950841a4443ffb7aff66ae75fee8442}

<MemberDefinition
  prototype={<>static bool foldURemOfLoopIncrement (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Rem, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHuge)</>}
  labels = {["static"]}>

Definition at line <a href="#l02068">2068</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### GEPSequentialConstIndexed() {#ac3e586008202db1f802e906a489d7574}

<MemberDefinition
  prototype={<>static bool GEPSequentialConstIndexed (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42; GEP)</>}
  labels = {["static"]}>

Definition at line <a href="#l08364">8364</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### getGEPSmallConstantIntOffsetV() {#a0e431b29d5cd842ab00f85ec2cdab8b2}

<MemberDefinition
  prototype={<>static bool getGEPSmallConstantIntOffsetV (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42; GEP, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OffsetV)</>}
  labels = {["static"]}>

Definition at line <a href="#l01236">1236</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### getIVIncrement() {#a50cfddd4c98e75ef287c16996698dc1c}

<MemberDefinition
  prototype={<>static std::optional&lt; std::pair&lt; Instruction &#42;, Constant &#42; &gt; &gt; getIVIncrement (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI)</>}
  labels = {["static"]}>
If given <code>PN</code> is an inductive variable with value IVInc coming from the backedge, and on each iteration it gets increased by Step, return pair &lt;IVInc, Step&gt;.

Otherwise, return std::nullopt.

Definition at line <a href="#l01527">1527</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### getTrueOrFalseValue() {#a596c5a8a807f6ce192718084a11648de}

<MemberDefinition
  prototype={<>static Value &#42; getTrueOrFalseValue (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42; SI, bool isTrue, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, 2 &gt; &amp; Selects)</>}
  labels = {["static"]}>
If <code>isTrue</code> is true, return the true value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>, otherwise return false value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code>.

If the true/false value of <code><a href="/docs/api/namespaces/llvm/si">SI</a></code> is defined by any select instructions in <code>Selects</code>, look through the defining select instruction until the true/false value is not defined in <code>Selects</code>.

Definition at line <a href="#l07330">7330</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### hasSameExtUse() {#ae965d93aa46ad834c21718eba4b5b78e}

<MemberDefinition
  prototype={<>static bool hasSameExtUse (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if all the uses of <code>Val</code> are equivalent (or free) zero or sign extensions.

Definition at line <a href="#l06327">6327</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#aaca449a7620b1306ed7586ba6bdc4faa}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (CodeGenPrepareLegacyPass, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Optimize <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> code generation&quot;, false, false)</>}>

Definition at line <a href="#l00530">530</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isExtractBitsCandidateUse() {#a19e2fd6fce422c4ab3cea555782abbb6}

<MemberDefinition
  prototype={<>static bool isExtractBitsCandidateUse (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; User)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the candidates could be combined with a shift instruction, which includes:

<ul>
<li>Truncate instruction</li>
<li>And instruction and the imm is a mask of the low bits: imm &amp; (imm+1) == 0</li>
</ul>

Definition at line <a href="#l02283">2283</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isFormingBranchFromSelectProfitable() {#a4bde686b6506cc9e63919272711713f4}

<MemberDefinition
  prototype={<>static bool isFormingBranchFromSelectProfitable (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42; TLI, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42; SI)</>}
  labels = {["static"]}>
Returns true if a <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> should be turned into an explicit branch.

Definition at line <a href="#l07285">7285</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isIntrinsicOrLFToBeTailCalled() {#a87548c69480b23599d643d518412895c}

<MemberDefinition
  prototype={<>static bool isIntrinsicOrLFToBeTailCalled (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02810">2810</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isIVIncrement() {#ab0f1e7b38e65d10c01900bd4d458a03b}

<MemberDefinition
  prototype={<>static bool isIVIncrement (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI)</>}
  labels = {["static"]}>

Definition at line <a href="#l01542">1542</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### IsNonLocalValue() {#ad897d4beb50aa8f0d4d2eaa08ac0987d}

<MemberDefinition
  prototype={<>static bool IsNonLocalValue (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
Return true if the specified values are defined in a different basic block than BB.

Definition at line <a href="#l05725">5725</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### IsOperandAMemoryOperand() {#a86026627b644e50527898aad0747b3e5}

<MemberDefinition
  prototype={<>static bool IsOperandAMemoryOperand (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI, <a href="/docs/api/classes/llvm/inlineasm">InlineAsm</a> &#42; IA, <a href="/docs/api/classes/llvm/value">Value</a> &#42; OpVal, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp; TRI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> to see if all uses of OpVal by the specified inline asm call are due to memory operands.

If so, return true, otherwise return false.

Definition at line <a href="#l05481">5481</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isPromotedInstructionLegal() {#aca87c42e8556b7f2e73454d63efa87f2}

<MemberDefinition
  prototype={<>static bool isPromotedInstructionLegal (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> whether or not <code>Val</code> is a legal instruction for <code>TLI</code>.

:::info
<code>Val</code> is assumed to be the product of some type promotion. Therefore if <code>Val</code> has an undefined state in <code>TLI</code>, this is assumed to be legal, as the non-promoted value would have had the same state.
:::

Definition at line <a href="#l04652">4652</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### isRemOfLoopIncrementWithLoopInvariant() {#aaf468add8b9e6811a1643026e25eadb4}

<MemberDefinition
  prototype={<>static bool isRemOfLoopIncrementWithLoopInvariant (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Rem, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; RemAmtOut, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; AddInstOut, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; AddOffsetOut, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp; LoopIncrPNOut)</>}
  labels = {["static"]}>

Definition at line <a href="#l01983">1983</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### matchIncrement() {#a9f54e95337782bd4fb335dd547c05ecc}

<MemberDefinition
  prototype={<>static bool matchIncrement (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; IVInc, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; LHS, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp; Step)</>}
  labels = {["static"]}>

Definition at line <a href="#l01508">1508</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### matchUAddWithOverflowConstantEdgeCases() {#af23979229be4fb2286896bf920e3e235}

<MemberDefinition
  prototype={<>static bool matchUAddWithOverflowConstantEdgeCases (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp; Add)</>}
  labels = {["static"]}>
Match special-case patterns that check for unsigned add overflow.

Definition at line <a href="#l01638">1638</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### MightBeFoldableInst() {#a9d0372d5a469c089a4f2a299dd679558}

<MemberDefinition
  prototype={<>static bool MightBeFoldableInst (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>
This is a little filter, which returns true if an addressing computation involving I might be folded into a load/store accessing it.

This doesn&#39;t need to be perfect, but needs to accept at least the set of instructions that MatchOperationAddr can.

Definition at line <a href="#l04621">4621</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### optimizeBranch() {#ad2bfc3e2f7b1661868517e662ac7496c}

<MemberDefinition
  prototype={<>static bool optimizeBranch (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; Branch, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHugeFunc)</>}
  labels = {["static"]}>

Definition at line <a href="#l08532">8532</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### OptimizeExtractBits() {#a2c05548feac70b16d31caf0cfb225714}

<MemberDefinition
  prototype={<>static bool OptimizeExtractBits (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; ShiftI, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Sink the shift <em>right</em> instruction into user blocks if the uses could potentially be combined with this shift instruction and generate BitExtract instruction.

It will only be applied if the architecture supports BitExtract instruction. Here is an example: BB1: x.extract.shift = lshr i64 arg1, 32 BB2: x.extract.trunc = trunc i64 x.extract.shift to i16 ==&gt;

BB2: x.extract.shift.1 = lshr i64 arg1, 32 x.extract.trunc = trunc i64 x.extract.shift.1 to i16

CodeGen will recognize the pattern in BB2 and generate BitExtract instruction. Return true if any changes are made.

Definition at line <a href="#l02392">2392</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### OptimizeNoopCopyExpression() {#a3b82cff474790446f1288f1a086c1cd6}

<MemberDefinition
  prototype={<>static bool OptimizeNoopCopyExpression (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
If the specified cast instruction is a noop copy (e.g.

it&#39;s casting from one pointer type to another, i32-&gt;i8 on <a href="/docs/api/namespaces/llvm/ppc">PPC</a>), sink it into user blocks to reduce the number of virtual registers that must be created and coalesced.

Return true if any changes are made.

Definition at line <a href="#l01465">1465</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### replaceAllUsesWith() {#a19e092ecf7889abf7277f13824e0c601}

<MemberDefinition
  prototype={<>static void replaceAllUsesWith (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Old, <a href="/docs/api/classes/llvm/value">Value</a> &#42; New, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 32 &gt; &amp; FreshBBs, bool IsHuge)</>}
  labels = {["static"]}>
Replace all old uses with new ones, and push the updated BBs into FreshBBs.

Definition at line <a href="#l01112">1112</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### scaleWeights() {#a25c5d0cb41bbb1777e779a8da35e7bd4}

<MemberDefinition
  prototype={<>static void scaleWeights (uint64&#95;t &amp; NewTrue, uint64&#95;t &amp; NewFalse)</>}
  labels = {["static"]}>
Scale down both weights to fit into uint32&#95;t.

Definition at line <a href="#l09020">9020</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### simplifyRelocatesOffABase() {#a9364799319bac519aa565ec882986e6d}

<MemberDefinition
  prototype={<>static bool simplifyRelocatesOffABase (<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42; RelocatedBase, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42; &gt; &amp; Targets)</>}
  labels = {["static"]}>

Definition at line <a href="#l01253">1253</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### sinkAndCmp0Expression() {#a0049977ff1075a98e9f512bbf4d181a6}

<MemberDefinition
  prototype={<>static bool sinkAndCmp0Expression (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; AndI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, SetOfInstrs &amp; InsertedInsts)</>}
  labels = {["static"]}>
Duplicate and sink the given &#39;and&#39; instruction into user blocks where it is used in a compare to allow isel to generate better code for targets where this operation can be combined.

Return true if any changes are made.

Definition at line <a href="#l02207">2207</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### SinkCast() {#a3cc8a3a2506bf528398d0aef0850f31a}

<MemberDefinition
  prototype={<>static bool SinkCast (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42; CI)</>}
  labels = {["static"]}>
Sink the specified cast instruction into its user blocks.

Definition at line <a href="#l01397">1397</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### sinkCmpExpression() {#a24a3e4aad4cb2fdde7ce294a531cd52a}

<MemberDefinition
  prototype={<>static bool sinkCmpExpression (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
Sink the given <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> into user blocks to reduce the number of virtual registers that must be created and coalesced.

This is a clear win except on targets with multiple condition code registers (PowerPC), where it might lose; some adjustment may be wanted there.

Return true if any changes are made.

Definition at line <a href="#l01772">1772</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### sinkSelectOperand() {#a10ece31d94cdd66e58cef49d73f2263f}

<MemberDefinition
  prototype={<>static bool sinkSelectOperand (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if V (an operand of a select instruction) is an expensive instruction that is only used once.

Definition at line <a href="#l07276">7276</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### SinkShiftAndTruncate() {#a0327169186859791aafa580e4fb547e2}

<MemberDefinition
  prototype={<>static bool SinkShiftAndTruncate (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; ShiftI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; User, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; CI, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; &gt; &amp; InsertedShifts, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Sink both shift and truncate instruction to the use of truncate&#39;s BB.

Definition at line <a href="#l02299">2299</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### splitMergedValStore() {#a3c7e1486d1d466b3be981adcb21a6359}

<MemberDefinition
  prototype={<>static bool splitMergedValStore (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &amp; SI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp; TLI)</>}
  labels = {["static"]}>
For the instruction sequence of store below, F and I values are bundled together as an i64 value before being stored into memory.

Sometimes it is more efficient to generate separate stores for F and I, which can remove the bitwise instructions or sink them to colder places.

(store (or (zext (bitcast F to i32) to i64), (shl (zext I to i64), 32)), addr) --&gt; (store F, addr) and (store I, addr+4)

Similarly, splitting for other merged store can also be beneficial, like: For pair of &#123;i32, i32&#125;, i64 store --&gt; two i32 stores. For pair of &#123;i32, i16&#125;, i64 store --&gt; two i32 stores. For pair of &#123;i16, i16&#125;, i32 store --&gt; two i16 stores. For pair of &#123;i16, i8&#125;, i32 store --&gt; two i16 stores. For pair of &#123;i8, i8&#125;, i16 store --&gt; two i8 stores.

We allow each target to determine specifically which kind of splitting is supported.

The store patterns are commonly seen from the simple code snippet below if only std::make&#95;pair(...) is sroa transformed before inlined into hoo. void goo(const std::pair&lt;int, float&gt; &amp;); hoo() &#123; ... goo(std::make&#95;pair(tmp, ftmp)); ... &#125;

Although we already have similar splitting in DAG Combine, we duplicate it in <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare">CodeGenPrepare</a> to catch the case in which pattern is across multiple BBs. The logic in DAG Combine is kept to catch case generated during code expansion.

Definition at line <a href="#l08266">8266</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a6059e0984be477af12647e0574a01af0}

<MemberDefinition
  prototype={<>STATISTIC (NumBlocksElim, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a> eliminated&quot;)</>}>

Definition at line <a href="#l00111">111</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aa30f41b73332156614f88439d24da8ac}

<MemberDefinition
  prototype={<>STATISTIC (NumPHIsElim, &quot;Number of trivial PHIs eliminated&quot;)</>}>

Definition at line <a href="#l00112">112</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab4aba4ac8014186037d27ffc57196ac3}

<MemberDefinition
  prototype={<>STATISTIC (NumGEPsElim, &quot;Number of GEPs converted to casts&quot;)</>}>

Definition at line <a href="#l00113">113</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac922eae769aaa3ee158e915f036129e4}

<MemberDefinition
  prototype={<>STATISTIC (NumCmpUses, &quot;Number of uses of Cmp expressions replaced with uses of &quot; &quot;sunken Cmps&quot;)</>}>

Definition at line <a href="#l00114">114</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a09f1c42adaebc495651949c7d4e64c3c}

<MemberDefinition
  prototype={<>STATISTIC (NumCastUses, &quot;Number of uses of Cast expressions replaced with uses &quot; &quot;of sunken Casts&quot;)</>}>

Definition at line <a href="#l00116">116</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a6853dee9da71b8737b7c731c505988d8}

<MemberDefinition
  prototype={<>STATISTIC (NumMemoryInsts, &quot;Number of memory <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> whose address &quot; &quot;computations were sunk&quot;)</>}>

Definition at line <a href="#l00118">118</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aff39dc0be076dc904665065cf5c6ede2}

<MemberDefinition
  prototype={<>STATISTIC (NumMemoryInstsPhiCreated, &quot;Number of phis created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>

Definition at line <a href="#l00120">120</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3c487b469e600b10b65c400de3741735}

<MemberDefinition
  prototype={<>STATISTIC (NumMemoryInstsSelectCreated, &quot;Number of select created when address &quot; &quot;computations were sunk to memory instructions&quot;)</>}>

Definition at line <a href="#l00123">123</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a382d2cdafa179d7c4561bfe746d2a4ad}

<MemberDefinition
  prototype={<>STATISTIC (NumExtsMoved, &quot;Number of ext <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> combined with loads&quot;)</>}>

Definition at line <a href="#l00126">126</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a1c84a6266af376a7dc168db6dd0e1ce4}

<MemberDefinition
  prototype={<>STATISTIC (NumExtUses, &quot;Number of uses of ext <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> optimized&quot;)</>}>

Definition at line <a href="#l00127">127</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#abc95b24e3dc47ccf0a7afcc846d82c34}

<MemberDefinition
  prototype={<>STATISTIC (NumAndsAdded, &quot;Number of and mask <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> added to form ext loads&quot;)</>}>

Definition at line <a href="#l00128">128</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aaf676a4c39b6a1c7019dbbec6fc89500}

<MemberDefinition
  prototype={<>STATISTIC (NumAndUses, &quot;Number of uses of and mask <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> optimized&quot;)</>}>

Definition at line <a href="#l00130">130</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a05852bdf4c63ca1e5306e1422db248f3}

<MemberDefinition
  prototype={<>STATISTIC (NumRetsDup, &quot;Number of return <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> duplicated&quot;)</>}>

Definition at line <a href="#l00131">131</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad8d62a4d9ff57ddca8ab070f4e396c0c}

<MemberDefinition
  prototype={<>STATISTIC (NumDbgValueMoved, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/x86/lib/target/x86/disassembler/x86disassembler-cpp/#ae0228f36529f75f692753ef96d725012">debug</a> value <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> moved&quot;)</>}>

Definition at line <a href="#l00132">132</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aee5e95a01071c306a5fa9e6e3e07183c}

<MemberDefinition
  prototype={<>STATISTIC (NumSelectsExpanded, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/selectoptimize-cpp/#a3d495d9a0daf7fe32f1b1fb0aa153929">selects</a> turned into branches&quot;)</>}>

Definition at line <a href="#l00133">133</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4644887cd2ba8fba1a1c6f97d234e7e2}

<MemberDefinition
  prototype={<>STATISTIC (NumStoreExtractExposed, &quot;Number of store(extractelement) exposed&quot;)</>}>

Definition at line <a href="#l00134">134</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### swapICmpOperandsToExposeCSEOpportunities() {#a3fb33a8a29e076405285e5282eba81fd}

<MemberDefinition
  prototype={<>static bool swapICmpOperandsToExposeCSEOpportunities (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42; Cmp)</>}
  labels = {["static"]}>
Many architectures use the same instruction for both subtract and cmp.

Try to swap cmp operands to match subtract operations to allow for CSE.

Definition at line <a href="#l01921">1921</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### tryUnmergingGEPsAcrossIndirectBr() {#a8528dea79f0940669c4fcb751940ca94}

<MemberDefinition
  prototype={<>static bool tryUnmergingGEPsAcrossIndirectBr (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42; GEPI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l08427">8427</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### AddrSinkCombineBaseGV {#a51f303fd2cc8c48e50ab97c59f3558cc}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineBaseGV(&quot;addr-sink-combine-base-gv&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseGV field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00234">234</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkCombineBaseOffs {#a3a00df51e1fa276c0c8860fe5ac1f95c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineBaseOffs(&quot;addr-sink-combine-base-offs&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseOffs field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00238">238</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkCombineBaseReg {#a44b23d217bd678cd7aef7d152d945537}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineBaseReg(&quot;addr-sink-combine-base-reg&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseReg field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00230">230</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkCombineScaledReg {#a984c73ae4b3ecbd1c9a237c11e38ac62}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkCombineScaledReg(&quot;addr-sink-combine-scaled-reg&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of ScaledReg field in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00242">242</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkNewPhis {#afedfbc99c6b04e20643eb77da796d522}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkNewPhis(&quot;addr-sink-new-phis&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Allow creation of Phis in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00223">223</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkNewSelects {#a732a4fb41e78c56627fb9748f00935ab}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkNewSelects(&quot;addr-sink-new-select&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow creation of selects in Address sinking.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00226">226</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### AddrSinkUsingGEPs {#a5410093a9a86bd6e68eb3ffb32cbce13}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AddrSinkUsingGEPs(&quot;addr-sink-using-gep&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Address sinking in CGP using GEPs.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00150">150</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### BBSectionsGuidedSectionPrefix {#aaabb67aa574169b8cf2db8baf993b9ea}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; BBSectionsGuidedSectionPrefix(&quot;bbsections-guided-section-prefix&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Use the basic-block-sections profile to determine the text &quot; &quot;section prefix for hot functions. Functions with &quot; &quot;basic-block-sections profile will be placed in &#96;.text.hot&#96; &quot; &quot;regardless of their FDO profile info. Other functions won&#39;t be &quot; &quot;impacted, i.e., their prefixes will be decided by FDO/sampleFDO &quot; &quot;profiles.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00193">193</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DEBUG&#95;TYPE {#a030569d5a541b6110f2ae1b6a3413a58}

<MemberDefinition
  prototype={<>DEBUG&#95;TYPE</>}>

Definition at line <a href="#l00538">538</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableBranchOpts {#a62cd718328addb93b7bfbfd788fa9c33}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableBranchOpts(&quot;disable-cgp-branch-opts&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable branch optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00136">136</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableComplexAddrModes {#aa653d45524ba8feb6e97dd4f961b7c3e}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableComplexAddrModes(&quot;disable-complex-addr-modes&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disables combining addressing modes with different parts &quot; &quot;in optimizeMemoryInst.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00217">217</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableDeletePHIs {#af6d9ea3fbe9aad1268fdabb3863c336c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableDeletePHIs(&quot;disable-cgp-delete-phis&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable elimination of dead PHI nodes.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00274">274</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableExtLdPromotion {#a337eb74e6c82771bb21ce598a8d3090c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableExtLdPromotion(&quot;disable-cgp-ext-ld-promotion&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable ext(promotable(ld)) -&gt; promoted(ext(ld)) optimization in &quot; &quot;CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00165">165</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableGCOpts {#ac23f3d86779d204fbf6db71ce8f41d7b}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableGCOpts(&quot;disable-cgp-gc-opts&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable GC optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00141">141</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisablePreheaderProtect {#a346da4fb7a62e95531402c0b2a85c4fd}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisablePreheaderProtect(&quot;disable-preheader-prot&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable protection against removing loop preheaders&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00175">175</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableSelectToBranch {#af42b66ae716b910d032498490940ae08}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableSelectToBranch(&quot;disable-cgp-select2branch&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable select to branch conversion.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00145">145</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### DisableStoreExtract {#a1e6cf6a2bf01ee44a0f0843d8c3512cd}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableStoreExtract(&quot;disable-cgp-store-extract&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable store(extract) optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00157">157</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableAndCmpSinking {#add2019bfb348f5241b4110eb77775410}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableAndCmpSinking(&quot;enable-andcmp-sinking&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable sinking and/cmp into branches.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00154">154</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableGEPOffsetSplit {#aa139a070bbd3c66bb6fd2dbdee1dd893}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableGEPOffsetSplit(&quot;cgp-split-large-offset-gep&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable splitting large offset of GEP.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00247">247</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableICMP&#95;EQToICMP&#95;ST {#aa667cc0d6f6fc39b8d40b9b9828b81bb}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableICMP&#95;EQToICMP&#95;ST(&quot;cgp-icmp-eq2icmp-st&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable ICMP&#95;EQ to ICMP&#95;S(L|G)T conversion.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00251">251</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### EnableTypePromotionMerge {#a6412f4a5842ffe108c2aa493fa0fe1b1}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableTypePromotionMerge(&quot;cgp-type-promotion-merge&quot;, cl::Hidden, cl::desc(&quot;Enable merging of redundant sexts when one is dominating&quot; &quot; the other.&quot;), cl::init(true))</>}
  labels = {["static"]}>

Definition at line <a href="#l00211">211</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### false {#a82626751cd03ec5db2cc4939a10ad956}

<MemberDefinition
  prototype="Optimize for code false">

Definition at line <a href="#l00539">539</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### ForceSplitStore {#a8ac7126af5085fb735db4c727a0ab4e9}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceSplitStore(&quot;force-split-store&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Force store splitting no matter what the target query says.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00207">207</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### FreqRatioToSkipMerge {#acb1402a601e394cbb3a7b1a1c4e4634f}

<MemberDefinition
  prototype={<>cl::opt&lt; uint64&#95;t &gt; FreqRatioToSkipMerge(&quot;cgp-freq-ratio-to-skip-merge&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Skip merging empty blocks if (frequency of empty block) / &quot; &quot;(frequency of destination block) is greater than this ratio&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00202">202</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### generation {#a109eb00135035c7badb12cece015c58d}

<MemberDefinition
  prototype="Optimize for code generation">

Definition at line <a href="#l00539">539</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### HugeFuncThresholdInCGPP {#a6eff5790402995c83be65f9260826b41}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; HugeFuncThresholdInCGPP(&quot;cgpp-huge-func&quot;, cl::init(10000), cl::Hidden, cl::desc(&quot;Least BB number of huge function.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00265">265</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### MaxAddressUsersToScan {#a1a31871450a2ceec97ef89dbdae54921}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxAddressUsersToScan(&quot;cgp-max-address-users-to-scan&quot;, cl::init(100), cl::Hidden, cl::desc(&quot;Max number of address users to look at&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00269">269</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### OptimizePhiTypes {#a1d7858eecb954b54795df357b6935414}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; OptimizePhiTypes(&quot;cgp-optimize-phi-types&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable converting phi types in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00261">261</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### ProfileGuidedSectionPrefix {#a6cdb6fbcff4780503fef226b46b6f10b}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ProfileGuidedSectionPrefix(&quot;profile-guided-section-prefix&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Use profile info to add section prefix for hot/cold functions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00179">179</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### ProfileUnknownInSpecialSection {#a276112f96ea0d245fec9eaa1306712c0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ProfileUnknownInSpecialSection(&quot;profile-unknown-in-special-section&quot;, cl::Hidden, cl::desc(&quot;In profiling mode like sampleFDO, if a function doesn&#39;t have &quot; &quot;profile, we cannot tell the function is cold for sure because &quot; &quot;it may be a function newly added without ever being sampled. &quot; &quot;With the flag enabled, compiler can put such profile unknown &quot; &quot;functions into a special section, so runtime system can choose &quot; &quot;to handle it in a different way than .text section, to save &quot; &quot;RAM for example. &quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00183">183</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### StressExtLdPromotion {#aeabb375be2dc51a3d518b9d2a1140fe6}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; StressExtLdPromotion(&quot;stress-cgp-ext-ld-promotion&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Stress test ext(promotable(ld)) -&gt; promoted(ext(ld)) &quot; &quot;optimization in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00170">170</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### StressStoreExtract {#a4a686688e72eafe6375f8ae1ed184123}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; StressStoreExtract(&quot;stress-cgp-store-extract&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Stress test store(extract) optimizations in CodeGenPrepare&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00161">161</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### VerifyBFIUpdates {#aa67824c7146db82e49933e0a1ac1d3b9}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; VerifyBFIUpdates(&quot;cgp-verify-bfi-updates&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable BFI update verification for &quot; &quot;CodeGenPrepare.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00256">256</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;codegenprepare&quot;</>}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- CodeGenPrepare.cpp - Prepare a function for code generation --------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This pass munges the code in the input function to better prepare it for</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// SelectionDAG-based code generation. This works around limitations in it&#39;s</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// basic-block-at-a-time approach. It should eventually be removed.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/codegenprepare-h">llvm/CodeGen/CodeGenPrepare.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h">llvm/ADT/PointerIntPair.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h">llvm/Analysis/BranchProbabilityInfo.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/analysis-h">llvm/CodeGen/Analysis.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionsprofilereader-h">llvm/CodeGen/BasicBlockSectionsProfileReader.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h">llvm/CodeGen/ISDOpcodes.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h">llvm/CodeGen/SelectionDAGNodes.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h">llvm/CodeGen/TargetLowering.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/valuetypes-h">llvm/CodeGen/ValueTypes.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h">llvm/CodeGenTypes/MachineValueType.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Config/llvm-config.h&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h">llvm/IR/Argument.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/getelementptrtypeiterator-h">llvm/IR/GetElementPtrTypeIterator.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h">llvm/IR/GlobalValue.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/inlineasm-h">llvm/IR/InlineAsm.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;llvm/IR/IntrinsicsAArch64.h&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h">llvm/IR/ProfDataUtils.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h">llvm/IR/Statepoint.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuemap-h">llvm/IR/ValueMap.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h">llvm/Support/BlockFrequency.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h">llvm/Support/Compiler.h</a>&quot;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h">llvm/Target/TargetOptions.h</a>&quot;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/bypassslowdivision-h">llvm/Transforms/Utils/BypassSlowDivision.h</a>&quot;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifylibcalls-h">llvm/Transforms/Utils/SimplifyLibCalls.h</a>&quot;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h">llvm/Transforms/Utils/SizeOpts.h</a>&quot;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlightPreprocessor">#include &lt;limits&gt;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlightPreprocessor">#include &lt;memory&gt;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlightPreprocessor">#include &lt;vector&gt;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;codegenprepare&quot;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111" lineLink="#a6059e0984be477af12647e0574a01af0"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumBlocksElim, </span><span class="doxyHighlightStringLiteral">&quot;Number of blocks eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112" lineLink="#aa30f41b73332156614f88439d24da8ac"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPHIsElim, </span><span class="doxyHighlightStringLiteral">&quot;Number of trivial PHIs eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="#ab4aba4ac8014186037d27ffc57196ac3"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumGEPsElim, </span><span class="doxyHighlightStringLiteral">&quot;Number of GEPs converted to casts&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="#ac922eae769aaa3ee158e915f036129e4"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCmpUses, </span><span class="doxyHighlightStringLiteral">&quot;Number of uses of Cmp expressions replaced with uses of &quot;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;sunken Cmps&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116" lineLink="#a09f1c42adaebc495651949c7d4e64c3c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCastUses, </span><span class="doxyHighlightStringLiteral">&quot;Number of uses of Cast expressions replaced with uses &quot;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;of sunken Casts&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118" lineLink="#a6853dee9da71b8737b7c731c505988d8"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemoryInsts, </span><span class="doxyHighlightStringLiteral">&quot;Number of memory instructions whose address &quot;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;computations were sunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120" lineLink="#aff39dc0be076dc904665065cf5c6ede2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemoryInstsPhiCreated,</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of phis created when address &quot;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;computations were sunk to memory instructions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="#a3c487b469e600b10b65c400de3741735"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemoryInstsSelectCreated,</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of select created when address &quot;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;computations were sunk to memory instructions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126" lineLink="#a382d2cdafa179d7c4561bfe746d2a4ad"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumExtsMoved, </span><span class="doxyHighlightStringLiteral">&quot;Number of &#91;s|z&#93;ext instructions combined with loads&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127" lineLink="#a1c84a6266af376a7dc168db6dd0e1ce4"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumExtUses, </span><span class="doxyHighlightStringLiteral">&quot;Number of uses of &#91;s|z&#93;ext instructions optimized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="#abc95b24e3dc47ccf0a7afcc846d82c34"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAndsAdded,</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of and mask instructions added to form ext loads&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130" lineLink="#aaf676a4c39b6a1c7019dbbec6fc89500"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAndUses, </span><span class="doxyHighlightStringLiteral">&quot;Number of uses of and mask instructions optimized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131" lineLink="#a05852bdf4c63ca1e5306e1422db248f3"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumRetsDup, </span><span class="doxyHighlightStringLiteral">&quot;Number of return instructions duplicated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132" lineLink="#ad8d62a4d9ff57ddca8ab070f4e396c0c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDbgValueMoved, </span><span class="doxyHighlightStringLiteral">&quot;Number of debug value instructions moved&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133" lineLink="#aee5e95a01071c306a5fa9e6e3e07183c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSelectsExpanded, </span><span class="doxyHighlightStringLiteral">&quot;Number of selects turned into branches&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="#a4644887cd2ba8fba1a1c6f97d234e7e2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumStoreExtractExposed, </span><span class="doxyHighlightStringLiteral">&quot;Number of store(extractelement) exposed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136" lineLink="#a62cd718328addb93b7bfbfd788fa9c33"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a>(</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;disable-cgp-branch-opts&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable branch optimizations in CodeGenPrepare&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141" lineLink="#ac23f3d86779d204fbf6db71ce8f41d7b"><span class="doxyHighlight">    <a href="#ac23f3d86779d204fbf6db71ce8f41d7b">DisableGCOpts</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-cgp-gc-opts&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">                  <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable GC optimizations in CodeGenPrepare&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145" lineLink="#af42b66ae716b910d032498490940ae08"><span class="doxyHighlight">    <a href="#af42b66ae716b910d032498490940ae08">DisableSelectToBranch</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-cgp-select2branch&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">                          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable select to branch conversion.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150" lineLink="#a5410093a9a86bd6e68eb3ffb32cbce13"><span class="doxyHighlight">    <a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a>(</span><span class="doxyHighlightStringLiteral">&quot;addr-sink-using-gep&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Address sinking in CGP using GEPs.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154" lineLink="#add2019bfb348f5241b4110eb77775410"><span class="doxyHighlight">    <a href="#add2019bfb348f5241b4110eb77775410">EnableAndCmpSinking</a>(</span><span class="doxyHighlightStringLiteral">&quot;enable-andcmp-sinking&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">                        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable sinking and/cmp into branches.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157" lineLink="#a1e6cf6a2bf01ee44a0f0843d8c3512cd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a1e6cf6a2bf01ee44a0f0843d8c3512cd">DisableStoreExtract</a>(</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;disable-cgp-store-extract&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable store(extract) optimizations in CodeGenPrepare&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161" lineLink="#a4a686688e72eafe6375f8ae1ed184123"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a>(</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;stress-cgp-store-extract&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Stress test store(extract) optimizations in CodeGenPrepare&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165" lineLink="#a337eb74e6c82771bb21ce598a8d3090c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a337eb74e6c82771bb21ce598a8d3090c">DisableExtLdPromotion</a>(</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;disable-cgp-ext-ld-promotion&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable ext(promotable(ld)) -&gt; promoted(ext(ld)) optimization in &quot;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;CodeGenPrepare&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170" lineLink="#aeabb375be2dc51a3d518b9d2a1140fe6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a>(</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;stress-cgp-ext-ld-promotion&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Stress test ext(promotable(ld)) -&gt; promoted(ext(ld)) &quot;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;optimization in CodeGenPrepare&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175" lineLink="#a346da4fb7a62e95531402c0b2a85c4fd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a346da4fb7a62e95531402c0b2a85c4fd">DisablePreheaderProtect</a>(</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;disable-preheader-prot&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable protection against removing loop preheaders&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179" lineLink="#a6cdb6fbcff4780503fef226b46b6f10b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a6cdb6fbcff4780503fef226b46b6f10b">ProfileGuidedSectionPrefix</a>(</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;profile-guided-section-prefix&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Use profile info to add section prefix for hot/cold functions&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183" lineLink="#a276112f96ea0d245fec9eaa1306712c0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a276112f96ea0d245fec9eaa1306712c0">ProfileUnknownInSpecialSection</a>(</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;profile-unknown-in-special-section&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;In profiling mode like sampleFDO, if a function doesn&#39;t have &quot;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;profile, we cannot tell the function is cold for sure because &quot;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;it may be a function newly added without ever being sampled. &quot;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;With the flag enabled, compiler can put such profile unknown &quot;</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;functions into a special section, so runtime system can choose &quot;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;to handle it in a different way than .text section, to save &quot;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;RAM for example. &quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193" lineLink="#aaabb67aa574169b8cf2db8baf993b9ea"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aaabb67aa574169b8cf2db8baf993b9ea">BBSectionsGuidedSectionPrefix</a>(</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;bbsections-guided-section-prefix&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Use the basic-block-sections profile to determine the text &quot;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;section prefix for hot functions. Functions with &quot;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;basic-block-sections profile will be placed in &#96;.text.hot&#96; &quot;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;regardless of their FDO profile info. Other functions won&#39;t be &quot;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;impacted, i.e., their prefixes will be decided by FDO/sampleFDO &quot;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;profiles.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202" lineLink="#acb1402a601e394cbb3a7b1a1c4e4634f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;uint64&#95;t&gt;</a> <a href="#acb1402a601e394cbb3a7b1a1c4e4634f">FreqRatioToSkipMerge</a>(</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;cgp-freq-ratio-to-skip-merge&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2),</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Skip merging empty blocks if (frequency of empty block) / &quot;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;(frequency of destination block) is greater than this ratio&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207" lineLink="#a8ac7126af5085fb735db4c727a0ab4e9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a8ac7126af5085fb735db4c727a0ab4e9">ForceSplitStore</a>(</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-split-store&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Force store splitting no matter what the target query says.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211" lineLink="#a6412f4a5842ffe108c2aa493fa0fe1b1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a6412f4a5842ffe108c2aa493fa0fe1b1">EnableTypePromotionMerge</a>(</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;cgp-type-promotion-merge&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable merging of redundant sexts when one is dominating&quot;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot; the other.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217" lineLink="#aa653d45524ba8feb6e97dd4f961b7c3e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aa653d45524ba8feb6e97dd4f961b7c3e">DisableComplexAddrModes</a>(</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;disable-complex-addr-modes&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disables combining addressing modes with different parts &quot;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;in optimizeMemoryInst.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223" lineLink="#afedfbc99c6b04e20643eb77da796d522"><span class="doxyHighlight">    <a href="#afedfbc99c6b04e20643eb77da796d522">AddrSinkNewPhis</a>(</span><span class="doxyHighlightStringLiteral">&quot;addr-sink-new-phis&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">                    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow creation of Phis in Address sinking.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226" lineLink="#a732a4fb41e78c56627fb9748f00935ab"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a732a4fb41e78c56627fb9748f00935ab">AddrSinkNewSelects</a>(</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;addr-sink-new-select&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow creation of selects in Address sinking.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230" lineLink="#a44b23d217bd678cd7aef7d152d945537"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a44b23d217bd678cd7aef7d152d945537">AddrSinkCombineBaseReg</a>(</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;addr-sink-combine-base-reg&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow combining of BaseReg field in Address sinking.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234" lineLink="#a51f303fd2cc8c48e50ab97c59f3558cc"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a51f303fd2cc8c48e50ab97c59f3558cc">AddrSinkCombineBaseGV</a>(</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;addr-sink-combine-base-gv&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow combining of BaseGV field in Address sinking.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238" lineLink="#a3a00df51e1fa276c0c8860fe5ac1f95c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a3a00df51e1fa276c0c8860fe5ac1f95c">AddrSinkCombineBaseOffs</a>(</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;addr-sink-combine-base-offs&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow combining of BaseOffs field in Address sinking.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242" lineLink="#a984c73ae4b3ecbd1c9a237c11e38ac62"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a984c73ae4b3ecbd1c9a237c11e38ac62">AddrSinkCombineScaledReg</a>(</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;addr-sink-combine-scaled-reg&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow combining of ScaledReg field in Address sinking.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247" lineLink="#aa139a070bbd3c66bb6fd2dbdee1dd893"><span class="doxyHighlight">    <a href="#aa139a070bbd3c66bb6fd2dbdee1dd893">EnableGEPOffsetSplit</a>(</span><span class="doxyHighlightStringLiteral">&quot;cgp-split-large-offset-gep&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">                         <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable splitting large offset of GEP.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251" lineLink="#aa667cc0d6f6fc39b8d40b9b9828b81bb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aa667cc0d6f6fc39b8d40b9b9828b81bb">EnableICMP&#95;EQToICMP&#95;ST</a>(</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;cgp-icmp-eq2icmp-st&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable ICMP&#95;EQ to ICMP&#95;S(L|G)T conversion.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256" lineLink="#aa67824c7146db82e49933e0a1ac1d3b9"><span class="doxyHighlight">    <a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a>(</span><span class="doxyHighlightStringLiteral">&quot;cgp-verify-bfi-updates&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">                     <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable BFI update verification for &quot;</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;CodeGenPrepare.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261" lineLink="#a1d7858eecb954b54795df357b6935414"><span class="doxyHighlight">    <a href="#a1d7858eecb954b54795df357b6935414">OptimizePhiTypes</a>(</span><span class="doxyHighlightStringLiteral">&quot;cgp-optimize-phi-types&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">                     <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable converting phi types in CodeGenPrepare&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265" lineLink="#a6eff5790402995c83be65f9260826b41"><span class="doxyHighlight">    <a href="#a6eff5790402995c83be65f9260826b41">HugeFuncThresholdInCGPP</a>(</span><span class="doxyHighlightStringLiteral">&quot;cgpp-huge-func&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(10000), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">                            <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Least BB number of huge function.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269" lineLink="#a1a31871450a2ceec97ef89dbdae54921"><span class="doxyHighlight">    <a href="#a1a31871450a2ceec97ef89dbdae54921">MaxAddressUsersToScan</a>(</span><span class="doxyHighlightStringLiteral">&quot;cgp-max-address-users-to-scan&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(100),</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">                          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max number of address users to look at&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274" lineLink="#af6d9ea3fbe9aad1268fdabb3863c336c"><span class="doxyHighlight">    <a href="#af6d9ea3fbe9aad1268fdabb3863c336c">DisableDeletePHIs</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-cgp-delete-phis&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable elimination of dead PHI nodes.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> &#123;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8">ZeroExtension</a>, </span><span class="doxyHighlightComment">// Zero extension has been seen.</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de">SignExtension</a>, </span><span class="doxyHighlightComment">// Sign extension has been seen.</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fad4ce99b4684baf70c4310e9a2ae58597"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fad4ce99b4684baf70c4310e9a2ae58597">BothExtension</a>  </span><span class="doxyHighlightComment">// This extension type is used if we saw sext after</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">                 </span><span class="doxyHighlightComment">// ZeroExtension had been set, or if we saw zext after</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">                 </span><span class="doxyHighlightComment">// SignExtension had been set. It makes the type</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">                 </span><span class="doxyHighlightComment">// information of a promoted instruction invalid.</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &#123;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">NotModifyDT</a>, </span><span class="doxyHighlightComment">// Not Modify any DT.</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyBBDT</a>,  </span><span class="doxyHighlightComment">// Modify the Basic Block Dominator Tree.</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyInstDT</a> </span><span class="doxyHighlightComment">// Modify the Instruction Dominator in a Basic Block,</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">               </span><span class="doxyHighlightComment">// This usually means we move/delete/insert instruction</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">               </span><span class="doxyHighlightComment">// in a Basic Block. So we should re-iterate instructions</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">               </span><span class="doxyHighlightComment">// in such Basic Block.</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> = <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 16&gt;</a>;</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a17cdfc9d4da684f5f8b3c97c8706c28e"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a17cdfc9d4da684f5f8b3c97c8706c28e">TypeIsSExt</a> = <a href="/docs/api/classes/llvm/pointerintpair">PointerIntPair&lt;Type &#42;, 2, ExtType&gt;</a>;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, TypeIsSExt&gt;</a>;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321">SExts</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 16&gt;</a>;</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a882043c34b485e559cd3e42b1a4274b2"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a882043c34b485e559cd3e42b1a4274b2">ValueToSExts</a> = <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Value &#42;, SExts&gt;</a>;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a>;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a88c47869c3d6832ba11c5480ba78aa04">CodeGenPrepare</a> &#123;</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#add05b1dba7a9938b30736abfceee94bf"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#add05b1dba7a9938b30736abfceee94bf">CodeGenPrepareLegacyPass</a>;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &#42;TM = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetsubtargetinfo">TargetSubtargetInfo</a> &#42;SubtargetInfo = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42;TLI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;TRI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblocksectionsprofilereader">BasicBlockSectionsProfileReader</a> &#42;BBSectionsProfileReader = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLInfo = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  std::unique&#95;ptr&lt;BlockFrequencyInfo&gt; BFI;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">  std::unique&#95;ptr&lt;BranchProbabilityInfo&gt; BPI;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlightComment">  /// As we scan instructions optimizing them, this is the next instruction</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlightComment">  /// to optimize. Transforms that can invalidate this should update it.</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> CurInstIterator;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlightComment">  /// Keeps track of non-local addresses that have been sunk into a block.</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlightComment">  /// This allows us to avoid inserting duplicate code for blocks with</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlightComment">  /// multiple load/stores of the same address. The usage of WeakTrackingVH</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlightComment">  /// enables SunkAddrs to be treated as a cache whose entries can be</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightComment">  /// invalidated if a sunken address computation has been erased.</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/valuemap">ValueMap&lt;Value &#42;, WeakTrackingVH&gt;</a> SunkAddrs;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlightComment">  /// Keeps track of all instructions inserted for the current function.</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> InsertedInsts;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlightComment">  /// Keeps track of the type of the related instruction before their</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlightComment">  /// promotion for the current function.</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> PromotedInsts;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlightComment">  /// Keep track of instructions removed during promotion.</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> RemovedInsts;</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlightComment">  /// Keep track of sext chains based on their initial value.</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Instruction &#42;&gt;</a> SeenChainsForSExt;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlightComment">  /// Keep track of GEPs accessing the same data structures such as structs or</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlightComment">  /// arrays that are candidates to be split later because of their large</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlightComment">  /// size.</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;AssertingVH&lt;Value&gt;</a>,</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;</a>, int64&#95;t&gt;, 32&gt;&gt;</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">      LargeOffsetGEPMap;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlightComment">  /// Keep track of new GEP base after splitting the GEPs having large offset.</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;AssertingVH&lt;Value&gt;</a>, 2&gt; NewGEPBases;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlightComment">  /// Map serial numbers to Large offset GEPs.</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;AssertingVH&lt;GetElementPtrInst&gt;</a>, </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">&gt; LargeOffsetGEPID;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlightComment">  /// Keep track of SExt promoted.</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a882043c34b485e559cd3e42b1a4274b2">ValueToSExts</a> ValToSExtendedUses;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlightComment">  /// True if the function has the OptSize attribute.</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptSize;</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlightComment">  /// DataLayout for the Function being processed.</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;DL = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlightComment">  /// Building the dominator tree can be expensive, so we only build it</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlightComment">  /// lazily and update it when required.</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  std::unique&#95;ptr&lt;DominatorTree&gt; DT;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a88c47869c3d6832ba11c5480ba78aa04"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a88c47869c3d6832ba11c5480ba78aa04">CodeGenPrepare</a>()&#123;&#125;;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a2fab09a0564f5203372a75e51f20b526"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a2fab09a0564f5203372a75e51f20b526">CodeGenPrepare</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &#42;TM) : TM(TM)&#123;&#125;;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlightComment">  /// If encounter huge function, we need to limit the build time.</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlightComment">  /// FreshBBs is like worklist, it collected the updated BBs which need</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlightComment">  /// to be optimized again.</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlightComment">  /// Note: Consider building time in this pass, when a BB updated, we need</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlightComment">  /// to insert such BB into FreshBBs for huge function.</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>;</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a603cbf2855141608521f6709cdfb126f"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a603cbf2855141608521f6709cdfb126f">releaseMemory</a>() &#123;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clear per function information.</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    InsertedInsts.clear();</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">    PromotedInsts.clear();</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.clear();</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">    BPI.reset();</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">    BFI.reset();</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> run(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM);</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> F&gt;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> resetIteratorIfInvalidatedWhileCalling(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> f) &#123;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Substituting can cause recursive simplifications, which can invalidate</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// our iterator.  Use a WeakTrackingVH to hold onto it in case this</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// happens.</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CurValue = &amp;&#42;CurInstIterator;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> IterHandle(CurValue);</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">    f();</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the iterator instruction was recursively deleted, start over at the</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// start of the block.</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IterHandle != CurValue) &#123;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">      CurInstIterator = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">      SunkAddrs.<a href="/docs/api/classes/llvm/valuemap/#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the DominatorTree, building if necessary.</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  DominatorTree &amp;getDT(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT)</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">      DT = std::make&#95;unique&lt;DominatorTree&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;DT;</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> removeAllAssertingVHReferences(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V);</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateAssumptions(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateFallThrough(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DominatorTree &#42;DT = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateMostlyEmptyBlocks(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;findDestBlockOfMergeableEmptyBlock(BasicBlock &#42;BB);</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canMergeBlocks(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> BasicBlock &#42;BB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> BasicBlock &#42;DestBB) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> eliminateMostlyEmptyBlock(BasicBlock &#42;BB);</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isMergingEmptyBlockProfitable(BasicBlock &#42;BB, BasicBlock &#42;DestBB,</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isPreheader);</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> makeBitReverse(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/scalarizemaskedmemintrin-cpp/#a50754c809dc6a1aa65e3ab52f63f3467">optimizeBlock</a>(BasicBlock &amp;BB, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeInst(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeMemoryInst(Instruction &#42;MemoryInst, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;AccessTy,</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AddrSpace);</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeGatherScatterInst(Instruction &#42;MemoryInst, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeInlineAsmInst(CallInst &#42;CS);</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/scalarizemaskedmemintrin-cpp/#a5c59325f9c3c1526f4439392c892fd41">optimizeCallInst</a>(CallInst &#42;CI, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeExt(Instruction &#42;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeExtUses(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeLoadExt(LoadInst &#42;Load);</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeShiftInst(BinaryOperator &#42;BO);</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeFunnelShift(IntrinsicInst &#42;Fsh);</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeSelectInst(SelectInst &#42;SI);</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeShuffleVectorInst(ShuffleVectorInst &#42;SVI);</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeSwitchType(SwitchInst &#42;SI);</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeSwitchPhiConstants(SwitchInst &#42;SI);</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeSwitchInst(SwitchInst &#42;SI);</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeExtractElementInst(Instruction &#42;Inst);</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> dupRetToEnableTailCallOpts(BasicBlock &#42;BB, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> fixupDbgValue(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> fixupDbgVariableRecord(DbgVariableRecord &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> fixupDbgVariableRecordsOnInst(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> placeDbgValues(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> placePseudoProbes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canFormExtLd(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;MovedExts,</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">                    LoadInst &#42;&amp;LI, Instruction &#42;&amp;Inst, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasPromoted);</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> tryToPromoteExts(TypePromotionTransaction &amp;TPT,</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;Exts,</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">                        SmallVectorImpl&lt;Instruction &#42;&gt; &amp;ProfitablyMovedExts,</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CreatedInstsCost = 0);</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> mergeSExts(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> splitLargeGEPOffsets();</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizePhiType(PHINode &#42;Inst, SmallPtrSetImpl&lt;PHINode &#42;&gt; &amp;Visited,</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">                       SmallPtrSetImpl&lt;Instruction &#42;&gt; &amp;DeletedInstrs);</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizePhiTypes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> performAddressTypePromotion(</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">      Instruction &#42;&amp;Inst, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowPromotionWithoutCommonHeader,</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasPromoted, TypePromotionTransaction &amp;TPT,</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">      SmallVectorImpl&lt;Instruction &#42;&gt; &amp;SpeculativelyMovedExts);</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> splitBranchCondition(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyOffsetableRelocate(GCStatepointInst &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> tryToSinkFreeOperands(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> replaceMathCmpWithIntrinsic(BinaryOperator &#42;BO, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Arg0, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Arg1,</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">                                   CmpInst &#42;Cmp, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID);</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeCmp(CmpInst &#42;Cmp, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeURem(Instruction &#42;Rem);</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> combineToUSubWithOverflow(CmpInst &#42;Cmp, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> combineToUAddWithOverflow(CmpInst &#42;Cmp, ModifyDT &amp;ModifiedDT);</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> verifyBFIUpdates(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#95;run(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a> &#123;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998">ID</a>; </span><span class="doxyHighlightComment">// Pass identification, replacement for typeid</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>() : <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998">ID</a>) &#123;</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a49bbe77df41e968c3568041ee2932850">initializeCodeGenPrepareLegacyPassPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/entryexitinstrumenter-cpp/#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4ac0e57f95a82ff11606bb90d5f762c9"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4ac0e57f95a82ff11606bb90d5f762c9">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;CodeGen Prepare&quot;</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4e6eaa6981139214f5c249f3b365e2a3"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a4e6eaa6981139214f5c249f3b365e2a3">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: When we can selectively preserve passes, preserve the domtree.</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a>&gt;();</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/loopinfowrapperpass">LoopInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#aaeddaf79040291b6f3e0db57943aac39">addUsedIfAvailable</a>&lt;<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderwrapperpass">BasicBlockSectionsProfileReaderWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a10208fe90437973a8a0d630701b10998">CodeGenPrepareLegacyPass::ID</a> = 0;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a247a6373f131cbd580f94dd0483551b2"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#a247a6373f131cbd580f94dd0483551b2">CodeGenPrepareLegacyPass::runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TM = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetPassConfig&gt;</a>().getTM&lt;<a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a>&gt;();</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare">CodeGenPrepare</a> CGP(TM);</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  CGP.DL = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  CGP.SubtargetInfo = TM-&gt;getSubtargetImpl(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">  CGP.TLI = CGP.SubtargetInfo-&gt;getTargetLowering();</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  CGP.TRI = CGP.SubtargetInfo-&gt;getRegisterInfo();</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">  CGP.TLInfo = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;</a>().getTLI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  CGP.TTI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetTransformInfoWrapperPass&gt;</a>().getTTI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">  CGP.LI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;LoopInfoWrapperPass&gt;</a>().getLoopInfo();</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">  CGP.BPI.reset(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;CGP.LI));</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">  CGP.BFI.reset(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;CGP.BPI, &#42;CGP.LI));</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">  CGP.PSI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;</a>().getPSI();</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBSPRWP =</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/pass/#af94c014e968489e96c7d4353a84ad7f5">getAnalysisIfAvailable&lt;BasicBlockSectionsProfileReaderWrapperPass&gt;</a>();</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  CGP.BBSectionsProfileReader = BBSPRWP ? &amp;BBSPRWP-&gt;getBBSPR() : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CGP.&#95;run(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530" lineLink="#aaca449a7620b1306ed7586ba6bdc4faa"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;Optimize for code generation&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderwrapperpass">BasicBlockSectionsProfileReaderWrapperPass</a>)</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/loopinfowrapperpass">LoopInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a>)</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538" lineLink="#a030569d5a541b6110f2ae1b6a3413a58"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539" lineLink="#a82626751cd03ec5db2cc4939a10ad956"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;Optimize for code generation&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541" lineLink="/docs/api/namespaces/llvm/#a865ae563bea8062ebf0dcc035ccc2e82"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a865ae563bea8062ebf0dcc035ccc2e82">createCodeGenPrepareLegacyPass</a>() &#123;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenpreparelegacypass/#abe90e64ef1d08a332db00bfda116c9db">CodeGenPrepareLegacyPass</a>();</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545" lineLink="/docs/api/classes/llvm/codegenpreparepass/#a33f05511e053fdbfa05140b0cd29553a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/codegenpreparepass/#a33f05511e053fdbfa05140b0cd29553a">CodeGenPreparePass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">                                          <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">  CodeGenPrepare CGP(TM);</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = CGP.run(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, AM);</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aa963097f89a02195cba904f74c5e0f71"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aa963097f89a02195cba904f74c5e0f71">CodeGenPrepare::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">  DL = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">  SubtargetInfo = TM-&gt;getSubtargetImpl(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  TLI = SubtargetInfo-&gt;getTargetLowering();</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  TRI = SubtargetInfo-&gt;getRegisterInfo();</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  TLInfo = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  TTI = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  LI = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  BPI.reset(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;LI));</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  BFI.reset(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;BPI, &#42;LI));</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MAMProxy = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a2b0ee73723ccffec457f8712220b0c25">ModuleAnalysisManagerFunctionProxy</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">  PSI = MAMProxy.getCachedResult&lt;<a href="/docs/api/classes/llvm/profilesummaryanalysis">ProfileSummaryAnalysis</a>&gt;(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  BBSectionsProfileReader =</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">      AM.<a href="/docs/api/classes/llvm/analysismanager/#a828ff8185f881fca9e3d534781244041">getCachedResult</a>&lt;<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderanalysis">BasicBlockSectionsProfileReaderAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#95;run(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::&#95;run(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EverMadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  OptSize = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasOptSize();</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use the basic-block-sections profile to promote hot functions to .text.hot</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if requested.</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aaabb67aa574169b8cf2db8baf993b9ea">BBSectionsGuidedSectionPrefix</a> &amp;&amp; BBSectionsProfileReader &amp;&amp;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">      BBSectionsProfileReader-&gt;<a href="/docs/api/classes/llvm/basicblocksectionsprofilereader/#a31414298cda30f1d52c965571b4efc75">isFunctionHot</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName())) &#123;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</span><span class="doxyHighlightStringLiteral">&quot;hot&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a6cdb6fbcff4780503fef226b46b6f10b">ProfileGuidedSectionPrefix</a>) &#123;</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The hot attribute overwrites profile count based hotness while profile</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// counts based hotness overwrite the cold attribute.</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is a conservative behabvior.</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::Hot) ||</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">        PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a8a527a78e773ac22ca346a7b8ca9201e">isFunctionHotInCallGraph</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;BFI))</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</span><span class="doxyHighlightStringLiteral">&quot;hot&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If PSI shows this function is not hot, we will placed the function</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// into unlikely section if (1) PSI shows this is a cold function, or</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (2) the function has a attribute of cold.</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a1cdf368dd1d358e55f871484b1fec5cc">isFunctionColdInCallGraph</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;BFI) ||</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::Cold))</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</span><span class="doxyHighlightStringLiteral">&quot;unlikely&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a276112f96ea0d245fec9eaa1306712c0">ProfileUnknownInSpecialSection</a> &amp;&amp; PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a9610274171a85158779e7ee6031d2376">hasPartialSampleProfile</a>() &amp;&amp;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">             PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a215c4f3e485345daeb8e9d68264f388a">isFunctionHotnessUnknown</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(</span><span class="doxyHighlightStringLiteral">&quot;unknown&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlightComment">  /// This optimization identifies DIV instructions that can be</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlightComment">  /// profitably bypassed and carried out with a shorter, faster divide.</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OptSize &amp;&amp; !PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#ad7a8ced5ff54962319d57208f5d4a57e">hasHugeWorkingSetSize</a>() &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a6ade65d2ea72712ca307ed5d5876dba8">isSlowDivBypassed</a>()) &#123;</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned int, unsigned int&gt;</a> &amp;BypassWidths =</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">        TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#abc6a0c251a75bb3b9b47c79c7ab0e503">getBypassSlowDivWidths</a>();</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (BB != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// bypassSlowDivision may create new BBs, but we don&#39;t want to reapply the</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// optimization to those blocks.</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a> = BB-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>();</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(BB, PSI, <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get()))</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">        EverMadeChange |= <a href="/docs/api/namespaces/llvm/#ac7a11b9f5656e9697ac700a0e57dbb04">bypassSlowDivision</a>(BB, BypassWidths);</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">      BB = <a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a>;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get rid of @llvm.assume builtins before attempting to eliminate empty</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks, since there might be blocks that only contain @llvm.assume calls</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (plus arguments that we can get rid of).</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">  EverMadeChange |= eliminateAssumptions(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eliminate blocks that contain only PHI nodes and an</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unconditional branch.</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">  EverMadeChange |= eliminateMostlyEmptyBlocks(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>;</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a>)</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">    EverMadeChange |= splitBranchCondition(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ModifiedDT);</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Split some critical edges where one of the sources is an indirect branch,</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to help generate sane code for PHIs involving such edges.</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">  EverMadeChange |=</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a502009030bffff8a6992f4e4eb9380f5">SplitIndirectBrCriticalEdges</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightComment">/&#42;IgnoreBlocksWithoutPHI=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are optimzing huge function, we need to consider the build time.</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Because the basic algorithm&#39;s complex is near O(N!).</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">  IsHugeFunc = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.size() &gt; <a href="#a6eff5790402995c83be65f9260826b41">HugeFuncThresholdInCGPP</a>;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transformations above may invalidate dominator tree and/or loop info.</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  DT.reset();</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">  LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#aea153ce91e791ba0ca4cc59d72c5145c">releaseMemory</a>();</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">  LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a280d02be3ec3eb6527c1ea944d902775">analyze</a>(getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FuncIterated = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (MadeChange) &#123;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FuncIterated &amp;&amp; !FreshBBs.<a href="/docs/api/classes/llvm/smallset/#ae04ad615dfdd885e85cbddda146787c6">contains</a>(&amp;BB))</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> ModifiedDTOnIteration = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/scalarizemaskedmemintrin-cpp/#a50754c809dc6a1aa65e3ab52f63f3467">optimizeBlock</a>(BB, ModifiedDTOnIteration);</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ModifiedDTOnIteration == <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>)</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">        DT.reset();</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">      MadeChange |= <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsHugeFunc) &#123;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the BB is updated, it may still has chance to be optimized.</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This usually happen at sink optimization.</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For example:</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// bb0</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// %and = and i32 %a, 4</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// %cmp = icmp eq i32 %and, 0</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the %cmp sink to other BB, the %and will has chance to sink.</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">          FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(&amp;BB);</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FuncIterated)</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">          FreshBBs.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(&amp;BB);</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For small/normal functions, we restart BB iteration if the dominator</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// tree of the Function was changed.</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ModifiedDTOnIteration != <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>)</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have iterated all the BB in the (only work for huge) function.</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">    FuncIterated = IsHugeFunc;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a6412f4a5842ffe108c2aa493fa0fe1b1">EnableTypePromotionMerge</a> &amp;&amp; !ValToSExtendedUses.<a href="/docs/api/classes/llvm/mapvector/#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">      MadeChange |= mergeSExts(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">      MadeChange |= splitLargeGEPOffsets();</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">    MadeChange |= optimizePhiTypes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MadeChange)</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">      eliminateFallThrough(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT.get());</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MadeChange &amp;&amp; <a href="/docs/api/namespaces/llvm/#a8bf0b85d705bf73d1af85056ef77b9c5">VerifyLoopInfo</a>)</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">      LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a17a8f7aba5cca5c7f9faa779a3c4bc37">verify</a>(getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Really free removed instructions during promotion.</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : RemovedInsts)</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;deleteValue();</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">    EverMadeChange |= MadeChange;</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">    SeenChainsForSExt.<a href="/docs/api/classes/llvm/densemapbase/#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    ValToSExtendedUses.<a href="/docs/api/classes/llvm/mapvector/#ae091b147039557cf8ce505740e7ff7ac">clear</a>();</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">    RemovedInsts.clear();</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">    LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#ae091b147039557cf8ce505740e7ff7ac">clear</a>();</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">    LargeOffsetGEPID.<a href="/docs/api/classes/llvm/densemapbase/#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">  NewGEPBases.<a href="/docs/api/classes/llvm/smallset/#a76b3fc7c102561fb5210d5151531e409">clear</a>();</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">  SunkAddrs.<a href="/docs/api/classes/llvm/valuemap/#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a62cd718328addb93b7bfbfd788fa9c33">DisableBranchOpts</a>) &#123;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Use a set vector to get deterministic iteration order. The order the</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// blocks are removed may affect whether or not PHI nodes in successors</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// are removed.</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 8&gt;</a> WorkList;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> Successors(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(&amp;BB));</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">      MadeChange |= <a href="/docs/api/namespaces/llvm/#a152d8c380cc937c9dceb402ceec943b6">ConstantFoldTerminator</a>(&amp;BB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MadeChange)</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : Successors)</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(Succ))</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">          WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Succ);</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Delete the dead blocks and any of their dead successors.</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">    MadeChange |= !WorkList.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>();</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!WorkList.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>()) &#123;</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = WorkList.<a href="/docs/api/classes/llvm/setvector/#af9880d625c506aacc716ee1c9a29ff8b">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> Successors(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB));</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(BB);</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : Successors)</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(Succ))</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">          WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Succ);</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Merge pairs of basic blocks with unconditional branches, connected by</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a single edge.</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EverMadeChange || MadeChange)</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">      MadeChange |= eliminateFallThrough(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">    EverMadeChange |= MadeChange;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ac23f3d86779d204fbf6db71ce8f41d7b">DisableGCOpts</a>) &#123;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GCStatepointInst &#42;, 2&gt;</a> Statepoints;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB)</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SP = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCStatepointInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">          Statepoints.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SP);</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Statepoints)</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">      EverMadeChange |= simplifyOffsetableRelocate(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do this last to clean up use-before-def scenarios introduced by other</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preparatory transforms.</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  EverMadeChange |= placeDbgValues(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  EverMadeChange |= placePseudoProbes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a>)</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">    verifyBFIUpdates(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EverMadeChange;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::eliminateAssumptions(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">    CurInstIterator = BB.begin();</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CurInstIterator != BB.end()) &#123;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &amp;&#42;(CurInstIterator++);</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Assume = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">        MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Operand = <a href="/docs/api/namespaces/llvm/lowertypetests/#a28baf2df0f23eab12b60755416e83adaa4822c96fc1eebe031cde975d10a29e12">Assume</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/lowertypetests/#a28baf2df0f23eab12b60755416e83adaa4822c96fc1eebe031cde975d10a29e12">Assume</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">        resetIteratorIfInvalidatedWhileCalling(&amp;BB, &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Operand, TLInfo, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">        &#125;);</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlightComment">/// An instruction is about to be deleted, so remove all references to it in our</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlightComment">/// GEP-tracking data strcutures.</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> CodeGenPrepare::removeAllAssertingVHReferences(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">  LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a3a8171298a7d19a309d599de01906703">erase</a>(V);</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">  NewGEPBases.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(V);</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(V);</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  LargeOffsetGEPID.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> VecI = LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecI == LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a0881334358ff6ff7ff8cea5562c7988e">end</a>())</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;GEPVector = VecI-&gt;second;</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(GEPVector, &#91;=&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Elt) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Elt.first == <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>; &#125;);</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GEPVector.empty())</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">    LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a3a8171298a7d19a309d599de01906703">erase</a>(VecI);</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlightComment">// Verify BFI has been updated correctly by recomputing BFI and comparing them.</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#acc1c483f4b4ee2f17bb6643a3b353609">LLVM&#95;ATTRIBUTE&#95;UNUSED</a> CodeGenPrepare::verifyBFIUpdates(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> NewDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> NewLI(NewDT);</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> NewBPI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NewLI, TLInfo);</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> NewBFI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NewBPI, NewLI);</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">  NewBFI.verifyMatch(&#42;BFI);</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlightComment">/// Merge basic blocks which are connected by a single edge, where one of the</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlightComment">/// basic blocks has a single successor pointing to the other basic block,</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlightComment">/// which has a single predecessor.</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::eliminateFallThrough(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan all of the blocks in the function, except for the entry block.</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use a temporary array to avoid iterator being invalidated when</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// deleting blocks.</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 16&gt;</a> Blocks;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">llvm::drop&#95;begin</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">    Blocks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;WeakTrackingVH, 16&gt;</a> Preds;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB)</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the destination block has a single pred, then this is a trivial</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// edge, just collapse it.</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SinglePred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t merge if BB&#39;s address is taken.</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SinglePred || SinglePred == BB || BB-&gt;hasAddressTaken())</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make an effort to skip unreachable blocks.</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT &amp;&amp; !DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(BB))</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(SinglePred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Term &amp;&amp; !<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a>-&gt;isConditional()) &#123;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;To merge:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n\\n\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Merge BB into SinglePred and delete it.</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(BB, </span><span class="doxyHighlightComment">/&#42; DTU &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, LI, </span><span class="doxyHighlightComment">/&#42; MSSAU &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">                                </span><span class="doxyHighlightComment">/&#42; MemDep &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">                                </span><span class="doxyHighlightComment">/&#42; PredecessorWithTwoSuccessors &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, DT);</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">      Preds.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(SinglePred);</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsHugeFunc) &#123;</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update FreshBBs to optimize the merged BB.</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(SinglePred);</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(BB);</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (Repeatedly) merging blocks into their predecessors can create redundant</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// debug intrinsics.</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pred : Preds)</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(Pred))</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a08f3f942afc0ee9115a8f9fa87e9191d">RemoveRedundantDbgInstrs</a>(BB);</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlightComment">/// Find a destination block from BB if BB is mergeable empty block.</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CodeGenPrepare::findDestBlockOfMergeableEmptyBlock(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this block doesn&#39;t end with an uncond branch, ignore it.</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the instruction before the branch (skipping debug info) isn&#39;t a phi</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// node, then other stuff is happening here.</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = BI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBI != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) &#123;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">    --BBI;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BBI)) &#123;</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBI == BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">      --BBI;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BBI) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BBI))</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not break infinite loops.</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestBB == BB)</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!canMergeBlocks(BB, DestBB))</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">    DestBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DestBB;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlightComment">/// Eliminate blocks that contain only PHI nodes, debug info directives, and an</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlightComment">/// unconditional branch. Passes before isel (e.g. LSR/loopsimplify) often split</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlightComment">/// edges in ways that are non-optimal for isel. Start by eliminating these</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlightComment">/// blocks so we can split them the way we want them.</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::eliminateMostlyEmptyBlocks(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> Preheaders;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Loop &#42;, 16&gt;</a> LoopList(LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ab447b41b9c51151b5c6ef497a60689ae">begin</a>(), LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a4f728602e7d377829675f13446cf6647">end</a>());</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!LoopList.empty()) &#123;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a> = LoopList.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">llvm::append&#95;range</a>(LoopList, &#42;L);</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopPreheader())</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      Preheaders.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Preheader);</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy blocks into a temporary array to avoid iterator invalidation issues</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as we remove them.</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that this intentionally skips the entry block.</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 16&gt;</a> Blocks;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">llvm::drop&#95;begin</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Delete phi nodes that could block deleting other empty blocks.</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#af6d9ea3fbe9aad1268fdabb3863c336c">DisableDeletePHIs</a>)</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">      MadeChange |= <a href="/docs/api/namespaces/llvm/#a64ecdacbd49f696216e772782a109945">DeleteDeadPHIs</a>(&amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>, TLInfo);</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">    Blocks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB)</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = findDestBlockOfMergeableEmptyBlock(BB);</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestBB ||</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">        !isMergingEmptyBlockProfitable(BB, DestBB, Preheaders.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(BB)))</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">    eliminateMostlyEmptyBlock(BB);</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::isMergingEmptyBlockProfitable(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB,</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">                                                   </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isPreheader) &#123;</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not delete loop preheaders if doing so would create a critical edge.</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop preheaders can be good locations to spill registers. If the</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preheader is deleted and we create a critical edge, registers may be</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// spilled in the loop body instead.</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a346da4fb7a62e95531402c0b2a85c4fd">DisablePreheaderProtect</a> &amp;&amp; isPreheader &amp;&amp;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">      !(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>() &amp;&amp;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">        BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>()))</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip merging if the block&#39;s successor is also a successor to any callbr</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that leads to this block.</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Is this really needed? Is this a correctness issue?</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallBrInst&gt;</a>(Pred-&gt;getTerminator()) &amp;&amp;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Pred), DestBB))</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to skip merging if the unique predecessor of BB is terminated by a</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// switch or indirect branch instruction, and BB is used as an incoming block</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of PHIs in DestBB. In such case, merging BB and DestBB would cause ISel to</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// add COPY instructions in the predecessor of BB instead of BB (if it is not</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// merged). Note that the critical edge created by merging such blocks wont be</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// split in MachineSink because the jump table is not analyzable. By keeping</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// such empty block (BB), ISel will place COPY instructions in BB, not in the</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor of BB.</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>();</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Pred || !(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SwitchInst&gt;</a>(Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) ||</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">                 <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())))</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>() != &amp;&#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a50909227135ef69932bff39b8ea3f572">getFirstNonPHIOrDbg</a>())</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We use a simple cost heuristic which determine skipping merging is</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// profitable if the cost of skipping merging is less than the cost of</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// merging : Cost(skipping merging) &lt; Cost(merging BB), where the</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cost(skipping merging) is Freq(BB) &#42; (Cost(Copy) + Cost(Branch)), and</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the Cost(merging BB) is Freq(Pred) &#42; Cost(Copy).</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assuming Cost(Copy) == Cost(Branch), we could simplify it to :</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Freq(Pred) / Freq(BB) &gt; 2</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that if there are multiple empty blocks sharing the same incoming</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value for the PHIs in the DestBB, we consider them together. In such</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case, Cost(merging BB) will be the sum of their frequencies.</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> SameIncomingValueBBs;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find all other incoming blocks from which incoming values of all PHIs in</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DestBB are the same as the ones from BB.</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBBPred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(DestBB)) &#123;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestBBPred == BB)</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>(), &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;DestPN) &#123;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">          return DestPN.getIncomingValueForBlock(BB) ==</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">                 DestPN.getIncomingValueForBlock(DestBBPred);</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">        &#125;))</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">      SameIncomingValueBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(DestBBPred);</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if all BB&#39;s incoming values are same as the value from Pred. In this</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case, no reason to skip merging because COPYs are expected to be place in</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pred already.</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameIncomingValueBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Pred))</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> PredFreq = <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(Pred);</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a> = <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(BB);</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SameValueBB : SameIncomingValueBBs)</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameValueBB-&gt;getUniquePredecessor() == Pred &amp;&amp;</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">        DestBB == findDestBlockOfMergeableEmptyBlock(SameValueBB))</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a> += <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(SameValueBB);</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  std::optional&lt;BlockFrequency&gt; Limit = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a>.mul(<a href="#acb1402a601e394cbb3a7b1a1c4e4634f">FreqRatioToSkipMerge</a>);</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Limit || PredFreq &lt;= &#42;Limit;</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlightComment">/// Return true if we can merge BB into DestBB if there is a single</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlightComment">/// unconditional branch between them, and BB contains no other non-phi</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlightComment">/// instructions.</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::canMergeBlocks(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only want to eliminate blocks whose phi nodes are used by phi nodes in</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the successor.  If there are more complex condition (e.g. preheaders),</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// don&#39;t mess around with them.</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : PN.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != DestBB || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI))</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If User is inside DestBB block and it is a PHINode then check</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// incoming value. If incoming value is not from BB then this is</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a complex condition (e.g. preheaders) we want to avoid here.</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == DestBB) &#123;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;UPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(UI))</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = UPN-&gt;getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(UPN-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>-&gt;getParent() == BB &amp;&amp;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>-&gt;getParent() != UPN-&gt;getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If BB and DestBB contain any common predecessors, then the phi nodes in BB</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and DestBB may have conflicting incoming values for the block.  If so, we</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can&#39;t merge the block.</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;DestBBPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestBBPN)</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// no conflict.</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the preds of BB.</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const BasicBlock &#42;, 16&gt;</a> BBPreds;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;BBPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) &#123;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It is faster to get preds from a PHI than with pred&#95;iterator.</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = BBPN-&gt;getNumIncomingValues(); i != e; ++i)</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">      BBPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BBPN-&gt;getIncomingBlock(i));</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">    BBPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB));</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the preds of DestBB.</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = DestBBPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = DestBBPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i);</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Pred)) &#123; </span><span class="doxyHighlightComment">// Common predecessor?</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V1 = PN.getIncomingValueForBlock(Pred);</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = PN.getIncomingValueForBlock(BB);</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If V2 is a phi node in BB, look up what the mapped value will be.</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;V2PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V2))</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V2PN-&gt;getParent() == BB)</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = V2PN-&gt;getIncomingValueForBlock(Pred);</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If there is a conflict, bail out.</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V1 != V2)</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlightComment">/// Replace all old uses with new ones, and push the updated BBs into FreshBBs.</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112" lineLink="#a19e092ecf7889abf7277f13824e0c601"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Old, <a href="/docs/api/classes/llvm/value">Value</a> &#42;New,</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsHuge) &#123;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Old);</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldI) &#123;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = OldI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = OldI-&gt;user&#95;end();</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">         UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++UI) &#123;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsHuge)</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent());</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">  Old-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlightComment">/// Eliminate a basic block that has only phi&#39;s and an unconditional branch in</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlightComment">/// it.</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> CodeGenPrepare::eliminateMostlyEmptyBlock(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;MERGING MOSTLY EMPTY BLOCKS - BEFORE:\\n&quot;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">                    &lt;&lt; &#42;BB &lt;&lt; &#42;DestBB);</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the destination block has a single pred, then this is a trivial edge,</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// just collapse it.</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SinglePred = DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) &#123;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinglePred != DestBB) &#123;</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SinglePred == BB &amp;&amp;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Single predecessor not the same as predecessor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Merge DestBB into SinglePred/BB and delete it.</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(DestBB);</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note: BB(=SinglePred) will not be deleted on this path.</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// DestBB(=its single successor) is the one that was deleted.</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AFTER:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SinglePred &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n\\n\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsHugeFunc) &#123;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update FreshBBs to optimize the merged BB.</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(SinglePred);</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">        FreshBBs.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(DestBB);</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, we have multiple predecessors of BB.  Update the PHIs in DestBB</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to handle the new incoming edges it is about to have.</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : DestBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove the incoming value for BB, and remember it.</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = PN.removeIncomingValue(BB, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Two options: either the InVal is a phi node defined in BB or it is some</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value that dominates BB.</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;InValPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(InVal);</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InValPhi &amp;&amp; InValPhi-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB) &#123;</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add all of the input values of the input PHI as inputs of this phi.</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = InValPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i)</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">        PN.addIncoming(InValPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i),</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">                       InValPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i));</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise, add one instance of the dominating value for each edge that</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we will be adding.</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;BBPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) &#123;</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = BBPN-&gt;getNumIncomingValues(); i != e; ++i)</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">          PN.addIncoming(InVal, BBPN-&gt;getIncomingBlock(i));</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">          PN.addIncoming(InVal, Pred);</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Preserve loop Metadata.</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a565f546ad95bd3a9bbe9a1e5040803f0">hasMetadata</a>(LLVMContext::MD&#95;loop)) &#123;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">      Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;BI, LLVMContext::MD&#95;loop);</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The PHIs are now updated, change everything that refers to BB to use</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DestBB and remove BB.</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">  BB-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(DestBB);</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">  ++NumBlocksElim;</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AFTER:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;DestBB &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n\\n\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlightComment">// Computes a map of base pointer relocation instructions to corresponding</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlightComment">// derived pointer relocation instructions given a vector of all relocate calls</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201" lineLink="#a8f5b32a03cc4a6072855d8c8cf7c748f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8f5b32a03cc4a6072855d8c8cf7c748f">computeBaseDerivedRelocateMap</a>(</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;GCRelocateInst &#42;&gt;</a> &amp;AllRelocateCalls,</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mapvector">MapVector</a>&lt;<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;, <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GCRelocateInst &#42;, 0&gt;</a>&gt;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">        &amp;RelocateInstMap) &#123;</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect information in two maps: one primarily for locating the base object</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// while filling the second map; the second map is the final structure holding</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a mapping between Base and corresponding Derived relocate calls</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;std::pair&lt;unsigned, unsigned&gt;</a>, <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;&gt; RelocateIdxMap;</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ThisRelocate : AllRelocateCalls) &#123;</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> K = std::make&#95;pair(ThisRelocate-&gt;getBasePtrIndex(),</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">                            ThisRelocate-&gt;getDerivedPtrIndex());</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">    RelocateIdxMap.<a href="/docs/api/classes/llvm/mapvector/#abb6ea6cbdf19ab64bf0c8f65b2e6e8ce">insert</a>(std::make&#95;pair(K, ThisRelocate));</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Item : RelocateIdxMap) &#123;</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">    std::pair&lt;unsigned, unsigned&gt; <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a> = Item.first;</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.first == <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.second)</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Base relocation: nothing to insert</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Item.second;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BaseKey = std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.first, <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>.first);</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;re iterating over RelocateIdxMap so we cannot modify it.</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaybeBase = RelocateIdxMap.<a href="/docs/api/classes/llvm/mapvector/#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(BaseKey);</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaybeBase == RelocateIdxMap.<a href="/docs/api/classes/llvm/mapvector/#a0881334358ff6ff7ff8cea5562c7988e">end</a>())</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: We might want to insert a new base object relocate and gep off</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// that, if there are enough derived object relocates.</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">    RelocateInstMap&#91;MaybeBase-&gt;second&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlightComment">// Accepts a GEP and extracts the operands into a vector provided they&#39;re all</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlightComment">// small integer constants</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236" lineLink="#a0e431b29d5cd842ab00f85ec2cdab8b2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Value &#42;&gt;</a> &amp;OffsetV) &#123;</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1; i &lt; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); i++) &#123;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only accept small constant integer operands</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(i));</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> || <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getZExtValue() &gt; 20)</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1; i &lt; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); i++)</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">    OffsetV.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(i));</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlightComment">// Takes a RelocatedBase (base pointer relocation instruction) and Targets to</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlightComment">// replace, computes a replacement, and affects it.</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253" lineLink="#a9364799319bac519aa565ec882986e6d"><span class="doxyHighlight"><a href="#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a>(<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;RelocatedBase,</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;GCRelocateInst &#42;&gt;</a> &amp;Targets) &#123;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We must ensure the relocation of derived pointer is defined after</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// relocation of base pointer. If we find a relocation corresponding to base</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// defined earlier than relocation of base then we move relocation of base</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// right before found relocation. We consider only relocation in the same</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// basic block as relocation of base. Relocations from other basic block will</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be skipped by optimization and we do not care about them.</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> R = RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstInsertionPt();</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">       &amp;&#42;R != RelocatedBase; ++R)</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCRelocateInst&gt;</a>(R))</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RI-&gt;getStatepoint() == RelocatedBase-&gt;<a href="/docs/api/classes/llvm/gcprojectioninst/#a6cffcfabac72ca61185ea24c1208b937">getStatepoint</a>())</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RI-&gt;getBasePtrIndex() == RelocatedBase-&gt;<a href="/docs/api/classes/llvm/gcrelocateinst/#ae33641b6538b4ab4f3aa3dad2926860f">getBasePtrIndex</a>()) &#123;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">          RelocatedBase-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(RI-&gt;getIterator());</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">          MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;ToReplace : Targets) &#123;</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ToReplace-&gt;getBasePtrIndex() == RelocatedBase-&gt;<a href="/docs/api/classes/llvm/gcrelocateinst/#ae33641b6538b4ab4f3aa3dad2926860f">getBasePtrIndex</a>() &amp;&amp;</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Not relocating a derived object of the original base object&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ToReplace-&gt;getBasePtrIndex() == ToReplace-&gt;getDerivedPtrIndex()) &#123;</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// A duplicate relocate call. TODO: coalesce duplicates.</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != ToReplace-&gt;getParent()) &#123;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Base and derived relocates are in different basic blocks.</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// In this case transform is only valid when base dominates derived</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// relocate. However it would be too expensive to check dominance</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for each such relocate, so we skip the whole transformation.</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = ToReplace-&gt;getBasePtr();</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Derived = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(ToReplace-&gt;getDerivedPtr());</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Derived || Derived-&gt;getPointerOperand() != <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> OffsetV;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a>(Derived, OffsetV))</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a Builder and replace the target callsite with a gep</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>() &amp;&amp;</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Should always have one since it&#39;s not a terminator&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert after RelocatedBase</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(RelocatedBase-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(ToReplace-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If gc&#95;relocate does not match the actual type, cast it to the right type.</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In theory, there must be a bitcast after gc&#95;relocate if the type does not</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// match, and we should reuse it to get the derived pointer. But it could be</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cases like this:</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bb1:</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  ...</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  %g1 = call coldcc i8 addrspace(1)&#42;</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  @llvm.experimental.gc.relocate.p1i8(...) br label %merge</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bb2:</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  ...</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  %g2 = call coldcc i8 addrspace(1)&#42;</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  @llvm.experimental.gc.relocate.p1i8(...) br label %merge</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// merge:</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  %p1 = phi i8 addrspace(1)&#42; &#91; %g1, %bb1 &#93;, &#91; %g2, %bb2 &#93;</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  %cast = bitcast i8 addrspace(1)&#42; %p1 in to i32 addrspace(1)&#42;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In this case, we can not find the bitcast any more. So we insert a new</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast no matter there is already one or not. In this way, we can handle</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// all cases, and the extra bitcast should be optimized away in later</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// passes.</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ActualRelocatedBase = RelocatedBase;</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RelocatedBase-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType()) &#123;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">      ActualRelocatedBase =</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(RelocatedBase, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType());</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Replacement =</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(Derived-&gt;getSourceElementType(), ActualRelocatedBase,</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>(OffsetV));</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">    Replacement-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(ToReplace);</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the newly generated derived pointer&#39;s type does not match the original</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// derived pointer&#39;s type, cast the new derived pointer to match it. Same</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reasoning as above.</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ActualReplacement = Replacement;</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Replacement-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != ToReplace-&gt;getType()) &#123;</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      ActualReplacement =</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Replacement, ToReplace-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">    ToReplace-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ActualReplacement);</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">    ToReplace-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlightComment">// Turns this:</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlightComment">// %base = ...</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlightComment">// %ptr = gep %base + 15</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlightComment">// %tok = statepoint (%fun, i32 0, i32 0, i32 0, %base, %ptr)</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlightComment">// %base&#39; = relocate(%tok, i32 4, i32 4)</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlightComment">// %ptr&#39; = relocate(%tok, i32 4, i32 5)</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlightComment">// %val = load %ptr&#39;</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlightComment">// into this:</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlightComment">// %base = ...</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlightComment">// %ptr = gep %base + 15</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlightComment">// %tok = statepoint (%fun, i32 0, i32 0, i32 0, %base, %ptr)</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlightComment">// %base&#39; = gc.relocate(%tok, i32 4, i32 4)</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlightComment">// %ptr&#39; = gep %base&#39; + 15</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlightComment">// %val = load %ptr&#39;</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::simplifyOffsetableRelocate(<a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GCRelocateInst &#42;, 2&gt;</a> AllRelocateCalls;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users())</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;Relocate = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCRelocateInst&gt;</a>(U))</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Collect all the relocate calls associated with a statepoint</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">      AllRelocateCalls.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Relocate);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need at least one base pointer relocation + one derived pointer</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// relocation to mangle</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllRelocateCalls.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; 2)</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// RelocateInstMap is a mapping from the base relocate instruction to the</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// corresponding derived relocate instructions</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;GCRelocateInst &#42;, SmallVector&lt;GCRelocateInst &#42;, 0&gt;</a>&gt; RelocateInstMap;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">  <a href="#a8f5b32a03cc4a6072855d8c8cf7c748f">computeBaseDerivedRelocateMap</a>(AllRelocateCalls, RelocateInstMap);</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RelocateInstMap.<a href="/docs/api/classes/llvm/mapvector/#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Item : RelocateInstMap)</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Item.first is the RelocatedBase to offset against</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Item.second is the vector of Targets to replace</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">    MadeChange = <a href="#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a>(Item.first, Item.second);</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlightComment">/// Sink the specified cast instruction into its user blocks.</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397" lineLink="#a3cc8a3a2506bf528398d0aef0850f31a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CI) &#123;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefBB = CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlightComment">  /// InsertedCasts - Only insert a cast in each block once.</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, CastInst &#42;&gt;</a> InsertedCasts;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = CI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = CI-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>();</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Figure out which BB this cast is used in.  For PHI&#39;s this is the</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// appropriate predecessor block.</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">      UserBB = PN-&gt;getIncomingBlock(TheUse);</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Preincrement use iterator so we don&#39;t invalidate it.</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">    ++UI;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The first insertion point of a block containing an EH pad is after the</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pad.  If the pad is the user, we cannot sink the cast past the pad.</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;isEHPad())</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the block selected to receive the cast is an EH pad that does not</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// allow non-PHI instructions before the terminator, we can&#39;t sink the</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cast.</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a5d3d315f678bc76e43b27d18e5d72829">isEHPad</a>())</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this user is in the same block as the cast, don&#39;t change the cast.</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB == DefBB)</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have already inserted a cast into this block, use it.</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;&amp;InsertedCast = InsertedCasts&#91;UserBB&#93;;</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertedCast) &#123;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">      InsertedCast = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">      InsertedCast-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace a use of the cast with a use of the new cast.</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">    TheUse = InsertedCast;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">    ++NumCastUses;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we removed all uses, nuke the cast.</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(&#42;CI);</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">    CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlightComment">/// If the specified cast instruction is a noop copy (e.g. it&#39;s casting from</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlightComment">/// one pointer type to another, i32-&gt;i8 on PPC), sink it into user blocks to</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlightComment">/// reduce the number of virtual registers that must be created and coalesced.</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlightComment">/// Return true if any changes are made.</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465" lineLink="#a3b82cff474790446f1288f1a086c1cd6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sink only &quot;cheap&quot; (or nop) address-space casts.  This is a weaker condition</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// than sinking only nop casts, but is helpful on some platforms.</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ASC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AddrSpaceCastInst&gt;</a>(CI)) &#123;</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a8e1c8a5721df02cd26c1ffd04320b02c">isFreeAddrSpaceCast</a>(ASC-&gt;getSrcAddressSpace(),</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">                                 ASC-&gt;getDestAddressSpace()))</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a noop copy,</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/evt">EVT</a> SrcVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/evt">EVT</a> DstVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is an fp&lt;-&gt;int conversion?</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcVT.<a href="/docs/api/structs/llvm/evt/#af975bf04c49cc895cfe38e7dc126a2f1">isInteger</a>() != DstVT.<a href="/docs/api/structs/llvm/evt/#af975bf04c49cc895cfe38e7dc126a2f1">isInteger</a>())</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is an extension, it will be a zero or sign extension, which</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// isn&#39;t a noop.</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcVT.<a href="/docs/api/structs/llvm/evt/#a3bf257bfbd279ecfad670be03b00210e">bitsLT</a>(DstVT))</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If these values will be promoted, find out what they will be promoted</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to.  This helps us consider truncates on PPC as noop copies when they</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are.</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#ad859786d7e54bdc5c568ac20c69816e0">getTypeAction</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SrcVT) ==</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targetloweringbase/#a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d">TargetLowering::TypePromoteInteger</a>)</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    SrcVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a77f7add8733417370a56154e8b560617">getTypeToTransformTo</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SrcVT);</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#ad859786d7e54bdc5c568ac20c69816e0">getTypeAction</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), DstVT) ==</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targetloweringbase/#a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d">TargetLowering::TypePromoteInteger</a>)</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">    DstVT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a77f7add8733417370a56154e8b560617">getTypeToTransformTo</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), DstVT);</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If, after promotion, these are the same types, this is a noop copy.</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcVT != DstVT)</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(CI);</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlightComment">// Match a simple increment by constant operation.  Note that if a sub is</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlightComment">// matched, the step is negated (as if the step had been canonicalized to</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlightComment">// an add, even though we leave the instruction alone.)</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508" lineLink="#a9f54e95337782bd4fb335dd547c05ecc"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVInc, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp;Step) &#123;</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step))) ||</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#a445051c482340bacd1e3264406421afb">m&#95;ExtractValue&lt;0&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::uadd&#95;with&#95;overflow&gt;</a>(</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">                       <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step)))))</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step))) ||</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a href="/docs/api/namespaces/llvm/patternmatch/#a445051c482340bacd1e3264406421afb">m&#95;ExtractValue&lt;0&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::usub&#95;with&#95;overflow&gt;</a>(</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">                       <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Step))))) &#123;</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">    Step = <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(Step);</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlightComment">/// If given \\p PN is an inductive variable with value IVInc coming from the</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlightComment">/// backedge, and on each iteration it gets increased by Step, return pair</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlightComment">/// &lt;IVInc, Step&gt;. Otherwise, return std::nullopt.</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;std::pair&lt;Instruction &#42;, Constant &#42;&gt;&gt;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527" lineLink="#a50cfddd4c98e75ef287c16996698dc1c"><span class="doxyHighlight"><a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI) &#123;</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L || L-&gt;getHeader() != PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() || !L-&gt;getLoopLatch())</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IVInc =</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopLatch()));</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IVInc || LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(IVInc-&gt;getParent()) != L)</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Step = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a>(IVInc, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, Step) &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == PN)</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::make&#95;pair(IVInc, Step);</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542" lineLink="#ab0f1e7b38e65d10c01900bd4d458a03b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI) &#123;</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Step = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a9f54e95337782bd4fb335dd547c05ecc">matchIncrement</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, Step))</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IVInc = <a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(PN, LI))</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IVInc-&gt;first == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::replaceMathCmpWithIntrinsic(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO,</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg0, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg1,</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">                                                 <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID) &#123;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsReplacableIVIncrement = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, &amp;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>&#93;(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO) &#123;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(BO, LI))</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a> = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;L should not be null after isIVIncrement()&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not risk on moving increment into a child loop.</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent()) != L)</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Finally, we need to ensure that the insert point will dominate all</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// existing uses of the increment.</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DT = getDT(&#42;BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent());</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent(), BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we&#39;re moving up the dom tree, all uses are trivially dominated.</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (This is the common case for code produced by LSR.)</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, special case the single use in the phi recurrence.</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BO-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent(), <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch());</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent() &amp;&amp; !IsReplacableIVIncrement(BO)) &#123;</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We used to use a dominator tree here to allow multi-block optimization.</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// But that was problematic because:</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 1 It could cause a perf regression by hoisting the math op into the</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    critical path.</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 2 It could cause a perf regression by creating a value that was live</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    across multiple blocks and increasing register pressure.</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 3 Use of a dominator tree could cause large compile-time regression.</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    This is because we recompute the DT on every change in the main CGP</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    run-loop. The recomputing is probably unnecessary in many cases, so if</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    that was fixed, using a DT here would be ok.</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There is one important particular case we still want to handle: if BO is</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the IV increment. Important properties that make it profitable:</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// - We can speculate IV increment anywhere in the loop (as long as the</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   indvar Phi is its only user);</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// - Upon computing Cmp, we effectively compute something equivalent to the</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   IV increment (despite it loops differently in the IR). So moving it up</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   to the cmp point does not really increase register pressure.</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We allow matching the canonical IR (add X, C) back to (usubo X, -C).</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::Add &amp;&amp;</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">      IID == Intrinsic::usub&#95;with&#95;overflow) &#123;</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Arg1) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected input for usubo&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">    Arg1 = <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(Arg1));</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert at the first instruction of the pair.</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Iter : &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent()) &#123;</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If BO is an XOR, it is not guaranteed that it comes after both inputs to</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the overflow intrinsic are defined.</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::Xor &amp;&amp; &amp;Iter == BO) || &amp;Iter == Cmp) &#123;</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">      InsertPt = &amp;<a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a>;</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Parent block did not contain cmp or binop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertPt);</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MathOV = Builder.CreateBinaryIntrinsic(IID, Arg0, Arg1);</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::Xor) &#123;</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Math = Builder.CreateExtractValue(MathOV, 0, </span><span class="doxyHighlightStringLiteral">&quot;math&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(BO, Math, FreshBBs, IsHugeFunc);</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BO-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Patterns with XOr should use the BO only in the compare&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;OV = Builder.CreateExtractValue(MathOV, 1, </span><span class="doxyHighlightStringLiteral">&quot;ov&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, OV, FreshBBs, IsHugeFunc);</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">  BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlightComment">/// Match special-case patterns that check for unsigned add overflow.</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638" lineLink="#af23979229be4fb2286896bf920e3e235"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>) &#123;</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add = add A, 1; Cmp = icmp eq A,-1 (overflow if A is max val)</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add = add A,-1; Cmp = icmp ne A, 0 (overflow if A is non-zero)</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = Cmp-&gt;getOperand(0), &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Cmp-&gt;getOperand(1);</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are not expecting non-canonical/degenerate code. Just bail out.</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a00ef056813d120034e387417e9cde341">m&#95;AllOnes</a>()))</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = ConstantInt::get(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType(), 1);</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>()))</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType());</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check the users of the variable operand of the compare looking for an add</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with the adjusted constant.</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U);</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlightComment">/// Try to combine the compare into a call to the llvm.uadd.with.overflow</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlightComment">/// intrinsic. Return true if any changes were made.</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::combineToUAddWithOverflow(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">                                               ModifyDT &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EdgeCase = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp, <a href="/docs/api/namespaces/llvm/patternmatch/#ac8279fa9b06f9d5a57ccc0b71252c260">m&#95;UAddWithOverflow</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>)))) &#123;</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a>(Cmp, <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>))</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set A and B in case we match matchUAddWithOverflowConstantEdgeCases.</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getOperand(1);</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">    EdgeCase = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a1b6f74fbe8b15567434fa5d20a540c5c">shouldFormOverflowOp</a>(<a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a1ddf36330110b4abea43fe390bea9ef9">ISD::UADDO</a>,</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">                                 TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getType()),</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;hasNUsesOrMore(EdgeCase ? 1 : 2)))</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t want to move around uses of condition values this late, so we</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// check if it is legal to create the call to the intrinsic in the basic</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block containing the icmp.</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;getParent() != <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!replaceMathCmpWithIntrinsic(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, Cmp,</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">                                   Intrinsic::uadd&#95;with&#95;overflow))</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reset callers - do not crash by iterating over a dead instruction.</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyDT::ModifyInstDT</a>;</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::combineToUSubWithOverflow(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">                                               ModifyDT &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are not expecting non-canonical/degenerate code. Just bail out.</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0), &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(1);</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert (A u&gt; B) to (A u&lt; B) to simplify pattern matching.</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate();</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>) &#123;</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert special-case: (A == 0) is the same as (A u&lt; 1).</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>())) &#123;</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = ConstantInt::get(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType(), 1);</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert special-case: (A != 0) is the same as (0 u&lt; A).</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>())) &#123;</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>)</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the users of a variable operand of a compare looking for a subtract or</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// add with that same operand. Also match the 2nd operand of the compare to</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the add/sub, but that may be a negated constant operand of an add.</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpVariableOperand = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) ? <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Sub = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CmpVariableOperand-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A - B, A u&lt; B --&gt; usubo(A, B)</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">      Sub = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U);</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A + (-C), A u&lt; C (canonicalized form of (sub A, C))</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;CmpC, &#42;AddC;</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(AddC))) &amp;&amp;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(CmpC)) &amp;&amp; &#42;AddC == -(&#42;CmpC)) &#123;</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">      Sub = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U);</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Sub)</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a1b6f74fbe8b15567434fa5d20a540c5c">shouldFormOverflowOp</a>(<a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a4ffc75d65231b55461c0ba4f36a3e500">ISD::USUBO</a>,</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">                                 TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Sub-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()),</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">                                 Sub-&gt;<a href="/docs/api/classes/llvm/value/#a72fb137716cff838d389e392b9729dc9">hasNUsesOrMore</a>(1)))</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!replaceMathCmpWithIntrinsic(Sub, Sub-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Sub-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1),</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">                                   Cmp, Intrinsic::usub&#95;with&#95;overflow))</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reset callers - do not crash by iterating over a dead instruction.</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">  ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyDT::ModifyInstDT</a>;</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlightComment">/// Sink the given CmpInst into user blocks to reduce the number of virtual</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlightComment">/// registers that must be created and coalesced. This is a clear win except on</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlightComment">/// targets with multiple condition code registers (PowerPC), where it might</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlightComment">/// lose; some adjustment may be wanted there.</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlightComment">/// Return true if any changes are made.</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772" lineLink="#a24a3e4aad4cb2fdde7ce294a531cd52a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa00abc9ed22bfa32ebd68531b619b005">hasMultipleConditionRegisters</a>())</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid sinking soft-FP comparisons, since this can move them into a loop.</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aca632fc83dfd8f23f3456ef50a49e31a">useSoftFloat</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FCmpInst&gt;</a>(Cmp))</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only insert a cmp in each block once.</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, CmpInst &#42;&gt;</a> InsertedCmps;</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = Cmp-&gt;user&#95;begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Cmp-&gt;user&#95;end();</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Preincrement use iterator so we don&#39;t invalidate it.</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">    ++UI;</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t bother for PHI nodes.</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Figure out which BB this cmp is used in.</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefBB = Cmp-&gt;getParent();</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this user is in the same block as the cmp, don&#39;t change the cmp.</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB == DefBB)</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have already inserted a cmp into this block, use it.</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;&amp;InsertedCmp = InsertedCmps&#91;UserBB&#93;;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertedCmp) &#123;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">      InsertedCmp = <a href="/docs/api/classes/llvm/cmpinst/#a62e2cf3675b93f0e6c07a4a00852f7cd">CmpInst::Create</a>(Cmp-&gt;getOpcode(), Cmp-&gt;getPredicate(),</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">                                    Cmp-&gt;getOperand(0), Cmp-&gt;getOperand(1), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">      InsertedCmp-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Propagate the debug info.</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">      InsertedCmp-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Cmp-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace a use of the cmp with a use of the new cmp.</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">    TheUse = InsertedCmp;</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">    ++NumCmpUses;</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we removed all uses, nuke the cmp.</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp-&gt;use&#95;empty()) &#123;</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">    Cmp-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlightComment">/// For pattern like:</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlightComment">///   DomCond = icmp sgt/slt CmpOp0, CmpOp1 (might not be in DomBB)</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlightComment">/// DomBB:</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlightComment">///   br DomCond, TrueBB, CmpBB</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlightComment">/// CmpBB: (with DomBB being the single predecessor)</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlightComment">///   Cmp = icmp eq CmpOp0, CmpOp1</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlightComment">/// It would use two comparison on targets that lowering of icmp sgt/slt is</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlightComment">/// different from lowering of icmp eq (PowerPC). This function try to convert</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlightComment">/// &#39;Cmp = icmp eq CmpOp0, CmpOp1&#39; to &#39; Cmp = icmp slt/sgt CmpOp0, CmpOp1&#39;.</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlightComment">/// After that, DomCond and Cmp can use the same comparison so reduce one</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlightComment">/// comparison.</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlightComment">/// Return true if any changes are made.</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851" lineLink="#a98c59bcf49cb7343886e8f425d6d877b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp,</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aa667cc0d6f6fc39b8d40b9b9828b81bb">EnableICMP&#95;EQToICMP&#95;ST</a> &amp;&amp; TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a18c621c39394892e502cf03313e04bf7">isEqualityCmpFoldedWithSignedCmp</a>())</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If icmp eq has users other than BranchInst and SelectInst, converting it to</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// icmp slt/sgt would introduce more redundant LLVM IR.</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Cmp-&gt;users()) &#123;</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(U))</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(U) &amp;&amp; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(U)-&gt;getCondition() == Cmp)</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is a cheap/incomplete check for dominance - just match a single</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor with a conditional branch.</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CmpBB = Cmp-&gt;getParent();</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DomBB = CmpBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DomBB)</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to ensure that the only way control gets to the comparison of</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// interest is that a less/greater than comparison on the same operands is</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// false.</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;DomCond;</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB, &#42;FalseBB;</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(DomBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a811d001fa503a556ac2a48d64366500f">m&#95;Br</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(DomCond), TrueBB, FalseBB)))</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CmpBB != FalseBB)</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpOp0 = Cmp-&gt;getOperand(0), &#42;CmpOp1 = Cmp-&gt;getOperand(1);</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> DomPred;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(DomCond, <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(DomPred, <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(CmpOp0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(CmpOp1))))</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DomPred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">ICmpInst::ICMP&#95;SGT</a> &amp;&amp; DomPred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP&#95;SLT</a>)</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert the equality comparison to the opposite of the dominating</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// comparison and swap the direction for all branch/select users.</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have conceptually converted:</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Res = (a &lt; b) ? &lt;LT&#95;RES&gt; : (a == b) ? &lt;EQ&#95;RES&gt; : &lt;GT&#95;RES&gt;;</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Res = (a &lt; b) ? &lt;LT&#95;RES&gt; : (a &gt; b)  ? &lt;GT&#95;RES&gt; : &lt;EQ&#95;RES&gt;;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And similarly for branches.</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Cmp-&gt;users()) &#123;</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must be conditional&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Swap operands</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;swapValues();</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;swapProfMetadata();</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Must be a branch or a select&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">  Cmp-&gt;setPredicate(<a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(DomPred));</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlightComment">/// Many architectures use the same instruction for both subtract and cmp. Try</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlightComment">/// to swap cmp operands to match subtract operations to allow for CSE.</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921" lineLink="#a3fb33a8a29e076405285e5282eba81fd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3fb33a8a29e076405285e5282eba81fd">swapICmpOperandsToExposeCSEOpportunities</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp) &#123;</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Cmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op1 = Cmp-&gt;getOperand(1);</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Op0) ||</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Op1) || Op0 == Op1)</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If a subtract already has the same operands as a compare, swapping would be</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bad. If a subtract has the same operands as a compare but in reverse order,</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then swapping is good.</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> GoodToSwap = 0;</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumInspected = 0;</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : Op0-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Avoid walking many users.</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (++NumInspected &gt; 128)</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op1), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op0))))</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">      GoodToSwap++;</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op1))))</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">      GoodToSwap--;</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GoodToSwap &gt; 0) &#123;</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    Cmp-&gt;swapOperands();</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950" lineLink="#a1f580ab00002a65787ab52ef2aa9a439"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a1f580ab00002a65787ab52ef2aa9a439">foldFCmpToFPClassTest</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/fcmpinst">FCmpInst</a> &#42;FCmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FCmpInst&gt;</a>(Cmp);</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FCmp)</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t fold if the target offers free fabs and the predicate is legal.</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/evt">EVT</a> VT = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Cmp-&gt;getOperand(0)-&gt;getType());</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#af4dac2cd51ca7d7082cabfba3f81dd27">isFAbsFree</a>(VT) &amp;&amp;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">      TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a7ddfa7ca92088dcd1b6c8936bca6917a">isCondCodeLegal</a>(<a href="/docs/api/namespaces/llvm/#a8b3a8b47a5344da71953bc4eb38c5179">getFCmpCondCode</a>(FCmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>()),</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">                          VT.<a href="/docs/api/structs/llvm/evt/#a6a81c1cc06a00a0096d839032b5984e9">getSimpleVT</a>()))</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reverse the canonicalization if it is a FP class test</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ShouldReverseTransform = &#91;&#93;(<a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1d">FPClassTest</a> ClassTest) &#123;</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ClassTest == <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1da00a4419741933f5cb7ec001aaa6e6bb5">fcInf</a> || ClassTest == (<a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1da00a4419741933f5cb7ec001aaa6e6bb5">fcInf</a> | <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1dafe1646e5477c571f7791c524b54b11fe">fcNan</a>);</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;ClassVal, ClassTest&#93; =</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac9ef7edd1261f6570677d850b5cf2cfc">fcmpToClassTest</a>(FCmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), &#42;FCmp-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent(),</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">                      FCmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), FCmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ClassVal)</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ShouldReverseTransform(ClassTest) &amp;&amp; !ShouldReverseTransform(~ClassTest))</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Cmp);</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IsFPClass = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7fb2c76ce3457d7b38dcdfbe1d5fd051">createIsFPClass</a>(ClassVal, ClassTest);</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">  Cmp-&gt;replaceAllUsesWith(IsFPClass);</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Cmp);</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983" lineLink="#aaf468add8b9e6811a1643026e25eadb4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aaf468add8b9e6811a1643026e25eadb4">isRemOfLoopIncrementWithLoopInvariant</a>(</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Rem, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;RemAmtOut, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;AddInstOut,</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;AddOffsetOut, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp;LoopIncrPNOut) &#123;</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Incr, &#42;RemAmt;</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NB: If RemAmt is a power of 2 it &#42;should&#42; have been transformed by now.</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Rem, <a href="/docs/api/namespaces/llvm/patternmatch/#a11e5bad6c60d5c3cc5e7881bddd0204d">m&#95;URem</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Incr), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(RemAmt))))</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;AddInst, &#42;AddOffset;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find out loop increment PHI.</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Incr);</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">    AddInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">    AddOffset = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Search through a NUW add on top of the loop increment.</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V0, &#42;V1;</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Incr, <a href="/docs/api/namespaces/llvm/patternmatch/#a0c7ef38b3e115873246f1d5e491d80c3">m&#95;NUWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1))))</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">    AddInst = Incr;</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">    PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V0);</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">      AddOffset = V1;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">      PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V1);</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">      AddOffset = V0;</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN)</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This isn&#39;t strictly necessary, what we really need is one increment and any</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// amount of initial values all being the same.</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;getNumIncomingValues() != 2)</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only trivially analyzable loops.</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(PN-&gt;getParent());</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L || !L-&gt;getLoopPreheader() || !L-&gt;getLoopLatch())</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Req that the remainder is in the loop</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;contains(Rem))</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only works if the remainder amount is a loop invaraint</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;isLoopInvariant(RemAmt))</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Is the PHI a loop increment?</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LoopIncrInfo = <a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(PN, LI);</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoopIncrInfo)</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need remainder&#95;amount % increment&#95;amount to be zero. Increment of one</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// satisfies that without any special logic and is overwhelmingly the common</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case.</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LoopIncrInfo-&gt;second, <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>()))</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Need the increment to not overflow.</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LoopIncrInfo-&gt;first, <a href="/docs/api/namespaces/llvm/patternmatch/#a33e25e1952cc74de88c6af4d687f404a">m&#95;c&#95;NUWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(PN), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set output variables.</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  RemAmtOut = RemAmt;</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  LoopIncrPNOut = PN;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">  AddInstOut = AddInst;</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">  AddOffsetOut = AddOffset;</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlightComment">// Try to transform:</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlightComment">// for(i = Start; i &lt; End; ++i)</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlightComment">//    Rem = (i nuw+ IncrLoopInvariant) u% RemAmtLoopInvariant;</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlightComment">// -&gt;</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlightComment">// Rem = (Start nuw+ IncrLoopInvariant) % RemAmtLoopInvariant;</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlightComment">// for(i = Start; i &lt; End; ++i, ++rem)</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlightComment">//    Rem = rem == RemAmtLoopInvariant ? 0 : Rem;</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068" lineLink="#af950841a4443ffb7aff66ae75fee8442"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af950841a4443ffb7aff66ae75fee8442">foldURemOfLoopIncrement</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Rem, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsHuge) &#123;</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;AddOffset, &#42;RemAmt, &#42;AddInst;</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;LoopIncrPN;</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aaf468add8b9e6811a1643026e25eadb4">isRemOfLoopIncrementWithLoopInvariant</a>(Rem, LI, RemAmt, AddInst,</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">                                             AddOffset, LoopIncrPN))</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only non-constant remainder as the extra IV is probably not profitable</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in that case.</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Potential TODO(1): &#96;urem&#96; of a const ends up as &#96;mul&#96; + &#96;shift&#96; + &#96;add&#96;. If</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can rule out register pressure and ensure this &#96;urem&#96; is executed each</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iteration, its probably profitable to handle the const case as well.</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Potential TODO(2): Should we have a check for how &quot;nested&quot; this remainder</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operation is? The new code runs every iteration so if the remainder is</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// guarded behind unlikely conditions this might not be worth it.</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RemAmt, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>()))</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Start = LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopPreheader());</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have add create initial value for remainder.</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The logic here is:</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (urem (add nuw Start, IncrLoopInvariant), RemAmtLoopInvariant</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only proceed if the expression simplifies (otherwise we can&#39;t fully</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimize out the urem).</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddInst) &#123;</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AddOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We found an add but missing values&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Without dom-condition/assumption cache we aren&#39;t likely to get much out</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of a context instruction.</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">    Start = <a href="/docs/api/namespaces/llvm/#a5e0af1b16cab9e0efc63a6ce9de2b9cc">simplifyAddInst</a>(Start, AddOffset,</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">                            <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(AddInst, <a href="/docs/api/namespaces/llvm/patternmatch/#ab65bddcf2ef369ad6d5678882800a7da">m&#95;NSWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())),</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42;IsNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Start)</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we can&#39;t fully optimize out the &#96;rem&#96;, skip this transform.</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">  Start = <a href="/docs/api/namespaces/llvm/#aecb805c568634be3390c7da36836d63e">simplifyURemInst</a>(Start, RemAmt, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Start)</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create new remainder with induction variable.</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = Rem-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Rem-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LoopIncrPN);</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewRem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Ty, 2);</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">      LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopLatch())));</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;(add (urem x, y), 1)&#96; is always nuw.</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RemAdd = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a706649daecd068a72d8e06df2fd83549">CreateNUWAdd</a>(NewRem, ConstantInt::get(Ty, 1));</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RemCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, RemAdd, RemAmt);</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RemSel =</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(RemCmp, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty), RemAdd);</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">  NewRem-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Start, L-&gt;getLoopPreheader());</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">  NewRem-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(RemSel, L-&gt;getLoopLatch());</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert all touched BBs.</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">  FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(LoopIncrPN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">  FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(L-&gt;getLoopLatch());</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">  FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Rem-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddInst)</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">    FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AddInst)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>());</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Rem, NewRem, FreshBBs, IsHuge);</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">  Rem-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddInst &amp;&amp; AddInst-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AddInst)-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeURem(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Rem) &#123;</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#af950841a4443ffb7aff66ae75fee8442">foldURemOfLoopIncrement</a>(Rem, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, LI, FreshBBs, IsHugeFunc))</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlightComment">/// Some targets have better codegen for &#96;ctpop(X) u&lt; 2&#96; than &#96;ctpop(X) == 1&#96;.</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlightComment">/// This function converts &#96;ctpop(X) ==/!= 1&#96; into &#96;ctpop(X) u&lt;/u&gt; 2/1&#96; if the</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlightComment">/// result cannot be zero.</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155" lineLink="#a6536b980547806c6fb158add5334c3ab"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a6536b980547806c6fb158add5334c3ab">adjustIsPower2Test</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp, <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::ctpop&gt;</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>())))</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">ICmpInst::isEquality</a>(Pred))</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(Cmp-&gt;getOperand(0));</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>) &#123;</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">      Cmp-&gt;setOperand(1, ConstantInt::get(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getType(), 2));</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">      Cmp-&gt;setPredicate(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>);</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">      Cmp-&gt;setPredicate(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>);</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeCmp(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp, ModifyDT &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a>(Cmp, &#42;TLI))</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (combineToUAddWithOverflow(Cmp, ModifiedDT))</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (combineToUSubWithOverflow(Cmp, ModifiedDT))</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a>(Cmp, &#42;TLI))</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a3fb33a8a29e076405285e5282eba81fd">swapICmpOperandsToExposeCSEOpportunities</a>(Cmp))</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a1f580ab00002a65787ab52ef2aa9a439">foldFCmpToFPClassTest</a>(Cmp, &#42;TLI, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a6536b980547806c6fb158add5334c3ab">adjustIsPower2Test</a>(Cmp, &#42;TLI, &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlightComment">/// Duplicate and sink the given &#39;and&#39; instruction into user blocks where it is</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlightComment">/// used in a compare to allow isel to generate better code for targets where</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlightComment">/// this operation can be combined.</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlightComment">/// Return true if any changes are made.</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207" lineLink="#a0049977ff1075a98e9f512bbf4d181a6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;AndI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">                                  SetOfInstrs &amp;InsertedInsts) &#123;</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Double-check that we&#39;re not trying to optimize an instruction that was</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// already optimized by some other part of this pass.</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!InsertedInsts.count(AndI) &amp;&amp;</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Attempting to optimize already optimized and instruction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">  (void)InsertedInsts;</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Nothing to do for single use in same basic block.</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AndI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">      AndI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;AndI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>())-&gt;getParent())</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to avoid cases where sinking/duplicating is likely to increase register</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pressure.</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)) &amp;&amp;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)) &amp;&amp;</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">      AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : AndI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only sink &#39;and&#39; feeding icmp with 0</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ICmpInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CmpC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CmpC || !CmpC-&gt;<a href="/docs/api/classes/llvm/apint/#a49cd5939942c6665aba4cae8c220dff1">isZero</a>())</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a1f8d2859994eb10cdca39be26aa929bc">isMaskAndCmp0FoldingBeneficial</a>(&#42;AndI))</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;found &#39;and&#39; feeding only icmp 0;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(AndI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;dump());</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Push the &#39;and&#39; into the same block as the icmp 0  There should only be</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one (icmp (and, 0)) in each block, since CSE/GVN should have removed any</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// others, so we don&#39;t need to keep track of which BBs we insert into.</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = AndI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = AndI-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>();</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Preincrement use iterator so we don&#39;t invalidate it.</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">    ++UI;</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;sinking &#39;and&#39; use: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/classes/llvm/user">User</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep the &#39;and&#39; in the same place if the use is already in the same block.</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt =</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent() == AndI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() ? AndI : <a href="/docs/api/classes/llvm/user">User</a>;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertedAnd = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">        Instruction::And, AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), AndI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">        InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Propagate the debug info.</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    InsertedAnd-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(AndI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace a use of the &#39;and&#39; with a use of the new &#39;and&#39;.</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">    TheUse = InsertedAnd;</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">    ++NumAndUses;</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent()-&gt;<a href="/docs/api/classes/llvm/value/#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>());</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We removed all uses, nuke the and.</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">  AndI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlightComment">/// Check if the candidates could be combined with a shift instruction, which</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlightComment">/// includes:</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlightComment">/// 1 Truncate instruction</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlightComment">/// 2 And instruction and the imm is a mask of the low bits:</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlightComment">/// imm &amp; (imm+1) == 0</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283" lineLink="#a19e2fd6fce422c4ab3cea555782abbb6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>) &#123;</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;getOpcode() != Instruction::And ||</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;Cimm = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))-&gt;getValue();</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Cimm &amp; (Cimm + 1)).getBoolValue())</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlightComment">/// Sink both shift and truncate instruction to the use of truncate&#39;s BB.</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299" lineLink="#a0327169186859791aafa580e4fb547e2"><span class="doxyHighlight"><a href="#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;ShiftI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI,</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BinaryOperator &#42;&gt;</a> &amp;InsertedShifts,</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, CastInst &#42;&gt;</a> InsertedTruncs;</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TruncI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;TruncInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> TruncUI = TruncI-&gt;user&#95;begin(),</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">                            TruncE = TruncI-&gt;user&#95;end();</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">       TruncUI != TruncE;) &#123;</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TruncTheUse = TruncUI.getUse();</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TruncUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;TruncUI);</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Preincrement use iterator so we don&#39;t invalidate it.</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">    ++TruncUI;</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ISDOpcode = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a025e6664b2f55d2c217543c34eb1f64e">InstructionOpcodeToISD</a>(TruncUser-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ISDOpcode)</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the use is actually a legal node, there will not be an</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// implicit truncate.</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: always querying the result type is just an</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// approximation; some nodes&#39; legality is determined by the</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// operand or other means. There&#39;s no good way to find out though.</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">            ISDOpcode, TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TruncUser-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)))</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t bother for PHI nodes.</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(TruncUser))</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TruncUserBB = TruncUser-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB == TruncUserBB)</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp;InsertedShift = InsertedShifts&#91;TruncUserBB&#93;;</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;&amp;InsertedTrunc = InsertedTruncs&#91;TruncUserBB&#93;;</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertedShift &amp;&amp; !InsertedTrunc) &#123;</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Sink the shift</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShiftI-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr)</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">        InsertedShift =</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">            BinaryOperator::CreateAShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">        InsertedShift =</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">            BinaryOperator::CreateLShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(ShiftI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><span class="doxyHighlight">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;TruncUserBB, InsertPt);</span></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Sink the trunc</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> TruncInsertPt = TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">      TruncInsertPt++;</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// It will go ahead of any debug-info.</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">      TruncInsertPt.setHeadBit(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TruncInsertPt != TruncUserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">      InsertedTrunc = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(TruncI-&gt;getOpcode(), InsertedShift,</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">                                       TruncI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">      InsertedTrunc-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;TruncUserBB, TruncInsertPt);</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">      InsertedTrunc-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(TruncI-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">      TruncTheUse = InsertedTrunc;</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlightComment">/// Sink the shift &#42;right&#42; instruction into user blocks if the uses could</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlightComment">/// potentially be combined with this shift instruction and generate BitExtract</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlightComment">/// instruction. It will only be applied if the architecture supports BitExtract</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><span class="doxyHighlightComment">/// instruction. Here is an example:</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlightComment">/// BB1:</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlightComment">///   %x.extract.shift = lshr i64 %arg1, 32</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlightComment">/// BB2:</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlightComment">///   %x.extract.trunc = trunc i64 %x.extract.shift to i16</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlightComment">/// ==&gt;</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlightComment">/// BB2:</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlightComment">///   %x.extract.shift.1 = lshr i64 %arg1, 32</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlightComment">///   %x.extract.trunc = trunc i64 %x.extract.shift.1 to i16</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><span class="doxyHighlightComment">/// CodeGen will recognize the pattern in BB2 and generate BitExtract</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlightComment">/// instruction.</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlightComment">/// Return true if any changes are made.</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392" lineLink="#a2c05548feac70b16d31caf0cfb225714"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;ShiftI, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI,</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefBB = ShiftI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlightComment">  /// Only insert instructions in each block once.</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BinaryOperator &#42;&gt;</a> InsertedShifts;</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> shiftIsLegal = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>();</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">       UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;TheUse = UI.getUse();</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Preincrement use iterator so we don&#39;t invalidate it.</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">    ++UI;</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t bother for PHI nodes.</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB == DefBB) &#123;</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the shift and truncate instruction are in the same BB. The use of</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the truncate(TruncUse) may still introduce another truncate if not</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// legal. In this case, we would like to sink both shift and truncate</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instruction to the BB of TruncUse.</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for example:</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BB1:</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// i64 shift.result = lshr i64 opnd, imm</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc.result = trunc shift.result to i16</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BB2:</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   ----&gt; We will have an implicit truncate here if the architecture does</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   not have i16 compare.</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// cmp i16 trunc.result, opnd2</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>) &amp;&amp;</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">          shiftIsLegal</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the type of the truncate is legal, no truncate will be</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// introduced in other basic blocks.</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">          &amp;&amp; (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))))</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">        MadeChange =</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">            <a href="#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a>(ShiftI, <a href="/docs/api/classes/llvm/user">User</a>, CI, InsertedShifts, TLI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have already inserted a shift into this block, use it.</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;&amp;InsertedShift = InsertedShifts&#91;UserBB&#93;;</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertedShift) &#123;</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShiftI-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr)</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">        InsertedShift =</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">            BinaryOperator::CreateAShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">        InsertedShift =</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">            BinaryOperator::CreateLShr(ShiftI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">      InsertedShift-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(ShiftI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace a use of the shift with a use of the new shift.</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">    TheUse = InsertedShift;</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we removed all uses, or there are none, nuke the shift.</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShiftI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(&#42;ShiftI);</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">    ShiftI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlightComment">/// If counting leading or trailing zeros is an expensive operation and a zero</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlightComment">/// input is defined, add a check for zero to avoid calling the intrinsic.</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlightComment">/// We want to transform:</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlightComment">///     %z = call i64 @llvm.cttz.i64(i64 %A, i1 false)</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlightComment">/// into:</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlightComment">///   entry:</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlightComment">///     %cmpz = icmp eq i64 %A, 0</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlightComment">///     br i1 %cmpz, label %cond.end, label %cond.false</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlightComment">///   cond.false:</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlightComment">///     %z = call i64 @llvm.cttz.i64(i64 %A, i1 true)</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlightComment">///     br label %cond.end</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlightComment">///   cond.end:</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlightComment">///     %ctz = phi i64 &#91; 64, %entry &#93;, &#91; %z, %cond.false &#93;</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlightComment">/// If the transform is performed, return true and set ModifiedDT to true.</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494" lineLink="#adfad68845808cb6acd116e50b15bc281"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#adfad68845808cb6acd116e50b15bc281">despeculateCountZeros</a>(<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;CountZeros,</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI,</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42;TLI,</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ModifyDT &amp;ModifiedDT,</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsHugeFunc) &#123;</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If a zero input is undefined, it doesn&#39;t make sense to despeculate that.</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CountZeros-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>()))</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it&#39;s cheap to speculate, there&#39;s nothing to do.</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = CountZeros-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IntrinsicID = CountZeros-&gt;<a href="/docs/api/classes/llvm/intrinsicinst/#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>();</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((IntrinsicID == Intrinsic::cttz &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#a42e6689af9067a1afe64eac0267deb01">isCheapToSpeculateCttz</a>(Ty)) ||</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">      (IntrinsicID == Intrinsic::ctlz &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#abe9a0c5ce415f4e7498d75deb8de0896">isCheapToSpeculateCtlz</a>(Ty)))</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only handle legal scalar cases. Anything else requires too much work.</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SizeInBits = Ty-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isVectorTy() || SizeInBits &gt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getLargestLegalIntTypeSizeInBits())</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bail if the value is never zero.</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = CountZeros-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(0);</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The intrinsic will be sunk behind a compare against zero and branch.</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;StartBlock = CountZeros-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CallBlock = StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CountZeros, </span><span class="doxyHighlightStringLiteral">&quot;cond.false&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsHugeFunc)</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight">    FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(CallBlock);</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create another block after the count zero intrinsic. A PHI will be added</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in this block to select the result of the intrinsic or the bit-width</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constant if the input to the intrinsic is zero.</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SplitPt = std::next(<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(CountZeros));</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Any debug-info after CountZeros should not be included.</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">  SplitPt.setHeadBit(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBlock = CallBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(SplitPt, </span><span class="doxyHighlightStringLiteral">&quot;cond.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsHugeFunc)</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">    FreshBBs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(EndBlock);</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the LoopInfo. The new blocks are in the same loop as the start</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI.<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(StartBlock)) &#123;</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">    L-&gt;addBasicBlockToLoop(CallBlock, LI);</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">    L-&gt;addBasicBlockToLoop(EndBlock, LI);</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set up a builder to create a compare, conditional branch, and PHI.</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CountZeros-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(CountZeros-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the unconditional branch that was created by the first split with</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a compare against zero and a conditional branch.</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Zero = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty);</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid introducing branch on poison. This also replaces the ctz operand.</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a563ec77bbc82ad22aab9621dd14c01cd">CreateFreeze</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.fr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, Zero, </span><span class="doxyHighlightStringLiteral">&quot;cmpz&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(Cmp, EndBlock, CallBlock);</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">  StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a PHI in the end block to select either the output of the intrinsic</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or the bit width of the operand.</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EndBlock, EndBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Ty, 2, </span><span class="doxyHighlightStringLiteral">&quot;ctz&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(CountZeros, PN, FreshBBs, IsHugeFunc);</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7c8f643db1fdc579f1aa5320c7a0398">getInt</a>(<a href="/docs/api/classes/llvm/apint">APInt</a>(SizeInBits, SizeInBits));</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">  PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, StartBlock);</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">  PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(CountZeros, CallBlock);</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are explicitly handling the zero case, so we can set the intrinsic&#39;s</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// undefined zero argument to &#39;true&#39;. This will also prevent reprocessing the</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsic; we only despeculate when a zero input is defined.</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">  CountZeros-&gt;<a href="/docs/api/classes/llvm/callbase/#abc10b887caad109288ffceb230493a85">setArgOperand</a>(1, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a42ce8aa34864a9d974958b9d3d36ad17">getTrue</a>());</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">  ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>;</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeCallInst(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, ModifyDT &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lower inline assembly if we can.</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we found an inline asm expession, and if the target knows how to</span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lower it to normal LLVM code, do so now.</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a018f0394a375233d538109968b76a05a">isInlineAsm</a>()) &#123;</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#aa394506e609b72337e9c664ef264db8b">ExpandInlineAsm</a>(CI)) &#123;</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Avoid invalidating the iterator.</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">      CurInstIterator = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Avoid processing instructions out of order, which could cause</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// reuse before a value is defined.</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">      SunkAddrs.<a href="/docs/api/classes/llvm/valuemap/#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Sink address computing for memory operands into the block.</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (optimizeInlineAsmInst(CI))</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Align the pointer arguments to this call if the target thinks it&#39;s a good</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// idea</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinSize;</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> PrefAlign;</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#ae4b84d0bc1e6fcb979dc8bb641b74ae9">shouldAlignPointerArgs</a>(CI, MinSize, PrefAlign)) &#123;</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Arg : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>()) &#123;</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We want to align both objects whose address is used directly and</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// objects whose address is used in casts and GEPs, though it only makes</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// sense for GEPs if the offset is a multiple of the desired alignment and</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if size - offset meets the size threshold.</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Arg-&gt;getType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexSizeInBits(</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">                       <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PointerType&gt;</a>(Arg-&gt;getType())-&gt;getAddressSpace()),</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">                   0);</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = Arg-&gt;<a href="/docs/api/classes/llvm/value/#a14f27b1cef50a1f887650a8c79dbb436">stripAndAccumulateInBoundsConstantOffsets</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">      uint64&#95;t Offset2 = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getLimitedValue();</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a25f1d7ccf87af8d87fcb950f7ed758b5">isAligned</a>(PrefAlign, Offset2))</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI;</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(Val)) &amp;&amp; AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>() &lt; PrefAlign &amp;&amp;</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSize(AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>()) &gt;= MinSize + Offset2)</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">        AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(PrefAlign);</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Global variables can only be aligned if they are defined in this</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// object (i.e. they are uniquely initialized in this object), and</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// over-aligning global variables that have an explicit section is</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// forbidden.</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV;</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((GV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(Val)) &amp;&amp; GV-&gt;<a href="/docs/api/classes/llvm/globalobject/#af3c010276b401e92a124e50fcef97fe1">canIncreaseAlignment</a>() &amp;&amp;</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">          GV-&gt;<a href="/docs/api/classes/llvm/value/#a47f5c74e1b14ba4a61db057400644acc">getPointerAlignment</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &lt; PrefAlign &amp;&amp;</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSize(GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()) &gt;= MinSize + Offset2)</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">        GV-&gt;<a href="/docs/api/classes/llvm/globalobject/#a49b398b1c83ef4d42c8f7756b443f61f">setAlignment</a>(PrefAlign);</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a memcpy (or similar) then we may be able to improve the</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// alignment.</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/memintrinsic">MemIntrinsic</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemIntrinsic&gt;</a>(CI)) &#123;</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> DestAlign = <a href="/docs/api/namespaces/llvm/#a607b7fac55adc5ea9ed40a78e48a5b00">getKnownAlignment</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDest(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> MIDestAlign = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDestAlign();</span></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MIDestAlign || DestAlign &gt; &#42;MIDestAlign)</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;setDestAlignment(DestAlign);</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/memtransferinst">MemTransferInst</a> &#42;MTI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemTransferInst&gt;</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> MTISrcAlign = MTI-&gt;getSourceAlign();</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/align">Align</a> SrcAlign = <a href="/docs/api/namespaces/llvm/#a607b7fac55adc5ea9ed40a78e48a5b00">getKnownAlignment</a>(MTI-&gt;getSource(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MTISrcAlign || SrcAlign &gt; &#42;MTISrcAlign)</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">        MTI-&gt;setSourceAlignment(SrcAlign);</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have a cold call site, try to sink addressing computation into the</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cold block.  This interacts with our handling for loads and stores to</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ensure that we can fold all uses of a potential addressing computation</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into their uses.  TODO: generalize this to work over profiling data</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2fbfe5377a984518a7c03d8558df726d">hasFnAttr</a>(Attribute::Cold) &amp;&amp;</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(BB, PSI, <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get()))</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Arg : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>()) &#123;</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Arg-&gt;getType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = Arg-&gt;getType()-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (optimizeMemoryInst(CI, Arg, Arg-&gt;getType(), AS))</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(CI);</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::assume:</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;llvm.assume should have been removed already&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::allow&#95;runtime&#95;check:</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::allow&#95;ubsan&#95;check:</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::experimental&#95;widenable&#95;condition: &#123;</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Give up on future widening opportunities so that we can fold away dead</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// paths and merge blocks before going into block-local instruction</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// selection.</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;use&#95;empty()) &#123;</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;RetVal = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getContext());</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">      resetIteratorIfInvalidatedWhileCalling(BB, &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a66a40e8dfb026aef2f90764d2e49a8f1">replaceAndRecursivelySimplify</a>(CI, RetVal, TLInfo, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::objectsize:</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;llvm.objectsize.&#42; should have been lowered already&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::is&#95;constant:</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;llvm.is.constant.&#42; should have been lowered already&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::aarch64&#95;stlxr:</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::aarch64&#95;stxr: &#123;</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/zextinst">ZExtInst</a> &#42;ExtVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ZExtInst&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0));</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExtVal || !ExtVal-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() ||</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">          ExtVal-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Sink a zext feeding stlxr/stxr before it, so it can be folded into it.</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">      ExtVal-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark this instruction as &quot;inserted by CGP&quot;, so that other</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// optimizations don&#39;t touch it.</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">      InsertedInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ExtVal);</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::launder&#95;invariant&#95;group:</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::strip&#95;invariant&#95;group: &#123;</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ArgVal = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0);</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> it = LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (it != LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a0881334358ff6ff7ff8cea5562c7988e">end</a>()) &#123;</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Merge entries in LargeOffsetGEPMap to reflect the RAUW.</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Make sure not to have to deal with iterator invalidation</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// after possibly adding ArgVal to LargeOffsetGEPMap.</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GEPs = std::move(it-&gt;second);</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">        LargeOffsetGEPMap&#91;ArgVal&#93;.append(GEPs.begin(), GEPs.end());</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">        LargeOffsetGEPMap.<a href="/docs/api/classes/llvm/mapvector/#a3a8171298a7d19a309d599de01906703">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, ArgVal, FreshBBs, IsHugeFunc);</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::cttz:</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::ctlz:</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If counting zeros is expensive, try to avoid it.</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#adfad68845808cb6acd116e50b15bc281">despeculateCountZeros</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, &#42;LI, TLI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ModifiedDT, FreshBBs,</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">                                   IsHugeFunc);</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::fshl:</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::fshr:</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeFunnelShift(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::dbg&#95;assign:</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::dbg&#95;value:</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> fixupDbgValue(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::masked&#95;gather:</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeGatherScatterInst(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0));</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::masked&#95;scatter:</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeGatherScatterInst(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(1));</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> PtrOps;</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy;</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#ab8f2a9189ca5cab7a1fe0d09bc67ba34">getAddrModeArguments</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, PtrOps, AccessTy))</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!PtrOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;PtrVal = PtrOps.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = PtrVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (optimizeMemoryInst(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, PtrVal, AccessTy, AS))</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// From here on out we&#39;re working with named functions.</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bac8ff9e15a93f800c74c05e7b37364816">Callee</a> = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Callee)</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lower all default uses of &#95;chk calls.  This is very similar</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to what InstCombineCalls does, but here we are only lowering calls</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to fortified library functions (e.g. &#95;&#95;memcpy&#95;chk) that have the default</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;don&#39;t know&quot; as the objectsize.  Anything else should be left alone.</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/fortifiedlibcallsimplifier">FortifiedLibCallSimplifier</a> Simplifier(TLInfo, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CI);</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = Simplifier.optimizeCall(CI, Builder)) &#123;</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(CI, V, FreshBBs, IsHugeFunc);</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlight">    CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SCCP may have propagated, among other things, C++ static variables across</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// calls. If this happens to be the case, we may want to undo it in order to</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// avoid redundant pointer computation of the constant, as the function method</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// returning the constant needs to be executed anyways.</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetUniformReturnValue = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; &#123;</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getReturnType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;UniformValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(RI-&gt;getReturnValue())) &#123;</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UniformValue)</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">            UniformValue = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V != UniformValue)</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UniformValue;</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bac8ff9e15a93f800c74c05e7b37364816">Callee</a>-&gt;hasExactDefinition()) &#123;</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;RV = GetUniformReturnValue(Callee)) &#123;</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(RV-&gt;uses())) &#123;</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser());</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &#123;</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Limit to the same basic block to avoid extending the call-site live</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// range, which otherwise could increase register pressure.</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a784097fca76abad9e815cf1692de79c4">comesBefore</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.set(CI);</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">          MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810" lineLink="#a87548c69480b23599d643d518412895c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLInfo,</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI) &#123;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>());</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(CI))</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::memset:</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::memcpy:</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::memmove:</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> LF;</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Callee &amp;&amp; TLInfo &amp;&amp; TLInfo-&gt;<a href="/docs/api/classes/llvm/targetlibraryinfo/#a97cfbbed8869e3582142012a071a9052">getLibFunc</a>(&#42;Callee, LF))</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (LF) &#123;</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LibFunc&#95;strcpy:</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LibFunc&#95;strncpy:</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LibFunc&#95;strcat:</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LibFunc&#95;strncat:</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlightComment">/// Look for opportunities to duplicate return instructions to the predecessor</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlightComment">/// to enable tail call optimizations. The case it is currently looking for is</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><span class="doxyHighlightComment">/// the following one. Known intrinsics or library function that may be tail</span></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlightComment">/// called are taken into account as well.</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlightComment">/// @code</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlightComment">/// bb0:</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlightComment">///   %tmp0 = tail call i32 @f0()</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlightComment">///   br label %return</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlightComment">/// bb1:</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlightComment">///   %tmp1 = tail call i32 @f1()</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlightComment">///   br label %return</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlightComment">/// bb2:</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlightComment">///   %tmp2 = tail call i32 @f2()</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlightComment">///   br label %return</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlightComment">/// return:</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlightComment">///   %retval = phi i32 &#91; %tmp0, %bb0 &#93;, &#91; %tmp1, %bb1 &#93;, &#91; %tmp2, %bb2 &#93;</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlightComment">///   ret i32 %retval</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlightComment">/// @endcode</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlightComment">/// =&gt;</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlightComment">/// @code</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlightComment">/// bb0:</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlightComment">///   %tmp0 = tail call i32 @f0()</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlightComment">///   ret i32 %tmp0</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlightComment">/// bb1:</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlightComment">///   %tmp1 = tail call i32 @f1()</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlightComment">///   ret i32 %tmp1</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlightComment">/// bb2:</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlightComment">///   %tmp2 = tail call i32 @f2()</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlightComment">///   ret i32 %tmp2</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><span class="doxyHighlightComment">/// @endcode</span></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::dupRetToEnableTailCallOpts(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">                                                ModifyDT &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RetI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RetI)</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(BB) == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;A return block cannot be in a loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/extractvalueinst">ExtractValueInst</a> &#42;EVI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BCI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = RetI-&gt;<a href="/docs/api/classes/llvm/returninst/#a6c2dee0852138a5cb8a4fef5883db9ec">getReturnValue</a>();</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V) &#123;</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlight">    BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V);</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BCI)</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = BCI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlight">    EVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractValueInst&gt;</a>(V);</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EVI) &#123;</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = EVI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(EVI-&gt;<a href="/docs/api/classes/llvm/extractvalueinst/#a767130a28a6a9148ab3f2cf451fc9375">indices</a>(), &#91;&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> idx) &#123; return idx == 0; &#125;))</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlight">    PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V);</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN &amp;&amp; PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB)</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> isLifetimeEndOrBitCastFor = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BC &amp;&amp; BC-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><span class="doxyHighlight">      Inst = BC-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>();</span></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(Inst))</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::lifetime&#95;end;</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const IntrinsicInst &#42;, 4&gt;</a> FakeUses;</span></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> isFakeUse = &#91;&amp;FakeUses&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::fake&#95;use) &#123;</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record the instruction so it can be preserved when the exit block is</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// removed. Do not preserve the fake use that uses the result of the</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// PHI instruction.</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Do not copy fake uses that use the result of a PHI node.</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: If we do want to copy the fake use into the return blocks, we</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// have to figure out which of the PHI node operands to use for each</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// copy.</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getOperand(0))) &#123;</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">        FakeUses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure there are no instructions between the first instruction</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and return.</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a42a7d51fdde6913db72d098356c2c019">BasicBlock::const&#95;iterator</a> BI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</span></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip over debug and the bitcast.</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BI) || &amp;&#42;BI == BCI || &amp;&#42;BI == EVI ||</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PseudoProbeInst&gt;</a>(BI) || isLifetimeEndOrBitCastFor(&amp;&#42;BI) ||</span></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlight">         isFakeUse(&amp;&#42;BI))</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">    BI = std::next(BI);</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;BI != RetI)</span></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlightComment">  /// Only dup the ReturnInst if the CallInst is likely to be emitted as a tail</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlightComment">  /// call.</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 4&gt;</a> TailCallBBs;</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record the call instructions so we can insert any fake uses</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that need to be preserved before them.</span></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;CallInst &#42;, 4&gt;</a> CallInsts;</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN) &#123;</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Look through bitcasts.</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(IncomingVal);</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure the phi value is indeed produced by the tail call.</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == PredBB &amp;&amp;</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">          TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, &#42;TLI)) &#123;</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">        TailCallBBs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredBB);</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">        CallInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Consider the cases in which the phi value is indirectly produced by</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the tail call, for example when encountering memset(), memmove(),</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// strcpy(), whose return value may have been optimized out. In such</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// cases, the value needs to be the first function argument.</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// bb0:</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//   tail call void @llvm.memset.p0.i64(ptr %0, i8 0, i64 %1)</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//   br label %return</span></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// return:</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//   %phi = phi ptr &#91; %0, %bb0 &#93;, &#91; %2, %entry &#93;</span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB &amp;&amp; PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == BB)</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlight">          CI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">              PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a512494b857b0644c1f722531e3ee5495">getPrevNonDebugInstruction</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlight">            <a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a>(TLInfo, CI) &amp;&amp;</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><span class="doxyHighlight">            IncomingVal == CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0) &amp;&amp;</span></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlight">            TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, &#42;TLI)) &#123;</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">          TailCallBBs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredBB);</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">          CallInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 4&gt;</a> VisitedBBs;</span></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VisitedBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Pred).second)</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Pred-&gt;rbegin()-&gt;<a href="/docs/api/classes/llvm/instruction/#a512494b857b0644c1f722531e3ee5495">getPrevNonDebugInstruction</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp; TLI-&gt;<a href="/docs/api/classes/llvm/targetlowering/#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, &#42;TLI)) &#123;</span></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Either we return void or the return value must be the first</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// argument of a known intrinsic or library function.</span></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!V || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(V) ||</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">              (<a href="#a87548c69480b23599d643d518412895c">isIntrinsicOrLFToBeTailCalled</a>(TLInfo, CI) &amp;&amp;</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">               V == CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0))) &#123;</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><span class="doxyHighlight">            TailCallBBs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Pred);</span></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><span class="doxyHighlight">            CallInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</span></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> &amp;TailCallBB : TailCallBBs) &#123;</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure the call instruction is followed by an unconditional branch to</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the return block.</span></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TailCallBB-&gt;getTerminator());</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() || BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BB)</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Duplicate the return into TailCallBB.</span></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><span class="doxyHighlight">    (void)<a href="/docs/api/namespaces/llvm/#a2e4b18daaf5f20f1ade3a9f66b86d843">FoldReturnIntoUncondBranch</a>(RetI, BB, TailCallBB);</span></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="#aa67824c7146db82e49933e0a1ac1d3b9">VerifyBFIUpdates</a> ||</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(BB) &gt;= <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(TailCallBB));</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;setBlockFreq(BB,</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlight">                      (<a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(BB) - <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(TailCallBB)));</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><span class="doxyHighlight">    ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>;</span></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">    ++NumRetsDup;</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we eliminated all predecessors of the block, delete the block now.</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> &amp;&amp; !BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(BB)) &#123;</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Copy the fake uses found in the original return block to all blocks</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that contain tail calls.</span></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI : CallInsts) &#123;</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> &#42;FakeUse : FakeUses) &#123;</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ClonedInst = FakeUse-&gt;clone();</span></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><span class="doxyHighlight">        ClonedInst-&gt;insertBefore(CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">    BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><span class="doxyHighlightComment">// Memory Optimization</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><span class="doxyHighlightComment">/// This is an extended version of TargetLowering::AddrMode</span></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><span class="doxyHighlightComment">/// which holds actual Value&#42;&#39;s for register values.</span></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetloweringbase/addrmode">TargetLowering::AddrMode</a> &#123;</span></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f">OriginalValue</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> &#123;</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">NoField</a> = 0x00,</span></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">BaseRegField</a> = 0x01,</span></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">BaseGVField</a> = 0x02,</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">BaseOffsField</a> = 0x04,</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ScaledRegField</a> = 0x08,</span></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101">ScaleField</a> = 0x10,</span></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a> = 255</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a>() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a50bf746ca1858c0e272e3a802fc27942">print</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a03503773241005f01b090b9862aad304">dump</a>() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace From in ExtAddrMode with To.</span></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// E.g., SExt insts may be promoted and deleted. We should replace them with</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the promoted values.</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afcc64bfd52afa9a6094a07cc91922630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afcc64bfd52afa9a6094a07cc91922630">replaceWith</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;From, <a href="/docs/api/classes/llvm/value">Value</a> &#42;To) &#123;</span></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> == From)</span></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = To;</span></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a0cd7231f32d51864a9e307330e798de9"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a0cd7231f32d51864a9e307330e798de9">compare</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a> &amp;other) &#123;</span></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First check that the types are the same on each field, as differing types</span></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is something we can&#39;t cope with later on.</span></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> &amp;&amp; other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> &amp;&amp;</span></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>-&gt;getType() != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</span></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseGV &amp;&amp; other.BaseGV &amp;&amp; BaseGV-&gt;getType() != other.BaseGV-&gt;getType())</span></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</span></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> &amp;&amp; other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> &amp;&amp;</span></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>-&gt;getType() != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</span></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Conservatively reject &#39;inbounds&#39; mismatches.</span></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a> != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a>)</span></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</span></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check each field to see if it differs.</span></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Result = <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">NoField</a>;</span></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>)</span></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><span class="doxyHighlight">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">BaseRegField</a>;</span></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseGV != other.BaseGV)</span></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><span class="doxyHighlight">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">BaseGVField</a>;</span></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseOffs != other.BaseOffs)</span></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><span class="doxyHighlight">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">BaseOffsField</a>;</span></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> != other.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>)</span></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><span class="doxyHighlight">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ScaledRegField</a>;</span></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t count 0 as being a different scale, because that actually means</span></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unscaled (which will already be counted by having no ScaledReg).</span></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> &amp;&amp; other.Scale &amp;&amp; <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> != other.Scale)</span></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><span class="doxyHighlight">      Result |= <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101">ScaleField</a>;</span></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0eea77e7bfa82e0219d2ec7b4efbc94f">llvm::popcount</a>(Result) &gt; 1)</span></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">MultipleFields</a>;</span></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a></span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(Result);</span></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// An AddrMode is trivial if it involves no calculation i.e. it is just a base</span></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with no offset.</span></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af16961a6894c56bc7f08641a2538167d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af16961a6894c56bc7f08641a2538167d">isTrivial</a>() &#123;</span></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// An AddrMode is (BaseGV + BaseReg + BaseOffs + ScaleReg &#42; Scale) so it is</span></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trivial if at most one of these terms is nonzero, except that BaseGV and</span></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BaseReg both being zero actually means a null pointer value, which we</span></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// consider to be &#39;non-zero&#39; here.</span></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !BaseOffs &amp;&amp; !<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> &amp;&amp; !(BaseGV &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>);</span></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a98c66d9b5e8ace6575527d88e08fe378"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a98c66d9b5e8ace6575527d88e08fe378">GetFieldAsValue</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntPtrTy) &#123;</span></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>) &#123;</span></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">BaseRegField</a>:</span></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>;</span></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">BaseGVField</a>:</span></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BaseGV;</span></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ScaledRegField</a>:</span></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>;</span></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">BaseOffsField</a>:</span></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstantInt::get(IntPtrTy, BaseOffs);</span></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af313a30da49e08d08e305c3e72b32619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af313a30da49e08d08e305c3e72b32619">SetCombinedField</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">FieldName</a> <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</span></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ExtAddrMode&gt;</a> &amp;AddrModes) &#123;</span></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>) &#123;</span></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unhandled fields are expected to be rejected earlier&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">ExtAddrMode::BaseRegField</a>:</span></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> = V;</span></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">ExtAddrMode::BaseGVField</a>:</span></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// A combined BaseGV is an Instruction, not a GlobalValue, so it goes</span></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in the BaseReg field.</span></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a> = V;</span></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><span class="doxyHighlight">      BaseGV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ExtAddrMode::ScaledRegField</a>:</span></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = V;</span></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we have a mix of scaled and unscaled addrmodes then we want scale</span></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to be the scale and not zero.</span></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a>)</span></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a2a3bb1311f93a6e5c6db14f9d524f3bb">ExtAddrMode</a> &amp;AM : AddrModes)</span></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AM.Scale) &#123;</span></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><span class="doxyHighlight">            <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> = AM.Scale;</span></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">ExtAddrMode::BaseOffsField</a>:</span></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The offset is no longer a constant, so it goes in ScaledReg with a</span></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// scale of 1</span></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a> = V;</span></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> = 1;</span></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><span class="doxyHighlight">      BaseOffs = 0;</span></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187" lineLink="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#ab24147fe07c79ebc39df89376d939778"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;<a href="/docs/api/namespaces/llvm/#ab89f1db02887aa569176f0e29622eb47">operator&lt;&lt;</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><span class="doxyHighlight">  AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a13013613b2600aea6438d155a7e4c21b">print</a>(OS);</span></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OS;</span></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a13013613b2600aea6438d155a7e4c21b"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a13013613b2600aea6438d155a7e4c21b">ExtAddrMode::print</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedPlus = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#91;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a9e6c6948fceb393f324cbfb318c0b64e">InBounds</a>)</span></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><span class="doxyHighlight">    OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;inbounds &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseGV) &#123;</span></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><span class="doxyHighlight">    OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;GV:&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><span class="doxyHighlight">    BaseGV-&gt;printAsOperand(OS, </span><span class="doxyHighlightComment">/&#42;PrintType=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><span class="doxyHighlight">    NeedPlus = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseOffs) &#123;</span></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><span class="doxyHighlight">    OS &lt;&lt; (NeedPlus ? </span><span class="doxyHighlightStringLiteral">&quot; + &quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">) &lt;&lt; BaseOffs;</span></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><span class="doxyHighlight">    NeedPlus = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>) &#123;</span></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><span class="doxyHighlight">    OS &lt;&lt; (NeedPlus ? </span><span class="doxyHighlightStringLiteral">&quot; + &quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Base:&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ac35a3a2b34882507f52796fb2b377838">BaseReg</a>-&gt;printAsOperand(OS, </span><span class="doxyHighlightComment">/&#42;PrintType=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><span class="doxyHighlight">    NeedPlus = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a>) &#123;</span></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><span class="doxyHighlight">    OS &lt;&lt; (NeedPlus ? </span><span class="doxyHighlightStringLiteral">&quot; + &quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">) &lt;&lt; <a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>-&gt;printAsOperand(OS, </span><span class="doxyHighlightComment">/&#42;PrintType=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;&#93;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223" lineLink="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af97ad85fa4c9caf49c807470d137a67d"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af97ad85fa4c9caf49c807470d137a67d">ExtAddrMode::dump</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a50bf746ca1858c0e272e3a802fc27942">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</span></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><span class="doxyHighlightComment">/// This class provides transaction based operation on the IR.</span></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><span class="doxyHighlightComment">/// Every change made through this class is recorded in the internal state and</span></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><span class="doxyHighlightComment">/// can be undone (rollback) until commit is called.</span></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><span class="doxyHighlightComment">/// CGP does not check if instructions could be speculatively executed when</span></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><span class="doxyHighlightComment">/// moved. Preserving the original location would pessimize the debugging</span></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><span class="doxyHighlightComment">/// experience, as well as negatively impact the quality of sample PGO.</span></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a3f64f3705ad6de53221d46f95196acb7">TypePromotionTransaction</a> &#123;</span></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><span class="doxyHighlightComment">  /// This represents the common interface of the individual transaction.</span></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><span class="doxyHighlightComment">  /// Each class implements the logic for doing one specific modification on</span></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><span class="doxyHighlightComment">  /// the IR via the TypePromotionTransaction.</span></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">TypePromotionAction &#123;</span></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">protected</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><span class="doxyHighlightComment">    /// The Instruction modified.</span></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst;</span></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><span class="doxyHighlightComment">    /// Constructor of the action.</span></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><span class="doxyHighlightComment">    /// The constructor performs the related action on the IR.</span></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><span class="doxyHighlight">    TypePromotionAction(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) : Inst(Inst) &#123;&#125;</span></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> ~TypePromotionAction() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><span class="doxyHighlightComment">    /// Undo the modification done by this action.</span></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><span class="doxyHighlightComment">    /// When this method is called, the IR must be in the same state as it was</span></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><span class="doxyHighlightComment">    /// before this action was applied.</span></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><span class="doxyHighlightComment">    /// \\pre Undoing the action works if and only if the IR is in the exact same</span></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><span class="doxyHighlightComment">    /// state as it was directly after this action was applied.</span></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo() = 0;</span></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><span class="doxyHighlightComment">    /// Advocate every change made by this action.</span></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><span class="doxyHighlightComment">    /// When the results on the IR of the action are to be kept, it is important</span></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><span class="doxyHighlightComment">    /// to call this function, otherwise hidden information may be kept forever.</span></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a990fcc2525f7ebe5d3dae3aa10434fa0">commit</a>() &#123;</span></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Nothing to be done, this action is not doing anything.</span></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><span class="doxyHighlightComment">  /// Utility to remember the position of an instruction.</span></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">InsertionHandler &#123;</span></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><span class="doxyHighlightComment">    /// Position of an instruction.</span></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><span class="doxyHighlightComment">    /// Either an instruction:</span></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><span class="doxyHighlightComment">    /// - Is the first in a basic block: BB is used.</span></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><span class="doxyHighlightComment">    /// - Has a previous instruction: PrevInst is used.</span></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> PrevInst;</span></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB;</span></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><span class="doxyHighlight">    &#125; Point;</span></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><span class="doxyHighlight">    std::optional&lt;DbgRecord::self&#95;iterator&gt; BeforeDbgRecord = std::nullopt;</span></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><span class="doxyHighlightComment">    /// Remember whether or not the instruction had a previous instruction.</span></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasPrevInstruction;</span></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><span class="doxyHighlightComment">    /// Record the position of \\p Inst.</span></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><span class="doxyHighlight">    InsertionHandler(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</span></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><span class="doxyHighlight">      HasPrevInstruction = (Inst != &amp;&#42;(Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;begin()));</span></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record where we would have to re-insert the instruction in the sequence</span></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of DbgRecords, if we ended up reinserting.</span></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab571b8358a3a8b6db1327d06bdc5e9f4">IsNewDbgInfoFormat</a>)</span></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><span class="doxyHighlight">        BeforeDbgRecord = Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ad99db073c46dd0de2c530c64baf77cb7">getDbgReinsertionPosition</a>();</span></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasPrevInstruction) &#123;</span></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><span class="doxyHighlight">        Point.PrevInst = std::prev(Inst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><span class="doxyHighlight">        Point.BB = BB;</span></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><span class="doxyHighlightComment">    /// Insert \\p Inst at the recorded position.</span></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> insert(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</span></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasPrevInstruction) &#123;</span></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><span class="doxyHighlight">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><span class="doxyHighlight">        Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(Point.PrevInst);</span></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Position = Point.BB-&gt;getFirstInsertionPt();</span></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><span class="doxyHighlight">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&#42;Point.BB, Position);</span></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><span class="doxyHighlight">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;Point.BB, Position);</span></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;reinsertInstInDbgRecords(Inst, BeforeDbgRecord);</span></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><span class="doxyHighlightComment">  /// Move an instruction before another.</span></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">InstructionMoveBefore : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><span class="doxyHighlightComment">    /// Original position of the instruction.</span></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><span class="doxyHighlight">    InsertionHandler Position;</span></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><span class="doxyHighlightComment">    /// Move \\p Inst before \\p Before.</span></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><span class="doxyHighlight">    InstructionMoveBefore(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa9060587edeb01a63e3d3edc959678d1e">Before</a>)</span></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><span class="doxyHighlight">        : TypePromotionAction(Inst), Position(Inst) &#123;</span></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: move: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nbefore: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa9060587edeb01a63e3d3edc959678d1e">Before</a></span></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa9060587edeb01a63e3d3edc959678d1e">Before</a>);</span></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><span class="doxyHighlightComment">    /// Move the instruction back to its original position.</span></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: moveBefore: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><span class="doxyHighlight">      Position.insert(Inst);</span></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><span class="doxyHighlightComment">  /// Set the operand of an instruction with a new value.</span></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">OperandSetter : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><span class="doxyHighlightComment">    /// Original operand of the instruction.</span></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Origin;</span></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><span class="doxyHighlightComment">    /// Index of the modified instruction.</span></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx;</span></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><span class="doxyHighlightComment">    /// Set \\p Idx operand of \\p Inst with \\p NewVal.</span></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><span class="doxyHighlight">    OperandSetter(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal)</span></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><span class="doxyHighlight">        : TypePromotionAction(Inst), Idx(Idx) &#123;</span></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: setOperand: &quot;</span><span class="doxyHighlight"> &lt;&lt; Idx &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;for:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;with:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewVal &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><span class="doxyHighlight">      Origin = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Idx);</span></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Idx, NewVal);</span></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><span class="doxyHighlightComment">    /// Restore the original value of the instruction.</span></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: setOperand:&quot;</span><span class="doxyHighlight"> &lt;&lt; Idx &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;for: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;with: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Origin &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Idx, Origin);</span></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><span class="doxyHighlightComment">  /// Hide the operands of an instruction.</span></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><span class="doxyHighlightComment">  /// Do as if this instruction was not using any of its operands.</span></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">OperandsHider : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><span class="doxyHighlightComment">    /// The list of original operands.</span></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> OriginalValues;</span></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><span class="doxyHighlightComment">    /// Remove \\p Inst from the uses of the operands of \\p Inst.</span></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><span class="doxyHighlight">    OperandsHider(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) : TypePromotionAction(Inst) &#123;</span></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: OperandsHider: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumOpnds = Inst-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>();</span></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><span class="doxyHighlight">      OriginalValues.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(NumOpnds);</span></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> It = 0; It &lt; NumOpnds; ++It) &#123;</span></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Save the current operand.</span></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(It);</span></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><span class="doxyHighlight">        OriginalValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Val);</span></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Set a dummy one.</span></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We could use OperandSetter here, but that would imply an overhead</span></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// that we are not willing to pay.</span></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><span class="doxyHighlight">        Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(It, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Val-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><span class="doxyHighlightComment">    /// Restore the original list of uses.</span></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: OperandsHider: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> It = 0, EndIt = OriginalValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); It != EndIt; ++It)</span></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><span class="doxyHighlight">        Inst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(It, OriginalValues&#91;It&#93;);</span></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><span class="doxyHighlightComment">  /// Build a truncate instruction.</span></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">TruncBuilder : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</span></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><span class="doxyHighlightComment">    /// Build a truncate instruction of \\p Opnd producing a \\p Ty</span></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><span class="doxyHighlightComment">    /// result.</span></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><span class="doxyHighlightComment">    /// trunc Opnd to Ty.</span></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><span class="doxyHighlight">    TruncBuilder(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) : TypePromotionAction(Opnd) &#123;</span></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Opnd);</span></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><span class="doxyHighlight">      Val = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(Opnd, Ty, </span><span class="doxyHighlightStringLiteral">&quot;promoted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: TruncBuilder: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Val &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><span class="doxyHighlightComment">    /// Get the built value.</span></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;getBuiltValue() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Val; &#125;</span></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><span class="doxyHighlightComment">    /// Remove the built instruction.</span></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: TruncBuilder: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Val &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val))</span></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><span class="doxyHighlight">        IVal-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><span class="doxyHighlightComment">  /// Build a sign extension instruction.</span></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">SExtBuilder : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</span></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><span class="doxyHighlightComment">    /// Build a sign extension instruction of \\p Opnd producing a \\p Ty</span></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><span class="doxyHighlightComment">    /// result.</span></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><span class="doxyHighlightComment">    /// sext Opnd to Ty.</span></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><span class="doxyHighlight">    SExtBuilder(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty)</span></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><span class="doxyHighlight">        : TypePromotionAction(InsertPt) &#123;</span></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertPt);</span></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><span class="doxyHighlight">      Val = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5253081f40ffcad9c0e8ba6a5c437006">CreateSExt</a>(Opnd, Ty, </span><span class="doxyHighlightStringLiteral">&quot;promoted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: SExtBuilder: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Val &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><span class="doxyHighlightComment">    /// Get the built value.</span></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;getBuiltValue() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Val; &#125;</span></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><span class="doxyHighlightComment">    /// Remove the built instruction.</span></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: SExtBuilder: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Val &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val))</span></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><span class="doxyHighlight">        IVal-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><span class="doxyHighlightComment">  /// Build a zero extension instruction.</span></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">ZExtBuilder : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</span></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><span class="doxyHighlightComment">    /// Build a zero extension instruction of \\p Opnd producing a \\p Ty</span></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><span class="doxyHighlightComment">    /// result.</span></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><span class="doxyHighlightComment">    /// zext Opnd to Ty.</span></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><span class="doxyHighlight">    ZExtBuilder(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty)</span></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><span class="doxyHighlight">        : TypePromotionAction(InsertPt) &#123;</span></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertPt);</span></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><span class="doxyHighlight">      Val = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(Opnd, Ty, </span><span class="doxyHighlightStringLiteral">&quot;promoted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: ZExtBuilder: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Val &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><span class="doxyHighlightComment">    /// Get the built value.</span></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;getBuiltValue() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Val; &#125;</span></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><span class="doxyHighlightComment">    /// Remove the built instruction.</span></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: ZExtBuilder: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Val &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val))</span></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><span class="doxyHighlight">        IVal-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><span class="doxyHighlightComment">  /// Mutate an instruction to another type.</span></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">TypeMutator : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><span class="doxyHighlightComment">    /// Record the original type.</span></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;OrigTy;</span></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><span class="doxyHighlightComment">    /// Mutate the type of \\p Inst into \\p NewTy.</span></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><span class="doxyHighlight">    TypeMutator(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy)</span></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><span class="doxyHighlight">        : TypePromotionAction(Inst), OrigTy(Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</span></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: MutateType: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewTy</span></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/value/#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(NewTy);</span></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><span class="doxyHighlightComment">    /// Mutate the instruction back to its original type.</span></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: MutateType: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OrigTy</span></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/value/#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(OrigTy);</span></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><span class="doxyHighlightComment">  /// Replace the uses of an instruction by another instruction.</span></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">UsesReplacer : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><span class="doxyHighlightComment">    /// Helper structure to keep track of the replaced uses.</span></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">InstructionAndIdx &#123;</span></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><span class="doxyHighlightComment">      /// The instruction using the instruction.</span></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst;</span></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><span class="doxyHighlightComment">      /// The index where this instruction is used for Inst.</span></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx;</span></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><span class="doxyHighlight">      InstructionAndIdx(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx)</span></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><span class="doxyHighlight">          : Inst(Inst), Idx(Idx) &#123;&#125;</span></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><span class="doxyHighlightComment">    /// Keep track of the original uses (pair Instruction, Index).</span></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;InstructionAndIdx, 4&gt;</a> OriginalUses;</span></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><span class="doxyHighlightComment">    /// Keep track of the debug users.</span></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgValueInst &#42;, 1&gt;</a> DbgValues;</span></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><span class="doxyHighlightComment">    /// And non-instruction debug-users too.</span></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 1&gt;</a> DbgVariableRecords;</span></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><span class="doxyHighlightComment">    /// Keep track of the new value so that we can undo it by replacing</span></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><span class="doxyHighlightComment">    /// instances of the new value with the original value.</span></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;New;</span></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">use&#95;iterator = <a href="/docs/api/classes/llvm/smallvectorimpl/#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;InstructionAndIdx&gt;::iterator</a>;</span></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><span class="doxyHighlightComment">    /// Replace all the use of \\p Inst by \\p New.</span></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><span class="doxyHighlight">    UsesReplacer(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;New)</span></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><span class="doxyHighlight">        : TypePromotionAction(Inst), New(New) &#123;</span></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: UsersReplacer: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;New</span></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record the original uses.</span></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : Inst-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><span class="doxyHighlight">        OriginalUses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(InstructionAndIdx(UserI, U.getOperandNo()));</span></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record the debug uses separately. They are not in the instruction&#39;s</span></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// use list, but they are replaced by RAUW.</span></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a4d7448a42ae4db532d3ba40e250ec825">findDbgValues</a>(DbgValues, Inst, &amp;DbgVariableRecords);</span></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Now, we can replace the uses.</span></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</span></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><span class="doxyHighlightComment">    /// Reassign the original uses of Inst to Inst.</span></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: UsersReplacer: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (InstructionAndIdx &amp;<a href="/docs/api/classes/llvm/use">Use</a> : OriginalUses)</span></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/use">Use</a>.Inst-&gt;setOperand(<a href="/docs/api/classes/llvm/use">Use</a>.Idx, Inst);</span></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// RAUW has replaced all original uses with references to the new value,</span></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// including the debug uses. Since we are undoing the replacements,</span></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the original debug uses must also be reinstated to maintain the</span></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// correctness and utility of debug value instructions.</span></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DVI : DbgValues)</span></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><span class="doxyHighlight">        DVI-&gt;replaceVariableLocationOp(New, Inst);</span></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Similar story with DbgVariableRecords, the non-instruction</span></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// representation of dbg.values.</span></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR : DbgVariableRecords)</span></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><span class="doxyHighlight">        DVR-&gt;replaceVariableLocationOp(New, Inst);</span></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><span class="doxyHighlightComment">  /// Remove an instruction from the IR.</span></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">InstructionRemover : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> TypePromotionAction &#123;</span></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><span class="doxyHighlightComment">    /// Original position of the instruction.</span></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><span class="doxyHighlight">    InsertionHandler Inserter;</span></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><span class="doxyHighlightComment">    /// Helper structure to hide all the link to the instruction. In other</span></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><span class="doxyHighlightComment">    /// words, this helps to do as if the instruction was removed.</span></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><span class="doxyHighlight">    OperandsHider Hider;</span></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><span class="doxyHighlightComment">    /// Keep track of the uses replaced, if any.</span></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><span class="doxyHighlight">    UsesReplacer &#42;Replacer = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><span class="doxyHighlightComment">    /// Keep track of instructions removed.</span></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts;</span></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><span class="doxyHighlightComment">    /// Remove all reference of \\p Inst and optionally replace all its</span></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><span class="doxyHighlightComment">    /// uses with New.</span></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><span class="doxyHighlightComment">    /// \\p RemovedInsts Keep track of the instructions removed by this Action.</span></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><span class="doxyHighlightComment">    /// \\pre If !Inst-&gt;use&#95;empty(), then New != nullptr</span></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><span class="doxyHighlight">    InstructionRemover(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts,</span></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/value">Value</a> &#42;New = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><span class="doxyHighlight">        : TypePromotionAction(Inst), Inserter(Inst), Hider(Inst),</span></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><span class="doxyHighlight">          RemovedInsts(RemovedInsts) &#123;</span></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (New)</span></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><span class="doxyHighlight">        Replacer = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UsesReplacer(Inst, New);</span></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Do: InstructionRemover: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><span class="doxyHighlight">      RemovedInsts.insert(Inst);</span></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><span class="doxyHighlightComment">      /// The instructions removed here will be freed after completing</span></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><span class="doxyHighlightComment">      /// optimizeBlock() for all blocks as we need to keep track of the</span></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><span class="doxyHighlightComment">      /// removed instructions during promotion.</span></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><span class="doxyHighlight">    ~InstructionRemover()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeyword">delete</span><span class="doxyHighlight"> Replacer; &#125;</span></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><span class="doxyHighlight">    InstructionRemover &amp;operator=(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> InstructionRemover &amp;other) = </span><span class="doxyHighlightKeyword">delete</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><span class="doxyHighlight">    InstructionRemover(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> InstructionRemover &amp;other) = </span><span class="doxyHighlightKeyword">delete</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><span class="doxyHighlightComment">    /// Resurrect the instruction and reassign it to the proper uses if</span></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><span class="doxyHighlightComment">    /// new value was provided when build this action.</span></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> undo()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Undo: InstructionRemover: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><span class="doxyHighlight">      Inserter.insert(Inst);</span></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Replacer)</span></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><span class="doxyHighlight">        Replacer-&gt;undo();</span></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><span class="doxyHighlight">      Hider.undo();</span></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><span class="doxyHighlight">      RemovedInsts.erase(Inst);</span></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><span class="doxyHighlightComment">  /// Restoration point.</span></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><span class="doxyHighlightComment">  /// The restoration point is a pointer to an action instead of an iterator</span></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><span class="doxyHighlightComment">  /// because the iterator may be invalidated but not the pointer.</span></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">ConstRestorationPt</a> = </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TypePromotionAction &#42;;</span></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a3f64f3705ad6de53221d46f95196acb7"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a3f64f3705ad6de53221d46f95196acb7">TypePromotionTransaction</a>(<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts)</span></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><span class="doxyHighlight">      : RemovedInsts(RemovedInsts) &#123;&#125;</span></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><span class="doxyHighlightComment">  /// Advocate every changes made in that transaction. Return true if any change</span></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><span class="doxyHighlightComment">  /// happen.</span></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> commit();</span></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><span class="doxyHighlightComment">  /// Undo all the changes made after the given point.</span></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> rollback(ConstRestorationPt Point);</span></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><span class="doxyHighlightComment">  /// Get the current restoration point.</span></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><span class="doxyHighlight">  ConstRestorationPt getRestorationPoint() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><span class="doxyHighlightComment">  /// \\name API for IR modification with state keeping to support rollback.</span></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><span class="doxyHighlightComment">  /// @&#123;</span></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><span class="doxyHighlightComment">  /// Same as Instruction::setOperand.</span></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> setOperand(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal);</span></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><span class="doxyHighlightComment">  /// Same as Instruction::eraseFromParent.</span></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp/#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><span class="doxyHighlightComment">  /// Same as Value::replaceAllUsesWith.</span></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;New);</span></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><span class="doxyHighlightComment">  /// Same as Value::mutateType.</span></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> mutateType(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy);</span></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><span class="doxyHighlightComment">  /// Same as IRBuilder::createTrunc.</span></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;createTrunc(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty);</span></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><span class="doxyHighlightComment">  /// Same as IRBuilder::createSExt.</span></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;createSExt(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty);</span></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><span class="doxyHighlightComment">  /// Same as IRBuilder::createZExt.</span></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;createZExt(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty);</span></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><span class="doxyHighlightComment">  /// The ordered list of actions made so far.</span></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::unique&#95;ptr&lt;TypePromotionAction&gt;</a>, 16&gt; Actions;</span></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">CommitPt =</span></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;std::unique&#95;ptr&lt;TypePromotionAction&gt;</a>&gt;<a href="/docs/api/classes/llvm/iplist">::iterator</a>;</span></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;RemovedInsts;</span></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a5a651fca694e060abd7d17d6cf34fe51"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a5a651fca694e060abd7d17d6cf34fe51">TypePromotionTransaction::setOperand</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx,</span></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal) &#123;</span></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><span class="doxyHighlight">  Actions.push&#95;back(std::make&#95;unique&lt;TypePromotionTransaction::OperandSetter&gt;(</span></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><span class="doxyHighlight">      Inst, Idx, NewVal));</span></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">TypePromotionTransaction::eraseInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</span></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal) &#123;</span></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><span class="doxyHighlight">  Actions.push&#95;back(</span></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><span class="doxyHighlight">      std::make&#95;unique&lt;TypePromotionTransaction::InstructionRemover&gt;(</span></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><span class="doxyHighlight">          Inst, RemovedInsts, NewVal));</span></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ad7595fd2ce173a5034cbc5f2376978e6"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ad7595fd2ce173a5034cbc5f2376978e6">TypePromotionTransaction::replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</span></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/value">Value</a> &#42;New) &#123;</span></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><span class="doxyHighlight">  Actions.push&#95;back(</span></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><span class="doxyHighlight">      std::make&#95;unique&lt;TypePromotionTransaction::UsesReplacer&gt;(Inst, New));</span></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a78fd7692f642fa4792119f0eabf67c12"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a78fd7692f642fa4792119f0eabf67c12">TypePromotionTransaction::mutateType</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy) &#123;</span></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"><span class="doxyHighlight">  Actions.push&#95;back(</span></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><span class="doxyHighlight">      std::make&#95;unique&lt;TypePromotionTransaction::TypeMutator&gt;(Inst, NewTy));</span></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#aa69a48966533c3b656b4ac37819bdcca"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#aa69a48966533c3b656b4ac37819bdcca">TypePromotionTransaction::createTrunc</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><span class="doxyHighlight">  std::unique&#95;ptr&lt;TruncBuilder&gt; <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> TruncBuilder(Opnd, Ty));</span></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</span></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><span class="doxyHighlight">  Actions.push&#95;back(std::move(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</span></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Val;</span></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a377ef6bb6c1215b043f7835ac91f04c0"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a377ef6bb6c1215b043f7835ac91f04c0">TypePromotionTransaction::createSExt</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd,</span></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><span class="doxyHighlight">  std::unique&#95;ptr&lt;SExtBuilder&gt; <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> SExtBuilder(Inst, Opnd, Ty));</span></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</span></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><span class="doxyHighlight">  Actions.push&#95;back(std::move(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</span></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Val;</span></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a40e7a7b00ec46903a6a39e28b30da046"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a40e7a7b00ec46903a6a39e28b30da046">TypePromotionTransaction::createZExt</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd,</span></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><span class="doxyHighlight">  std::unique&#95;ptr&lt;ZExtBuilder&gt; <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> ZExtBuilder(Inst, Opnd, Ty));</span></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</span></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><span class="doxyHighlight">  Actions.push&#95;back(std::move(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</span></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Val;</span></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a></span></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a09325594fe227adf9958691601147da9"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a09325594fe227adf9958691601147da9">TypePromotionTransaction::getRestorationPoint</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Actions.empty() ? Actions.back().get() : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a990fcc2525f7ebe5d3dae3aa10434fa0"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a990fcc2525f7ebe5d3dae3aa10434fa0">TypePromotionTransaction::commit</a>() &#123;</span></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::unique&#95;ptr&lt;TypePromotionAction&gt; &amp;Action : Actions)</span></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><span class="doxyHighlight">    Action-&gt;commit();</span></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = !Actions.empty();</span></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><span class="doxyHighlight">  Actions.clear();</span></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a7bba09bd30b547542b3316d2c93a5647"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a7bba09bd30b547542b3316d2c93a5647">TypePromotionTransaction::rollback</a>(</span></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> Point) &#123;</span></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Actions.empty() &amp;&amp; Point != Actions.back().get()) &#123;</span></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><span class="doxyHighlight">    std::unique&#95;ptr&lt;TypePromotionAction&gt; Curr = Actions.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><span class="doxyHighlight">    Curr-&gt;undo();</span></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><span class="doxyHighlightComment">/// A helper class for matching addressing modes.</span></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><span class="doxyHighlightComment">/// This encapsulates the logic for matching the target-legal addressing modes.</span></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">AddressingModeMatcher &#123;</span></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;AddrModeInsts;</span></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI;</span></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;TRI;</span></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</span></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI;</span></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::function&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;()&gt; getDTFn;</span></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><span class="doxyHighlightComment">  /// AccessTy/MemoryInst - This is the type for the access (e.g. double) and</span></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><span class="doxyHighlightComment">  /// the memory instruction that we&#39;re computing this address for.</span></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy;</span></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AddrSpace;</span></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;MemoryInst;</span></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><span class="doxyHighlightComment">  /// This is the addressing mode that we&#39;re building up. This is</span></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><span class="doxyHighlightComment">  /// part of the return value of this addressing mode matching stuff.</span></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</span></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><span class="doxyHighlightComment">  /// The instructions inserted by other CodeGenPrepare optimizations.</span></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts;</span></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><span class="doxyHighlightComment">  /// A map from the instructions to their type before promotion.</span></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts;</span></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><span class="doxyHighlightComment">  /// The ongoing transaction where every action should be registered.</span></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT;</span></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A GEP which has too large offset to be folded into the addressing mode.</span></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><span class="doxyHighlight">  std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt; &amp;LargeOffsetGEP;</span></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><span class="doxyHighlightComment">  /// This is set to true when we should not do profitability checks.</span></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><span class="doxyHighlightComment">  /// When true, IsProfitableToFoldIntoAddressingMode always returns true.</span></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IgnoreProfitability;</span></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><span class="doxyHighlightComment">  /// True if we are optimizing for size.</span></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptSize = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI;</span></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI;</span></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><span class="doxyHighlight">  AddressingModeMatcher(</span></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;AMI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;TRI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI,</span></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::function&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;()&gt; getDTFn, <a href="/docs/api/classes/llvm/type">Type</a> &#42;AT,</span></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AM,</span></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</span></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><span class="doxyHighlight">      std::pair&lt;<a href="/docs/api/classes/llvm/assertingvh">AssertingVH&lt;GetElementPtrInst&gt;</a>, int64&#95;t&gt; &amp;LargeOffsetGEP,</span></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI)</span></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><span class="doxyHighlight">      : AddrModeInsts(AMI), TLI(TLI), <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>(TRI),</span></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDataLayout()), LI(LI), getDTFn(getDTFn),</span></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><span class="doxyHighlight">        AccessTy(AT), AddrSpace(AS), MemoryInst(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>), <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>(AM),</span></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><span class="doxyHighlight">        InsertedInsts(InsertedInsts), PromotedInsts(PromotedInsts), TPT(TPT),</span></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><span class="doxyHighlight">        LargeOffsetGEP(LargeOffsetGEP), OptSize(OptSize), PSI(PSI), BFI(BFI) &#123;</span></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><span class="doxyHighlight">    IgnoreProfitability = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><span class="doxyHighlightComment">  /// Find the maximal addressing mode that a load/store of V can fold,</span></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><span class="doxyHighlightComment">  /// give an access type of AccessTy.  This returns a list of involved</span></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><span class="doxyHighlightComment">  /// instructions in AddrModeInsts.</span></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><span class="doxyHighlightComment">  /// \\p InsertedInsts The instructions inserted by other CodeGenPrepare</span></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><span class="doxyHighlightComment">  /// optimizations.</span></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><span class="doxyHighlightComment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</span></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><span class="doxyHighlightComment">  /// \\p The ongoing transaction where every action should be registered.</span></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a></span></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#a592ce6f54154b0ca1d672869951cad6b"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#a592ce6f54154b0ca1d672869951cad6b">Match</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;MemoryInst,</span></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;AddrModeInsts,</span></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI,</span></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::function&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;()&gt; getDTFn,</span></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;TRI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts,</span></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><span class="doxyHighlight">        <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><span class="doxyHighlight">        std::pair&lt;<a href="/docs/api/classes/llvm/assertingvh">AssertingVH&lt;GetElementPtrInst&gt;</a>, int64&#95;t&gt; &amp;LargeOffsetGEP,</span></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI) &#123;</span></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> Result;</span></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> = AddressingModeMatcher(AddrModeInsts, TLI, TRI, LI, getDTFn,</span></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><span class="doxyHighlight">                                         AccessTy, AS, MemoryInst, Result,</span></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><span class="doxyHighlight">                                         InsertedInsts, PromotedInsts, TPT,</span></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><span class="doxyHighlight">                                         LargeOffsetGEP, OptSize, PSI, BFI)</span></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><span class="doxyHighlight">                       .matchAddr(V, 0);</span></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><span class="doxyHighlight">    (void)<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a>;</span></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Couldn&#39;t select &#42;anything&#42;?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> matchScaledValue(<a href="/docs/api/classes/llvm/value">Value</a> &#42;ScaleReg, int64&#95;t Scale, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> matchAddr(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Addr, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> matchOperationAddr(<a href="/docs/api/classes/llvm/user">User</a> &#42;AddrInst, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</span></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#42;MovedAway = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isProfitableToFoldIntoAddressingMode(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><span class="doxyHighlight">                                            <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMBefore,</span></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><span class="doxyHighlight">                                            <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMAfter);</span></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> valueAlreadyLiveAtInst(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val, <a href="/docs/api/classes/llvm/value">Value</a> &#42;KnownLive1, <a href="/docs/api/classes/llvm/value">Value</a> &#42;KnownLive2);</span></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isPromotionProfitable(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewCost, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldCost,</span></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/value">Value</a> &#42;PromotedOperand) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">PhiNodeSet;</span></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><span class="doxyHighlightComment">/// An iterator for PhiNodeSet.</span></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &#123;</span></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Set;</span></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> CurrentIndex = 0;</span></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><span class="doxyHighlightComment">  /// The constructor. Start should point to either a valid element, or be equal</span></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><span class="doxyHighlightComment">  /// to the size of the underlying SmallVector of the PhiNodeSet.</span></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Set, </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> Start);</span></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/namespaces/llvm/#a2366b4a30c90d2207626fb717dfb778d">operator&#42;</a>() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a438449b3174971956b5dd708baaa94f5">operator++</a>();</span></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a4d812a2dd18aa186c164447e20e348e7">operator==</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a2f883c895f4d244f4ed56ed8a8c160c1">operator!=</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><span class="doxyHighlightComment">/// Keeps a set of PHINodes.</span></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><span class="doxyHighlightComment">/// This is a minimal set implementation for a specific use case:</span></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><span class="doxyHighlightComment">/// It is very fast when there are very few elements, but also provides good</span></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><span class="doxyHighlightComment">/// performance when there are many. It is similar to SmallPtrSet, but also</span></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><span class="doxyHighlightComment">/// provides iteration by insertion order, which is deterministic and stable</span></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><span class="doxyHighlightComment">/// across runs. It is also similar to SmallSetVector, but provides removing</span></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><span class="doxyHighlightComment">/// elements in O(1) time. This is achieved by not actually removing the element</span></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><span class="doxyHighlightComment">/// from the underlying vector, so comes at the cost of using more memory, but</span></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><span class="doxyHighlightComment">/// that is fine, since PhiNodeSets are used as short lived objects.</span></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#123;</span></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>;</span></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">MapType = <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;PHINode &#42;, size&#95;t, 32&gt;</a>;</span></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">iterator = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>;</span></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><span class="doxyHighlightComment">  /// Keeps the elements in the order of their insertion in the underlying</span></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><span class="doxyHighlightComment">  /// vector. To achieve constant time removal, it never deletes any element.</span></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 32&gt;</a> NodeList;</span></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><span class="doxyHighlightComment">  /// Keeps the elements in the underlying set implementation. This (and not the</span></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><span class="doxyHighlightComment">  /// NodeList defined above) is the source of truth on whether an element</span></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><span class="doxyHighlightComment">  /// is actually in the collection.</span></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"><span class="doxyHighlight">  MapType NodeMap;</span></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><span class="doxyHighlightComment">  /// Points to the first valid (not deleted) element when the set is not empty</span></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><span class="doxyHighlightComment">  /// and the value is not zero. Equals to the size of the underlying vector</span></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><span class="doxyHighlightComment">  /// when the set is empty. When the value is 0, as in the beginning, the</span></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"><span class="doxyHighlightComment">  /// first element may or may not be valid.</span></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> FirstValidElement = 0;</span></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><span class="doxyHighlightComment">  /// Inserts a new element to the collection.</span></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><span class="doxyHighlightComment">  /// \\returns true if the element is actually added, i.e. was not in the</span></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><span class="doxyHighlightComment">  /// collection before the operation.</span></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a43f3dcfddac1a12f607ebf72f1a8d0e1"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a43f3dcfddac1a12f607ebf72f1a8d0e1">insert</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</span></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NodeMap.insert(std::make&#95;pair(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, NodeList.size())).second) &#123;</span></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><span class="doxyHighlight">      NodeList.push&#95;back(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"><span class="doxyHighlightComment">  /// Removes the element from the collection.</span></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><span class="doxyHighlightComment">  /// \\returns whether the element is actually removed, i.e. was in the</span></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><span class="doxyHighlightComment">  /// collection before the operation.</span></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a3111b51f006f1833e4fecfeef0318afb"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a3111b51f006f1833e4fecfeef0318afb">erase</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</span></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NodeMap.erase(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) &#123;</span></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><span class="doxyHighlight">      SkipRemovedElements(FirstValidElement);</span></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><span class="doxyHighlightComment">  /// Removes all elements and clears the collection.</span></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#ab2d3905e7ebf372e3a39250a5996352b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#ab2d3905e7ebf372e3a39250a5996352b">clear</a>() &#123;</span></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><span class="doxyHighlight">    NodeMap.clear();</span></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><span class="doxyHighlight">    NodeList.clear();</span></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><span class="doxyHighlight">    FirstValidElement = 0;</span></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><span class="doxyHighlightComment">  /// \\returns an iterator that will iterate the elements in the order of</span></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><span class="doxyHighlightComment">  /// insertion.</span></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6f13e5c0f27b4c9cfc9cf8b5cc566a8d"><span class="doxyHighlight">  iterator <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6f13e5c0f27b4c9cfc9cf8b5cc566a8d">begin</a>() &#123;</span></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstValidElement == 0)</span></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><span class="doxyHighlight">      SkipRemovedElements(FirstValidElement);</span></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, FirstValidElement);</span></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"><span class="doxyHighlightComment">  /// \\returns an iterator that points to the end of the collection.</span></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6aec8829d91ec29a4e5cbeb6245ed043"><span class="doxyHighlight">  iterator <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a6aec8829d91ec29a4e5cbeb6245ed043">end</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aed9bff0cb7c4853f18d99ca1cc893a6a">PhiNodeSetIterator</a>(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, NodeList.size()); &#125;</span></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931"></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><span class="doxyHighlightComment">  /// Returns the number of elements in the collection.</span></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a07c214df8becbb8a7dda21ce1edf723e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#a07c214df8becbb8a7dda21ce1edf723e">size</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NodeMap.size(); &#125;</span></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><span class="doxyHighlightComment">  /// \\returns 1 if the given element is in the collection, and 0 if otherwise.</span></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aeea2f32da818130992720bbc84ad2dd8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset/#aeea2f32da818130992720bbc84ad2dd8">count</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NodeMap.count(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>); &#125;</span></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><span class="doxyHighlightComment">  /// Updates the CurrentIndex so that it will point to a valid element.</span></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><span class="doxyHighlightComment">  /// If the element of NodeList at CurrentIndex is valid, it does not</span></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><span class="doxyHighlightComment">  /// change it. If there are no more valid elements, it updates CurrentIndex</span></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><span class="doxyHighlightComment">  /// to point to the end of the NodeList.</span></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> SkipRemovedElements(</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> &amp;CurrentIndex) &#123;</span></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CurrentIndex &lt; <a href="/docs/api/structs/nodelist">NodeList</a>.size()) &#123;</span></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> it = NodeMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/structs/nodelist">NodeList</a>&#91;CurrentIndex&#93;);</span></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the element has been deleted and added again later, NodeMap will</span></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// point to a different index, so CurrentIndex will still be invalid.</span></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (it != NodeMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; it-&gt;second == CurrentIndex)</span></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><span class="doxyHighlight">      ++CurrentIndex;</span></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator::PhiNodeSetIterator</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Set, </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> Start)</span></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"><span class="doxyHighlight">    : Set(Set), CurrentIndex(Start) &#123;&#125;</span></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a6c9f931e2de047a28ce47c0bcc685996"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a6c9f931e2de047a28ce47c0bcc685996">PhiNodeSetIterator::operator&#42;</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrentIndex &lt; Set-&gt;<a href="/docs/api/structs/nodelist">NodeList</a>.size() &amp;&amp;</span></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;PhiNodeSet access out of range&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Set-&gt;NodeList&#91;CurrentIndex&#93;;</span></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a438449b3174971956b5dd708baaa94f5"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a438449b3174971956b5dd708baaa94f5">PhiNodeSetIterator::operator++</a>() &#123;</span></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrentIndex &lt; Set-&gt;<a href="/docs/api/structs/nodelist">NodeList</a>.size() &amp;&amp;</span></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;PhiNodeSet access out of range&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><span class="doxyHighlight">  ++CurrentIndex;</span></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><span class="doxyHighlight">  Set-&gt;SkipRemovedElements(CurrentIndex);</span></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac376b169181845ba2cfdec5cebb9977a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac376b169181845ba2cfdec5cebb9977a">PhiNodeSetIterator::operator==</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CurrentIndex == RHS.CurrentIndex;</span></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a899d3d313258e6cda9bfed86f677775e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#a899d3d313258e6cda9bfed86f677775e">PhiNodeSetIterator::operator!=</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodesetiterator/#ac9c46cf049d7f2e77a0db8a8ab3bdcee">PhiNodeSetIterator</a> &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !((&#42;this) == RHS);</span></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><span class="doxyHighlightComment">/// Keep track of simplification of Phi nodes.</span></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><span class="doxyHighlightComment">/// Accept the set of all phi nodes and erase phi node from this set</span></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><span class="doxyHighlightComment">/// if it is simplified.</span></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad7916c415b8025174aee1fd76cc49791">SimplificationTracker</a> &#123;</span></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> Storage;</span></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;SQ;</span></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Tracks newly created Phi nodes. The elements are iterated by insertion</span></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// order.</span></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> AllPhiNodes;</span></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Tracks newly created Select nodes.</span></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;SelectInst &#42;, 32&gt;</a> AllSelectNodes;</span></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad7916c415b8025174aee1fd76cc49791"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad7916c415b8025174aee1fd76cc49791">SimplificationTracker</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;sq) : SQ(sq) &#123;&#125;</span></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SV = Storage.find(V);</span></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SV == Storage.end())</span></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><span class="doxyHighlight">      V = SV-&gt;second;</span></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ac632fa4ac33de997f4fc1b02b416462c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ac632fa4ac33de997f4fc1b02b416462c">Simplify</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val) &#123;</span></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 32&gt;</a> WorkList;</span></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 32&gt;</a> Visited;</span></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><span class="doxyHighlight">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Val);</span></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>).second)</span></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>))</span></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PI), SQ)) &#123;</span></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : PI-&gt;users())</span></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><span class="doxyHighlight">            WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Value&gt;</a>(U));</span></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"><span class="doxyHighlight">          <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e">Put</a>(PI, V);</span></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"><span class="doxyHighlight">          PI-&gt;replaceAllUsesWith(V);</span></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(PI))</span></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><span class="doxyHighlight">            AllPhiNodes.erase(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(PI))</span></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><span class="doxyHighlight">            AllSelectNodes.erase(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</span></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"><span class="doxyHighlight">          PI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(Val);</span></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e">Put</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;From, <a href="/docs/api/classes/llvm/value">Value</a> &#42;To) &#123; Storage.insert(&#123;From, To&#125;); &#125;</span></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad39fccc0304ca0ff35a57687380ca595"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ad39fccc0304ca0ff35a57687380ca595">ReplacePhi</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;From, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;To) &#123;</span></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OldReplacement = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(From);</span></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (OldReplacement != From) &#123;</span></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><span class="doxyHighlight">      From = To;</span></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><span class="doxyHighlight">      To = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(OldReplacement);</span></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><span class="doxyHighlight">      OldReplacement = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(From);</span></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(To &amp;&amp; <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ab2beb2df7ba99852abe3402a7ebda791">Get</a>(To) == To &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Replacement PHI node is already replaced.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a77b8e5033759c4cfdbe2cf690e7c7c7e">Put</a>(From, To);</span></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"><span class="doxyHighlight">    From-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(To);</span></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><span class="doxyHighlight">    AllPhiNodes.erase(From);</span></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><span class="doxyHighlight">    From-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a97045da401020466ebf377db4daff677"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/phinodeset">PhiNodeSet</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a97045da401020466ebf377db4daff677">newPhiNodes</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AllPhiNodes; &#125;</span></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a171be14e737571f0ced63e6e045c3d09"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a171be14e737571f0ced63e6e045c3d09">insertNewPhi</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123; AllPhiNodes.insert(PN); &#125;</span></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a686670a8c9fa5a87c2b290dde33c6e9a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a686670a8c9fa5a87c2b290dde33c6e9a">insertNewSelect</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123; AllSelectNodes.insert(<a href="/docs/api/namespaces/llvm/si">SI</a>); &#125;</span></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ae0734c5a43308ef23875b8f8cfea21f5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#ae0734c5a43308ef23875b8f8cfea21f5">countNewPhiNodes</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AllPhiNodes.size(); &#125;</span></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#afed3db6a950184377c563f40bef74317"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#afed3db6a950184377c563f40bef74317">countNewSelectNodes</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AllSelectNodes.size(); &#125;</span></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a510bd9f9dcdaa582836018148bc749c0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/simplificationtracker/#a510bd9f9dcdaa582836018148bc749c0">destroyNewNodes</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;CommonType) &#123;</span></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For safe erasing, replace the uses with dummy value first.</span></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Dummy = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CommonType);</span></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AllPhiNodes) &#123;</span></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Dummy);</span></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><span class="doxyHighlight">    AllPhiNodes.clear();</span></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AllSelectNodes) &#123;</span></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Dummy);</span></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><span class="doxyHighlight">    AllSelectNodes.clear();</span></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><span class="doxyHighlightComment">/// A helper class for combining addressing modes.</span></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a12d7bf62cc9469dcc8776c045ad91169">AddressingModeCombiner</a> &#123;</span></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">typedef</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> FoldAddrToValueMapping;</span></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">typedef</span><span class="doxyHighlight"> std::pair&lt;PHINode &#42;, PHINode &#42;&gt; PHIPair;</span></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"><span class="doxyHighlightComment">  /// The addressing modes we&#39;ve collected.</span></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ExtAddrMode, 16&gt;</a> AddrModes;</span></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"><span class="doxyHighlightComment">  /// The field in which the AddrModes differ, when we have more than one.</span></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">ExtAddrMode::FieldName</a> DifferentField = <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">ExtAddrMode::NoField</a>;</span></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><span class="doxyHighlightComment">  /// Are the AddrModes that we have all just equal to their original values?</span></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllAddrModesTrivial = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><span class="doxyHighlightComment">  /// Common Type for all different fields in addressing modes.</span></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CommonType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><span class="doxyHighlightComment">  /// SimplifyQuery for simplifyInstruction utility.</span></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;SQ;</span></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"><span class="doxyHighlightComment">  /// Original Address.</span></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Original;</span></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><span class="doxyHighlightComment">  /// Common value among addresses</span></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CommonValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a12d7bf62cc9469dcc8776c045ad91169"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a12d7bf62cc9469dcc8776c045ad91169">AddressingModeCombiner</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;&#95;SQ, <a href="/docs/api/classes/llvm/value">Value</a> &#42;OriginalValue)</span></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"><span class="doxyHighlight">      : SQ(&#95;SQ), Original(OriginalValue) &#123;&#125;</span></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a11b3fca9e6b5a0a86f833919280c8d6d"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a11b3fca9e6b5a0a86f833919280c8d6d">~AddressingModeCombiner</a>() &#123; eraseCommonValueIfDead(); &#125;</span></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><span class="doxyHighlightComment">  /// Get the combined AddrMode</span></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#ad554dafe341161df27c6e4762ce5ac82"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#ad554dafe341161df27c6e4762ce5ac82">getAddrMode</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AddrModes&#91;0&#93;; &#125;</span></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><span class="doxyHighlightComment">  /// Add a new AddrMode if it&#39;s compatible with the AddrModes we already</span></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><span class="doxyHighlightComment">  /// have.</span></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><span class="doxyHighlightComment">  /// \\return True iff we succeeded in doing so.</span></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a68677e52356488f3516d001f127588a5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a68677e52356488f3516d001f127588a5">addNewAddrMode</a>(<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;NewAddrMode) &#123;</span></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Take note of if we have any non-trivial AddrModes, as we need to detect</span></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// when all AddrModes are trivial as then we would introduce a phi or select</span></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which just duplicates what&#39;s already there.</span></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><span class="doxyHighlight">    AllAddrModesTrivial = AllAddrModesTrivial &amp;&amp; NewAddrMode.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#af16961a6894c56bc7f08641a2538167d">isTrivial</a>();</span></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is the first addrmode then everything is fine.</span></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrModes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"><span class="doxyHighlight">      AddrModes.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(NewAddrMode);</span></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Figure out how different this is from the other address modes, which we</span></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// can do just by comparing against the first one given that we only care</span></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// about the cumulative difference.</span></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3b">ExtAddrMode::FieldName</a> ThisDifferentField =</span></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><span class="doxyHighlight">        AddrModes&#91;0&#93;.compare(NewAddrMode);</span></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DifferentField == <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">ExtAddrMode::NoField</a>)</span></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><span class="doxyHighlight">      DifferentField = ThisDifferentField;</span></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DifferentField != ThisDifferentField)</span></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><span class="doxyHighlight">      DifferentField = <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">ExtAddrMode::MultipleFields</a>;</span></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If NewAddrMode differs in more than one dimension we cannot handle it.</span></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanHandle = DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba487a1fc3c02e9df7cb63a01968499611">ExtAddrMode::MultipleFields</a>;</span></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If Scale Field is different then we reject.</span></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><span class="doxyHighlight">    CanHandle = CanHandle &amp;&amp; DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bad9eaab024b6516aae7cd2912a8ed4101">ExtAddrMode::ScaleField</a>;</span></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We also must reject the case when base offset is different and</span></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scale reg is not null, we cannot handle this case due to merge of</span></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// different offsets will be used as ScaleReg.</span></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"><span class="doxyHighlight">    CanHandle = CanHandle &amp;&amp; (DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">ExtAddrMode::BaseOffsField</a> ||</span></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><span class="doxyHighlight">                              !NewAddrMode.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#ab3efdd9ffd185b09958bdb0f6697c3eb">ScaledReg</a>);</span></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We also must reject the case when GV is different and BaseReg installed</span></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// due to we want to use base reg as a merge of GV values.</span></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><span class="doxyHighlight">    CanHandle = CanHandle &amp;&amp; (DifferentField != <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">ExtAddrMode::BaseGVField</a> ||</span></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><span class="doxyHighlight">                              !NewAddrMode.HasBaseReg);</span></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Even if NewAddMode is the same we still need to collect it due to</span></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// original value is different. And later we will need all original values</span></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as anchors during finding the common Phi node.</span></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanHandle)</span></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"><span class="doxyHighlight">      AddrModes.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(NewAddrMode);</span></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><span class="doxyHighlight">      AddrModes.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CanHandle;</span></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"><span class="doxyHighlightComment">  /// Combine the addressing modes we&#39;ve collected into a single</span></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><span class="doxyHighlightComment">  /// addressing mode.</span></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><span class="doxyHighlightComment">  /// \\return True iff we successfully combined them or we only had one so</span></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"><span class="doxyHighlightComment">  /// didn&#39;t need to combine them anyway.</span></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a063d1fe1021fb19338b10705adb5f075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodecombiner/#a063d1fe1021fb19338b10705adb5f075">combineAddrModes</a>() &#123;</span></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have no AddrModes then they can&#39;t be combined.</span></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrModes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0)</span></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A single AddrMode can trivially be combined.</span></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrModes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 || DifferentField == <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bade3fdafc2a520488937de65060546976">ExtAddrMode::NoField</a>)</span></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the AddrModes we collected are all just equal to the value they are</span></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// derived from then combining them wouldn&#39;t do anything useful.</span></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllAddrModesTrivial)</span></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!addrModeCombiningAllowed())</span></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Build a map between &lt;original value, basic block where we saw it&gt; to</span></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value of base register.</span></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bail out if there is no common type.</span></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><span class="doxyHighlight">    FoldAddrToValueMapping Map;</span></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!initializeMap(Map))</span></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><span class="doxyHighlight">    CommonValue = findCommon(Map);</span></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonValue)</span></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><span class="doxyHighlight">      AddrModes&#91;0&#93;.SetCombinedField(DifferentField, CommonValue, AddrModes);</span></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CommonValue != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"><span class="doxyHighlightComment">  /// &#96;CommonValue&#96; may be a placeholder inserted by us.</span></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><span class="doxyHighlightComment">  /// If the placeholder is not used, we should remove this dead instruction.</span></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> eraseCommonValueIfDead() &#123;</span></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonValue &amp;&amp; CommonValue-&gt;<a href="/docs/api/classes/llvm/value/#aba0055050d741f60b6e0523507a2c79f">getNumUses</a>() == 0)</span></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CommonInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(CommonValue))</span></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><span class="doxyHighlight">        CommonInst-&gt;eraseFromParent();</span></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><span class="doxyHighlightComment">  /// Initialize Map with anchor values. For address seen</span></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><span class="doxyHighlightComment">  /// we set the value of different field saw in this address.</span></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"><span class="doxyHighlightComment">  /// At the same time we find a common type for different field we will</span></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><span class="doxyHighlightComment">  /// use to create new Phi/Select nodes. Keep it in CommonType field.</span></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><span class="doxyHighlightComment">  /// Return false if there is no common type found.</span></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> initializeMap(FoldAddrToValueMapping &amp;Map) &#123;</span></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep track of keys where the value is null. We will need to replace it</span></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with constant null when we know the common type.</span></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> NullValue;</span></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntPtrTy = SQ.<a href="/docs/api/structs/llvm/simplifyquery/#a0ffb6d79f6befe2030328bd1d7110feb">DL</a>.<a href="/docs/api/classes/llvm/datalayout/#a7a2619d0e489a4ba9c19a0d86a041d59">getIntPtrType</a>(AddrModes&#91;0&#93;.OriginalValue-&gt;getType());</span></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;AM : AddrModes) &#123;</span></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;DV = AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a98c66d9b5e8ace6575527d88e08fe378">GetFieldAsValue</a>(DifferentField, IntPtrTy);</span></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DV) &#123;</span></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/type">Type</a> = DV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonType &amp;&amp; CommonType != <a href="/docs/api/classes/llvm/type">Type</a>)</span></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><span class="doxyHighlight">        CommonType = <a href="/docs/api/classes/llvm/type">Type</a>;</span></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><span class="doxyHighlight">        Map&#91;AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f">OriginalValue</a>&#93; = DV;</span></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><span class="doxyHighlight">        NullValue.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(AM.<a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#afb3608f4d5ddc7a177772e1dbb17f96f">OriginalValue</a>);</span></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CommonType &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;At least one non-null value must be!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : NullValue)</span></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>&#93; = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(CommonType);</span></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"><span class="doxyHighlightComment">  /// We have mapping between value A and other value B where B was a field in</span></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><span class="doxyHighlightComment">  /// addressing mode represented by A. Also we have an original value C</span></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"><span class="doxyHighlightComment">  /// representing an address we start with. Traversing from C through phi and</span></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><span class="doxyHighlightComment">  /// selects we ended up with A&#39;s in a map. This utility function tries to find</span></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><span class="doxyHighlightComment">  /// a value V which is a field in addressing mode C and traversing through phi</span></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><span class="doxyHighlightComment">  /// nodes and selects we will end up in corresponded values B in a map.</span></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><span class="doxyHighlightComment">  /// The utility will create a new Phi/Selects if needed.</span></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The simple example looks as follows:</span></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB1:</span></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   p1 = b1 + 40</span></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br cond BB2, BB3</span></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB2:</span></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   p2 = b2 + 40</span></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br BB3</span></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB3:</span></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   p = phi &#91;p1, BB1&#93;, &#91;p2, BB2&#93;</span></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   v = load p</span></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Map is</span></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   p1 -&gt; b1</span></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   p2 -&gt; b2</span></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Request is</span></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   p -&gt; ?</span></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The function tries to find or build phi &#91;b1, BB1&#93;, &#91;b2, BB2&#93; in BB3.</span></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;findCommon(FoldAddrToValueMapping &amp;Map) &#123;</span></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Tracks the simplification of newly created phi nodes. The reason we use</span></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this mapping is because we will add new created Phi nodes in AddrToBase.</span></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Simplification of Phi nodes is recursive, so some Phi node may</span></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be simplified after we added it to AddrToBase. In reality this</span></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simplification is possible only if original phi/selects were not</span></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simplified yet.</span></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Using this mapping we can find the current value in AddrToBase.</span></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><span class="doxyHighlight">    SimplificationTracker <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>(SQ);</span></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First step, DFS to create PHI nodes for all intermediate blocks.</span></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Also fill traverse order for the second step.</span></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><span class="doxyHighlight">    SmallVector&lt;Value &#42;, 32&gt; TraverseOrder;</span></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><span class="doxyHighlight">    InsertPlaceholders(Map, TraverseOrder, ST);</span></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Second Step, fill new nodes by merged values and simplify if possible.</span></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><span class="doxyHighlight">    FillPlaceholders(Map, TraverseOrder, ST);</span></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a732a4fb41e78c56627fb9748f00935ab">AddrSinkNewSelects</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewSelectNodes() &gt; 0) &#123;</span></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.destroyNewNodes(CommonType);</span></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now we&#39;d like to match New Phi nodes to existed ones.</span></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PhiNotMatchedCount = 0;</span></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MatchPhiSet(ST, <a href="#afedfbc99c6b04e20643eb77da796d522">AddrSinkNewPhis</a>, PhiNotMatchedCount)) &#123;</span></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.destroyNewNodes(CommonType);</span></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(Original)-&gt;second);</span></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result) &#123;</span></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><span class="doxyHighlight">      NumMemoryInstsPhiCreated += <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewPhiNodes() + PhiNotMatchedCount;</span></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"><span class="doxyHighlight">      NumMemoryInstsSelectCreated += <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewSelectNodes();</span></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</span></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"><span class="doxyHighlightComment">  /// Try to match PHI node to Candidate.</span></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><span class="doxyHighlightComment">  /// Matcher tracks the matched Phi nodes.</span></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MatchPhiNode(PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, PHINode &#42;Candidate,</span></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><span class="doxyHighlight">                    SmallSetVector&lt;PHIPair, 8&gt; &amp;Matcher,</span></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><span class="doxyHighlight">                    PhiNodeSet &amp;PhiNodesToMatch) &#123;</span></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;PHIPair, 8&gt;</a> WorkList;</span></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><span class="doxyHighlight">    Matcher.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&#123;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, Candidate&#125;);</span></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><span class="doxyHighlight">    SmallSet&lt;PHINode &#42;, 8&gt; MatchedPHIs;</span></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"><span class="doxyHighlight">    MatchedPHIs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"><span class="doxyHighlight">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, Candidate&#125;);</span></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><span class="doxyHighlight">    SmallSet&lt;PHIPair, 8&gt; Visited;</span></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Item = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Item).second)</span></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We iterate over all incoming values to Phi to compare them.</span></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If values are different and both of them Phi and the first one is a</span></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Phi we added (subject to match) and both of them is in the same basic</span></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// block then we can match our pair if values match. So we state that</span></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// these values match and add it to work list to verify that.</span></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : Item.first-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FirstValue = Item.first-&gt;getIncomingValueForBlock(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SecondValue = Item.second-&gt;getIncomingValueForBlock(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstValue == SecondValue)</span></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><span class="doxyHighlight">        PHINode &#42;FirstPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(FirstValue);</span></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><span class="doxyHighlight">        PHINode &#42;SecondPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(SecondValue);</span></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// One of them is not Phi or</span></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The first one is not Phi node from the set we&#39;d like to match or</span></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Phi nodes from different basic blocks then</span></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we will not be able to match.</span></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FirstPhi || !SecondPhi || !PhiNodesToMatch.count(FirstPhi) ||</span></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326"><span class="doxyHighlight">            FirstPhi-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != SecondPhi-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we already matched them then continue.</span></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Matcher.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(&#123;FirstPhi, SecondPhi&#125;))</span></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// So the values are different and does not match. So we need them to</span></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// match. (But we register no more than one match per PHI node, so that</span></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we won&#39;t later try to replace them twice.)</span></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MatchedPHIs.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(FirstPhi).second)</span></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><span class="doxyHighlight">          Matcher.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&#123;FirstPhi, SecondPhi&#125;);</span></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// But me must check it.</span></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><span class="doxyHighlight">        WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;FirstPhi, SecondPhi&#125;);</span></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><span class="doxyHighlightComment">  /// For the given set of PHI nodes (in the SimplificationTracker) try</span></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><span class="doxyHighlightComment">  /// to find their equivalents.</span></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"><span class="doxyHighlightComment">  /// Returns false if this matching fails and creation of new Phi is disabled.</span></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MatchPhiSet(SimplificationTracker &amp;ST, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowNewPhiNodes,</span></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;PhiNotMatchedCount) &#123;</span></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Matched and PhiNodesToMatch iterate their elements in a deterministic</span></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// order, so the replacements (ReplacePhi) are also done in a deterministic</span></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// order.</span></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><span class="doxyHighlight">    SmallSetVector&lt;PHIPair, 8&gt; Matched;</span></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><span class="doxyHighlight">    SmallPtrSet&lt;PHINode &#42;, 8&gt; WillNotMatch;</span></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><span class="doxyHighlight">    PhiNodeSet &amp;PhiNodesToMatch = <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.newPhiNodes();</span></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PhiNodesToMatch.size()) &#123;</span></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><span class="doxyHighlight">      PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = &#42;PhiNodesToMatch.begin();</span></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add us, if no Phi nodes in the basic block we do not match.</span></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><span class="doxyHighlight">      WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</span></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><span class="doxyHighlight">      WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Traverse all Phis until we found equivalent or fail to do that.</span></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsMatched = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent()-&gt;phis()) &#123;</span></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Skip new Phi nodes.</span></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiNodesToMatch.count(&amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>))</span></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((IsMatched = MatchPhiNode(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, Matched, PhiNodesToMatch)))</span></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If it does not match, collect all Phi nodes from matcher.</span></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// if we end up with no match, them all these Phi nodes will not match</span></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// later.</span></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> M : Matched)</span></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><span class="doxyHighlight">          WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.first);</span></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><span class="doxyHighlight">        Matched.clear();</span></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsMatched) &#123;</span></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Replace all matched values and erase them.</span></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MV : Matched)</span></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.ReplacePhi(MV.first, MV.second);</span></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><span class="doxyHighlight">        Matched.clear();</span></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we are not allowed to create new nodes then bail out.</span></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllowNewPhiNodes)</span></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Just remove all seen values in matcher. They will not match anything.</span></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><span class="doxyHighlight">      PhiNotMatchedCount += WillNotMatch.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>();</span></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : WillNotMatch)</span></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><span class="doxyHighlight">        PhiNodesToMatch.erase(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><span class="doxyHighlightComment">  /// Fill the placeholders with values from predecessors and simplify them.</span></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> FillPlaceholders(FoldAddrToValueMapping &amp;Map,</span></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><span class="doxyHighlight">                        SmallVectorImpl&lt;Value &#42;&gt; &amp;TraverseOrder,</span></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><span class="doxyHighlight">                        SimplificationTracker &amp;ST) &#123;</span></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!TraverseOrder.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Current = TraverseOrder.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(Current) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No node to fill!!!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93;;</span></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SelectInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// CurrentValue also must be Select.</span></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CurrentSelect = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(Current);</span></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TrueValue = CurrentSelect-&gt;getTrueValue();</span></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(TrueValue) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No True Value!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;setTrueValue(<a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map&#91;TrueValue&#93;));</span></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FalseValue = CurrentSelect-&gt;getFalseValue();</span></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(FalseValue) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No False Value!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;setFalseValue(<a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map&#91;FalseValue&#93;));</span></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Must be a Phi node then.</span></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(V);</span></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Fill the Phi node with values from predecessors.</span></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent())) &#123;</span></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(Current)-&gt;getIncomingValueForBlock(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(PV) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No predecessor Value!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(<a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map&#91;PV&#93;), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93; = <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Simplify(V);</span></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><span class="doxyHighlightComment">  /// Starting from original value recursively iterates over def-use chain up to</span></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><span class="doxyHighlightComment">  /// known ending values represented in a map. For each traversed phi/select</span></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><span class="doxyHighlightComment">  /// inserts a placeholder Phi or Select.</span></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><span class="doxyHighlightComment">  /// Reports all new created Phi/Select nodes by adding them to set.</span></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"><span class="doxyHighlightComment">  /// Also reports and order in what values have been traversed.</span></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> InsertPlaceholders(FoldAddrToValueMapping &amp;Map,</span></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><span class="doxyHighlight">                          SmallVectorImpl&lt;Value &#42;&gt; &amp;TraverseOrder,</span></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><span class="doxyHighlight">                          SimplificationTracker &amp;ST) &#123;</span></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><span class="doxyHighlight">    SmallVector&lt;Value &#42;, 32&gt; Worklist;</span></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Original) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(Original)) &amp;&amp;</span></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Address must be a Phi or Select node&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/nvptxisd/#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a> = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CommonType);</span></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Original);</span></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Current = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if it is already visited or it is an ending value then skip it.</span></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.contains(Current))</span></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><span class="doxyHighlight">      TraverseOrder.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Current);</span></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// CurrentValue must be a Phi node or select. All others must be covered</span></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// by anchors.</span></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SelectInst &#42;CurrentSelect = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Current)) &#123;</span></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Is it OK to get metadata from OrigSelect?!</span></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Create a Select placeholder with dummy value.</span></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><span class="doxyHighlight">        SelectInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> =</span></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(CurrentSelect-&gt;getCondition(), Dummy, Dummy,</span></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><span class="doxyHighlight">                               CurrentSelect-&gt;getName(),</span></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><span class="doxyHighlight">                               CurrentSelect-&gt;getIterator(), CurrentSelect);</span></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93; = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>;</span></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.insertNewSelect(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</span></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We are interested in True and False values.</span></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurrentSelect-&gt;getTrueValue());</span></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurrentSelect-&gt;getFalseValue());</span></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// It must be a Phi node then.</span></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><span class="doxyHighlight">        PHINode &#42;CurrentPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(Current);</span></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PredCount = CurrentPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</span></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><span class="doxyHighlight">        PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> =</span></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(CommonType, PredCount, </span><span class="doxyHighlightStringLiteral">&quot;sunk&#95;phi&quot;</span><span class="doxyHighlight">, CurrentPhi-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/msgpack/#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>&#91;Current&#93; = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</span></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.insertNewPhi(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Worklist, CurrentPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>());</span></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> addrModeCombiningAllowed() &#123;</span></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa653d45524ba8feb6e97dd4f961b7c3e">DisableComplexAddrModes</a>)</span></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (DifferentField) &#123;</span></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3bafbb3f111d9869fde071cbdd50c50fd9e">ExtAddrMode::BaseRegField</a>:</span></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a44b23d217bd678cd7aef7d152d945537">AddrSinkCombineBaseReg</a>;</span></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3baf4d9622b8e7495cb65099c1333085a24">ExtAddrMode::BaseGVField</a>:</span></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a51f303fd2cc8c48e50ab97c59f3558cc">AddrSinkCombineBaseGV</a>;</span></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba00291a866d6acfad336e7606f1c17c92">ExtAddrMode::BaseOffsField</a>:</span></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a3a00df51e1fa276c0c8860fe5ac1f95c">AddrSinkCombineBaseOffs</a>;</span></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode/#a10aef7c4018bbcd7beefca2dcf4e3c3ba1b3ebdf8bae0e1f7aad691b016c5a178">ExtAddrMode::ScaledRegField</a>:</span></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a984c73ae4b3ecbd1c9a237c11e38ac62">AddrSinkCombineScaledReg</a>;</span></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><span class="doxyHighlightComment">/// Try adding ScaleReg&#42;Scale to the current addressing mode.</span></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><span class="doxyHighlightComment">/// Return true and update AddrMode if this addr mode is legal for the target,</span></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><span class="doxyHighlightComment">/// false if not.</span></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddressingModeMatcher::matchScaledValue(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ScaleReg, int64&#95;t Scale,</span></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) &#123;</span></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If Scale is 1, then this is the same as adding ScaleReg to the addressing</span></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mode.  Just process that directly.</span></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Scale == 1)</span></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> matchAddr(ScaleReg, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the scale is 0, it takes nothing to add this.</span></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Scale == 0)</span></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we already have a scale of this value, we can add to it, otherwise, we</span></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// need an available scale field.</span></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrMode.Scale != 0 &amp;&amp; AddrMode.ScaledReg != ScaleReg)</span></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><span class="doxyHighlight">  ExtAddrMode TestAddrMode = AddrMode;</span></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add scale to turn X&#42;4+X&#42;3 -&gt; X&#42;7.  This could also do things like</span></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#91;A+B + A&#42;7&#93; -&gt; &#91;B+A&#42;8&#93;.</span></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><span class="doxyHighlight">  TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a> += Scale;</span></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><span class="doxyHighlight">  TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = ScaleReg;</span></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the new address isn&#39;t legal, bail out.</span></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI.isLegalAddressingMode(DL, TestAddrMode, AccessTy, AddrSpace))</span></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It was legal, so commit it.</span></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><span class="doxyHighlight">  AddrMode = TestAddrMode;</span></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we decided that we can add ScaleReg+Scale to AddrMode.  Check now</span></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to see if ScaleReg is actually X+C.  If so, we can turn this into adding</span></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// X&#42;Scale + C&#42;Scale to addr mode. If we found available IV increment, do not</span></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// go any further: we can reuse it and cannot eliminate it.</span></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><span class="doxyHighlight">  ConstantInt &#42;CI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AddLHS = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(ScaleReg) &amp;&amp; </span><span class="doxyHighlightComment">// not a constant expr.</span></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScaleReg, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(AddLHS), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(CI))) &amp;&amp;</span></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><span class="doxyHighlight">      !<a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(ScaleReg, &amp;LI) &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a87d50d10274efe9688166584391ae489">isSignedIntN</a>(64)) &#123;</span></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"><span class="doxyHighlight">    TestAddrMode.InBounds = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><span class="doxyHighlight">    TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = AddLHS;</span></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"><span class="doxyHighlight">    TestAddrMode.BaseOffs += CI-&gt;<a href="/docs/api/classes/llvm/constantint/#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>() &#42; TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#ae20bc007be03337ee451abb60d74260b">Scale</a>;</span></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this addressing mode is legal, commit it and remember that we folded</span></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this instruction.</span></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.isLegalAddressingMode(DL, TestAddrMode, AccessTy, AddrSpace)) &#123;</span></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><span class="doxyHighlight">      AddrModeInsts.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ScaleReg));</span></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><span class="doxyHighlight">      AddrMode = TestAddrMode;</span></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Restore status quo.</span></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><span class="doxyHighlight">    TestAddrMode = AddrMode;</span></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is an add recurrence with a constant step, return the increment</span></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction and the canonicalized step.</span></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetConstantStep =</span></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>) -&gt; std::optional&lt;std::pair&lt;Instruction &#42;, APInt&gt;&gt; &#123;</span></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V);</span></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN)</span></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IVInc = <a href="#a50cfddd4c98e75ef287c16996698dc1c">getIVIncrement</a>(PN, &amp;LI);</span></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IVInc)</span></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: The result of the intrinsics above is two-complement. However when</span></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// IV inc is expressed as add or sub, iv.next is potentially a poison value.</span></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If it has nuw or nsw flags, we need to make sure that these flags are</span></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// inferrable at the point of memory instruction. Otherwise we are replacing</span></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// well-defined two-complement computation with poison. Currently, to avoid</span></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// potentially complex analysis needed to prove this, we reject such cases.</span></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OIVInc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(IVInc-&gt;first))</span></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OIVInc-&gt;hasNoSignedWrap() || OIVInc-&gt;hasNoUnsignedWrap())</span></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ConstantStep = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(IVInc-&gt;second))</span></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::make&#95;pair(IVInc-&gt;first, ConstantStep-&gt;getValue());</span></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to account for the following special case:</span></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 ScaleReg is an inductive variable;</span></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 We use it with non-zero offset;</span></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3 IV&#39;s increment is available at the point of memory instruction.</span></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In this case, we may reuse the IV increment instead of the IV Phi to</span></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// achieve the following advantages:</span></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 If IV step matches the offset, we will have no need in the offset;</span></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 Even if they don&#39;t match, we will reduce the overlap of living IV</span></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    and IV increment, that will potentially lead to better register</span></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    assignment.</span></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrMode.BaseOffs) &#123;</span></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IVStep = GetConstantStep(ScaleReg)) &#123;</span></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;IVInc = IVStep-&gt;first;</span></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The following assert is important to ensure a lack of infinite loops.</span></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This transforms is (intentionally) the inverse of the one just above.</span></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If they don&#39;t agree on the definition of an increment, we&#39;d alternate</span></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// back and forth indefinitely.</span></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(IVInc, &amp;LI) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;implied by GetConstantStep&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><span class="doxyHighlight">      APInt Step = IVStep-&gt;second;</span></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><span class="doxyHighlight">      APInt <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = Step &#42; AddrMode.Scale;</span></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.isSignedIntN(64)) &#123;</span></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><span class="doxyHighlight">        TestAddrMode.InBounds = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><span class="doxyHighlight">        TestAddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = IVInc;</span></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><span class="doxyHighlight">        TestAddrMode.BaseOffs -= <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getLimitedValue();</span></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this addressing mode is legal, commit it..</span></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// (Note that we defer the (expensive) domtree base legality check</span></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to the very last possible point.)</span></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.isLegalAddressingMode(DL, TestAddrMode, AccessTy, AddrSpace) &amp;&amp;</span></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><span class="doxyHighlight">            getDTFn().<a href="/docs/api/files/lib/lib/codegen/regallocfast-cpp/#a73ba38b119a12eb092295458fde44f52">dominates</a>(IVInc, MemoryInst)) &#123;</span></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><span class="doxyHighlight">          AddrModeInsts.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(IVInc));</span></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><span class="doxyHighlight">          AddrMode = TestAddrMode;</span></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Restore status quo.</span></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><span class="doxyHighlight">        TestAddrMode = AddrMode;</span></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, just return what we have.</span></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><span class="doxyHighlightComment">/// This is a little filter, which returns true if an addressing computation</span></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><span class="doxyHighlightComment">/// involving I might be folded into a load/store accessing it.</span></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><span class="doxyHighlightComment">/// This doesn&#39;t need to be perfect, but needs to accept at least</span></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><span class="doxyHighlightComment">/// the set of instructions that MatchOperationAddr can.</span></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621" lineLink="#a9d0372d5a469c089a4f2a299dd679558"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::BitCast:</span></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AddrSpaceCast:</span></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t touch identity bitcasts.</span></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType())</span></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isIntOrPtrTy();</span></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PtrToInt:</span></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PtrToInt is always a noop, as we know that the int type is pointer sized.</span></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::IntToPtr:</span></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We know the input is intptr&#95;t, so this is foldable.</span></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl:</span></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can only handle X&#42;C and X &lt;&lt; C.</span></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::GetElementPtr:</span></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"><span class="doxyHighlightComment">/// Check whether or not \\p Val is a legal instruction for \\p TLI.</span></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649"><span class="doxyHighlightComment">/// \\note \\p Val is assumed to be the product of some type promotion.</span></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"><span class="doxyHighlightComment">/// Therefore if \\p Val has an undefined state in \\p TLI, this is assumed</span></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"><span class="doxyHighlightComment">/// to be legal, as the non-promoted value would have had the same state.</span></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652" lineLink="#aca87c42e8556b7f2e73454d63efa87f2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val) &#123;</span></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PromotedInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Val);</span></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PromotedInst)</span></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ISDOpcode = TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a025e6664b2f55d2c217543c34eb1f64e">InstructionOpcodeToISD</a>(PromotedInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</span></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the ISDOpcode is undefined, it was undefined before the promotion.</span></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ISDOpcode)</span></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, check if the promoted instruction is legal or not.</span></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(</span></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><span class="doxyHighlight">      ISDOpcode, TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, PromotedInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667"></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><span class="doxyHighlightComment">/// Hepler class to perform type promotion.</span></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper">TypePromotionHelper</a> &#123;</span></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"><span class="doxyHighlightComment">  /// Utility function to add a promoted instruction \\p ExtOpnd to</span></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><span class="doxyHighlightComment">  /// \\p PromotedInsts and record the type of extension we have seen.</span></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addPromotedInst(<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</span></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExtOpnd, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt) &#123;</span></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> ExtTy = IsSExt ? <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de">SignExtension</a> : <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8">ZeroExtension</a>;</span></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemapbase/#a214e872d61db2ea8cb023f127cafd0b9">InstrToOrigTy::iterator</a> It = PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(ExtOpnd);</span></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It != PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the new extension is same as original, the information in</span></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// PromotedInsts&#91;ExtOpnd&#93; is still correct.</span></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It-&gt;second.getInt() == ExtTy)</span></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Now the new extension is different from old extension, we make</span></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the type information invalid by setting extension type to</span></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BothExtension.</span></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><span class="doxyHighlight">      ExtTy = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fad4ce99b4684baf70c4310e9a2ae58597">BothExtension</a>;</span></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"><span class="doxyHighlight">    PromotedInsts&#91;ExtOpnd&#93; = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a17cdfc9d4da684f5f8b3c97c8706c28e">TypeIsSExt</a>(ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), ExtTy);</span></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"><span class="doxyHighlightComment">  /// Utility function to query the original type of instruction \\p Opnd</span></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"><span class="doxyHighlightComment">  /// with a matched extension type. If the extension doesn&#39;t match, we</span></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><span class="doxyHighlightComment">  /// cannot use the information we had on the original type.</span></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><span class="doxyHighlightComment">  /// BothExtension doesn&#39;t match any extension type.</span></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;getOrigType(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</span></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Opnd, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt) &#123;</span></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> ExtTy = IsSExt ? <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fa1949442a87c56a1a0b8f222cd05a90de">SignExtension</a> : <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164fac919a1736e4da3724d0461cf7bb1dee8">ZeroExtension</a>;</span></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemapbase/#a5784c312872bef21d9344dae0a0e8fc0">InstrToOrigTy::const&#95;iterator</a> It = PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Opnd);</span></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It != PromotedInsts.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; It-&gt;second.getInt() == ExtTy)</span></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It-&gt;second.getPointer();</span></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"><span class="doxyHighlightComment">  /// Utility function to check whether or not a sign or zero extension</span></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"><span class="doxyHighlightComment">  /// of \\p Inst with \\p ConsideredExtType can be moved through \\p Inst by</span></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><span class="doxyHighlightComment">  /// either using the operands of \\p Inst or promoting \\p Inst.</span></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"><span class="doxyHighlightComment">  /// The type of the extension is defined by \\p IsSExt.</span></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><span class="doxyHighlightComment">  /// In other words, check if:</span></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"><span class="doxyHighlightComment">  /// ext (Ty Inst opnd1 opnd2 ... opndN) to ConsideredExtType.</span></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><span class="doxyHighlightComment">  /// #1 Promotion applies:</span></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"><span class="doxyHighlightComment">  /// ConsideredExtType Inst (ext opnd1 to ConsideredExtType, ...).</span></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711"><span class="doxyHighlightComment">  /// #2 Operand reuses:</span></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712"><span class="doxyHighlightComment">  /// ext opnd1 to ConsideredExtType.</span></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><span class="doxyHighlightComment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</span></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canGetThrough(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ConsideredExtType,</span></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt);</span></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><span class="doxyHighlightComment">  /// Utility function to determine if \\p OpIdx should be promoted when</span></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><span class="doxyHighlightComment">  /// promoting \\p Inst.</span></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> shouldExtOperand(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> OpIdx) &#123;</span></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(Inst) &amp;&amp; OpIdx == 0);</span></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722"></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><span class="doxyHighlightComment">  /// Utility function to promote the operand of \\p Ext when this</span></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><span class="doxyHighlightComment">  /// operand is a promotable trunc or sext or zext.</span></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"><span class="doxyHighlightComment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</span></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><span class="doxyHighlightComment">  /// \\p CreatedInstsCost&#91;out&#93; contains the cost of all instructions</span></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"><span class="doxyHighlightComment">  /// created to promote the operand of Ext.</span></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><span class="doxyHighlightComment">  /// Newly added extensions are inserted in \\p Exts.</span></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"><span class="doxyHighlightComment">  /// Newly added truncates are inserted in \\p Truncs.</span></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><span class="doxyHighlightComment">  /// Should never be called directly.</span></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><span class="doxyHighlightComment">  /// \\return The promoted value which is used instead of Ext.</span></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;promoteOperandForTruncAndAnyExt(</span></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CreatedInstsCost,</span></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</span></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI);</span></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"><span class="doxyHighlightComment">  /// Utility function to promote the operand of \\p Ext when this</span></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"><span class="doxyHighlightComment">  /// operand is promotable and is not a supported trunc or sext.</span></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><span class="doxyHighlightComment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</span></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"><span class="doxyHighlightComment">  /// \\p CreatedInstsCost&#91;out&#93; contains the cost of all the instructions</span></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"><span class="doxyHighlightComment">  /// created to promote the operand of Ext.</span></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><span class="doxyHighlightComment">  /// Newly added extensions are inserted in \\p Exts.</span></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"><span class="doxyHighlightComment">  /// Newly added truncates are inserted in \\p Truncs.</span></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><span class="doxyHighlightComment">  /// Should never be called directly.</span></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"><span class="doxyHighlightComment">  /// \\return The promoted value which is used instead of Ext.</span></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;promoteOperandForOther(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext,</span></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"><span class="doxyHighlight">                                       <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><span class="doxyHighlight">                                       <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</span></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CreatedInstsCost,</span></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</span></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs,</span></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt);</span></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><span class="doxyHighlightComment">  /// \\see promoteOperandForOther.</span></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;signExtendOperandForOther(</span></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CreatedInstsCost,</span></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</span></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> promoteOperandForOther(Ext, TPT, PromotedInsts, CreatedInstsCost,</span></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><span class="doxyHighlight">                                  Exts, Truncs, TLI, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><span class="doxyHighlightComment">  /// \\see promoteOperandForOther.</span></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;zeroExtendOperandForOther(</span></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CreatedInstsCost,</span></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</span></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> promoteOperandForOther(Ext, TPT, PromotedInsts, CreatedInstsCost,</span></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><span class="doxyHighlight">                                  Exts, Truncs, TLI, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><span class="doxyHighlightComment">  /// Type for the utility function that promotes the operand of Ext.</span></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">Action</a> = <a href="/docs/api/classes/llvm/value">Value</a> &#42;(&#42;)(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"><span class="doxyHighlight">                            <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</span></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CreatedInstsCost,</span></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</span></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs,</span></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI);</span></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"><span class="doxyHighlightComment">  /// Given a sign/zero extend instruction \\p Ext, return the appropriate</span></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"><span class="doxyHighlightComment">  /// action to promote the operand of \\p Ext instead of using Ext.</span></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786"><span class="doxyHighlightComment">  /// \\return NULL if no promotable action is possible with the current</span></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><span class="doxyHighlightComment">  /// sign extension.</span></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"><span class="doxyHighlightComment">  /// \\p InsertedInsts keeps track of all the instructions inserted by the</span></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><span class="doxyHighlightComment">  /// other CodeGenPrepare optimizations. This information is important</span></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"><span class="doxyHighlightComment">  /// because we do not want to promote these instructions as CodeGenPrepare</span></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"><span class="doxyHighlightComment">  /// will reinsert them later. Thus creating an infinite loop: create/remove.</span></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"><span class="doxyHighlightComment">  /// \\p PromotedInsts maps the instructions to their type before promotion.</span></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">Action</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">getAction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts,</span></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts);</span></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TypePromotionHelper::canGetThrough(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</span></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/type">Type</a> &#42;ConsideredExtType,</span></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts,</span></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt) &#123;</span></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The promotion helper does not know how to deal with vector types yet.</span></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// To be able to fix that, we would need to fix the places where we</span></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// statically extend, e.g., constants and such.</span></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</span></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can always get through zext.</span></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Inst))</span></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sext(sext) is ok too.</span></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSExt &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Inst))</span></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817"></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can get through binary operator, if it is legal. In other words, the</span></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// binary operator must have a nuw or nsw flag.</span></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(Inst))</span></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;OverflowingBinaryOperator&gt;</a>(BinOp) &amp;&amp;</span></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"><span class="doxyHighlight">        ((!IsSExt &amp;&amp; BinOp-&gt;hasNoUnsignedWrap()) ||</span></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><span class="doxyHighlight">         (IsSExt &amp;&amp; BinOp-&gt;hasNoSignedWrap())))</span></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ext(and(opnd, cst)) --&gt; and(ext(opnd), ext(cst))</span></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::And ||</span></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"><span class="doxyHighlight">       Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Or))</span></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ext(xor(opnd, cst)) --&gt; xor(ext(opnd), ext(cst))</span></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Xor) &#123;</span></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure it is not a NOT.</span></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</span></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cst-&gt;getValue().isAllOnes())</span></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// zext(shrl(opnd, cst)) --&gt; shrl(zext(opnd), zext(cst))</span></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It may change a poisoned value into a regular value, like</span></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     zext i32 (shrl i8 %val, 12)  --&gt;  shrl i32 (zext i8 %val), 12</span></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//          poisoned value                    regular value</span></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It should be OK since undef covers valid value.</span></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::LShr &amp;&amp; !IsSExt)</span></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and(ext(shl(opnd, cst)), cst) --&gt; and(shl(ext(opnd), ext(cst)), cst)</span></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It may change a poisoned value into a regular value, like</span></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     zext i32 (shl i8 %val, 12)  --&gt;  shl i32 (zext i8 %val), 12</span></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//          poisoned value                    regular value</span></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It should be OK since undef covers valid value.</span></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Shl &amp;&amp; Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExtInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;const Instruction&gt;</a>(&#42;Inst-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>());</span></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtInst-&gt;hasOneUse()) &#123;</span></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AndInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;const Instruction&gt;</a>(&#42;ExtInst-&gt;user&#95;begin());</span></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AndInst &amp;&amp; AndInst-&gt;getOpcode() == Instruction::And) &#123;</span></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AndInst-&gt;getOperand(1));</span></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cst &amp;&amp;</span></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"><span class="doxyHighlight">            Cst-&gt;getValue().isIntN(Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()))</span></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864"></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if we can do the following simplification.</span></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ext(trunc(opnd)) --&gt; ext(opnd)</span></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Inst))</span></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OpndVal = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if we can use this operand in the extension.</span></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the type is larger than the result type of the extension, we cannot.</span></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OpndVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><span class="doxyHighlight">      OpndVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;</span></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><span class="doxyHighlight">          ConsideredExtType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>())</span></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the operand of the truncate is not an instruction, we will not have</span></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any information on the dropped bits.</span></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (Actually we could for constant but it is not worth the extra logic).</span></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;Opnd = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(OpndVal);</span></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Opnd)</span></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the source of the type is narrow enough.</span></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// I.e., check that trunc just drops extended bits of the same kind of</span></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the extension.</span></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// #1 get the type of the operand and check the kind of the extended bits.</span></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;OpndType = getOrigType(PromotedInsts, Opnd, IsSExt);</span></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpndType)</span></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"><span class="doxyHighlight">    ;</span></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((IsSExt &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Opnd)) || (!IsSExt &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Opnd)))</span></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><span class="doxyHighlight">    OpndType = Opnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// #2 check that the truncate just drops extended bits.</span></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;=</span></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"><span class="doxyHighlight">         OpndType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>();</span></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">TypePromotionHelper::Action</a> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">TypePromotionHelper::getAction</a>(</span></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;InsertedInsts,</span></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts) &#123;</span></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Ext) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Ext)) &amp;&amp;</span></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected instruction type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExtOpnd = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Ext-&gt;getOperand(0));</span></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ExtTy = Ext-&gt;getType();</span></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Ext);</span></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the operand of the extension is not an instruction, we cannot</span></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// get through.</span></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it, check we can get through.</span></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExtOpnd || !canGetThrough(ExtOpnd, ExtTy, PromotedInsts, IsSExt))</span></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not promote if the operand has been added by codegenprepare.</span></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, it means we are undoing an optimization that is likely to be</span></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// redone, thus causing potential infinite loop.</span></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(ExtOpnd) &amp;&amp; InsertedInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(ExtOpnd))</span></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SExt or Trunc instructions.</span></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return the related handler.</span></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(ExtOpnd) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(ExtOpnd) ||</span></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(ExtOpnd))</span></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> promoteOperandForTruncAndAnyExt;</span></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Regular instruction.</span></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Abort early if we will have to insert non-free instructions.</span></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a6f992bc4ca89f1b5f0b34f5b29978c31">isTruncateFree</a>(ExtTy, ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</span></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsSExt ? signExtendOperandForOther : zeroExtendOperandForOther;</span></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;TypePromotionHelper::promoteOperandForTruncAndAnyExt(</span></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;SExt, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CreatedInstsCost,</span></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Exts,</span></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &#42;Truncs, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// By construction, the operand of SExt is an instruction. Otherwise we cannot</span></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// get through it and this method should not be called.</span></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;SExtOpnd = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(SExt-&gt;getOperand(0));</span></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtVal = SExt;</span></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasMergedNonFreeExt = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(SExtOpnd)) &#123;</span></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace s|zext(zext(opnd))</span></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// =&gt; zext(opnd).</span></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"><span class="doxyHighlight">    HasMergedNonFreeExt = !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(SExtOpnd);</span></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ZExt =</span></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><span class="doxyHighlight">        TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a40e7a7b00ec46903a6a39e28b30da046">createZExt</a>(SExt, SExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), SExt-&gt;getType());</span></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"><span class="doxyHighlight">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ad7595fd2ce173a5034cbc5f2376978e6">replaceAllUsesWith</a>(SExt, ZExt);</span></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><span class="doxyHighlight">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">eraseInstruction</a>(SExt);</span></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><span class="doxyHighlight">    ExtVal = ZExt;</span></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace z|sext(trunc(opnd)) or sext(sext(opnd))</span></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// =&gt; z|sext(opnd).</span></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><span class="doxyHighlight">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a5a651fca694e060abd7d17d6cf34fe51">setOperand</a>(SExt, 0, SExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"><span class="doxyHighlight">  CreatedInstsCost = 0;</span></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove dead code.</span></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><span class="doxyHighlight">    TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">eraseInstruction</a>(SExtOpnd);</span></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the extension is still needed.</span></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(ExtVal);</span></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExtInst || ExtInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != ExtInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</span></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtInst) &#123;</span></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Exts)</span></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><span class="doxyHighlight">        Exts-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ExtInst);</span></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"><span class="doxyHighlight">      CreatedInstsCost = !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(ExtInst) &amp;&amp; !HasMergedNonFreeExt;</span></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ExtVal;</span></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point we have: ext ty opnd to ty.</span></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reassign the uses of ExtInst to the opnd and remove ExtInst.</span></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NextVal = ExtInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"><span class="doxyHighlight">  TPT.<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#a6057042016e6c71b9df4b820eed07a0a">eraseInstruction</a>(ExtInst, NextVal);</span></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NextVal;</span></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TypePromotionHelper::promoteOperandForOther(</span></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><span class="doxyHighlight">    Instruction &#42;Ext, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a71622f7f81af67784beaf8b1420aa76d">InstrToOrigTy</a> &amp;PromotedInsts, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CreatedInstsCost,</span></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"><span class="doxyHighlight">    SmallVectorImpl&lt;Instruction &#42;&gt; &#42;Exts,</span></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"><span class="doxyHighlight">    SmallVectorImpl&lt;Instruction &#42;&gt; &#42;Truncs, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetLowering &amp;TLI,</span></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt) &#123;</span></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// By construction, the operand of Ext is an instruction. Otherwise we cannot</span></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// get through it and this method should not be called.</span></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtOpnd = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><span class="doxyHighlight">  CreatedInstsCost = 0;</span></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ExtOpnd will be promoted.</span></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All its uses, but Ext, will need to use a truncated value of the</span></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// promoted version.</span></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create the truncate now.</span></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Trunc = TPT.createTrunc(Ext, ExtOpnd-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;ITrunc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Trunc)) &#123;</span></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Insert it just after the definition.</span></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"><span class="doxyHighlight">      ITrunc-&gt;moveAfter(ExtOpnd);</span></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Truncs)</span></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><span class="doxyHighlight">        Truncs-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ITrunc);</span></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><span class="doxyHighlight">    TPT.replaceAllUsesWith(ExtOpnd, Trunc);</span></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Restore the operand of Ext (which has been replaced by the previous call</span></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to replaceAllUsesWith) to avoid creating a cycle trunc &lt;-&gt; sext.</span></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><span class="doxyHighlight">    TPT.setOperand(Ext, 0, ExtOpnd);</span></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get through the Instruction:</span></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 Update its type.</span></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 Replace the uses of Ext by Inst.</span></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3 Extend each operand that needs to be extended.</span></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remember the original type of the instruction before promotion.</span></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is useful to know that the high bits are sign extended bits.</span></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"><span class="doxyHighlight">  addPromotedInst(PromotedInsts, ExtOpnd, IsSExt);</span></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step #1.</span></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"><span class="doxyHighlight">  TPT.mutateType(ExtOpnd, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType());</span></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step #2.</span></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023"><span class="doxyHighlight">  TPT.replaceAllUsesWith(Ext, ExtOpnd);</span></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step #3.</span></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Propagate Ext to operands\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> OpIdx = 0, EndOpIdx = ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); OpIdx != EndOpIdx;</span></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"><span class="doxyHighlight">       ++OpIdx) &#123;</span></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Operand:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;(ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OpIdx)) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OpIdx)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType() ||</span></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"><span class="doxyHighlight">        !shouldExtOperand(ExtOpnd, OpIdx)) &#123;</span></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;No need to propagate\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if we can statically extend the operand.</span></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Opnd = ExtOpnd-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OpIdx);</span></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ConstantInt &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Opnd)) &#123;</span></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Statically extend\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType()-&gt;getIntegerBitWidth();</span></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039"><span class="doxyHighlight">      APInt CstVal = IsSExt ? Cst-&gt;getValue().sext(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)</span></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><span class="doxyHighlight">                            : Cst-&gt;getValue().zext(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>);</span></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"><span class="doxyHighlight">      TPT.setOperand(ExtOpnd, OpIdx, ConstantInt::get(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType(), CstVal));</span></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// UndefValue are typed, so we have to statically sign extend them.</span></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Opnd)) &#123;</span></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Statically extend\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><span class="doxyHighlight">      TPT.setOperand(ExtOpnd, OpIdx, <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType()));</span></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise we have to explicitly sign extend the operand.</span></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ValForExtOpnd = IsSExt</span></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"><span class="doxyHighlight">                               ? TPT.createSExt(ExtOpnd, Opnd, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType())</span></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><span class="doxyHighlight">                               : TPT.createZExt(ExtOpnd, Opnd, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType());</span></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"><span class="doxyHighlight">    TPT.setOperand(ExtOpnd, OpIdx, ValForExtOpnd);</span></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;InstForExtOpnd = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(ValForExtOpnd);</span></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InstForExtOpnd)</span></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Exts)</span></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"><span class="doxyHighlight">      Exts-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(InstForExtOpnd);</span></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><span class="doxyHighlight">    CreatedInstsCost += !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(InstForExtOpnd);</span></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Extension is useless now\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><span class="doxyHighlight">  TPT.eraseInstruction(Ext);</span></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ExtOpnd;</span></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><span class="doxyHighlightComment">/// Check whether or not promoting an instruction to a wider type is profitable.</span></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"><span class="doxyHighlightComment">/// \\p NewCost gives the cost of extension instructions created by the</span></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"><span class="doxyHighlightComment">/// promotion.</span></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><span class="doxyHighlightComment">/// \\p OldCost gives the cost of extension instructions before the promotion</span></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><span class="doxyHighlightComment">/// plus the number of instructions that have been</span></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><span class="doxyHighlightComment">/// matched in the addressing mode the promotion.</span></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><span class="doxyHighlightComment">/// \\p PromotedOperand is the value that has been promoted.</span></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"><span class="doxyHighlightComment">/// \\return True if the promotion is profitable, false otherwise.</span></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddressingModeMatcher::isPromotionProfitable(</span></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewCost, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldCost, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PromotedOperand)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;OldCost: &quot;</span><span class="doxyHighlight"> &lt;&lt; OldCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tNewCost: &quot;</span><span class="doxyHighlight"> &lt;&lt; NewCost</span></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The cost of the new extensions is greater than the cost of the</span></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// old extension plus what we folded.</span></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is not profitable.</span></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewCost &gt; OldCost)</span></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewCost &lt; OldCost)</span></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The promotion is neutral but it may help folding the sign extension in</span></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loads for instance.</span></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that we did not create an illegal instruction.</span></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(TLI, DL, PromotedOperand);</span></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><span class="doxyHighlightComment">/// Given an instruction or constant expr, see if we can fold the operation</span></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"><span class="doxyHighlightComment">/// into the addressing mode. If so, update the addressing mode and return</span></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><span class="doxyHighlightComment">/// true, otherwise return false without modifying AddrMode.</span></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"><span class="doxyHighlightComment">/// If \\p MovedAway is not NULL, it contains the information of whether or</span></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"><span class="doxyHighlightComment">/// not AddrInst has to be folded into the addressing mode on success.</span></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"><span class="doxyHighlightComment">/// If \\p MovedAway == true, \\p AddrInst will not be part of the addressing</span></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><span class="doxyHighlightComment">/// because it has been moved away.</span></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><span class="doxyHighlightComment">/// Thus AddrInst must not be added in the matched instructions.</span></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><span class="doxyHighlightComment">/// This state can happen when AddrInst is a sext, since it may be moved away.</span></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"><span class="doxyHighlightComment">/// Therefore, AddrInst may not be valid when MovedAway is true and it must</span></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><span class="doxyHighlightComment">/// not be referenced anymore.</span></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddressingModeMatcher::matchOperationAddr(User &#42;AddrInst, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode,</span></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</span></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#42;MovedAway) &#123;</span></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid exponential behavior on extremely deep expression trees.</span></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt;= 5)</span></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// By default, all matched instructions stay in place.</span></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MovedAway)</span></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"><span class="doxyHighlight">    &#42;MovedAway = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Opcode) &#123;</span></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PtrToInt:</span></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PtrToInt is always a noop, as we know that the int type is pointer sized.</span></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::IntToPtr: &#123;</span></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AS = AddrInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PtrTy = <a href="/docs/api/classes/llvm/mvt/#aded931e298cfa08b5038ca2b63c06bb8">MVT::getIntegerVT</a>(DL.getPointerSizeInBits(AS));</span></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This inttoptr is a no-op if the integer type is pointer sized.</span></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.getValueType(DL, AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) == PtrTy)</span></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::BitCast:</span></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BitCast is always a noop, and we can handle it as long as it is</span></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// int-&gt;int or pointer-&gt;pointer (we don&#39;t want int&lt;-&gt;fp or something).</span></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#abf313eff420b7c6c8e322a2e9c53cd90">isIntOrPtrTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Don&#39;t touch identity bitcasts.  These were probably put here by LSR,</span></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// and we don&#39;t want to mess around with them.  Assume it knows what it</span></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// is doing.</span></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><span class="doxyHighlight">        AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != AddrInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AddrSpaceCast: &#123;</span></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcAS =</span></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"><span class="doxyHighlight">        AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestAS = AddrInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.getTargetMachine().isNoopAddrSpaceCast(SrcAS, DestAS))</span></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add: &#123;</span></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check to see if we can merge in one operand, then the other.  If so, we</span></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// win.</span></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><span class="doxyHighlight">    ExtAddrMode BackupAddrMode = AddrMode;</span></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldSize = AddrModeInsts.size();</span></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Start a transaction at this point.</span></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The LHS may match but not the RHS.</span></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Therefore, we need a higher level restoration point to undo partially</span></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// matched operation.</span></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</span></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><span class="doxyHighlight">        TPT.getRestorationPoint();</span></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to match an integer constant second to increase its chance of ending</span></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// up in &#96;BaseOffs&#96;, resp. decrease its chance of ending up in &#96;BaseReg&#96;.</span></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a> = 0, Second = 1;</span></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>))</span></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><span class="doxyHighlight">      &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Second)))</span></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"><span class="doxyHighlight">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>, Second);</span></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"><span class="doxyHighlight">    AddrMode.InBounds = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1) &amp;&amp;</span></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"><span class="doxyHighlight">        matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Second), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</span></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169"></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Restore the old addr mode info.</span></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"><span class="doxyHighlight">    AddrMode = BackupAddrMode;</span></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"><span class="doxyHighlight">    AddrModeInsts.resize(OldSize);</span></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><span class="doxyHighlight">    TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise this was over-aggressive.  Try merging operands in the opposite</span></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// order.</span></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(Second), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1) &amp;&amp;</span></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><span class="doxyHighlight">        matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</span></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise we definitely can&#39;t merge the ADD in.</span></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"><span class="doxyHighlight">    AddrMode = BackupAddrMode;</span></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"><span class="doxyHighlight">    AddrModeInsts.resize(OldSize);</span></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"><span class="doxyHighlight">    TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case Instruction::Or:</span></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  TODO: We can handle &quot;Or Val, Imm&quot; iff this OR is equivalent to an ADD.</span></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// break;</span></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl: &#123;</span></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can only handle X&#42;C and X &lt;&lt; C.</span></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><span class="doxyHighlight">    AddrMode.InBounds = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"><span class="doxyHighlight">    ConstantInt &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> || <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getBitWidth() &gt; 64)</span></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"><span class="doxyHighlight">    int64&#95;t Scale = Opcode == Instruction::Shl</span></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"><span class="doxyHighlight">                        ? 1LL &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getLimitedValue(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getBitWidth() - 1)</span></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"><span class="doxyHighlight">                        : <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getSExtValue();</span></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> matchScaledValue(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Scale, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::GetElementPtr: &#123;</span></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scan the GEP.  We check it if it contains constant offsets and at most</span></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// one variable offset.</span></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> VariableOperand = -1;</span></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> VariableScale = 0;</span></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"><span class="doxyHighlight">    int64&#95;t ConstantOffset = 0;</span></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a81c0916829c13ba5279ca0e5480aef0c">gep&#95;type&#95;iterator</a> GTI = <a href="/docs/api/namespaces/llvm/#ac828b9b52935f87659a4adf237f820a3">gep&#95;type&#95;begin</a>(AddrInst);</span></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1, e = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); i != e; ++i, ++GTI) &#123;</span></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StructType &#42;STy = GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#a5a2edfe3b8475d07b1088799fd2df172">getStructTypeOrNull</a>()) &#123;</span></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> StructLayout &#42;SL = DL.getStructLayout(STy);</span></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx =</span></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(i))-&gt;getZExtValue();</span></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"><span class="doxyHighlight">        ConstantOffset += SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a3932cc53acb297750961bfdaa86425bc">getElementOffset</a>(Idx);</span></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><span class="doxyHighlight">        TypeSize TS = GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#ae3d47d990ab77e9659cc0fc35c9353de">getSequentialElementStride</a>(DL);</span></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TS.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a5cafb166cf7c4937f5647a084c4eaee2">isNonZero</a>()) &#123;</span></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// The optimisations below currently only work for fixed offsets.</span></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TS.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"><span class="doxyHighlight">          int64&#95;t TypeSize = TS.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</span></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ConstantInt &#42;CI =</span></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"><span class="doxyHighlight">                  <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(i))) &#123;</span></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> APInt &amp;CVal = CI-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>();</span></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CVal.<a href="/docs/api/classes/llvm/apint/#a9f78d7e839322a6bfc0c665d29052242">getSignificantBits</a>() &lt;= 64) &#123;</span></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"><span class="doxyHighlight">              ConstantOffset += CVal.<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>() &#42; TypeSize;</span></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// We only allow one variable index at the moment.</span></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VariableOperand != -1)</span></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Remember the variable index.</span></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"><span class="doxyHighlight">          VariableOperand = i;</span></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"><span class="doxyHighlight">          VariableScale = TypeSize;</span></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242"></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A common case is for the GEP to only do a constant offset.  In this case,</span></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// just add it to the disp field and check validity.</span></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VariableOperand == -1) &#123;</span></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"><span class="doxyHighlight">      AddrMode.BaseOffs += ConstantOffset;</span></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1)) &#123;</span></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(AddrInst)-&gt;isInBounds())</span></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><span class="doxyHighlight">            AddrMode.InBounds = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"><span class="doxyHighlight">      AddrMode.BaseOffs -= ConstantOffset;</span></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa139a070bbd3c66bb6fd2dbdee1dd893">EnableGEPOffsetSplit</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(AddrInst) &amp;&amp;</span></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><span class="doxyHighlight">          TLI.shouldConsiderGEPOffsetSplit() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> == 0 &amp;&amp;</span></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><span class="doxyHighlight">          ConstantOffset &gt; 0) &#123;</span></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Record GEPs with non-zero offsets as candidates for splitting in</span></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// the event that the offset cannot fit into the r+i addressing mode.</span></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Simple and common case that only one GEP is used in calculating the</span></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// address for the memory access.</span></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BaseI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</span></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(AddrInst);</span></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) ||</span></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><span class="doxyHighlight">              (BaseI &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CastInst&gt;</a>(BaseI) &amp;&amp;</span></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><span class="doxyHighlight">               !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(BaseI))) &#123;</span></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Make sure the parent block allows inserting non-PHI instructions</span></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// before the terminator.</span></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Parent = BaseI ? BaseI-&gt;getParent()</span></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"><span class="doxyHighlight">                                       : &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getFunction()-&gt;getEntryBlock();</span></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Parent-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a5d3d315f678bc76e43b27d18e5d72829">isEHPad</a>())</span></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"><span class="doxyHighlight">            LargeOffsetGEP = std::make&#95;pair(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, ConstantOffset);</span></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the valid addressing mode in case we can&#39;t match.</span></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><span class="doxyHighlight">    ExtAddrMode BackupAddrMode = AddrMode;</span></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldSize = AddrModeInsts.size();</span></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// See if the scale and offset amount is valid for this target.</span></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><span class="doxyHighlight">    AddrMode.BaseOffs += ConstantOffset;</span></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(AddrInst)-&gt;isInBounds())</span></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><span class="doxyHighlight">      AddrMode.InBounds = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Match the base operand of the GEP.</span></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1)) &#123;</span></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If it couldn&#39;t be matched, just stuff the value in a register.</span></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrMode.HasBaseReg) &#123;</span></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><span class="doxyHighlight">        AddrMode = BackupAddrMode;</span></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"><span class="doxyHighlight">        AddrModeInsts.resize(OldSize);</span></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><span class="doxyHighlight">      AddrMode.HasBaseReg = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"><span class="doxyHighlight">      AddrMode.BaseReg = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Match the remaining variable portion of the GEP.</span></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!matchScaledValue(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(VariableOperand), VariableScale,</span></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) &#123;</span></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If it couldn&#39;t be matched, try stuffing the base into a register</span></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instead of matching it, and retrying the match of the scale.</span></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><span class="doxyHighlight">      AddrMode = BackupAddrMode;</span></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306"><span class="doxyHighlight">      AddrModeInsts.resize(OldSize);</span></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrMode.HasBaseReg)</span></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><span class="doxyHighlight">      AddrMode.HasBaseReg = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"><span class="doxyHighlight">      AddrMode.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a> = AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311"><span class="doxyHighlight">      AddrMode.BaseOffs += ConstantOffset;</span></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!matchScaledValue(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(VariableOperand),</span></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"><span class="doxyHighlight">                            VariableScale, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) &#123;</span></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If even that didn&#39;t work, bail.</span></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><span class="doxyHighlight">        AddrMode = BackupAddrMode;</span></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><span class="doxyHighlight">        AddrModeInsts.resize(OldSize);</span></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SExt:</span></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ZExt: &#123;</span></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(AddrInst);</span></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ext)</span></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to move this ext out of the way of the addressing mode.</span></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ask for a method for doing so.</span></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">TypePromotionHelper::Action</a> TPH =</span></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">TypePromotionHelper::getAction</a>(Ext, InsertedInsts, TLI, PromotedInsts);</span></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TPH)</span></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</span></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><span class="doxyHighlight">        TPT.getRestorationPoint();</span></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CreatedInstsCost = 0;</span></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExtCost = !TLI.isExtFree(Ext);</span></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PromotedOperand =</span></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"><span class="doxyHighlight">        TPH(Ext, TPT, PromotedInsts, CreatedInstsCost, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, TLI);</span></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SExt has been moved away.</span></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Thus either it will be rematched later in the recursive calls or it is</span></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// gone. Anyway, we must not fold it into the addressing mode at this point.</span></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// E.g.,</span></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// op = add opnd, 1</span></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// idx = ext op</span></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// addr = gep base, idx</span></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is now:</span></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// promotedOpnd = ext opnd            &lt;- no match here</span></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// op = promoted&#95;add promotedOpnd, 1  &lt;- match (later in recursive calls)</span></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// addr = gep base, op                &lt;- match</span></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MovedAway)</span></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><span class="doxyHighlight">      &#42;MovedAway = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromotedOperand &amp;&amp;</span></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;TypePromotionHelper should have filtered out those cases&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><span class="doxyHighlight">    ExtAddrMode BackupAddrMode = AddrMode;</span></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldSize = AddrModeInsts.size();</span></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!matchAddr(PromotedOperand, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) ||</span></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The total of the new cost is equal to the cost of the created</span></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// instructions.</span></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The total of the old cost is equal to the cost of the extension plus</span></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// what we have saved in the addressing mode.</span></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367"><span class="doxyHighlight">        !isPromotionProfitable(CreatedInstsCost,</span></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><span class="doxyHighlight">                               ExtCost + (AddrModeInsts.size() - OldSize),</span></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><span class="doxyHighlight">                               PromotedOperand)) &#123;</span></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"><span class="doxyHighlight">      AddrMode = BackupAddrMode;</span></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><span class="doxyHighlight">      AddrModeInsts.resize(OldSize);</span></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sign extension does not pay off: rollback\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><span class="doxyHighlight">      TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SExt has been deleted. Make sure it is not referenced by the AddrMode.</span></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><span class="doxyHighlight">    AddrMode.replaceWith(Ext, PromotedOperand);</span></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Call:</span></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntrinsicInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(AddrInst)) &#123;</span></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::threadlocal&#95;address) &#123;</span></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"><span class="doxyHighlight">        GlobalValue &amp;GV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GlobalValue&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0));</span></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.addressingModeSupportsTLS(GV))</span></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> matchAddr(AddrInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</span></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><span class="doxyHighlightComment">/// If we can, try to add the value of &#39;Addr&#39; into the current addressing mode.</span></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"><span class="doxyHighlightComment">/// If Addr can&#39;t be added to AddrMode this returns false and leaves AddrMode</span></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><span class="doxyHighlightComment">/// unmodified. This assumes that Addr is either a pointer type or intptr&#95;t</span></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"><span class="doxyHighlightComment">/// for the target.</span></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddressingModeMatcher::matchAddr(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) &#123;</span></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start a transaction at this point that we will rollback if the matching</span></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fails.</span></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</span></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"><span class="doxyHighlight">      TPT.getRestorationPoint();</span></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ConstantInt &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Addr)) &#123;</span></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a87d50d10274efe9688166584391ae489">isSignedIntN</a>(64)) &#123;</span></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Fold in immediates if legal for the target.</span></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><span class="doxyHighlight">      AddrMode.BaseOffs += CI-&gt;<a href="/docs/api/classes/llvm/constantint/#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>();</span></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</span></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><span class="doxyHighlight">      AddrMode.BaseOffs -= CI-&gt;<a href="/docs/api/classes/llvm/constantint/#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>();</span></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GlobalValue &#42;GV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalValue&gt;</a>(Addr)) &#123;</span></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a global variable, try to fold it into the addressing mode.</span></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddrMode.BaseGV) &#123;</span></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"><span class="doxyHighlight">      AddrMode.BaseGV = GV;</span></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</span></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><span class="doxyHighlight">      AddrMode.BaseGV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Addr)) &#123;</span></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><span class="doxyHighlight">    ExtAddrMode BackupAddrMode = AddrMode;</span></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldSize = AddrModeInsts.size();</span></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check to see if it is possible to fold this operation.</span></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MovedAway = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (matchOperationAddr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>, &amp;MovedAway)) &#123;</span></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This instruction may have been moved away. If so, there is nothing</span></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to check here.</span></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MovedAway)</span></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Okay, it&#39;s possible to fold this.  Check to see if it is actually</span></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#42;profitable&#42; to do so.  We use a simple cost model to avoid increasing</span></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// register pressure too much.</span></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() ||</span></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><span class="doxyHighlight">          isProfitableToFoldIntoAddressingMode(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BackupAddrMode, AddrMode)) &#123;</span></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><span class="doxyHighlight">        AddrModeInsts.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// It isn&#39;t profitable to do this, roll back.</span></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"><span class="doxyHighlight">      AddrMode = BackupAddrMode;</span></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><span class="doxyHighlight">      AddrModeInsts.resize(OldSize);</span></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><span class="doxyHighlight">      TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ConstantExpr &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(Addr)) &#123;</span></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (matchOperationAddr(CE, <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getOpcode(), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</span></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><span class="doxyHighlight">    TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(Addr)) &#123;</span></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Null pointer gets folded without affecting the addressing mode.</span></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Worse case, the target should support &#91;reg&#93; addressing modes. :)</span></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddrMode.HasBaseReg) &#123;</span></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><span class="doxyHighlight">    AddrMode.HasBaseReg = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><span class="doxyHighlight">    AddrMode.BaseReg = Addr;</span></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Still check for legality in case the target supports &#91;imm&#93; but not &#91;i+r&#93;.</span></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</span></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><span class="doxyHighlight">    AddrMode.HasBaseReg = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><span class="doxyHighlight">    AddrMode.BaseReg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the base register is already taken, see if we can do &#91;r+r&#93;.</span></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrMode.Scale == 0) &#123;</span></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><span class="doxyHighlight">    AddrMode.Scale = 1;</span></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"><span class="doxyHighlight">    AddrMode.ScaledReg = Addr;</span></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.isLegalAddressingMode(DL, AddrMode, AccessTy, AddrSpace))</span></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><span class="doxyHighlight">    AddrMode.Scale = 0;</span></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"><span class="doxyHighlight">    AddrMode.ScaledReg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Couldn&#39;t match.</span></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"><span class="doxyHighlight">  TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"><span class="doxyHighlightComment">/// Check to see if all uses of OpVal by the specified inline asm call are due</span></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480"><span class="doxyHighlightComment">/// to memory operands. If so, return true, otherwise return false.</span></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481" lineLink="#a86026627b644e50527898aad0747b3e5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/inlineasm">InlineAsm</a> &#42;IA, <a href="/docs/api/classes/llvm/value">Value</a> &#42;OpVal,</span></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) &#123;</span></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</span></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetlowering/#a3db162658a7687e8a5df34f5a6aaa840">TargetLowering::AsmOperandInfoVector</a> TargetConstraints =</span></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"><span class="doxyHighlight">      TLI.<a href="/docs/api/classes/llvm/targetlowering/#a1c5e8b6aef41aead06d61ff0530ed9c2">ParseConstraints</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout(), &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, &#42;CI);</span></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (TargetLowering::AsmOperandInfo &amp;OpInfo : TargetConstraints) &#123;</span></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the constraint code and ConstraintType to use.</span></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"><span class="doxyHighlight">    TLI.<a href="/docs/api/classes/llvm/targetlowering/#a279a7f92d056886ac713c0f06cc73045">ComputeConstraintToUse</a>(OpInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>());</span></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this asm operand is our Value&#42;, and if it isn&#39;t an indirect memory</span></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// operand, we can&#39;t fold it!  TODO: Also handle C&#95;Address?</span></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpInfo.CallOperandVal == OpVal &amp;&amp;</span></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><span class="doxyHighlight">        (OpInfo.ConstraintType != <a href="/docs/api/classes/llvm/targetlowering/#a0b0176781cd4fd9f45cc739f1d007116a420d729d2e7d056ec884c094ccdc4467">TargetLowering::C&#95;Memory</a> ||</span></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496"><span class="doxyHighlight">         !OpInfo.isIndirect))</span></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><span class="doxyHighlightComment">/// Recursively walk all the uses of I until we find a memory use.</span></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504"><span class="doxyHighlightComment">/// If we find an obviously non-foldable instruction, return true.</span></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><span class="doxyHighlightComment">/// Add accessed addresses and types to MemoryUses.</span></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506" lineLink="#a498962c0029b14cf3cc8fb08c5e20ab2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(</span></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;Use &#42;, Type &#42;&gt;&gt; &amp;MemoryUses,</span></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;ConsideredInsts, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptSize, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI,</span></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;SeenInsts) &#123;</span></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we already considered this instruction, we&#39;re done.</span></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConsideredInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</span></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is an obviously unfoldable instruction, bail out.</span></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop over all the uses, recursively processing them.</span></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) &#123;</span></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Conservatively return true if we&#39;re seeing a large number or a deep chain</span></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of users. This avoids excessive compilation times in pathological cases.</span></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SeenInsts++ &gt;= <a href="#a1a31871450a2ceec97ef89dbdae54921">MaxAddressUsersToScan</a>)</span></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(UserI)) &#123;</span></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"><span class="doxyHighlight">      MemoryUses.push&#95;back(&#123;&amp;U, LI-&gt;getType()&#125;);</span></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(UserI)) &#123;</span></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (U.getOperandNo() != <a href="/docs/api/classes/llvm/storeinst/#add13b402166ae4d70f5b93c3c4cfba99">StoreInst::getPointerOperandIndex</a>())</span></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Storing addr, not into addr.</span></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"><span class="doxyHighlight">      MemoryUses.push&#95;back(&#123;&amp;U, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType()&#125;);</span></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/atomicrmwinst">AtomicRMWInst</a> &#42;RMW = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicRMWInst&gt;</a>(UserI)) &#123;</span></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (U.getOperandNo() != <a href="/docs/api/classes/llvm/atomicrmwinst/#a2f8f88574a509cf4545cd6420b405aaf">AtomicRMWInst::getPointerOperandIndex</a>())</span></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Storing addr, not into addr.</span></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"><span class="doxyHighlight">      MemoryUses.push&#95;back(&#123;&amp;U, RMW-&gt;getValOperand()-&gt;getType()&#125;);</span></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/atomiccmpxchginst">AtomicCmpXchgInst</a> &#42;CmpX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicCmpXchgInst&gt;</a>(UserI)) &#123;</span></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (U.getOperandNo() != <a href="/docs/api/classes/llvm/atomiccmpxchginst/#ad11e8ccbd7550fb3b77f1d2cbc921b50">AtomicCmpXchgInst::getPointerOperandIndex</a>())</span></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Storing addr, not into addr.</span></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><span class="doxyHighlight">      MemoryUses.push&#95;back(&#123;&amp;U, CmpX-&gt;getCompareOperand()-&gt;getType()&#125;);</span></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(UserI)) &#123;</span></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;hasFnAttr(Attribute::Cold)) &#123;</span></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this is a cold call, we can sink the addressing calculation into</span></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the cold path.  See optimizeCallInst</span></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(CI-&gt;getParent(), PSI, BFI))</span></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/inlineasm">InlineAsm</a> &#42;IA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InlineAsm&gt;</a>(CI-&gt;getCalledOperand());</span></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IA)</span></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is a memory operand, we&#39;re cool, otherwise bail out.</span></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a>(CI, IA, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>))</span></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(UserI, MemoryUses, ConsideredInsts, TLI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OptSize,</span></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"><span class="doxyHighlight">                          PSI, BFI, SeenInsts))</span></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579" lineLink="#a0f0065098f13d0b2ef0e39f9d2e1ecdd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(</span></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;Use &#42;, Type &#42;&gt;&gt; &amp;MemoryUses,</span></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptSize,</span></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI) &#123;</span></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SeenInsts = 0;</span></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 16&gt;</a> ConsideredInsts;</span></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MemoryUses, ConsideredInsts, TLI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OptSize,</span></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586"><span class="doxyHighlight">                           PSI, BFI, SeenInsts);</span></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><span class="doxyHighlightComment">/// Return true if Val is already known to be live at the use site that we&#39;re</span></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"><span class="doxyHighlightComment">/// folding it into. If so, there is no cost to include it in the addressing</span></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"><span class="doxyHighlightComment">/// mode. KnownLive1 and KnownLive2 are two values that we know are live at the</span></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><span class="doxyHighlightComment">/// instruction already.</span></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddressingModeMatcher::valueAlreadyLiveAtInst(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Val,</span></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><span class="doxyHighlight">                                                   <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;KnownLive1,</span></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"><span class="doxyHighlight">                                                   <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;KnownLive2) &#123;</span></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If Val is either of the known-live values, we know it is live!</span></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Val == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> || Val == KnownLive1 || Val == KnownLive2)</span></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All values other than instructions and arguments (e.g. constants) are live.</span></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Val) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(Val))</span></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If Val is a constant sized alloca in the entry block, it is live, this is</span></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// true because it is just a reference to the stack/frame pointer, which is</span></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// live for the whole function.</span></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(Val))</span></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a36e31f42170be95fc392dad696d9ba19">isStaticAlloca</a>())</span></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if this value is already used in the memory instruction&#39;s</span></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block.  If so, it&#39;s already live into the block at the very least, so we</span></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can reasonably fold it.</span></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Val-&gt;<a href="/docs/api/classes/llvm/value/#a55bba6bcd9b098e1c227011e6cd66300">isUsedInBasicBlock</a>(MemoryInst-&gt;getParent());</span></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><span class="doxyHighlightComment">/// It is possible for the addressing mode of the machine to fold the specified</span></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"><span class="doxyHighlightComment">/// instruction into a load or store that ultimately uses it.</span></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><span class="doxyHighlightComment">/// However, the specified instruction has multiple uses.</span></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><span class="doxyHighlightComment">/// Given this, it may actually increase register pressure to fold it</span></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"><span class="doxyHighlightComment">/// into the load. For example, consider this code:</span></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><span class="doxyHighlightComment">///     X = ...</span></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><span class="doxyHighlightComment">///     Y = X+1</span></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"><span class="doxyHighlightComment">///     use(Y)   -&gt; nonload/store</span></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"><span class="doxyHighlightComment">///     Z = Y+1</span></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"><span class="doxyHighlightComment">///     load Z</span></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><span class="doxyHighlightComment">/// In this case, Y has multiple uses, and can be folded into the load of Z</span></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><span class="doxyHighlightComment">/// (yielding load &#91;X+2&#93;).  However, doing this will cause both &quot;X&quot; and &quot;X+1&quot; to</span></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"><span class="doxyHighlightComment">/// be live at the use(Y) line.  If we don&#39;t fold Y into load Z, we use one</span></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"><span class="doxyHighlightComment">/// fewer register.  Since Y can&#39;t be folded into &quot;use(Y)&quot; we don&#39;t increase the</span></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634"><span class="doxyHighlightComment">/// number of computations either.</span></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"><span class="doxyHighlightComment">/// Note that this (like most of CodeGenPrepare) is just a rough heuristic.  If</span></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"><span class="doxyHighlightComment">/// X was live across &#39;load Z&#39; for other reasons, we actually &#42;would&#42; want to</span></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><span class="doxyHighlightComment">/// fold the addressing mode in the Z case.  This would make Y die earlier.</span></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddressingModeMatcher::isProfitableToFoldIntoAddressingMode(</span></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><span class="doxyHighlight">    Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMBefore, <a href="/docs/api/structs/anonymous-namespace-codegenprepare-cpp-/extaddrmode">ExtAddrMode</a> &amp;AMAfter) &#123;</span></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IgnoreProfitability)</span></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// AMBefore is the addressing mode before this instruction was folded into it,</span></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and AMAfter is the addressing mode after the instruction was folded.  Get</span></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the set of registers referenced by AMAfter and subtract out those</span></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// referenced by AMBefore: this is the set of values which folding in this</span></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// address extends the lifetime of.</span></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that there are only two potential values being referenced here,</span></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BaseReg and ScaleReg (global addresses are always available, as are any</span></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// folded immediates).</span></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseReg = AMAfter.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, &#42;ScaledReg = AMAfter.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>;</span></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the BaseReg or ScaledReg was referenced by the previous addrmode, their</span></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lifetime wasn&#39;t extended by adding this instruction.</span></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (valueAlreadyLiveAtInst(BaseReg, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>))</span></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><span class="doxyHighlight">    BaseReg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (valueAlreadyLiveAtInst(ScaledReg, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, AMBefore.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>))</span></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><span class="doxyHighlight">    ScaledReg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If folding this instruction (and it&#39;s subexprs) didn&#39;t extend any live</span></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ranges, we&#39;re ok with it.</span></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BaseReg &amp;&amp; !ScaledReg)</span></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all uses of this instruction can have the address mode sunk into them,</span></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can remove the addressing mode and effectively trade one live register</span></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for another (at worst.)  In this context, folding an addressing mode into</span></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the use is just a particularly nice way of sinking it.</span></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;std::pair&lt;Use &#42;, Type &#42;&gt;</a>, 16&gt; MemoryUses;</span></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a498962c0029b14cf3cc8fb08c5e20ab2">FindAllMemoryUses</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MemoryUses, TLI, TRI, OptSize, PSI, BFI))</span></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Has a non-memory, non-foldable use!</span></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we know that all uses of this instruction are part of a chain of</span></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// computation involving only operations that could theoretically be folded</span></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into a memory use, loop over each of these memory operation uses and see</span></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if they could  &#42;actually&#42; fold the instruction.  The assumption is that</span></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// addressing modes are cheap and that duplicating the computation involved</span></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// many times is worthwhile, even on a fastpath. For sinking candidates</span></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (i.e. cold call sites), this serves as a way to prevent excessive code</span></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// growth since most architectures have some reasonable small and fast way to</span></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compute an effective address.  (i.e LEA on x86)</span></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Instruction &#42;, 32&gt;</a> MatchedAddrModeInsts;</span></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::pair&lt;Use &#42;, Type &#42;&gt; &amp;Pair : MemoryUses) &#123;</span></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a> = Pair.first-&gt;get();</span></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Pair.first-&gt;getUser());</span></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;AddressAccessTy = Pair.second;</span></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a>-&gt;getType()-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do a match against the root of this address, ignoring profitability. This</span></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will tell us if the addressing mode for the memory operation will</span></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#42;actually&#42; cover the shared instruction.</span></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><span class="doxyHighlight">    ExtAddrMode <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</span></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695"><span class="doxyHighlight">    std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt; LargeOffsetGEP(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696"><span class="doxyHighlight">                                                                      0);</span></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</span></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"><span class="doxyHighlight">        TPT.getRestorationPoint();</span></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699"><span class="doxyHighlight">    AddressingModeMatcher Matcher(MatchedAddrModeInsts, TLI, TRI, LI, getDTFn,</span></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><span class="doxyHighlight">                                  AddressAccessTy, AS, UserI, Result,</span></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"><span class="doxyHighlight">                                  InsertedInsts, PromotedInsts, TPT,</span></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><span class="doxyHighlight">                                  LargeOffsetGEP, OptSize, PSI, BFI);</span></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703"><span class="doxyHighlight">    Matcher.IgnoreProfitability = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> = Matcher.matchAddr(<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a>, 0);</span></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><span class="doxyHighlight">    (void)<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a>;</span></CodeLine>
<Link id="l05706" /><CodeLine lineNumber="5706"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Couldn&#39;t select &#42;anything&#42;?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05707" /><CodeLine lineNumber="5707"></CodeLine>
<Link id="l05708" /><CodeLine lineNumber="5708"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The match was to check the profitability, the changes made are not</span></CodeLine>
<Link id="l05709" /><CodeLine lineNumber="5709"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// part of the original matcher. Therefore, they should be dropped</span></CodeLine>
<Link id="l05710" /><CodeLine lineNumber="5710"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// otherwise the original matcher will not present the right state.</span></CodeLine>
<Link id="l05711" /><CodeLine lineNumber="5711"><span class="doxyHighlight">    TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05712" /><CodeLine lineNumber="5712"></CodeLine>
<Link id="l05713" /><CodeLine lineNumber="5713"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the match didn&#39;t cover I, then it won&#39;t be shared by it.</span></CodeLine>
<Link id="l05714" /><CodeLine lineNumber="5714"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(MatchedAddrModeInsts, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l05715" /><CodeLine lineNumber="5715"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05716" /><CodeLine lineNumber="5716"></CodeLine>
<Link id="l05717" /><CodeLine lineNumber="5717"><span class="doxyHighlight">    MatchedAddrModeInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l05718" /><CodeLine lineNumber="5718"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05719" /><CodeLine lineNumber="5719"></CodeLine>
<Link id="l05720" /><CodeLine lineNumber="5720"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05721" /><CodeLine lineNumber="5721"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05722" /><CodeLine lineNumber="5722"></CodeLine>
<Link id="l05723" /><CodeLine lineNumber="5723"><span class="doxyHighlightComment">/// Return true if the specified values are defined in a</span></CodeLine>
<Link id="l05724" /><CodeLine lineNumber="5724"><span class="doxyHighlightComment">/// different basic block than BB.</span></CodeLine>
<Link id="l05725" /><CodeLine lineNumber="5725" lineLink="#ad897d4beb50aa8f0d4d2eaa08ac0987d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l05726" /><CodeLine lineNumber="5726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V))</span></CodeLine>
<Link id="l05727" /><CodeLine lineNumber="5727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != BB;</span></CodeLine>
<Link id="l05728" /><CodeLine lineNumber="5728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05729" /><CodeLine lineNumber="5729"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05730" /><CodeLine lineNumber="5730"></CodeLine>
<Link id="l05731" /><CodeLine lineNumber="5731"><span class="doxyHighlightComment">/// Sink addressing mode computation immediate before MemoryInst if doing so</span></CodeLine>
<Link id="l05732" /><CodeLine lineNumber="5732"><span class="doxyHighlightComment">/// can be done without increasing register pressure.  The need for the</span></CodeLine>
<Link id="l05733" /><CodeLine lineNumber="5733"><span class="doxyHighlightComment">/// register pressure constraint means this can end up being an all or nothing</span></CodeLine>
<Link id="l05734" /><CodeLine lineNumber="5734"><span class="doxyHighlightComment">/// decision for all uses of the same addressing computation.</span></CodeLine>
<Link id="l05735" /><CodeLine lineNumber="5735"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05736" /><CodeLine lineNumber="5736"><span class="doxyHighlightComment">/// Load and Store Instructions often have addressing modes that can do</span></CodeLine>
<Link id="l05737" /><CodeLine lineNumber="5737"><span class="doxyHighlightComment">/// significant amounts of computation. As such, instruction selection will try</span></CodeLine>
<Link id="l05738" /><CodeLine lineNumber="5738"><span class="doxyHighlightComment">/// to get the load or store to do as much computation as possible for the</span></CodeLine>
<Link id="l05739" /><CodeLine lineNumber="5739"><span class="doxyHighlightComment">/// program. The problem is that isel can only see within a single block. As</span></CodeLine>
<Link id="l05740" /><CodeLine lineNumber="5740"><span class="doxyHighlightComment">/// such, we sink as much legal addressing mode work into the block as possible.</span></CodeLine>
<Link id="l05741" /><CodeLine lineNumber="5741"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05742" /><CodeLine lineNumber="5742"><span class="doxyHighlightComment">/// This method is used to optimize both load/store and inline asms with memory</span></CodeLine>
<Link id="l05743" /><CodeLine lineNumber="5743"><span class="doxyHighlightComment">/// operands.  It&#39;s also used to sink addressing computations feeding into cold</span></CodeLine>
<Link id="l05744" /><CodeLine lineNumber="5744"><span class="doxyHighlightComment">/// call sites into their (cold) basic block.</span></CodeLine>
<Link id="l05745" /><CodeLine lineNumber="5745"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05746" /><CodeLine lineNumber="5746"><span class="doxyHighlightComment">/// The motivation for handling sinking into cold blocks is that doing so can</span></CodeLine>
<Link id="l05747" /><CodeLine lineNumber="5747"><span class="doxyHighlightComment">/// both enable other address mode sinking (by satisfying the register pressure</span></CodeLine>
<Link id="l05748" /><CodeLine lineNumber="5748"><span class="doxyHighlightComment">/// constraint above), and reduce register pressure globally (by removing the</span></CodeLine>
<Link id="l05749" /><CodeLine lineNumber="5749"><span class="doxyHighlightComment">/// addressing mode computation from the fast path entirely.).</span></CodeLine>
<Link id="l05750" /><CodeLine lineNumber="5750"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeMemoryInst(Instruction &#42;MemoryInst, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr,</span></CodeLine>
<Link id="l05751" /><CodeLine lineNumber="5751"><span class="doxyHighlight">                                        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;AccessTy, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AddrSpace) &#123;</span></CodeLine>
<Link id="l05752" /><CodeLine lineNumber="5752"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Repl = Addr;</span></CodeLine>
<Link id="l05753" /><CodeLine lineNumber="5753"></CodeLine>
<Link id="l05754" /><CodeLine lineNumber="5754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to collapse single-value PHI nodes.  This is necessary to undo</span></CodeLine>
<Link id="l05755" /><CodeLine lineNumber="5755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unprofitable PRE transformations.</span></CodeLine>
<Link id="l05756" /><CodeLine lineNumber="5756"><span class="doxyHighlight">  SmallVector&lt;Value &#42;, 8&gt; worklist;</span></CodeLine>
<Link id="l05757" /><CodeLine lineNumber="5757"><span class="doxyHighlight">  SmallPtrSet&lt;Value &#42;, 16&gt; Visited;</span></CodeLine>
<Link id="l05758" /><CodeLine lineNumber="5758"><span class="doxyHighlight">  worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Addr);</span></CodeLine>
<Link id="l05759" /><CodeLine lineNumber="5759"></CodeLine>
<Link id="l05760" /><CodeLine lineNumber="5760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use a worklist to iteratively look through PHI and select nodes, and</span></CodeLine>
<Link id="l05761" /><CodeLine lineNumber="5761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ensure that the addressing mode obtained from the non-PHI/select roots of</span></CodeLine>
<Link id="l05762" /><CodeLine lineNumber="5762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the graph are compatible.</span></CodeLine>
<Link id="l05763" /><CodeLine lineNumber="5763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PhiOrSelectSeen = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05764" /><CodeLine lineNumber="5764"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 16&gt; AddrModeInsts;</span></CodeLine>
<Link id="l05765" /><CodeLine lineNumber="5765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SimplifyQuery SQ(&#42;DL, TLInfo);</span></CodeLine>
<Link id="l05766" /><CodeLine lineNumber="5766"><span class="doxyHighlight">  AddressingModeCombiner AddrModes(SQ, Addr);</span></CodeLine>
<Link id="l05767" /><CodeLine lineNumber="5767"><span class="doxyHighlight">  TypePromotionTransaction TPT(RemovedInsts);</span></CodeLine>
<Link id="l05768" /><CodeLine lineNumber="5768"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</span></CodeLine>
<Link id="l05769" /><CodeLine lineNumber="5769"><span class="doxyHighlight">      TPT.getRestorationPoint();</span></CodeLine>
<Link id="l05770" /><CodeLine lineNumber="5770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l05771" /><CodeLine lineNumber="5771"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l05772" /><CodeLine lineNumber="5772"></CodeLine>
<Link id="l05773" /><CodeLine lineNumber="5773"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We allow traversing cyclic Phi nodes.</span></CodeLine>
<Link id="l05774" /><CodeLine lineNumber="5774"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In case of success after this loop we ensure that traversing through</span></CodeLine>
<Link id="l05775" /><CodeLine lineNumber="5775"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Phi nodes ends up with all cases to compute address of the form</span></CodeLine>
<Link id="l05776" /><CodeLine lineNumber="5776"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    BaseGV + Base + Scale &#42; Index + Offset</span></CodeLine>
<Link id="l05777" /><CodeLine lineNumber="5777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// where Scale and Offset are constans and BaseGV, Base and Index</span></CodeLine>
<Link id="l05778" /><CodeLine lineNumber="5778"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// are exactly the same Values in all cases.</span></CodeLine>
<Link id="l05779" /><CodeLine lineNumber="5779"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It means that BaseGV, Scale and Offset dominate our memory instruction</span></CodeLine>
<Link id="l05780" /><CodeLine lineNumber="5780"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and have the same value as they had in address computation represented</span></CodeLine>
<Link id="l05781" /><CodeLine lineNumber="5781"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as Phi. So we can safely sink address computation to memory instruction.</span></CodeLine>
<Link id="l05782" /><CodeLine lineNumber="5782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(V).second)</span></CodeLine>
<Link id="l05783" /><CodeLine lineNumber="5783"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05784" /><CodeLine lineNumber="5784"></CodeLine>
<Link id="l05785" /><CodeLine lineNumber="5785"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For a PHI node, push all of its incoming values.</span></CodeLine>
<Link id="l05786" /><CodeLine lineNumber="5786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHINode &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l05787" /><CodeLine lineNumber="5787"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(worklist, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;incoming&#95;values());</span></CodeLine>
<Link id="l05788" /><CodeLine lineNumber="5788"><span class="doxyHighlight">      PhiOrSelectSeen = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05789" /><CodeLine lineNumber="5789"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05790" /><CodeLine lineNumber="5790"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05791" /><CodeLine lineNumber="5791"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Similar for select.</span></CodeLine>
<Link id="l05792" /><CodeLine lineNumber="5792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SelectInst &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l05793" /><CodeLine lineNumber="5793"><span class="doxyHighlight">      worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getFalseValue());</span></CodeLine>
<Link id="l05794" /><CodeLine lineNumber="5794"><span class="doxyHighlight">      worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getTrueValue());</span></CodeLine>
<Link id="l05795" /><CodeLine lineNumber="5795"><span class="doxyHighlight">      PhiOrSelectSeen = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05796" /><CodeLine lineNumber="5796"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05797" /><CodeLine lineNumber="5797"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05798" /><CodeLine lineNumber="5798"></CodeLine>
<Link id="l05799" /><CodeLine lineNumber="5799"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For non-PHIs, determine the addressing mode being computed.  Note that</span></CodeLine>
<Link id="l05800" /><CodeLine lineNumber="5800"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the result may differ depending on what other uses our candidate</span></CodeLine>
<Link id="l05801" /><CodeLine lineNumber="5801"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// addressing instructions might have.</span></CodeLine>
<Link id="l05802" /><CodeLine lineNumber="5802"><span class="doxyHighlight">    AddrModeInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l05803" /><CodeLine lineNumber="5803"><span class="doxyHighlight">    std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt; LargeOffsetGEP(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05804" /><CodeLine lineNumber="5804"><span class="doxyHighlight">                                                                      0);</span></CodeLine>
<Link id="l05805" /><CodeLine lineNumber="5805"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Defer the query (and possible computation of) the dom tree to point of</span></CodeLine>
<Link id="l05806" /><CodeLine lineNumber="5806"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// actual use.  It&#39;s expected that most address matches don&#39;t actually need</span></CodeLine>
<Link id="l05807" /><CodeLine lineNumber="5807"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the domtree.</span></CodeLine>
<Link id="l05808" /><CodeLine lineNumber="5808"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> getDTFn = &#91;MemoryInst, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;() -&gt; </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DominatorTree &amp; &#123;</span></CodeLine>
<Link id="l05809" /><CodeLine lineNumber="5809"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = MemoryInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent();</span></CodeLine>
<Link id="l05810" /><CodeLine lineNumber="5810"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> this-&gt;getDT(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05811" /><CodeLine lineNumber="5811"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l05812" /><CodeLine lineNumber="5812"><span class="doxyHighlight">    ExtAddrMode NewAddrMode = <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/addressingmodematcher/#a592ce6f54154b0ca1d672869951cad6b">AddressingModeMatcher::Match</a>(</span></CodeLine>
<Link id="l05813" /><CodeLine lineNumber="5813"><span class="doxyHighlight">        V, AccessTy, AddrSpace, MemoryInst, AddrModeInsts, &#42;TLI, &#42;LI, getDTFn,</span></CodeLine>
<Link id="l05814" /><CodeLine lineNumber="5814"><span class="doxyHighlight">        &#42;TRI, InsertedInsts, PromotedInsts, TPT, LargeOffsetGEP, OptSize, PSI,</span></CodeLine>
<Link id="l05815" /><CodeLine lineNumber="5815"><span class="doxyHighlight">        BFI.get());</span></CodeLine>
<Link id="l05816" /><CodeLine lineNumber="5816"></CodeLine>
<Link id="l05817" /><CodeLine lineNumber="5817"><span class="doxyHighlight">    GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = LargeOffsetGEP.first;</span></CodeLine>
<Link id="l05818" /><CodeLine lineNumber="5818"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> &amp;&amp; !NewGEPBases.count(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)) &#123;</span></CodeLine>
<Link id="l05819" /><CodeLine lineNumber="5819"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If splitting the underlying data structure can reduce the offset of a</span></CodeLine>
<Link id="l05820" /><CodeLine lineNumber="5820"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// GEP, collect the GEP.  Skip the GEPs that are the new bases of</span></CodeLine>
<Link id="l05821" /><CodeLine lineNumber="5821"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// previously split data structures.</span></CodeLine>
<Link id="l05822" /><CodeLine lineNumber="5822"><span class="doxyHighlight">      LargeOffsetGEPMap&#91;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand()&#93;.push&#95;back(LargeOffsetGEP);</span></CodeLine>
<Link id="l05823" /><CodeLine lineNumber="5823"><span class="doxyHighlight">      LargeOffsetGEPID.insert(std::make&#95;pair(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, LargeOffsetGEPID.size()));</span></CodeLine>
<Link id="l05824" /><CodeLine lineNumber="5824"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05825" /><CodeLine lineNumber="5825"></CodeLine>
<Link id="l05826" /><CodeLine lineNumber="5826"><span class="doxyHighlight">    NewAddrMode.OriginalValue = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l05827" /><CodeLine lineNumber="5827"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddrModes.addNewAddrMode(NewAddrMode))</span></CodeLine>
<Link id="l05828" /><CodeLine lineNumber="5828"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05829" /><CodeLine lineNumber="5829"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05830" /><CodeLine lineNumber="5830"></CodeLine>
<Link id="l05831" /><CodeLine lineNumber="5831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to combine the AddrModes we&#39;ve collected. If we couldn&#39;t collect any,</span></CodeLine>
<Link id="l05832" /><CodeLine lineNumber="5832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or we have multiple but either couldn&#39;t combine them or combining them</span></CodeLine>
<Link id="l05833" /><CodeLine lineNumber="5833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// wouldn&#39;t do anything useful, bail out now.</span></CodeLine>
<Link id="l05834" /><CodeLine lineNumber="5834"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddrModes.combineAddrModes()) &#123;</span></CodeLine>
<Link id="l05835" /><CodeLine lineNumber="5835"><span class="doxyHighlight">    TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l05836" /><CodeLine lineNumber="5836"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05837" /><CodeLine lineNumber="5837"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05838" /><CodeLine lineNumber="5838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = TPT.commit();</span></CodeLine>
<Link id="l05839" /><CodeLine lineNumber="5839"></CodeLine>
<Link id="l05840" /><CodeLine lineNumber="5840"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the combined AddrMode (or the only AddrMode, if we only had one).</span></CodeLine>
<Link id="l05841" /><CodeLine lineNumber="5841"><span class="doxyHighlight">  ExtAddrMode <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = AddrModes.getAddrMode();</span></CodeLine>
<Link id="l05842" /><CodeLine lineNumber="5842"></CodeLine>
<Link id="l05843" /><CodeLine lineNumber="5843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all the instructions matched are already in this BB, don&#39;t do anything.</span></CodeLine>
<Link id="l05844" /><CodeLine lineNumber="5844"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we saw a Phi node then it is not local definitely, and if we saw a</span></CodeLine>
<Link id="l05845" /><CodeLine lineNumber="5845"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// select then we want to push the address calculation past it even if it&#39;s</span></CodeLine>
<Link id="l05846" /><CodeLine lineNumber="5846"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// already in this BB.</span></CodeLine>
<Link id="l05847" /><CodeLine lineNumber="5847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiOrSelectSeen &amp;&amp; <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(AddrModeInsts, &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l05848" /><CodeLine lineNumber="5848"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a>(V, MemoryInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l05849" /><CodeLine lineNumber="5849"><span class="doxyHighlight">      &#125;)) &#123;</span></CodeLine>
<Link id="l05850" /><CodeLine lineNumber="5850"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CGP: Found      local addrmode: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></span></CodeLine>
<Link id="l05851" /><CodeLine lineNumber="5851"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05852" /><CodeLine lineNumber="5852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l05853" /><CodeLine lineNumber="5853"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05854" /><CodeLine lineNumber="5854"></CodeLine>
<Link id="l05855" /><CodeLine lineNumber="5855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert this computation right after this user.  Since our caller is</span></CodeLine>
<Link id="l05856" /><CodeLine lineNumber="5856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// scanning from the top of the BB to the bottom, reuse of the expr are</span></CodeLine>
<Link id="l05857" /><CodeLine lineNumber="5857"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// guaranteed to happen later.</span></CodeLine>
<Link id="l05858" /><CodeLine lineNumber="5858"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(MemoryInst);</span></CodeLine>
<Link id="l05859" /><CodeLine lineNumber="5859"></CodeLine>
<Link id="l05860" /><CodeLine lineNumber="5860"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we determined the addressing expression we want to use and know</span></CodeLine>
<Link id="l05861" /><CodeLine lineNumber="5861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that we have to sink it into this block.  Check to see if we have already</span></CodeLine>
<Link id="l05862" /><CodeLine lineNumber="5862"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// done this for some other load/store instr in this block.  If so, reuse</span></CodeLine>
<Link id="l05863" /><CodeLine lineNumber="5863"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the computation.  Before attempting reuse, check if the address is valid</span></CodeLine>
<Link id="l05864" /><CodeLine lineNumber="5864"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as it may have been erased.</span></CodeLine>
<Link id="l05865" /><CodeLine lineNumber="5865"></CodeLine>
<Link id="l05866" /><CodeLine lineNumber="5866"><span class="doxyHighlight">  WeakTrackingVH SunkAddrVH = SunkAddrs&#91;Addr&#93;;</span></CodeLine>
<Link id="l05867" /><CodeLine lineNumber="5867"></CodeLine>
<Link id="l05868" /><CodeLine lineNumber="5868"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SunkAddr = SunkAddrVH.<a href="/docs/api/classes/llvm/weaktrackingvh/#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05869" /><CodeLine lineNumber="5869"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IntPtrTy = DL-&gt;getIntPtrType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l05870" /><CodeLine lineNumber="5870"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SunkAddr) &#123;</span></CodeLine>
<Link id="l05871" /><CodeLine lineNumber="5871"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CGP: Reusing nonlocal addrmode: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></span></CodeLine>
<Link id="l05872" /><CodeLine lineNumber="5872"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;MemoryInst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05873" /><CodeLine lineNumber="5873"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</span></CodeLine>
<Link id="l05874" /><CodeLine lineNumber="5874"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() !=</span></CodeLine>
<Link id="l05875" /><CodeLine lineNumber="5875"><span class="doxyHighlight">              Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() &amp;&amp;</span></CodeLine>
<Link id="l05876" /><CodeLine lineNumber="5876"><span class="doxyHighlight">          !DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</span></CodeLine>
<Link id="l05877" /><CodeLine lineNumber="5877"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// There are two reasons the address spaces might not match: a no-op</span></CodeLine>
<Link id="l05878" /><CodeLine lineNumber="5878"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// addrspacecast, or a ptrtoint/inttoptr pair. Either way, we emit a</span></CodeLine>
<Link id="l05879" /><CodeLine lineNumber="5879"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// ptrtoint/inttoptr pair to ensure we match the original semantics.</span></CodeLine>
<Link id="l05880" /><CodeLine lineNumber="5880"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: allow bitcast between different address space pointers with the</span></CodeLine>
<Link id="l05881" /><CodeLine lineNumber="5881"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// same size.</span></CodeLine>
<Link id="l05882" /><CodeLine lineNumber="5882"><span class="doxyHighlight">        SunkAddr = Builder.CreatePtrToInt(SunkAddr, IntPtrTy, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05883" /><CodeLine lineNumber="5883"><span class="doxyHighlight">        SunkAddr =</span></CodeLine>
<Link id="l05884" /><CodeLine lineNumber="5884"><span class="doxyHighlight">            Builder.CreateIntToPtr(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05885" /><CodeLine lineNumber="5885"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05886" /><CodeLine lineNumber="5886"><span class="doxyHighlight">        SunkAddr = Builder.CreatePointerCast(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l05887" /><CodeLine lineNumber="5887"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05888" /><CodeLine lineNumber="5888"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a> || (!<a href="#a5410093a9a86bd6e68eb3ffb32cbce13">AddrSinkUsingGEPs</a>.<a href="/docs/api/classes/llvm/cl/option/#a2dc75fafb68e7669e776e19da7857cdf">getNumOccurrences</a>() &amp;&amp;</span></CodeLine>
<Link id="l05889" /><CodeLine lineNumber="5889"><span class="doxyHighlight">                                   SubtargetInfo-&gt;addrSinkUsingGEPs())) &#123;</span></CodeLine>
<Link id="l05890" /><CodeLine lineNumber="5890"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// By default, we use the GEP-based method when AA is used later. This</span></CodeLine>
<Link id="l05891" /><CodeLine lineNumber="5891"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// prevents new inttoptr/ptrtoint pairs from degrading AA capabilities.</span></CodeLine>
<Link id="l05892" /><CodeLine lineNumber="5892"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CGP: SINKING nonlocal addrmode: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></span></CodeLine>
<Link id="l05893" /><CodeLine lineNumber="5893"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;MemoryInst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05894" /><CodeLine lineNumber="5894"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ResultPtr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;ResultIndex = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05895" /><CodeLine lineNumber="5895"></CodeLine>
<Link id="l05896" /><CodeLine lineNumber="5896"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First, find the pointer.</span></CodeLine>
<Link id="l05897" /><CodeLine lineNumber="5897"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg-&gt;getType()-&gt;isPointerTy()) &#123;</span></CodeLine>
<Link id="l05898" /><CodeLine lineNumber="5898"><span class="doxyHighlight">      ResultPtr = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</span></CodeLine>
<Link id="l05899" /><CodeLine lineNumber="5899"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05900" /><CodeLine lineNumber="5900"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05901" /><CodeLine lineNumber="5901"></CodeLine>
<Link id="l05902" /><CodeLine lineNumber="5902"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType()-&gt;isPointerTy()) &#123;</span></CodeLine>
<Link id="l05903" /><CodeLine lineNumber="5903"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We can&#39;t add more than one pointer together, nor can we scale a</span></CodeLine>
<Link id="l05904" /><CodeLine lineNumber="5904"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// pointer (both of which seem meaningless).</span></CodeLine>
<Link id="l05905" /><CodeLine lineNumber="5905"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultPtr || <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</span></CodeLine>
<Link id="l05906" /><CodeLine lineNumber="5906"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l05907" /><CodeLine lineNumber="5907"></CodeLine>
<Link id="l05908" /><CodeLine lineNumber="5908"><span class="doxyHighlight">      ResultPtr = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</span></CodeLine>
<Link id="l05909" /><CodeLine lineNumber="5909"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 0;</span></CodeLine>
<Link id="l05910" /><CodeLine lineNumber="5910"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05911" /><CodeLine lineNumber="5911"></CodeLine>
<Link id="l05912" /><CodeLine lineNumber="5912"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It is only safe to sign extend the BaseReg if we know that the math</span></CodeLine>
<Link id="l05913" /><CodeLine lineNumber="5913"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// required to create it did not overflow before we extend it. Since</span></CodeLine>
<Link id="l05914" /><CodeLine lineNumber="5914"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the original IR value was tossed in favor of a constant back when</span></CodeLine>
<Link id="l05915" /><CodeLine lineNumber="5915"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the AddrMode was created we need to bail out gracefully if widths</span></CodeLine>
<Link id="l05916" /><CodeLine lineNumber="5916"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// do not match instead of extending it.</span></CodeLine>
<Link id="l05917" /><CodeLine lineNumber="5917"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l05918" /><CodeLine lineNumber="5918"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (See below for code to add the scale.)</span></CodeLine>
<Link id="l05919" /><CodeLine lineNumber="5919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) &#123;</span></CodeLine>
<Link id="l05920" /><CodeLine lineNumber="5920"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScaledRegTy = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType();</span></CodeLine>
<Link id="l05921" /><CodeLine lineNumber="5921"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IntPtrTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &gt;</span></CodeLine>
<Link id="l05922" /><CodeLine lineNumber="5922"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(ScaledRegTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>())</span></CodeLine>
<Link id="l05923" /><CodeLine lineNumber="5923"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l05924" /><CodeLine lineNumber="5924"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05925" /><CodeLine lineNumber="5925"></CodeLine>
<Link id="l05926" /><CodeLine lineNumber="5926"><span class="doxyHighlight">    GlobalValue &#42;BaseGV = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV;</span></CodeLine>
<Link id="l05927" /><CodeLine lineNumber="5927"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseGV != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l05928" /><CodeLine lineNumber="5928"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultPtr)</span></CodeLine>
<Link id="l05929" /><CodeLine lineNumber="5929"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l05930" /><CodeLine lineNumber="5930"></CodeLine>
<Link id="l05931" /><CodeLine lineNumber="5931"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a239427c2c3a01e23bd15b29633696536">isThreadLocal</a>()) &#123;</span></CodeLine>
<Link id="l05932" /><CodeLine lineNumber="5932"><span class="doxyHighlight">        ResultPtr = Builder.CreateThreadLocalAddress(BaseGV);</span></CodeLine>
<Link id="l05933" /><CodeLine lineNumber="5933"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05934" /><CodeLine lineNumber="5934"><span class="doxyHighlight">        ResultPtr = BaseGV;</span></CodeLine>
<Link id="l05935" /><CodeLine lineNumber="5935"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05936" /><CodeLine lineNumber="5936"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05937" /><CodeLine lineNumber="5937"></CodeLine>
<Link id="l05938" /><CodeLine lineNumber="5938"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the real base value actually came from an inttoptr, then the matcher</span></CodeLine>
<Link id="l05939" /><CodeLine lineNumber="5939"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will look through it and provide only the integer value. In that case,</span></CodeLine>
<Link id="l05940" /><CodeLine lineNumber="5940"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// use it here.</span></CodeLine>
<Link id="l05941" /><CodeLine lineNumber="5941"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</span></CodeLine>
<Link id="l05942" /><CodeLine lineNumber="5942"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ResultPtr &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) &#123;</span></CodeLine>
<Link id="l05943" /><CodeLine lineNumber="5943"><span class="doxyHighlight">        ResultPtr = Builder.CreateIntToPtr(<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l05944" /><CodeLine lineNumber="5944"><span class="doxyHighlight">                                           </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05945" /><CodeLine lineNumber="5945"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05946" /><CodeLine lineNumber="5946"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ResultPtr &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale == 1) &#123;</span></CodeLine>
<Link id="l05947" /><CodeLine lineNumber="5947"><span class="doxyHighlight">        ResultPtr = Builder.CreateIntToPtr(<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l05948" /><CodeLine lineNumber="5948"><span class="doxyHighlight">                                           </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05949" /><CodeLine lineNumber="5949"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 0;</span></CodeLine>
<Link id="l05950" /><CodeLine lineNumber="5950"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05951" /><CodeLine lineNumber="5951"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05952" /><CodeLine lineNumber="5952"></CodeLine>
<Link id="l05953" /><CodeLine lineNumber="5953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ResultPtr &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale &amp;&amp;</span></CodeLine>
<Link id="l05954" /><CodeLine lineNumber="5954"><span class="doxyHighlight">        !<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) &#123;</span></CodeLine>
<Link id="l05955" /><CodeLine lineNumber="5955"><span class="doxyHighlight">      SunkAddr = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l05956" /><CodeLine lineNumber="5956"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ResultPtr) &#123;</span></CodeLine>
<Link id="l05957" /><CodeLine lineNumber="5957"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l05958" /><CodeLine lineNumber="5958"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05959" /><CodeLine lineNumber="5959"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I8PtrTy =</span></CodeLine>
<Link id="l05960" /><CodeLine lineNumber="5960"><span class="doxyHighlight">          Builder.getPtrTy(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>());</span></CodeLine>
<Link id="l05961" /><CodeLine lineNumber="5961"></CodeLine>
<Link id="l05962" /><CodeLine lineNumber="5962"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Start with the base register. Do this first so that subsequent address</span></CodeLine>
<Link id="l05963" /><CodeLine lineNumber="5963"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// matching finds it last, which will prevent it from trying to match it</span></CodeLine>
<Link id="l05964" /><CodeLine lineNumber="5964"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// as the scaled value in case it happens to be a mul. That would be</span></CodeLine>
<Link id="l05965" /><CodeLine lineNumber="5965"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// problematic if we&#39;ve sunk a different mul for the scale, because then</span></CodeLine>
<Link id="l05966" /><CodeLine lineNumber="5966"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we&#39;d end up sinking both muls.</span></CodeLine>
<Link id="l05967" /><CodeLine lineNumber="5967"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) &#123;</span></CodeLine>
<Link id="l05968" /><CodeLine lineNumber="5968"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</span></CodeLine>
<Link id="l05969" /><CodeLine lineNumber="5969"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() != IntPtrTy)</span></CodeLine>
<Link id="l05970" /><CodeLine lineNumber="5970"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateIntCast(V, IntPtrTy, </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05971" /><CodeLine lineNumber="5971"></CodeLine>
<Link id="l05972" /><CodeLine lineNumber="5972"><span class="doxyHighlight">        ResultIndex = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l05973" /><CodeLine lineNumber="5973"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05974" /><CodeLine lineNumber="5974"></CodeLine>
<Link id="l05975" /><CodeLine lineNumber="5975"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add the scale value.</span></CodeLine>
<Link id="l05976" /><CodeLine lineNumber="5976"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) &#123;</span></CodeLine>
<Link id="l05977" /><CodeLine lineNumber="5977"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</span></CodeLine>
<Link id="l05978" /><CodeLine lineNumber="5978"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() == IntPtrTy) &#123;</span></CodeLine>
<Link id="l05979" /><CodeLine lineNumber="5979"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// done.</span></CodeLine>
<Link id="l05980" /><CodeLine lineNumber="5980"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05981" /><CodeLine lineNumber="5981"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IntPtrTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &lt;</span></CodeLine>
<Link id="l05982" /><CodeLine lineNumber="5982"><span class="doxyHighlight">                     <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType())-&gt;getBitWidth() &amp;&amp;</span></CodeLine>
<Link id="l05983" /><CodeLine lineNumber="5983"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;We can&#39;t transform if ScaledReg is too narrow&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05984" /><CodeLine lineNumber="5984"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateTrunc(V, IntPtrTy, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05985" /><CodeLine lineNumber="5985"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05986" /><CodeLine lineNumber="5986"></CodeLine>
<Link id="l05987" /><CodeLine lineNumber="5987"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</span></CodeLine>
<Link id="l05988" /><CodeLine lineNumber="5988"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateMul(V, ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale),</span></CodeLine>
<Link id="l05989" /><CodeLine lineNumber="5989"><span class="doxyHighlight">                                </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05990" /><CodeLine lineNumber="5990"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultIndex)</span></CodeLine>
<Link id="l05991" /><CodeLine lineNumber="5991"><span class="doxyHighlight">          ResultIndex = Builder.CreateAdd(ResultIndex, V, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05992" /><CodeLine lineNumber="5992"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05993" /><CodeLine lineNumber="5993"><span class="doxyHighlight">          ResultIndex = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l05994" /><CodeLine lineNumber="5994"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05995" /><CodeLine lineNumber="5995"></CodeLine>
<Link id="l05996" /><CodeLine lineNumber="5996"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add in the Base Offset if present.</span></CodeLine>
<Link id="l05997" /><CodeLine lineNumber="5997"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) &#123;</span></CodeLine>
<Link id="l05998" /><CodeLine lineNumber="5998"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs);</span></CodeLine>
<Link id="l05999" /><CodeLine lineNumber="5999"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultIndex) &#123;</span></CodeLine>
<Link id="l06000" /><CodeLine lineNumber="6000"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// We need to add this separately from the scale above to help with</span></CodeLine>
<Link id="l06001" /><CodeLine lineNumber="6001"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// SDAG consecutive load/store merging.</span></CodeLine>
<Link id="l06002" /><CodeLine lineNumber="6002"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != I8PtrTy)</span></CodeLine>
<Link id="l06003" /><CodeLine lineNumber="6003"><span class="doxyHighlight">            ResultPtr = Builder.CreatePointerCast(ResultPtr, I8PtrTy);</span></CodeLine>
<Link id="l06004" /><CodeLine lineNumber="6004"><span class="doxyHighlight">          ResultPtr = Builder.CreatePtrAdd(ResultPtr, ResultIndex, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06005" /><CodeLine lineNumber="6005"><span class="doxyHighlight">                                           <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds);</span></CodeLine>
<Link id="l06006" /><CodeLine lineNumber="6006"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06007" /><CodeLine lineNumber="6007"></CodeLine>
<Link id="l06008" /><CodeLine lineNumber="6008"><span class="doxyHighlight">        ResultIndex = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l06009" /><CodeLine lineNumber="6009"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06010" /><CodeLine lineNumber="6010"></CodeLine>
<Link id="l06011" /><CodeLine lineNumber="6011"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ResultIndex) &#123;</span></CodeLine>
<Link id="l06012" /><CodeLine lineNumber="6012"><span class="doxyHighlight">        SunkAddr = ResultPtr;</span></CodeLine>
<Link id="l06013" /><CodeLine lineNumber="6013"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06014" /><CodeLine lineNumber="6014"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != I8PtrTy)</span></CodeLine>
<Link id="l06015" /><CodeLine lineNumber="6015"><span class="doxyHighlight">          ResultPtr = Builder.CreatePointerCast(ResultPtr, I8PtrTy);</span></CodeLine>
<Link id="l06016" /><CodeLine lineNumber="6016"><span class="doxyHighlight">        SunkAddr = Builder.CreatePtrAdd(ResultPtr, ResultIndex, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06017" /><CodeLine lineNumber="6017"><span class="doxyHighlight">                                        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds);</span></CodeLine>
<Link id="l06018" /><CodeLine lineNumber="6018"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06019" /><CodeLine lineNumber="6019"></CodeLine>
<Link id="l06020" /><CodeLine lineNumber="6020"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</span></CodeLine>
<Link id="l06021" /><CodeLine lineNumber="6021"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SunkAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() !=</span></CodeLine>
<Link id="l06022" /><CodeLine lineNumber="6022"><span class="doxyHighlight">                Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() &amp;&amp;</span></CodeLine>
<Link id="l06023" /><CodeLine lineNumber="6023"><span class="doxyHighlight">            !DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</span></CodeLine>
<Link id="l06024" /><CodeLine lineNumber="6024"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// There are two reasons the address spaces might not match: a no-op</span></CodeLine>
<Link id="l06025" /><CodeLine lineNumber="6025"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// addrspacecast, or a ptrtoint/inttoptr pair. Either way, we emit a</span></CodeLine>
<Link id="l06026" /><CodeLine lineNumber="6026"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// ptrtoint/inttoptr pair to ensure we match the original semantics.</span></CodeLine>
<Link id="l06027" /><CodeLine lineNumber="6027"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// TODO: allow bitcast between different address space pointers with</span></CodeLine>
<Link id="l06028" /><CodeLine lineNumber="6028"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// the same size.</span></CodeLine>
<Link id="l06029" /><CodeLine lineNumber="6029"><span class="doxyHighlight">          SunkAddr = Builder.CreatePtrToInt(SunkAddr, IntPtrTy, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06030" /><CodeLine lineNumber="6030"><span class="doxyHighlight">          SunkAddr =</span></CodeLine>
<Link id="l06031" /><CodeLine lineNumber="6031"><span class="doxyHighlight">              Builder.CreateIntToPtr(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06032" /><CodeLine lineNumber="6032"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06033" /><CodeLine lineNumber="6033"><span class="doxyHighlight">          SunkAddr = Builder.CreatePointerCast(SunkAddr, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l06034" /><CodeLine lineNumber="6034"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06035" /><CodeLine lineNumber="6035"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06036" /><CodeLine lineNumber="6036"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06037" /><CodeLine lineNumber="6037"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;d require a ptrtoint/inttoptr down the line, which we can&#39;t do for</span></CodeLine>
<Link id="l06038" /><CodeLine lineNumber="6038"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// non-integral pointers, so in that case bail out now.</span></CodeLine>
<Link id="l06039" /><CodeLine lineNumber="6039"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;BaseTy = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg ? <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg-&gt;getType() : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06040" /><CodeLine lineNumber="6040"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScaleTy = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale ? <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType() : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06041" /><CodeLine lineNumber="6041"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;BasePtrTy = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;PointerType&gt;</a>(BaseTy);</span></CodeLine>
<Link id="l06042" /><CodeLine lineNumber="6042"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;ScalePtrTy = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;PointerType&gt;</a>(ScaleTy);</span></CodeLine>
<Link id="l06043" /><CodeLine lineNumber="6043"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DL-&gt;isNonIntegralPointerType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) ||</span></CodeLine>
<Link id="l06044" /><CodeLine lineNumber="6044"><span class="doxyHighlight">        (BasePtrTy &amp;&amp; DL-&gt;isNonIntegralPointerType(BasePtrTy)) ||</span></CodeLine>
<Link id="l06045" /><CodeLine lineNumber="6045"><span class="doxyHighlight">        (ScalePtrTy &amp;&amp; DL-&gt;isNonIntegralPointerType(ScalePtrTy)) ||</span></CodeLine>
<Link id="l06046" /><CodeLine lineNumber="6046"><span class="doxyHighlight">        (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV &amp;&amp;</span></CodeLine>
<Link id="l06047" /><CodeLine lineNumber="6047"><span class="doxyHighlight">         DL-&gt;isNonIntegralPointerType(<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV-&gt;getType())))</span></CodeLine>
<Link id="l06048" /><CodeLine lineNumber="6048"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l06049" /><CodeLine lineNumber="6049"></CodeLine>
<Link id="l06050" /><CodeLine lineNumber="6050"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CGP: SINKING nonlocal addrmode: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></span></CodeLine>
<Link id="l06051" /><CodeLine lineNumber="6051"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;MemoryInst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06052" /><CodeLine lineNumber="6052"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IntPtrTy = DL-&gt;getIntPtrType(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l06053" /><CodeLine lineNumber="6053"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06054" /><CodeLine lineNumber="6054"></CodeLine>
<Link id="l06055" /><CodeLine lineNumber="6055"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Start with the base register. Do this first so that subsequent address</span></CodeLine>
<Link id="l06056" /><CodeLine lineNumber="6056"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// matching finds it last, which will prevent it from trying to match it</span></CodeLine>
<Link id="l06057" /><CodeLine lineNumber="6057"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as the scaled value in case it happens to be a mul. That would be</span></CodeLine>
<Link id="l06058" /><CodeLine lineNumber="6058"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// problematic if we&#39;ve sunk a different mul for the scale, because then</span></CodeLine>
<Link id="l06059" /><CodeLine lineNumber="6059"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we&#39;d end up sinking both muls.</span></CodeLine>
<Link id="l06060" /><CodeLine lineNumber="6060"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) &#123;</span></CodeLine>
<Link id="l06061" /><CodeLine lineNumber="6061"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</span></CodeLine>
<Link id="l06062" /><CodeLine lineNumber="6062"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l06063" /><CodeLine lineNumber="6063"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreatePtrToInt(V, IntPtrTy, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06064" /><CodeLine lineNumber="6064"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() != IntPtrTy)</span></CodeLine>
<Link id="l06065" /><CodeLine lineNumber="6065"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateIntCast(V, IntPtrTy, </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06066" /><CodeLine lineNumber="6066"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l06067" /><CodeLine lineNumber="6067"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06068" /><CodeLine lineNumber="6068"></CodeLine>
<Link id="l06069" /><CodeLine lineNumber="6069"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the scale value.</span></CodeLine>
<Link id="l06070" /><CodeLine lineNumber="6070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) &#123;</span></CodeLine>
<Link id="l06071" /><CodeLine lineNumber="6071"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</span></CodeLine>
<Link id="l06072" /><CodeLine lineNumber="6072"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() == IntPtrTy) &#123;</span></CodeLine>
<Link id="l06073" /><CodeLine lineNumber="6073"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// done.</span></CodeLine>
<Link id="l06074" /><CodeLine lineNumber="6074"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isPointerTy()) &#123;</span></CodeLine>
<Link id="l06075" /><CodeLine lineNumber="6075"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreatePtrToInt(V, IntPtrTy, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06076" /><CodeLine lineNumber="6076"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IntPtrTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &lt;</span></CodeLine>
<Link id="l06077" /><CodeLine lineNumber="6077"><span class="doxyHighlight">                 <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType())-&gt;getBitWidth()) &#123;</span></CodeLine>
<Link id="l06078" /><CodeLine lineNumber="6078"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateTrunc(V, IntPtrTy, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06079" /><CodeLine lineNumber="6079"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06080" /><CodeLine lineNumber="6080"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// It is only safe to sign extend the BaseReg if we know that the math</span></CodeLine>
<Link id="l06081" /><CodeLine lineNumber="6081"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// required to create it did not overflow before we extend it. Since</span></CodeLine>
<Link id="l06082" /><CodeLine lineNumber="6082"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the original IR value was tossed in favor of a constant back when</span></CodeLine>
<Link id="l06083" /><CodeLine lineNumber="6083"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the AddrMode was created we need to bail out gracefully if widths</span></CodeLine>
<Link id="l06084" /><CodeLine lineNumber="6084"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// do not match instead of extending it.</span></CodeLine>
<Link id="l06085" /><CodeLine lineNumber="6085"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(Result);</span></CodeLine>
<Link id="l06086" /><CodeLine lineNumber="6086"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; (Result != <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg))</span></CodeLine>
<Link id="l06087" /><CodeLine lineNumber="6087"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l06088" /><CodeLine lineNumber="6088"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l06089" /><CodeLine lineNumber="6089"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06090" /><CodeLine lineNumber="6090"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</span></CodeLine>
<Link id="l06091" /><CodeLine lineNumber="6091"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreateMul(V, ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale),</span></CodeLine>
<Link id="l06092" /><CodeLine lineNumber="6092"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06093" /><CodeLine lineNumber="6093"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result)</span></CodeLine>
<Link id="l06094" /><CodeLine lineNumber="6094"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Builder.CreateAdd(Result, V, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06095" /><CodeLine lineNumber="6095"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06096" /><CodeLine lineNumber="6096"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l06097" /><CodeLine lineNumber="6097"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06098" /><CodeLine lineNumber="6098"></CodeLine>
<Link id="l06099" /><CodeLine lineNumber="6099"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add in the BaseGV if present.</span></CodeLine>
<Link id="l06100" /><CodeLine lineNumber="6100"><span class="doxyHighlight">    GlobalValue &#42;BaseGV = <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV;</span></CodeLine>
<Link id="l06101" /><CodeLine lineNumber="6101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseGV != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l06102" /><CodeLine lineNumber="6102"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseGVPtr;</span></CodeLine>
<Link id="l06103" /><CodeLine lineNumber="6103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BaseGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a239427c2c3a01e23bd15b29633696536">isThreadLocal</a>()) &#123;</span></CodeLine>
<Link id="l06104" /><CodeLine lineNumber="6104"><span class="doxyHighlight">        BaseGVPtr = Builder.CreateThreadLocalAddress(BaseGV);</span></CodeLine>
<Link id="l06105" /><CodeLine lineNumber="6105"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06106" /><CodeLine lineNumber="6106"><span class="doxyHighlight">        BaseGVPtr = BaseGV;</span></CodeLine>
<Link id="l06107" /><CodeLine lineNumber="6107"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06108" /><CodeLine lineNumber="6108"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = Builder.CreatePtrToInt(BaseGVPtr, IntPtrTy, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06109" /><CodeLine lineNumber="6109"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result)</span></CodeLine>
<Link id="l06110" /><CodeLine lineNumber="6110"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Builder.CreateAdd(Result, V, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06111" /><CodeLine lineNumber="6111"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06112" /><CodeLine lineNumber="6112"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l06113" /><CodeLine lineNumber="6113"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06114" /><CodeLine lineNumber="6114"></CodeLine>
<Link id="l06115" /><CodeLine lineNumber="6115"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add in the Base Offset if present.</span></CodeLine>
<Link id="l06116" /><CodeLine lineNumber="6116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) &#123;</span></CodeLine>
<Link id="l06117" /><CodeLine lineNumber="6117"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = ConstantInt::get(IntPtrTy, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs);</span></CodeLine>
<Link id="l06118" /><CodeLine lineNumber="6118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result)</span></CodeLine>
<Link id="l06119" /><CodeLine lineNumber="6119"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Builder.CreateAdd(Result, V, </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06120" /><CodeLine lineNumber="6120"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06121" /><CodeLine lineNumber="6121"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l06122" /><CodeLine lineNumber="6122"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06123" /><CodeLine lineNumber="6123"></CodeLine>
<Link id="l06124" /><CodeLine lineNumber="6124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Result)</span></CodeLine>
<Link id="l06125" /><CodeLine lineNumber="6125"><span class="doxyHighlight">      SunkAddr = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l06126" /><CodeLine lineNumber="6126"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06127" /><CodeLine lineNumber="6127"><span class="doxyHighlight">      SunkAddr = Builder.CreateIntToPtr(Result, Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;sunkaddr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06128" /><CodeLine lineNumber="6128"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06129" /><CodeLine lineNumber="6129"></CodeLine>
<Link id="l06130" /><CodeLine lineNumber="6130"><span class="doxyHighlight">  MemoryInst-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(Repl, SunkAddr);</span></CodeLine>
<Link id="l06131" /><CodeLine lineNumber="6131"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Store the newly computed address into the cache. In the case we reused a</span></CodeLine>
<Link id="l06132" /><CodeLine lineNumber="6132"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value, this should be idempotent.</span></CodeLine>
<Link id="l06133" /><CodeLine lineNumber="6133"><span class="doxyHighlight">  SunkAddrs&#91;Addr&#93; = WeakTrackingVH(SunkAddr);</span></CodeLine>
<Link id="l06134" /><CodeLine lineNumber="6134"></CodeLine>
<Link id="l06135" /><CodeLine lineNumber="6135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have no uses, recursively delete the value and all dead instructions</span></CodeLine>
<Link id="l06136" /><CodeLine lineNumber="6136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// using it.</span></CodeLine>
<Link id="l06137" /><CodeLine lineNumber="6137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Repl-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l06138" /><CodeLine lineNumber="6138"><span class="doxyHighlight">    resetIteratorIfInvalidatedWhileCalling(CurInstIterator-&gt;getParent(), &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l06139" /><CodeLine lineNumber="6139"><span class="doxyHighlight">      RecursivelyDeleteTriviallyDeadInstructions(</span></CodeLine>
<Link id="l06140" /><CodeLine lineNumber="6140"><span class="doxyHighlight">          Repl, TLInfo, nullptr,</span></CodeLine>
<Link id="l06141" /><CodeLine lineNumber="6141"><span class="doxyHighlight">          &#91;&amp;&#93;(Value &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</span></CodeLine>
<Link id="l06142" /><CodeLine lineNumber="6142"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l06143" /><CodeLine lineNumber="6143"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06144" /><CodeLine lineNumber="6144"><span class="doxyHighlight">  ++NumMemoryInsts;</span></CodeLine>
<Link id="l06145" /><CodeLine lineNumber="6145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06146" /><CodeLine lineNumber="6146"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06147" /><CodeLine lineNumber="6147"></CodeLine>
<Link id="l06148" /><CodeLine lineNumber="6148"><span class="doxyHighlightComment">/// Rewrite GEP input to gather/scatter to enable SelectionDAGBuilder to find</span></CodeLine>
<Link id="l06149" /><CodeLine lineNumber="6149"><span class="doxyHighlightComment">/// a uniform base to use for ISD::MGATHER/MSCATTER. SelectionDAGBuilder can</span></CodeLine>
<Link id="l06150" /><CodeLine lineNumber="6150"><span class="doxyHighlightComment">/// only handle a 2 operand GEP in the same basic block or a splat constant</span></CodeLine>
<Link id="l06151" /><CodeLine lineNumber="6151"><span class="doxyHighlightComment">/// vector. The 2 operands to the GEP must have a scalar pointer and a vector</span></CodeLine>
<Link id="l06152" /><CodeLine lineNumber="6152"><span class="doxyHighlightComment">/// index.</span></CodeLine>
<Link id="l06153" /><CodeLine lineNumber="6153"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l06154" /><CodeLine lineNumber="6154"><span class="doxyHighlightComment">/// If the existing GEP has a vector base pointer that is splat, we can look</span></CodeLine>
<Link id="l06155" /><CodeLine lineNumber="6155"><span class="doxyHighlightComment">/// through the splat to find the scalar pointer. If we can&#39;t find a scalar</span></CodeLine>
<Link id="l06156" /><CodeLine lineNumber="6156"><span class="doxyHighlightComment">/// pointer there&#39;s nothing we can do.</span></CodeLine>
<Link id="l06157" /><CodeLine lineNumber="6157"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l06158" /><CodeLine lineNumber="6158"><span class="doxyHighlightComment">/// If we have a GEP with more than 2 indices where the middle indices are all</span></CodeLine>
<Link id="l06159" /><CodeLine lineNumber="6159"><span class="doxyHighlightComment">/// zeroes, we can replace it with 2 GEPs where the second has 2 operands.</span></CodeLine>
<Link id="l06160" /><CodeLine lineNumber="6160"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l06161" /><CodeLine lineNumber="6161"><span class="doxyHighlightComment">/// If the final index isn&#39;t a vector or is a splat, we can emit a scalar GEP</span></CodeLine>
<Link id="l06162" /><CodeLine lineNumber="6162"><span class="doxyHighlightComment">/// followed by a GEP with an all zeroes vector index. This will enable</span></CodeLine>
<Link id="l06163" /><CodeLine lineNumber="6163"><span class="doxyHighlightComment">/// SelectionDAGBuilder to use the scalar GEP as the uniform base and have a</span></CodeLine>
<Link id="l06164" /><CodeLine lineNumber="6164"><span class="doxyHighlightComment">/// zero index.</span></CodeLine>
<Link id="l06165" /><CodeLine lineNumber="6165"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeGatherScatterInst(Instruction &#42;MemoryInst,</span></CodeLine>
<Link id="l06166" /><CodeLine lineNumber="6166"><span class="doxyHighlight">                                               <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</span></CodeLine>
<Link id="l06167" /><CodeLine lineNumber="6167"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewAddr;</span></CodeLine>
<Link id="l06168" /><CodeLine lineNumber="6168"></CodeLine>
<Link id="l06169" /><CodeLine lineNumber="6169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) &#123;</span></CodeLine>
<Link id="l06170" /><CodeLine lineNumber="6170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t optimize GEPs that don&#39;t have indices.</span></CodeLine>
<Link id="l06171" /><CodeLine lineNumber="6171"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasIndices())</span></CodeLine>
<Link id="l06172" /><CodeLine lineNumber="6172"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06173" /><CodeLine lineNumber="6173"></CodeLine>
<Link id="l06174" /><CodeLine lineNumber="6174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the GEP and the gather/scatter aren&#39;t in the same BB, don&#39;t optimize.</span></CodeLine>
<Link id="l06175" /><CodeLine lineNumber="6175"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: We should support this by sinking the GEP.</span></CodeLine>
<Link id="l06176" /><CodeLine lineNumber="6176"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemoryInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getParent())</span></CodeLine>
<Link id="l06177" /><CodeLine lineNumber="6177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06178" /><CodeLine lineNumber="6178"></CodeLine>
<Link id="l06179" /><CodeLine lineNumber="6179"><span class="doxyHighlight">    SmallVector&lt;Value &#42;, 2&gt; <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;operands());</span></CodeLine>
<Link id="l06180" /><CodeLine lineNumber="6180"></CodeLine>
<Link id="l06181" /><CodeLine lineNumber="6181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RewriteGEP = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06182" /><CodeLine lineNumber="6182"></CodeLine>
<Link id="l06183" /><CodeLine lineNumber="6183"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;isVectorTy()) &#123;</span></CodeLine>
<Link id="l06184" /><CodeLine lineNumber="6184"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93; = <a href="/docs/api/namespaces/llvm/#a48fc95f799e976fb8bf571d61e6337f5">getSplatValue</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;);</span></CodeLine>
<Link id="l06185" /><CodeLine lineNumber="6185"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;)</span></CodeLine>
<Link id="l06186" /><CodeLine lineNumber="6186"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06187" /><CodeLine lineNumber="6187"><span class="doxyHighlight">      RewriteGEP = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06188" /><CodeLine lineNumber="6188"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06189" /><CodeLine lineNumber="6189"></CodeLine>
<Link id="l06190" /><CodeLine lineNumber="6190"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FinalIndex = <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.size() - 1;</span></CodeLine>
<Link id="l06191" /><CodeLine lineNumber="6191"></CodeLine>
<Link id="l06192" /><CodeLine lineNumber="6192"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ensure all but the last index is 0</span></CodeLine>
<Link id="l06193" /><CodeLine lineNumber="6193"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: This isn&#39;t strictly required. All that&#39;s required is that they are</span></CodeLine>
<Link id="l06194" /><CodeLine lineNumber="6194"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// all scalars or splats.</span></CodeLine>
<Link id="l06195" /><CodeLine lineNumber="6195"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1; i &lt; FinalIndex; ++i) &#123;</span></CodeLine>
<Link id="l06196" /><CodeLine lineNumber="6196"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;i&#93;);</span></CodeLine>
<Link id="l06197" /><CodeLine lineNumber="6197"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</span></CodeLine>
<Link id="l06198" /><CodeLine lineNumber="6198"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06199" /><CodeLine lineNumber="6199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()))</span></CodeLine>
<Link id="l06200" /><CodeLine lineNumber="6200"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getSplatValue();</span></CodeLine>
<Link id="l06201" /><CodeLine lineNumber="6201"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l06202" /><CodeLine lineNumber="6202"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI || !CI-&gt;<a href="/docs/api/classes/llvm/constantint/#a882d55a6aa2028e1a5ad708b275334e0">isZero</a>())</span></CodeLine>
<Link id="l06203" /><CodeLine lineNumber="6203"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06204" /><CodeLine lineNumber="6204"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Scalarize the index if needed.</span></CodeLine>
<Link id="l06205" /><CodeLine lineNumber="6205"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;i&#93; = CI;</span></CodeLine>
<Link id="l06206" /><CodeLine lineNumber="6206"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06207" /><CodeLine lineNumber="6207"></CodeLine>
<Link id="l06208" /><CodeLine lineNumber="6208"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to scalarize the final index.</span></CodeLine>
<Link id="l06209" /><CodeLine lineNumber="6209"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;isVectorTy()) &#123;</span></CodeLine>
<Link id="l06210" /><CodeLine lineNumber="6210"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a48fc95f799e976fb8bf571d61e6337f5">getSplatValue</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;)) &#123;</span></CodeLine>
<Link id="l06211" /><CodeLine lineNumber="6211"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(V);</span></CodeLine>
<Link id="l06212" /><CodeLine lineNumber="6212"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Don&#39;t scalarize all zeros vector.</span></CodeLine>
<Link id="l06213" /><CodeLine lineNumber="6213"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> || !<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isZero()) &#123;</span></CodeLine>
<Link id="l06214" /><CodeLine lineNumber="6214"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93; = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l06215" /><CodeLine lineNumber="6215"><span class="doxyHighlight">          RewriteGEP = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06216" /><CodeLine lineNumber="6216"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06217" /><CodeLine lineNumber="6217"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06218" /><CodeLine lineNumber="6218"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06219" /><CodeLine lineNumber="6219"></CodeLine>
<Link id="l06220" /><CodeLine lineNumber="6220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we made any changes or the we have extra operands, we need to generate</span></CodeLine>
<Link id="l06221" /><CodeLine lineNumber="6221"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// new instructions.</span></CodeLine>
<Link id="l06222" /><CodeLine lineNumber="6222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RewriteGEP &amp;&amp; <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.size() == 2)</span></CodeLine>
<Link id="l06223" /><CodeLine lineNumber="6223"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06224" /><CodeLine lineNumber="6224"></CodeLine>
<Link id="l06225" /><CodeLine lineNumber="6225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType())-&gt;getElementCount();</span></CodeLine>
<Link id="l06226" /><CodeLine lineNumber="6226"></CodeLine>
<Link id="l06227" /><CodeLine lineNumber="6227"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(MemoryInst);</span></CodeLine>
<Link id="l06228" /><CodeLine lineNumber="6228"></CodeLine>
<Link id="l06229" /><CodeLine lineNumber="6229"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SourceTy = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType();</span></CodeLine>
<Link id="l06230" /><CodeLine lineNumber="6230"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScalarIndexTy = DL-&gt;getIndexType(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;getScalarType());</span></CodeLine>
<Link id="l06231" /><CodeLine lineNumber="6231"></CodeLine>
<Link id="l06232" /><CodeLine lineNumber="6232"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the final index isn&#39;t a vector, emit a scalar GEP containing all ops</span></CodeLine>
<Link id="l06233" /><CodeLine lineNumber="6233"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and a vector GEP with all zeroes final index.</span></CodeLine>
<Link id="l06234" /><CodeLine lineNumber="6234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;isVectorTy()) &#123;</span></CodeLine>
<Link id="l06235" /><CodeLine lineNumber="6235"><span class="doxyHighlight">      NewAddr = Builder.CreateGEP(SourceTy, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</span></CodeLine>
<Link id="l06236" /><CodeLine lineNumber="6236"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IndexTy = VectorType::get(ScalarIndexTy, NumElts);</span></CodeLine>
<Link id="l06237" /><CodeLine lineNumber="6237"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SecondTy = <a href="/docs/api/classes/llvm/getelementptrinst/#a99d4bfe49182f8d80abb1960f2c12d46">GetElementPtrInst::getIndexedType</a>(</span></CodeLine>
<Link id="l06238" /><CodeLine lineNumber="6238"><span class="doxyHighlight">          SourceTy, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</span></CodeLine>
<Link id="l06239" /><CodeLine lineNumber="6239"><span class="doxyHighlight">      NewAddr =</span></CodeLine>
<Link id="l06240" /><CodeLine lineNumber="6240"><span class="doxyHighlight">          Builder.CreateGEP(SecondTy, NewAddr, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(IndexTy));</span></CodeLine>
<Link id="l06241" /><CodeLine lineNumber="6241"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06242" /><CodeLine lineNumber="6242"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;;</span></CodeLine>
<Link id="l06243" /><CodeLine lineNumber="6243"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;;</span></CodeLine>
<Link id="l06244" /><CodeLine lineNumber="6244"></CodeLine>
<Link id="l06245" /><CodeLine lineNumber="6245"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Create a scalar GEP if there are more than 2 operands.</span></CodeLine>
<Link id="l06246" /><CodeLine lineNumber="6246"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.size() != 2) &#123;</span></CodeLine>
<Link id="l06247" /><CodeLine lineNumber="6247"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Replace the last index with 0</span></CodeLine>
<Link id="l06248" /><CodeLine lineNumber="6248"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93; =</span></CodeLine>
<Link id="l06249" /><CodeLine lineNumber="6249"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;FinalIndex&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;getScalarType());</span></CodeLine>
<Link id="l06250" /><CodeLine lineNumber="6250"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Builder.CreateGEP(SourceTy, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</span></CodeLine>
<Link id="l06251" /><CodeLine lineNumber="6251"><span class="doxyHighlight">        SourceTy = <a href="/docs/api/classes/llvm/getelementptrinst/#a99d4bfe49182f8d80abb1960f2c12d46">GetElementPtrInst::getIndexedType</a>(</span></CodeLine>
<Link id="l06252" /><CodeLine lineNumber="6252"><span class="doxyHighlight">            SourceTy, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;front());</span></CodeLine>
<Link id="l06253" /><CodeLine lineNumber="6253"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06254" /><CodeLine lineNumber="6254"></CodeLine>
<Link id="l06255" /><CodeLine lineNumber="6255"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Now create the GEP with scalar pointer and vector index.</span></CodeLine>
<Link id="l06256" /><CodeLine lineNumber="6256"><span class="doxyHighlight">      NewAddr = Builder.CreateGEP(SourceTy, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, Index);</span></CodeLine>
<Link id="l06257" /><CodeLine lineNumber="6257"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06258" /><CodeLine lineNumber="6258"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) &#123;</span></CodeLine>
<Link id="l06259" /><CodeLine lineNumber="6259"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Not a GEP, maybe its a splat and we can create a GEP to enable</span></CodeLine>
<Link id="l06260" /><CodeLine lineNumber="6260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SelectionDAGBuilder to use it as a uniform base.</span></CodeLine>
<Link id="l06261" /><CodeLine lineNumber="6261"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/#a48fc95f799e976fb8bf571d61e6337f5">getSplatValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l06262" /><CodeLine lineNumber="6262"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!V)</span></CodeLine>
<Link id="l06263" /><CodeLine lineNumber="6263"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06264" /><CodeLine lineNumber="6264"></CodeLine>
<Link id="l06265" /><CodeLine lineNumber="6265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType())-&gt;getElementCount();</span></CodeLine>
<Link id="l06266" /><CodeLine lineNumber="6266"></CodeLine>
<Link id="l06267" /><CodeLine lineNumber="6267"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(MemoryInst);</span></CodeLine>
<Link id="l06268" /><CodeLine lineNumber="6268"></CodeLine>
<Link id="l06269" /><CodeLine lineNumber="6269"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit a vector GEP with a scalar pointer and all 0s vector index.</span></CodeLine>
<Link id="l06270" /><CodeLine lineNumber="6270"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScalarIndexTy = DL-&gt;getIndexType(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;getScalarType());</span></CodeLine>
<Link id="l06271" /><CodeLine lineNumber="6271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IndexTy = VectorType::get(ScalarIndexTy, NumElts);</span></CodeLine>
<Link id="l06272" /><CodeLine lineNumber="6272"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScalarTy;</span></CodeLine>
<Link id="l06273" /><CodeLine lineNumber="6273"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(MemoryInst)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>() ==</span></CodeLine>
<Link id="l06274" /><CodeLine lineNumber="6274"><span class="doxyHighlight">        Intrinsic::masked&#95;gather) &#123;</span></CodeLine>
<Link id="l06275" /><CodeLine lineNumber="6275"><span class="doxyHighlight">      ScalarTy = MemoryInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</span></CodeLine>
<Link id="l06276" /><CodeLine lineNumber="6276"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06277" /><CodeLine lineNumber="6277"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(MemoryInst)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>() ==</span></CodeLine>
<Link id="l06278" /><CodeLine lineNumber="6278"><span class="doxyHighlight">             Intrinsic::masked&#95;scatter);</span></CodeLine>
<Link id="l06279" /><CodeLine lineNumber="6279"><span class="doxyHighlight">      ScalarTy = MemoryInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</span></CodeLine>
<Link id="l06280" /><CodeLine lineNumber="6280"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06281" /><CodeLine lineNumber="6281"><span class="doxyHighlight">    NewAddr = Builder.CreateGEP(ScalarTy, V, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(IndexTy));</span></CodeLine>
<Link id="l06282" /><CodeLine lineNumber="6282"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06283" /><CodeLine lineNumber="6283"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Constant, SelectionDAGBuilder knows to check if its a splat.</span></CodeLine>
<Link id="l06284" /><CodeLine lineNumber="6284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06285" /><CodeLine lineNumber="6285"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06286" /><CodeLine lineNumber="6286"></CodeLine>
<Link id="l06287" /><CodeLine lineNumber="6287"><span class="doxyHighlight">  MemoryInst-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, NewAddr);</span></CodeLine>
<Link id="l06288" /><CodeLine lineNumber="6288"></CodeLine>
<Link id="l06289" /><CodeLine lineNumber="6289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have no uses, recursively delete the value and all dead instructions</span></CodeLine>
<Link id="l06290" /><CodeLine lineNumber="6290"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// using it.</span></CodeLine>
<Link id="l06291" /><CodeLine lineNumber="6291"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;use&#95;empty())</span></CodeLine>
<Link id="l06292" /><CodeLine lineNumber="6292"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</span></CodeLine>
<Link id="l06293" /><CodeLine lineNumber="6293"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, TLInfo, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06294" /><CodeLine lineNumber="6294"><span class="doxyHighlight">        &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</span></CodeLine>
<Link id="l06295" /><CodeLine lineNumber="6295"></CodeLine>
<Link id="l06296" /><CodeLine lineNumber="6296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06297" /><CodeLine lineNumber="6297"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06298" /><CodeLine lineNumber="6298"></CodeLine>
<Link id="l06299" /><CodeLine lineNumber="6299"><span class="doxyHighlightComment">/// If there are any memory operands, use OptimizeMemoryInst to sink their</span></CodeLine>
<Link id="l06300" /><CodeLine lineNumber="6300"><span class="doxyHighlightComment">/// address computing into the block when possible / profitable.</span></CodeLine>
<Link id="l06301" /><CodeLine lineNumber="6301"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeInlineAsmInst(CallInst &#42;CS) &#123;</span></CodeLine>
<Link id="l06302" /><CodeLine lineNumber="6302"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06303" /><CodeLine lineNumber="6303"></CodeLine>
<Link id="l06304" /><CodeLine lineNumber="6304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetRegisterInfo &#42;TRI =</span></CodeLine>
<Link id="l06305" /><CodeLine lineNumber="6305"><span class="doxyHighlight">      TM-&gt;getSubtargetImpl(&#42;CS-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())-&gt;getRegisterInfo();</span></CodeLine>
<Link id="l06306" /><CodeLine lineNumber="6306"><span class="doxyHighlight">  TargetLowering::AsmOperandInfoVector TargetConstraints =</span></CodeLine>
<Link id="l06307" /><CodeLine lineNumber="6307"><span class="doxyHighlight">      TLI-&gt;ParseConstraints(&#42;DL, TRI, &#42;CS);</span></CodeLine>
<Link id="l06308" /><CodeLine lineNumber="6308"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgNo = 0;</span></CodeLine>
<Link id="l06309" /><CodeLine lineNumber="6309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (TargetLowering::AsmOperandInfo &amp;OpInfo : TargetConstraints) &#123;</span></CodeLine>
<Link id="l06310" /><CodeLine lineNumber="6310"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the constraint code and ConstraintType to use.</span></CodeLine>
<Link id="l06311" /><CodeLine lineNumber="6311"><span class="doxyHighlight">    TLI-&gt;ComputeConstraintToUse(OpInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>());</span></CodeLine>
<Link id="l06312" /><CodeLine lineNumber="6312"></CodeLine>
<Link id="l06313" /><CodeLine lineNumber="6313"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Also handle C&#95;Address?</span></CodeLine>
<Link id="l06314" /><CodeLine lineNumber="6314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpInfo.ConstraintType == TargetLowering::C&#95;Memory &amp;&amp;</span></CodeLine>
<Link id="l06315" /><CodeLine lineNumber="6315"><span class="doxyHighlight">        OpInfo.isIndirect) &#123;</span></CodeLine>
<Link id="l06316" /><CodeLine lineNumber="6316"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OpVal = CS-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(ArgNo++);</span></CodeLine>
<Link id="l06317" /><CodeLine lineNumber="6317"><span class="doxyHighlight">      MadeChange |= optimizeMemoryInst(CS, OpVal, OpVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), ~0u);</span></CodeLine>
<Link id="l06318" /><CodeLine lineNumber="6318"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpInfo.Type == <a href="/docs/api/classes/llvm/inlineasm/#a511f48809ad14f13e50b957a137a9d34a79ca3881430605a6c7da5227cfb115d6">InlineAsm::isInput</a>)</span></CodeLine>
<Link id="l06319" /><CodeLine lineNumber="6319"><span class="doxyHighlight">      ArgNo++;</span></CodeLine>
<Link id="l06320" /><CodeLine lineNumber="6320"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06321" /><CodeLine lineNumber="6321"></CodeLine>
<Link id="l06322" /><CodeLine lineNumber="6322"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l06323" /><CodeLine lineNumber="6323"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06324" /><CodeLine lineNumber="6324"></CodeLine>
<Link id="l06325" /><CodeLine lineNumber="6325"><span class="doxyHighlightComment">/// Check if all the uses of \\p Val are equivalent (or free) zero or</span></CodeLine>
<Link id="l06326" /><CodeLine lineNumber="6326"><span class="doxyHighlightComment">/// sign extensions.</span></CodeLine>
<Link id="l06327" /><CodeLine lineNumber="6327" lineLink="#ae965d93aa46ad834c21718eba4b5b78e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l06328" /><CodeLine lineNumber="6328"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Val-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Input must have at least one use&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06329" /><CodeLine lineNumber="6329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FirstUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;Val-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>());</span></CodeLine>
<Link id="l06330" /><CodeLine lineNumber="6330"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSExt = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(FirstUser);</span></CodeLine>
<Link id="l06331" /><CodeLine lineNumber="6331"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ExtTy = FirstUser-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l06332" /><CodeLine lineNumber="6332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : Val-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l06333" /><CodeLine lineNumber="6333"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l06334" /><CodeLine lineNumber="6334"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((IsSExt &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(UI)) || (!IsSExt &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(UI)))</span></CodeLine>
<Link id="l06335" /><CodeLine lineNumber="6335"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06336" /><CodeLine lineNumber="6336"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;CurTy = UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l06337" /><CodeLine lineNumber="6337"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Same input and output types: Same instruction after CSE.</span></CodeLine>
<Link id="l06338" /><CodeLine lineNumber="6338"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurTy == ExtTy)</span></CodeLine>
<Link id="l06339" /><CodeLine lineNumber="6339"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06340" /><CodeLine lineNumber="6340"></CodeLine>
<Link id="l06341" /><CodeLine lineNumber="6341"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If IsSExt is true, we are in this situation:</span></CodeLine>
<Link id="l06342" /><CodeLine lineNumber="6342"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a = Val</span></CodeLine>
<Link id="l06343" /><CodeLine lineNumber="6343"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// b = sext ty1 a to ty2</span></CodeLine>
<Link id="l06344" /><CodeLine lineNumber="6344"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// c = sext ty1 a to ty3</span></CodeLine>
<Link id="l06345" /><CodeLine lineNumber="6345"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Assuming ty2 is shorter than ty3, this could be turned into:</span></CodeLine>
<Link id="l06346" /><CodeLine lineNumber="6346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a = Val</span></CodeLine>
<Link id="l06347" /><CodeLine lineNumber="6347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// b = sext ty1 a to ty2</span></CodeLine>
<Link id="l06348" /><CodeLine lineNumber="6348"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// c = sext ty2 b to ty3</span></CodeLine>
<Link id="l06349" /><CodeLine lineNumber="6349"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// However, the last sext is not free.</span></CodeLine>
<Link id="l06350" /><CodeLine lineNumber="6350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSExt)</span></CodeLine>
<Link id="l06351" /><CodeLine lineNumber="6351"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06352" /><CodeLine lineNumber="6352"></CodeLine>
<Link id="l06353" /><CodeLine lineNumber="6353"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is a ZExt, maybe this is free to extend from one type to another.</span></CodeLine>
<Link id="l06354" /><CodeLine lineNumber="6354"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In that case, we would not account for a different use.</span></CodeLine>
<Link id="l06355" /><CodeLine lineNumber="6355"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;NarrowTy;</span></CodeLine>
<Link id="l06356" /><CodeLine lineNumber="6356"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;LargeTy;</span></CodeLine>
<Link id="l06357" /><CodeLine lineNumber="6357"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;</span></CodeLine>
<Link id="l06358" /><CodeLine lineNumber="6358"><span class="doxyHighlight">        CurTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()) &#123;</span></CodeLine>
<Link id="l06359" /><CodeLine lineNumber="6359"><span class="doxyHighlight">      NarrowTy = CurTy;</span></CodeLine>
<Link id="l06360" /><CodeLine lineNumber="6360"><span class="doxyHighlight">      LargeTy = ExtTy;</span></CodeLine>
<Link id="l06361" /><CodeLine lineNumber="6361"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06362" /><CodeLine lineNumber="6362"><span class="doxyHighlight">      NarrowTy = ExtTy;</span></CodeLine>
<Link id="l06363" /><CodeLine lineNumber="6363"><span class="doxyHighlight">      LargeTy = CurTy;</span></CodeLine>
<Link id="l06364" /><CodeLine lineNumber="6364"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06365" /><CodeLine lineNumber="6365"></CodeLine>
<Link id="l06366" /><CodeLine lineNumber="6366"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#a342be90695496b88a8854a775dfd030f">isZExtFree</a>(NarrowTy, LargeTy))</span></CodeLine>
<Link id="l06367" /><CodeLine lineNumber="6367"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06368" /><CodeLine lineNumber="6368"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06369" /><CodeLine lineNumber="6369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All uses are the same or can be derived from one another for free.</span></CodeLine>
<Link id="l06370" /><CodeLine lineNumber="6370"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06371" /><CodeLine lineNumber="6371"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06372" /><CodeLine lineNumber="6372"></CodeLine>
<Link id="l06373" /><CodeLine lineNumber="6373"><span class="doxyHighlightComment">/// Try to speculatively promote extensions in \\p Exts and continue</span></CodeLine>
<Link id="l06374" /><CodeLine lineNumber="6374"><span class="doxyHighlightComment">/// promoting through newly promoted operands recursively as far as doing so is</span></CodeLine>
<Link id="l06375" /><CodeLine lineNumber="6375"><span class="doxyHighlightComment">/// profitable. Save extensions profitably moved up, in \\p ProfitablyMovedExts.</span></CodeLine>
<Link id="l06376" /><CodeLine lineNumber="6376"><span class="doxyHighlightComment">/// When some promotion happened, \\p TPT contains the proper state to revert</span></CodeLine>
<Link id="l06377" /><CodeLine lineNumber="6377"><span class="doxyHighlightComment">/// them.</span></CodeLine>
<Link id="l06378" /><CodeLine lineNumber="6378"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l06379" /><CodeLine lineNumber="6379"><span class="doxyHighlightComment">/// \\return true if some promotion happened, false otherwise.</span></CodeLine>
<Link id="l06380" /><CodeLine lineNumber="6380"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::tryToPromoteExts(</span></CodeLine>
<Link id="l06381" /><CodeLine lineNumber="6381"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;Exts,</span></CodeLine>
<Link id="l06382" /><CodeLine lineNumber="6382"><span class="doxyHighlight">    SmallVectorImpl&lt;Instruction &#42;&gt; &amp;ProfitablyMovedExts,</span></CodeLine>
<Link id="l06383" /><CodeLine lineNumber="6383"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CreatedInstsCost) &#123;</span></CodeLine>
<Link id="l06384" /><CodeLine lineNumber="6384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Promoted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06385" /><CodeLine lineNumber="6385"></CodeLine>
<Link id="l06386" /><CodeLine lineNumber="6386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over all the extensions to try to promote them.</span></CodeLine>
<Link id="l06387" /><CodeLine lineNumber="6387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Exts) &#123;</span></CodeLine>
<Link id="l06388" /><CodeLine lineNumber="6388"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Early check if we directly have ext(load).</span></CodeLine>
<Link id="l06389" /><CodeLine lineNumber="6389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0))) &#123;</span></CodeLine>
<Link id="l06390" /><CodeLine lineNumber="6390"><span class="doxyHighlight">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06391" /><CodeLine lineNumber="6391"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06392" /><CodeLine lineNumber="6392"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06393" /><CodeLine lineNumber="6393"></CodeLine>
<Link id="l06394" /><CodeLine lineNumber="6394"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check whether or not we want to do any promotion.  The reason we have</span></CodeLine>
<Link id="l06395" /><CodeLine lineNumber="6395"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this check inside the for loop is to catch the case where an extension</span></CodeLine>
<Link id="l06396" /><CodeLine lineNumber="6396"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is directly fed by a load because in such case the extension can be moved</span></CodeLine>
<Link id="l06397" /><CodeLine lineNumber="6397"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// up without any promotion on its operands.</span></CodeLine>
<Link id="l06398" /><CodeLine lineNumber="6398"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI-&gt;enableExtLdPromotion() || <a href="#a337eb74e6c82771bb21ce598a8d3090c">DisableExtLdPromotion</a>)</span></CodeLine>
<Link id="l06399" /><CodeLine lineNumber="6399"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06400" /><CodeLine lineNumber="6400"></CodeLine>
<Link id="l06401" /><CodeLine lineNumber="6401"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the action to perform the promotion.</span></CodeLine>
<Link id="l06402" /><CodeLine lineNumber="6402"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#ada40299269e8b441bab738dc14ad0c1e">TypePromotionHelper::Action</a> TPH =</span></CodeLine>
<Link id="l06403" /><CodeLine lineNumber="6403"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotionhelper/#a6df9b95e8bacacbad0035f25c46d2581">TypePromotionHelper::getAction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, InsertedInsts, &#42;TLI, PromotedInsts);</span></CodeLine>
<Link id="l06404" /><CodeLine lineNumber="6404"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if we can promote.</span></CodeLine>
<Link id="l06405" /><CodeLine lineNumber="6405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TPH) &#123;</span></CodeLine>
<Link id="l06406" /><CodeLine lineNumber="6406"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Save the current extension as we cannot move up through its operand.</span></CodeLine>
<Link id="l06407" /><CodeLine lineNumber="6407"><span class="doxyHighlight">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06408" /><CodeLine lineNumber="6408"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06409" /><CodeLine lineNumber="6409"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06410" /><CodeLine lineNumber="6410"></CodeLine>
<Link id="l06411" /><CodeLine lineNumber="6411"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the current state.</span></CodeLine>
<Link id="l06412" /><CodeLine lineNumber="6412"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</span></CodeLine>
<Link id="l06413" /><CodeLine lineNumber="6413"><span class="doxyHighlight">        TPT.getRestorationPoint();</span></CodeLine>
<Link id="l06414" /><CodeLine lineNumber="6414"><span class="doxyHighlight">    SmallVector&lt;Instruction &#42;, 4&gt; NewExts;</span></CodeLine>
<Link id="l06415" /><CodeLine lineNumber="6415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewCreatedInstsCost = 0;</span></CodeLine>
<Link id="l06416" /><CodeLine lineNumber="6416"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExtCost = !TLI-&gt;isExtFree(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06417" /><CodeLine lineNumber="6417"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Promote.</span></CodeLine>
<Link id="l06418" /><CodeLine lineNumber="6418"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PromotedVal = TPH(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TPT, PromotedInsts, NewCreatedInstsCost,</span></CodeLine>
<Link id="l06419" /><CodeLine lineNumber="6419"><span class="doxyHighlight">                             &amp;NewExts, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;TLI);</span></CodeLine>
<Link id="l06420" /><CodeLine lineNumber="6420"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromotedVal &amp;&amp;</span></CodeLine>
<Link id="l06421" /><CodeLine lineNumber="6421"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;TypePromotionHelper should have filtered out those cases&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06422" /><CodeLine lineNumber="6422"></CodeLine>
<Link id="l06423" /><CodeLine lineNumber="6423"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We would be able to merge only one extension in a load.</span></CodeLine>
<Link id="l06424" /><CodeLine lineNumber="6424"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Therefore, if we have more than 1 new extension we heuristically</span></CodeLine>
<Link id="l06425" /><CodeLine lineNumber="6425"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cut this search path, because it means we degrade the code quality.</span></CodeLine>
<Link id="l06426" /><CodeLine lineNumber="6426"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// With exactly 2, the transformation is neutral, because we will merge</span></CodeLine>
<Link id="l06427" /><CodeLine lineNumber="6427"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// one extension but leave one. However, we optimistically keep going,</span></CodeLine>
<Link id="l06428" /><CodeLine lineNumber="6428"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// because the new extension may be removed too. Also avoid replacing a</span></CodeLine>
<Link id="l06429" /><CodeLine lineNumber="6429"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// single free extension with multiple extensions, as this increases the</span></CodeLine>
<Link id="l06430" /><CodeLine lineNumber="6430"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// number of IR instructions while not providing any savings.</span></CodeLine>
<Link id="l06431" /><CodeLine lineNumber="6431"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight"> TotalCreatedInstsCost = CreatedInstsCost + NewCreatedInstsCost;</span></CodeLine>
<Link id="l06432" /><CodeLine lineNumber="6432"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: It would be possible to propagate a negative value instead of</span></CodeLine>
<Link id="l06433" /><CodeLine lineNumber="6433"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// conservatively ceiling it to 0</span></CodeLine>
<Link id="l06434" /><CodeLine lineNumber="6434"><span class="doxyHighlight">    TotalCreatedInstsCost =</span></CodeLine>
<Link id="l06435" /><CodeLine lineNumber="6435"><span class="doxyHighlight">        std::max((</span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight">)0, (TotalCreatedInstsCost - ExtCost));</span></CodeLine>
<Link id="l06436" /><CodeLine lineNumber="6436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a> &amp;&amp;</span></CodeLine>
<Link id="l06437" /><CodeLine lineNumber="6437"><span class="doxyHighlight">        (TotalCreatedInstsCost &gt; 1 ||</span></CodeLine>
<Link id="l06438" /><CodeLine lineNumber="6438"><span class="doxyHighlight">         !<a href="#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(&#42;TLI, &#42;DL, PromotedVal) ||</span></CodeLine>
<Link id="l06439" /><CodeLine lineNumber="6439"><span class="doxyHighlight">         (ExtCost == 0 &amp;&amp; NewExts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 1))) &#123;</span></CodeLine>
<Link id="l06440" /><CodeLine lineNumber="6440"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This promotion is not profitable, rollback to the previous state, and</span></CodeLine>
<Link id="l06441" /><CodeLine lineNumber="6441"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// save the current extension in ProfitablyMovedExts as the latest</span></CodeLine>
<Link id="l06442" /><CodeLine lineNumber="6442"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// speculative promotion turned out to be unprofitable.</span></CodeLine>
<Link id="l06443" /><CodeLine lineNumber="6443"><span class="doxyHighlight">      TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l06444" /><CodeLine lineNumber="6444"><span class="doxyHighlight">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06445" /><CodeLine lineNumber="6445"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06446" /><CodeLine lineNumber="6446"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06447" /><CodeLine lineNumber="6447"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Continue promoting NewExts as far as doing so is profitable.</span></CodeLine>
<Link id="l06448" /><CodeLine lineNumber="6448"><span class="doxyHighlight">    SmallVector&lt;Instruction &#42;, 2&gt; NewlyMovedExts;</span></CodeLine>
<Link id="l06449" /><CodeLine lineNumber="6449"><span class="doxyHighlight">    (void)tryToPromoteExts(TPT, NewExts, NewlyMovedExts, TotalCreatedInstsCost);</span></CodeLine>
<Link id="l06450" /><CodeLine lineNumber="6450"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NewPromoted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06451" /><CodeLine lineNumber="6451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExtInst : NewlyMovedExts) &#123;</span></CodeLine>
<Link id="l06452" /><CodeLine lineNumber="6452"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;MovedExt = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ExtInst);</span></CodeLine>
<Link id="l06453" /><CodeLine lineNumber="6453"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ExtOperand = MovedExt-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l06454" /><CodeLine lineNumber="6454"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we have reached to a load, we need this extra profitability check</span></CodeLine>
<Link id="l06455" /><CodeLine lineNumber="6455"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// as it could potentially be merged into an ext(load).</span></CodeLine>
<Link id="l06456" /><CodeLine lineNumber="6456"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(ExtOperand) &amp;&amp;</span></CodeLine>
<Link id="l06457" /><CodeLine lineNumber="6457"><span class="doxyHighlight">          !(<a href="#aeabb375be2dc51a3d518b9d2a1140fe6">StressExtLdPromotion</a> || NewCreatedInstsCost &lt;= ExtCost ||</span></CodeLine>
<Link id="l06458" /><CodeLine lineNumber="6458"><span class="doxyHighlight">            (ExtOperand-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || <a href="#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a>(ExtOperand, &#42;TLI))))</span></CodeLine>
<Link id="l06459" /><CodeLine lineNumber="6459"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06460" /><CodeLine lineNumber="6460"></CodeLine>
<Link id="l06461" /><CodeLine lineNumber="6461"><span class="doxyHighlight">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MovedExt);</span></CodeLine>
<Link id="l06462" /><CodeLine lineNumber="6462"><span class="doxyHighlight">      NewPromoted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06463" /><CodeLine lineNumber="6463"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06464" /><CodeLine lineNumber="6464"></CodeLine>
<Link id="l06465" /><CodeLine lineNumber="6465"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If none of speculative promotions for NewExts is profitable, rollback</span></CodeLine>
<Link id="l06466" /><CodeLine lineNumber="6466"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and save the current extension (I) as the last profitable extension.</span></CodeLine>
<Link id="l06467" /><CodeLine lineNumber="6467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewPromoted) &#123;</span></CodeLine>
<Link id="l06468" /><CodeLine lineNumber="6468"><span class="doxyHighlight">      TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l06469" /><CodeLine lineNumber="6469"><span class="doxyHighlight">      ProfitablyMovedExts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06470" /><CodeLine lineNumber="6470"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06471" /><CodeLine lineNumber="6471"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06472" /><CodeLine lineNumber="6472"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The promotion is profitable.</span></CodeLine>
<Link id="l06473" /><CodeLine lineNumber="6473"><span class="doxyHighlight">    Promoted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06474" /><CodeLine lineNumber="6474"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06475" /><CodeLine lineNumber="6475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Promoted;</span></CodeLine>
<Link id="l06476" /><CodeLine lineNumber="6476"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06477" /><CodeLine lineNumber="6477"></CodeLine>
<Link id="l06478" /><CodeLine lineNumber="6478"><span class="doxyHighlightComment">/// Merging redundant sexts when one is dominating the other.</span></CodeLine>
<Link id="l06479" /><CodeLine lineNumber="6479"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::mergeSExts(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l06480" /><CodeLine lineNumber="6480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06481" /><CodeLine lineNumber="6481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Entry : ValToSExtendedUses) &#123;</span></CodeLine>
<Link id="l06482" /><CodeLine lineNumber="6482"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321">SExts</a> &amp;Insts = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.second;</span></CodeLine>
<Link id="l06483" /><CodeLine lineNumber="6483"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a39372a34e372fce1ccba39f132e45321">SExts</a> CurPts;</span></CodeLine>
<Link id="l06484" /><CodeLine lineNumber="6484"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;Inst : Insts) &#123;</span></CodeLine>
<Link id="l06485" /><CodeLine lineNumber="6485"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RemovedInsts.count(Inst) || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(Inst) ||</span></CodeLine>
<Link id="l06486" /><CodeLine lineNumber="6486"><span class="doxyHighlight">          Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first)</span></CodeLine>
<Link id="l06487" /><CodeLine lineNumber="6487"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06488" /><CodeLine lineNumber="6488"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> inserted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06489" /><CodeLine lineNumber="6489"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pt : CurPts) &#123;</span></CodeLine>
<Link id="l06490" /><CodeLine lineNumber="6490"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).<a href="/docs/api/files/lib/lib/codegen/regallocfast-cpp/#a73ba38b119a12eb092295458fde44f52">dominates</a>(Inst, Pt)) &#123;</span></CodeLine>
<Link id="l06491" /><CodeLine lineNumber="6491"><span class="doxyHighlight">          <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Pt, Inst, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l06492" /><CodeLine lineNumber="6492"><span class="doxyHighlight">          RemovedInsts.insert(Pt);</span></CodeLine>
<Link id="l06493" /><CodeLine lineNumber="6493"><span class="doxyHighlight">          Pt-&gt;removeFromParent();</span></CodeLine>
<Link id="l06494" /><CodeLine lineNumber="6494"><span class="doxyHighlight">          Pt = Inst;</span></CodeLine>
<Link id="l06495" /><CodeLine lineNumber="6495"><span class="doxyHighlight">          inserted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06496" /><CodeLine lineNumber="6496"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06497" /><CodeLine lineNumber="6497"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06498" /><CodeLine lineNumber="6498"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06499" /><CodeLine lineNumber="6499"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!getDT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).<a href="/docs/api/files/lib/lib/codegen/regallocfast-cpp/#a73ba38b119a12eb092295458fde44f52">dominates</a>(Pt, Inst))</span></CodeLine>
<Link id="l06500" /><CodeLine lineNumber="6500"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Give up if we need to merge in a common dominator as the</span></CodeLine>
<Link id="l06501" /><CodeLine lineNumber="6501"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// experiments show it is not profitable.</span></CodeLine>
<Link id="l06502" /><CodeLine lineNumber="6502"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06503" /><CodeLine lineNumber="6503"><span class="doxyHighlight">        <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Inst, Pt, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l06504" /><CodeLine lineNumber="6504"><span class="doxyHighlight">        RemovedInsts.insert(Inst);</span></CodeLine>
<Link id="l06505" /><CodeLine lineNumber="6505"><span class="doxyHighlight">        Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l06506" /><CodeLine lineNumber="6506"><span class="doxyHighlight">        inserted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06507" /><CodeLine lineNumber="6507"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06508" /><CodeLine lineNumber="6508"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06509" /><CodeLine lineNumber="6509"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06510" /><CodeLine lineNumber="6510"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!inserted)</span></CodeLine>
<Link id="l06511" /><CodeLine lineNumber="6511"><span class="doxyHighlight">        CurPts.push&#95;back(Inst);</span></CodeLine>
<Link id="l06512" /><CodeLine lineNumber="6512"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06513" /><CodeLine lineNumber="6513"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06514" /><CodeLine lineNumber="6514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l06515" /><CodeLine lineNumber="6515"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06516" /><CodeLine lineNumber="6516"></CodeLine>
<Link id="l06517" /><CodeLine lineNumber="6517"><span class="doxyHighlightComment">// Splitting large data structures so that the GEPs accessing them can have</span></CodeLine>
<Link id="l06518" /><CodeLine lineNumber="6518"><span class="doxyHighlightComment">// smaller offsets so that they can be sunk to the same blocks as their users.</span></CodeLine>
<Link id="l06519" /><CodeLine lineNumber="6519"><span class="doxyHighlightComment">// For example, a large struct starting from %base is split into two parts</span></CodeLine>
<Link id="l06520" /><CodeLine lineNumber="6520"><span class="doxyHighlightComment">// where the second part starts from %new&#95;base.</span></CodeLine>
<Link id="l06521" /><CodeLine lineNumber="6521"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l06522" /><CodeLine lineNumber="6522"><span class="doxyHighlightComment">// Before:</span></CodeLine>
<Link id="l06523" /><CodeLine lineNumber="6523"><span class="doxyHighlightComment">// BB0:</span></CodeLine>
<Link id="l06524" /><CodeLine lineNumber="6524"><span class="doxyHighlightComment">//   %base     =</span></CodeLine>
<Link id="l06525" /><CodeLine lineNumber="6525"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l06526" /><CodeLine lineNumber="6526"><span class="doxyHighlightComment">// BB1:</span></CodeLine>
<Link id="l06527" /><CodeLine lineNumber="6527"><span class="doxyHighlightComment">//   %gep0     = gep %base, off0</span></CodeLine>
<Link id="l06528" /><CodeLine lineNumber="6528"><span class="doxyHighlightComment">//   %gep1     = gep %base, off1</span></CodeLine>
<Link id="l06529" /><CodeLine lineNumber="6529"><span class="doxyHighlightComment">//   %gep2     = gep %base, off2</span></CodeLine>
<Link id="l06530" /><CodeLine lineNumber="6530"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l06531" /><CodeLine lineNumber="6531"><span class="doxyHighlightComment">// BB2:</span></CodeLine>
<Link id="l06532" /><CodeLine lineNumber="6532"><span class="doxyHighlightComment">//   %load1    = load %gep0</span></CodeLine>
<Link id="l06533" /><CodeLine lineNumber="6533"><span class="doxyHighlightComment">//   %load2    = load %gep1</span></CodeLine>
<Link id="l06534" /><CodeLine lineNumber="6534"><span class="doxyHighlightComment">//   %load3    = load %gep2</span></CodeLine>
<Link id="l06535" /><CodeLine lineNumber="6535"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l06536" /><CodeLine lineNumber="6536"><span class="doxyHighlightComment">// After:</span></CodeLine>
<Link id="l06537" /><CodeLine lineNumber="6537"><span class="doxyHighlightComment">// BB0:</span></CodeLine>
<Link id="l06538" /><CodeLine lineNumber="6538"><span class="doxyHighlightComment">//   %base     =</span></CodeLine>
<Link id="l06539" /><CodeLine lineNumber="6539"><span class="doxyHighlightComment">//   %new&#95;base = gep %base, off0</span></CodeLine>
<Link id="l06540" /><CodeLine lineNumber="6540"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l06541" /><CodeLine lineNumber="6541"><span class="doxyHighlightComment">// BB1:</span></CodeLine>
<Link id="l06542" /><CodeLine lineNumber="6542"><span class="doxyHighlightComment">//   %new&#95;gep0 = %new&#95;base</span></CodeLine>
<Link id="l06543" /><CodeLine lineNumber="6543"><span class="doxyHighlightComment">//   %new&#95;gep1 = gep %new&#95;base, off1 - off0</span></CodeLine>
<Link id="l06544" /><CodeLine lineNumber="6544"><span class="doxyHighlightComment">//   %new&#95;gep2 = gep %new&#95;base, off2 - off0</span></CodeLine>
<Link id="l06545" /><CodeLine lineNumber="6545"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l06546" /><CodeLine lineNumber="6546"><span class="doxyHighlightComment">// BB2:</span></CodeLine>
<Link id="l06547" /><CodeLine lineNumber="6547"><span class="doxyHighlightComment">//   %load1    = load i32, i32&#42; %new&#95;gep0</span></CodeLine>
<Link id="l06548" /><CodeLine lineNumber="6548"><span class="doxyHighlightComment">//   %load2    = load i32, i32&#42; %new&#95;gep1</span></CodeLine>
<Link id="l06549" /><CodeLine lineNumber="6549"><span class="doxyHighlightComment">//   %load3    = load i32, i32&#42; %new&#95;gep2</span></CodeLine>
<Link id="l06550" /><CodeLine lineNumber="6550"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l06551" /><CodeLine lineNumber="6551"><span class="doxyHighlightComment">// %new&#95;gep1 and %new&#95;gep2 can be sunk to BB2 now after the splitting because</span></CodeLine>
<Link id="l06552" /><CodeLine lineNumber="6552"><span class="doxyHighlightComment">// their offsets are smaller enough to fit into the addressing mode.</span></CodeLine>
<Link id="l06553" /><CodeLine lineNumber="6553"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::splitLargeGEPOffsets() &#123;</span></CodeLine>
<Link id="l06554" /><CodeLine lineNumber="6554"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06555" /><CodeLine lineNumber="6555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Entry : LargeOffsetGEPMap) &#123;</span></CodeLine>
<Link id="l06556" /><CodeLine lineNumber="6556"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldBase = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first;</span></CodeLine>
<Link id="l06557" /><CodeLine lineNumber="6557"><span class="doxyHighlight">    SmallVectorImpl&lt;std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64&#95;t&gt;&gt;</span></CodeLine>
<Link id="l06558" /><CodeLine lineNumber="6558"><span class="doxyHighlight">        &amp;LargeOffsetGEPs = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.second;</span></CodeLine>
<Link id="l06559" /><CodeLine lineNumber="6559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> compareGEPOffset =</span></CodeLine>
<Link id="l06560" /><CodeLine lineNumber="6560"><span class="doxyHighlight">        &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::pair&lt;GetElementPtrInst &#42;, int64&#95;t&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l06561" /><CodeLine lineNumber="6561"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::pair&lt;GetElementPtrInst &#42;, int64&#95;t&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l06562" /><CodeLine lineNumber="6562"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.first == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.first)</span></CodeLine>
<Link id="l06563" /><CodeLine lineNumber="6563"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06564" /><CodeLine lineNumber="6564"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.second != <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.second)</span></CodeLine>
<Link id="l06565" /><CodeLine lineNumber="6565"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.second &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.second;</span></CodeLine>
<Link id="l06566" /><CodeLine lineNumber="6566"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LargeOffsetGEPID&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.first&#93; &lt; LargeOffsetGEPID&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.first&#93;;</span></CodeLine>
<Link id="l06567" /><CodeLine lineNumber="6567"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l06568" /><CodeLine lineNumber="6568"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Sorting all the GEPs of the same data structures based on the offsets.</span></CodeLine>
<Link id="l06569" /><CodeLine lineNumber="6569"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(LargeOffsetGEPs, compareGEPOffset);</span></CodeLine>
<Link id="l06570" /><CodeLine lineNumber="6570"><span class="doxyHighlight">    LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(<a href="/docs/api/namespaces/llvm/#a48f85da577c6ce7d9aed90437dc0d07c">llvm::unique</a>(LargeOffsetGEPs), LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l06571" /><CodeLine lineNumber="6571"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip if all the GEPs have the same offsets.</span></CodeLine>
<Link id="l06572" /><CodeLine lineNumber="6572"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>().second == LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second)</span></CodeLine>
<Link id="l06573" /><CodeLine lineNumber="6573"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06574" /><CodeLine lineNumber="6574"><span class="doxyHighlight">    GetElementPtrInst &#42;BaseGEP = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()-&gt;first;</span></CodeLine>
<Link id="l06575" /><CodeLine lineNumber="6575"><span class="doxyHighlight">    int64&#95;t BaseOffset = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()-&gt;second;</span></CodeLine>
<Link id="l06576" /><CodeLine lineNumber="6576"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewBaseGEP = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06577" /><CodeLine lineNumber="6577"></CodeLine>
<Link id="l06578" /><CodeLine lineNumber="6578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> createNewBase = &#91;&amp;&#93;(int64&#95;t BaseOffset, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldBase,</span></CodeLine>
<Link id="l06579" /><CodeLine lineNumber="6579"><span class="doxyHighlight">                             GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) &#123;</span></CodeLine>
<Link id="l06580" /><CodeLine lineNumber="6580"><span class="doxyHighlight">      LLVMContext &amp;Ctx = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getContext();</span></CodeLine>
<Link id="l06581" /><CodeLine lineNumber="6581"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PtrIdxTy = DL-&gt;getIndexType(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</span></CodeLine>
<Link id="l06582" /><CodeLine lineNumber="6582"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I8PtrTy =</span></CodeLine>
<Link id="l06583" /><CodeLine lineNumber="6583"><span class="doxyHighlight">          PointerType::get(Ctx, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType()-&gt;getPointerAddressSpace());</span></CodeLine>
<Link id="l06584" /><CodeLine lineNumber="6584"></CodeLine>
<Link id="l06585" /><CodeLine lineNumber="6585"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> NewBaseInsertPt;</span></CodeLine>
<Link id="l06586" /><CodeLine lineNumber="6586"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewBaseInsertBB;</span></CodeLine>
<Link id="l06587" /><CodeLine lineNumber="6587"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BaseI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(OldBase)) &#123;</span></CodeLine>
<Link id="l06588" /><CodeLine lineNumber="6588"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the base of the struct is an instruction, the new base will be</span></CodeLine>
<Link id="l06589" /><CodeLine lineNumber="6589"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// inserted close to it.</span></CodeLine>
<Link id="l06590" /><CodeLine lineNumber="6590"><span class="doxyHighlight">        NewBaseInsertBB = BaseI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l06591" /><CodeLine lineNumber="6591"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BaseI))</span></CodeLine>
<Link id="l06592" /><CodeLine lineNumber="6592"><span class="doxyHighlight">          NewBaseInsertPt = NewBaseInsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l06593" /><CodeLine lineNumber="6593"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvokeInst &#42;Invoke = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(BaseI)) &#123;</span></CodeLine>
<Link id="l06594" /><CodeLine lineNumber="6594"><span class="doxyHighlight">          NewBaseInsertBB =</span></CodeLine>
<Link id="l06595" /><CodeLine lineNumber="6595"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#adf83581f514774264d616eef5706cf6e">SplitEdge</a>(NewBaseInsertBB, Invoke-&gt;getNormalDest(), DT.get(), LI);</span></CodeLine>
<Link id="l06596" /><CodeLine lineNumber="6596"><span class="doxyHighlight">          NewBaseInsertPt = NewBaseInsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l06597" /><CodeLine lineNumber="6597"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06598" /><CodeLine lineNumber="6598"><span class="doxyHighlight">          NewBaseInsertPt = std::next(BaseI-&gt;getIterator());</span></CodeLine>
<Link id="l06599" /><CodeLine lineNumber="6599"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06600" /><CodeLine lineNumber="6600"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the current base is an argument or global value, the new base</span></CodeLine>
<Link id="l06601" /><CodeLine lineNumber="6601"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// will be inserted to the entry block.</span></CodeLine>
<Link id="l06602" /><CodeLine lineNumber="6602"><span class="doxyHighlight">        NewBaseInsertBB = &amp;BaseGEP-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>();</span></CodeLine>
<Link id="l06603" /><CodeLine lineNumber="6603"><span class="doxyHighlight">        NewBaseInsertPt = NewBaseInsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l06604" /><CodeLine lineNumber="6604"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06605" /><CodeLine lineNumber="6605"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> NewBaseBuilder(NewBaseInsertBB, NewBaseInsertPt);</span></CodeLine>
<Link id="l06606" /><CodeLine lineNumber="6606"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Create a new base.</span></CodeLine>
<Link id="l06607" /><CodeLine lineNumber="6607"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseIndex = ConstantInt::get(PtrIdxTy, BaseOffset);</span></CodeLine>
<Link id="l06608" /><CodeLine lineNumber="6608"><span class="doxyHighlight">      NewBaseGEP = OldBase;</span></CodeLine>
<Link id="l06609" /><CodeLine lineNumber="6609"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewBaseGEP-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != I8PtrTy)</span></CodeLine>
<Link id="l06610" /><CodeLine lineNumber="6610"><span class="doxyHighlight">        NewBaseGEP = NewBaseBuilder.CreatePointerCast(NewBaseGEP, I8PtrTy);</span></CodeLine>
<Link id="l06611" /><CodeLine lineNumber="6611"><span class="doxyHighlight">      NewBaseGEP =</span></CodeLine>
<Link id="l06612" /><CodeLine lineNumber="6612"><span class="doxyHighlight">          NewBaseBuilder.CreatePtrAdd(NewBaseGEP, BaseIndex, </span><span class="doxyHighlightStringLiteral">&quot;splitgep&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06613" /><CodeLine lineNumber="6613"><span class="doxyHighlight">      NewGEPBases.insert(NewBaseGEP);</span></CodeLine>
<Link id="l06614" /><CodeLine lineNumber="6614"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06615" /><CodeLine lineNumber="6615"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l06616" /><CodeLine lineNumber="6616"></CodeLine>
<Link id="l06617" /><CodeLine lineNumber="6617"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check whether all the offsets can be encoded with prefered common base.</span></CodeLine>
<Link id="l06618" /><CodeLine lineNumber="6618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (int64&#95;t PreferBase = TLI-&gt;getPreferredLargeGEPBaseOffset(</span></CodeLine>
<Link id="l06619" /><CodeLine lineNumber="6619"><span class="doxyHighlight">            LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>().second, LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second)) &#123;</span></CodeLine>
<Link id="l06620" /><CodeLine lineNumber="6620"><span class="doxyHighlight">      BaseOffset = PreferBase;</span></CodeLine>
<Link id="l06621" /><CodeLine lineNumber="6621"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Create a new base if the offset of the BaseGEP can be decoded with one</span></CodeLine>
<Link id="l06622" /><CodeLine lineNumber="6622"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instruction.</span></CodeLine>
<Link id="l06623" /><CodeLine lineNumber="6623"><span class="doxyHighlight">      createNewBase(BaseOffset, OldBase, BaseGEP);</span></CodeLine>
<Link id="l06624" /><CodeLine lineNumber="6624"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06625" /><CodeLine lineNumber="6625"></CodeLine>
<Link id="l06626" /><CodeLine lineNumber="6626"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LargeOffsetGEP = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>();</span></CodeLine>
<Link id="l06627" /><CodeLine lineNumber="6627"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (LargeOffsetGEP != LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()) &#123;</span></CodeLine>
<Link id="l06628" /><CodeLine lineNumber="6628"><span class="doxyHighlight">      GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = LargeOffsetGEP-&gt;first;</span></CodeLine>
<Link id="l06629" /><CodeLine lineNumber="6629"><span class="doxyHighlight">      int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = LargeOffsetGEP-&gt;second;</span></CodeLine>
<Link id="l06630" /><CodeLine lineNumber="6630"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != BaseOffset) &#123;</span></CodeLine>
<Link id="l06631" /><CodeLine lineNumber="6631"><span class="doxyHighlight">        TargetLowering::AddrMode <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</span></CodeLine>
<Link id="l06632" /><CodeLine lineNumber="6632"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06633" /><CodeLine lineNumber="6633"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - BaseOffset;</span></CodeLine>
<Link id="l06634" /><CodeLine lineNumber="6634"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The result type of the GEP might not be the type of the memory</span></CodeLine>
<Link id="l06635" /><CodeLine lineNumber="6635"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// access.</span></CodeLine>
<Link id="l06636" /><CodeLine lineNumber="6636"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI-&gt;isLegalAddressingMode(&#42;DL, <a href="/docs/api/files/lib/lib/target/lib/target/msp430/lib/target/msp430/disassembler/msp430disassembler-cpp/#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>,</span></CodeLine>
<Link id="l06637" /><CodeLine lineNumber="6637"><span class="doxyHighlight">                                        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getResultElementType(),</span></CodeLine>
<Link id="l06638" /><CodeLine lineNumber="6638"><span class="doxyHighlight">                                        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getAddressSpace())) &#123;</span></CodeLine>
<Link id="l06639" /><CodeLine lineNumber="6639"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// We need to create a new base if the offset to the current base is</span></CodeLine>
<Link id="l06640" /><CodeLine lineNumber="6640"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// too large to fit into the addressing mode. So, a very large struct</span></CodeLine>
<Link id="l06641" /><CodeLine lineNumber="6641"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// may be split into several parts.</span></CodeLine>
<Link id="l06642" /><CodeLine lineNumber="6642"><span class="doxyHighlight">          BaseGEP = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</span></CodeLine>
<Link id="l06643" /><CodeLine lineNumber="6643"><span class="doxyHighlight">          BaseOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l06644" /><CodeLine lineNumber="6644"><span class="doxyHighlight">          NewBaseGEP = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06645" /><CodeLine lineNumber="6645"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06646" /><CodeLine lineNumber="6646"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06647" /><CodeLine lineNumber="6647"></CodeLine>
<Link id="l06648" /><CodeLine lineNumber="6648"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Generate a new GEP to replace the current one.</span></CodeLine>
<Link id="l06649" /><CodeLine lineNumber="6649"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PtrIdxTy = DL-&gt;getIndexType(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</span></CodeLine>
<Link id="l06650" /><CodeLine lineNumber="6650"></CodeLine>
<Link id="l06651" /><CodeLine lineNumber="6651"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewBaseGEP) &#123;</span></CodeLine>
<Link id="l06652" /><CodeLine lineNumber="6652"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Create a new base if we don&#39;t have one yet.  Find the insertion</span></CodeLine>
<Link id="l06653" /><CodeLine lineNumber="6653"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// pointer for the new base first.</span></CodeLine>
<Link id="l06654" /><CodeLine lineNumber="6654"><span class="doxyHighlight">        createNewBase(BaseOffset, OldBase, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</span></CodeLine>
<Link id="l06655" /><CodeLine lineNumber="6655"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06656" /><CodeLine lineNumber="6656"></CodeLine>
<Link id="l06657" /><CodeLine lineNumber="6657"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</span></CodeLine>
<Link id="l06658" /><CodeLine lineNumber="6658"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewGEP = NewBaseGEP;</span></CodeLine>
<Link id="l06659" /><CodeLine lineNumber="6659"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != BaseOffset) &#123;</span></CodeLine>
<Link id="l06660" /><CodeLine lineNumber="6660"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Calculate the new offset for the new GEP.</span></CodeLine>
<Link id="l06661" /><CodeLine lineNumber="6661"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = ConstantInt::get(PtrIdxTy, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - BaseOffset);</span></CodeLine>
<Link id="l06662" /><CodeLine lineNumber="6662"><span class="doxyHighlight">        NewGEP = Builder.CreatePtrAdd(NewBaseGEP, Index);</span></CodeLine>
<Link id="l06663" /><CodeLine lineNumber="6663"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06664" /><CodeLine lineNumber="6664"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, NewGEP, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l06665" /><CodeLine lineNumber="6665"><span class="doxyHighlight">      LargeOffsetGEPID.erase(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</span></CodeLine>
<Link id="l06666" /><CodeLine lineNumber="6666"><span class="doxyHighlight">      LargeOffsetGEP = LargeOffsetGEPs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(LargeOffsetGEP);</span></CodeLine>
<Link id="l06667" /><CodeLine lineNumber="6667"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l06668" /><CodeLine lineNumber="6668"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06669" /><CodeLine lineNumber="6669"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06670" /><CodeLine lineNumber="6670"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06671" /><CodeLine lineNumber="6671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l06672" /><CodeLine lineNumber="6672"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06673" /><CodeLine lineNumber="6673"></CodeLine>
<Link id="l06674" /><CodeLine lineNumber="6674"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizePhiType(</span></CodeLine>
<Link id="l06675" /><CodeLine lineNumber="6675"><span class="doxyHighlight">    PHINode &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SmallPtrSetImpl&lt;PHINode &#42;&gt; &amp;Visited,</span></CodeLine>
<Link id="l06676" /><CodeLine lineNumber="6676"><span class="doxyHighlight">    SmallPtrSetImpl&lt;Instruction &#42;&gt; &amp;DeletedInstrs) &#123;</span></CodeLine>
<Link id="l06677" /><CodeLine lineNumber="6677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are looking for a collection on interconnected phi nodes that together</span></CodeLine>
<Link id="l06678" /><CodeLine lineNumber="6678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only use loads/bitcasts and are used by stores/bitcasts, and the bitcasts</span></CodeLine>
<Link id="l06679" /><CodeLine lineNumber="6679"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are of the same type. Convert the whole set of nodes to the type of the</span></CodeLine>
<Link id="l06680" /><CodeLine lineNumber="6680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bitcast.</span></CodeLine>
<Link id="l06681" /><CodeLine lineNumber="6681"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PhiTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</span></CodeLine>
<Link id="l06682" /><CodeLine lineNumber="6682"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ConvertTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06683" /><CodeLine lineNumber="6683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l06684" /><CodeLine lineNumber="6684"><span class="doxyHighlight">      (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isIntegerTy() &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isFloatingPointTy()))</span></CodeLine>
<Link id="l06685" /><CodeLine lineNumber="6685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06686" /><CodeLine lineNumber="6686"></CodeLine>
<Link id="l06687" /><CodeLine lineNumber="6687"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 4&gt; Worklist;</span></CodeLine>
<Link id="l06688" /><CodeLine lineNumber="6688"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l06689" /><CodeLine lineNumber="6689"><span class="doxyHighlight">  SmallPtrSet&lt;PHINode &#42;, 4&gt; PhiNodes;</span></CodeLine>
<Link id="l06690" /><CodeLine lineNumber="6690"><span class="doxyHighlight">  SmallPtrSet&lt;ConstantData &#42;, 4&gt; <a href="/docs/api/namespaces/llvm/dwarf/#ab4fde659cfd2ad21ef1920dca7f22255">Constants</a>;</span></CodeLine>
<Link id="l06691" /><CodeLine lineNumber="6691"><span class="doxyHighlight">  PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06692" /><CodeLine lineNumber="6692"><span class="doxyHighlight">  Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06693" /><CodeLine lineNumber="6693"><span class="doxyHighlight">  SmallPtrSet&lt;Instruction &#42;, 4&gt; Defs;</span></CodeLine>
<Link id="l06694" /><CodeLine lineNumber="6694"><span class="doxyHighlight">  SmallPtrSet&lt;Instruction &#42;, 4&gt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</span></CodeLine>
<Link id="l06695" /><CodeLine lineNumber="6695"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This works by adding extra bitcasts between load/stores and removing</span></CodeLine>
<Link id="l06696" /><CodeLine lineNumber="6696"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// existing bicasts. If we have a phi(bitcast(load)) or a store(bitcast(phi))</span></CodeLine>
<Link id="l06697" /><CodeLine lineNumber="6697"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can get in the situation where we remove a bitcast in one iteration</span></CodeLine>
<Link id="l06698" /><CodeLine lineNumber="6698"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// just to add it again in the next. We need to ensure that at least one</span></CodeLine>
<Link id="l06699" /><CodeLine lineNumber="6699"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bitcast we remove are anchored to something that will not change back.</span></CodeLine>
<Link id="l06700" /><CodeLine lineNumber="6700"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyAnchored = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06701" /><CodeLine lineNumber="6701"></CodeLine>
<Link id="l06702" /><CodeLine lineNumber="6702"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l06703" /><CodeLine lineNumber="6703"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l06704" /><CodeLine lineNumber="6704"></CodeLine>
<Link id="l06705" /><CodeLine lineNumber="6705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)) &#123;</span></CodeLine>
<Link id="l06706" /><CodeLine lineNumber="6706"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Handle Defs, which might also be PHI&#39;s</span></CodeLine>
<Link id="l06707" /><CodeLine lineNumber="6707"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;incoming&#95;values()) &#123;</span></CodeLine>
<Link id="l06708" /><CodeLine lineNumber="6708"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l06709" /><CodeLine lineNumber="6709"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi)) &#123;</span></CodeLine>
<Link id="l06710" /><CodeLine lineNumber="6710"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi).second)</span></CodeLine>
<Link id="l06711" /><CodeLine lineNumber="6711"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06712" /><CodeLine lineNumber="6712"><span class="doxyHighlight">            PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi);</span></CodeLine>
<Link id="l06713" /><CodeLine lineNumber="6713"><span class="doxyHighlight">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpPhi);</span></CodeLine>
<Link id="l06714" /><CodeLine lineNumber="6714"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l06715" /><CodeLine lineNumber="6715"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpLoad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l06716" /><CodeLine lineNumber="6716"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OpLoad-&gt;isSimple())</span></CodeLine>
<Link id="l06717" /><CodeLine lineNumber="6717"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06718" /><CodeLine lineNumber="6718"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Defs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpLoad).second)</span></CodeLine>
<Link id="l06719" /><CodeLine lineNumber="6719"><span class="doxyHighlight">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpLoad);</span></CodeLine>
<Link id="l06720" /><CodeLine lineNumber="6720"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpEx = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractElementInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l06721" /><CodeLine lineNumber="6721"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Defs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpEx).second)</span></CodeLine>
<Link id="l06722" /><CodeLine lineNumber="6722"><span class="doxyHighlight">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpEx);</span></CodeLine>
<Link id="l06723" /><CodeLine lineNumber="6723"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l06724" /><CodeLine lineNumber="6724"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConvertTy)</span></CodeLine>
<Link id="l06725" /><CodeLine lineNumber="6725"><span class="doxyHighlight">            ConvertTy = OpBC-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l06726" /><CodeLine lineNumber="6726"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpBC-&gt;getOperand(0)-&gt;getType() != ConvertTy)</span></CodeLine>
<Link id="l06727" /><CodeLine lineNumber="6727"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06728" /><CodeLine lineNumber="6728"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Defs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpBC).second) &#123;</span></CodeLine>
<Link id="l06729" /><CodeLine lineNumber="6729"><span class="doxyHighlight">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpBC);</span></CodeLine>
<Link id="l06730" /><CodeLine lineNumber="6730"><span class="doxyHighlight">            AnyAnchored |= !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(OpBC-&gt;getOperand(0)) &amp;&amp;</span></CodeLine>
<Link id="l06731" /><CodeLine lineNumber="6731"><span class="doxyHighlight">                           !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(OpBC-&gt;getOperand(0));</span></CodeLine>
<Link id="l06732" /><CodeLine lineNumber="6732"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l06733" /><CodeLine lineNumber="6733"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantData&gt;</a>(V))</span></CodeLine>
<Link id="l06734" /><CodeLine lineNumber="6734"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/dwarf/#ab4fde659cfd2ad21ef1920dca7f22255">Constants</a>.insert(OpC);</span></CodeLine>
<Link id="l06735" /><CodeLine lineNumber="6735"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06736" /><CodeLine lineNumber="6736"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06737" /><CodeLine lineNumber="6737"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06738" /><CodeLine lineNumber="6738"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06739" /><CodeLine lineNumber="6739"></CodeLine>
<Link id="l06740" /><CodeLine lineNumber="6740"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle uses which might also be phi&#39;s</span></CodeLine>
<Link id="l06741" /><CodeLine lineNumber="6741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;V : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l06742" /><CodeLine lineNumber="6742"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l06743" /><CodeLine lineNumber="6743"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi)) &#123;</span></CodeLine>
<Link id="l06744" /><CodeLine lineNumber="6744"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi))</span></CodeLine>
<Link id="l06745" /><CodeLine lineNumber="6745"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06746" /><CodeLine lineNumber="6746"><span class="doxyHighlight">          PhiNodes.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi);</span></CodeLine>
<Link id="l06747" /><CodeLine lineNumber="6747"><span class="doxyHighlight">          Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OpPhi);</span></CodeLine>
<Link id="l06748" /><CodeLine lineNumber="6748"><span class="doxyHighlight">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpPhi);</span></CodeLine>
<Link id="l06749" /><CodeLine lineNumber="6749"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06750" /><CodeLine lineNumber="6750"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpStore = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l06751" /><CodeLine lineNumber="6751"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OpStore-&gt;isSimple() || OpStore-&gt;getOperand(0) != <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</span></CodeLine>
<Link id="l06752" /><CodeLine lineNumber="6752"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06753" /><CodeLine lineNumber="6753"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.insert(OpStore);</span></CodeLine>
<Link id="l06754" /><CodeLine lineNumber="6754"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l06755" /><CodeLine lineNumber="6755"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConvertTy)</span></CodeLine>
<Link id="l06756" /><CodeLine lineNumber="6756"><span class="doxyHighlight">          ConvertTy = OpBC-&gt;getType();</span></CodeLine>
<Link id="l06757" /><CodeLine lineNumber="6757"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpBC-&gt;getType() != ConvertTy)</span></CodeLine>
<Link id="l06758" /><CodeLine lineNumber="6758"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06759" /><CodeLine lineNumber="6759"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.insert(OpBC);</span></CodeLine>
<Link id="l06760" /><CodeLine lineNumber="6760"><span class="doxyHighlight">        AnyAnchored |=</span></CodeLine>
<Link id="l06761" /><CodeLine lineNumber="6761"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OpBC-&gt;users(), &#91;&#93;(User &#42;U) &#123; return !isa&lt;StoreInst&gt;(U); &#125;);</span></CodeLine>
<Link id="l06762" /><CodeLine lineNumber="6762"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06763" /><CodeLine lineNumber="6763"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06764" /><CodeLine lineNumber="6764"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06765" /><CodeLine lineNumber="6765"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06766" /><CodeLine lineNumber="6766"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06767" /><CodeLine lineNumber="6767"></CodeLine>
<Link id="l06768" /><CodeLine lineNumber="6768"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConvertTy || !AnyAnchored ||</span></CodeLine>
<Link id="l06769" /><CodeLine lineNumber="6769"><span class="doxyHighlight">      !TLI-&gt;shouldConvertPhiType(PhiTy, ConvertTy))</span></CodeLine>
<Link id="l06770" /><CodeLine lineNumber="6770"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06771" /><CodeLine lineNumber="6771"></CodeLine>
<Link id="l06772" /><CodeLine lineNumber="6772"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Converting &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n  and connected nodes to &quot;</span></CodeLine>
<Link id="l06773" /><CodeLine lineNumber="6773"><span class="doxyHighlight">                    &lt;&lt; &#42;ConvertTy &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06774" /><CodeLine lineNumber="6774"></CodeLine>
<Link id="l06775" /><CodeLine lineNumber="6775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create all the new phi nodes of the new type, and bitcast any loads to the</span></CodeLine>
<Link id="l06776" /><CodeLine lineNumber="6776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// correct type.</span></CodeLine>
<Link id="l06777" /><CodeLine lineNumber="6777"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#afab3631a764c3f3a60ca9b1c0d7d5967">ValueToValueMap</a> ValMap;</span></CodeLine>
<Link id="l06778" /><CodeLine lineNumber="6778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (ConstantData &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : Constants)</span></CodeLine>
<Link id="l06779" /><CodeLine lineNumber="6779"><span class="doxyHighlight">    ValMap&#91;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>&#93; = <a href="/docs/api/classes/llvm/constantexpr/#ae79d05dd3d0b05e080e08f8c5c33f880">ConstantExpr::getBitCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, ConvertTy);</span></CodeLine>
<Link id="l06780" /><CodeLine lineNumber="6780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> : Defs) &#123;</span></CodeLine>
<Link id="l06781" /><CodeLine lineNumber="6781"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>)) &#123;</span></CodeLine>
<Link id="l06782" /><CodeLine lineNumber="6782"><span class="doxyHighlight">      ValMap&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>&#93; = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l06783" /><CodeLine lineNumber="6783"><span class="doxyHighlight">      DeletedInstrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>);</span></CodeLine>
<Link id="l06784" /><CodeLine lineNumber="6784"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06785" /><CodeLine lineNumber="6785"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> insertPt = std::next(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getIterator());</span></CodeLine>
<Link id="l06786" /><CodeLine lineNumber="6786"><span class="doxyHighlight">      ValMap&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>&#93; = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> BitCastInst(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, ConvertTy, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.bc&quot;</span><span class="doxyHighlight">, insertPt);</span></CodeLine>
<Link id="l06787" /><CodeLine lineNumber="6787"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06788" /><CodeLine lineNumber="6788"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06789" /><CodeLine lineNumber="6789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &#42;Phi : PhiNodes)</span></CodeLine>
<Link id="l06790" /><CodeLine lineNumber="6790"><span class="doxyHighlight">    ValMap&#91;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>&#93; = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(ConvertTy, <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues(),</span></CodeLine>
<Link id="l06791" /><CodeLine lineNumber="6791"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.tc&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIterator());</span></CodeLine>
<Link id="l06792" /><CodeLine lineNumber="6792"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pipe together all the PhiNodes.</span></CodeLine>
<Link id="l06793" /><CodeLine lineNumber="6793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &#42;Phi : PhiNodes) &#123;</span></CodeLine>
<Link id="l06794" /><CodeLine lineNumber="6794"><span class="doxyHighlight">    PHINode &#42;NewPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(ValMap&#91;Phi&#93;);</span></CodeLine>
<Link id="l06795" /><CodeLine lineNumber="6795"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues(); i &lt; e; i++)</span></CodeLine>
<Link id="l06796" /><CodeLine lineNumber="6796"><span class="doxyHighlight">      NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(ValMap&#91;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingValue(i)&#93;,</span></CodeLine>
<Link id="l06797" /><CodeLine lineNumber="6797"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingBlock(i));</span></CodeLine>
<Link id="l06798" /><CodeLine lineNumber="6798"><span class="doxyHighlight">    Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(NewPhi);</span></CodeLine>
<Link id="l06799" /><CodeLine lineNumber="6799"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06800" /><CodeLine lineNumber="6800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And finally pipe up the stores and bitcasts</span></CodeLine>
<Link id="l06801" /><CodeLine lineNumber="6801"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;U : <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>) &#123;</span></CodeLine>
<Link id="l06802" /><CodeLine lineNumber="6802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l06803" /><CodeLine lineNumber="6803"><span class="doxyHighlight">      DeletedInstrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(U);</span></CodeLine>
<Link id="l06804" /><CodeLine lineNumber="6804"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(U, ValMap&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getOperand(0)&#93;, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l06805" /><CodeLine lineNumber="6805"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06806" /><CodeLine lineNumber="6806"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;setOperand(0, </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> BitCastInst(ValMap&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getOperand(0)&#93;, PhiTy, </span><span class="doxyHighlightStringLiteral">&quot;bc&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06807" /><CodeLine lineNumber="6807"><span class="doxyHighlight">                                       <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getIterator()));</span></CodeLine>
<Link id="l06808" /><CodeLine lineNumber="6808"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06809" /><CodeLine lineNumber="6809"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06810" /><CodeLine lineNumber="6810"></CodeLine>
<Link id="l06811" /><CodeLine lineNumber="6811"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Save the removed phis to be deleted later.</span></CodeLine>
<Link id="l06812" /><CodeLine lineNumber="6812"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &#42;Phi : PhiNodes)</span></CodeLine>
<Link id="l06813" /><CodeLine lineNumber="6813"><span class="doxyHighlight">    DeletedInstrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Phi);</span></CodeLine>
<Link id="l06814" /><CodeLine lineNumber="6814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06815" /><CodeLine lineNumber="6815"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06816" /><CodeLine lineNumber="6816"></CodeLine>
<Link id="l06817" /><CodeLine lineNumber="6817"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizePhiTypes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l06818" /><CodeLine lineNumber="6818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a1d7858eecb954b54795df357b6935414">OptimizePhiTypes</a>)</span></CodeLine>
<Link id="l06819" /><CodeLine lineNumber="6819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06820" /><CodeLine lineNumber="6820"></CodeLine>
<Link id="l06821" /><CodeLine lineNumber="6821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06822" /><CodeLine lineNumber="6822"><span class="doxyHighlight">  SmallPtrSet&lt;PHINode &#42;, 4&gt; Visited;</span></CodeLine>
<Link id="l06823" /><CodeLine lineNumber="6823"><span class="doxyHighlight">  SmallPtrSet&lt;Instruction &#42;, 4&gt; DeletedInstrs;</span></CodeLine>
<Link id="l06824" /><CodeLine lineNumber="6824"></CodeLine>
<Link id="l06825" /><CodeLine lineNumber="6825"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Attempt to optimize all the phis in the functions to the correct type.</span></CodeLine>
<Link id="l06826" /><CodeLine lineNumber="6826"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l06827" /><CodeLine lineNumber="6827"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Phi : BB.<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</span></CodeLine>
<Link id="l06828" /><CodeLine lineNumber="6828"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= optimizePhiType(&amp;Phi, Visited, DeletedInstrs);</span></CodeLine>
<Link id="l06829" /><CodeLine lineNumber="6829"></CodeLine>
<Link id="l06830" /><CodeLine lineNumber="6830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove any old phi&#39;s that have been converted.</span></CodeLine>
<Link id="l06831" /><CodeLine lineNumber="6831"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DeletedInstrs) &#123;</span></CodeLine>
<Link id="l06832" /><CodeLine lineNumber="6832"><span class="doxyHighlight">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()), <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l06833" /><CodeLine lineNumber="6833"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l06834" /><CodeLine lineNumber="6834"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06835" /><CodeLine lineNumber="6835"></CodeLine>
<Link id="l06836" /><CodeLine lineNumber="6836"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l06837" /><CodeLine lineNumber="6837"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06838" /><CodeLine lineNumber="6838"></CodeLine>
<Link id="l06839" /><CodeLine lineNumber="6839"><span class="doxyHighlightComment">/// Return true, if an ext(load) can be formed from an extension in</span></CodeLine>
<Link id="l06840" /><CodeLine lineNumber="6840"><span class="doxyHighlightComment">/// \\p MovedExts.</span></CodeLine>
<Link id="l06841" /><CodeLine lineNumber="6841"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::canFormExtLd(</span></CodeLine>
<Link id="l06842" /><CodeLine lineNumber="6842"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SmallVectorImpl&lt;Instruction &#42;&gt; &amp;MovedExts, LoadInst &#42;&amp;LI,</span></CodeLine>
<Link id="l06843" /><CodeLine lineNumber="6843"><span class="doxyHighlight">    Instruction &#42;&amp;Inst, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasPromoted) &#123;</span></CodeLine>
<Link id="l06844" /><CodeLine lineNumber="6844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MovedExtInst : MovedExts) &#123;</span></CodeLine>
<Link id="l06845" /><CodeLine lineNumber="6845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(MovedExtInst-&gt;getOperand(0))) &#123;</span></CodeLine>
<Link id="l06846" /><CodeLine lineNumber="6846"><span class="doxyHighlight">      LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(MovedExtInst-&gt;getOperand(0));</span></CodeLine>
<Link id="l06847" /><CodeLine lineNumber="6847"><span class="doxyHighlight">      Inst = MovedExtInst;</span></CodeLine>
<Link id="l06848" /><CodeLine lineNumber="6848"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06849" /><CodeLine lineNumber="6849"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06850" /><CodeLine lineNumber="6850"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06851" /><CodeLine lineNumber="6851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI)</span></CodeLine>
<Link id="l06852" /><CodeLine lineNumber="6852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06853" /><CodeLine lineNumber="6853"></CodeLine>
<Link id="l06854" /><CodeLine lineNumber="6854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If they&#39;re already in the same block, there&#39;s nothing to do.</span></CodeLine>
<Link id="l06855" /><CodeLine lineNumber="6855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make the cheap checks first if we did not promote.</span></CodeLine>
<Link id="l06856" /><CodeLine lineNumber="6856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we promoted, we need to check if it is indeed profitable.</span></CodeLine>
<Link id="l06857" /><CodeLine lineNumber="6857"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasPromoted &amp;&amp; LI-&gt;getParent() == Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l06858" /><CodeLine lineNumber="6858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06859" /><CodeLine lineNumber="6859"></CodeLine>
<Link id="l06860" /><CodeLine lineNumber="6860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TLI-&gt;isExtLoad(LI, Inst, &#42;DL);</span></CodeLine>
<Link id="l06861" /><CodeLine lineNumber="6861"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06862" /><CodeLine lineNumber="6862"></CodeLine>
<Link id="l06863" /><CodeLine lineNumber="6863"><span class="doxyHighlightComment">/// Move a zext or sext fed by a load into the same basic block as the load,</span></CodeLine>
<Link id="l06864" /><CodeLine lineNumber="6864"><span class="doxyHighlightComment">/// unless conditions are unfavorable. This allows SelectionDAG to fold the</span></CodeLine>
<Link id="l06865" /><CodeLine lineNumber="6865"><span class="doxyHighlightComment">/// extend into the load.</span></CodeLine>
<Link id="l06866" /><CodeLine lineNumber="6866"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l06867" /><CodeLine lineNumber="6867"><span class="doxyHighlightComment">/// E.g.,</span></CodeLine>
<Link id="l06868" /><CodeLine lineNumber="6868"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l06869" /><CodeLine lineNumber="6869"><span class="doxyHighlightComment">/// %ld = load i32&#42; %addr</span></CodeLine>
<Link id="l06870" /><CodeLine lineNumber="6870"><span class="doxyHighlightComment">/// %add = add nuw i32 %ld, 4</span></CodeLine>
<Link id="l06871" /><CodeLine lineNumber="6871"><span class="doxyHighlightComment">/// %zext = zext i32 %add to i64</span></CodeLine>
<Link id="l06872" /><CodeLine lineNumber="6872"><span class="doxyHighlightComment">// \\endcode</span></CodeLine>
<Link id="l06873" /><CodeLine lineNumber="6873"><span class="doxyHighlightComment">/// =&gt;</span></CodeLine>
<Link id="l06874" /><CodeLine lineNumber="6874"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l06875" /><CodeLine lineNumber="6875"><span class="doxyHighlightComment">/// %ld = load i32&#42; %addr</span></CodeLine>
<Link id="l06876" /><CodeLine lineNumber="6876"><span class="doxyHighlightComment">/// %zext = zext i32 %ld to i64</span></CodeLine>
<Link id="l06877" /><CodeLine lineNumber="6877"><span class="doxyHighlightComment">/// %add = add nuw i64 %zext, 4</span></CodeLine>
<Link id="l06878" /><CodeLine lineNumber="6878"><span class="doxyHighlightComment">/// \\encode</span></CodeLine>
<Link id="l06879" /><CodeLine lineNumber="6879"><span class="doxyHighlightComment">/// Note that the promotion in %add to i64 is done in tryToPromoteExts(), which</span></CodeLine>
<Link id="l06880" /><CodeLine lineNumber="6880"><span class="doxyHighlightComment">/// allow us to match zext(load i32&#42;) to i64.</span></CodeLine>
<Link id="l06881" /><CodeLine lineNumber="6881"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l06882" /><CodeLine lineNumber="6882"><span class="doxyHighlightComment">/// Also, try to promote the computations used to obtain a sign extended</span></CodeLine>
<Link id="l06883" /><CodeLine lineNumber="6883"><span class="doxyHighlightComment">/// value used into memory accesses.</span></CodeLine>
<Link id="l06884" /><CodeLine lineNumber="6884"><span class="doxyHighlightComment">/// E.g.,</span></CodeLine>
<Link id="l06885" /><CodeLine lineNumber="6885"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l06886" /><CodeLine lineNumber="6886"><span class="doxyHighlightComment">/// a = add nsw i32 b, 3</span></CodeLine>
<Link id="l06887" /><CodeLine lineNumber="6887"><span class="doxyHighlightComment">/// d = sext i32 a to i64</span></CodeLine>
<Link id="l06888" /><CodeLine lineNumber="6888"><span class="doxyHighlightComment">/// e = getelementptr ..., i64 d</span></CodeLine>
<Link id="l06889" /><CodeLine lineNumber="6889"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l06890" /><CodeLine lineNumber="6890"><span class="doxyHighlightComment">/// =&gt;</span></CodeLine>
<Link id="l06891" /><CodeLine lineNumber="6891"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l06892" /><CodeLine lineNumber="6892"><span class="doxyHighlightComment">/// f = sext i32 b to i64</span></CodeLine>
<Link id="l06893" /><CodeLine lineNumber="6893"><span class="doxyHighlightComment">/// a = add nsw i64 f, 3</span></CodeLine>
<Link id="l06894" /><CodeLine lineNumber="6894"><span class="doxyHighlightComment">/// e = getelementptr ..., i64 a</span></CodeLine>
<Link id="l06895" /><CodeLine lineNumber="6895"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l06896" /><CodeLine lineNumber="6896"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l06897" /><CodeLine lineNumber="6897"><span class="doxyHighlightComment">/// \\p Inst&#91;in/out&#93; the extension may be modified during the process if some</span></CodeLine>
<Link id="l06898" /><CodeLine lineNumber="6898"><span class="doxyHighlightComment">/// promotions apply.</span></CodeLine>
<Link id="l06899" /><CodeLine lineNumber="6899"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeExt(Instruction &#42;&amp;Inst) &#123;</span></CodeLine>
<Link id="l06900" /><CodeLine lineNumber="6900"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowPromotionWithoutCommonHeader = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06901" /><CodeLine lineNumber="6901"><span class="doxyHighlightComment">  /// See if it is an interesting sext operations for the address type</span></CodeLine>
<Link id="l06902" /><CodeLine lineNumber="6902"><span class="doxyHighlightComment">  /// promotion before trying to promote it, e.g., the ones with the right</span></CodeLine>
<Link id="l06903" /><CodeLine lineNumber="6903"><span class="doxyHighlightComment">  /// type and used in memory accesses.</span></CodeLine>
<Link id="l06904" /><CodeLine lineNumber="6904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ATPConsiderable = TTI-&gt;shouldConsiderAddressTypePromotion(</span></CodeLine>
<Link id="l06905" /><CodeLine lineNumber="6905"><span class="doxyHighlight">      &#42;Inst, AllowPromotionWithoutCommonHeader);</span></CodeLine>
<Link id="l06906" /><CodeLine lineNumber="6906"><span class="doxyHighlight">  TypePromotionTransaction TPT(RemovedInsts);</span></CodeLine>
<Link id="l06907" /><CodeLine lineNumber="6907"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction/#ae9342a9ab343b347e3d043d1568aaff9">TypePromotionTransaction::ConstRestorationPt</a> LastKnownGood =</span></CodeLine>
<Link id="l06908" /><CodeLine lineNumber="6908"><span class="doxyHighlight">      TPT.getRestorationPoint();</span></CodeLine>
<Link id="l06909" /><CodeLine lineNumber="6909"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 1&gt; Exts;</span></CodeLine>
<Link id="l06910" /><CodeLine lineNumber="6910"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 2&gt; SpeculativelyMovedExts;</span></CodeLine>
<Link id="l06911" /><CodeLine lineNumber="6911"><span class="doxyHighlight">  Exts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Inst);</span></CodeLine>
<Link id="l06912" /><CodeLine lineNumber="6912"></CodeLine>
<Link id="l06913" /><CodeLine lineNumber="6913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasPromoted = tryToPromoteExts(TPT, Exts, SpeculativelyMovedExts);</span></CodeLine>
<Link id="l06914" /><CodeLine lineNumber="6914"></CodeLine>
<Link id="l06915" /><CodeLine lineNumber="6915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for a load being extended.</span></CodeLine>
<Link id="l06916" /><CodeLine lineNumber="6916"><span class="doxyHighlight">  LoadInst &#42;LI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06917" /><CodeLine lineNumber="6917"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtFedByLoad;</span></CodeLine>
<Link id="l06918" /><CodeLine lineNumber="6918"></CodeLine>
<Link id="l06919" /><CodeLine lineNumber="6919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to promote a chain of computation if it allows to form an extended</span></CodeLine>
<Link id="l06920" /><CodeLine lineNumber="6920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load.</span></CodeLine>
<Link id="l06921" /><CodeLine lineNumber="6921"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (canFormExtLd(SpeculativelyMovedExts, LI, ExtFedByLoad, HasPromoted)) &#123;</span></CodeLine>
<Link id="l06922" /><CodeLine lineNumber="6922"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI &amp;&amp; ExtFedByLoad &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expect a valid load and extension&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06923" /><CodeLine lineNumber="6923"><span class="doxyHighlight">    TPT.commit();</span></CodeLine>
<Link id="l06924" /><CodeLine lineNumber="6924"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move the extend into the same block as the load.</span></CodeLine>
<Link id="l06925" /><CodeLine lineNumber="6925"><span class="doxyHighlight">    ExtFedByLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#a54507f01d7d06127068ee0663233511d">moveAfter</a>(LI);</span></CodeLine>
<Link id="l06926" /><CodeLine lineNumber="6926"><span class="doxyHighlight">    ++NumExtsMoved;</span></CodeLine>
<Link id="l06927" /><CodeLine lineNumber="6927"><span class="doxyHighlight">    Inst = ExtFedByLoad;</span></CodeLine>
<Link id="l06928" /><CodeLine lineNumber="6928"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06929" /><CodeLine lineNumber="6929"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06930" /><CodeLine lineNumber="6930"></CodeLine>
<Link id="l06931" /><CodeLine lineNumber="6931"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Continue promoting SExts if known as considerable depending on targets.</span></CodeLine>
<Link id="l06932" /><CodeLine lineNumber="6932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ATPConsiderable &amp;&amp;</span></CodeLine>
<Link id="l06933" /><CodeLine lineNumber="6933"><span class="doxyHighlight">      performAddressTypePromotion(Inst, AllowPromotionWithoutCommonHeader,</span></CodeLine>
<Link id="l06934" /><CodeLine lineNumber="6934"><span class="doxyHighlight">                                  HasPromoted, TPT, SpeculativelyMovedExts))</span></CodeLine>
<Link id="l06935" /><CodeLine lineNumber="6935"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06936" /><CodeLine lineNumber="6936"></CodeLine>
<Link id="l06937" /><CodeLine lineNumber="6937"><span class="doxyHighlight">  TPT.rollback(LastKnownGood);</span></CodeLine>
<Link id="l06938" /><CodeLine lineNumber="6938"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06939" /><CodeLine lineNumber="6939"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06940" /><CodeLine lineNumber="6940"></CodeLine>
<Link id="l06941" /><CodeLine lineNumber="6941"><span class="doxyHighlightComment">// Perform address type promotion if doing so is profitable.</span></CodeLine>
<Link id="l06942" /><CodeLine lineNumber="6942"><span class="doxyHighlightComment">// If AllowPromotionWithoutCommonHeader == false, we should find other sext</span></CodeLine>
<Link id="l06943" /><CodeLine lineNumber="6943"><span class="doxyHighlightComment">// instructions that sign extended the same initial value. However, if</span></CodeLine>
<Link id="l06944" /><CodeLine lineNumber="6944"><span class="doxyHighlightComment">// AllowPromotionWithoutCommonHeader == true, we expect promoting the</span></CodeLine>
<Link id="l06945" /><CodeLine lineNumber="6945"><span class="doxyHighlightComment">// extension is just profitable.</span></CodeLine>
<Link id="l06946" /><CodeLine lineNumber="6946"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::performAddressTypePromotion(</span></CodeLine>
<Link id="l06947" /><CodeLine lineNumber="6947"><span class="doxyHighlight">    Instruction &#42;&amp;Inst, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowPromotionWithoutCommonHeader,</span></CodeLine>
<Link id="l06948" /><CodeLine lineNumber="6948"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasPromoted, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction">TypePromotionTransaction</a> &amp;TPT,</span></CodeLine>
<Link id="l06949" /><CodeLine lineNumber="6949"><span class="doxyHighlight">    SmallVectorImpl&lt;Instruction &#42;&gt; &amp;SpeculativelyMovedExts) &#123;</span></CodeLine>
<Link id="l06950" /><CodeLine lineNumber="6950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Promoted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06951" /><CodeLine lineNumber="6951"><span class="doxyHighlight">  SmallPtrSet&lt;Instruction &#42;, 1&gt; UnhandledExts;</span></CodeLine>
<Link id="l06952" /><CodeLine lineNumber="6952"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllSeenFirst = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06953" /><CodeLine lineNumber="6953"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) &#123;</span></CodeLine>
<Link id="l06954" /><CodeLine lineNumber="6954"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l06955" /><CodeLine lineNumber="6955"><span class="doxyHighlight">    DenseMap&lt;Value &#42;, Instruction &#42;&gt;::iterator AlreadySeen =</span></CodeLine>
<Link id="l06956" /><CodeLine lineNumber="6956"><span class="doxyHighlight">        SeenChainsForSExt.find(HeadOfChain);</span></CodeLine>
<Link id="l06957" /><CodeLine lineNumber="6957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is an unhandled SExt which has the same header, try to promote</span></CodeLine>
<Link id="l06958" /><CodeLine lineNumber="6958"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it as well.</span></CodeLine>
<Link id="l06959" /><CodeLine lineNumber="6959"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AlreadySeen != SeenChainsForSExt.end()) &#123;</span></CodeLine>
<Link id="l06960" /><CodeLine lineNumber="6960"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AlreadySeen-&gt;second != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l06961" /><CodeLine lineNumber="6961"><span class="doxyHighlight">        UnhandledExts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(AlreadySeen-&gt;second);</span></CodeLine>
<Link id="l06962" /><CodeLine lineNumber="6962"><span class="doxyHighlight">      AllSeenFirst = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06963" /><CodeLine lineNumber="6963"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06964" /><CodeLine lineNumber="6964"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06965" /><CodeLine lineNumber="6965"></CodeLine>
<Link id="l06966" /><CodeLine lineNumber="6966"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllSeenFirst || (AllowPromotionWithoutCommonHeader &amp;&amp;</span></CodeLine>
<Link id="l06967" /><CodeLine lineNumber="6967"><span class="doxyHighlight">                        SpeculativelyMovedExts.size() == 1)) &#123;</span></CodeLine>
<Link id="l06968" /><CodeLine lineNumber="6968"><span class="doxyHighlight">    TPT.commit();</span></CodeLine>
<Link id="l06969" /><CodeLine lineNumber="6969"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasPromoted)</span></CodeLine>
<Link id="l06970" /><CodeLine lineNumber="6970"><span class="doxyHighlight">      Promoted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06971" /><CodeLine lineNumber="6971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) &#123;</span></CodeLine>
<Link id="l06972" /><CodeLine lineNumber="6972"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l06973" /><CodeLine lineNumber="6973"><span class="doxyHighlight">      SeenChainsForSExt&#91;HeadOfChain&#93; = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06974" /><CodeLine lineNumber="6974"><span class="doxyHighlight">      ValToSExtendedUses&#91;HeadOfChain&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06975" /><CodeLine lineNumber="6975"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06976" /><CodeLine lineNumber="6976"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update Inst as promotion happen.</span></CodeLine>
<Link id="l06977" /><CodeLine lineNumber="6977"><span class="doxyHighlight">    Inst = SpeculativelyMovedExts.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l06978" /><CodeLine lineNumber="6978"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06979" /><CodeLine lineNumber="6979"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is the first chain visited from the header, keep the current chain</span></CodeLine>
<Link id="l06980" /><CodeLine lineNumber="6980"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as unhandled. Defer to promote this until we encounter another SExt</span></CodeLine>
<Link id="l06981" /><CodeLine lineNumber="6981"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// chain derived from the same header.</span></CodeLine>
<Link id="l06982" /><CodeLine lineNumber="6982"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) &#123;</span></CodeLine>
<Link id="l06983" /><CodeLine lineNumber="6983"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l06984" /><CodeLine lineNumber="6984"><span class="doxyHighlight">      SeenChainsForSExt&#91;HeadOfChain&#93; = Inst;</span></CodeLine>
<Link id="l06985" /><CodeLine lineNumber="6985"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06986" /><CodeLine lineNumber="6986"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06987" /><CodeLine lineNumber="6987"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06988" /><CodeLine lineNumber="6988"></CodeLine>
<Link id="l06989" /><CodeLine lineNumber="6989"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllSeenFirst &amp;&amp; !UnhandledExts.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>())</span></CodeLine>
<Link id="l06990" /><CodeLine lineNumber="6990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VisitedSExt : UnhandledExts) &#123;</span></CodeLine>
<Link id="l06991" /><CodeLine lineNumber="6991"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RemovedInsts.count(VisitedSExt))</span></CodeLine>
<Link id="l06992" /><CodeLine lineNumber="6992"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06993" /><CodeLine lineNumber="6993"><span class="doxyHighlight">      TypePromotionTransaction TPT(RemovedInsts);</span></CodeLine>
<Link id="l06994" /><CodeLine lineNumber="6994"><span class="doxyHighlight">      SmallVector&lt;Instruction &#42;, 1&gt; Exts;</span></CodeLine>
<Link id="l06995" /><CodeLine lineNumber="6995"><span class="doxyHighlight">      SmallVector&lt;Instruction &#42;, 2&gt; Chains;</span></CodeLine>
<Link id="l06996" /><CodeLine lineNumber="6996"><span class="doxyHighlight">      Exts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VisitedSExt);</span></CodeLine>
<Link id="l06997" /><CodeLine lineNumber="6997"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasPromoted = tryToPromoteExts(TPT, Exts, Chains);</span></CodeLine>
<Link id="l06998" /><CodeLine lineNumber="6998"><span class="doxyHighlight">      TPT.commit();</span></CodeLine>
<Link id="l06999" /><CodeLine lineNumber="6999"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasPromoted)</span></CodeLine>
<Link id="l07000" /><CodeLine lineNumber="7000"><span class="doxyHighlight">        Promoted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07001" /><CodeLine lineNumber="7001"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Chains) &#123;</span></CodeLine>
<Link id="l07002" /><CodeLine lineNumber="7002"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HeadOfChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l07003" /><CodeLine lineNumber="7003"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Mark this as handled.</span></CodeLine>
<Link id="l07004" /><CodeLine lineNumber="7004"><span class="doxyHighlight">        SeenChainsForSExt&#91;HeadOfChain&#93; = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07005" /><CodeLine lineNumber="7005"><span class="doxyHighlight">        ValToSExtendedUses&#91;HeadOfChain&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07006" /><CodeLine lineNumber="7006"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07007" /><CodeLine lineNumber="7007"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07008" /><CodeLine lineNumber="7008"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Promoted;</span></CodeLine>
<Link id="l07009" /><CodeLine lineNumber="7009"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07010" /><CodeLine lineNumber="7010"></CodeLine>
<Link id="l07011" /><CodeLine lineNumber="7011"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeExtUses(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07012" /><CodeLine lineNumber="7012"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DefBB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l07013" /><CodeLine lineNumber="7013"></CodeLine>
<Link id="l07014" /><CodeLine lineNumber="7014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the result of a &#123;s|z&#125;ext and its source are both live out, rewrite all</span></CodeLine>
<Link id="l07015" /><CodeLine lineNumber="7015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other uses of the source with result of extension.</span></CodeLine>
<Link id="l07016" /><CodeLine lineNumber="7016"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l07017" /><CodeLine lineNumber="7017"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l07018" /><CodeLine lineNumber="7018"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07019" /><CodeLine lineNumber="7019"></CodeLine>
<Link id="l07020" /><CodeLine lineNumber="7020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only do this xform if truncating is free.</span></CodeLine>
<Link id="l07021" /><CodeLine lineNumber="7021"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI-&gt;isTruncateFree(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;getType()))</span></CodeLine>
<Link id="l07022" /><CodeLine lineNumber="7022"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07023" /><CodeLine lineNumber="7023"></CodeLine>
<Link id="l07024" /><CodeLine lineNumber="7024"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only safe to perform the optimization if the source is also defined in</span></CodeLine>
<Link id="l07025" /><CodeLine lineNumber="7025"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this block.</span></CodeLine>
<Link id="l07026" /><CodeLine lineNumber="7026"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Src) || DefBB != <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Src)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>())</span></CodeLine>
<Link id="l07027" /><CodeLine lineNumber="7027"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07028" /><CodeLine lineNumber="7028"></CodeLine>
<Link id="l07029" /><CodeLine lineNumber="7029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DefIsLiveOut = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07030" /><CodeLine lineNumber="7030"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l07031" /><CodeLine lineNumber="7031"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l07032" /><CodeLine lineNumber="7032"></CodeLine>
<Link id="l07033" /><CodeLine lineNumber="7033"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Figure out which BB this ext is used in.</span></CodeLine>
<Link id="l07034" /><CodeLine lineNumber="7034"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;UserBB = UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07035" /><CodeLine lineNumber="7035"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB == DefBB)</span></CodeLine>
<Link id="l07036" /><CodeLine lineNumber="7036"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07037" /><CodeLine lineNumber="7037"><span class="doxyHighlight">    DefIsLiveOut = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07038" /><CodeLine lineNumber="7038"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07039" /><CodeLine lineNumber="7039"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07040" /><CodeLine lineNumber="7040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefIsLiveOut)</span></CodeLine>
<Link id="l07041" /><CodeLine lineNumber="7041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07042" /><CodeLine lineNumber="7042"></CodeLine>
<Link id="l07043" /><CodeLine lineNumber="7043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure none of the uses are PHI nodes.</span></CodeLine>
<Link id="l07044" /><CodeLine lineNumber="7044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l07045" /><CodeLine lineNumber="7045"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l07046" /><CodeLine lineNumber="7046"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;UserBB = UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07047" /><CodeLine lineNumber="7047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB == DefBB)</span></CodeLine>
<Link id="l07048" /><CodeLine lineNumber="7048"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07049" /><CodeLine lineNumber="7049"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Be conservative. We don&#39;t want this xform to end up introducing</span></CodeLine>
<Link id="l07050" /><CodeLine lineNumber="7050"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reloads just before load / store instructions.</span></CodeLine>
<Link id="l07051" /><CodeLine lineNumber="7051"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(UI) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(UI))</span></CodeLine>
<Link id="l07052" /><CodeLine lineNumber="7052"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07053" /><CodeLine lineNumber="7053"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07054" /><CodeLine lineNumber="7054"></CodeLine>
<Link id="l07055" /><CodeLine lineNumber="7055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// InsertedTruncs - Only insert one trunc in each block once.</span></CodeLine>
<Link id="l07056" /><CodeLine lineNumber="7056"><span class="doxyHighlight">  DenseMap&lt;BasicBlock &#42;, Instruction &#42;&gt; InsertedTruncs;</span></CodeLine>
<Link id="l07057" /><CodeLine lineNumber="7057"></CodeLine>
<Link id="l07058" /><CodeLine lineNumber="7058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07059" /><CodeLine lineNumber="7059"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;U : <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;uses()) &#123;</span></CodeLine>
<Link id="l07060" /><CodeLine lineNumber="7060"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser());</span></CodeLine>
<Link id="l07061" /><CodeLine lineNumber="7061"></CodeLine>
<Link id="l07062" /><CodeLine lineNumber="7062"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Figure out which BB this ext is used in.</span></CodeLine>
<Link id="l07063" /><CodeLine lineNumber="7063"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;UserBB = <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">User</a>-&gt;getParent();</span></CodeLine>
<Link id="l07064" /><CodeLine lineNumber="7064"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserBB == DefBB)</span></CodeLine>
<Link id="l07065" /><CodeLine lineNumber="7065"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07066" /><CodeLine lineNumber="7066"></CodeLine>
<Link id="l07067" /><CodeLine lineNumber="7067"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Both src and def are live in this block. Rewrite the use.</span></CodeLine>
<Link id="l07068" /><CodeLine lineNumber="7068"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;&amp;InsertedTrunc = InsertedTruncs&#91;UserBB&#93;;</span></CodeLine>
<Link id="l07069" /><CodeLine lineNumber="7069"></CodeLine>
<Link id="l07070" /><CodeLine lineNumber="7070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertedTrunc) &#123;</span></CodeLine>
<Link id="l07071" /><CodeLine lineNumber="7071"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l07072" /><CodeLine lineNumber="7072"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l07073" /><CodeLine lineNumber="7073"><span class="doxyHighlight">      InsertedTrunc = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> TruncInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;getType(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07074" /><CodeLine lineNumber="7074"><span class="doxyHighlight">      InsertedTrunc-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;UserBB, InsertPt);</span></CodeLine>
<Link id="l07075" /><CodeLine lineNumber="7075"><span class="doxyHighlight">      InsertedInsts.insert(InsertedTrunc);</span></CodeLine>
<Link id="l07076" /><CodeLine lineNumber="7076"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07077" /><CodeLine lineNumber="7077"></CodeLine>
<Link id="l07078" /><CodeLine lineNumber="7078"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace a use of the &#123;s|z&#125;ext source with a use of the result.</span></CodeLine>
<Link id="l07079" /><CodeLine lineNumber="7079"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a> = InsertedTrunc;</span></CodeLine>
<Link id="l07080" /><CodeLine lineNumber="7080"><span class="doxyHighlight">    ++NumExtUses;</span></CodeLine>
<Link id="l07081" /><CodeLine lineNumber="7081"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07082" /><CodeLine lineNumber="7082"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07083" /><CodeLine lineNumber="7083"></CodeLine>
<Link id="l07084" /><CodeLine lineNumber="7084"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l07085" /><CodeLine lineNumber="7085"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07086" /><CodeLine lineNumber="7086"></CodeLine>
<Link id="l07087" /><CodeLine lineNumber="7087"><span class="doxyHighlightComment">// Find loads whose uses only use some of the loaded value&#39;s bits.  Add an &quot;and&quot;</span></CodeLine>
<Link id="l07088" /><CodeLine lineNumber="7088"><span class="doxyHighlightComment">// just after the load if the target can fold this into one extload instruction,</span></CodeLine>
<Link id="l07089" /><CodeLine lineNumber="7089"><span class="doxyHighlightComment">// with the hope of eliminating some of the other later &quot;and&quot; instructions using</span></CodeLine>
<Link id="l07090" /><CodeLine lineNumber="7090"><span class="doxyHighlightComment">// the loaded value.  &quot;and&quot;s that are made trivially redundant by the insertion</span></CodeLine>
<Link id="l07091" /><CodeLine lineNumber="7091"><span class="doxyHighlightComment">// of the new &quot;and&quot; are removed by this function, while others (e.g. those whose</span></CodeLine>
<Link id="l07092" /><CodeLine lineNumber="7092"><span class="doxyHighlightComment">// path from the load goes through a phi) are left for isel to potentially</span></CodeLine>
<Link id="l07093" /><CodeLine lineNumber="7093"><span class="doxyHighlightComment">// remove.</span></CodeLine>
<Link id="l07094" /><CodeLine lineNumber="7094"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07095" /><CodeLine lineNumber="7095"><span class="doxyHighlightComment">// For example:</span></CodeLine>
<Link id="l07096" /><CodeLine lineNumber="7096"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07097" /><CodeLine lineNumber="7097"><span class="doxyHighlightComment">// b0:</span></CodeLine>
<Link id="l07098" /><CodeLine lineNumber="7098"><span class="doxyHighlightComment">//   x = load i32</span></CodeLine>
<Link id="l07099" /><CodeLine lineNumber="7099"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l07100" /><CodeLine lineNumber="7100"><span class="doxyHighlightComment">// b1:</span></CodeLine>
<Link id="l07101" /><CodeLine lineNumber="7101"><span class="doxyHighlightComment">//   y = and x, 255</span></CodeLine>
<Link id="l07102" /><CodeLine lineNumber="7102"><span class="doxyHighlightComment">//   z = use y</span></CodeLine>
<Link id="l07103" /><CodeLine lineNumber="7103"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07104" /><CodeLine lineNumber="7104"><span class="doxyHighlightComment">// becomes:</span></CodeLine>
<Link id="l07105" /><CodeLine lineNumber="7105"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07106" /><CodeLine lineNumber="7106"><span class="doxyHighlightComment">// b0:</span></CodeLine>
<Link id="l07107" /><CodeLine lineNumber="7107"><span class="doxyHighlightComment">//   x = load i32</span></CodeLine>
<Link id="l07108" /><CodeLine lineNumber="7108"><span class="doxyHighlightComment">//   x&#39; = and x, 255</span></CodeLine>
<Link id="l07109" /><CodeLine lineNumber="7109"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l07110" /><CodeLine lineNumber="7110"><span class="doxyHighlightComment">// b1:</span></CodeLine>
<Link id="l07111" /><CodeLine lineNumber="7111"><span class="doxyHighlightComment">//   z = use x&#39;</span></CodeLine>
<Link id="l07112" /><CodeLine lineNumber="7112"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07113" /><CodeLine lineNumber="7113"><span class="doxyHighlightComment">// whereas:</span></CodeLine>
<Link id="l07114" /><CodeLine lineNumber="7114"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07115" /><CodeLine lineNumber="7115"><span class="doxyHighlightComment">// b0:</span></CodeLine>
<Link id="l07116" /><CodeLine lineNumber="7116"><span class="doxyHighlightComment">//   x1 = load i32</span></CodeLine>
<Link id="l07117" /><CodeLine lineNumber="7117"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l07118" /><CodeLine lineNumber="7118"><span class="doxyHighlightComment">// b1:</span></CodeLine>
<Link id="l07119" /><CodeLine lineNumber="7119"><span class="doxyHighlightComment">//   x2 = load i32</span></CodeLine>
<Link id="l07120" /><CodeLine lineNumber="7120"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l07121" /><CodeLine lineNumber="7121"><span class="doxyHighlightComment">// b2:</span></CodeLine>
<Link id="l07122" /><CodeLine lineNumber="7122"><span class="doxyHighlightComment">//   x = phi x1, x2</span></CodeLine>
<Link id="l07123" /><CodeLine lineNumber="7123"><span class="doxyHighlightComment">//   y = and x, 255</span></CodeLine>
<Link id="l07124" /><CodeLine lineNumber="7124"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07125" /><CodeLine lineNumber="7125"><span class="doxyHighlightComment">// becomes (after a call to optimizeLoadExt for each load):</span></CodeLine>
<Link id="l07126" /><CodeLine lineNumber="7126"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07127" /><CodeLine lineNumber="7127"><span class="doxyHighlightComment">// b0:</span></CodeLine>
<Link id="l07128" /><CodeLine lineNumber="7128"><span class="doxyHighlightComment">//   x1 = load i32</span></CodeLine>
<Link id="l07129" /><CodeLine lineNumber="7129"><span class="doxyHighlightComment">//   x1&#39; = and x1, 255</span></CodeLine>
<Link id="l07130" /><CodeLine lineNumber="7130"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l07131" /><CodeLine lineNumber="7131"><span class="doxyHighlightComment">// b1:</span></CodeLine>
<Link id="l07132" /><CodeLine lineNumber="7132"><span class="doxyHighlightComment">//   x2 = load i32</span></CodeLine>
<Link id="l07133" /><CodeLine lineNumber="7133"><span class="doxyHighlightComment">//   x2&#39; = and x2, 255</span></CodeLine>
<Link id="l07134" /><CodeLine lineNumber="7134"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l07135" /><CodeLine lineNumber="7135"><span class="doxyHighlightComment">// b2:</span></CodeLine>
<Link id="l07136" /><CodeLine lineNumber="7136"><span class="doxyHighlightComment">//   x = phi x1&#39;, x2&#39;</span></CodeLine>
<Link id="l07137" /><CodeLine lineNumber="7137"><span class="doxyHighlightComment">//   y = and x, 255</span></CodeLine>
<Link id="l07138" /><CodeLine lineNumber="7138"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeLoadExt(LoadInst &#42;Load) &#123;</span></CodeLine>
<Link id="l07139" /><CodeLine lineNumber="7139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;isSimple() || !<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType()-&gt;isIntOrPtrTy())</span></CodeLine>
<Link id="l07140" /><CodeLine lineNumber="7140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07141" /><CodeLine lineNumber="7141"></CodeLine>
<Link id="l07142" /><CodeLine lineNumber="7142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip loads we&#39;ve already transformed.</span></CodeLine>
<Link id="l07143" /><CodeLine lineNumber="7143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;hasOneUse() &amp;&amp;</span></CodeLine>
<Link id="l07144" /><CodeLine lineNumber="7144"><span class="doxyHighlight">      InsertedInsts.count(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;user&#95;begin())))</span></CodeLine>
<Link id="l07145" /><CodeLine lineNumber="7145"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07146" /><CodeLine lineNumber="7146"></CodeLine>
<Link id="l07147" /><CodeLine lineNumber="7147"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look at all uses of Load, looking through phis, to determine how many bits</span></CodeLine>
<Link id="l07148" /><CodeLine lineNumber="7148"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the loaded value are needed.</span></CodeLine>
<Link id="l07149" /><CodeLine lineNumber="7149"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 8&gt; WorkList;</span></CodeLine>
<Link id="l07150" /><CodeLine lineNumber="7150"><span class="doxyHighlight">  SmallPtrSet&lt;Instruction &#42;, 16&gt; Visited;</span></CodeLine>
<Link id="l07151" /><CodeLine lineNumber="7151"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 8&gt; AndsToMaybeRemove;</span></CodeLine>
<Link id="l07152" /><CodeLine lineNumber="7152"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 8&gt; DropFlags;</span></CodeLine>
<Link id="l07153" /><CodeLine lineNumber="7153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;users())</span></CodeLine>
<Link id="l07154" /><CodeLine lineNumber="7154"><span class="doxyHighlight">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</span></CodeLine>
<Link id="l07155" /><CodeLine lineNumber="7155"></CodeLine>
<Link id="l07156" /><CodeLine lineNumber="7156"><span class="doxyHighlight">  EVT LoadResultVT = TLI-&gt;getValueType(&#42;DL, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType());</span></CodeLine>
<Link id="l07157" /><CodeLine lineNumber="7157"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = LoadResultVT.<a href="/docs/api/structs/llvm/evt/#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>();</span></CodeLine>
<Link id="l07158" /><CodeLine lineNumber="7158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the BitWidth is 0, do not try to optimize the type</span></CodeLine>
<Link id="l07159" /><CodeLine lineNumber="7159"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> == 0)</span></CodeLine>
<Link id="l07160" /><CodeLine lineNumber="7160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07161" /><CodeLine lineNumber="7161"></CodeLine>
<Link id="l07162" /><CodeLine lineNumber="7162"><span class="doxyHighlight">  APInt DemandBits(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 0);</span></CodeLine>
<Link id="l07163" /><CodeLine lineNumber="7163"><span class="doxyHighlight">  APInt WidestAndBits(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 0);</span></CodeLine>
<Link id="l07164" /><CodeLine lineNumber="7164"></CodeLine>
<Link id="l07165" /><CodeLine lineNumber="7165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l07166" /><CodeLine lineNumber="7166"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l07167" /><CodeLine lineNumber="7167"></CodeLine>
<Link id="l07168" /><CodeLine lineNumber="7168"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Break use-def graph loops.</span></CodeLine>
<Link id="l07169" /><CodeLine lineNumber="7169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</span></CodeLine>
<Link id="l07170" /><CodeLine lineNumber="7170"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07171" /><CodeLine lineNumber="7171"></CodeLine>
<Link id="l07172" /><CodeLine lineNumber="7172"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For a PHI node, push all of its users.</span></CodeLine>
<Link id="l07173" /><CodeLine lineNumber="7173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l07174" /><CodeLine lineNumber="7174"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;users())</span></CodeLine>
<Link id="l07175" /><CodeLine lineNumber="7175"><span class="doxyHighlight">        WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</span></CodeLine>
<Link id="l07176" /><CodeLine lineNumber="7176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07177" /><CodeLine lineNumber="7177"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07178" /><CodeLine lineNumber="7178"></CodeLine>
<Link id="l07179" /><CodeLine lineNumber="7179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l07180" /><CodeLine lineNumber="7180"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And: &#123;</span></CodeLine>
<Link id="l07181" /><CodeLine lineNumber="7181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AndC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l07182" /><CodeLine lineNumber="7182"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AndC)</span></CodeLine>
<Link id="l07183" /><CodeLine lineNumber="7183"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07184" /><CodeLine lineNumber="7184"><span class="doxyHighlight">      APInt AndBits = AndC-&gt;getValue();</span></CodeLine>
<Link id="l07185" /><CodeLine lineNumber="7185"><span class="doxyHighlight">      DemandBits |= AndBits;</span></CodeLine>
<Link id="l07186" /><CodeLine lineNumber="7186"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Keep track of the widest and mask we see.</span></CodeLine>
<Link id="l07187" /><CodeLine lineNumber="7187"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AndBits.<a href="/docs/api/classes/llvm/apint/#a46a7cbf3724080a5f4f4c7e7a4551e26">ugt</a>(WidestAndBits))</span></CodeLine>
<Link id="l07188" /><CodeLine lineNumber="7188"><span class="doxyHighlight">        WidestAndBits = AndBits;</span></CodeLine>
<Link id="l07189" /><CodeLine lineNumber="7189"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AndBits == WidestAndBits &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0) == Load)</span></CodeLine>
<Link id="l07190" /><CodeLine lineNumber="7190"><span class="doxyHighlight">        AndsToMaybeRemove.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07191" /><CodeLine lineNumber="7191"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07192" /><CodeLine lineNumber="7192"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07193" /><CodeLine lineNumber="7193"></CodeLine>
<Link id="l07194" /><CodeLine lineNumber="7194"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl: &#123;</span></CodeLine>
<Link id="l07195" /><CodeLine lineNumber="7195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ShlC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l07196" /><CodeLine lineNumber="7196"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ShlC)</span></CodeLine>
<Link id="l07197" /><CodeLine lineNumber="7197"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07198" /><CodeLine lineNumber="7198"><span class="doxyHighlight">      uint64&#95;t ShiftAmt = ShlC-&gt;getLimitedValue(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - 1);</span></CodeLine>
<Link id="l07199" /><CodeLine lineNumber="7199"><span class="doxyHighlight">      DemandBits.setLowBits(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - ShiftAmt);</span></CodeLine>
<Link id="l07200" /><CodeLine lineNumber="7200"><span class="doxyHighlight">      DropFlags.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07201" /><CodeLine lineNumber="7201"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07202" /><CodeLine lineNumber="7202"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07203" /><CodeLine lineNumber="7203"></CodeLine>
<Link id="l07204" /><CodeLine lineNumber="7204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Trunc: &#123;</span></CodeLine>
<Link id="l07205" /><CodeLine lineNumber="7205"><span class="doxyHighlight">      EVT TruncVT = TLI-&gt;getValueType(&#42;DL, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType());</span></CodeLine>
<Link id="l07206" /><CodeLine lineNumber="7206"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TruncBitWidth = TruncVT.<a href="/docs/api/structs/llvm/evt/#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>();</span></CodeLine>
<Link id="l07207" /><CodeLine lineNumber="7207"><span class="doxyHighlight">      DemandBits.setLowBits(TruncBitWidth);</span></CodeLine>
<Link id="l07208" /><CodeLine lineNumber="7208"><span class="doxyHighlight">      DropFlags.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07209" /><CodeLine lineNumber="7209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07210" /><CodeLine lineNumber="7210"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07211" /><CodeLine lineNumber="7211"></CodeLine>
<Link id="l07212" /><CodeLine lineNumber="7212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l07213" /><CodeLine lineNumber="7213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07214" /><CodeLine lineNumber="7214"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07215" /><CodeLine lineNumber="7215"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07216" /><CodeLine lineNumber="7216"></CodeLine>
<Link id="l07217" /><CodeLine lineNumber="7217"><span class="doxyHighlight">  uint32&#95;t ActiveBits = DemandBits.getActiveBits();</span></CodeLine>
<Link id="l07218" /><CodeLine lineNumber="7218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid hoisting (and (load x) 1) since it is unlikely to be folded by the</span></CodeLine>
<Link id="l07219" /><CodeLine lineNumber="7219"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// target even if isLoadExtLegal says an i1 EXTLOAD is valid.  For example,</span></CodeLine>
<Link id="l07220" /><CodeLine lineNumber="7220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for the AArch64 target isLoadExtLegal(ZEXTLOAD, i32, i1) returns true, but</span></CodeLine>
<Link id="l07221" /><CodeLine lineNumber="7221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (and (load x) 1) is not matched as a single instruction, rather as a LDR</span></CodeLine>
<Link id="l07222" /><CodeLine lineNumber="7222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// followed by an AND.</span></CodeLine>
<Link id="l07223" /><CodeLine lineNumber="7223"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Look into removing this restriction by fixing backends to either</span></CodeLine>
<Link id="l07224" /><CodeLine lineNumber="7224"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return false for isLoadExtLegal for i1 or have them select this pattern to</span></CodeLine>
<Link id="l07225" /><CodeLine lineNumber="7225"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a single instruction.</span></CodeLine>
<Link id="l07226" /><CodeLine lineNumber="7226"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07227" /><CodeLine lineNumber="7227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Also avoid hoisting if we didn&#39;t see any ands with the exact DemandBits</span></CodeLine>
<Link id="l07228" /><CodeLine lineNumber="7228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mask, since these are the only ands that will be removed by isel.</span></CodeLine>
<Link id="l07229" /><CodeLine lineNumber="7229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ActiveBits &lt;= 1 || !DemandBits.isMask(ActiveBits) ||</span></CodeLine>
<Link id="l07230" /><CodeLine lineNumber="7230"><span class="doxyHighlight">      WidestAndBits != DemandBits)</span></CodeLine>
<Link id="l07231" /><CodeLine lineNumber="7231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07232" /><CodeLine lineNumber="7232"></CodeLine>
<Link id="l07233" /><CodeLine lineNumber="7233"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType()-&gt;getContext();</span></CodeLine>
<Link id="l07234" /><CodeLine lineNumber="7234"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TruncTy = Type::getIntNTy(Ctx, ActiveBits);</span></CodeLine>
<Link id="l07235" /><CodeLine lineNumber="7235"><span class="doxyHighlight">  EVT TruncVT = TLI-&gt;getValueType(&#42;DL, TruncTy);</span></CodeLine>
<Link id="l07236" /><CodeLine lineNumber="7236"></CodeLine>
<Link id="l07237" /><CodeLine lineNumber="7237"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reject cases that won&#39;t be matched as extloads.</span></CodeLine>
<Link id="l07238" /><CodeLine lineNumber="7238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadResultVT.<a href="/docs/api/structs/llvm/evt/#a3ad406477784397709a339d5a2957b43">bitsGT</a>(TruncVT) || !TruncVT.<a href="/docs/api/structs/llvm/evt/#ab41e50273c70287914ded0ae668bc507">isRound</a>() ||</span></CodeLine>
<Link id="l07239" /><CodeLine lineNumber="7239"><span class="doxyHighlight">      !TLI-&gt;isLoadExtLegal(<a href="/docs/api/namespaces/llvm/isd/#ad4d48171b87ca51ff54c10a436bac4d7a8d89c7da4444d9ec11667aa369abc5f7">ISD::ZEXTLOAD</a>, LoadResultVT, TruncVT))</span></CodeLine>
<Link id="l07240" /><CodeLine lineNumber="7240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07241" /><CodeLine lineNumber="7241"></CodeLine>
<Link id="l07242" /><CodeLine lineNumber="7242"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getNextNonDebugInstruction());</span></CodeLine>
<Link id="l07243" /><CodeLine lineNumber="7243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewAnd = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</span></CodeLine>
<Link id="l07244" /><CodeLine lineNumber="7244"><span class="doxyHighlight">      Builder.CreateAnd(Load, ConstantInt::get(Ctx, DemandBits)));</span></CodeLine>
<Link id="l07245" /><CodeLine lineNumber="7245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark this instruction as &quot;inserted by CGP&quot;, so that other</span></CodeLine>
<Link id="l07246" /><CodeLine lineNumber="7246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimizations don&#39;t touch it.</span></CodeLine>
<Link id="l07247" /><CodeLine lineNumber="7247"><span class="doxyHighlight">  InsertedInsts.insert(NewAnd);</span></CodeLine>
<Link id="l07248" /><CodeLine lineNumber="7248"></CodeLine>
<Link id="l07249" /><CodeLine lineNumber="7249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace all uses of load with new and (except for the use of load in the</span></CodeLine>
<Link id="l07250" /><CodeLine lineNumber="7250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// new and itself).</span></CodeLine>
<Link id="l07251" /><CodeLine lineNumber="7251"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Load, NewAnd, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l07252" /><CodeLine lineNumber="7252"><span class="doxyHighlight">  NewAnd-&gt;setOperand(0, Load);</span></CodeLine>
<Link id="l07253" /><CodeLine lineNumber="7253"></CodeLine>
<Link id="l07254" /><CodeLine lineNumber="7254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove any and instructions that are now redundant.</span></CodeLine>
<Link id="l07255" /><CodeLine lineNumber="7255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> : AndsToMaybeRemove)</span></CodeLine>
<Link id="l07256" /><CodeLine lineNumber="7256"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that the and mask is the same as the one we decided to put on the</span></CodeLine>
<Link id="l07257" /><CodeLine lineNumber="7257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// new and.</span></CodeLine>
<Link id="l07258" /><CodeLine lineNumber="7258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getOperand(1))-&gt;getValue() == DemandBits) &#123;</span></CodeLine>
<Link id="l07259" /><CodeLine lineNumber="7259"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, NewAnd, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l07260" /><CodeLine lineNumber="7260"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;CurInstIterator == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>)</span></CodeLine>
<Link id="l07261" /><CodeLine lineNumber="7261"><span class="doxyHighlight">        CurInstIterator = std::next(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getIterator());</span></CodeLine>
<Link id="l07262" /><CodeLine lineNumber="7262"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l07263" /><CodeLine lineNumber="7263"><span class="doxyHighlight">      ++NumAndUses;</span></CodeLine>
<Link id="l07264" /><CodeLine lineNumber="7264"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07265" /><CodeLine lineNumber="7265"></CodeLine>
<Link id="l07266" /><CodeLine lineNumber="7266"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NSW flags may not longer hold.</span></CodeLine>
<Link id="l07267" /><CodeLine lineNumber="7267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst : DropFlags)</span></CodeLine>
<Link id="l07268" /><CodeLine lineNumber="7268"><span class="doxyHighlight">    Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4166b451a572b1e5d3fea7250af53653">setHasNoSignedWrap</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07269" /><CodeLine lineNumber="7269"></CodeLine>
<Link id="l07270" /><CodeLine lineNumber="7270"><span class="doxyHighlight">  ++NumAndsAdded;</span></CodeLine>
<Link id="l07271" /><CodeLine lineNumber="7271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07272" /><CodeLine lineNumber="7272"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07273" /><CodeLine lineNumber="7273"></CodeLine>
<Link id="l07274" /><CodeLine lineNumber="7274"><span class="doxyHighlightComment">/// Check if V (an operand of a select instruction) is an expensive instruction</span></CodeLine>
<Link id="l07275" /><CodeLine lineNumber="7275"><span class="doxyHighlightComment">/// that is only used once.</span></CodeLine>
<Link id="l07276" /><CodeLine lineNumber="7276" lineLink="#a10ece31d94cdd66e58cef49d73f2263f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l07277" /><CodeLine lineNumber="7277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l07278" /><CodeLine lineNumber="7278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it&#39;s safe to speculatively execute, then it should not have side</span></CodeLine>
<Link id="l07279" /><CodeLine lineNumber="7279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// effects; therefore, it&#39;s safe to sink and possibly &#42;not&#42; execute.</span></CodeLine>
<Link id="l07280" /><CodeLine lineNumber="7280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l07281" /><CodeLine lineNumber="7281"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;isExpensiveToSpeculativelyExecute(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07282" /><CodeLine lineNumber="7282"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07283" /><CodeLine lineNumber="7283"></CodeLine>
<Link id="l07284" /><CodeLine lineNumber="7284"><span class="doxyHighlightComment">/// Returns true if a SelectInst should be turned into an explicit branch.</span></CodeLine>
<Link id="l07285" /><CodeLine lineNumber="7285" lineLink="#a4bde686b6506cc9e63919272711713f4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l07286" /><CodeLine lineNumber="7286"><span class="doxyHighlight">                                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &#42;TLI,</span></CodeLine>
<Link id="l07287" /><CodeLine lineNumber="7287"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l07288" /><CodeLine lineNumber="7288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If even a predictable select is cheap, then a branch can&#39;t be cheaper.</span></CodeLine>
<Link id="l07289" /><CodeLine lineNumber="7289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI-&gt;<a href="/docs/api/classes/llvm/targetloweringbase/#aa9f4cbd152c2c5d84007f3ad710ee895">isPredictableSelectExpensive</a>())</span></CodeLine>
<Link id="l07290" /><CodeLine lineNumber="7290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07291" /><CodeLine lineNumber="7291"></CodeLine>
<Link id="l07292" /><CodeLine lineNumber="7292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This should use the same heuristics as IfConversion to determine</span></CodeLine>
<Link id="l07293" /><CodeLine lineNumber="7293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// whether a select is better represented as a branch.</span></CodeLine>
<Link id="l07294" /><CodeLine lineNumber="7294"></CodeLine>
<Link id="l07295" /><CodeLine lineNumber="7295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If metadata tells us that the select condition is obviously predictable,</span></CodeLine>
<Link id="l07296" /><CodeLine lineNumber="7296"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then we want to replace the select with a branch.</span></CodeLine>
<Link id="l07297" /><CodeLine lineNumber="7297"><span class="doxyHighlight">  uint64&#95;t TrueWeight, FalseWeight;</span></CodeLine>
<Link id="l07298" /><CodeLine lineNumber="7298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, TrueWeight, FalseWeight)) &#123;</span></CodeLine>
<Link id="l07299" /><CodeLine lineNumber="7299"><span class="doxyHighlight">    uint64&#95;t Max = std::max(TrueWeight, FalseWeight);</span></CodeLine>
<Link id="l07300" /><CodeLine lineNumber="7300"><span class="doxyHighlight">    uint64&#95;t Sum = TrueWeight + FalseWeight;</span></CodeLine>
<Link id="l07301" /><CodeLine lineNumber="7301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Sum != 0) &#123;</span></CodeLine>
<Link id="l07302" /><CodeLine lineNumber="7302"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Probability = <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(Max, Sum);</span></CodeLine>
<Link id="l07303" /><CodeLine lineNumber="7303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Probability &gt; <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getPredictableBranchThreshold())</span></CodeLine>
<Link id="l07304" /><CodeLine lineNumber="7304"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07305" /><CodeLine lineNumber="7305"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07306" /><CodeLine lineNumber="7306"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07307" /><CodeLine lineNumber="7307"></CodeLine>
<Link id="l07308" /><CodeLine lineNumber="7308"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l07309" /><CodeLine lineNumber="7309"></CodeLine>
<Link id="l07310" /><CodeLine lineNumber="7310"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If a branch is predictable, an out-of-order CPU can avoid blocking on its</span></CodeLine>
<Link id="l07311" /><CodeLine lineNumber="7311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// comparison condition. If the compare has more than one use, there&#39;s</span></CodeLine>
<Link id="l07312" /><CodeLine lineNumber="7312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// probably another cmov or setcc around, so it&#39;s not worth emitting a branch.</span></CodeLine>
<Link id="l07313" /><CodeLine lineNumber="7313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cmp || !Cmp-&gt;hasOneUse())</span></CodeLine>
<Link id="l07314" /><CodeLine lineNumber="7314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07315" /><CodeLine lineNumber="7315"></CodeLine>
<Link id="l07316" /><CodeLine lineNumber="7316"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If either operand of the select is expensive and only needed on one side</span></CodeLine>
<Link id="l07317" /><CodeLine lineNumber="7317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the select, we should form a branch.</span></CodeLine>
<Link id="l07318" /><CodeLine lineNumber="7318"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue()) ||</span></CodeLine>
<Link id="l07319" /><CodeLine lineNumber="7319"><span class="doxyHighlight">      <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue()))</span></CodeLine>
<Link id="l07320" /><CodeLine lineNumber="7320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07321" /><CodeLine lineNumber="7321"></CodeLine>
<Link id="l07322" /><CodeLine lineNumber="7322"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07323" /><CodeLine lineNumber="7323"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07324" /><CodeLine lineNumber="7324"></CodeLine>
<Link id="l07325" /><CodeLine lineNumber="7325"><span class="doxyHighlightComment">/// If \\p isTrue is true, return the true value of \\p SI, otherwise return</span></CodeLine>
<Link id="l07326" /><CodeLine lineNumber="7326"><span class="doxyHighlightComment">/// false value of \\p SI. If the true/false value of \\p SI is defined by any</span></CodeLine>
<Link id="l07327" /><CodeLine lineNumber="7327"><span class="doxyHighlightComment">/// select instructions in \\p Selects, look through the defining select</span></CodeLine>
<Link id="l07328" /><CodeLine lineNumber="7328"><span class="doxyHighlightComment">/// instruction until the true/false value is not defined in \\p Selects.</span></CodeLine>
<Link id="l07329" /><CodeLine lineNumber="7329"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;</span></CodeLine>
<Link id="l07330" /><CodeLine lineNumber="7330" lineLink="#a596c5a8a807f6ce192718084a11648de"><span class="doxyHighlight"><a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isTrue,</span></CodeLine>
<Link id="l07331" /><CodeLine lineNumber="7331"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 2&gt;</a> &amp;Selects) &#123;</span></CodeLine>
<Link id="l07332" /><CodeLine lineNumber="7332"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07333" /><CodeLine lineNumber="7333"></CodeLine>
<Link id="l07334" /><CodeLine lineNumber="7334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;DefSI = <a href="/docs/api/namespaces/llvm/si">SI</a>; DefSI != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; Selects.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(DefSI);</span></CodeLine>
<Link id="l07335" /><CodeLine lineNumber="7335"><span class="doxyHighlight">       DefSI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l07336" /><CodeLine lineNumber="7336"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DefSI-&gt;getCondition() == <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition() &amp;&amp;</span></CodeLine>
<Link id="l07337" /><CodeLine lineNumber="7337"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;The condition of DefSI does not match with SI&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07338" /><CodeLine lineNumber="7338"><span class="doxyHighlight">    V = (isTrue ? DefSI-&gt;getTrueValue() : DefSI-&gt;getFalseValue());</span></CodeLine>
<Link id="l07339" /><CodeLine lineNumber="7339"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07340" /><CodeLine lineNumber="7340"></CodeLine>
<Link id="l07341" /><CodeLine lineNumber="7341"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Failed to get select true/false value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07342" /><CodeLine lineNumber="7342"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l07343" /><CodeLine lineNumber="7343"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07344" /><CodeLine lineNumber="7344"></CodeLine>
<Link id="l07345" /><CodeLine lineNumber="7345"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeShiftInst(BinaryOperator &#42;Shift) &#123;</span></CodeLine>
<Link id="l07346" /><CodeLine lineNumber="7346"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shift-&gt;<a href="/docs/api/classes/llvm/instruction/#ac5984d6827f6e6922bed00bf03ba9552">isShift</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a shift&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07347" /><CodeLine lineNumber="7347"></CodeLine>
<Link id="l07348" /><CodeLine lineNumber="7348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is (1) a vector shift, (2) shifts by scalars are cheaper than</span></CodeLine>
<Link id="l07349" /><CodeLine lineNumber="7349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// general vector shifts, and (3) the shift amount is a select-of-splatted</span></CodeLine>
<Link id="l07350" /><CodeLine lineNumber="7350"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values, hoist the shifts before the select:</span></CodeLine>
<Link id="l07351" /><CodeLine lineNumber="7351"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   shift Op0, (select Cond, TVal, FVal) --&gt;</span></CodeLine>
<Link id="l07352" /><CodeLine lineNumber="7352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   select Cond, (shift Op0, TVal), (shift Op0, FVal)</span></CodeLine>
<Link id="l07353" /><CodeLine lineNumber="7353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07354" /><CodeLine lineNumber="7354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is inverting a generic IR transform when we know that the cost of a</span></CodeLine>
<Link id="l07355" /><CodeLine lineNumber="7355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// general vector shift is more than the cost of 2 shift-by-scalars.</span></CodeLine>
<Link id="l07356" /><CodeLine lineNumber="7356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t do this effectively in SDAG because we may not be able to</span></CodeLine>
<Link id="l07357" /><CodeLine lineNumber="7357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// determine if the select operands are splats from within a basic block.</span></CodeLine>
<Link id="l07358" /><CodeLine lineNumber="7358"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty = Shift-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l07359" /><CodeLine lineNumber="7359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ty-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !TTI-&gt;isVectorShiftByScalarCheap(Ty))</span></CodeLine>
<Link id="l07360" /><CodeLine lineNumber="7360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07361" /><CodeLine lineNumber="7361"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;TVal, &#42;FVal;</span></CodeLine>
<Link id="l07362" /><CodeLine lineNumber="7362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shift-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1),</span></CodeLine>
<Link id="l07363" /><CodeLine lineNumber="7363"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(TVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(FVal)))))</span></CodeLine>
<Link id="l07364" /><CodeLine lineNumber="7364"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07365" /><CodeLine lineNumber="7365"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(TVal) || !<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(FVal))</span></CodeLine>
<Link id="l07366" /><CodeLine lineNumber="7366"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07367" /><CodeLine lineNumber="7367"></CodeLine>
<Link id="l07368" /><CodeLine lineNumber="7368"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(Shift);</span></CodeLine>
<Link id="l07369" /><CodeLine lineNumber="7369"><span class="doxyHighlight">  BinaryOperator::BinaryOps Opcode = Shift-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</span></CodeLine>
<Link id="l07370" /><CodeLine lineNumber="7370"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewTVal = Builder.CreateBinOp(Opcode, Shift-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), TVal);</span></CodeLine>
<Link id="l07371" /><CodeLine lineNumber="7371"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewFVal = Builder.CreateBinOp(Opcode, Shift-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), FVal);</span></CodeLine>
<Link id="l07372" /><CodeLine lineNumber="7372"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewSel = Builder.CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NewTVal, NewFVal);</span></CodeLine>
<Link id="l07373" /><CodeLine lineNumber="7373"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Shift, NewSel, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l07374" /><CodeLine lineNumber="7374"><span class="doxyHighlight">  Shift-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l07375" /><CodeLine lineNumber="7375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07376" /><CodeLine lineNumber="7376"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07377" /><CodeLine lineNumber="7377"></CodeLine>
<Link id="l07378" /><CodeLine lineNumber="7378"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeFunnelShift(IntrinsicInst &#42;Fsh) &#123;</span></CodeLine>
<Link id="l07379" /><CodeLine lineNumber="7379"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> Opcode = Fsh-&gt;<a href="/docs/api/classes/llvm/intrinsicinst/#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>();</span></CodeLine>
<Link id="l07380" /><CodeLine lineNumber="7380"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == Intrinsic::fshl || Opcode == Intrinsic::fshr) &amp;&amp;</span></CodeLine>
<Link id="l07381" /><CodeLine lineNumber="7381"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected a funnel shift&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07382" /><CodeLine lineNumber="7382"></CodeLine>
<Link id="l07383" /><CodeLine lineNumber="7383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is (1) a vector funnel shift, (2) shifts by scalars are cheaper</span></CodeLine>
<Link id="l07384" /><CodeLine lineNumber="7384"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// than general vector shifts, and (3) the shift amount is select-of-splatted</span></CodeLine>
<Link id="l07385" /><CodeLine lineNumber="7385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values, hoist the funnel shifts before the select:</span></CodeLine>
<Link id="l07386" /><CodeLine lineNumber="7386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   fsh Op0, Op1, (select Cond, TVal, FVal) --&gt;</span></CodeLine>
<Link id="l07387" /><CodeLine lineNumber="7387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   select Cond, (fsh Op0, Op1, TVal), (fsh Op0, Op1, FVal)</span></CodeLine>
<Link id="l07388" /><CodeLine lineNumber="7388"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07389" /><CodeLine lineNumber="7389"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is inverting a generic IR transform when we know that the cost of a</span></CodeLine>
<Link id="l07390" /><CodeLine lineNumber="7390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// general vector shift is more than the cost of 2 shift-by-scalars.</span></CodeLine>
<Link id="l07391" /><CodeLine lineNumber="7391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t do this effectively in SDAG because we may not be able to</span></CodeLine>
<Link id="l07392" /><CodeLine lineNumber="7392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// determine if the select operands are splats from within a basic block.</span></CodeLine>
<Link id="l07393" /><CodeLine lineNumber="7393"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty = Fsh-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l07394" /><CodeLine lineNumber="7394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ty-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !TTI-&gt;isVectorShiftByScalarCheap(Ty))</span></CodeLine>
<Link id="l07395" /><CodeLine lineNumber="7395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07396" /><CodeLine lineNumber="7396"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;TVal, &#42;FVal;</span></CodeLine>
<Link id="l07397" /><CodeLine lineNumber="7397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Fsh-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2),</span></CodeLine>
<Link id="l07398" /><CodeLine lineNumber="7398"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(TVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(FVal)))))</span></CodeLine>
<Link id="l07399" /><CodeLine lineNumber="7399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07400" /><CodeLine lineNumber="7400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(TVal) || !<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(FVal))</span></CodeLine>
<Link id="l07401" /><CodeLine lineNumber="7401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07402" /><CodeLine lineNumber="7402"></CodeLine>
<Link id="l07403" /><CodeLine lineNumber="7403"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(Fsh);</span></CodeLine>
<Link id="l07404" /><CodeLine lineNumber="7404"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Fsh-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = Fsh-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l07405" /><CodeLine lineNumber="7405"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewTVal = Builder.CreateIntrinsic(Opcode, Ty, &#123;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, TVal&#125;);</span></CodeLine>
<Link id="l07406" /><CodeLine lineNumber="7406"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewFVal = Builder.CreateIntrinsic(Opcode, Ty, &#123;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, FVal&#125;);</span></CodeLine>
<Link id="l07407" /><CodeLine lineNumber="7407"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewSel = Builder.CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NewTVal, NewFVal);</span></CodeLine>
<Link id="l07408" /><CodeLine lineNumber="7408"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Fsh, NewSel, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l07409" /><CodeLine lineNumber="7409"><span class="doxyHighlight">  Fsh-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l07410" /><CodeLine lineNumber="7410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07411" /><CodeLine lineNumber="7411"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07412" /><CodeLine lineNumber="7412"></CodeLine>
<Link id="l07413" /><CodeLine lineNumber="7413"><span class="doxyHighlightComment">/// If we have a SelectInst that will likely profit from branch prediction,</span></CodeLine>
<Link id="l07414" /><CodeLine lineNumber="7414"><span class="doxyHighlightComment">/// turn it into a branch.</span></CodeLine>
<Link id="l07415" /><CodeLine lineNumber="7415"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeSelectInst(SelectInst &#42;SI) &#123;</span></CodeLine>
<Link id="l07416" /><CodeLine lineNumber="7416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#af42b66ae716b910d032498490940ae08">DisableSelectToBranch</a>)</span></CodeLine>
<Link id="l07417" /><CodeLine lineNumber="7417"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07418" /><CodeLine lineNumber="7418"></CodeLine>
<Link id="l07419" /><CodeLine lineNumber="7419"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the SelectOptimize pass is enabled, selects have already been optimized.</span></CodeLine>
<Link id="l07420" /><CodeLine lineNumber="7420"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#aff30786f1ea13c3ea475acce504571e4">getCGPassBuilderOption</a>().<a href="/docs/api/files/lib/lib/codegen/targetpassconfig-cpp/#a7e81429317cf832a7e2367c98629474f">DisableSelectOptimize</a>)</span></CodeLine>
<Link id="l07421" /><CodeLine lineNumber="7421"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07422" /><CodeLine lineNumber="7422"></CodeLine>
<Link id="l07423" /><CodeLine lineNumber="7423"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find all consecutive select instructions that share the same condition.</span></CodeLine>
<Link id="l07424" /><CodeLine lineNumber="7424"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;SelectInst &#42;, 2&gt;</a> ASI;</span></CodeLine>
<Link id="l07425" /><CodeLine lineNumber="7425"><span class="doxyHighlight">  ASI.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SI);</span></CodeLine>
<Link id="l07426" /><CodeLine lineNumber="7426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = ++<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(SI);</span></CodeLine>
<Link id="l07427" /><CodeLine lineNumber="7427"><span class="doxyHighlight">       It != <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent()-&gt;<a href="/docs/api/namespaces/llvm/sandboxir/#a64ac61287490361f2183faf1d7639ee9">end</a>(); ++It) &#123;</span></CodeLine>
<Link id="l07428" /><CodeLine lineNumber="7428"><span class="doxyHighlight">    SelectInst &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(&amp;&#42;It);</span></CodeLine>
<Link id="l07429" /><CodeLine lineNumber="7429"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCondition()) &#123;</span></CodeLine>
<Link id="l07430" /><CodeLine lineNumber="7430"><span class="doxyHighlight">      ASI.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07431" /><CodeLine lineNumber="7431"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07432" /><CodeLine lineNumber="7432"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07433" /><CodeLine lineNumber="7433"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07434" /><CodeLine lineNumber="7434"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07435" /><CodeLine lineNumber="7435"></CodeLine>
<Link id="l07436" /><CodeLine lineNumber="7436"><span class="doxyHighlight">  SelectInst &#42;LastSI = ASI.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>();</span></CodeLine>
<Link id="l07437" /><CodeLine lineNumber="7437"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Increment the current iterator to skip all the rest of select instructions</span></CodeLine>
<Link id="l07438" /><CodeLine lineNumber="7438"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because they will be either &quot;not lowered&quot; or &quot;all lowered&quot; to branch.</span></CodeLine>
<Link id="l07439" /><CodeLine lineNumber="7439"><span class="doxyHighlight">  CurInstIterator = std::next(LastSI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l07440" /><CodeLine lineNumber="7440"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Examine debug-info attached to the consecutive select instructions. They</span></CodeLine>
<Link id="l07441" /><CodeLine lineNumber="7441"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// won&#39;t be individually optimised by optimizeInst, so we need to perform</span></CodeLine>
<Link id="l07442" /><CodeLine lineNumber="7442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DbgVariableRecord maintenence here instead.</span></CodeLine>
<Link id="l07443" /><CodeLine lineNumber="7443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (SelectInst &#42;SI : <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(ASI).drop&#95;front())</span></CodeLine>
<Link id="l07444" /><CodeLine lineNumber="7444"><span class="doxyHighlight">    fixupDbgVariableRecordsOnInst(&#42;SI);</span></CodeLine>
<Link id="l07445" /><CodeLine lineNumber="7445"></CodeLine>
<Link id="l07446" /><CodeLine lineNumber="7446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VectorCond = !<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition()-&gt;getType()-&gt;isIntegerTy(1);</span></CodeLine>
<Link id="l07447" /><CodeLine lineNumber="7447"></CodeLine>
<Link id="l07448" /><CodeLine lineNumber="7448"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can we convert the &#39;select&#39; to CF ?</span></CodeLine>
<Link id="l07449" /><CodeLine lineNumber="7449"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorCond || <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getMetadata(LLVMContext::MD&#95;unpredictable))</span></CodeLine>
<Link id="l07450" /><CodeLine lineNumber="7450"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07451" /><CodeLine lineNumber="7451"></CodeLine>
<Link id="l07452" /><CodeLine lineNumber="7452"><span class="doxyHighlight">  TargetLowering::SelectSupportKind SelectKind;</span></CodeLine>
<Link id="l07453" /><CodeLine lineNumber="7453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getType()-&gt;isVectorTy())</span></CodeLine>
<Link id="l07454" /><CodeLine lineNumber="7454"><span class="doxyHighlight">    SelectKind = TargetLowering::ScalarCondVectorVal;</span></CodeLine>
<Link id="l07455" /><CodeLine lineNumber="7455"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07456" /><CodeLine lineNumber="7456"><span class="doxyHighlight">    SelectKind = TargetLowering::ScalarValSelect;</span></CodeLine>
<Link id="l07457" /><CodeLine lineNumber="7457"></CodeLine>
<Link id="l07458" /><CodeLine lineNumber="7458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI-&gt;isSelectSupported(SelectKind) &amp;&amp;</span></CodeLine>
<Link id="l07459" /><CodeLine lineNumber="7459"><span class="doxyHighlight">      (!<a href="#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a>(TTI, TLI, SI) ||</span></CodeLine>
<Link id="l07460" /><CodeLine lineNumber="7460"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent(), PSI, BFI.get())))</span></CodeLine>
<Link id="l07461" /><CodeLine lineNumber="7461"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07462" /><CodeLine lineNumber="7462"></CodeLine>
<Link id="l07463" /><CodeLine lineNumber="7463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The DominatorTree needs to be rebuilt by any consumers after this</span></CodeLine>
<Link id="l07464" /><CodeLine lineNumber="7464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transformation. We simply reset here rather than setting the ModifiedDT</span></CodeLine>
<Link id="l07465" /><CodeLine lineNumber="7465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// flag to avoid restarting the function walk in runOnFunction for each</span></CodeLine>
<Link id="l07466" /><CodeLine lineNumber="7466"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// select optimized.</span></CodeLine>
<Link id="l07467" /><CodeLine lineNumber="7467"><span class="doxyHighlight">  DT.reset();</span></CodeLine>
<Link id="l07468" /><CodeLine lineNumber="7468"></CodeLine>
<Link id="l07469" /><CodeLine lineNumber="7469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transform a sequence like this:</span></CodeLine>
<Link id="l07470" /><CodeLine lineNumber="7470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    start:</span></CodeLine>
<Link id="l07471" /><CodeLine lineNumber="7471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %cmp = cmp uge i32 %a, %b</span></CodeLine>
<Link id="l07472" /><CodeLine lineNumber="7472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %sel = select i1 %cmp, i32 %c, i32 %d</span></CodeLine>
<Link id="l07473" /><CodeLine lineNumber="7473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07474" /><CodeLine lineNumber="7474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Into:</span></CodeLine>
<Link id="l07475" /><CodeLine lineNumber="7475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    start:</span></CodeLine>
<Link id="l07476" /><CodeLine lineNumber="7476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %cmp = cmp uge i32 %a, %b</span></CodeLine>
<Link id="l07477" /><CodeLine lineNumber="7477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %cmp.frozen = freeze %cmp</span></CodeLine>
<Link id="l07478" /><CodeLine lineNumber="7478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       br i1 %cmp.frozen, label %select.true, label %select.false</span></CodeLine>
<Link id="l07479" /><CodeLine lineNumber="7479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    select.true:</span></CodeLine>
<Link id="l07480" /><CodeLine lineNumber="7480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       br label %select.end</span></CodeLine>
<Link id="l07481" /><CodeLine lineNumber="7481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    select.false:</span></CodeLine>
<Link id="l07482" /><CodeLine lineNumber="7482"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       br label %select.end</span></CodeLine>
<Link id="l07483" /><CodeLine lineNumber="7483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    select.end:</span></CodeLine>
<Link id="l07484" /><CodeLine lineNumber="7484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %sel = phi i32 &#91; %c, %select.true &#93;, &#91; %d, %select.false &#93;</span></CodeLine>
<Link id="l07485" /><CodeLine lineNumber="7485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07486" /><CodeLine lineNumber="7486"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %cmp should be frozen, otherwise it may introduce undefined behavior.</span></CodeLine>
<Link id="l07487" /><CodeLine lineNumber="7487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In addition, we may sink instructions that produce %c or %d from</span></CodeLine>
<Link id="l07488" /><CodeLine lineNumber="7488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the entry block into the destination(s) of the new branch.</span></CodeLine>
<Link id="l07489" /><CodeLine lineNumber="7489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the true or false blocks do not contain a sunken instruction, that</span></CodeLine>
<Link id="l07490" /><CodeLine lineNumber="7490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block and its branch may be optimized away. In that case, one side of the</span></CodeLine>
<Link id="l07491" /><CodeLine lineNumber="7491"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// first branch will point directly to select.end, and the corresponding PHI</span></CodeLine>
<Link id="l07492" /><CodeLine lineNumber="7492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor block will be the start block.</span></CodeLine>
<Link id="l07493" /><CodeLine lineNumber="7493"></CodeLine>
<Link id="l07494" /><CodeLine lineNumber="7494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect values that go on the true side and the values that go on the false</span></CodeLine>
<Link id="l07495" /><CodeLine lineNumber="7495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// side.</span></CodeLine>
<Link id="l07496" /><CodeLine lineNumber="7496"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;&gt; TrueInstrs, FalseInstrs;</span></CodeLine>
<Link id="l07497" /><CodeLine lineNumber="7497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (SelectInst &#42;SI : ASI) &#123;</span></CodeLine>
<Link id="l07498" /><CodeLine lineNumber="7498"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getTrueValue(); <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(TTI, V))</span></CodeLine>
<Link id="l07499" /><CodeLine lineNumber="7499"><span class="doxyHighlight">      TrueInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V));</span></CodeLine>
<Link id="l07500" /><CodeLine lineNumber="7500"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getFalseValue(); <a href="#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(TTI, V))</span></CodeLine>
<Link id="l07501" /><CodeLine lineNumber="7501"><span class="doxyHighlight">      FalseInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V));</span></CodeLine>
<Link id="l07502" /><CodeLine lineNumber="7502"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07503" /><CodeLine lineNumber="7503"></CodeLine>
<Link id="l07504" /><CodeLine lineNumber="7504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Split the select block, according to how many (if any) values go on each</span></CodeLine>
<Link id="l07505" /><CodeLine lineNumber="7505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// side.</span></CodeLine>
<Link id="l07506" /><CodeLine lineNumber="7506"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;StartBlock = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l07507" /><CodeLine lineNumber="7507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SplitPt = std::next(<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(LastSI));</span></CodeLine>
<Link id="l07508" /><CodeLine lineNumber="7508"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We should split before any debug-info.</span></CodeLine>
<Link id="l07509" /><CodeLine lineNumber="7509"><span class="doxyHighlight">  SplitPt.setHeadBit(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07510" /><CodeLine lineNumber="7510"></CodeLine>
<Link id="l07511" /><CodeLine lineNumber="7511"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">IB</a>(SI);</span></CodeLine>
<Link id="l07512" /><CodeLine lineNumber="7512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondFr = <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">IB</a>.CreateFreeze(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition(), <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.frozen&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07513" /><CodeLine lineNumber="7513"></CodeLine>
<Link id="l07514" /><CodeLine lineNumber="7514"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TrueBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07515" /><CodeLine lineNumber="7515"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FalseBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07516" /><CodeLine lineNumber="7516"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EndBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07517" /><CodeLine lineNumber="7517"><span class="doxyHighlight">  BranchInst &#42;TrueBranch = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07518" /><CodeLine lineNumber="7518"><span class="doxyHighlight">  BranchInst &#42;FalseBranch = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07519" /><CodeLine lineNumber="7519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0) &#123;</span></CodeLine>
<Link id="l07520" /><CodeLine lineNumber="7520"><span class="doxyHighlight">    FalseBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#a35593f403e6311f92924141d2fdca50c">SplitBlockAndInsertIfElse</a>(</span></CodeLine>
<Link id="l07521" /><CodeLine lineNumber="7521"><span class="doxyHighlight">        CondFr, SplitPt, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, LI));</span></CodeLine>
<Link id="l07522" /><CodeLine lineNumber="7522"><span class="doxyHighlight">    FalseBlock = FalseBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07523" /><CodeLine lineNumber="7523"><span class="doxyHighlight">    EndBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(FalseBranch-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l07524" /><CodeLine lineNumber="7524"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FalseInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0) &#123;</span></CodeLine>
<Link id="l07525" /><CodeLine lineNumber="7525"><span class="doxyHighlight">    TrueBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ad957413955739c91204c96e33e0cc933">SplitBlockAndInsertIfThen</a>(</span></CodeLine>
<Link id="l07526" /><CodeLine lineNumber="7526"><span class="doxyHighlight">        CondFr, SplitPt, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, LI));</span></CodeLine>
<Link id="l07527" /><CodeLine lineNumber="7527"><span class="doxyHighlight">    TrueBlock = TrueBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07528" /><CodeLine lineNumber="7528"><span class="doxyHighlight">    EndBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(TrueBranch-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l07529" /><CodeLine lineNumber="7529"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07530" /><CodeLine lineNumber="7530"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ThenTerm = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07531" /><CodeLine lineNumber="7531"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ElseTerm = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07532" /><CodeLine lineNumber="7532"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7ac00229d8c59902686f52ed061cdc80">SplitBlockAndInsertIfThenElse</a>(CondFr, SplitPt, &amp;ThenTerm, &amp;ElseTerm,</span></CodeLine>
<Link id="l07533" /><CodeLine lineNumber="7533"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, LI);</span></CodeLine>
<Link id="l07534" /><CodeLine lineNumber="7534"><span class="doxyHighlight">    TrueBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ThenTerm);</span></CodeLine>
<Link id="l07535" /><CodeLine lineNumber="7535"><span class="doxyHighlight">    FalseBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ElseTerm);</span></CodeLine>
<Link id="l07536" /><CodeLine lineNumber="7536"><span class="doxyHighlight">    TrueBlock = TrueBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07537" /><CodeLine lineNumber="7537"><span class="doxyHighlight">    FalseBlock = FalseBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07538" /><CodeLine lineNumber="7538"><span class="doxyHighlight">    EndBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(TrueBranch-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l07539" /><CodeLine lineNumber="7539"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07540" /><CodeLine lineNumber="7540"></CodeLine>
<Link id="l07541" /><CodeLine lineNumber="7541"><span class="doxyHighlight">  EndBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;select.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07542" /><CodeLine lineNumber="7542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueBlock)</span></CodeLine>
<Link id="l07543" /><CodeLine lineNumber="7543"><span class="doxyHighlight">    TrueBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;select.true.sink&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07544" /><CodeLine lineNumber="7544"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FalseBlock)</span></CodeLine>
<Link id="l07545" /><CodeLine lineNumber="7545"><span class="doxyHighlight">    FalseBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(FalseInstrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0 ? </span><span class="doxyHighlightStringLiteral">&quot;select.false&quot;</span></CodeLine>
<Link id="l07546" /><CodeLine lineNumber="7546"><span class="doxyHighlight">                                                : </span><span class="doxyHighlightStringLiteral">&quot;select.false.sink&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07547" /><CodeLine lineNumber="7547"></CodeLine>
<Link id="l07548" /><CodeLine lineNumber="7548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>) &#123;</span></CodeLine>
<Link id="l07549" /><CodeLine lineNumber="7549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueBlock)</span></CodeLine>
<Link id="l07550" /><CodeLine lineNumber="7550"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(TrueBlock);</span></CodeLine>
<Link id="l07551" /><CodeLine lineNumber="7551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FalseBlock)</span></CodeLine>
<Link id="l07552" /><CodeLine lineNumber="7552"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(FalseBlock);</span></CodeLine>
<Link id="l07553" /><CodeLine lineNumber="7553"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(EndBlock);</span></CodeLine>
<Link id="l07554" /><CodeLine lineNumber="7554"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07555" /><CodeLine lineNumber="7555"></CodeLine>
<Link id="l07556" /><CodeLine lineNumber="7556"><span class="doxyHighlight">  BFI-&gt;setBlockFreq(EndBlock, BFI-&gt;getBlockFreq(StartBlock));</span></CodeLine>
<Link id="l07557" /><CodeLine lineNumber="7557"></CodeLine>
<Link id="l07558" /><CodeLine lineNumber="7558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MD&#91;&#93; = &#123;</span></CodeLine>
<Link id="l07559" /><CodeLine lineNumber="7559"><span class="doxyHighlight">      LLVMContext::MD&#95;prof, LLVMContext::MD&#95;unpredictable,</span></CodeLine>
<Link id="l07560" /><CodeLine lineNumber="7560"><span class="doxyHighlight">      LLVMContext::MD&#95;make&#95;implicit, LLVMContext::MD&#95;dbg&#125;;</span></CodeLine>
<Link id="l07561" /><CodeLine lineNumber="7561"><span class="doxyHighlight">  StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;SI, MD);</span></CodeLine>
<Link id="l07562" /><CodeLine lineNumber="7562"></CodeLine>
<Link id="l07563" /><CodeLine lineNumber="7563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sink expensive instructions into the conditional blocks to avoid executing</span></CodeLine>
<Link id="l07564" /><CodeLine lineNumber="7564"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them speculatively.</span></CodeLine>
<Link id="l07565" /><CodeLine lineNumber="7565"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : TrueInstrs)</span></CodeLine>
<Link id="l07566" /><CodeLine lineNumber="7566"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(TrueBranch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l07567" /><CodeLine lineNumber="7567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : FalseInstrs)</span></CodeLine>
<Link id="l07568" /><CodeLine lineNumber="7568"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(FalseBranch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l07569" /><CodeLine lineNumber="7569"></CodeLine>
<Link id="l07570" /><CodeLine lineNumber="7570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we did not create a new block for one of the &#39;true&#39; or &#39;false&#39; paths</span></CodeLine>
<Link id="l07571" /><CodeLine lineNumber="7571"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the condition, it means that side of the branch goes to the end block</span></CodeLine>
<Link id="l07572" /><CodeLine lineNumber="7572"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// directly and the path originates from the start block from the point of</span></CodeLine>
<Link id="l07573" /><CodeLine lineNumber="7573"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// view of the new PHI.</span></CodeLine>
<Link id="l07574" /><CodeLine lineNumber="7574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueBlock == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l07575" /><CodeLine lineNumber="7575"><span class="doxyHighlight">    TrueBlock = StartBlock;</span></CodeLine>
<Link id="l07576" /><CodeLine lineNumber="7576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FalseBlock == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l07577" /><CodeLine lineNumber="7577"><span class="doxyHighlight">    FalseBlock = StartBlock;</span></CodeLine>
<Link id="l07578" /><CodeLine lineNumber="7578"></CodeLine>
<Link id="l07579" /><CodeLine lineNumber="7579"><span class="doxyHighlight">  SmallPtrSet&lt;const Instruction &#42;, 2&gt; INS;</span></CodeLine>
<Link id="l07580" /><CodeLine lineNumber="7580"><span class="doxyHighlight">  INS.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ASI.begin(), ASI.end());</span></CodeLine>
<Link id="l07581" /><CodeLine lineNumber="7581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use reverse iterator because later select may use the value of the</span></CodeLine>
<Link id="l07582" /><CodeLine lineNumber="7582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// earlier select, and we need to propagate value through earlier select</span></CodeLine>
<Link id="l07583" /><CodeLine lineNumber="7583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to get the PHI operand.</span></CodeLine>
<Link id="l07584" /><CodeLine lineNumber="7584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (SelectInst &#42;SI : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(ASI)) &#123;</span></CodeLine>
<Link id="l07585" /><CodeLine lineNumber="7585"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The select itself is replaced with a PHI Node.</span></CodeLine>
<Link id="l07586" /><CodeLine lineNumber="7586"><span class="doxyHighlight">    PHINode &#42;PN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getType(), 2, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07587" /><CodeLine lineNumber="7587"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(EndBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l07588" /><CodeLine lineNumber="7588"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(SI);</span></CodeLine>
<Link id="l07589" /><CodeLine lineNumber="7589"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a>(SI, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, INS), TrueBlock);</span></CodeLine>
<Link id="l07590" /><CodeLine lineNumber="7590"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="#a596c5a8a807f6ce192718084a11648de">getTrueOrFalseValue</a>(SI, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, INS), FalseBlock);</span></CodeLine>
<Link id="l07591" /><CodeLine lineNumber="7591"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l07592" /><CodeLine lineNumber="7592"></CodeLine>
<Link id="l07593" /><CodeLine lineNumber="7593"><span class="doxyHighlight">    <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(SI, PN, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l07594" /><CodeLine lineNumber="7594"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l07595" /><CodeLine lineNumber="7595"><span class="doxyHighlight">    INS.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(SI);</span></CodeLine>
<Link id="l07596" /><CodeLine lineNumber="7596"><span class="doxyHighlight">    ++NumSelectsExpanded;</span></CodeLine>
<Link id="l07597" /><CodeLine lineNumber="7597"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07598" /><CodeLine lineNumber="7598"></CodeLine>
<Link id="l07599" /><CodeLine lineNumber="7599"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Instruct OptimizeBlock to skip to the next block.</span></CodeLine>
<Link id="l07600" /><CodeLine lineNumber="7600"><span class="doxyHighlight">  CurInstIterator = StartBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</span></CodeLine>
<Link id="l07601" /><CodeLine lineNumber="7601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07602" /><CodeLine lineNumber="7602"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07603" /><CodeLine lineNumber="7603"></CodeLine>
<Link id="l07604" /><CodeLine lineNumber="7604"><span class="doxyHighlightComment">/// Some targets only accept certain types for splat inputs. For example a VDUP</span></CodeLine>
<Link id="l07605" /><CodeLine lineNumber="7605"><span class="doxyHighlightComment">/// in MVE takes a GPR (integer) register, and the instruction that incorporate</span></CodeLine>
<Link id="l07606" /><CodeLine lineNumber="7606"><span class="doxyHighlightComment">/// a VDUP (such as a VADD qd, qm, rm) also require a gpr register.</span></CodeLine>
<Link id="l07607" /><CodeLine lineNumber="7607"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeShuffleVectorInst(ShuffleVectorInst &#42;SVI) &#123;</span></CodeLine>
<Link id="l07608" /><CodeLine lineNumber="7608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Accept shuf(insertelem(undef/poison, val, 0), undef/poison, &lt;0,0,..&gt;) only</span></CodeLine>
<Link id="l07609" /><CodeLine lineNumber="7609"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>()),</span></CodeLine>
<Link id="l07610" /><CodeLine lineNumber="7610"><span class="doxyHighlight">                            <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>(), m&#95;ZeroMask())))</span></CodeLine>
<Link id="l07611" /><CodeLine lineNumber="7611"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07612" /><CodeLine lineNumber="7612"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;NewType = TLI-&gt;shouldConvertSplatType(SVI);</span></CodeLine>
<Link id="l07613" /><CodeLine lineNumber="7613"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewType)</span></CodeLine>
<Link id="l07614" /><CodeLine lineNumber="7614"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07615" /><CodeLine lineNumber="7615"></CodeLine>
<Link id="l07616" /><CodeLine lineNumber="7616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SVIVecType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SVI-&gt;<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</span></CodeLine>
<Link id="l07617" /><CodeLine lineNumber="7617"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!NewType-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a scalar type!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07618" /><CodeLine lineNumber="7618"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == SVIVecType-&gt;getScalarSizeInBits() &amp;&amp;</span></CodeLine>
<Link id="l07619" /><CodeLine lineNumber="7619"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected a type of the same size!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07620" /><CodeLine lineNumber="7620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewVecType =</span></CodeLine>
<Link id="l07621" /><CodeLine lineNumber="7621"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(NewType, SVIVecType-&gt;getNumElements());</span></CodeLine>
<Link id="l07622" /><CodeLine lineNumber="7622"></CodeLine>
<Link id="l07623" /><CodeLine lineNumber="7623"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a bitcast (shuffle (insert (bitcast(..))))</span></CodeLine>
<Link id="l07624" /><CodeLine lineNumber="7624"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(SVI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l07625" /><CodeLine lineNumber="7625"><span class="doxyHighlight">  Builder.SetInsertPoint(SVI);</span></CodeLine>
<Link id="l07626" /><CodeLine lineNumber="7626"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BC1 = Builder.CreateBitCast(</span></CodeLine>
<Link id="l07627" /><CodeLine lineNumber="7627"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(SVI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))-&gt;getOperand(1), NewType);</span></CodeLine>
<Link id="l07628" /><CodeLine lineNumber="7628"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Shuffle = Builder.CreateVectorSplat(NewVecType-&gt;getNumElements(), BC1);</span></CodeLine>
<Link id="l07629" /><CodeLine lineNumber="7629"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BC2 = Builder.CreateBitCast(Shuffle, SVIVecType);</span></CodeLine>
<Link id="l07630" /><CodeLine lineNumber="7630"></CodeLine>
<Link id="l07631" /><CodeLine lineNumber="7631"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(SVI, BC2, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l07632" /><CodeLine lineNumber="7632"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</span></CodeLine>
<Link id="l07633" /><CodeLine lineNumber="7633"><span class="doxyHighlight">      SVI, TLInfo, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07634" /><CodeLine lineNumber="7634"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</span></CodeLine>
<Link id="l07635" /><CodeLine lineNumber="7635"></CodeLine>
<Link id="l07636" /><CodeLine lineNumber="7636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Also hoist the bitcast up to its operand if it they are not in the same</span></CodeLine>
<Link id="l07637" /><CodeLine lineNumber="7637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l07638" /><CodeLine lineNumber="7638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BC1))</span></CodeLine>
<Link id="l07639" /><CodeLine lineNumber="7639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BCI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l07640" /><CodeLine lineNumber="7640"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BCI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getParent() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &amp;&amp;</span></CodeLine>
<Link id="l07641" /><CodeLine lineNumber="7641"><span class="doxyHighlight">          !<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isTerminator() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isEHPad())</span></CodeLine>
<Link id="l07642" /><CodeLine lineNumber="7642"><span class="doxyHighlight">        BCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a54507f01d7d06127068ee0663233511d">moveAfter</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l07643" /><CodeLine lineNumber="7643"></CodeLine>
<Link id="l07644" /><CodeLine lineNumber="7644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07645" /><CodeLine lineNumber="7645"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07646" /><CodeLine lineNumber="7646"></CodeLine>
<Link id="l07647" /><CodeLine lineNumber="7647"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::tryToSinkFreeOperands(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07648" /><CodeLine lineNumber="7648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the operands of I can be folded into a target instruction together with</span></CodeLine>
<Link id="l07649" /><CodeLine lineNumber="7649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// I, duplicate and sink them.</span></CodeLine>
<Link id="l07650" /><CodeLine lineNumber="7650"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Use &#42;, 4&gt;</a> OpsToSink;</span></CodeLine>
<Link id="l07651" /><CodeLine lineNumber="7651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TTI-&gt;isProfitableToSinkOperands(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OpsToSink))</span></CodeLine>
<Link id="l07652" /><CodeLine lineNumber="7652"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07653" /><CodeLine lineNumber="7653"></CodeLine>
<Link id="l07654" /><CodeLine lineNumber="7654"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OpsToSink can contain multiple uses in a use chain (e.g.</span></CodeLine>
<Link id="l07655" /><CodeLine lineNumber="7655"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (%u1 with %u1 = shufflevector), (%u2 with %u2 = zext %u1)). The dominating</span></CodeLine>
<Link id="l07656" /><CodeLine lineNumber="7656"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// uses must come first, so we process the ops in reverse order so as to not</span></CodeLine>
<Link id="l07657" /><CodeLine lineNumber="7657"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// create invalid IR.</span></CodeLine>
<Link id="l07658" /><CodeLine lineNumber="7658"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TargetBB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l07659" /><CodeLine lineNumber="7659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07660" /><CodeLine lineNumber="7660"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Use &#42;, 4&gt;</a> ToReplace;</span></CodeLine>
<Link id="l07661" /><CodeLine lineNumber="7661"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;InsertPoint = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l07662" /><CodeLine lineNumber="7662"><span class="doxyHighlight">  DenseMap&lt;const Instruction &#42;, unsigned long&gt; InstOrdering;</span></CodeLine>
<Link id="l07663" /><CodeLine lineNumber="7663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight"> InstNumber = 0;</span></CodeLine>
<Link id="l07664" /><CodeLine lineNumber="7664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;TargetBB)</span></CodeLine>
<Link id="l07665" /><CodeLine lineNumber="7665"><span class="doxyHighlight">    InstOrdering&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = InstNumber++;</span></CodeLine>
<Link id="l07666" /><CodeLine lineNumber="7666"></CodeLine>
<Link id="l07667" /><CodeLine lineNumber="7667"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &#42;U : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(OpsToSink)) &#123;</span></CodeLine>
<Link id="l07668" /><CodeLine lineNumber="7668"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;get());</span></CodeLine>
<Link id="l07669" /><CodeLine lineNumber="7669"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI))</span></CodeLine>
<Link id="l07670" /><CodeLine lineNumber="7670"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07671" /><CodeLine lineNumber="7671"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == TargetBB) &#123;</span></CodeLine>
<Link id="l07672" /><CodeLine lineNumber="7672"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InstOrdering&#91;UI&#93; &lt; InstOrdering&#91;InsertPoint&#93;)</span></CodeLine>
<Link id="l07673" /><CodeLine lineNumber="7673"><span class="doxyHighlight">        InsertPoint = UI;</span></CodeLine>
<Link id="l07674" /><CodeLine lineNumber="7674"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07675" /><CodeLine lineNumber="7675"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07676" /><CodeLine lineNumber="7676"><span class="doxyHighlight">    ToReplace.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(U);</span></CodeLine>
<Link id="l07677" /><CodeLine lineNumber="7677"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07678" /><CodeLine lineNumber="7678"></CodeLine>
<Link id="l07679" /><CodeLine lineNumber="7679"><span class="doxyHighlight">  SetVector&lt;Instruction &#42;&gt; MaybeDead;</span></CodeLine>
<Link id="l07680" /><CodeLine lineNumber="7680"><span class="doxyHighlight">  DenseMap&lt;Instruction &#42;, Instruction &#42;&gt; NewInstructions;</span></CodeLine>
<Link id="l07681" /><CodeLine lineNumber="7681"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &#42;U : ToReplace) &#123;</span></CodeLine>
<Link id="l07682" /><CodeLine lineNumber="7682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;get());</span></CodeLine>
<Link id="l07683" /><CodeLine lineNumber="7683"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;NI = UI-&gt;<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>();</span></CodeLine>
<Link id="l07684" /><CodeLine lineNumber="7684"></CodeLine>
<Link id="l07685" /><CodeLine lineNumber="7685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>) &#123;</span></CodeLine>
<Link id="l07686" /><CodeLine lineNumber="7686"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Now we clone an instruction, its operands&#39; defs may sink to this BB</span></CodeLine>
<Link id="l07687" /><CodeLine lineNumber="7687"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// now. So we put the operands defs&#39; BBs into FreshBBs to do optimization.</span></CodeLine>
<Link id="l07688" /><CodeLine lineNumber="7688"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : NI-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>())</span></CodeLine>
<Link id="l07689" /><CodeLine lineNumber="7689"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpDef = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l07690" /><CodeLine lineNumber="7690"><span class="doxyHighlight">          <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(OpDef-&gt;getParent());</span></CodeLine>
<Link id="l07691" /><CodeLine lineNumber="7691"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07692" /><CodeLine lineNumber="7692"></CodeLine>
<Link id="l07693" /><CodeLine lineNumber="7693"><span class="doxyHighlight">    NewInstructions&#91;UI&#93; = NI;</span></CodeLine>
<Link id="l07694" /><CodeLine lineNumber="7694"><span class="doxyHighlight">    MaybeDead.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(UI);</span></CodeLine>
<Link id="l07695" /><CodeLine lineNumber="7695"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sinking &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;UI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to user &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07696" /><CodeLine lineNumber="7696"><span class="doxyHighlight">    NI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(InsertPoint-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l07697" /><CodeLine lineNumber="7697"><span class="doxyHighlight">    InsertPoint = NI;</span></CodeLine>
<Link id="l07698" /><CodeLine lineNumber="7698"><span class="doxyHighlight">    InsertedInsts.insert(NI);</span></CodeLine>
<Link id="l07699" /><CodeLine lineNumber="7699"></CodeLine>
<Link id="l07700" /><CodeLine lineNumber="7700"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update the use for the new instruction, making sure that we update the</span></CodeLine>
<Link id="l07701" /><CodeLine lineNumber="7701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sunk instruction uses, if it is part of a chain that has already been</span></CodeLine>
<Link id="l07702" /><CodeLine lineNumber="7702"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sunk.</span></CodeLine>
<Link id="l07703" /><CodeLine lineNumber="7703"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;OldI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getUser());</span></CodeLine>
<Link id="l07704" /><CodeLine lineNumber="7704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = NewInstructions.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(OldI); It != NewInstructions.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l07705" /><CodeLine lineNumber="7705"><span class="doxyHighlight">      It-&gt;second-&gt;setOperand(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getOperandNo(), NI);</span></CodeLine>
<Link id="l07706" /><CodeLine lineNumber="7706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07707" /><CodeLine lineNumber="7707"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;set(NI);</span></CodeLine>
<Link id="l07708" /><CodeLine lineNumber="7708"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07709" /><CodeLine lineNumber="7709"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07710" /><CodeLine lineNumber="7710"></CodeLine>
<Link id="l07711" /><CodeLine lineNumber="7711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove instructions that are dead after sinking.</span></CodeLine>
<Link id="l07712" /><CodeLine lineNumber="7712"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : MaybeDead) &#123;</span></CodeLine>
<Link id="l07713" /><CodeLine lineNumber="7713"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasNUsesOrMore(1)) &#123;</span></CodeLine>
<Link id="l07714" /><CodeLine lineNumber="7714"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Removing dead instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07715" /><CodeLine lineNumber="7715"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l07716" /><CodeLine lineNumber="7716"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07717" /><CodeLine lineNumber="7717"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07718" /><CodeLine lineNumber="7718"></CodeLine>
<Link id="l07719" /><CodeLine lineNumber="7719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l07720" /><CodeLine lineNumber="7720"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07721" /><CodeLine lineNumber="7721"></CodeLine>
<Link id="l07722" /><CodeLine lineNumber="7722"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeSwitchType(SwitchInst &#42;SI) &#123;</span></CodeLine>
<Link id="l07723" /><CodeLine lineNumber="7723"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l07724" /><CodeLine lineNumber="7724"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;OldType = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType();</span></CodeLine>
<Link id="l07725" /><CodeLine lineNumber="7725"><span class="doxyHighlight">  LLVMContext &amp;Context = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getContext();</span></CodeLine>
<Link id="l07726" /><CodeLine lineNumber="7726"><span class="doxyHighlight">  EVT OldVT = TLI-&gt;getValueType(&#42;DL, OldType);</span></CodeLine>
<Link id="l07727" /><CodeLine lineNumber="7727"><span class="doxyHighlight">  MVT RegType = TLI-&gt;getPreferredSwitchConditionType(Context, OldVT);</span></CodeLine>
<Link id="l07728" /><CodeLine lineNumber="7728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RegWidth = RegType.<a href="/docs/api/classes/llvm/mvt/#a7be7c6dd92efc0d6f866d4a3b433eed0">getSizeInBits</a>();</span></CodeLine>
<Link id="l07729" /><CodeLine lineNumber="7729"></CodeLine>
<Link id="l07730" /><CodeLine lineNumber="7730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RegWidth &lt;= <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(OldType)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>())</span></CodeLine>
<Link id="l07731" /><CodeLine lineNumber="7731"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07732" /><CodeLine lineNumber="7732"></CodeLine>
<Link id="l07733" /><CodeLine lineNumber="7733"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the register width is greater than the type width, expand the condition</span></CodeLine>
<Link id="l07734" /><CodeLine lineNumber="7734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the switch instruction and each case constant to the width of the</span></CodeLine>
<Link id="l07735" /><CodeLine lineNumber="7735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register. By widening the type of the switch condition, subsequent</span></CodeLine>
<Link id="l07736" /><CodeLine lineNumber="7736"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// comparisons (for case comparisons) will not need to be extended to the</span></CodeLine>
<Link id="l07737" /><CodeLine lineNumber="7737"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preferred register width, so we will potentially eliminate N-1 extends,</span></CodeLine>
<Link id="l07738" /><CodeLine lineNumber="7738"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// where N is the number of cases in the switch.</span></CodeLine>
<Link id="l07739" /><CodeLine lineNumber="7739"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewType = Type::getIntNTy(Context, RegWidth);</span></CodeLine>
<Link id="l07740" /><CodeLine lineNumber="7740"></CodeLine>
<Link id="l07741" /><CodeLine lineNumber="7741"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Extend the switch condition and case constants using the target preferred</span></CodeLine>
<Link id="l07742" /><CodeLine lineNumber="7742"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// extend unless the switch condition is a function argument with an extend</span></CodeLine>
<Link id="l07743" /><CodeLine lineNumber="7743"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// attribute. In that case, we can avoid an unnecessary mask/extension by</span></CodeLine>
<Link id="l07744" /><CodeLine lineNumber="7744"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// matching the argument extension instead.</span></CodeLine>
<Link id="l07745" /><CodeLine lineNumber="7745"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::ZExt;</span></CodeLine>
<Link id="l07746" /><CodeLine lineNumber="7746"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Some targets prefer SExt over ZExt.</span></CodeLine>
<Link id="l07747" /><CodeLine lineNumber="7747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI-&gt;isSExtCheaperThanZExt(OldVT, RegType))</span></CodeLine>
<Link id="l07748" /><CodeLine lineNumber="7748"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::SExt;</span></CodeLine>
<Link id="l07749" /><CodeLine lineNumber="7749"></CodeLine>
<Link id="l07750" /><CodeLine lineNumber="7750"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Arg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</span></CodeLine>
<Link id="l07751" /><CodeLine lineNumber="7751"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg-&gt;hasSExtAttr())</span></CodeLine>
<Link id="l07752" /><CodeLine lineNumber="7752"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::SExt;</span></CodeLine>
<Link id="l07753" /><CodeLine lineNumber="7753"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg-&gt;hasZExtAttr())</span></CodeLine>
<Link id="l07754" /><CodeLine lineNumber="7754"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> = Instruction::ZExt;</span></CodeLine>
<Link id="l07755" /><CodeLine lineNumber="7755"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07756" /><CodeLine lineNumber="7756"></CodeLine>
<Link id="l07757" /><CodeLine lineNumber="7757"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExtInst = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NewType);</span></CodeLine>
<Link id="l07758" /><CodeLine lineNumber="7758"><span class="doxyHighlight">  ExtInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getIterator());</span></CodeLine>
<Link id="l07759" /><CodeLine lineNumber="7759"><span class="doxyHighlight">  ExtInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l07760" /><CodeLine lineNumber="7760"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;setCondition(ExtInst);</span></CodeLine>
<Link id="l07761" /><CodeLine lineNumber="7761"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Case : <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07762" /><CodeLine lineNumber="7762"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> APInt &amp;NarrowConst = Case.getCaseValue()-&gt;getValue();</span></CodeLine>
<Link id="l07763" /><CodeLine lineNumber="7763"><span class="doxyHighlight">    APInt WideConst = (<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#a3c5dbbe247f7b8e61085e6ad1682164f">ExtType</a> == Instruction::ZExt)</span></CodeLine>
<Link id="l07764" /><CodeLine lineNumber="7764"><span class="doxyHighlight">                          ? NarrowConst.<a href="/docs/api/classes/llvm/apint/#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(RegWidth)</span></CodeLine>
<Link id="l07765" /><CodeLine lineNumber="7765"><span class="doxyHighlight">                          : NarrowConst.<a href="/docs/api/classes/llvm/apint/#aca8fce65eb69a82aa10a635e2e79877a">sext</a>(RegWidth);</span></CodeLine>
<Link id="l07766" /><CodeLine lineNumber="7766"><span class="doxyHighlight">    Case.setValue(ConstantInt::get(Context, WideConst));</span></CodeLine>
<Link id="l07767" /><CodeLine lineNumber="7767"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07768" /><CodeLine lineNumber="7768"></CodeLine>
<Link id="l07769" /><CodeLine lineNumber="7769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07770" /><CodeLine lineNumber="7770"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07771" /><CodeLine lineNumber="7771"></CodeLine>
<Link id="l07772" /><CodeLine lineNumber="7772"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeSwitchPhiConstants(SwitchInst &#42;SI) &#123;</span></CodeLine>
<Link id="l07773" /><CodeLine lineNumber="7773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The SCCP optimization tends to produce code like this:</span></CodeLine>
<Link id="l07774" /><CodeLine lineNumber="7774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   switch(x) &#123; case 42: phi(42, ...) &#125;</span></CodeLine>
<Link id="l07775" /><CodeLine lineNumber="7775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Materializing the constant for the phi-argument needs instructions; So we</span></CodeLine>
<Link id="l07776" /><CodeLine lineNumber="7776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// change the code to:</span></CodeLine>
<Link id="l07777" /><CodeLine lineNumber="7777"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   switch(x) &#123; case 42: phi(x, ...) &#125;</span></CodeLine>
<Link id="l07778" /><CodeLine lineNumber="7778"></CodeLine>
<Link id="l07779" /><CodeLine lineNumber="7779"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Condition = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l07780" /><CodeLine lineNumber="7780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid endless loop in degenerate case.</span></CodeLine>
<Link id="l07781" /><CodeLine lineNumber="7781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(&#42;Condition))</span></CodeLine>
<Link id="l07782" /><CodeLine lineNumber="7782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07783" /><CodeLine lineNumber="7783"></CodeLine>
<Link id="l07784" /><CodeLine lineNumber="7784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07785" /><CodeLine lineNumber="7785"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;SwitchBB = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l07786" /><CodeLine lineNumber="7786"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ConditionType = Condition-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l07787" /><CodeLine lineNumber="7787"></CodeLine>
<Link id="l07788" /><CodeLine lineNumber="7788"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SwitchInst::CaseHandle &amp;Case : <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07789" /><CodeLine lineNumber="7789"><span class="doxyHighlight">    ConstantInt &#42;CaseValue = Case.getCaseValue();</span></CodeLine>
<Link id="l07790" /><CodeLine lineNumber="7790"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CaseBB = Case.getCaseSuccessor();</span></CodeLine>
<Link id="l07791" /><CodeLine lineNumber="7791"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set to true if we previously checked that &#96;CaseBB&#96; is only reached by</span></CodeLine>
<Link id="l07792" /><CodeLine lineNumber="7792"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a single case from this switch.</span></CodeLine>
<Link id="l07793" /><CodeLine lineNumber="7793"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CheckedForSinglePred = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07794" /><CodeLine lineNumber="7794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : CaseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l07795" /><CodeLine lineNumber="7795"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PHIType = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getType();</span></CodeLine>
<Link id="l07796" /><CodeLine lineNumber="7796"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If ZExt is free then we can also catch patterns like this:</span></CodeLine>
<Link id="l07797" /><CodeLine lineNumber="7797"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   switch((i32)x) &#123; case 42: phi((i64)42, ...); &#125;</span></CodeLine>
<Link id="l07798" /><CodeLine lineNumber="7798"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and replace &#96;(i64)42&#96; with &#96;zext i32 %x to i64&#96;.</span></CodeLine>
<Link id="l07799" /><CodeLine lineNumber="7799"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TryZExt =</span></CodeLine>
<Link id="l07800" /><CodeLine lineNumber="7800"><span class="doxyHighlight">          PHIType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l07801" /><CodeLine lineNumber="7801"><span class="doxyHighlight">          PHIType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt; ConditionType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &amp;&amp;</span></CodeLine>
<Link id="l07802" /><CodeLine lineNumber="7802"><span class="doxyHighlight">          TLI-&gt;isZExtFree(ConditionType, PHIType);</span></CodeLine>
<Link id="l07803" /><CodeLine lineNumber="7803"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIType == ConditionType || TryZExt) &#123;</span></CodeLine>
<Link id="l07804" /><CodeLine lineNumber="7804"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Set to true to skip this case because of multiple preds.</span></CodeLine>
<Link id="l07805" /><CodeLine lineNumber="7805"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipCase = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07806" /><CodeLine lineNumber="7806"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Replacement = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07807" /><CodeLine lineNumber="7807"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</span></CodeLine>
<Link id="l07808" /><CodeLine lineNumber="7808"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PHIValue = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07809" /><CodeLine lineNumber="7809"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIValue != CaseValue) &#123;</span></CodeLine>
<Link id="l07810" /><CodeLine lineNumber="7810"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TryZExt)</span></CodeLine>
<Link id="l07811" /><CodeLine lineNumber="7811"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07812" /><CodeLine lineNumber="7812"><span class="doxyHighlight">            ConstantInt &#42;PHIValueInt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(PHIValue);</span></CodeLine>
<Link id="l07813" /><CodeLine lineNumber="7813"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PHIValueInt ||</span></CodeLine>
<Link id="l07814" /><CodeLine lineNumber="7814"><span class="doxyHighlight">                PHIValueInt-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() !=</span></CodeLine>
<Link id="l07815" /><CodeLine lineNumber="7815"><span class="doxyHighlight">                    CaseValue-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(PHIType-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()))</span></CodeLine>
<Link id="l07816" /><CodeLine lineNumber="7816"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07817" /><CodeLine lineNumber="7817"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l07818" /><CodeLine lineNumber="7818"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != SwitchBB)</span></CodeLine>
<Link id="l07819" /><CodeLine lineNumber="7819"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07820" /><CodeLine lineNumber="7820"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// We cannot optimize if there are multiple case labels jumping to</span></CodeLine>
<Link id="l07821" /><CodeLine lineNumber="7821"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// this block.  This check may get expensive when there are many</span></CodeLine>
<Link id="l07822" /><CodeLine lineNumber="7822"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// case labels so we test for it last.</span></CodeLine>
<Link id="l07823" /><CodeLine lineNumber="7823"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CheckedForSinglePred) &#123;</span></CodeLine>
<Link id="l07824" /><CodeLine lineNumber="7824"><span class="doxyHighlight">            CheckedForSinglePred = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07825" /><CodeLine lineNumber="7825"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;findCaseDest(CaseBB) == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l07826" /><CodeLine lineNumber="7826"><span class="doxyHighlight">              SkipCase = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07827" /><CodeLine lineNumber="7827"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07828" /><CodeLine lineNumber="7828"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l07829" /><CodeLine lineNumber="7829"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l07830" /><CodeLine lineNumber="7830"></CodeLine>
<Link id="l07831" /><CodeLine lineNumber="7831"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Replacement == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l07832" /><CodeLine lineNumber="7832"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIValue == CaseValue) &#123;</span></CodeLine>
<Link id="l07833" /><CodeLine lineNumber="7833"><span class="doxyHighlight">              Replacement = Condition;</span></CodeLine>
<Link id="l07834" /><CodeLine lineNumber="7834"><span class="doxyHighlight">            &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07835" /><CodeLine lineNumber="7835"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a> Builder(SI);</span></CodeLine>
<Link id="l07836" /><CodeLine lineNumber="7836"><span class="doxyHighlight">              Replacement = Builder.CreateZExt(Condition, PHIType);</span></CodeLine>
<Link id="l07837" /><CodeLine lineNumber="7837"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l07838" /><CodeLine lineNumber="7838"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l07839" /><CodeLine lineNumber="7839"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.setIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Replacement);</span></CodeLine>
<Link id="l07840" /><CodeLine lineNumber="7840"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07841" /><CodeLine lineNumber="7841"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l07842" /><CodeLine lineNumber="7842"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SkipCase)</span></CodeLine>
<Link id="l07843" /><CodeLine lineNumber="7843"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07844" /><CodeLine lineNumber="7844"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07845" /><CodeLine lineNumber="7845"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07846" /><CodeLine lineNumber="7846"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07847" /><CodeLine lineNumber="7847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l07848" /><CodeLine lineNumber="7848"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07849" /><CodeLine lineNumber="7849"></CodeLine>
<Link id="l07850" /><CodeLine lineNumber="7850"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeSwitchInst(SwitchInst &#42;SI) &#123;</span></CodeLine>
<Link id="l07851" /><CodeLine lineNumber="7851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = optimizeSwitchType(SI);</span></CodeLine>
<Link id="l07852" /><CodeLine lineNumber="7852"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= optimizeSwitchPhiConstants(SI);</span></CodeLine>
<Link id="l07853" /><CodeLine lineNumber="7853"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l07854" /><CodeLine lineNumber="7854"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07855" /><CodeLine lineNumber="7855"></CodeLine>
<Link id="l07856" /><CodeLine lineNumber="7856"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07857" /><CodeLine lineNumber="7857"></CodeLine>
<Link id="l07858" /><CodeLine lineNumber="7858"><span class="doxyHighlightComment">/// Helper class to promote a scalar operation to a vector one.</span></CodeLine>
<Link id="l07859" /><CodeLine lineNumber="7859"><span class="doxyHighlightComment">/// This class is used to move downward extractelement transition.</span></CodeLine>
<Link id="l07860" /><CodeLine lineNumber="7860"><span class="doxyHighlightComment">/// E.g.,</span></CodeLine>
<Link id="l07861" /><CodeLine lineNumber="7861"><span class="doxyHighlightComment">/// a = vector&#95;op &lt;2 x i32&gt;</span></CodeLine>
<Link id="l07862" /><CodeLine lineNumber="7862"><span class="doxyHighlightComment">/// b = extractelement &lt;2 x i32&gt; a, i32 0</span></CodeLine>
<Link id="l07863" /><CodeLine lineNumber="7863"><span class="doxyHighlightComment">/// c = scalar&#95;op b</span></CodeLine>
<Link id="l07864" /><CodeLine lineNumber="7864"><span class="doxyHighlightComment">/// store c</span></CodeLine>
<Link id="l07865" /><CodeLine lineNumber="7865"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l07866" /><CodeLine lineNumber="7866"><span class="doxyHighlightComment">/// =&gt;</span></CodeLine>
<Link id="l07867" /><CodeLine lineNumber="7867"><span class="doxyHighlightComment">/// a = vector&#95;op &lt;2 x i32&gt;</span></CodeLine>
<Link id="l07868" /><CodeLine lineNumber="7868"><span class="doxyHighlightComment">/// c = vector&#95;op a (equivalent to scalar&#95;op on the related lane)</span></CodeLine>
<Link id="l07869" /><CodeLine lineNumber="7869"><span class="doxyHighlightComment">/// &#42; d = extractelement &lt;2 x i32&gt; c, i32 0</span></CodeLine>
<Link id="l07870" /><CodeLine lineNumber="7870"><span class="doxyHighlightComment">/// &#42; store d</span></CodeLine>
<Link id="l07871" /><CodeLine lineNumber="7871"><span class="doxyHighlightComment">/// Assuming both extractelement and store can be combine, we get rid of the</span></CodeLine>
<Link id="l07872" /><CodeLine lineNumber="7872"><span class="doxyHighlightComment">/// transition.</span></CodeLine>
<Link id="l07873" /><CodeLine lineNumber="7873" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a07696175d8a3e65a0c79186f2ec8a58a">VectorPromoteHelper</a> &#123;</span></CodeLine>
<Link id="l07874" /><CodeLine lineNumber="7874"><span class="doxyHighlightComment">  /// DataLayout associated with the current module.</span></CodeLine>
<Link id="l07875" /><CodeLine lineNumber="7875"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</span></CodeLine>
<Link id="l07876" /><CodeLine lineNumber="7876"></CodeLine>
<Link id="l07877" /><CodeLine lineNumber="7877"><span class="doxyHighlightComment">  /// Used to perform some checks on the legality of vector operations.</span></CodeLine>
<Link id="l07878" /><CodeLine lineNumber="7878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI;</span></CodeLine>
<Link id="l07879" /><CodeLine lineNumber="7879"></CodeLine>
<Link id="l07880" /><CodeLine lineNumber="7880"><span class="doxyHighlightComment">  /// Used to estimated the cost of the promoted chain.</span></CodeLine>
<Link id="l07881" /><CodeLine lineNumber="7881"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI;</span></CodeLine>
<Link id="l07882" /><CodeLine lineNumber="7882"></CodeLine>
<Link id="l07883" /><CodeLine lineNumber="7883"><span class="doxyHighlightComment">  /// The transition being moved downwards.</span></CodeLine>
<Link id="l07884" /><CodeLine lineNumber="7884"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Transition;</span></CodeLine>
<Link id="l07885" /><CodeLine lineNumber="7885"></CodeLine>
<Link id="l07886" /><CodeLine lineNumber="7886"><span class="doxyHighlightComment">  /// The sequence of instructions to be promoted.</span></CodeLine>
<Link id="l07887" /><CodeLine lineNumber="7887"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> InstsToBePromoted;</span></CodeLine>
<Link id="l07888" /><CodeLine lineNumber="7888"></CodeLine>
<Link id="l07889" /><CodeLine lineNumber="7889"><span class="doxyHighlightComment">  /// Cost of combining a store and an extract.</span></CodeLine>
<Link id="l07890" /><CodeLine lineNumber="7890"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StoreExtractCombineCost;</span></CodeLine>
<Link id="l07891" /><CodeLine lineNumber="7891"></CodeLine>
<Link id="l07892" /><CodeLine lineNumber="7892"><span class="doxyHighlightComment">  /// Instruction that will be combined with the transition.</span></CodeLine>
<Link id="l07893" /><CodeLine lineNumber="7893"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CombineInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07894" /><CodeLine lineNumber="7894"></CodeLine>
<Link id="l07895" /><CodeLine lineNumber="7895"><span class="doxyHighlightComment">  /// The instruction that represents the current end of the transition.</span></CodeLine>
<Link id="l07896" /><CodeLine lineNumber="7896"><span class="doxyHighlightComment">  /// Since we are faking the promotion until we reach the end of the chain</span></CodeLine>
<Link id="l07897" /><CodeLine lineNumber="7897"><span class="doxyHighlightComment">  /// of computation, we need a way to get the current end of the transition.</span></CodeLine>
<Link id="l07898" /><CodeLine lineNumber="7898"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;getEndOfTransition()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07899" /><CodeLine lineNumber="7899"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InstsToBePromoted.empty())</span></CodeLine>
<Link id="l07900" /><CodeLine lineNumber="7900"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Transition;</span></CodeLine>
<Link id="l07901" /><CodeLine lineNumber="7901"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> InstsToBePromoted.back();</span></CodeLine>
<Link id="l07902" /><CodeLine lineNumber="7902"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07903" /><CodeLine lineNumber="7903"></CodeLine>
<Link id="l07904" /><CodeLine lineNumber="7904"><span class="doxyHighlightComment">  /// Return the index of the original value in the transition.</span></CodeLine>
<Link id="l07905" /><CodeLine lineNumber="7905"><span class="doxyHighlightComment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 1&quot; the original value,</span></CodeLine>
<Link id="l07906" /><CodeLine lineNumber="7906"><span class="doxyHighlightComment">  /// c, is at index 0</span></CodeLine>
<Link id="l07907" /><CodeLine lineNumber="7907"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> getTransitionOriginalValueIdx()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07908" /><CodeLine lineNumber="7908"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(Transition) &amp;&amp;</span></CodeLine>
<Link id="l07909" /><CodeLine lineNumber="7909"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Other kind of transitions are not supported yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07910" /><CodeLine lineNumber="7910"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l07911" /><CodeLine lineNumber="7911"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07912" /><CodeLine lineNumber="7912"></CodeLine>
<Link id="l07913" /><CodeLine lineNumber="7913"><span class="doxyHighlightComment">  /// Return the index of the index in the transition.</span></CodeLine>
<Link id="l07914" /><CodeLine lineNumber="7914"><span class="doxyHighlightComment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 0&quot; the index</span></CodeLine>
<Link id="l07915" /><CodeLine lineNumber="7915"><span class="doxyHighlightComment">  /// is at index 1</span></CodeLine>
<Link id="l07916" /><CodeLine lineNumber="7916"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> getTransitionIdx()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07917" /><CodeLine lineNumber="7917"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(Transition) &amp;&amp;</span></CodeLine>
<Link id="l07918" /><CodeLine lineNumber="7918"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Other kind of transitions are not supported yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07919" /><CodeLine lineNumber="7919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l07920" /><CodeLine lineNumber="7920"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07921" /><CodeLine lineNumber="7921"></CodeLine>
<Link id="l07922" /><CodeLine lineNumber="7922"><span class="doxyHighlightComment">  /// Get the type of the transition.</span></CodeLine>
<Link id="l07923" /><CodeLine lineNumber="7923"><span class="doxyHighlightComment">  /// This is the type of the original value.</span></CodeLine>
<Link id="l07924" /><CodeLine lineNumber="7924"><span class="doxyHighlightComment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 1&quot; the type of the</span></CodeLine>
<Link id="l07925" /><CodeLine lineNumber="7925"><span class="doxyHighlightComment">  /// transition is &lt;2 x i32&gt;.</span></CodeLine>
<Link id="l07926" /><CodeLine lineNumber="7926"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;getTransitionType()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07927" /><CodeLine lineNumber="7927"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Transition-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(getTransitionOriginalValueIdx())-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l07928" /><CodeLine lineNumber="7928"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07929" /><CodeLine lineNumber="7929"></CodeLine>
<Link id="l07930" /><CodeLine lineNumber="7930"><span class="doxyHighlightComment">  /// Promote \\p ToBePromoted by moving \\p Def downward through.</span></CodeLine>
<Link id="l07931" /><CodeLine lineNumber="7931"><span class="doxyHighlightComment">  /// I.e., we have the following sequence:</span></CodeLine>
<Link id="l07932" /><CodeLine lineNumber="7932"><span class="doxyHighlightComment">  /// Def = Transition &lt;ty1&gt; a to &lt;ty2&gt;</span></CodeLine>
<Link id="l07933" /><CodeLine lineNumber="7933"><span class="doxyHighlightComment">  /// b = ToBePromoted &lt;ty2&gt; Def, ...</span></CodeLine>
<Link id="l07934" /><CodeLine lineNumber="7934"><span class="doxyHighlightComment">  /// =&gt;</span></CodeLine>
<Link id="l07935" /><CodeLine lineNumber="7935"><span class="doxyHighlightComment">  /// b = ToBePromoted &lt;ty1&gt; a, ...</span></CodeLine>
<Link id="l07936" /><CodeLine lineNumber="7936"><span class="doxyHighlightComment">  /// Def = Transition &lt;ty1&gt; ToBePromoted to &lt;ty2&gt;</span></CodeLine>
<Link id="l07937" /><CodeLine lineNumber="7937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> promoteImpl(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted);</span></CodeLine>
<Link id="l07938" /><CodeLine lineNumber="7938"></CodeLine>
<Link id="l07939" /><CodeLine lineNumber="7939"><span class="doxyHighlightComment">  /// Check whether or not it is profitable to promote all the</span></CodeLine>
<Link id="l07940" /><CodeLine lineNumber="7940"><span class="doxyHighlightComment">  /// instructions enqueued to be promoted.</span></CodeLine>
<Link id="l07941" /><CodeLine lineNumber="7941"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isProfitableToPromote() &#123;</span></CodeLine>
<Link id="l07942" /><CodeLine lineNumber="7942"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValIdx = Transition-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(getTransitionOriginalValueIdx());</span></CodeLine>
<Link id="l07943" /><CodeLine lineNumber="7943"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Index = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(ValIdx)</span></CodeLine>
<Link id="l07944" /><CodeLine lineNumber="7944"><span class="doxyHighlight">                         ? <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(ValIdx)-&gt;getZExtValue()</span></CodeLine>
<Link id="l07945" /><CodeLine lineNumber="7945"><span class="doxyHighlight">                         : -1;</span></CodeLine>
<Link id="l07946" /><CodeLine lineNumber="7946"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;PromotedType = getTransitionType();</span></CodeLine>
<Link id="l07947" /><CodeLine lineNumber="7947"></CodeLine>
<Link id="l07948" /><CodeLine lineNumber="7948"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;ST = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(CombineInst);</span></CodeLine>
<Link id="l07949" /><CodeLine lineNumber="7949"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = ST-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l07950" /><CodeLine lineNumber="7950"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if this store is supported.</span></CodeLine>
<Link id="l07951" /><CodeLine lineNumber="7951"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI.allowsMisalignedMemoryAccesses(</span></CodeLine>
<Link id="l07952" /><CodeLine lineNumber="7952"><span class="doxyHighlight">            TLI.getValueType(DL, ST-&gt;getValueOperand()-&gt;getType()), AS,</span></CodeLine>
<Link id="l07953" /><CodeLine lineNumber="7953"><span class="doxyHighlight">            ST-&gt;getAlign())) &#123;</span></CodeLine>
<Link id="l07954" /><CodeLine lineNumber="7954"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is not supported, there is no way we can combine</span></CodeLine>
<Link id="l07955" /><CodeLine lineNumber="7955"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the extract with the store.</span></CodeLine>
<Link id="l07956" /><CodeLine lineNumber="7956"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07957" /><CodeLine lineNumber="7957"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07958" /><CodeLine lineNumber="7958"></CodeLine>
<Link id="l07959" /><CodeLine lineNumber="7959"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The scalar chain of computation has to pay for the transition</span></CodeLine>
<Link id="l07960" /><CodeLine lineNumber="7960"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalar to vector.</span></CodeLine>
<Link id="l07961" /><CodeLine lineNumber="7961"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The vector chain has to account for the combining cost.</span></CodeLine>
<Link id="l07962" /><CodeLine lineNumber="7962"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a> =</span></CodeLine>
<Link id="l07963" /><CodeLine lineNumber="7963"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TargetTransformInfo::TCK&#95;RecipThroughput</a>;</span></CodeLine>
<Link id="l07964" /><CodeLine lineNumber="7964"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost =</span></CodeLine>
<Link id="l07965" /><CodeLine lineNumber="7965"><span class="doxyHighlight">        TTI.getVectorInstrCost(&#42;Transition, PromotedType, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>, Index);</span></CodeLine>
<Link id="l07966" /><CodeLine lineNumber="7966"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> VectorCost = StoreExtractCombineCost;</span></CodeLine>
<Link id="l07967" /><CodeLine lineNumber="7967"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Inst : InstsToBePromoted) &#123;</span></CodeLine>
<Link id="l07968" /><CodeLine lineNumber="7968"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compute the cost.</span></CodeLine>
<Link id="l07969" /><CodeLine lineNumber="7969"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// By construction, all instructions being promoted are arithmetic ones.</span></CodeLine>
<Link id="l07970" /><CodeLine lineNumber="7970"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Moreover, one argument is a constant that can be viewed as a splat</span></CodeLine>
<Link id="l07971" /><CodeLine lineNumber="7971"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// constant.</span></CodeLine>
<Link id="l07972" /><CodeLine lineNumber="7972"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg0 = Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l07973" /><CodeLine lineNumber="7973"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsArg0Constant = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Arg0) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Arg0) ||</span></CodeLine>
<Link id="l07974" /><CodeLine lineNumber="7974"><span class="doxyHighlight">                            <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Arg0);</span></CodeLine>
<Link id="l07975" /><CodeLine lineNumber="7975"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo">TargetTransformInfo::OperandValueInfo</a> Arg0Info, Arg1Info;</span></CodeLine>
<Link id="l07976" /><CodeLine lineNumber="7976"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsArg0Constant)</span></CodeLine>
<Link id="l07977" /><CodeLine lineNumber="7977"><span class="doxyHighlight">        Arg0Info.<a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo/#a930b0b2be537d928348aa0946f61dcd6">Kind</a> = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca76d8855d96b8e66b9411ed74737ca8f7">TargetTransformInfo::OK&#95;UniformConstantValue</a>;</span></CodeLine>
<Link id="l07978" /><CodeLine lineNumber="7978"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07979" /><CodeLine lineNumber="7979"><span class="doxyHighlight">        Arg1Info.<a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo/#a930b0b2be537d928348aa0946f61dcd6">Kind</a> = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca76d8855d96b8e66b9411ed74737ca8f7">TargetTransformInfo::OK&#95;UniformConstantValue</a>;</span></CodeLine>
<Link id="l07980" /><CodeLine lineNumber="7980"></CodeLine>
<Link id="l07981" /><CodeLine lineNumber="7981"><span class="doxyHighlight">      ScalarCost += TTI.getArithmeticInstrCost(</span></CodeLine>
<Link id="l07982" /><CodeLine lineNumber="7982"><span class="doxyHighlight">          Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>, Arg0Info, Arg1Info);</span></CodeLine>
<Link id="l07983" /><CodeLine lineNumber="7983"><span class="doxyHighlight">      VectorCost += TTI.getArithmeticInstrCost(Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), PromotedType,</span></CodeLine>
<Link id="l07984" /><CodeLine lineNumber="7984"><span class="doxyHighlight">                                               <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>, Arg0Info, Arg1Info);</span></CodeLine>
<Link id="l07985" /><CodeLine lineNumber="7985"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07986" /><CodeLine lineNumber="7986"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l07987" /><CodeLine lineNumber="7987"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Estimated cost of computation to be promoted:\\nScalar: &quot;</span></CodeLine>
<Link id="l07988" /><CodeLine lineNumber="7988"><span class="doxyHighlight">               &lt;&lt; ScalarCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nVector: &quot;</span><span class="doxyHighlight"> &lt;&lt; VectorCost &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07989" /><CodeLine lineNumber="7989"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScalarCost &gt; VectorCost;</span></CodeLine>
<Link id="l07990" /><CodeLine lineNumber="7990"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07991" /><CodeLine lineNumber="7991"></CodeLine>
<Link id="l07992" /><CodeLine lineNumber="7992"><span class="doxyHighlightComment">  /// Generate a constant vector with \\p Val with the same</span></CodeLine>
<Link id="l07993" /><CodeLine lineNumber="7993"><span class="doxyHighlightComment">  /// number of elements as the transition.</span></CodeLine>
<Link id="l07994" /><CodeLine lineNumber="7994"><span class="doxyHighlightComment">  /// \\p UseSplat defines whether or not \\p Val should be replicated</span></CodeLine>
<Link id="l07995" /><CodeLine lineNumber="7995"><span class="doxyHighlightComment">  /// across the whole vector.</span></CodeLine>
<Link id="l07996" /><CodeLine lineNumber="7996"><span class="doxyHighlightComment">  /// In other words, if UseSplat == true, we generate &lt;Val, Val, ..., Val&gt;,</span></CodeLine>
<Link id="l07997" /><CodeLine lineNumber="7997"><span class="doxyHighlightComment">  /// otherwise we generate a vector with as many poison as possible:</span></CodeLine>
<Link id="l07998" /><CodeLine lineNumber="7998"><span class="doxyHighlightComment">  /// &lt;poison, ..., poison, Val, poison, ..., poison&gt; where \\p Val is only</span></CodeLine>
<Link id="l07999" /><CodeLine lineNumber="7999"><span class="doxyHighlightComment">  /// used at the index of the extract.</span></CodeLine>
<Link id="l08000" /><CodeLine lineNumber="8000"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;getConstantVector(<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Val, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseSplat)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l08001" /><CodeLine lineNumber="8001"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExtractIdx = std::numeric&#95;limits&lt;unsigned&gt;::max();</span></CodeLine>
<Link id="l08002" /><CodeLine lineNumber="8002"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UseSplat) &#123;</span></CodeLine>
<Link id="l08003" /><CodeLine lineNumber="8003"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we cannot determine where the constant must be, we have to</span></CodeLine>
<Link id="l08004" /><CodeLine lineNumber="8004"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// use a splat constant.</span></CodeLine>
<Link id="l08005" /><CodeLine lineNumber="8005"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValExtractIdx = Transition-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(getTransitionIdx());</span></CodeLine>
<Link id="l08006" /><CodeLine lineNumber="8006"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CstVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(ValExtractIdx))</span></CodeLine>
<Link id="l08007" /><CodeLine lineNumber="8007"><span class="doxyHighlight">        ExtractIdx = CstVal-&gt;<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>();</span></CodeLine>
<Link id="l08008" /><CodeLine lineNumber="8008"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08009" /><CodeLine lineNumber="8009"><span class="doxyHighlight">        UseSplat = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08010" /><CodeLine lineNumber="8010"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08011" /><CodeLine lineNumber="8011"></CodeLine>
<Link id="l08012" /><CodeLine lineNumber="8012"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(getTransitionType())-&gt;getElementCount();</span></CodeLine>
<Link id="l08013" /><CodeLine lineNumber="8013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseSplat)</span></CodeLine>
<Link id="l08014" /><CodeLine lineNumber="8014"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantvector/#aa3b241b35b0039b413faf1ef4e873eb7">ConstantVector::getSplat</a>(EC, Val);</span></CodeLine>
<Link id="l08015" /><CodeLine lineNumber="8015"></CodeLine>
<Link id="l08016" /><CodeLine lineNumber="8016"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EC.isScalable()) &#123;</span></CodeLine>
<Link id="l08017" /><CodeLine lineNumber="8017"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 4&gt;</a> ConstVec;</span></CodeLine>
<Link id="l08018" /><CodeLine lineNumber="8018"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/poisonvalue">PoisonValue</a> &#42;PoisonVal = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Val-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l08019" /><CodeLine lineNumber="8019"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0; Idx != EC.getKnownMinValue(); ++Idx) &#123;</span></CodeLine>
<Link id="l08020" /><CodeLine lineNumber="8020"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx == ExtractIdx)</span></CodeLine>
<Link id="l08021" /><CodeLine lineNumber="8021"><span class="doxyHighlight">          ConstVec.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Val);</span></CodeLine>
<Link id="l08022" /><CodeLine lineNumber="8022"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08023" /><CodeLine lineNumber="8023"><span class="doxyHighlight">          ConstVec.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PoisonVal);</span></CodeLine>
<Link id="l08024" /><CodeLine lineNumber="8024"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08025" /><CodeLine lineNumber="8025"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantvector/#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(ConstVec);</span></CodeLine>
<Link id="l08026" /><CodeLine lineNumber="8026"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08027" /><CodeLine lineNumber="8027"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span></CodeLine>
<Link id="l08028" /><CodeLine lineNumber="8028"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Generate scalable vector for non-splat is unimplemented&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08029" /><CodeLine lineNumber="8029"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08030" /><CodeLine lineNumber="8030"></CodeLine>
<Link id="l08031" /><CodeLine lineNumber="8031"><span class="doxyHighlightComment">  /// Check if promoting to a vector type an operand at \\p OperandIdx</span></CodeLine>
<Link id="l08032" /><CodeLine lineNumber="8032"><span class="doxyHighlightComment">  /// in \\p Use can trigger undefined behavior.</span></CodeLine>
<Link id="l08033" /><CodeLine lineNumber="8033"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canCauseUndefinedBehavior(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/use">Use</a>,</span></CodeLine>
<Link id="l08034" /><CodeLine lineNumber="8034"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OperandIdx) &#123;</span></CodeLine>
<Link id="l08035" /><CodeLine lineNumber="8035"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is not safe to introduce undef when the operand is on</span></CodeLine>
<Link id="l08036" /><CodeLine lineNumber="8036"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the right hand side of a division-like instruction.</span></CodeLine>
<Link id="l08037" /><CodeLine lineNumber="8037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OperandIdx != 1)</span></CodeLine>
<Link id="l08038" /><CodeLine lineNumber="8038"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08039" /><CodeLine lineNumber="8039"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l08040" /><CodeLine lineNumber="8040"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l08041" /><CodeLine lineNumber="8041"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08042" /><CodeLine lineNumber="8042"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SDiv:</span></CodeLine>
<Link id="l08043" /><CodeLine lineNumber="8043"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l08044" /><CodeLine lineNumber="8044"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SRem:</span></CodeLine>
<Link id="l08045" /><CodeLine lineNumber="8045"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem:</span></CodeLine>
<Link id="l08046" /><CodeLine lineNumber="8046"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08047" /><CodeLine lineNumber="8047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FDiv:</span></CodeLine>
<Link id="l08048" /><CodeLine lineNumber="8048"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FRem:</span></CodeLine>
<Link id="l08049" /><CodeLine lineNumber="8049"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/llvm/use">Use</a>-&gt;hasNoNaNs();</span></CodeLine>
<Link id="l08050" /><CodeLine lineNumber="8050"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08051" /><CodeLine lineNumber="8051"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08052" /><CodeLine lineNumber="8052"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08053" /><CodeLine lineNumber="8053"></CodeLine>
<Link id="l08054" /><CodeLine lineNumber="8054"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l08055" /><CodeLine lineNumber="8055" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a07696175d8a3e65a0c79186f2ec8a58a"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a07696175d8a3e65a0c79186f2ec8a58a">VectorPromoteHelper</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l08056" /><CodeLine lineNumber="8056"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Transition,</span></CodeLine>
<Link id="l08057" /><CodeLine lineNumber="8057"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CombineCost)</span></CodeLine>
<Link id="l08058" /><CodeLine lineNumber="8058"><span class="doxyHighlight">      : DL(DL), TLI(TLI), TTI(TTI), Transition(Transition),</span></CodeLine>
<Link id="l08059" /><CodeLine lineNumber="8059"><span class="doxyHighlight">        StoreExtractCombineCost(CombineCost) &#123;</span></CodeLine>
<Link id="l08060" /><CodeLine lineNumber="8060"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Transition &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Do not know how to promote null&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08061" /><CodeLine lineNumber="8061"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08062" /><CodeLine lineNumber="8062"></CodeLine>
<Link id="l08063" /><CodeLine lineNumber="8063"><span class="doxyHighlightComment">  /// Check if we can promote \\p ToBePromoted to \\p Type.</span></CodeLine>
<Link id="l08064" /><CodeLine lineNumber="8064" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a6bb4d1b66785c3b2bb7204fa7b13b559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a6bb4d1b66785c3b2bb7204fa7b13b559">canPromote</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l08065" /><CodeLine lineNumber="8065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We could support CastInst too.</span></CodeLine>
<Link id="l08066" /><CodeLine lineNumber="8066"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(ToBePromoted);</span></CodeLine>
<Link id="l08067" /><CodeLine lineNumber="8067"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08068" /><CodeLine lineNumber="8068"></CodeLine>
<Link id="l08069" /><CodeLine lineNumber="8069"><span class="doxyHighlightComment">  /// Check if it is profitable to promote \\p ToBePromoted</span></CodeLine>
<Link id="l08070" /><CodeLine lineNumber="8070"><span class="doxyHighlightComment">  /// by moving downward the transition through.</span></CodeLine>
<Link id="l08071" /><CodeLine lineNumber="8071" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#aa46482c59b5d71b890df4cfaada1e6c7"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#aa46482c59b5d71b890df4cfaada1e6c7">shouldPromote</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l08072" /><CodeLine lineNumber="8072"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Promote only if all the operands can be statically expanded.</span></CodeLine>
<Link id="l08073" /><CodeLine lineNumber="8073"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Indeed, we do not want to introduce any new kind of transitions.</span></CodeLine>
<Link id="l08074" /><CodeLine lineNumber="8074"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;U : ToBePromoted-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</span></CodeLine>
<Link id="l08075" /><CodeLine lineNumber="8075"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = U.get();</span></CodeLine>
<Link id="l08076" /><CodeLine lineNumber="8076"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Val == getEndOfTransition()) &#123;</span></CodeLine>
<Link id="l08077" /><CodeLine lineNumber="8077"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the use is a division and the transition is on the rhs,</span></CodeLine>
<Link id="l08078" /><CodeLine lineNumber="8078"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we cannot promote the operation, otherwise we may create a</span></CodeLine>
<Link id="l08079" /><CodeLine lineNumber="8079"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// division by zero.</span></CodeLine>
<Link id="l08080" /><CodeLine lineNumber="8080"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (canCauseUndefinedBehavior(ToBePromoted, U.getOperandNo()))</span></CodeLine>
<Link id="l08081" /><CodeLine lineNumber="8081"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08082" /><CodeLine lineNumber="8082"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08083" /><CodeLine lineNumber="8083"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08084" /><CodeLine lineNumber="8084"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Val) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val) &amp;&amp;</span></CodeLine>
<Link id="l08085" /><CodeLine lineNumber="8085"><span class="doxyHighlight">          !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Val))</span></CodeLine>
<Link id="l08086" /><CodeLine lineNumber="8086"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08087" /><CodeLine lineNumber="8087"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08088" /><CodeLine lineNumber="8088"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that the resulting operation is legal.</span></CodeLine>
<Link id="l08089" /><CodeLine lineNumber="8089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ISDOpcode = TLI.InstructionOpcodeToISD(ToBePromoted-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</span></CodeLine>
<Link id="l08090" /><CodeLine lineNumber="8090"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ISDOpcode)</span></CodeLine>
<Link id="l08091" /><CodeLine lineNumber="8091"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08092" /><CodeLine lineNumber="8092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a> ||</span></CodeLine>
<Link id="l08093" /><CodeLine lineNumber="8093"><span class="doxyHighlight">           TLI.isOperationLegalOrCustom(</span></CodeLine>
<Link id="l08094" /><CodeLine lineNumber="8094"><span class="doxyHighlight">               ISDOpcode, TLI.getValueType(DL, getTransitionType(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l08095" /><CodeLine lineNumber="8095"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08096" /><CodeLine lineNumber="8096"></CodeLine>
<Link id="l08097" /><CodeLine lineNumber="8097"><span class="doxyHighlightComment">  /// Check whether or not \\p Use can be combined</span></CodeLine>
<Link id="l08098" /><CodeLine lineNumber="8098"><span class="doxyHighlightComment">  /// with the transition.</span></CodeLine>
<Link id="l08099" /><CodeLine lineNumber="8099"><span class="doxyHighlightComment">  /// I.e., is it possible to do Use(Transition) =&gt; AnotherUse?</span></CodeLine>
<Link id="l08100" /><CodeLine lineNumber="8100" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a50c710a774d51aa99714743554845ce8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a50c710a774d51aa99714743554845ce8">canCombine</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/use">Use</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>); &#125;</span></CodeLine>
<Link id="l08101" /><CodeLine lineNumber="8101"></CodeLine>
<Link id="l08102" /><CodeLine lineNumber="8102"><span class="doxyHighlightComment">  /// Record \\p ToBePromoted as part of the chain to be promoted.</span></CodeLine>
<Link id="l08103" /><CodeLine lineNumber="8103" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a1c8dbcd42d4bca1cab2648c861a0e41a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a1c8dbcd42d4bca1cab2648c861a0e41a">enqueueForPromotion</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBePromoted) &#123;</span></CodeLine>
<Link id="l08104" /><CodeLine lineNumber="8104"><span class="doxyHighlight">    InstsToBePromoted.push&#95;back(ToBePromoted);</span></CodeLine>
<Link id="l08105" /><CodeLine lineNumber="8105"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08106" /><CodeLine lineNumber="8106"></CodeLine>
<Link id="l08107" /><CodeLine lineNumber="8107"><span class="doxyHighlightComment">  /// Set the instruction that will be combined with the transition.</span></CodeLine>
<Link id="l08108" /><CodeLine lineNumber="8108" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac69dbe5c53040d38e1f1d94ad4585e9f"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac69dbe5c53040d38e1f1d94ad4585e9f">recordCombineInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToBeCombined) &#123;</span></CodeLine>
<Link id="l08109" /><CodeLine lineNumber="8109"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#a50c710a774d51aa99714743554845ce8">canCombine</a>(ToBeCombined) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unsupported instruction to combine&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08110" /><CodeLine lineNumber="8110"><span class="doxyHighlight">    CombineInst = ToBeCombined;</span></CodeLine>
<Link id="l08111" /><CodeLine lineNumber="8111"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08112" /><CodeLine lineNumber="8112"></CodeLine>
<Link id="l08113" /><CodeLine lineNumber="8113"><span class="doxyHighlightComment">  /// Promote all the instructions enqueued for promotion if it is</span></CodeLine>
<Link id="l08114" /><CodeLine lineNumber="8114"><span class="doxyHighlightComment">  /// is profitable.</span></CodeLine>
<Link id="l08115" /><CodeLine lineNumber="8115"><span class="doxyHighlightComment">  /// \\return True if the promotion happened, false otherwise.</span></CodeLine>
<Link id="l08116" /><CodeLine lineNumber="8116" lineLink="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac167b63805ec9effafeefa7b6d7e4777"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/vectorpromotehelper/#ac167b63805ec9effafeefa7b6d7e4777">promote</a>() &#123;</span></CodeLine>
<Link id="l08117" /><CodeLine lineNumber="8117"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if there is something to promote.</span></CodeLine>
<Link id="l08118" /><CodeLine lineNumber="8118"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Right now, if we do not have anything to combine with,</span></CodeLine>
<Link id="l08119" /><CodeLine lineNumber="8119"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we assume the promotion is not profitable.</span></CodeLine>
<Link id="l08120" /><CodeLine lineNumber="8120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InstsToBePromoted.empty() || !CombineInst)</span></CodeLine>
<Link id="l08121" /><CodeLine lineNumber="8121"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08122" /><CodeLine lineNumber="8122"></CodeLine>
<Link id="l08123" /><CodeLine lineNumber="8123"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check cost.</span></CodeLine>
<Link id="l08124" /><CodeLine lineNumber="8124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a> &amp;&amp; !isProfitableToPromote())</span></CodeLine>
<Link id="l08125" /><CodeLine lineNumber="8125"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08126" /><CodeLine lineNumber="8126"></CodeLine>
<Link id="l08127" /><CodeLine lineNumber="8127"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Promote.</span></CodeLine>
<Link id="l08128" /><CodeLine lineNumber="8128"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ToBePromoted : InstsToBePromoted)</span></CodeLine>
<Link id="l08129" /><CodeLine lineNumber="8129"><span class="doxyHighlight">      promoteImpl(ToBePromoted);</span></CodeLine>
<Link id="l08130" /><CodeLine lineNumber="8130"><span class="doxyHighlight">    InstsToBePromoted.clear();</span></CodeLine>
<Link id="l08131" /><CodeLine lineNumber="8131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08132" /><CodeLine lineNumber="8132"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08133" /><CodeLine lineNumber="8133"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l08134" /><CodeLine lineNumber="8134"></CodeLine>
<Link id="l08135" /><CodeLine lineNumber="8135"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l08136" /><CodeLine lineNumber="8136"></CodeLine>
<Link id="l08137" /><CodeLine lineNumber="8137"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> VectorPromoteHelper::promoteImpl(Instruction &#42;ToBePromoted) &#123;</span></CodeLine>
<Link id="l08138" /><CodeLine lineNumber="8138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point, we know that all the operands of ToBePromoted but Def</span></CodeLine>
<Link id="l08139" /><CodeLine lineNumber="8139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can be statically promoted.</span></CodeLine>
<Link id="l08140" /><CodeLine lineNumber="8140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For Def, we need to use its parameter in ToBePromoted:</span></CodeLine>
<Link id="l08141" /><CodeLine lineNumber="8141"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// b = ToBePromoted ty1 a</span></CodeLine>
<Link id="l08142" /><CodeLine lineNumber="8142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Def = Transition ty1 b to ty2</span></CodeLine>
<Link id="l08143" /><CodeLine lineNumber="8143"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move the transition down.</span></CodeLine>
<Link id="l08144" /><CodeLine lineNumber="8144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 Replace all uses of the promoted operation by the transition.</span></CodeLine>
<Link id="l08145" /><CodeLine lineNumber="8145"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// = ... b =&gt; = ... Def.</span></CodeLine>
<Link id="l08146" /><CodeLine lineNumber="8146"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ToBePromoted-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == Transition-&gt;getType() &amp;&amp;</span></CodeLine>
<Link id="l08147" /><CodeLine lineNumber="8147"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;The type of the result of the transition does not match &quot;</span></CodeLine>
<Link id="l08148" /><CodeLine lineNumber="8148"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;the final type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08149" /><CodeLine lineNumber="8149"><span class="doxyHighlight">  ToBePromoted-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Transition);</span></CodeLine>
<Link id="l08150" /><CodeLine lineNumber="8150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 Update the type of the uses.</span></CodeLine>
<Link id="l08151" /><CodeLine lineNumber="8151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// b = ToBePromoted ty2 Def =&gt; b = ToBePromoted ty1 Def.</span></CodeLine>
<Link id="l08152" /><CodeLine lineNumber="8152"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TransitionTy = getTransitionType();</span></CodeLine>
<Link id="l08153" /><CodeLine lineNumber="8153"><span class="doxyHighlight">  ToBePromoted-&gt;<a href="/docs/api/classes/llvm/value/#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(TransitionTy);</span></CodeLine>
<Link id="l08154" /><CodeLine lineNumber="8154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3 Update all the operands of the promoted operation with promoted</span></CodeLine>
<Link id="l08155" /><CodeLine lineNumber="8155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operands.</span></CodeLine>
<Link id="l08156" /><CodeLine lineNumber="8156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// b = ToBePromoted ty1 Def =&gt; b = ToBePromoted ty1 a.</span></CodeLine>
<Link id="l08157" /><CodeLine lineNumber="8157"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;U : ToBePromoted-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</span></CodeLine>
<Link id="l08158" /><CodeLine lineNumber="8158"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Val = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.get();</span></CodeLine>
<Link id="l08159" /><CodeLine lineNumber="8159"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08160" /><CodeLine lineNumber="8160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Val == Transition)</span></CodeLine>
<Link id="l08161" /><CodeLine lineNumber="8161"><span class="doxyHighlight">      NewVal = Transition-&gt;getOperand(getTransitionOriginalValueIdx());</span></CodeLine>
<Link id="l08162" /><CodeLine lineNumber="8162"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Val) ||</span></CodeLine>
<Link id="l08163" /><CodeLine lineNumber="8163"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Val)) &#123;</span></CodeLine>
<Link id="l08164" /><CodeLine lineNumber="8164"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Use a splat constant if it is not safe to use undef.</span></CodeLine>
<Link id="l08165" /><CodeLine lineNumber="8165"><span class="doxyHighlight">      NewVal = getConstantVector(</span></CodeLine>
<Link id="l08166" /><CodeLine lineNumber="8166"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(Val),</span></CodeLine>
<Link id="l08167" /><CodeLine lineNumber="8167"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val) ||</span></CodeLine>
<Link id="l08168" /><CodeLine lineNumber="8168"><span class="doxyHighlight">              canCauseUndefinedBehavior(ToBePromoted, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getOperandNo()));</span></CodeLine>
<Link id="l08169" /><CodeLine lineNumber="8169"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08170" /><CodeLine lineNumber="8170"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Did you modified shouldPromote and forgot to update &quot;</span></CodeLine>
<Link id="l08171" /><CodeLine lineNumber="8171"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;this?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08172" /><CodeLine lineNumber="8172"><span class="doxyHighlight">    ToBePromoted-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getOperandNo(), NewVal);</span></CodeLine>
<Link id="l08173" /><CodeLine lineNumber="8173"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08174" /><CodeLine lineNumber="8174"><span class="doxyHighlight">  Transition-&gt;moveAfter(ToBePromoted);</span></CodeLine>
<Link id="l08175" /><CodeLine lineNumber="8175"><span class="doxyHighlight">  Transition-&gt;setOperand(getTransitionOriginalValueIdx(), ToBePromoted);</span></CodeLine>
<Link id="l08176" /><CodeLine lineNumber="8176"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08177" /><CodeLine lineNumber="8177"></CodeLine>
<Link id="l08178" /><CodeLine lineNumber="8178"><span class="doxyHighlightComment">/// Some targets can do store(extractelement) with one instruction.</span></CodeLine>
<Link id="l08179" /><CodeLine lineNumber="8179"><span class="doxyHighlightComment">/// Try to push the extractelement towards the stores when the target</span></CodeLine>
<Link id="l08180" /><CodeLine lineNumber="8180"><span class="doxyHighlightComment">/// has this feature and this is profitable.</span></CodeLine>
<Link id="l08181" /><CodeLine lineNumber="8181"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeExtractElementInst(Instruction &#42;Inst) &#123;</span></CodeLine>
<Link id="l08182" /><CodeLine lineNumber="8182"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CombineCost = std::numeric&#95;limits&lt;unsigned&gt;::max();</span></CodeLine>
<Link id="l08183" /><CodeLine lineNumber="8183"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a1e6cf6a2bf01ee44a0f0843d8c3512cd">DisableStoreExtract</a> ||</span></CodeLine>
<Link id="l08184" /><CodeLine lineNumber="8184"><span class="doxyHighlight">      (!<a href="#a4a686688e72eafe6375f8ae1ed184123">StressStoreExtract</a> &amp;&amp;</span></CodeLine>
<Link id="l08185" /><CodeLine lineNumber="8185"><span class="doxyHighlight">       !TLI-&gt;canCombineStoreAndExtract(Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l08186" /><CodeLine lineNumber="8186"><span class="doxyHighlight">                                       Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), CombineCost)))</span></CodeLine>
<Link id="l08187" /><CodeLine lineNumber="8187"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08188" /><CodeLine lineNumber="8188"></CodeLine>
<Link id="l08189" /><CodeLine lineNumber="8189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point we know that Inst is a vector to scalar transition.</span></CodeLine>
<Link id="l08190" /><CodeLine lineNumber="8190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to move it down the def-use chain, until:</span></CodeLine>
<Link id="l08191" /><CodeLine lineNumber="8191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - We can combine the transition with its single use</span></CodeLine>
<Link id="l08192" /><CodeLine lineNumber="8192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   =&gt; we got rid of the transition.</span></CodeLine>
<Link id="l08193" /><CodeLine lineNumber="8193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - We escape the current basic block</span></CodeLine>
<Link id="l08194" /><CodeLine lineNumber="8194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   =&gt; we would need to check that we are moving it at a cheaper place and</span></CodeLine>
<Link id="l08195" /><CodeLine lineNumber="8195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      we do not do that for now.</span></CodeLine>
<Link id="l08196" /><CodeLine lineNumber="8196"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Parent = Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l08197" /><CodeLine lineNumber="8197"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found an interesting transition: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08198" /><CodeLine lineNumber="8198"><span class="doxyHighlight">  VectorPromoteHelper VPH(&#42;DL, &#42;TLI, &#42;TTI, Inst, CombineCost);</span></CodeLine>
<Link id="l08199" /><CodeLine lineNumber="8199"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the transition has more than one use, assume this is not going to be</span></CodeLine>
<Link id="l08200" /><CodeLine lineNumber="8200"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// beneficial.</span></CodeLine>
<Link id="l08201" /><CodeLine lineNumber="8201"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l08202" /><CodeLine lineNumber="8202"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ToBePromoted = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;Inst-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>());</span></CodeLine>
<Link id="l08203" /><CodeLine lineNumber="8203"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Use: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ToBePromoted &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08204" /><CodeLine lineNumber="8204"></CodeLine>
<Link id="l08205" /><CodeLine lineNumber="8205"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ToBePromoted-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Parent) &#123;</span></CodeLine>
<Link id="l08206" /><CodeLine lineNumber="8206"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Instruction to promote is in a different block (&quot;</span></CodeLine>
<Link id="l08207" /><CodeLine lineNumber="8207"><span class="doxyHighlight">                        &lt;&lt; ToBePromoted-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getName()</span></CodeLine>
<Link id="l08208" /><CodeLine lineNumber="8208"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;) than the transition (&quot;</span><span class="doxyHighlight"> &lt;&lt; Parent-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l08209" /><CodeLine lineNumber="8209"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;).\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08210" /><CodeLine lineNumber="8210"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08211" /><CodeLine lineNumber="8211"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08212" /><CodeLine lineNumber="8212"></CodeLine>
<Link id="l08213" /><CodeLine lineNumber="8213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPH.canCombine(ToBePromoted)) &#123;</span></CodeLine>
<Link id="l08214" /><CodeLine lineNumber="8214"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Assume &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span></CodeLine>
<Link id="l08215" /><CodeLine lineNumber="8215"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;will be combined with: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ToBePromoted &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08216" /><CodeLine lineNumber="8216"><span class="doxyHighlight">      VPH.recordCombineInstruction(ToBePromoted);</span></CodeLine>
<Link id="l08217" /><CodeLine lineNumber="8217"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = VPH.promote();</span></CodeLine>
<Link id="l08218" /><CodeLine lineNumber="8218"><span class="doxyHighlight">      NumStoreExtractExposed += <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l08219" /><CodeLine lineNumber="8219"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l08220" /><CodeLine lineNumber="8220"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08221" /><CodeLine lineNumber="8221"></CodeLine>
<Link id="l08222" /><CodeLine lineNumber="8222"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Try promoting.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08223" /><CodeLine lineNumber="8223"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VPH.canPromote(ToBePromoted) || !VPH.shouldPromote(ToBePromoted))</span></CodeLine>
<Link id="l08224" /><CodeLine lineNumber="8224"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08225" /><CodeLine lineNumber="8225"></CodeLine>
<Link id="l08226" /><CodeLine lineNumber="8226"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Promoting is possible... Enqueue for promotion!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08227" /><CodeLine lineNumber="8227"></CodeLine>
<Link id="l08228" /><CodeLine lineNumber="8228"><span class="doxyHighlight">    VPH.enqueueForPromotion(ToBePromoted);</span></CodeLine>
<Link id="l08229" /><CodeLine lineNumber="8229"><span class="doxyHighlight">    Inst = ToBePromoted;</span></CodeLine>
<Link id="l08230" /><CodeLine lineNumber="8230"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08231" /><CodeLine lineNumber="8231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08232" /><CodeLine lineNumber="8232"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08233" /><CodeLine lineNumber="8233"></CodeLine>
<Link id="l08234" /><CodeLine lineNumber="8234"><span class="doxyHighlightComment">/// For the instruction sequence of store below, F and I values</span></CodeLine>
<Link id="l08235" /><CodeLine lineNumber="8235"><span class="doxyHighlightComment">/// are bundled together as an i64 value before being stored into memory.</span></CodeLine>
<Link id="l08236" /><CodeLine lineNumber="8236"><span class="doxyHighlightComment">/// Sometimes it is more efficient to generate separate stores for F and I,</span></CodeLine>
<Link id="l08237" /><CodeLine lineNumber="8237"><span class="doxyHighlightComment">/// which can remove the bitwise instructions or sink them to colder places.</span></CodeLine>
<Link id="l08238" /><CodeLine lineNumber="8238"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l08239" /><CodeLine lineNumber="8239"><span class="doxyHighlightComment">///   (store (or (zext (bitcast F to i32) to i64),</span></CodeLine>
<Link id="l08240" /><CodeLine lineNumber="8240"><span class="doxyHighlightComment">///              (shl (zext I to i64), 32)), addr)  --&gt;</span></CodeLine>
<Link id="l08241" /><CodeLine lineNumber="8241"><span class="doxyHighlightComment">///   (store F, addr) and (store I, addr+4)</span></CodeLine>
<Link id="l08242" /><CodeLine lineNumber="8242"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l08243" /><CodeLine lineNumber="8243"><span class="doxyHighlightComment">/// Similarly, splitting for other merged store can also be beneficial, like:</span></CodeLine>
<Link id="l08244" /><CodeLine lineNumber="8244"><span class="doxyHighlightComment">/// For pair of &#123;i32, i32&#125;, i64 store --&gt; two i32 stores.</span></CodeLine>
<Link id="l08245" /><CodeLine lineNumber="8245"><span class="doxyHighlightComment">/// For pair of &#123;i32, i16&#125;, i64 store --&gt; two i32 stores.</span></CodeLine>
<Link id="l08246" /><CodeLine lineNumber="8246"><span class="doxyHighlightComment">/// For pair of &#123;i16, i16&#125;, i32 store --&gt; two i16 stores.</span></CodeLine>
<Link id="l08247" /><CodeLine lineNumber="8247"><span class="doxyHighlightComment">/// For pair of &#123;i16, i8&#125;,  i32 store --&gt; two i16 stores.</span></CodeLine>
<Link id="l08248" /><CodeLine lineNumber="8248"><span class="doxyHighlightComment">/// For pair of &#123;i8, i8&#125;,   i16 store --&gt; two i8 stores.</span></CodeLine>
<Link id="l08249" /><CodeLine lineNumber="8249"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l08250" /><CodeLine lineNumber="8250"><span class="doxyHighlightComment">/// We allow each target to determine specifically which kind of splitting is</span></CodeLine>
<Link id="l08251" /><CodeLine lineNumber="8251"><span class="doxyHighlightComment">/// supported.</span></CodeLine>
<Link id="l08252" /><CodeLine lineNumber="8252"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l08253" /><CodeLine lineNumber="8253"><span class="doxyHighlightComment">/// The store patterns are commonly seen from the simple code snippet below</span></CodeLine>
<Link id="l08254" /><CodeLine lineNumber="8254"><span class="doxyHighlightComment">/// if only std::make&#95;pair(...) is sroa transformed before inlined into hoo.</span></CodeLine>
<Link id="l08255" /><CodeLine lineNumber="8255"><span class="doxyHighlightComment">///   void goo(const std::pair&lt;int, float&gt; &amp;);</span></CodeLine>
<Link id="l08256" /><CodeLine lineNumber="8256"><span class="doxyHighlightComment">///   hoo() &#123;</span></CodeLine>
<Link id="l08257" /><CodeLine lineNumber="8257"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l08258" /><CodeLine lineNumber="8258"><span class="doxyHighlightComment">///     goo(std::make&#95;pair(tmp, ftmp));</span></CodeLine>
<Link id="l08259" /><CodeLine lineNumber="8259"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l08260" /><CodeLine lineNumber="8260"><span class="doxyHighlightComment">///   &#125;</span></CodeLine>
<Link id="l08261" /><CodeLine lineNumber="8261"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l08262" /><CodeLine lineNumber="8262"><span class="doxyHighlightComment">/// Although we already have similar splitting in DAG Combine, we duplicate</span></CodeLine>
<Link id="l08263" /><CodeLine lineNumber="8263"><span class="doxyHighlightComment">/// it in CodeGenPrepare to catch the case in which pattern is across</span></CodeLine>
<Link id="l08264" /><CodeLine lineNumber="8264"><span class="doxyHighlightComment">/// multiple BBs. The logic in DAG Combine is kept to catch case generated</span></CodeLine>
<Link id="l08265" /><CodeLine lineNumber="8265"><span class="doxyHighlightComment">/// during code expansion.</span></CodeLine>
<Link id="l08266" /><CodeLine lineNumber="8266" lineLink="#a3c7e1486d1d466b3be981adcb21a6359"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a>(<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l08267" /><CodeLine lineNumber="8267"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l08268" /><CodeLine lineNumber="8268"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle simple but common cases only.</span></CodeLine>
<Link id="l08269" /><CodeLine lineNumber="8269"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;StoreType = <a href="/docs/api/namespaces/llvm/si">SI</a>.getValueOperand()-&gt;getType();</span></CodeLine>
<Link id="l08270" /><CodeLine lineNumber="8270"></CodeLine>
<Link id="l08271" /><CodeLine lineNumber="8271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The code below assumes shifting a value by &lt;number of bits&gt;,</span></CodeLine>
<Link id="l08272" /><CodeLine lineNumber="8272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// whereas scalable vectors would have to be shifted by</span></CodeLine>
<Link id="l08273" /><CodeLine lineNumber="8273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &lt;2log(vscale) + number of bits&gt; in order to store the</span></CodeLine>
<Link id="l08274" /><CodeLine lineNumber="8274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// low/high parts. Bailing out for now.</span></CodeLine>
<Link id="l08275" /><CodeLine lineNumber="8275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreType-&gt;<a href="/docs/api/classes/llvm/type/#a2ff127c9924cd3337080c4445c324aea">isScalableTy</a>())</span></CodeLine>
<Link id="l08276" /><CodeLine lineNumber="8276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08277" /><CodeLine lineNumber="8277"></CodeLine>
<Link id="l08278" /><CodeLine lineNumber="8278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(StoreType) ||</span></CodeLine>
<Link id="l08279" /><CodeLine lineNumber="8279"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(StoreType) == 0)</span></CodeLine>
<Link id="l08280" /><CodeLine lineNumber="8280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08281" /><CodeLine lineNumber="8281"></CodeLine>
<Link id="l08282" /><CodeLine lineNumber="8282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> HalfValBitSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(StoreType) / 2;</span></CodeLine>
<Link id="l08283" /><CodeLine lineNumber="8283"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SplitStoreType = <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext(), HalfValBitSize);</span></CodeLine>
<Link id="l08284" /><CodeLine lineNumber="8284"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(SplitStoreType))</span></CodeLine>
<Link id="l08285" /><CodeLine lineNumber="8285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08286" /><CodeLine lineNumber="8286"></CodeLine>
<Link id="l08287" /><CodeLine lineNumber="8287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t split the store if it is volatile.</span></CodeLine>
<Link id="l08288" /><CodeLine lineNumber="8288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.isVolatile())</span></CodeLine>
<Link id="l08289" /><CodeLine lineNumber="8289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08290" /><CodeLine lineNumber="8290"></CodeLine>
<Link id="l08291" /><CodeLine lineNumber="8291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Match the following patterns:</span></CodeLine>
<Link id="l08292" /><CodeLine lineNumber="8292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (store (or (zext LValue to i64),</span></CodeLine>
<Link id="l08293" /><CodeLine lineNumber="8293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//            (shl (zext HValue to i64), 32)), HalfValBitSize)</span></CodeLine>
<Link id="l08294" /><CodeLine lineNumber="8294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  or</span></CodeLine>
<Link id="l08295" /><CodeLine lineNumber="8295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (store (or (shl (zext HValue to i64), 32)), HalfValBitSize)</span></CodeLine>
<Link id="l08296" /><CodeLine lineNumber="8296"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//            (zext LValue to i64),</span></CodeLine>
<Link id="l08297" /><CodeLine lineNumber="8297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Expect both operands of OR and the first operand of SHL have only</span></CodeLine>
<Link id="l08298" /><CodeLine lineNumber="8298"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one use.</span></CodeLine>
<Link id="l08299" /><CodeLine lineNumber="8299"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>, &#42;HValue;</span></CodeLine>
<Link id="l08300" /><CodeLine lineNumber="8300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getValueOperand(),</span></CodeLine>
<Link id="l08301" /><CodeLine lineNumber="8301"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#ae80cbfea2025ff7bd0770f30be6e050a">m&#95;c&#95;Or</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>))),</span></CodeLine>
<Link id="l08302" /><CodeLine lineNumber="8302"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(HValue))),</span></CodeLine>
<Link id="l08303" /><CodeLine lineNumber="8303"><span class="doxyHighlight">                                   <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(HalfValBitSize))))))</span></CodeLine>
<Link id="l08304" /><CodeLine lineNumber="8304"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08305" /><CodeLine lineNumber="8305"></CodeLine>
<Link id="l08306" /><CodeLine lineNumber="8306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check LValue and HValue are int with size less or equal than 32</span></CodeLine>
<Link id="l08307" /><CodeLine lineNumber="8307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType()-&gt;isIntegerTy() ||</span></CodeLine>
<Link id="l08308" /><CodeLine lineNumber="8308"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType()) &gt; HalfValBitSize ||</span></CodeLine>
<Link id="l08309" /><CodeLine lineNumber="8309"><span class="doxyHighlight">      !HValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l08310" /><CodeLine lineNumber="8310"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(HValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &gt; HalfValBitSize)</span></CodeLine>
<Link id="l08311" /><CodeLine lineNumber="8311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08312" /><CodeLine lineNumber="8312"></CodeLine>
<Link id="l08313" /><CodeLine lineNumber="8313"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If LValue/HValue is a bitcast instruction, use the EVT before bitcast</span></CodeLine>
<Link id="l08314" /><CodeLine lineNumber="8314"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as the input of target query.</span></CodeLine>
<Link id="l08315" /><CodeLine lineNumber="8315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>);</span></CodeLine>
<Link id="l08316" /><CodeLine lineNumber="8316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;HBC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(HValue);</span></CodeLine>
<Link id="l08317" /><CodeLine lineNumber="8317"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/evt">EVT</a> LowTy = LBC ? <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(LBC-&gt;getOperand(0)-&gt;getType())</span></CodeLine>
<Link id="l08318" /><CodeLine lineNumber="8318"><span class="doxyHighlight">                  : <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType());</span></CodeLine>
<Link id="l08319" /><CodeLine lineNumber="8319"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/evt">EVT</a> HighTy = HBC ? <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(HBC-&gt;getOperand(0)-&gt;getType())</span></CodeLine>
<Link id="l08320" /><CodeLine lineNumber="8320"><span class="doxyHighlight">                   : <a href="/docs/api/structs/llvm/evt/#a5db8faf73cf29bcefdb3bdfadf3dc2c1">EVT::getEVT</a>(HValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l08321" /><CodeLine lineNumber="8321"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a8ac7126af5085fb735db4c727a0ab4e9">ForceSplitStore</a> &amp;&amp; !TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#ab068741575ed8c7f6bd4fe059edabd14">isMultiStoresCheaperThanBitsMerge</a>(LowTy, HighTy))</span></CodeLine>
<Link id="l08322" /><CodeLine lineNumber="8322"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08323" /><CodeLine lineNumber="8323"></CodeLine>
<Link id="l08324" /><CodeLine lineNumber="8324"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start to split store.</span></CodeLine>
<Link id="l08325" /><CodeLine lineNumber="8325"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext());</span></CodeLine>
<Link id="l08326" /><CodeLine lineNumber="8326"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l08327" /><CodeLine lineNumber="8327"></CodeLine>
<Link id="l08328" /><CodeLine lineNumber="8328"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If LValue/HValue is a bitcast in another BB, create a new one in current</span></CodeLine>
<Link id="l08329" /><CodeLine lineNumber="8329"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB so it may be merged with the splitted stores by dag combiner.</span></CodeLine>
<Link id="l08330" /><CodeLine lineNumber="8330"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LBC &amp;&amp; LBC-&gt;getParent() != <a href="/docs/api/namespaces/llvm/si">SI</a>.getParent())</span></CodeLine>
<Link id="l08331" /><CodeLine lineNumber="8331"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(LBC-&gt;getOperand(0), LBC-&gt;getType());</span></CodeLine>
<Link id="l08332" /><CodeLine lineNumber="8332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HBC &amp;&amp; HBC-&gt;getParent() != <a href="/docs/api/namespaces/llvm/si">SI</a>.getParent())</span></CodeLine>
<Link id="l08333" /><CodeLine lineNumber="8333"><span class="doxyHighlight">    HValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(HBC-&gt;getOperand(0), HBC-&gt;getType());</span></CodeLine>
<Link id="l08334" /><CodeLine lineNumber="8334"></CodeLine>
<Link id="l08335" /><CodeLine lineNumber="8335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLE = <a href="/docs/api/namespaces/llvm/si">SI</a>.getDataLayout().isLittleEndian();</span></CodeLine>
<Link id="l08336" /><CodeLine lineNumber="8336"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CreateSplitStore = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>) &#123;</span></CodeLine>
<Link id="l08337" /><CodeLine lineNumber="8337"><span class="doxyHighlight">    V = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a0032ae544ae429aaf1053767da90426d">CreateZExtOrBitCast</a>(V, SplitStoreType);</span></CodeLine>
<Link id="l08338" /><CodeLine lineNumber="8338"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Addr = <a href="/docs/api/namespaces/llvm/si">SI</a>.getPointerOperand();</span></CodeLine>
<Link id="l08339" /><CodeLine lineNumber="8339"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/si">SI</a>.getAlign();</span></CodeLine>
<Link id="l08340" /><CodeLine lineNumber="8340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsOffsetStore = (IsLE &amp;&amp; <a href="/docs/api/namespaces/llvm/#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>) || (!IsLE &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>);</span></CodeLine>
<Link id="l08341" /><CodeLine lineNumber="8341"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsOffsetStore) &#123;</span></CodeLine>
<Link id="l08342" /><CodeLine lineNumber="8342"><span class="doxyHighlight">      Addr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(</span></CodeLine>
<Link id="l08343" /><CodeLine lineNumber="8343"><span class="doxyHighlight">          SplitStoreType, Addr,</span></CodeLine>
<Link id="l08344" /><CodeLine lineNumber="8344"><span class="doxyHighlight">          ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext()), 1));</span></CodeLine>
<Link id="l08345" /><CodeLine lineNumber="8345"></CodeLine>
<Link id="l08346" /><CodeLine lineNumber="8346"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// When splitting the store in half, naturally one half will retain the</span></CodeLine>
<Link id="l08347" /><CodeLine lineNumber="8347"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// alignment of the original wider store, regardless of whether it was</span></CodeLine>
<Link id="l08348" /><CodeLine lineNumber="8348"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// over-aligned or not, while the other will require adjustment.</span></CodeLine>
<Link id="l08349" /><CodeLine lineNumber="8349"><span class="doxyHighlight">      Alignment = <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(Alignment, HalfValBitSize / 8);</span></CodeLine>
<Link id="l08350" /><CodeLine lineNumber="8350"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08351" /><CodeLine lineNumber="8351"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(V, Addr, Alignment);</span></CodeLine>
<Link id="l08352" /><CodeLine lineNumber="8352"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l08353" /><CodeLine lineNumber="8353"></CodeLine>
<Link id="l08354" /><CodeLine lineNumber="8354"><span class="doxyHighlight">  CreateSplitStore(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08355" /><CodeLine lineNumber="8355"><span class="doxyHighlight">  CreateSplitStore(HValue, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08356" /><CodeLine lineNumber="8356"></CodeLine>
<Link id="l08357" /><CodeLine lineNumber="8357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete the old store.</span></CodeLine>
<Link id="l08358" /><CodeLine lineNumber="8358"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.eraseFromParent();</span></CodeLine>
<Link id="l08359" /><CodeLine lineNumber="8359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08360" /><CodeLine lineNumber="8360"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08361" /><CodeLine lineNumber="8361"></CodeLine>
<Link id="l08362" /><CodeLine lineNumber="8362"><span class="doxyHighlightComment">// Return true if the GEP has two operands, the first operand is of a sequential</span></CodeLine>
<Link id="l08363" /><CodeLine lineNumber="8363"><span class="doxyHighlightComment">// type, and the second operand is a constant.</span></CodeLine>
<Link id="l08364" /><CodeLine lineNumber="8364" lineLink="#ac3e586008202db1f802e906a489d7574"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) &#123;</span></CodeLine>
<Link id="l08365" /><CodeLine lineNumber="8365"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a81c0916829c13ba5279ca0e5480aef0c">gep&#95;type&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac828b9b52935f87659a4adf237f820a3">gep&#95;type&#95;begin</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</span></CodeLine>
<Link id="l08366" /><CodeLine lineNumber="8366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands() == 2 &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isSequential() &amp;&amp;</span></CodeLine>
<Link id="l08367" /><CodeLine lineNumber="8367"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l08368" /><CodeLine lineNumber="8368"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08369" /><CodeLine lineNumber="8369"></CodeLine>
<Link id="l08370" /><CodeLine lineNumber="8370"><span class="doxyHighlightComment">// Try unmerging GEPs to reduce liveness interference (register pressure) across</span></CodeLine>
<Link id="l08371" /><CodeLine lineNumber="8371"><span class="doxyHighlightComment">// IndirectBr edges. Since IndirectBr edges tend to touch on many blocks,</span></CodeLine>
<Link id="l08372" /><CodeLine lineNumber="8372"><span class="doxyHighlightComment">// reducing liveness interference across those edges benefits global register</span></CodeLine>
<Link id="l08373" /><CodeLine lineNumber="8373"><span class="doxyHighlightComment">// allocation. Currently handles only certain cases.</span></CodeLine>
<Link id="l08374" /><CodeLine lineNumber="8374"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08375" /><CodeLine lineNumber="8375"><span class="doxyHighlightComment">// For example, unmerge %GEPI and %UGEPI as below.</span></CodeLine>
<Link id="l08376" /><CodeLine lineNumber="8376"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08377" /><CodeLine lineNumber="8377"><span class="doxyHighlightComment">// ---------- BEFORE ----------</span></CodeLine>
<Link id="l08378" /><CodeLine lineNumber="8378"><span class="doxyHighlightComment">// SrcBlock:</span></CodeLine>
<Link id="l08379" /><CodeLine lineNumber="8379"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l08380" /><CodeLine lineNumber="8380"><span class="doxyHighlightComment">//   %GEPIOp = ...</span></CodeLine>
<Link id="l08381" /><CodeLine lineNumber="8381"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l08382" /><CodeLine lineNumber="8382"><span class="doxyHighlightComment">//   %GEPI = gep %GEPIOp, Idx</span></CodeLine>
<Link id="l08383" /><CodeLine lineNumber="8383"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l08384" /><CodeLine lineNumber="8384"><span class="doxyHighlightComment">//   indirectbr ... &#91; label %DstB0, label %DstB1, ... label %DstBi ... &#93;</span></CodeLine>
<Link id="l08385" /><CodeLine lineNumber="8385"><span class="doxyHighlightComment">//   (&#42; %GEPI is alive on the indirectbr edges due to other uses ahead)</span></CodeLine>
<Link id="l08386" /><CodeLine lineNumber="8386"><span class="doxyHighlightComment">//   (&#42; %GEPIOp is alive on the indirectbr edges only because of it&#39;s used by</span></CodeLine>
<Link id="l08387" /><CodeLine lineNumber="8387"><span class="doxyHighlightComment">//   %UGEPI)</span></CodeLine>
<Link id="l08388" /><CodeLine lineNumber="8388"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08389" /><CodeLine lineNumber="8389"><span class="doxyHighlightComment">// DstB0: ... (there may be a gep similar to %UGEPI to be unmerged)</span></CodeLine>
<Link id="l08390" /><CodeLine lineNumber="8390"><span class="doxyHighlightComment">// DstB1: ... (there may be a gep similar to %UGEPI to be unmerged)</span></CodeLine>
<Link id="l08391" /><CodeLine lineNumber="8391"><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l08392" /><CodeLine lineNumber="8392"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08393" /><CodeLine lineNumber="8393"><span class="doxyHighlightComment">// DstBi:</span></CodeLine>
<Link id="l08394" /><CodeLine lineNumber="8394"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l08395" /><CodeLine lineNumber="8395"><span class="doxyHighlightComment">//   %UGEPI = gep %GEPIOp, UIdx</span></CodeLine>
<Link id="l08396" /><CodeLine lineNumber="8396"><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l08397" /><CodeLine lineNumber="8397"><span class="doxyHighlightComment">// ---------------------------</span></CodeLine>
<Link id="l08398" /><CodeLine lineNumber="8398"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08399" /><CodeLine lineNumber="8399"><span class="doxyHighlightComment">// ---------- AFTER ----------</span></CodeLine>
<Link id="l08400" /><CodeLine lineNumber="8400"><span class="doxyHighlightComment">// SrcBlock:</span></CodeLine>
<Link id="l08401" /><CodeLine lineNumber="8401"><span class="doxyHighlightComment">//   ... (same as above)</span></CodeLine>
<Link id="l08402" /><CodeLine lineNumber="8402"><span class="doxyHighlightComment">//    (&#42; %GEPI is still alive on the indirectbr edges)</span></CodeLine>
<Link id="l08403" /><CodeLine lineNumber="8403"><span class="doxyHighlightComment">//    (&#42; %GEPIOp is no longer alive on the indirectbr edges as a result of the</span></CodeLine>
<Link id="l08404" /><CodeLine lineNumber="8404"><span class="doxyHighlightComment">//    unmerging)</span></CodeLine>
<Link id="l08405" /><CodeLine lineNumber="8405"><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l08406" /><CodeLine lineNumber="8406"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08407" /><CodeLine lineNumber="8407"><span class="doxyHighlightComment">// DstBi:</span></CodeLine>
<Link id="l08408" /><CodeLine lineNumber="8408"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l08409" /><CodeLine lineNumber="8409"><span class="doxyHighlightComment">//   %UGEPI = gep %GEPI, (UIdx-Idx)</span></CodeLine>
<Link id="l08410" /><CodeLine lineNumber="8410"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l08411" /><CodeLine lineNumber="8411"><span class="doxyHighlightComment">// ---------------------------</span></CodeLine>
<Link id="l08412" /><CodeLine lineNumber="8412"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08413" /><CodeLine lineNumber="8413"><span class="doxyHighlightComment">// The register pressure on the IndirectBr edges is reduced because %GEPIOp is</span></CodeLine>
<Link id="l08414" /><CodeLine lineNumber="8414"><span class="doxyHighlightComment">// no longer alive on them.</span></CodeLine>
<Link id="l08415" /><CodeLine lineNumber="8415"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08416" /><CodeLine lineNumber="8416"><span class="doxyHighlightComment">// We try to unmerge GEPs here in CodGenPrepare, as opposed to limiting merging</span></CodeLine>
<Link id="l08417" /><CodeLine lineNumber="8417"><span class="doxyHighlightComment">// of GEPs in the first place in InstCombiner::visitGetElementPtrInst() so as</span></CodeLine>
<Link id="l08418" /><CodeLine lineNumber="8418"><span class="doxyHighlightComment">// not to disable further simplications and optimizations as a result of GEP</span></CodeLine>
<Link id="l08419" /><CodeLine lineNumber="8419"><span class="doxyHighlightComment">// merging.</span></CodeLine>
<Link id="l08420" /><CodeLine lineNumber="8420"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08421" /><CodeLine lineNumber="8421"><span class="doxyHighlightComment">// Note this unmerging may increase the length of the data flow critical path</span></CodeLine>
<Link id="l08422" /><CodeLine lineNumber="8422"><span class="doxyHighlightComment">// (the path from %GEPIOp to %UGEPI would go through %GEPI), which is a tradeoff</span></CodeLine>
<Link id="l08423" /><CodeLine lineNumber="8423"><span class="doxyHighlightComment">// between the register pressure and the length of data-flow critical</span></CodeLine>
<Link id="l08424" /><CodeLine lineNumber="8424"><span class="doxyHighlightComment">// path. Restricting this to the uncommon IndirectBr case would minimize the</span></CodeLine>
<Link id="l08425" /><CodeLine lineNumber="8425"><span class="doxyHighlightComment">// impact of potentially longer critical path, if any, and the impact on compile</span></CodeLine>
<Link id="l08426" /><CodeLine lineNumber="8426"><span class="doxyHighlightComment">// time.</span></CodeLine>
<Link id="l08427" /><CodeLine lineNumber="8427" lineLink="#a8528dea79f0940669c4fcb751940ca94"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;GEPI,</span></CodeLine>
<Link id="l08428" /><CodeLine lineNumber="8428"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l08429" /><CodeLine lineNumber="8429"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SrcBlock = GEPI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l08430" /><CodeLine lineNumber="8430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that SrcBlock ends with an IndirectBr. If not, give up. The common</span></CodeLine>
<Link id="l08431" /><CodeLine lineNumber="8431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (non-IndirectBr) cases exit early here.</span></CodeLine>
<Link id="l08432" /><CodeLine lineNumber="8432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(SrcBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l08433" /><CodeLine lineNumber="8433"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08434" /><CodeLine lineNumber="8434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that GEPI is a simple gep with a single constant index.</span></CodeLine>
<Link id="l08435" /><CodeLine lineNumber="8435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(GEPI))</span></CodeLine>
<Link id="l08436" /><CodeLine lineNumber="8436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08437" /><CodeLine lineNumber="8437"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;GEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(GEPI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l08438" /><CodeLine lineNumber="8438"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that GEPI is a cheap one.</span></CodeLine>
<Link id="l08439" /><CodeLine lineNumber="8439"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getIntImmCost(GEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>(), GEPIIdx-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l08440" /><CodeLine lineNumber="8440"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>) &gt;</span></CodeLine>
<Link id="l08441" /><CodeLine lineNumber="8441"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</span></CodeLine>
<Link id="l08442" /><CodeLine lineNumber="8442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08443" /><CodeLine lineNumber="8443"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;GEPIOp = GEPI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l08444" /><CodeLine lineNumber="8444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that GEPIOp is an instruction that&#39;s also defined in SrcBlock.</span></CodeLine>
<Link id="l08445" /><CodeLine lineNumber="8445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(GEPIOp))</span></CodeLine>
<Link id="l08446" /><CodeLine lineNumber="8446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08447" /><CodeLine lineNumber="8447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GEPIOpI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(GEPIOp);</span></CodeLine>
<Link id="l08448" /><CodeLine lineNumber="8448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GEPIOpI-&gt;getParent() != SrcBlock)</span></CodeLine>
<Link id="l08449" /><CodeLine lineNumber="8449"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08450" /><CodeLine lineNumber="8450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that GEP is used outside the block, meaning it&#39;s alive on the</span></CodeLine>
<Link id="l08451" /><CodeLine lineNumber="8451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// IndirectBr edge(s).</span></CodeLine>
<Link id="l08452" /><CodeLine lineNumber="8452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none&#95;of</a>(GEPI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;Usr) &#123;</span></CodeLine>
<Link id="l08453" /><CodeLine lineNumber="8453"><span class="doxyHighlight">        if (auto &#42;I = dyn&#95;cast&lt;Instruction&gt;(Usr)) &#123;</span></CodeLine>
<Link id="l08454" /><CodeLine lineNumber="8454"><span class="doxyHighlight">          if (I-&gt;getParent() != SrcBlock) &#123;</span></CodeLine>
<Link id="l08455" /><CodeLine lineNumber="8455"><span class="doxyHighlight">            return true;</span></CodeLine>
<Link id="l08456" /><CodeLine lineNumber="8456"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l08457" /><CodeLine lineNumber="8457"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l08458" /><CodeLine lineNumber="8458"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08459" /><CodeLine lineNumber="8459"><span class="doxyHighlight">      &#125;))</span></CodeLine>
<Link id="l08460" /><CodeLine lineNumber="8460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08461" /><CodeLine lineNumber="8461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The second elements of the GEP chains to be unmerged.</span></CodeLine>
<Link id="l08462" /><CodeLine lineNumber="8462"><span class="doxyHighlight">  std::vector&lt;GetElementPtrInst &#42;&gt; UGEPIs;</span></CodeLine>
<Link id="l08463" /><CodeLine lineNumber="8463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check each user of GEPIOp to check if unmerging would make GEPIOp not alive</span></CodeLine>
<Link id="l08464" /><CodeLine lineNumber="8464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// on IndirectBr edges.</span></CodeLine>
<Link id="l08465" /><CodeLine lineNumber="8465"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;Usr : GEPIOp-&gt;<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#ac2f338c3f467b3d09613e190d73044a5">users</a>()) &#123;</span></CodeLine>
<Link id="l08466" /><CodeLine lineNumber="8466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Usr == GEPI)</span></CodeLine>
<Link id="l08467" /><CodeLine lineNumber="8467"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08468" /><CodeLine lineNumber="8468"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if Usr is an Instruction. If not, give up.</span></CodeLine>
<Link id="l08469" /><CodeLine lineNumber="8469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Usr))</span></CodeLine>
<Link id="l08470" /><CodeLine lineNumber="8470"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08471" /><CodeLine lineNumber="8471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Usr);</span></CodeLine>
<Link id="l08472" /><CodeLine lineNumber="8472"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if Usr in the same block as GEPIOp, which is fine, skip.</span></CodeLine>
<Link id="l08473" /><CodeLine lineNumber="8473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == SrcBlock)</span></CodeLine>
<Link id="l08474" /><CodeLine lineNumber="8474"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08475" /><CodeLine lineNumber="8475"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if Usr is a GEP. If not, give up.</span></CodeLine>
<Link id="l08476" /><CodeLine lineNumber="8476"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(Usr))</span></CodeLine>
<Link id="l08477" /><CodeLine lineNumber="8477"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08478" /><CodeLine lineNumber="8478"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UGEPI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(Usr);</span></CodeLine>
<Link id="l08479" /><CodeLine lineNumber="8479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if UGEPI is a simple gep with a single constant index and GEPIOp is</span></CodeLine>
<Link id="l08480" /><CodeLine lineNumber="8480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the pointer operand to it. If so, record it in the vector. If not, give</span></CodeLine>
<Link id="l08481" /><CodeLine lineNumber="8481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// up.</span></CodeLine>
<Link id="l08482" /><CodeLine lineNumber="8482"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(UGEPI))</span></CodeLine>
<Link id="l08483" /><CodeLine lineNumber="8483"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08484" /><CodeLine lineNumber="8484"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UGEPI-&gt;getOperand(0) != GEPIOp)</span></CodeLine>
<Link id="l08485" /><CodeLine lineNumber="8485"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08486" /><CodeLine lineNumber="8486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UGEPI-&gt;getSourceElementType() != GEPI-&gt;getSourceElementType())</span></CodeLine>
<Link id="l08487" /><CodeLine lineNumber="8487"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08488" /><CodeLine lineNumber="8488"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GEPIIdx-&gt;getType() !=</span></CodeLine>
<Link id="l08489" /><CodeLine lineNumber="8489"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1))-&gt;getType())</span></CodeLine>
<Link id="l08490" /><CodeLine lineNumber="8490"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08491" /><CodeLine lineNumber="8491"><span class="doxyHighlight">    ConstantInt &#42;UGEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1));</span></CodeLine>
<Link id="l08492" /><CodeLine lineNumber="8492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;<a href="/docs/api/classes/llvm/targettransforminfo/#a8f708e28c4cf4fcdbbe363849b779a00">getIntImmCost</a>(UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>(), UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l08493" /><CodeLine lineNumber="8493"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>) &gt;</span></CodeLine>
<Link id="l08494" /><CodeLine lineNumber="8494"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</span></CodeLine>
<Link id="l08495" /><CodeLine lineNumber="8495"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08496" /><CodeLine lineNumber="8496"><span class="doxyHighlight">    UGEPIs.push&#95;back(UGEPI);</span></CodeLine>
<Link id="l08497" /><CodeLine lineNumber="8497"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08498" /><CodeLine lineNumber="8498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UGEPIs.size() == 0)</span></CodeLine>
<Link id="l08499" /><CodeLine lineNumber="8499"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08500" /><CodeLine lineNumber="8500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check the materializing cost of (Uidx-Idx).</span></CodeLine>
<Link id="l08501" /><CodeLine lineNumber="8501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (GetElementPtrInst &#42;UGEPI : UGEPIs) &#123;</span></CodeLine>
<Link id="l08502" /><CodeLine lineNumber="8502"><span class="doxyHighlight">    ConstantInt &#42;UGEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1));</span></CodeLine>
<Link id="l08503" /><CodeLine lineNumber="8503"><span class="doxyHighlight">    APInt NewIdx = UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() - GEPIIdx-&gt;getValue();</span></CodeLine>
<Link id="l08504" /><CodeLine lineNumber="8504"><span class="doxyHighlight">    InstructionCost ImmCost = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;<a href="/docs/api/classes/llvm/targettransforminfo/#a8f708e28c4cf4fcdbbe363849b779a00">getIntImmCost</a>(</span></CodeLine>
<Link id="l08505" /><CodeLine lineNumber="8505"><span class="doxyHighlight">        NewIdx, GEPIIdx-&gt;getType(), <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>);</span></CodeLine>
<Link id="l08506" /><CodeLine lineNumber="8506"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ImmCost &gt; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</span></CodeLine>
<Link id="l08507" /><CodeLine lineNumber="8507"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08508" /><CodeLine lineNumber="8508"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08509" /><CodeLine lineNumber="8509"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now unmerge between GEPI and UGEPIs.</span></CodeLine>
<Link id="l08510" /><CodeLine lineNumber="8510"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (GetElementPtrInst &#42;UGEPI : UGEPIs) &#123;</span></CodeLine>
<Link id="l08511" /><CodeLine lineNumber="8511"><span class="doxyHighlight">    UGEPI-&gt;setOperand(0, GEPI);</span></CodeLine>
<Link id="l08512" /><CodeLine lineNumber="8512"><span class="doxyHighlight">    ConstantInt &#42;UGEPIIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UGEPI-&gt;getOperand(1));</span></CodeLine>
<Link id="l08513" /><CodeLine lineNumber="8513"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;NewUGEPIIdx = ConstantInt::get(</span></CodeLine>
<Link id="l08514" /><CodeLine lineNumber="8514"><span class="doxyHighlight">        GEPIIdx-&gt;getType(), UGEPIIdx-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() - GEPIIdx-&gt;getValue());</span></CodeLine>
<Link id="l08515" /><CodeLine lineNumber="8515"><span class="doxyHighlight">    UGEPI-&gt;setOperand(1, NewUGEPIIdx);</span></CodeLine>
<Link id="l08516" /><CodeLine lineNumber="8516"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If GEPI is not inbounds but UGEPI is inbounds, change UGEPI to not</span></CodeLine>
<Link id="l08517" /><CodeLine lineNumber="8517"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// inbounds to avoid UB.</span></CodeLine>
<Link id="l08518" /><CodeLine lineNumber="8518"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GEPI-&gt;isInBounds()) &#123;</span></CodeLine>
<Link id="l08519" /><CodeLine lineNumber="8519"><span class="doxyHighlight">      UGEPI-&gt;setIsInBounds(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08520" /><CodeLine lineNumber="8520"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08521" /><CodeLine lineNumber="8521"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08522" /><CodeLine lineNumber="8522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After unmerging, verify that GEPIOp is actually only used in SrcBlock (not</span></CodeLine>
<Link id="l08523" /><CodeLine lineNumber="8523"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// alive on IndirectBr edges).</span></CodeLine>
<Link id="l08524" /><CodeLine lineNumber="8524"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none&#95;of</a>(GEPIOp-&gt;users(),</span></CodeLine>
<Link id="l08525" /><CodeLine lineNumber="8525"><span class="doxyHighlight">                       &#91;&amp;&#93;(User &#42;Usr) &#123;</span></CodeLine>
<Link id="l08526" /><CodeLine lineNumber="8526"><span class="doxyHighlight">                         return cast&lt;Instruction&gt;(Usr)-&gt;getParent() != SrcBlock;</span></CodeLine>
<Link id="l08527" /><CodeLine lineNumber="8527"><span class="doxyHighlight">                       &#125;) &amp;&amp;</span></CodeLine>
<Link id="l08528" /><CodeLine lineNumber="8528"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;GEPIOp is used outside SrcBlock&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08529" /><CodeLine lineNumber="8529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08530" /><CodeLine lineNumber="8530"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08531" /><CodeLine lineNumber="8531"></CodeLine>
<Link id="l08532" /><CodeLine lineNumber="8532" lineLink="#ad2bfc3e2f7b1661868517e662ac7496c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;Branch, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlowering">TargetLowering</a> &amp;TLI,</span></CodeLine>
<Link id="l08533" /><CodeLine lineNumber="8533"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 32&gt;</a> &amp;FreshBBs,</span></CodeLine>
<Link id="l08534" /><CodeLine lineNumber="8534"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsHugeFunc) &#123;</span></CodeLine>
<Link id="l08535" /><CodeLine lineNumber="8535"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try and convert</span></CodeLine>
<Link id="l08536" /><CodeLine lineNumber="8536"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %c = icmp ult %x, 8</span></CodeLine>
<Link id="l08537" /><CodeLine lineNumber="8537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  br %c, bla, blb</span></CodeLine>
<Link id="l08538" /><CodeLine lineNumber="8538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %tc = lshr %x, 3</span></CodeLine>
<Link id="l08539" /><CodeLine lineNumber="8539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to</span></CodeLine>
<Link id="l08540" /><CodeLine lineNumber="8540"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %tc = lshr %x, 3</span></CodeLine>
<Link id="l08541" /><CodeLine lineNumber="8541"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %c = icmp eq %tc, 0</span></CodeLine>
<Link id="l08542" /><CodeLine lineNumber="8542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  br %c, bla, blb</span></CodeLine>
<Link id="l08543" /><CodeLine lineNumber="8543"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Creating the cmp to zero can be better for the backend, especially if the</span></CodeLine>
<Link id="l08544" /><CodeLine lineNumber="8544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lshr produces flags that can be used automatically.</span></CodeLine>
<Link id="l08545" /><CodeLine lineNumber="8545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TLI.<a href="/docs/api/classes/llvm/targetloweringbase/#af7763c45db027300e49b43037e5a1a60">preferZeroCompareBranch</a>() || !Branch-&gt;isConditional())</span></CodeLine>
<Link id="l08546" /><CodeLine lineNumber="8546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08547" /><CodeLine lineNumber="8547"></CodeLine>
<Link id="l08548" /><CodeLine lineNumber="8548"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(Branch-&gt;getCondition());</span></CodeLine>
<Link id="l08549" /><CodeLine lineNumber="8549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cmp || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Cmp-&gt;getOperand(1)) || !Cmp-&gt;hasOneUse())</span></CodeLine>
<Link id="l08550" /><CodeLine lineNumber="8550"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08551" /><CodeLine lineNumber="8551"></CodeLine>
<Link id="l08552" /><CodeLine lineNumber="8552"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Cmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l08553" /><CodeLine lineNumber="8553"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> CmpC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(Cmp-&gt;getOperand(1))-&gt;getValue();</span></CodeLine>
<Link id="l08554" /><CodeLine lineNumber="8554"></CodeLine>
<Link id="l08555" /><CodeLine lineNumber="8555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l08556" /><CodeLine lineNumber="8556"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l08557" /><CodeLine lineNumber="8557"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A quick dominance check</span></CodeLine>
<Link id="l08558" /><CodeLine lineNumber="8558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UI ||</span></CodeLine>
<Link id="l08559" /><CodeLine lineNumber="8559"><span class="doxyHighlight">        (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent() &amp;&amp;</span></CodeLine>
<Link id="l08560" /><CodeLine lineNumber="8560"><span class="doxyHighlight">         UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getSuccessor(0) &amp;&amp;</span></CodeLine>
<Link id="l08561" /><CodeLine lineNumber="8561"><span class="doxyHighlight">         UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getSuccessor(1)) ||</span></CodeLine>
<Link id="l08562" /><CodeLine lineNumber="8562"><span class="doxyHighlight">        (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent() &amp;&amp;</span></CodeLine>
<Link id="l08563" /><CodeLine lineNumber="8563"><span class="doxyHighlight">         !UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getSinglePredecessor()))</span></CodeLine>
<Link id="l08564" /><CodeLine lineNumber="8564"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08565" /><CodeLine lineNumber="8565"></CodeLine>
<Link id="l08566" /><CodeLine lineNumber="8566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CmpC.<a href="/docs/api/classes/llvm/apint/#ad1b0513de876d1c85cf6268ca21b2c86">isPowerOf2</a>() &amp;&amp; Cmp-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a> &amp;&amp;</span></CodeLine>
<Link id="l08567" /><CodeLine lineNumber="8567"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a href="/docs/api/namespaces/llvm/patternmatch/#a310fbeb4d6c1b137dfd8713d354f3d76">m&#95;Shr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(CmpC.<a href="/docs/api/classes/llvm/apint/#aae3b959a0a2981340fd03c29f528f2f0">logBase2</a>())))) &#123;</span></CodeLine>
<Link id="l08568" /><CodeLine lineNumber="8568"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Branch);</span></CodeLine>
<Link id="l08569" /><CodeLine lineNumber="8569"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent())</span></CodeLine>
<Link id="l08570" /><CodeLine lineNumber="8570"><span class="doxyHighlight">        UI-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(Branch-&gt;getIterator());</span></CodeLine>
<Link id="l08571" /><CodeLine lineNumber="8571"><span class="doxyHighlight">      UI-&gt;<a href="/docs/api/classes/llvm/instruction/#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</span></CodeLine>
<Link id="l08572" /><CodeLine lineNumber="8572"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a843d43d070f0b1c6a133403edce488ef">CreateCmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, UI,</span></CodeLine>
<Link id="l08573" /><CodeLine lineNumber="8573"><span class="doxyHighlight">                                        ConstantInt::get(UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0));</span></CodeLine>
<Link id="l08574" /><CodeLine lineNumber="8574"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Converting &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Cmp &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08575" /><CodeLine lineNumber="8575"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to compare on zero: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewCmp &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08576" /><CodeLine lineNumber="8576"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, NewCmp, FreshBBs, IsHugeFunc);</span></CodeLine>
<Link id="l08577" /><CodeLine lineNumber="8577"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08578" /><CodeLine lineNumber="8578"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08579" /><CodeLine lineNumber="8579"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp-&gt;isEquality() &amp;&amp;</span></CodeLine>
<Link id="l08580" /><CodeLine lineNumber="8580"><span class="doxyHighlight">        (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(-CmpC))) ||</span></CodeLine>
<Link id="l08581" /><CodeLine lineNumber="8581"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(CmpC))))) &#123;</span></CodeLine>
<Link id="l08582" /><CodeLine lineNumber="8582"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Branch);</span></CodeLine>
<Link id="l08583" /><CodeLine lineNumber="8583"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Branch-&gt;getParent())</span></CodeLine>
<Link id="l08584" /><CodeLine lineNumber="8584"><span class="doxyHighlight">        UI-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(Branch-&gt;getIterator());</span></CodeLine>
<Link id="l08585" /><CodeLine lineNumber="8585"><span class="doxyHighlight">      UI-&gt;<a href="/docs/api/classes/llvm/instruction/#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</span></CodeLine>
<Link id="l08586" /><CodeLine lineNumber="8586"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a843d43d070f0b1c6a133403edce488ef">CreateCmp</a>(Cmp-&gt;getPredicate(), UI,</span></CodeLine>
<Link id="l08587" /><CodeLine lineNumber="8587"><span class="doxyHighlight">                                        ConstantInt::get(UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0));</span></CodeLine>
<Link id="l08588" /><CodeLine lineNumber="8588"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Converting &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Cmp &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08589" /><CodeLine lineNumber="8589"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to compare on zero: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewCmp &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08590" /><CodeLine lineNumber="8590"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, NewCmp, FreshBBs, IsHugeFunc);</span></CodeLine>
<Link id="l08591" /><CodeLine lineNumber="8591"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08592" /><CodeLine lineNumber="8592"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08593" /><CodeLine lineNumber="8593"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08594" /><CodeLine lineNumber="8594"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08595" /><CodeLine lineNumber="8595"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08596" /><CodeLine lineNumber="8596"></CodeLine>
<Link id="l08597" /><CodeLine lineNumber="8597"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeInst(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l08598" /><CodeLine lineNumber="8598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08599" /><CodeLine lineNumber="8599"><span class="doxyHighlight">  AnyChange = fixupDbgVariableRecordsOnInst(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08600" /><CodeLine lineNumber="8600"></CodeLine>
<Link id="l08601" /><CodeLine lineNumber="8601"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bail out if we inserted the instruction to prevent optimizations from</span></CodeLine>
<Link id="l08602" /><CodeLine lineNumber="8602"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stepping on each other&#39;s toes.</span></CodeLine>
<Link id="l08603" /><CodeLine lineNumber="8603"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InsertedInsts.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08604" /><CodeLine lineNumber="8604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08605" /><CodeLine lineNumber="8605"></CodeLine>
<Link id="l08606" /><CodeLine lineNumber="8606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Move into the switch on opcode below here.</span></CodeLine>
<Link id="l08607" /><CodeLine lineNumber="8607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHINode &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08608" /><CodeLine lineNumber="8608"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It is possible for very late stage optimizations (such as SimplifyCFG)</span></CodeLine>
<Link id="l08609" /><CodeLine lineNumber="8609"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to introduce PHI nodes too late to be cleaned up.  If we detect such a</span></CodeLine>
<Link id="l08610" /><CodeLine lineNumber="8610"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trivial PHI, go ahead and zap it here.</span></CodeLine>
<Link id="l08611" /><CodeLine lineNumber="8611"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, &#123;&#42;DL, TLInfo&#125;)) &#123;</span></CodeLine>
<Link id="l08612" /><CodeLine lineNumber="8612"><span class="doxyHighlight">      LargeOffsetGEPMap.erase(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l08613" /><CodeLine lineNumber="8613"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, V, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l08614" /><CodeLine lineNumber="8614"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l08615" /><CodeLine lineNumber="8615"><span class="doxyHighlight">      ++NumPHIsElim;</span></CodeLine>
<Link id="l08616" /><CodeLine lineNumber="8616"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08617" /><CodeLine lineNumber="8617"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08618" /><CodeLine lineNumber="8618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08619" /><CodeLine lineNumber="8619"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08620" /><CodeLine lineNumber="8620"></CodeLine>
<Link id="l08621" /><CodeLine lineNumber="8621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CastInst &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08622" /><CodeLine lineNumber="8622"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the source of the cast is a constant, then this should have</span></CodeLine>
<Link id="l08623" /><CodeLine lineNumber="8623"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// already been constant folded.  The only reason NOT to constant fold</span></CodeLine>
<Link id="l08624" /><CodeLine lineNumber="8624"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it is if something (e.g. LSR) was careful to place the constant</span></CodeLine>
<Link id="l08625" /><CodeLine lineNumber="8625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// evaluation in a block other than then one that uses it (e.g. to hoist</span></CodeLine>
<Link id="l08626" /><CodeLine lineNumber="8626"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the address of globals out of a loop).  If this is the case, we don&#39;t</span></CodeLine>
<Link id="l08627" /><CodeLine lineNumber="8627"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// want to forward-subst the cast.</span></CodeLine>
<Link id="l08628" /><CodeLine lineNumber="8628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l08629" /><CodeLine lineNumber="8629"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08630" /><CodeLine lineNumber="8630"></CodeLine>
<Link id="l08631" /><CodeLine lineNumber="8631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a>(CI, &#42;TLI, &#42;DL))</span></CodeLine>
<Link id="l08632" /><CodeLine lineNumber="8632"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08633" /><CodeLine lineNumber="8633"></CodeLine>
<Link id="l08634" /><CodeLine lineNumber="8634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UIToFPInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SIToFPInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPToUIInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l08635" /><CodeLine lineNumber="8635"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l08636" /><CodeLine lineNumber="8636"><span class="doxyHighlight">        TLI-&gt;optimizeExtendOrTruncateConversion(</span></CodeLine>
<Link id="l08637" /><CodeLine lineNumber="8637"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LI-&gt;getLoopFor(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), &#42;TTI))</span></CodeLine>
<Link id="l08638" /><CodeLine lineNumber="8638"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08639" /><CodeLine lineNumber="8639"></CodeLine>
<Link id="l08640" /><CodeLine lineNumber="8640"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08641" /><CodeLine lineNumber="8641"><span class="doxyHighlightComment">      /// Sink a zext or sext into its user blocks if the target type doesn&#39;t</span></CodeLine>
<Link id="l08642" /><CodeLine lineNumber="8642"><span class="doxyHighlightComment">      /// fit in one register</span></CodeLine>
<Link id="l08643" /><CodeLine lineNumber="8643"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI-&gt;getTypeAction(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(),</span></CodeLine>
<Link id="l08644" /><CodeLine lineNumber="8644"><span class="doxyHighlight">                             TLI-&gt;getValueType(&#42;DL, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) ==</span></CodeLine>
<Link id="l08645" /><CodeLine lineNumber="8645"><span class="doxyHighlight">          TargetLowering::TypeExpandInteger) &#123;</span></CodeLine>
<Link id="l08646" /><CodeLine lineNumber="8646"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(CI);</span></CodeLine>
<Link id="l08647" /><CodeLine lineNumber="8647"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08648" /><CodeLine lineNumber="8648"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI-&gt;optimizeExtendOrTruncateConversion(</span></CodeLine>
<Link id="l08649" /><CodeLine lineNumber="8649"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LI-&gt;getLoopFor(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), &#42;TTI))</span></CodeLine>
<Link id="l08650" /><CodeLine lineNumber="8650"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08651" /><CodeLine lineNumber="8651"></CodeLine>
<Link id="l08652" /><CodeLine lineNumber="8652"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = optimizeExt(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08653" /><CodeLine lineNumber="8653"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange | optimizeExtUses(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08654" /><CodeLine lineNumber="8654"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08655" /><CodeLine lineNumber="8655"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08656" /><CodeLine lineNumber="8656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08657" /><CodeLine lineNumber="8657"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08658" /><CodeLine lineNumber="8658"></CodeLine>
<Link id="l08659" /><CodeLine lineNumber="8659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08660" /><CodeLine lineNumber="8660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (optimizeCmp(Cmp, ModifiedDT))</span></CodeLine>
<Link id="l08661" /><CodeLine lineNumber="8661"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08662" /><CodeLine lineNumber="8662"></CodeLine>
<Link id="l08663" /><CodeLine lineNumber="8663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a11e5bad6c60d5c3cc5e7881bddd0204d">m&#95;URem</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</span></CodeLine>
<Link id="l08664" /><CodeLine lineNumber="8664"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (optimizeURem(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08665" /><CodeLine lineNumber="8665"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08666" /><CodeLine lineNumber="8666"></CodeLine>
<Link id="l08667" /><CodeLine lineNumber="8667"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadInst &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08668" /><CodeLine lineNumber="8668"><span class="doxyHighlight">    LI-&gt;setMetadata(LLVMContext::MD&#95;invariant&#95;group, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08669" /><CodeLine lineNumber="8669"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = optimizeLoadExt(LI);</span></CodeLine>
<Link id="l08670" /><CodeLine lineNumber="8670"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = LI-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l08671" /><CodeLine lineNumber="8671"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), LI-&gt;getType(), AS);</span></CodeLine>
<Link id="l08672" /><CodeLine lineNumber="8672"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l08673" /><CodeLine lineNumber="8673"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08674" /><CodeLine lineNumber="8674"></CodeLine>
<Link id="l08675" /><CodeLine lineNumber="8675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreInst &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08676" /><CodeLine lineNumber="8676"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a>(&#42;SI, &#42;DL, &#42;TLI))</span></CodeLine>
<Link id="l08677" /><CodeLine lineNumber="8677"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08678" /><CodeLine lineNumber="8678"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;setMetadata(LLVMContext::MD&#95;invariant&#95;group, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08679" /><CodeLine lineNumber="8679"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l08680" /><CodeLine lineNumber="8680"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperand(1),</span></CodeLine>
<Link id="l08681" /><CodeLine lineNumber="8681"><span class="doxyHighlight">                              <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperand(0)-&gt;getType(), AS);</span></CodeLine>
<Link id="l08682" /><CodeLine lineNumber="8682"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08683" /><CodeLine lineNumber="8683"></CodeLine>
<Link id="l08684" /><CodeLine lineNumber="8684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AtomicRMWInst &#42;RMW = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicRMWInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08685" /><CodeLine lineNumber="8685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = RMW-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l08686" /><CodeLine lineNumber="8686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, RMW-&gt;getPointerOperand(), RMW-&gt;getType(), AS);</span></CodeLine>
<Link id="l08687" /><CodeLine lineNumber="8687"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08688" /><CodeLine lineNumber="8688"></CodeLine>
<Link id="l08689" /><CodeLine lineNumber="8689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AtomicCmpXchgInst &#42;CmpX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicCmpXchgInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08690" /><CodeLine lineNumber="8690"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = CmpX-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l08691" /><CodeLine lineNumber="8691"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeMemoryInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CmpX-&gt;getPointerOperand(),</span></CodeLine>
<Link id="l08692" /><CodeLine lineNumber="8692"><span class="doxyHighlight">                              CmpX-&gt;getCompareOperand()-&gt;getType(), AS);</span></CodeLine>
<Link id="l08693" /><CodeLine lineNumber="8693"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08694" /><CodeLine lineNumber="8694"></CodeLine>
<Link id="l08695" /><CodeLine lineNumber="8695"><span class="doxyHighlight">  BinaryOperator &#42;BinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08696" /><CodeLine lineNumber="8696"></CodeLine>
<Link id="l08697" /><CodeLine lineNumber="8697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BinOp &amp;&amp; BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::And &amp;&amp; <a href="#add2019bfb348f5241b4110eb77775410">EnableAndCmpSinking</a> &amp;&amp;</span></CodeLine>
<Link id="l08698" /><CodeLine lineNumber="8698"><span class="doxyHighlight">      <a href="#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a>(BinOp, &#42;TLI, InsertedInsts))</span></CodeLine>
<Link id="l08699" /><CodeLine lineNumber="8699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08700" /><CodeLine lineNumber="8700"></CodeLine>
<Link id="l08701" /><CodeLine lineNumber="8701"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Move this into the switch on opcode - it handles shifts already.</span></CodeLine>
<Link id="l08702" /><CodeLine lineNumber="8702"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BinOp &amp;&amp; (BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr ||</span></CodeLine>
<Link id="l08703" /><CodeLine lineNumber="8703"><span class="doxyHighlight">                BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::LShr)) &#123;</span></CodeLine>
<Link id="l08704" /><CodeLine lineNumber="8704"><span class="doxyHighlight">    ConstantInt &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(BinOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l08705" /><CodeLine lineNumber="8705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI &amp;&amp; TLI-&gt;hasExtractBitsInsn())</span></CodeLine>
<Link id="l08706" /><CodeLine lineNumber="8706"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a>(BinOp, CI, &#42;TLI, &#42;DL))</span></CodeLine>
<Link id="l08707" /><CodeLine lineNumber="8707"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08708" /><CodeLine lineNumber="8708"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08709" /><CodeLine lineNumber="8709"></CodeLine>
<Link id="l08710" /><CodeLine lineNumber="8710"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GetElementPtrInst &#42;GEPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08711" /><CodeLine lineNumber="8711"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GEPI-&gt;hasAllZeroIndices()) &#123;</span></CodeLine>
<Link id="l08712" /><CodeLine lineNumber="8712"><span class="doxyHighlightComment">      /// The GEP operand must be a pointer, so must its result -&gt; BitCast</span></CodeLine>
<Link id="l08713" /><CodeLine lineNumber="8713"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> BitCastInst(GEPI-&gt;getOperand(0), GEPI-&gt;getType(),</span></CodeLine>
<Link id="l08714" /><CodeLine lineNumber="8714"><span class="doxyHighlight">                                        GEPI-&gt;getName(), GEPI-&gt;getIterator());</span></CodeLine>
<Link id="l08715" /><CodeLine lineNumber="8715"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a>-&gt;setDebugLoc(GEPI-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08716" /><CodeLine lineNumber="8716"><span class="doxyHighlight">      <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(GEPI, <a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l08717" /><CodeLine lineNumber="8717"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</span></CodeLine>
<Link id="l08718" /><CodeLine lineNumber="8718"><span class="doxyHighlight">          GEPI, TLInfo, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l08719" /><CodeLine lineNumber="8719"><span class="doxyHighlight">          &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</span></CodeLine>
<Link id="l08720" /><CodeLine lineNumber="8720"><span class="doxyHighlight">      ++NumGEPsElim;</span></CodeLine>
<Link id="l08721" /><CodeLine lineNumber="8721"><span class="doxyHighlight">      optimizeInst(<a href="/docs/api/files/lib/lib/support/regutils-h/#a1fa2460e32327ade49189c95740bc1b5">NC</a>, ModifiedDT);</span></CodeLine>
<Link id="l08722" /><CodeLine lineNumber="8722"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08723" /><CodeLine lineNumber="8723"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08724" /><CodeLine lineNumber="8724"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a>(GEPI, TTI)) &#123;</span></CodeLine>
<Link id="l08725" /><CodeLine lineNumber="8725"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08726" /><CodeLine lineNumber="8726"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08727" /><CodeLine lineNumber="8727"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08728" /><CodeLine lineNumber="8728"></CodeLine>
<Link id="l08729" /><CodeLine lineNumber="8729"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FreezeInst &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FreezeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08730" /><CodeLine lineNumber="8730"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// freeze(icmp a, const)) -&gt; icmp (freeze a), const</span></CodeLine>
<Link id="l08731" /><CodeLine lineNumber="8731"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This helps generate efficient conditional jumps.</span></CodeLine>
<Link id="l08732" /><CodeLine lineNumber="8732"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CmpI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08733" /><CodeLine lineNumber="8733"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICmpInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(FI-&gt;getOperand(0)))</span></CodeLine>
<Link id="l08734" /><CodeLine lineNumber="8734"><span class="doxyHighlight">      CmpI = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>;</span></CodeLine>
<Link id="l08735" /><CodeLine lineNumber="8735"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FCmpInst &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FCmpInst&gt;</a>(FI-&gt;getOperand(0)))</span></CodeLine>
<Link id="l08736" /><CodeLine lineNumber="8736"><span class="doxyHighlight">      CmpI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>().<a href="/docs/api/classes/llvm/fastmathflags/#a3c72e480015b1ffdcd0382fa46437806">none</a>() ? <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08737" /><CodeLine lineNumber="8737"></CodeLine>
<Link id="l08738" /><CodeLine lineNumber="8738"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CmpI &amp;&amp; CmpI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l08739" /><CodeLine lineNumber="8739"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Op0 = CmpI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Op1 = CmpI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l08740" /><CodeLine lineNumber="8740"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Const0 = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Op0) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Op0) ||</span></CodeLine>
<Link id="l08741" /><CodeLine lineNumber="8741"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(Op0);</span></CodeLine>
<Link id="l08742" /><CodeLine lineNumber="8742"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Const1 = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Op1) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(Op1) ||</span></CodeLine>
<Link id="l08743" /><CodeLine lineNumber="8743"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(Op1);</span></CodeLine>
<Link id="l08744" /><CodeLine lineNumber="8744"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Const0 || Const1) &#123;</span></CodeLine>
<Link id="l08745" /><CodeLine lineNumber="8745"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Const0 || !Const1) &#123;</span></CodeLine>
<Link id="l08746" /><CodeLine lineNumber="8746"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> FreezeInst(Const0 ? Op1 : Op0, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, CmpI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l08747" /><CodeLine lineNumber="8747"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;takeName(FI);</span></CodeLine>
<Link id="l08748" /><CodeLine lineNumber="8748"><span class="doxyHighlight">          CmpI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Const0 ? 1 : 0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l08749" /><CodeLine lineNumber="8749"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l08750" /><CodeLine lineNumber="8750"><span class="doxyHighlight">        <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(FI, CmpI, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l08751" /><CodeLine lineNumber="8751"><span class="doxyHighlight">        FI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l08752" /><CodeLine lineNumber="8752"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08753" /><CodeLine lineNumber="8753"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08754" /><CodeLine lineNumber="8754"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08755" /><CodeLine lineNumber="8755"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08756" /><CodeLine lineNumber="8756"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08757" /><CodeLine lineNumber="8757"></CodeLine>
<Link id="l08758" /><CodeLine lineNumber="8758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (tryToSinkFreeOperands(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08759" /><CodeLine lineNumber="8759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08760" /><CodeLine lineNumber="8760"></CodeLine>
<Link id="l08761" /><CodeLine lineNumber="8761"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l08762" /><CodeLine lineNumber="8762"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl:</span></CodeLine>
<Link id="l08763" /><CodeLine lineNumber="8763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr:</span></CodeLine>
<Link id="l08764" /><CodeLine lineNumber="8764"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AShr:</span></CodeLine>
<Link id="l08765" /><CodeLine lineNumber="8765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeShiftInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l08766" /><CodeLine lineNumber="8766"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Call:</span></CodeLine>
<Link id="l08767" /><CodeLine lineNumber="8767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeCallInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), ModifiedDT);</span></CodeLine>
<Link id="l08768" /><CodeLine lineNumber="8768"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Select:</span></CodeLine>
<Link id="l08769" /><CodeLine lineNumber="8769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeSelectInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l08770" /><CodeLine lineNumber="8770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ShuffleVector:</span></CodeLine>
<Link id="l08771" /><CodeLine lineNumber="8771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeShuffleVectorInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l08772" /><CodeLine lineNumber="8772"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Switch:</span></CodeLine>
<Link id="l08773" /><CodeLine lineNumber="8773"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeSwitchInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l08774" /><CodeLine lineNumber="8774"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ExtractElement:</span></CodeLine>
<Link id="l08775" /><CodeLine lineNumber="8775"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> optimizeExtractElementInst(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ExtractElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l08776" /><CodeLine lineNumber="8776"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Br:</span></CodeLine>
<Link id="l08777" /><CodeLine lineNumber="8777"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), &#42;TLI, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l08778" /><CodeLine lineNumber="8778"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08779" /><CodeLine lineNumber="8779"></CodeLine>
<Link id="l08780" /><CodeLine lineNumber="8780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08781" /><CodeLine lineNumber="8781"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08782" /><CodeLine lineNumber="8782"></CodeLine>
<Link id="l08783" /><CodeLine lineNumber="8783"><span class="doxyHighlightComment">/// Given an OR instruction, check to see if this is a bitreverse</span></CodeLine>
<Link id="l08784" /><CodeLine lineNumber="8784"><span class="doxyHighlightComment">/// idiom. If so, insert the new intrinsic and return true.</span></CodeLine>
<Link id="l08785" /><CodeLine lineNumber="8785"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::makeBitReverse(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08786" /><CodeLine lineNumber="8786"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isIntegerTy() ||</span></CodeLine>
<Link id="l08787" /><CodeLine lineNumber="8787"><span class="doxyHighlight">      !TLI-&gt;isOperationLegalOrCustom(<a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aeea401cc0b7fa5aa6f4d3a0612140e1d">ISD::BITREVERSE</a>,</span></CodeLine>
<Link id="l08788" /><CodeLine lineNumber="8788"><span class="doxyHighlight">                                     TLI-&gt;getValueType(&#42;DL, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)))</span></CodeLine>
<Link id="l08789" /><CodeLine lineNumber="8789"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08790" /><CodeLine lineNumber="8790"></CodeLine>
<Link id="l08791" /><CodeLine lineNumber="8791"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 4&gt; Insts;</span></CodeLine>
<Link id="l08792" /><CodeLine lineNumber="8792"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a6c402f49fa595af618c5ad1500565d92">recognizeBSwapOrBitReverseIdiom</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, Insts))</span></CodeLine>
<Link id="l08793" /><CodeLine lineNumber="8793"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08794" /><CodeLine lineNumber="8794"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;LastInst = Insts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>();</span></CodeLine>
<Link id="l08795" /><CodeLine lineNumber="8795"><span class="doxyHighlight">  <a href="#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LastInst, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>, <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>);</span></CodeLine>
<Link id="l08796" /><CodeLine lineNumber="8796"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</span></CodeLine>
<Link id="l08797" /><CodeLine lineNumber="8797"><span class="doxyHighlight">      &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLInfo, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l08798" /><CodeLine lineNumber="8798"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; removeAllAssertingVHReferences(V); &#125;);</span></CodeLine>
<Link id="l08799" /><CodeLine lineNumber="8799"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08800" /><CodeLine lineNumber="8800"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08801" /><CodeLine lineNumber="8801"></CodeLine>
<Link id="l08802" /><CodeLine lineNumber="8802"><span class="doxyHighlightComment">// In this pass we look for GEP and cast instructions that are used</span></CodeLine>
<Link id="l08803" /><CodeLine lineNumber="8803"><span class="doxyHighlightComment">// across basic blocks and rewrite them to improve basic-block-at-a-time</span></CodeLine>
<Link id="l08804" /><CodeLine lineNumber="8804"><span class="doxyHighlightComment">// selection.</span></CodeLine>
<Link id="l08805" /><CodeLine lineNumber="8805"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::optimizeBlock(BasicBlock &amp;BB, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l08806" /><CodeLine lineNumber="8806"><span class="doxyHighlight">  SunkAddrs.clear();</span></CodeLine>
<Link id="l08807" /><CodeLine lineNumber="8807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08808" /><CodeLine lineNumber="8808"></CodeLine>
<Link id="l08809" /><CodeLine lineNumber="8809"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08810" /><CodeLine lineNumber="8810"><span class="doxyHighlight">    CurInstIterator = BB.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l08811" /><CodeLine lineNumber="8811"><span class="doxyHighlight">    ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>;</span></CodeLine>
<Link id="l08812" /><CodeLine lineNumber="8812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CurInstIterator != BB.<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()) &#123;</span></CodeLine>
<Link id="l08813" /><CodeLine lineNumber="8813"><span class="doxyHighlight">      MadeChange |= optimizeInst(&amp;&#42;CurInstIterator++, ModifiedDT);</span></CodeLine>
<Link id="l08814" /><CodeLine lineNumber="8814"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ModifiedDT != <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a95487ae56c1c498fdf777f54386c0bc1">ModifyDT::NotModifyDT</a>) &#123;</span></CodeLine>
<Link id="l08815" /><CodeLine lineNumber="8815"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For huge function we tend to quickly go though the inner optmization</span></CodeLine>
<Link id="l08816" /><CodeLine lineNumber="8816"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// opportunities in the BB. So we go back to the BB head to re-optimize</span></CodeLine>
<Link id="l08817" /><CodeLine lineNumber="8817"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// each instruction instead of go back to the function head.</span></CodeLine>
<Link id="l08818" /><CodeLine lineNumber="8818"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>) &#123;</span></CodeLine>
<Link id="l08819" /><CodeLine lineNumber="8819"><span class="doxyHighlight">          DT.reset();</span></CodeLine>
<Link id="l08820" /><CodeLine lineNumber="8820"><span class="doxyHighlight">          getDT(&#42;BB.<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l08821" /><CodeLine lineNumber="8821"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08822" /><CodeLine lineNumber="8822"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08823" /><CodeLine lineNumber="8823"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08824" /><CodeLine lineNumber="8824"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l08825" /><CodeLine lineNumber="8825"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08826" /><CodeLine lineNumber="8826"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08827" /><CodeLine lineNumber="8827"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (ModifiedDT == <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379a7804f8c0fbb1f0b689782c8795c7d6c2">ModifyDT::ModifyInstDT</a>);</span></CodeLine>
<Link id="l08828" /><CodeLine lineNumber="8828"></CodeLine>
<Link id="l08829" /><CodeLine lineNumber="8829"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeBitReverse = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08830" /><CodeLine lineNumber="8830"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (MadeBitReverse) &#123;</span></CodeLine>
<Link id="l08831" /><CodeLine lineNumber="8831"><span class="doxyHighlight">    MadeBitReverse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08832" /><CodeLine lineNumber="8832"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(BB)) &#123;</span></CodeLine>
<Link id="l08833" /><CodeLine lineNumber="8833"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (makeBitReverse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08834" /><CodeLine lineNumber="8834"><span class="doxyHighlight">        MadeBitReverse = MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08835" /><CodeLine lineNumber="8835"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08836" /><CodeLine lineNumber="8836"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08837" /><CodeLine lineNumber="8837"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08838" /><CodeLine lineNumber="8838"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08839" /><CodeLine lineNumber="8839"><span class="doxyHighlight">  MadeChange |= dupRetToEnableTailCallOpts(&amp;BB, ModifiedDT);</span></CodeLine>
<Link id="l08840" /><CodeLine lineNumber="8840"></CodeLine>
<Link id="l08841" /><CodeLine lineNumber="8841"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l08842" /><CodeLine lineNumber="8842"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08843" /><CodeLine lineNumber="8843"></CodeLine>
<Link id="l08844" /><CodeLine lineNumber="8844"><span class="doxyHighlightComment">// Some CGP optimizations may move or alter what&#39;s computed in a block. Check</span></CodeLine>
<Link id="l08845" /><CodeLine lineNumber="8845"><span class="doxyHighlightComment">// whether a dbg.value intrinsic could be pointed at a more appropriate operand.</span></CodeLine>
<Link id="l08846" /><CodeLine lineNumber="8846"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::fixupDbgValue(Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08847" /><CodeLine lineNumber="8847"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgValueInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l08848" /><CodeLine lineNumber="8848"><span class="doxyHighlight">  DbgValueInst &amp;DVI = &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgValueInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08849" /><CodeLine lineNumber="8849"></CodeLine>
<Link id="l08850" /><CodeLine lineNumber="8850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Does this dbg.value refer to a sunk address calculation?</span></CodeLine>
<Link id="l08851" /><CodeLine lineNumber="8851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08852" /><CodeLine lineNumber="8852"><span class="doxyHighlight">  SmallDenseSet&lt;Value &#42;&gt; LocationOps(DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a1aee0a03668ffd951c891317d8a0c30e">location&#95;ops</a>().begin(),</span></CodeLine>
<Link id="l08853" /><CodeLine lineNumber="8853"><span class="doxyHighlight">                                     DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a1aee0a03668ffd951c891317d8a0c30e">location&#95;ops</a>().end());</span></CodeLine>
<Link id="l08854" /><CodeLine lineNumber="8854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Location : LocationOps) &#123;</span></CodeLine>
<Link id="l08855" /><CodeLine lineNumber="8855"><span class="doxyHighlight">    WeakTrackingVH SunkAddrVH = SunkAddrs&#91;<a href="/docs/api/namespaces/anonymous-x86discriminatememops-cpp-/#aa0e9eb09c84a691bb23afcad7d960e03">Location</a>&#93;;</span></CodeLine>
<Link id="l08856" /><CodeLine lineNumber="8856"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SunkAddr = SunkAddrVH.<a href="/docs/api/classes/llvm/weaktrackingvh/#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08857" /><CodeLine lineNumber="8857"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SunkAddr) &#123;</span></CodeLine>
<Link id="l08858" /><CodeLine lineNumber="8858"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Point dbg.value at locally computed address, which should give the best</span></CodeLine>
<Link id="l08859" /><CodeLine lineNumber="8859"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// opportunity to be accurately lowered. This update may change the type</span></CodeLine>
<Link id="l08860" /><CodeLine lineNumber="8860"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of pointer being referred to; however this makes no difference to</span></CodeLine>
<Link id="l08861" /><CodeLine lineNumber="8861"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// debugging information, and we can&#39;t generate bitcasts that may affect</span></CodeLine>
<Link id="l08862" /><CodeLine lineNumber="8862"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// codegen.</span></CodeLine>
<Link id="l08863" /><CodeLine lineNumber="8863"><span class="doxyHighlight">      DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a3d995a069d73ebebbd6a4aace342ef76">replaceVariableLocationOp</a>(Location, SunkAddr);</span></CodeLine>
<Link id="l08864" /><CodeLine lineNumber="8864"><span class="doxyHighlight">      AnyChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08865" /><CodeLine lineNumber="8865"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08866" /><CodeLine lineNumber="8866"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08867" /><CodeLine lineNumber="8867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08868" /><CodeLine lineNumber="8868"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08869" /><CodeLine lineNumber="8869"></CodeLine>
<Link id="l08870" /><CodeLine lineNumber="8870"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::fixupDbgVariableRecordsOnInst(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08871" /><CodeLine lineNumber="8871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08872" /><CodeLine lineNumber="8872"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (DbgVariableRecord &amp;DVR : <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDbgRecordRange()))</span></CodeLine>
<Link id="l08873" /><CodeLine lineNumber="8873"><span class="doxyHighlight">    AnyChange |= fixupDbgVariableRecord(DVR);</span></CodeLine>
<Link id="l08874" /><CodeLine lineNumber="8874"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08875" /><CodeLine lineNumber="8875"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08876" /><CodeLine lineNumber="8876"></CodeLine>
<Link id="l08877" /><CodeLine lineNumber="8877"><span class="doxyHighlightComment">// FIXME: should updating debug-info really cause the &quot;changed&quot; flag to fire,</span></CodeLine>
<Link id="l08878" /><CodeLine lineNumber="8878"><span class="doxyHighlightComment">// which can cause a function to be reprocessed?</span></CodeLine>
<Link id="l08879" /><CodeLine lineNumber="8879"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::fixupDbgVariableRecord(DbgVariableRecord &amp;DVR) &#123;</span></CodeLine>
<Link id="l08880" /><CodeLine lineNumber="8880"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a3412d15543a66c3770500c3f2ba181c3">Type</a> != DbgVariableRecord::LocationType::Value &amp;&amp;</span></CodeLine>
<Link id="l08881" /><CodeLine lineNumber="8881"><span class="doxyHighlight">      DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a3412d15543a66c3770500c3f2ba181c3">Type</a> != DbgVariableRecord::LocationType::Assign)</span></CodeLine>
<Link id="l08882" /><CodeLine lineNumber="8882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08883" /><CodeLine lineNumber="8883"></CodeLine>
<Link id="l08884" /><CodeLine lineNumber="8884"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Does this DbgVariableRecord refer to a sunk address calculation?</span></CodeLine>
<Link id="l08885" /><CodeLine lineNumber="8885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08886" /><CodeLine lineNumber="8886"><span class="doxyHighlight">  SmallDenseSet&lt;Value &#42;&gt; LocationOps(DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#afd3574da4a2a86d1540dbdfcef171dd8">location&#95;ops</a>().begin(),</span></CodeLine>
<Link id="l08887" /><CodeLine lineNumber="8887"><span class="doxyHighlight">                                     DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#afd3574da4a2a86d1540dbdfcef171dd8">location&#95;ops</a>().end());</span></CodeLine>
<Link id="l08888" /><CodeLine lineNumber="8888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Location : LocationOps) &#123;</span></CodeLine>
<Link id="l08889" /><CodeLine lineNumber="8889"><span class="doxyHighlight">    WeakTrackingVH SunkAddrVH = SunkAddrs&#91;<a href="/docs/api/namespaces/anonymous-x86discriminatememops-cpp-/#aa0e9eb09c84a691bb23afcad7d960e03">Location</a>&#93;;</span></CodeLine>
<Link id="l08890" /><CodeLine lineNumber="8890"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SunkAddr = SunkAddrVH.<a href="/docs/api/classes/llvm/weaktrackingvh/#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08891" /><CodeLine lineNumber="8891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SunkAddr) &#123;</span></CodeLine>
<Link id="l08892" /><CodeLine lineNumber="8892"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Point dbg.value at locally computed address, which should give the best</span></CodeLine>
<Link id="l08893" /><CodeLine lineNumber="8893"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// opportunity to be accurately lowered. This update may change the type</span></CodeLine>
<Link id="l08894" /><CodeLine lineNumber="8894"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of pointer being referred to; however this makes no difference to</span></CodeLine>
<Link id="l08895" /><CodeLine lineNumber="8895"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// debugging information, and we can&#39;t generate bitcasts that may affect</span></CodeLine>
<Link id="l08896" /><CodeLine lineNumber="8896"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// codegen.</span></CodeLine>
<Link id="l08897" /><CodeLine lineNumber="8897"><span class="doxyHighlight">      DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#ae0ac412244054beacd97e316ded0fed3">replaceVariableLocationOp</a>(Location, SunkAddr);</span></CodeLine>
<Link id="l08898" /><CodeLine lineNumber="8898"><span class="doxyHighlight">      AnyChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08899" /><CodeLine lineNumber="8899"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08900" /><CodeLine lineNumber="8900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08901" /><CodeLine lineNumber="8901"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyChange;</span></CodeLine>
<Link id="l08902" /><CodeLine lineNumber="8902"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08903" /><CodeLine lineNumber="8903"></CodeLine>
<Link id="l08904" /><CodeLine lineNumber="8904" lineLink="#a5a43b0bc7c25aaaa14cf3d79d7f13c78"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a>(<a href="/docs/api/classes/llvm/dbgvalueinst">DbgValueInst</a> &#42;DVI, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI) &#123;</span></CodeLine>
<Link id="l08905" /><CodeLine lineNumber="8905"><span class="doxyHighlight">  DVI-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l08906" /><CodeLine lineNumber="8906"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(VI))</span></CodeLine>
<Link id="l08907" /><CodeLine lineNumber="8907"><span class="doxyHighlight">    DVI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(VI-&gt;getParent()-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l08908" /><CodeLine lineNumber="8908"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08909" /><CodeLine lineNumber="8909"><span class="doxyHighlight">    DVI-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(VI);</span></CodeLine>
<Link id="l08910" /><CodeLine lineNumber="8910"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08911" /><CodeLine lineNumber="8911"></CodeLine>
<Link id="l08912" /><CodeLine lineNumber="8912" lineLink="#ac8803aa267830622708ede7b732c7ae2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a>(<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> VI) &#123;</span></CodeLine>
<Link id="l08913" /><CodeLine lineNumber="8913"><span class="doxyHighlight">  DVR-&gt;<a href="/docs/api/classes/llvm/dbgrecord/#a04a8b2dc4d72db72e1f87bdec4074973">removeFromParent</a>();</span></CodeLine>
<Link id="l08914" /><CodeLine lineNumber="8914"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;VIBB = VI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l08915" /><CodeLine lineNumber="8915"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(VI))</span></CodeLine>
<Link id="l08916" /><CodeLine lineNumber="8916"><span class="doxyHighlight">    VIBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a365301682c41f8a7094218176d712cda">insertDbgRecordBefore</a>(DVR, VIBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l08917" /><CodeLine lineNumber="8917"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08918" /><CodeLine lineNumber="8918"><span class="doxyHighlight">    VIBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a930f97c50e2e4eddb8a6cd55a4dfd5bd">insertDbgRecordAfter</a>(DVR, &amp;&#42;VI);</span></CodeLine>
<Link id="l08919" /><CodeLine lineNumber="8919"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08920" /><CodeLine lineNumber="8920"></CodeLine>
<Link id="l08921" /><CodeLine lineNumber="8921"><span class="doxyHighlightComment">// A llvm.dbg.value may be using a value before its definition, due to</span></CodeLine>
<Link id="l08922" /><CodeLine lineNumber="8922"><span class="doxyHighlightComment">// optimizations in this pass and others. Scan for such dbg.values, and rescue</span></CodeLine>
<Link id="l08923" /><CodeLine lineNumber="8923"><span class="doxyHighlightComment">// them by moving the dbg.value to immediately after the value definition.</span></CodeLine>
<Link id="l08924" /><CodeLine lineNumber="8924"><span class="doxyHighlightComment">// FIXME: Ideally this should never be necessary, and this has the potential</span></CodeLine>
<Link id="l08925" /><CodeLine lineNumber="8925"><span class="doxyHighlightComment">// to re-order dbg.value intrinsics.</span></CodeLine>
<Link id="l08926" /><CodeLine lineNumber="8926"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::placeDbgValues(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l08927" /><CodeLine lineNumber="8927"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08928" /><CodeLine lineNumber="8928"><span class="doxyHighlight">  DominatorTree DT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l08929" /><CodeLine lineNumber="8929"></CodeLine>
<Link id="l08930" /><CodeLine lineNumber="8930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DbgProcessor = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgItem, <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/anonymous-simemorylegalizer-cpp-/#a9e7ad3c4e4254ff96b3ddbd4a6515dc2">Position</a>) &#123;</span></CodeLine>
<Link id="l08931" /><CodeLine lineNumber="8931"><span class="doxyHighlight">    SmallVector&lt;Instruction &#42;, 4&gt; VIs;</span></CodeLine>
<Link id="l08932" /><CodeLine lineNumber="8932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V : DbgItem-&gt;location&#95;ops())</span></CodeLine>
<Link id="l08933" /><CodeLine lineNumber="8933"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;VI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(V))</span></CodeLine>
<Link id="l08934" /><CodeLine lineNumber="8934"><span class="doxyHighlight">        VIs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VI);</span></CodeLine>
<Link id="l08935" /><CodeLine lineNumber="8935"></CodeLine>
<Link id="l08936" /><CodeLine lineNumber="8936"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This item may depend on multiple instructions, complicating any</span></CodeLine>
<Link id="l08937" /><CodeLine lineNumber="8937"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// potential sink. This block takes the defensive approach, opting to</span></CodeLine>
<Link id="l08938" /><CodeLine lineNumber="8938"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &quot;undef&quot; the item if it has more than one instruction and any of them do</span></CodeLine>
<Link id="l08939" /><CodeLine lineNumber="8939"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// not dominate iem.</span></CodeLine>
<Link id="l08940" /><CodeLine lineNumber="8940"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;VI : VIs) &#123;</span></CodeLine>
<Link id="l08941" /><CodeLine lineNumber="8941"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a4a23b2b2d70dd9f7a94a1215e62cb0a0">VI</a>-&gt;isTerminator())</span></CodeLine>
<Link id="l08942" /><CodeLine lineNumber="8942"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08943" /><CodeLine lineNumber="8943"></CodeLine>
<Link id="l08944" /><CodeLine lineNumber="8944"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If VI is a phi in a block with an EHPad terminator, we can&#39;t insert</span></CodeLine>
<Link id="l08945" /><CodeLine lineNumber="8945"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// after it.</span></CodeLine>
<Link id="l08946" /><CodeLine lineNumber="8946"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(VI) &amp;&amp; <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a4a23b2b2d70dd9f7a94a1215e62cb0a0">VI</a>-&gt;getParent()-&gt;getTerminator()-&gt;isEHPad())</span></CodeLine>
<Link id="l08947" /><CodeLine lineNumber="8947"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08948" /><CodeLine lineNumber="8948"></CodeLine>
<Link id="l08949" /><CodeLine lineNumber="8949"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the defining instruction dominates the dbg.value, we do not need</span></CodeLine>
<Link id="l08950" /><CodeLine lineNumber="8950"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to move the dbg.value.</span></CodeLine>
<Link id="l08951" /><CodeLine lineNumber="8951"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT.dominates(VI, Position))</span></CodeLine>
<Link id="l08952" /><CodeLine lineNumber="8952"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08953" /><CodeLine lineNumber="8953"></CodeLine>
<Link id="l08954" /><CodeLine lineNumber="8954"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we depend on multiple instructions and any of them doesn&#39;t</span></CodeLine>
<Link id="l08955" /><CodeLine lineNumber="8955"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dominate this DVI, we probably can&#39;t salvage it: moving it to</span></CodeLine>
<Link id="l08956" /><CodeLine lineNumber="8956"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// after any of the instructions could cause us to lose the others.</span></CodeLine>
<Link id="l08957" /><CodeLine lineNumber="8957"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VIs.size() &gt; 1) &#123;</span></CodeLine>
<Link id="l08958" /><CodeLine lineNumber="8958"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l08959" /><CodeLine lineNumber="8959"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l08960" /><CodeLine lineNumber="8960"><span class="doxyHighlight">            &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Unable to find valid location for Debug Value, undefing:\\n&quot;</span></CodeLine>
<Link id="l08961" /><CodeLine lineNumber="8961"><span class="doxyHighlight">            &lt;&lt; &#42;DbgItem);</span></CodeLine>
<Link id="l08962" /><CodeLine lineNumber="8962"><span class="doxyHighlight">        DbgItem-&gt;setKillLocation();</span></CodeLine>
<Link id="l08963" /><CodeLine lineNumber="8963"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08964" /><CodeLine lineNumber="8964"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08965" /><CodeLine lineNumber="8965"></CodeLine>
<Link id="l08966" /><CodeLine lineNumber="8966"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Moving Debug Value before :\\n&quot;</span></CodeLine>
<Link id="l08967" /><CodeLine lineNumber="8967"><span class="doxyHighlight">                        &lt;&lt; &#42;DbgItem &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39; &#39;</span><span class="doxyHighlight"> &lt;&lt; &#42;VI);</span></CodeLine>
<Link id="l08968" /><CodeLine lineNumber="8968"><span class="doxyHighlight">      <a href="#a5a43b0bc7c25aaaa14cf3d79d7f13c78">DbgInserterHelper</a>(DbgItem, <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a4a23b2b2d70dd9f7a94a1215e62cb0a0">VI</a>-&gt;getIterator());</span></CodeLine>
<Link id="l08969" /><CodeLine lineNumber="8969"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08970" /><CodeLine lineNumber="8970"><span class="doxyHighlight">      ++NumDbgValueMoved;</span></CodeLine>
<Link id="l08971" /><CodeLine lineNumber="8971"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08972" /><CodeLine lineNumber="8972"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l08973" /><CodeLine lineNumber="8973"></CodeLine>
<Link id="l08974" /><CodeLine lineNumber="8974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l08975" /><CodeLine lineNumber="8975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(BB)) &#123;</span></CodeLine>
<Link id="l08976" /><CodeLine lineNumber="8976"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Process dbg.value intrinsics.</span></CodeLine>
<Link id="l08977" /><CodeLine lineNumber="8977"><span class="doxyHighlight">      DbgValueInst &#42;DVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgValueInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>);</span></CodeLine>
<Link id="l08978" /><CodeLine lineNumber="8978"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DVI) &#123;</span></CodeLine>
<Link id="l08979" /><CodeLine lineNumber="8979"><span class="doxyHighlight">        DbgProcessor(DVI, DVI);</span></CodeLine>
<Link id="l08980" /><CodeLine lineNumber="8980"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08981" /><CodeLine lineNumber="8981"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08982" /><CodeLine lineNumber="8982"></CodeLine>
<Link id="l08983" /><CodeLine lineNumber="8983"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this isn&#39;t a dbg.value, process any attached DbgVariableRecord</span></CodeLine>
<Link id="l08984" /><CodeLine lineNumber="8984"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// records attached to this instruction.</span></CodeLine>
<Link id="l08985" /><CodeLine lineNumber="8985"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (DbgVariableRecord &amp;DVR : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(</span></CodeLine>
<Link id="l08986" /><CodeLine lineNumber="8986"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>.getDbgRecordRange()))) &#123;</span></CodeLine>
<Link id="l08987" /><CodeLine lineNumber="8987"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a3412d15543a66c3770500c3f2ba181c3">Type</a> != DbgVariableRecord::LocationType::Value)</span></CodeLine>
<Link id="l08988" /><CodeLine lineNumber="8988"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08989" /><CodeLine lineNumber="8989"><span class="doxyHighlight">        DbgProcessor(&amp;DVR, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>);</span></CodeLine>
<Link id="l08990" /><CodeLine lineNumber="8990"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08991" /><CodeLine lineNumber="8991"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08992" /><CodeLine lineNumber="8992"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08993" /><CodeLine lineNumber="8993"></CodeLine>
<Link id="l08994" /><CodeLine lineNumber="8994"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l08995" /><CodeLine lineNumber="8995"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08996" /><CodeLine lineNumber="8996"></CodeLine>
<Link id="l08997" /><CodeLine lineNumber="8997"><span class="doxyHighlightComment">// Group scattered pseudo probes in a block to favor SelectionDAG. Scattered</span></CodeLine>
<Link id="l08998" /><CodeLine lineNumber="8998"><span class="doxyHighlightComment">// probes can be chained dependencies of other regular DAG nodes and block DAG</span></CodeLine>
<Link id="l08999" /><CodeLine lineNumber="8999"><span class="doxyHighlightComment">// combine optimizations.</span></CodeLine>
<Link id="l09000" /><CodeLine lineNumber="9000"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::placePseudoProbes(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l09001" /><CodeLine lineNumber="9001"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09002" /><CodeLine lineNumber="9002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l09003" /><CodeLine lineNumber="9003"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move the rest probes to the beginning of the block.</span></CodeLine>
<Link id="l09004" /><CodeLine lineNumber="9004"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FirstInst = <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.getFirstInsertionPt();</span></CodeLine>
<Link id="l09005" /><CodeLine lineNumber="9005"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (FirstInst != <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.end() &amp;&amp; FirstInst-&gt;isDebugOrPseudoInst())</span></CodeLine>
<Link id="l09006" /><CodeLine lineNumber="9006"><span class="doxyHighlight">      ++FirstInst;</span></CodeLine>
<Link id="l09007" /><CodeLine lineNumber="9007"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>(FirstInst);</span></CodeLine>
<Link id="l09008" /><CodeLine lineNumber="9008"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</span></CodeLine>
<Link id="l09009" /><CodeLine lineNumber="9009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.end()) &#123;</span></CodeLine>
<Link id="l09010" /><CodeLine lineNumber="9010"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PseudoProbeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++)) &#123;</span></CodeLine>
<Link id="l09011" /><CodeLine lineNumber="9011"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;moveBefore(FirstInst);</span></CodeLine>
<Link id="l09012" /><CodeLine lineNumber="9012"><span class="doxyHighlight">        MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09013" /><CodeLine lineNumber="9013"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09014" /><CodeLine lineNumber="9014"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09015" /><CodeLine lineNumber="9015"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09016" /><CodeLine lineNumber="9016"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l09017" /><CodeLine lineNumber="9017"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09018" /><CodeLine lineNumber="9018"></CodeLine>
<Link id="l09019" /><CodeLine lineNumber="9019"><span class="doxyHighlightComment">/// Scale down both weights to fit into uint32&#95;t.</span></CodeLine>
<Link id="l09020" /><CodeLine lineNumber="9020" lineLink="#a25c5d0cb41bbb1777e779a8da35e7bd4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(uint64&#95;t &amp;NewTrue, uint64&#95;t &amp;NewFalse) &#123;</span></CodeLine>
<Link id="l09021" /><CodeLine lineNumber="9021"><span class="doxyHighlight">  uint64&#95;t NewMax = (NewTrue &gt; NewFalse) ? NewTrue : NewFalse;</span></CodeLine>
<Link id="l09022" /><CodeLine lineNumber="9022"><span class="doxyHighlight">  uint32&#95;t Scale = (NewMax / std::numeric&#95;limits&lt;uint32&#95;t&gt;::max()) + 1;</span></CodeLine>
<Link id="l09023" /><CodeLine lineNumber="9023"><span class="doxyHighlight">  NewTrue = NewTrue / Scale;</span></CodeLine>
<Link id="l09024" /><CodeLine lineNumber="9024"><span class="doxyHighlight">  NewFalse = NewFalse / Scale;</span></CodeLine>
<Link id="l09025" /><CodeLine lineNumber="9025"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09026" /><CodeLine lineNumber="9026"></CodeLine>
<Link id="l09027" /><CodeLine lineNumber="9027"><span class="doxyHighlightComment">/// Some targets prefer to split a conditional branch like:</span></CodeLine>
<Link id="l09028" /><CodeLine lineNumber="9028"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l09029" /><CodeLine lineNumber="9029"><span class="doxyHighlightComment">///   %0 = icmp ne i32 %a, 0</span></CodeLine>
<Link id="l09030" /><CodeLine lineNumber="9030"><span class="doxyHighlightComment">///   %1 = icmp ne i32 %b, 0</span></CodeLine>
<Link id="l09031" /><CodeLine lineNumber="9031"><span class="doxyHighlightComment">///   %or.cond = or i1 %0, %1</span></CodeLine>
<Link id="l09032" /><CodeLine lineNumber="9032"><span class="doxyHighlightComment">///   br i1 %or.cond, label %TrueBB, label %FalseBB</span></CodeLine>
<Link id="l09033" /><CodeLine lineNumber="9033"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l09034" /><CodeLine lineNumber="9034"><span class="doxyHighlightComment">/// into multiple branch instructions like:</span></CodeLine>
<Link id="l09035" /><CodeLine lineNumber="9035"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l09036" /><CodeLine lineNumber="9036"><span class="doxyHighlightComment">///   bb1:</span></CodeLine>
<Link id="l09037" /><CodeLine lineNumber="9037"><span class="doxyHighlightComment">///     %0 = icmp ne i32 %a, 0</span></CodeLine>
<Link id="l09038" /><CodeLine lineNumber="9038"><span class="doxyHighlightComment">///     br i1 %0, label %TrueBB, label %bb2</span></CodeLine>
<Link id="l09039" /><CodeLine lineNumber="9039"><span class="doxyHighlightComment">///   bb2:</span></CodeLine>
<Link id="l09040" /><CodeLine lineNumber="9040"><span class="doxyHighlightComment">///     %1 = icmp ne i32 %b, 0</span></CodeLine>
<Link id="l09041" /><CodeLine lineNumber="9041"><span class="doxyHighlightComment">///     br i1 %1, label %TrueBB, label %FalseBB</span></CodeLine>
<Link id="l09042" /><CodeLine lineNumber="9042"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l09043" /><CodeLine lineNumber="9043"><span class="doxyHighlightComment">/// This usually allows instruction selection to do even further optimizations</span></CodeLine>
<Link id="l09044" /><CodeLine lineNumber="9044"><span class="doxyHighlightComment">/// and combine the compare with the branch instruction. Currently this is</span></CodeLine>
<Link id="l09045" /><CodeLine lineNumber="9045"><span class="doxyHighlightComment">/// applied for targets which have &quot;cheap&quot; jump instructions.</span></CodeLine>
<Link id="l09046" /><CodeLine lineNumber="9046"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l09047" /><CodeLine lineNumber="9047"><span class="doxyHighlightComment">/// FIXME: Remove the (equivalent?) implementation in SelectionDAG.</span></CodeLine>
<Link id="l09048" /><CodeLine lineNumber="9048"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l09049" /><CodeLine lineNumber="9049"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CodeGenPrepare::splitBranchCondition(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379">ModifyDT</a> &amp;ModifiedDT) &#123;</span></CodeLine>
<Link id="l09050" /><CodeLine lineNumber="9050"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TM-&gt;Options.EnableFastISel || TLI-&gt;isJumpExpensive())</span></CodeLine>
<Link id="l09051" /><CodeLine lineNumber="9051"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09052" /><CodeLine lineNumber="9052"></CodeLine>
<Link id="l09053" /><CodeLine lineNumber="9053"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09054" /><CodeLine lineNumber="9054"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l09055" /><CodeLine lineNumber="9055"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Does this BB end with the following?</span></CodeLine>
<Link id="l09056" /><CodeLine lineNumber="9056"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   %cond1 = icmp|fcmp|binary instruction ...</span></CodeLine>
<Link id="l09057" /><CodeLine lineNumber="9057"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   %cond2 = icmp|fcmp|binary instruction ...</span></CodeLine>
<Link id="l09058" /><CodeLine lineNumber="9058"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   %cond.or = or|and i1 %cond1, cond2</span></CodeLine>
<Link id="l09059" /><CodeLine lineNumber="9059"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   br i1 %cond.or label %dest1, label %dest2&quot;</span></CodeLine>
<Link id="l09060" /><CodeLine lineNumber="9060"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;LogicOp;</span></CodeLine>
<Link id="l09061" /><CodeLine lineNumber="9061"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, &#42;FBB;</span></CodeLine>
<Link id="l09062" /><CodeLine lineNumber="9062"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l09063" /><CodeLine lineNumber="9063"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/patternmatch/#a811d001fa503a556ac2a48d64366500f">m&#95;Br</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(LogicOp)), <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB)))</span></CodeLine>
<Link id="l09064" /><CodeLine lineNumber="9064"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09065" /><CodeLine lineNumber="9065"></CodeLine>
<Link id="l09066" /><CodeLine lineNumber="9066"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Br1 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l09067" /><CodeLine lineNumber="9067"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Br1-&gt;getMetadata(LLVMContext::MD&#95;unpredictable))</span></CodeLine>
<Link id="l09068" /><CodeLine lineNumber="9068"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09069" /><CodeLine lineNumber="9069"></CodeLine>
<Link id="l09070" /><CodeLine lineNumber="9070"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The merging of mostly empty BB can cause a degenerate branch.</span></CodeLine>
<Link id="l09071" /><CodeLine lineNumber="9071"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> == FBB)</span></CodeLine>
<Link id="l09072" /><CodeLine lineNumber="9072"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09073" /><CodeLine lineNumber="9073"></CodeLine>
<Link id="l09074" /><CodeLine lineNumber="9074"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc;</span></CodeLine>
<Link id="l09075" /><CodeLine lineNumber="9075"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Cond1, &#42;Cond2;</span></CodeLine>
<Link id="l09076" /><CodeLine lineNumber="9076"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LogicOp,</span></CodeLine>
<Link id="l09077" /><CodeLine lineNumber="9077"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond1)), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond2)))))</span></CodeLine>
<Link id="l09078" /><CodeLine lineNumber="9078"><span class="doxyHighlight">      Opc = Instruction::And;</span></CodeLine>
<Link id="l09079" /><CodeLine lineNumber="9079"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LogicOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond1)),</span></CodeLine>
<Link id="l09080" /><CodeLine lineNumber="9080"><span class="doxyHighlight">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond2)))))</span></CodeLine>
<Link id="l09081" /><CodeLine lineNumber="9081"><span class="doxyHighlight">      Opc = Instruction::Or;</span></CodeLine>
<Link id="l09082" /><CodeLine lineNumber="9082"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09083" /><CodeLine lineNumber="9083"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09084" /><CodeLine lineNumber="9084"></CodeLine>
<Link id="l09085" /><CodeLine lineNumber="9085"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsGoodCond = &#91;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &#123;</span></CodeLine>
<Link id="l09086" /><CodeLine lineNumber="9086"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</span></CodeLine>
<Link id="l09087" /><CodeLine lineNumber="9087"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>,</span></CodeLine>
<Link id="l09088" /><CodeLine lineNumber="9088"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a7d9ab823fe85606fa795c0c6fc75aca6">m&#95;Cmp</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()),</span></CodeLine>
<Link id="l09089" /><CodeLine lineNumber="9089"><span class="doxyHighlight">                                           <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))));</span></CodeLine>
<Link id="l09090" /><CodeLine lineNumber="9090"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l09091" /><CodeLine lineNumber="9091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsGoodCond(Cond1) || !IsGoodCond(Cond2))</span></CodeLine>
<Link id="l09092" /><CodeLine lineNumber="9092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09093" /><CodeLine lineNumber="9093"></CodeLine>
<Link id="l09094" /><CodeLine lineNumber="9094"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Before branch condition splitting\\n&quot;</span><span class="doxyHighlight">; BB.<a href="/docs/api/classes/llvm/value/#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>());</span></CodeLine>
<Link id="l09095" /><CodeLine lineNumber="9095"></CodeLine>
<Link id="l09096" /><CodeLine lineNumber="9096"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a new BB.</span></CodeLine>
<Link id="l09097" /><CodeLine lineNumber="9097"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TmpBB =</span></CodeLine>
<Link id="l09098" /><CodeLine lineNumber="9098"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), BB.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.cond.split&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l09099" /><CodeLine lineNumber="9099"><span class="doxyHighlight">                           BB.<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), BB.<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</span></CodeLine>
<Link id="l09100" /><CodeLine lineNumber="9100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#aaf22dc443fa1ce5fcf175fcf27dd50fa">IsHugeFunc</a>)</span></CodeLine>
<Link id="l09101" /><CodeLine lineNumber="9101"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-codegenprepare-cpp-/codegenprepare/#a3976bdb67704d416ca52fd8a1ead845a">FreshBBs</a>.insert(TmpBB);</span></CodeLine>
<Link id="l09102" /><CodeLine lineNumber="9102"></CodeLine>
<Link id="l09103" /><CodeLine lineNumber="9103"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update original basic block by using the first condition directly by the</span></CodeLine>
<Link id="l09104" /><CodeLine lineNumber="9104"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branch instruction and removing the no longer needed and/or instruction.</span></CodeLine>
<Link id="l09105" /><CodeLine lineNumber="9105"><span class="doxyHighlight">    Br1-&gt;setCondition(Cond1);</span></CodeLine>
<Link id="l09106" /><CodeLine lineNumber="9106"><span class="doxyHighlight">    LogicOp-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l09107" /><CodeLine lineNumber="9107"></CodeLine>
<Link id="l09108" /><CodeLine lineNumber="9108"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Depending on the condition we have to either replace the true or the</span></CodeLine>
<Link id="l09109" /><CodeLine lineNumber="9109"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// false successor of the original branch instruction.</span></CodeLine>
<Link id="l09110" /><CodeLine lineNumber="9110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == Instruction::And)</span></CodeLine>
<Link id="l09111" /><CodeLine lineNumber="9111"><span class="doxyHighlight">      Br1-&gt;setSuccessor(0, TmpBB);</span></CodeLine>
<Link id="l09112" /><CodeLine lineNumber="9112"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09113" /><CodeLine lineNumber="9113"><span class="doxyHighlight">      Br1-&gt;setSuccessor(1, TmpBB);</span></CodeLine>
<Link id="l09114" /><CodeLine lineNumber="9114"></CodeLine>
<Link id="l09115" /><CodeLine lineNumber="9115"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fill in the new basic block.</span></CodeLine>
<Link id="l09116" /><CodeLine lineNumber="9116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Br2 = <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a>(TmpBB).CreateCondBr(Cond2, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB);</span></CodeLine>
<Link id="l09117" /><CodeLine lineNumber="9117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Cond2)) &#123;</span></CodeLine>
<Link id="l09118" /><CodeLine lineNumber="9118"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;removeFromParent();</span></CodeLine>
<Link id="l09119" /><CodeLine lineNumber="9119"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;insertBefore(Br2-&gt;getIterator());</span></CodeLine>
<Link id="l09120" /><CodeLine lineNumber="9120"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09121" /><CodeLine lineNumber="9121"></CodeLine>
<Link id="l09122" /><CodeLine lineNumber="9122"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update PHI nodes in both successors. The original BB needs to be</span></CodeLine>
<Link id="l09123" /><CodeLine lineNumber="9123"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// replaced in one successor&#39;s PHI nodes, because the branch comes now from</span></CodeLine>
<Link id="l09124" /><CodeLine lineNumber="9124"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the newly generated BB (NewBB). In the other successor we need to add one</span></CodeLine>
<Link id="l09125" /><CodeLine lineNumber="9125"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// incoming edge to the PHI nodes, because both branch instructions target</span></CodeLine>
<Link id="l09126" /><CodeLine lineNumber="9126"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// now the same successor. Depending on the original branch condition</span></CodeLine>
<Link id="l09127" /><CodeLine lineNumber="9127"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (and/or) we have to swap the successors (TrueDest, FalseDest), so that</span></CodeLine>
<Link id="l09128" /><CodeLine lineNumber="9128"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we perform the correct update for the PHI nodes.</span></CodeLine>
<Link id="l09129" /><CodeLine lineNumber="9129"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This doesn&#39;t change the successor order of the just created branch</span></CodeLine>
<Link id="l09130" /><CodeLine lineNumber="9130"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction (or any other instruction).</span></CodeLine>
<Link id="l09131" /><CodeLine lineNumber="9131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == Instruction::Or)</span></CodeLine>
<Link id="l09132" /><CodeLine lineNumber="9132"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB);</span></CodeLine>
<Link id="l09133" /><CodeLine lineNumber="9133"></CodeLine>
<Link id="l09134" /><CodeLine lineNumber="9134"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace the old BB with the new BB.</span></CodeLine>
<Link id="l09135" /><CodeLine lineNumber="9135"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>-&gt;replacePhiUsesWith(&amp;BB, TmpBB);</span></CodeLine>
<Link id="l09136" /><CodeLine lineNumber="9136"></CodeLine>
<Link id="l09137" /><CodeLine lineNumber="9137"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add another incoming edge from the new BB.</span></CodeLine>
<Link id="l09138" /><CodeLine lineNumber="9138"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &amp;PN : FBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l09139" /><CodeLine lineNumber="9139"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Val = PN.<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(&amp;BB);</span></CodeLine>
<Link id="l09140" /><CodeLine lineNumber="9140"><span class="doxyHighlight">      PN.<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Val, TmpBB);</span></CodeLine>
<Link id="l09141" /><CodeLine lineNumber="9141"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09142" /><CodeLine lineNumber="9142"></CodeLine>
<Link id="l09143" /><CodeLine lineNumber="9143"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update the branch weights (from SelectionDAGBuilder::</span></CodeLine>
<Link id="l09144" /><CodeLine lineNumber="9144"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FindMergedConditions).</span></CodeLine>
<Link id="l09145" /><CodeLine lineNumber="9145"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == Instruction::Or) &#123;</span></CodeLine>
<Link id="l09146" /><CodeLine lineNumber="9146"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Codegen X | Y as:</span></CodeLine>
<Link id="l09147" /><CodeLine lineNumber="9147"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BB1:</span></CodeLine>
<Link id="l09148" /><CodeLine lineNumber="9148"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp&#95;if&#95;X TBB</span></CodeLine>
<Link id="l09149" /><CodeLine lineNumber="9149"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp TmpBB</span></CodeLine>
<Link id="l09150" /><CodeLine lineNumber="9150"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TmpBB:</span></CodeLine>
<Link id="l09151" /><CodeLine lineNumber="9151"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp&#95;if&#95;Y TBB</span></CodeLine>
<Link id="l09152" /><CodeLine lineNumber="9152"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp FBB</span></CodeLine>
<Link id="l09153" /><CodeLine lineNumber="9153"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09154" /><CodeLine lineNumber="9154"></CodeLine>
<Link id="l09155" /><CodeLine lineNumber="9155"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We have flexibility in setting Prob for BB1 and Prob for NewBB.</span></CodeLine>
<Link id="l09156" /><CodeLine lineNumber="9156"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The requirement is that</span></CodeLine>
<Link id="l09157" /><CodeLine lineNumber="9157"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   TrueProb for BB1 + (FalseProb for BB1 &#42; TrueProb for TmpBB)</span></CodeLine>
<Link id="l09158" /><CodeLine lineNumber="9158"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//     = TrueProb for original BB.</span></CodeLine>
<Link id="l09159" /><CodeLine lineNumber="9159"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Assuming the original weights are A and B, one choice is to set BB1&#39;s</span></CodeLine>
<Link id="l09160" /><CodeLine lineNumber="9160"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// weights to A and A+2B, and set TmpBB&#39;s weights to A and 2B. This choice</span></CodeLine>
<Link id="l09161" /><CodeLine lineNumber="9161"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// assumes that</span></CodeLine>
<Link id="l09162" /><CodeLine lineNumber="9162"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   TrueProb for BB1 == FalseProb for BB1 &#42; TrueProb for TmpBB.</span></CodeLine>
<Link id="l09163" /><CodeLine lineNumber="9163"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Another choice is to assume TrueProb for BB1 equals to TrueProb for</span></CodeLine>
<Link id="l09164" /><CodeLine lineNumber="9164"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TmpBB, but the math is more complicated.</span></CodeLine>
<Link id="l09165" /><CodeLine lineNumber="9165"><span class="doxyHighlight">      uint64&#95;t TrueWeight, FalseWeight;</span></CodeLine>
<Link id="l09166" /><CodeLine lineNumber="9166"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;Br1, TrueWeight, FalseWeight)) &#123;</span></CodeLine>
<Link id="l09167" /><CodeLine lineNumber="9167"><span class="doxyHighlight">        uint64&#95;t NewTrueWeight = TrueWeight;</span></CodeLine>
<Link id="l09168" /><CodeLine lineNumber="9168"><span class="doxyHighlight">        uint64&#95;t NewFalseWeight = TrueWeight + 2 &#42; FalseWeight;</span></CodeLine>
<Link id="l09169" /><CodeLine lineNumber="9169"><span class="doxyHighlight">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</span></CodeLine>
<Link id="l09170" /><CodeLine lineNumber="9170"><span class="doxyHighlight">        Br1-&gt;setMetadata(LLVMContext::MD&#95;prof,</span></CodeLine>
<Link id="l09171" /><CodeLine lineNumber="9171"><span class="doxyHighlight">                         MDBuilder(Br1-&gt;getContext())</span></CodeLine>
<Link id="l09172" /><CodeLine lineNumber="9172"><span class="doxyHighlight">                             .createBranchWeights(TrueWeight, FalseWeight,</span></CodeLine>
<Link id="l09173" /><CodeLine lineNumber="9173"><span class="doxyHighlight">                                                  <a href="/docs/api/namespaces/llvm/#a4a3bd60427b33355559566bdec3c9f90">hasBranchWeightOrigin</a>(&#42;Br1)));</span></CodeLine>
<Link id="l09174" /><CodeLine lineNumber="9174"></CodeLine>
<Link id="l09175" /><CodeLine lineNumber="9175"><span class="doxyHighlight">        NewTrueWeight = TrueWeight;</span></CodeLine>
<Link id="l09176" /><CodeLine lineNumber="9176"><span class="doxyHighlight">        NewFalseWeight = 2 &#42; FalseWeight;</span></CodeLine>
<Link id="l09177" /><CodeLine lineNumber="9177"><span class="doxyHighlight">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</span></CodeLine>
<Link id="l09178" /><CodeLine lineNumber="9178"><span class="doxyHighlight">        Br2-&gt;setMetadata(LLVMContext::MD&#95;prof,</span></CodeLine>
<Link id="l09179" /><CodeLine lineNumber="9179"><span class="doxyHighlight">                         MDBuilder(Br2-&gt;getContext())</span></CodeLine>
<Link id="l09180" /><CodeLine lineNumber="9180"><span class="doxyHighlight">                             .createBranchWeights(TrueWeight, FalseWeight));</span></CodeLine>
<Link id="l09181" /><CodeLine lineNumber="9181"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09182" /><CodeLine lineNumber="9182"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09183" /><CodeLine lineNumber="9183"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Codegen X &amp; Y as:</span></CodeLine>
<Link id="l09184" /><CodeLine lineNumber="9184"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BB1:</span></CodeLine>
<Link id="l09185" /><CodeLine lineNumber="9185"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp&#95;if&#95;X TmpBB</span></CodeLine>
<Link id="l09186" /><CodeLine lineNumber="9186"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp FBB</span></CodeLine>
<Link id="l09187" /><CodeLine lineNumber="9187"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TmpBB:</span></CodeLine>
<Link id="l09188" /><CodeLine lineNumber="9188"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp&#95;if&#95;Y TBB</span></CodeLine>
<Link id="l09189" /><CodeLine lineNumber="9189"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   jmp FBB</span></CodeLine>
<Link id="l09190" /><CodeLine lineNumber="9190"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09191" /><CodeLine lineNumber="9191"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  This requires creation of TmpBB after CurBB.</span></CodeLine>
<Link id="l09192" /><CodeLine lineNumber="9192"></CodeLine>
<Link id="l09193" /><CodeLine lineNumber="9193"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We have flexibility in setting Prob for BB1 and Prob for TmpBB.</span></CodeLine>
<Link id="l09194" /><CodeLine lineNumber="9194"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The requirement is that</span></CodeLine>
<Link id="l09195" /><CodeLine lineNumber="9195"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   FalseProb for BB1 + (TrueProb for BB1 &#42; FalseProb for TmpBB)</span></CodeLine>
<Link id="l09196" /><CodeLine lineNumber="9196"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//     = FalseProb for original BB.</span></CodeLine>
<Link id="l09197" /><CodeLine lineNumber="9197"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Assuming the original weights are A and B, one choice is to set BB1&#39;s</span></CodeLine>
<Link id="l09198" /><CodeLine lineNumber="9198"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// weights to 2A+B and B, and set TmpBB&#39;s weights to 2A and B. This choice</span></CodeLine>
<Link id="l09199" /><CodeLine lineNumber="9199"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// assumes that</span></CodeLine>
<Link id="l09200" /><CodeLine lineNumber="9200"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   FalseProb for BB1 == TrueProb for BB1 &#42; FalseProb for TmpBB.</span></CodeLine>
<Link id="l09201" /><CodeLine lineNumber="9201"><span class="doxyHighlight">      uint64&#95;t TrueWeight, FalseWeight;</span></CodeLine>
<Link id="l09202" /><CodeLine lineNumber="9202"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;Br1, TrueWeight, FalseWeight)) &#123;</span></CodeLine>
<Link id="l09203" /><CodeLine lineNumber="9203"><span class="doxyHighlight">        uint64&#95;t NewTrueWeight = 2 &#42; TrueWeight + FalseWeight;</span></CodeLine>
<Link id="l09204" /><CodeLine lineNumber="9204"><span class="doxyHighlight">        uint64&#95;t NewFalseWeight = FalseWeight;</span></CodeLine>
<Link id="l09205" /><CodeLine lineNumber="9205"><span class="doxyHighlight">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</span></CodeLine>
<Link id="l09206" /><CodeLine lineNumber="9206"><span class="doxyHighlight">        Br1-&gt;setMetadata(LLVMContext::MD&#95;prof,</span></CodeLine>
<Link id="l09207" /><CodeLine lineNumber="9207"><span class="doxyHighlight">                         MDBuilder(Br1-&gt;getContext())</span></CodeLine>
<Link id="l09208" /><CodeLine lineNumber="9208"><span class="doxyHighlight">                             .createBranchWeights(TrueWeight, FalseWeight));</span></CodeLine>
<Link id="l09209" /><CodeLine lineNumber="9209"></CodeLine>
<Link id="l09210" /><CodeLine lineNumber="9210"><span class="doxyHighlight">        NewTrueWeight = 2 &#42; TrueWeight;</span></CodeLine>
<Link id="l09211" /><CodeLine lineNumber="9211"><span class="doxyHighlight">        NewFalseWeight = FalseWeight;</span></CodeLine>
<Link id="l09212" /><CodeLine lineNumber="9212"><span class="doxyHighlight">        <a href="#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</span></CodeLine>
<Link id="l09213" /><CodeLine lineNumber="9213"><span class="doxyHighlight">        Br2-&gt;setMetadata(LLVMContext::MD&#95;prof,</span></CodeLine>
<Link id="l09214" /><CodeLine lineNumber="9214"><span class="doxyHighlight">                         MDBuilder(Br2-&gt;getContext())</span></CodeLine>
<Link id="l09215" /><CodeLine lineNumber="9215"><span class="doxyHighlight">                             .createBranchWeights(TrueWeight, FalseWeight));</span></CodeLine>
<Link id="l09216" /><CodeLine lineNumber="9216"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09217" /><CodeLine lineNumber="9217"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09218" /><CodeLine lineNumber="9218"></CodeLine>
<Link id="l09219" /><CodeLine lineNumber="9219"><span class="doxyHighlight">    ModifiedDT = <a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af5758ce8e1ea07d0c154e97556db4379acdb2e8290f0e8cd4bedd2a20c95047a9">ModifyDT::ModifyBBDT</a>;</span></CodeLine>
<Link id="l09220" /><CodeLine lineNumber="9220"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09221" /><CodeLine lineNumber="9221"></CodeLine>
<Link id="l09222" /><CodeLine lineNumber="9222"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;After branch condition splitting\\n&quot;</span><span class="doxyHighlight">; BB.<a href="/docs/api/classes/llvm/value/#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>();</span></CodeLine>
<Link id="l09223" /><CodeLine lineNumber="9223"><span class="doxyHighlight">               TmpBB-&gt;dump());</span></CodeLine>
<Link id="l09224" /><CodeLine lineNumber="9224"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09225" /><CodeLine lineNumber="9225"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l09226" /><CodeLine lineNumber="9226"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
