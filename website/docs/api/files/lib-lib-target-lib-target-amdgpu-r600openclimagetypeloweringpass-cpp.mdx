---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `R600OpenCLImageTypeLoweringPass.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This pass resolves calls to OpenCL image attribute, image resource <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> and sampler resource <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> getter functions. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="R600.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Cloning.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h"
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-">anonymous&#123;R600OpenCLImageTypeLoweringPass.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/kernelargmd">KernelArgMD</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass">R600OpenCLImageTypeLoweringPass</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#a83b7dc810cf4c3050ff52c245eb0a5e9">AccessQualFromMD</a> (MDNode &#42;KernelMDNode, unsigned ArgIdx)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#a21caf59ebb50607d80672fa9cbca25d3">ArgTypeFromMD</a> (MDNode &#42;KernelMDNode, unsigned ArgIdx)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="MDVector"
  name={<><a href="#ac63fffbaa27bd0a8d519da317a037d13">GetArgMD</a> (MDNode &#42;KernelMDNode, unsigned OpIdx)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/function">Function</a> &#42;</>}
  name={<><a href="#a5bfeca5996966d19706f2a277e7c2341">GetFunctionFromMDNode</a> (MDNode &#42;Node)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a162a731af373b7026fdd1fe8ae54bbe3">IsImageType</a> (StringRef TypeString)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a834ef6cea23843bec307de03c8a0b73f">IsSamplerType</a> (StringRef TypeString)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8388ad714d73e79dde0a9e89872e76bb">PushArgMD</a> (KernelArgMD &amp;MD, const MDVector &amp;V)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#a8c8172d032069b64fa83cc1fb2280c42">GetImageFormatFunc</a> =       &quot;llvm.OpenCL.image.get.format&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#aca84683e827c1878a38e6e48c83aaebb">GetImageResourceIDFunc</a> =   &quot;llvm.OpenCL.image.get.resource.id&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#a37b0e45cf56c7638f8c603239396a3a5">GetImageSizeFunc</a> =         &quot;llvm.OpenCL.image.get.size&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#a3db2eda519bfc054dd911e32af0d6f4d">GetSamplerResourceIDFunc</a> =
    &quot;llvm.OpenCL.sampler.get.resource.id&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#acaa9c80110705a1f6a598639ae919bfd">ImageFormatArgMDType</a> = &quot;&#95;&#95;llvm&#95;image&#95;format&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#aae90d370f386932f5c8fd2d011c95ddf">ImageSizeArgMDType</a> =   &quot;&#95;&#95;llvm&#95;image&#95;size&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#a96c13058a87c15cd58329360c7eb4236">KernelArgMDNodeNames</a> = &#123;
  &quot;kernel&#95;arg&#95;addr&#95;space&quot;,
  &quot;kernel&#95;arg&#95;access&#95;qual&quot;,
  &quot;kernel&#95;arg&#95;type&quot;,
  &quot;kernel&#95;arg&#95;base&#95;type&quot;,
  &quot;kernel&#95;arg&#95;type&#95;qual&quot;&#125;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#a1e57bf5caf2298139f9ab5fb74999e23">KernelsMDNodeName</a> = &quot;opencl.kernels&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> unsigned</>}
  name={<><a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a> = 5</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This pass resolves calls to OpenCL image attribute, image resource <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> and sampler resource <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> getter functions.

Image attributes (size and format) are expected to be passed to the kernel as kernel arguments immediately following the image argument itself, therefore this pass adds image size and format arguments to the kernel functions in the module. The kernel functions with image arguments are re-created using the new signature. The new arguments are added to the kernel metadata with kernel&#95;arg&#95;type set to &quot;image&#95;size&quot; or &quot;image&#95;format&quot;. Note: this pass may invalidate pointers to functions.

Resource IDs of read-only images, write-only images and samplers are defined to be their index among the kernel arguments of the same type and access qualifier.

<SectionDefinition>

## Functions

### AccessQualFromMD() {#a83b7dc810cf4c3050ff52c245eb0a5e9}

<MemberDefinition
  prototype={<>static StringRef AccessQualFromMD (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; KernelMDNode, unsigned ArgIdx)</>}
  labels = {["static"]}>

Definition at line <a href="#l00110">110</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### ArgTypeFromMD() {#a21caf59ebb50607d80672fa9cbca25d3}

<MemberDefinition
  prototype={<>static StringRef ArgTypeFromMD (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; KernelMDNode, unsigned ArgIdx)</>}
  labels = {["static"]}>

Definition at line <a href="#l00116">116</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### GetArgMD() {#ac63fffbaa27bd0a8d519da317a037d13}

<MemberDefinition
  prototype={<>static MDVector GetArgMD (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; KernelMDNode, unsigned OpIdx)</>}
  labels = {["static"]}>

Definition at line <a href="#l00122">122</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### GetFunctionFromMDNode() {#a5bfeca5996966d19706f2a277e7c2341}

<MemberDefinition
  prototype={<>static Function &#42; GetFunctionFromMDNode (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; Node)</>}
  labels = {["static"]}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### IsImageType() {#a162a731af373b7026fdd1fe8ae54bbe3}

<MemberDefinition
  prototype={<>static bool IsImageType (<a href="/docs/api/classes/llvm/stringref">StringRef</a> TypeString)</>}
  labels = {["inline", "static"]}>

Definition at line <a href="#l00068">68</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### IsSamplerType() {#a834ef6cea23843bec307de03c8a0b73f}

<MemberDefinition
  prototype={<>static bool IsSamplerType (<a href="/docs/api/classes/llvm/stringref">StringRef</a> TypeString)</>}
  labels = {["inline", "static"]}>

Definition at line <a href="#l00073">73</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### PushArgMD() {#a8388ad714d73e79dde0a9e89872e76bb}

<MemberDefinition
  prototype={<>static void PushArgMD (KernelArgMD &amp; MD, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> MDVector &amp; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l00132">132</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### GetImageFormatFunc {#a8c8172d032069b64fa83cc1fb2280c42}

<MemberDefinition
  prototype={<>StringRef GetImageFormatFunc =       &quot;llvm.OpenCL.image.get.format&quot;</>}
  labels = {["static"]}>

Definition at line <a href="#l00041">41</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### GetImageResourceIDFunc {#aca84683e827c1878a38e6e48c83aaebb}

<MemberDefinition
  prototype={<>StringRef GetImageResourceIDFunc =   &quot;llvm.OpenCL.image.get.resource.id&quot;</>}
  labels = {["static"]}>

Definition at line <a href="#l00042">42</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### GetImageSizeFunc {#a37b0e45cf56c7638f8c603239396a3a5}

<MemberDefinition
  prototype={<>StringRef GetImageSizeFunc =         &quot;llvm.OpenCL.image.get.size&quot;</>}
  labels = {["static"]}>

Definition at line <a href="#l00040">40</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### GetSamplerResourceIDFunc {#a3db2eda519bfc054dd911e32af0d6f4d}

<MemberDefinition
  prototype={<>StringRef GetSamplerResourceIDFunc =
    &quot;llvm.OpenCL.sampler.get.resource.id&quot;</>}
  labels = {["static"]}>

Definition at line <a href="#l00043">43</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### ImageFormatArgMDType {#acaa9c80110705a1f6a598639ae919bfd}

<MemberDefinition
  prototype={<>StringRef ImageFormatArgMDType = &quot;&#95;&#95;llvm&#95;image&#95;format&quot;</>}
  labels = {["static"]}>

Definition at line <a href="#l00047">47</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### ImageSizeArgMDType {#aae90d370f386932f5c8fd2d011c95ddf}

<MemberDefinition
  prototype={<>StringRef ImageSizeArgMDType =   &quot;&#95;&#95;llvm&#95;image&#95;size&quot;</>}
  labels = {["static"]}>

Definition at line <a href="#l00046">46</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### KernelArgMDNodeNames {#a96c13058a87c15cd58329360c7eb4236}

<MemberDefinition
  prototype={<>StringRef KernelArgMDNodeNames&#91;&#93; = &#123;
  &quot;kernel&#95;arg&#95;addr&#95;space&quot;,
  &quot;kernel&#95;arg&#95;access&#95;qual&quot;,
  &quot;kernel&#95;arg&#95;type&quot;,
  &quot;kernel&#95;arg&#95;base&#95;type&quot;,
  &quot;kernel&#95;arg&#95;type&#95;qual&quot;&#125;</>}
  labels = {["static"]}>

Definition at line <a href="#l00050">50</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### KernelsMDNodeName {#a1e57bf5caf2298139f9ab5fb74999e23}

<MemberDefinition
  prototype={<>StringRef KernelsMDNodeName = &quot;opencl.kernels&quot;</>}
  labels = {["static"]}>

Definition at line <a href="#l00049">49</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

### NumKernelArgMDNodes {#a4fcd2f7ea81e84dfac669ceb0a6eda56}

<MemberDefinition
  prototype="const unsigned NumKernelArgMDNodes = 5"
  labels = {["static"]}>

Definition at line <a href="#l00056">56</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600openclimagetypeloweringpass-cpp">R600OpenCLImageTypeLoweringPass.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- R600OpenCLImageTypeLoweringPass.cpp ------------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This pass resolves calls to OpenCL image attribute, image resource ID and</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// sampler resource ID getter functions.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">/// Image attributes (size and format) are expected to be passed to the kernel</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">/// as kernel arguments immediately following the image argument itself,</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">/// therefore this pass adds image size and format arguments to the kernel</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">/// functions in the module. The kernel functions with image arguments are</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">/// re-created using the new signature. The new arguments are added to the</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">/// kernel metadata with kernel&#95;arg&#95;type set to &quot;image&#95;size&quot; or &quot;image&#95;format&quot;.</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">/// Note: this pass may invalidate pointers to functions.</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">/// Resource IDs of read-only images, write-only images and samplers are</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">/// defined to be their index among the kernel arguments of the same</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">/// type and access qualifier.</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600-h">R600.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h">llvm/Transforms/Utils/Cloning.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40" lineLink="#a37b0e45cf56c7638f8c603239396a3a5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#a37b0e45cf56c7638f8c603239396a3a5">GetImageSizeFunc</a> =         </span><span class="doxyHighlightStringLiteral">&quot;llvm.OpenCL.image.get.size&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41" lineLink="#a8c8172d032069b64fa83cc1fb2280c42"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#a8c8172d032069b64fa83cc1fb2280c42">GetImageFormatFunc</a> =       </span><span class="doxyHighlightStringLiteral">&quot;llvm.OpenCL.image.get.format&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42" lineLink="#aca84683e827c1878a38e6e48c83aaebb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#aca84683e827c1878a38e6e48c83aaebb">GetImageResourceIDFunc</a> =   </span><span class="doxyHighlightStringLiteral">&quot;llvm.OpenCL.image.get.resource.id&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43" lineLink="#a3db2eda519bfc054dd911e32af0d6f4d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#a3db2eda519bfc054dd911e32af0d6f4d">GetSamplerResourceIDFunc</a> =</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;llvm.OpenCL.sampler.get.resource.id&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46" lineLink="#aae90d370f386932f5c8fd2d011c95ddf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#aae90d370f386932f5c8fd2d011c95ddf">ImageSizeArgMDType</a> =   </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;llvm&#95;image&#95;size&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47" lineLink="#acaa9c80110705a1f6a598639ae919bfd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#acaa9c80110705a1f6a598639ae919bfd">ImageFormatArgMDType</a> = </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;llvm&#95;image&#95;format&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49" lineLink="#a1e57bf5caf2298139f9ab5fb74999e23"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#a1e57bf5caf2298139f9ab5fb74999e23">KernelsMDNodeName</a> = </span><span class="doxyHighlightStringLiteral">&quot;opencl.kernels&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50" lineLink="#a96c13058a87c15cd58329360c7eb4236"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#a96c13058a87c15cd58329360c7eb4236">KernelArgMDNodeNames</a>&#91;&#93; = &#123;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlight">  </span><span class="doxyHighlightStringLiteral">&quot;kernel&#95;arg&#95;addr&#95;space&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlight">  </span><span class="doxyHighlightStringLiteral">&quot;kernel&#95;arg&#95;access&#95;qual&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlight">  </span><span class="doxyHighlightStringLiteral">&quot;kernel&#95;arg&#95;type&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlight">  </span><span class="doxyHighlightStringLiteral">&quot;kernel&#95;arg&#95;base&#95;type&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">  </span><span class="doxyHighlightStringLiteral">&quot;kernel&#95;arg&#95;type&#95;qual&quot;</span><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56" lineLink="#a4fcd2f7ea81e84dfac669ceb0a6eda56"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a> = 5;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58" lineLink="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60" lineLink="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286">MDVector</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 8&gt;</a>;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61" lineLink="/docs/api/structs/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/kernelargmd"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/kernelargmd">KernelArgMD</a> &#123;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62" lineLink="/docs/api/structs/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/kernelargmd/#ae84dc9f84e7d15b70e5d385501a7898f"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286">MDVector</a> <a href="/docs/api/structs/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/kernelargmd/#ae84dc9f84e7d15b70e5d385501a7898f">ArgVector</a>&#91;<a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a>&#93;;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68" lineLink="#a162a731af373b7026fdd1fe8ae54bbe3"><span class="doxyHighlight"><a href="#a162a731af373b7026fdd1fe8ae54bbe3">IsImageType</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> TypeString) &#123;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TypeString == </span><span class="doxyHighlightStringLiteral">&quot;image2d&#95;t&quot;</span><span class="doxyHighlight"> || TypeString == </span><span class="doxyHighlightStringLiteral">&quot;image3d&#95;t&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73" lineLink="#a834ef6cea23843bec307de03c8a0b73f"><span class="doxyHighlight"><a href="#a834ef6cea23843bec307de03c8a0b73f">IsSamplerType</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> TypeString) &#123;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TypeString == </span><span class="doxyHighlightStringLiteral">&quot;sampler&#95;t&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#a5bfeca5996966d19706f2a277e7c2341"><span class="doxyHighlight"><a href="#a5bfeca5996966d19706f2a277e7c2341">GetFunctionFromMDNode</a>(<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/classes/node">Node</a>) &#123;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/node">Node</a>)</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a536e22898d28a9340a4204407a75ad5d">NumOps</a> = <a href="/docs/api/classes/node">Node</a>-&gt;getNumOperands();</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a536e22898d28a9340a4204407a75ad5d">NumOps</a> != <a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a> + 1)</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/mdconst/#ad7ca5290dc5789cbeae763690e6edccf">mdconst::dyn&#95;extract&lt;Function&gt;</a>(<a href="/docs/api/classes/node">Node</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Validation checks.</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> ExpectNumArgNodeOps = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;size() + 1;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> i = 0; i &lt; <a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a>; ++i) &#123;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;ArgNode = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;MDNode&gt;</a>(<a href="/docs/api/classes/node">Node</a>-&gt;getOperand(i + 1));</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>() != ExpectNumArgNodeOps)</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ArgNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(0))</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: It should be possible to do image lowering when some metadata</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// args missing or not in the expected order.</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdstring">MDString</a> &#42;StringNode = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDString&gt;</a>(ArgNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(0));</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StringNode || StringNode-&gt;<a href="/docs/api/classes/llvm/mdstring/#ae44259d9edd71181ea8b89d18f27a967">getString</a>() != <a href="#a96c13058a87c15cd58329360c7eb4236">KernelArgMDNodeNames</a>&#91;i&#93;)</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a></span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="#a83b7dc810cf4c3050ff52c245eb0a5e9"><span class="doxyHighlight"><a href="#a83b7dc810cf4c3050ff52c245eb0a5e9">AccessQualFromMD</a>(<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;KernelMDNode, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgIdx) &#123;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;ArgAQNode = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDNode&gt;</a>(KernelMDNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(2));</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDString&gt;</a>(ArgAQNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(ArgIdx + 1))-&gt;getString();</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a></span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116" lineLink="#a21caf59ebb50607d80672fa9cbca25d3"><span class="doxyHighlight"><a href="#a21caf59ebb50607d80672fa9cbca25d3">ArgTypeFromMD</a>(<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;KernelMDNode, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgIdx) &#123;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;ArgTypeNode = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDNode&gt;</a>(KernelMDNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(3));</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDString&gt;</a>(ArgTypeNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(ArgIdx + 1))-&gt;getString();</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286">MDVector</a></span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122" lineLink="#ac63fffbaa27bd0a8d519da317a037d13"><span class="doxyHighlight"><a href="#ac63fffbaa27bd0a8d519da317a037d13">GetArgMD</a>(<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;KernelMDNode, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpIdx) &#123;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286">MDVector</a> Res;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; <a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a>; ++i) &#123;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/classes/node">Node</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDNode&gt;</a>(KernelMDNode-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(i + 1));</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">    Res.push&#95;back(<a href="/docs/api/classes/node">Node</a>-&gt;getOperand(OpIdx));</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132" lineLink="#a8388ad714d73e79dde0a9e89872e76bb"><span class="doxyHighlight"><a href="#a8388ad714d73e79dde0a9e89872e76bb">PushArgMD</a>(KernelArgMD &amp;MD, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286">MDVector</a> &amp;V) &#123;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V.size() == <a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a>);</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; <a href="#a4fcd2f7ea81e84dfac669ceb0a6eda56">NumKernelArgMDNodes</a>; ++i) &#123;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">    MD.ArgVector&#91;i&#93;.push&#95;back(V&#91;i&#93;);</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141" lineLink="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#a81933f977a3c3660e015881adf89ae2b">R600OpenCLImageTypeLoweringPass</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a> &#123;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> ID;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &#42;Context;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Int32Type;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ImageSizeType;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ImageFormatType;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> InstsToErase;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> replaceImageUses(<a href="/docs/api/classes/llvm/argument">Argument</a> &amp;ImageArg, uint32&#95;t ResourceID,</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;ImageSizeArg,</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;ImageFormatArg) &#123;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/use">Use</a> : ImageArg.<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>());</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst) &#123;</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Inst-&gt;getCalledFunction();</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Replacement = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName();</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Name.starts&#95;with(<a href="#aca84683e827c1878a38e6e48c83aaebb">GetImageResourceIDFunc</a>)) &#123;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">        Replacement = ConstantInt::get(Int32Type, ResourceID);</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Name.starts&#95;with(<a href="#a37b0e45cf56c7638f8c603239396a3a5">GetImageSizeFunc</a>)) &#123;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">        Replacement = &amp;ImageSizeArg;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Name.starts&#95;with(<a href="#a8c8172d032069b64fa83cc1fb2280c42">GetImageFormatFunc</a>)) &#123;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">        Replacement = &amp;ImageFormatArg;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">      Inst-&gt;replaceAllUsesWith(Replacement);</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">      InstsToErase.push&#95;back(Inst);</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> replaceSamplerUses(<a href="/docs/api/classes/llvm/argument">Argument</a> &amp;SamplerArg, uint32&#95;t ResourceID) &#123;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/use">Use</a> : SamplerArg.<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>());</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst) &#123;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Inst-&gt;getCalledFunction();</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Replacement = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName();</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Name == <a href="#a3db2eda519bfc054dd911e32af0d6f4d">GetSamplerResourceIDFunc</a>) &#123;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">        Replacement = ConstantInt::get(Int32Type, ResourceID);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">      Inst-&gt;replaceAllUsesWith(Replacement);</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">      InstsToErase.push&#95;back(Inst);</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> replaceImageAndSamplerUses(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;KernelMDNode) &#123;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    uint32&#95;t NumReadOnlyImageArgs = 0;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    uint32&#95;t NumWriteOnlyImageArgs = 0;</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">    uint32&#95;t NumSamplerArgs = 0;</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">    InstsToErase.clear();</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArgI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;begin(); ArgI != <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;end(); ++ArgI) &#123;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;Arg = &#42;ArgI;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/llvm/type">Type</a> = <a href="#a21caf59ebb50607d80672fa9cbca25d3">ArgTypeFromMD</a>(KernelMDNode, Arg.<a href="/docs/api/classes/llvm/argument/#ab205d366b1137026c32f5678f7cc2726">getArgNo</a>());</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Handle image types.</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a162a731af373b7026fdd1fe8ae54bbe3">IsImageType</a>(<a href="/docs/api/classes/llvm/type">Type</a>)) &#123;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/stringref">StringRef</a> AccessQual = <a href="#a83b7dc810cf4c3050ff52c245eb0a5e9">AccessQualFromMD</a>(KernelMDNode, Arg.<a href="/docs/api/classes/llvm/argument/#ab205d366b1137026c32f5678f7cc2726">getArgNo</a>());</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">        uint32&#95;t ResourceID;</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AccessQual == </span><span class="doxyHighlightStringLiteral">&quot;read&#95;only&quot;</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">          ResourceID = NumReadOnlyImageArgs++;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AccessQual == </span><span class="doxyHighlightStringLiteral">&quot;write&#95;only&quot;</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">          ResourceID = NumWriteOnlyImageArgs++;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Wrong image access qualifier.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;SizeArg = &#42;(++ArgI);</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;FormatArg = &#42;(++ArgI);</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= replaceImageUses(Arg, ResourceID, SizeArg, FormatArg);</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Handle sampler type.</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a834ef6cea23843bec307de03c8a0b73f">IsSamplerType</a>(<a href="/docs/api/classes/llvm/type">Type</a>)) &#123;</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">        uint32&#95;t ResourceID = NumSamplerArgs++;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= replaceSamplerUses(Arg, ResourceID);</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst : InstsToErase)</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">      Inst-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  std::tuple&lt;Function &#42;, MDNode &#42;&gt;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  addImplicitArgs(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;KernelMDNode) &#123;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FT = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType();</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;, 8&gt;</a> ArgTypes;</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Metadata operands for new MDNode.</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/kernelargmd">KernelArgMD</a> NewArgMDs;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">    <a href="#a8388ad714d73e79dde0a9e89872e76bb">PushArgMD</a>(NewArgMDs, <a href="#ac63fffbaa27bd0a8d519da317a037d13">GetArgMD</a>(KernelMDNode, 0));</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add implicit arguments to the signature.</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; FT-&gt;<a href="/docs/api/classes/llvm/functiontype/#a104d6154321899b53e40455e71d8e83a">getNumParams</a>(); ++i) &#123;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">      ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FT-&gt;<a href="/docs/api/classes/llvm/functiontype/#a1e415dc42f391c1d0cfcc1c28c00b2f4">getParamType</a>(i));</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286">MDVector</a> ArgMD = <a href="#ac63fffbaa27bd0a8d519da317a037d13">GetArgMD</a>(KernelMDNode, i + 1);</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">      <a href="#a8388ad714d73e79dde0a9e89872e76bb">PushArgMD</a>(NewArgMDs, ArgMD);</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a162a731af373b7026fdd1fe8ae54bbe3">IsImageType</a>(<a href="#a21caf59ebb50607d80672fa9cbca25d3">ArgTypeFromMD</a>(KernelMDNode, i)))</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add size implicit argument.</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">      ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ImageSizeType);</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">      ArgMD&#91;2&#93; = ArgMD&#91;3&#93; = <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(&#42;Context, <a href="#aae90d370f386932f5c8fd2d011c95ddf">ImageSizeArgMDType</a>);</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">      <a href="#a8388ad714d73e79dde0a9e89872e76bb">PushArgMD</a>(NewArgMDs, ArgMD);</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add format implicit argument.</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">      ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ImageFormatType);</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">      ArgMD&#91;2&#93; = ArgMD&#91;3&#93; = <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(&#42;Context, <a href="#acaa9c80110705a1f6a598639ae919bfd">ImageFormatArgMDType</a>);</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">      <a href="#a8388ad714d73e79dde0a9e89872e76bb">PushArgMD</a>(NewArgMDs, ArgMD);</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>) &#123;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::tuple(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create function with new signature and clone the old body into it.</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewFT = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(FT-&gt;<a href="/docs/api/classes/llvm/functiontype/#ad65790aa94dd4678a1d339d8304e1965">getReturnType</a>(), ArgTypes, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewF = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(NewFT, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getLinkage(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName());</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> VMap;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewFArgIt = NewF-&gt;arg&#95;begin();</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Arg: <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;args()) &#123;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ArgName = Arg.getName();</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">      NewFArgIt-&gt;setName(ArgName);</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">      VMap&#91;&amp;Arg&#93; = &amp;(&#42;NewFArgIt++);</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a162a731af373b7026fdd1fe8ae54bbe3">IsImageType</a>(<a href="#a21caf59ebb50607d80672fa9cbca25d3">ArgTypeFromMD</a>(KernelMDNode, Arg.getArgNo()))) &#123;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">        (NewFArgIt++)-&gt;setName(<a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;size&#95;&quot;</span><span class="doxyHighlight">) + ArgName);</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">        (NewFArgIt++)-&gt;setName(<a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;format&#95;&quot;</span><span class="doxyHighlight">) + ArgName);</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ReturnInst&#42;, 8&gt;</a> Returns;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac1b2be839460bb277d4f07f4aa5225ac">CloneFunctionInto</a>(NewF, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, VMap, <a href="/docs/api/namespaces/llvm/#abe00617fc34ceb1aa0eb62995732b30aa68b46a44773674a07e6730fac74fc46b">CloneFunctionChangeType::LocalChangesOnly</a>,</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">                      Returns);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Build new MDNode.</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 6&gt;</a> KernelMDArgs;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">    KernelMDArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(NewF));</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-r600openclimagetypeloweringpass-cpp-/#a64afb603d512ba3948b4abd08e716286">MDVector</a> &amp;MDV : NewArgMDs.<a href="/docs/api/structs/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/kernelargmd/#ae84dc9f84e7d15b70e5d385501a7898f">ArgVector</a>)</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">      KernelMDArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(&#42;Context, MDV));</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewMDNode = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(&#42;Context, KernelMDArgs);</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::tuple(NewF, NewMDNode);</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> transformKernels(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/namedmdnode">NamedMDNode</a> &#42;KernelsMDNode = M.getNamedMetadata(<a href="#a1e57bf5caf2298139f9ab5fb74999e23">KernelsMDNodeName</a>);</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!KernelsMDNode)</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; KernelsMDNode-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#acde8007e0e69969423e2de52343b702f">getNumOperands</a>(); ++i) &#123;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;KernelMDNode = KernelsMDNode-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#aa24b566603d206b0e74bf63daf521078">getOperand</a>(i);</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="#a5bfeca5996966d19706f2a277e7c2341">GetFunctionFromMDNode</a>(KernelMDNode);</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;NewF;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewMDNode;</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">      std::tie(NewF, NewMDNode) = addImplicitArgs(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, KernelMDNode);</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewF) &#123;</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Replace old function and metadata with new ones.</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">        M.getFunctionList().push&#95;back(NewF);</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">        M.getOrInsertFunction(NewF-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(), NewF-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>(),</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">                              NewF-&gt;<a href="/docs/api/classes/llvm/function/#a7477aafbbe989ad35b96fac186d8e9fd">getAttributes</a>());</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">        KernelsMDNode-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#a543df3cb1eda9d491a7822ef4216e3b1">setOperand</a>(i, NewMDNode);</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = NewF;</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">        KernelMDNode = NewMDNode;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= replaceImageAndSamplerUses(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, KernelMDNode);</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352" lineLink="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#a81933f977a3c3660e015881adf89ae2b"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#a81933f977a3c3660e015881adf89ae2b">R600OpenCLImageTypeLoweringPass</a>() : <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a>(ID) &#123;&#125;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354" lineLink="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#acf970c313d62e284e7c40d5dfddb1ccb"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#acf970c313d62e284e7c40d5dfddb1ccb">runOnModule</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M)</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    Context = &amp;M.getContext();</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    Int32Type = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext());</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    ImageSizeType = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int32Type, 3);</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">    ImageFormatType = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int32Type, 2);</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> transformKernels(M);</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363" lineLink="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#ae88de1de84c5363c2c7689b5f8a4aa4c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#ae88de1de84c5363c2c7689b5f8a4aa4c">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;R600 OpenCL Image Type Pass&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> R600OpenCLImageTypeLoweringPass::ID = 0;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372" lineLink="/docs/api/namespaces/llvm/#aa21e10c20c38a113fe8f605b018ec325"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/modulepass">ModulePass</a> &#42;<a href="/docs/api/namespaces/llvm/#aa21e10c20c38a113fe8f605b018ec325">llvm::createR600OpenCLImageTypeLoweringPass</a>() &#123;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-r600openclimagetypeloweringpass-cpp-/r600openclimagetypeloweringpass/#a81933f977a3c3660e015881adf89ae2b">R600OpenCLImageTypeLoweringPass</a>();</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
