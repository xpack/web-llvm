---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `PromoteMemoryToRegister.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/BitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/bitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Twine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/IteratedDominanceFrontier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/iterateddominancefrontier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugProgramInstruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugprograminstruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/PromoteMemToReg.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/promotememtoreg-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-promotememorytoregister-cpp-">anonymous&#123;PromoteMemoryToRegister.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo">AssignmentTrackingInfo</a></>}>
Helper for updating assignment tracking debug info when promoting allocas. <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo">AllocaInfo</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata">RenamePassData</a></>}>
Data package used by RenamePass(). <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo">LargeBlockInfo</a></>}>
This assigns and keeps a per-bb relative ordering of load/store instructions in the block that directly load or store an alloca. <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg">PromoteMem2Reg</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#aebae63f31076e8c0dfe153c45a730497">addAssumeNonNull</a> (AssumptionCache &#42;AC, LoadInst &#42;LI)</>}>
Given a <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> LI this adds assume(LI != null) after it. <a href="#aebae63f31076e8c0dfe153c45a730497">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a125e2946cdcc7555d8f5c383681d7097">convertMetadataToAssumes</a> (LoadInst &#42;LI, Value &#42;Val, const DataLayout &amp;DL, AssumptionCache &#42;AC, const DominatorTree &#42;DT)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6952450f0726bd9c26d303743522e227">promoteSingleBlockAlloca</a> (AllocaInst &#42;AI, const AllocaInfo &amp;Info, LargeBlockInfo &amp;LBI, const DataLayout &amp;DL, DominatorTree &amp;DT, AssumptionCache &#42;AC, SmallSet&lt; DbgAssignIntrinsic &#42;, 8 &gt; &#42;DbgAssignsToDelete, SmallSet&lt; DbgVariableRecord &#42;, 8 &gt; &#42;DVRAssignsToDelete)</>}>
Many allocas are only used within a single basic block. <a href="#a6952450f0726bd9c26d303743522e227">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a82f896385cac84a2e477159ad31ace74">removeIntrinsicUsers</a> (AllocaInst &#42;AI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aa231a7e6d411bd4797afdd6f0a1f8d6a">rewriteSingleStoreAlloca</a> (AllocaInst &#42;AI, AllocaInfo &amp;Info, LargeBlockInfo &amp;LBI, const DataLayout &amp;DL, DominatorTree &amp;DT, AssumptionCache &#42;AC, SmallSet&lt; DbgAssignIntrinsic &#42;, 8 &gt; &#42;DbgAssignsToDelete, SmallSet&lt; DbgVariableRecord &#42;, 8 &gt; &#42;DVRAssignsToDelete)</>}>
Rewrite as many loads as possible given a single store. <a href="#aa231a7e6d411bd4797afdd6f0a1f8d6a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a23f400c4c78f746c575f969823415e2f">STATISTIC</a> (NumLocalPromoted, &quot;Number of alloca&#39;s promoted within one block&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af2aeceb006a1f7f568eb45e1fcd2986e">STATISTIC</a> (NumSingleStore, &quot;Number of alloca&#39;s promoted with a single store&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4362c536a14ff9f260dec257102ad443">STATISTIC</a> (NumDeadAlloca, &quot;Number of dead alloca&#39;s removed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a5f663d06bb77b6b83e8d63f96e574528">STATISTIC</a> (NumPHIInsert, &quot;Number of PHI nodes inserted&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a957b517efddeb68617e18ffef3b64683">updateForIncomingValueLocation</a> (PHINode &#42;PN, DebugLoc DL, bool ApplyMergedLoc)</>}>
Update the debug location of a phi. <a href="#a957b517efddeb68617e18ffef3b64683">More...</a>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;mem2reg&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### addAssumeNonNull() {#aebae63f31076e8c0dfe153c45a730497}

<MemberDefinition
  prototype={<>static void addAssumeNonNull (<a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42; LI)</>}
  labels = {["static"]}>
Given a <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> LI this adds assume(LI != null) after it.

Definition at line <a href="#l00446">446</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### convertMetadataToAssumes() {#a125e2946cdcc7555d8f5c383681d7097}

<MemberDefinition
  prototype={<>static void convertMetadataToAssumes (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42; LI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>

Definition at line <a href="#l00457">457</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### promoteSingleBlockAlloca() {#a6952450f0726bd9c26d303743522e227}

<MemberDefinition
  prototype={<>static bool promoteSingleBlockAlloca (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; AI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> AllocaInfo &amp; Info, LargeBlockInfo &amp; LBI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;, 8 &gt; &#42; DbgAssignsToDelete, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;, 8 &gt; &#42; DVRAssignsToDelete)</>}
  labels = {["static"]}>
Many allocas are only used within a single basic block.

If this is the case, avoid traversing the CFG and inserting a lot of potentially useless PHI nodes by just performing a single linear pass over the basic block using the Alloca.

If we cannot promote this alloca (because it is read before it is written), return false. This is necessary in cases where, due to control flow, the alloca is undefined only on some control flow paths. e.g. code like this is correct in LLVM IR: // A is an alloca with no stores so far for (...) &#123; int t = &#42;A; if (!first&#95;iteration) <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/localizer-cpp/#a428090a453f41a199ef67fc3f2179fbc">use(t)</a>; &#42;A = 42; &#125;

Definition at line <a href="#l00641">641</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### removeIntrinsicUsers() {#a82f896385cac84a2e477159ad31ace74}

<MemberDefinition
  prototype={<>static void removeIntrinsicUsers (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; AI)</>}
  labels = {["static"]}>

Definition at line <a href="#l00479">479</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### rewriteSingleStoreAlloca() {#aa231a7e6d411bd4797afdd6f0a1f8d6a}

<MemberDefinition
  prototype={<>static bool rewriteSingleStoreAlloca (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; AI, AllocaInfo &amp; Info, LargeBlockInfo &amp; LBI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;, 8 &gt; &#42; DbgAssignsToDelete, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;, 8 &gt; &#42; DVRAssignsToDelete)</>}
  labels = {["static"]}>
Rewrite as many loads as possible given a single store.

When there is only a single store, we can use the domtree to trivially replace all of the dominated loads with the stored value. Do so, and return true if this has successfully promoted the alloca entirely. If this returns false there were some loads which were not dominated by the single store and thus must be phi-ed with undef. We fall back to the standard alloca promotion algorithm in that case.

Definition at line <a href="#l00522">522</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a23f400c4c78f746c575f969823415e2f}

<MemberDefinition
  prototype={<>STATISTIC (NumLocalPromoted, &quot;Number of alloca&#39;s promoted within one block&quot;)</>}>

Definition at line <a href="#l00061">61</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### STATISTIC() {#af2aeceb006a1f7f568eb45e1fcd2986e}

<MemberDefinition
  prototype={<>STATISTIC (NumSingleStore, &quot;Number of alloca&#39;s promoted with a single store&quot;)</>}>

Definition at line <a href="#l00062">62</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4362c536a14ff9f260dec257102ad443}

<MemberDefinition
  prototype={<>STATISTIC (NumDeadAlloca, &quot;Number of dead alloca&#39;s removed&quot;)</>}>

Definition at line <a href="#l00063">63</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a5f663d06bb77b6b83e8d63f96e574528}

<MemberDefinition
  prototype={<>STATISTIC (NumPHIInsert, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuunifydivergentexitnodes-cpp/#aaa253dd3e56c37edd403113782c0ef94">nodes</a> inserted&quot;)</>}>

Definition at line <a href="#l00064">64</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

### updateForIncomingValueLocation() {#a957b517efddeb68617e18ffef3b64683}

<MemberDefinition
  prototype={<>static void updateForIncomingValueLocation (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL, bool ApplyMergedLoc)</>}
  labels = {["static"]}>
Update the debug location of a phi.

<code>ApplyMergedLoc</code> indicates whether to create a merged location incorporating <code>DL</code>, or to set <code>DL</code> directly.

Definition at line <a href="#l01088">1088</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;mem2reg&quot;</>}>

Definition at line <a href="#l00059">59</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/promotememorytoregister-cpp">PromoteMemoryToRegister.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- PromoteMemoryToRegister.cpp - Convert allocas to registers ---------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file promotes memory references to be register references.  It promotes</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// alloca instructions which only have loads and stores as uses.  An alloca is</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// transformed by using iterated dominator frontiers to place PHI nodes, then</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// traversing the function in depth-first order to rewrite loads and stores as</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// appropriate.</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/bitvector-h">llvm/ADT/BitVector.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h">llvm/ADT/Twine.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/iterateddominancefrontier-h">llvm/Analysis/IteratedDominanceFrontier.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugprograminstruction-h">llvm/IR/DebugProgramInstruction.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/promotememtoreg-h">llvm/Transforms/Utils/PromoteMemToReg.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &lt;vector&gt;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;mem2reg&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61" lineLink="#a23f400c4c78f746c575f969823415e2f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLocalPromoted, </span><span class="doxyHighlightStringLiteral">&quot;Number of alloca&#39;s promoted within one block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62" lineLink="#af2aeceb006a1f7f568eb45e1fcd2986e"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSingleStore,   </span><span class="doxyHighlightStringLiteral">&quot;Number of alloca&#39;s promoted with a single store&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63" lineLink="#a4362c536a14ff9f260dec257102ad443"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDeadAlloca,    </span><span class="doxyHighlightStringLiteral">&quot;Number of dead alloca&#39;s removed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64" lineLink="#a5f663d06bb77b6b83e8d63f96e574528"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPHIInsert,     </span><span class="doxyHighlightStringLiteral">&quot;Number of PHI nodes inserted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66" lineLink="/docs/api/namespaces/llvm/#a5023b360abc7a5d1612061fba30003a6"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a5023b360abc7a5d1612061fba30003a6">llvm::isAllocaPromotable</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI) &#123;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only allow direct and non-volatile loads and stores...</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note that atomic loads can be transformed; atomic semantics do</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// not have any meaning for a local alloca.</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;isVolatile() || LI-&gt;getType() != AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>())</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand() == AI ||</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType() != AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>())</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Don&#39;t allow a store OF the AI, only INTO the AI.</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note that atomic stores can be transformed; atomic semantics do</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// not have any meaning for a local alloca.</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isVolatile())</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isLifetimeStartOrEnd() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isDroppable() &amp;&amp;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() != Intrinsic::fake&#95;use)</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a2fee581950cbb705c10d71b6f175c1f1">onlyUsedByLifetimeMarkersOrDroppableInsts</a>(BCI))</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;GEPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GEPI-&gt;hasAllZeroIndices())</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a2fee581950cbb705c10d71b6f175c1f1">onlyUsedByLifetimeMarkersOrDroppableInsts</a>(GEPI))</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/addrspacecastinst">AddrSpaceCastInst</a> &#42;ASCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AddrSpaceCastInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a9d0a7040918ba81ef34046fd474cee10">onlyUsedByLifetimeMarkers</a>(ASCI))</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105" lineLink="/docs/api/namespaces/anonymous-promotememorytoregister-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="/docs/api/namespaces/anonymous-promotememorytoregister-cpp-/#a9d4100416db594644cb6cd161b245636"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-promotememorytoregister-cpp-/#a9d4100416db594644cb6cd161b245636">createDebugValue</a>(<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;DIB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewValue,</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/dilocalvariable">DILocalVariable</a> &#42;Variable,</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;<a href="/docs/api/classes/llvm/expression">Expression</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;DI,</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;InsertBefore) &#123;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Merge these two functions now that DIBuilder supports</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DbgVariableRecords. We neeed the API to accept DbgVariableRecords as an</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// insert point for that to work.</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">  (void)DIB;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dbgvariablerecord/#a8337b222b982e9caf0f6226efb56039c">DbgVariableRecord::createDbgVariableRecord</a>(NewValue, Variable, <a href="/docs/api/classes/llvm/expression">Expression</a>, DI,</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">                                             &#42;InsertBefore);</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118" lineLink="/docs/api/namespaces/anonymous-promotememorytoregister-cpp-/#acce7135d82ed41802b7c4ccd9059d3db"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-promotememorytoregister-cpp-/#a9d4100416db594644cb6cd161b245636">createDebugValue</a>(<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;DIB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewValue,</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/dilocalvariable">DILocalVariable</a> &#42;Variable,</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;<a href="/docs/api/classes/llvm/expression">Expression</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;DI,</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertBefore) &#123;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  DIB.<a href="/docs/api/classes/llvm/dibuilder/#a915a8d23e084b7a40475a3ce2245495b">insertDbgValueIntrinsic</a>(NewValue, Variable, <a href="/docs/api/classes/llvm/expression">Expression</a>, DI,</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">                              InsertBefore-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightComment">/// Helper for updating assignment tracking debug info when promoting allocas.</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo">AssignmentTrackingInfo</a> &#123;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightComment">  /// DbgAssignIntrinsics linked to the alloca with at most one per variable</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightComment">  /// fragment. (i.e. not be a comprehensive set if there are multiple</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightComment">  /// dbg.assigns for one variable fragment).</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;&gt;</a> DbgAssigns;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;&gt;</a> DVRAssigns;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#ab80aaa2bd158207080b9e7345a12fce3"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#ab80aaa2bd158207080b9e7345a12fce3">init</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI) &#123;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DebugVariable, 2&gt;</a> Vars;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;DAI : <a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(AI)) &#123;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Vars.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(DAI)).second)</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">        DbgAssigns.push&#95;back(DAI);</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR : <a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(AI)) &#123;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Vars.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(DVR)).second)</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">        DVRAssigns.push&#95;back(DVR);</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlightComment">  /// Update assignment tracking debug info given for the to-be-deleted store</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlightComment">  /// \\p ToDelete that stores to this alloca.</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#a92fba2b8745329ee14995b36cf720f68"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#a92fba2b8745329ee14995b36cf720f68">updateForDeletedStore</a>(</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;ToDelete, <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;DIB,</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgAssignIntrinsic &#42;, 8&gt;</a> &#42;DbgAssignsToDelete,</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgVariableRecord &#42;, 8&gt;</a> &#42;DVRAssignsToDelete)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There&#39;s nothing to do if the alloca doesn&#39;t have any variables using</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// assignment tracking.</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgAssigns.empty() &amp;&amp; DVRAssigns.empty())</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert a dbg.value where the linked dbg.assign is and remember to delete</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the dbg.assign later. Demoting to dbg.value isn&#39;t necessary for</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// correctness but does reduce compile time and memory usage by reducing</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unnecessary function-local metadata. Remember that we&#39;ve seen a</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dbg.assign for each variable fragment for the untracked store handling</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (after this loop).</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DebugVariableAggregate, 2&gt;</a> VarHasDbgAssignForStore;</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertValueForAssign = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgAssign, </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;&amp;AssignList) &#123;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">      VarHasDbgAssignForStore.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/classes/llvm/debugvariableaggregate">DebugVariableAggregate</a>(DbgAssign));</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">      AssignList-&gt;insert(DbgAssign);</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-promotememorytoregister-cpp-/#a9d4100416db594644cb6cd161b245636">createDebugValue</a>(DIB, DbgAssign-&gt;getValue(), DbgAssign-&gt;getVariable(),</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">                       DbgAssign-&gt;getExpression(), DbgAssign-&gt;getDebugLoc(),</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">                       DbgAssign);</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Assign : <a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(ToDelete))</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">      InsertValueForAssign(Assign, DbgAssignsToDelete);</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Assign : <a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(ToDelete))</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">      InsertValueForAssign(Assign, DVRAssignsToDelete);</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It&#39;s possible for variables using assignment tracking to have no</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dbg.assign linked to this store. These are variables in DbgAssigns that</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// are missing from VarHasDbgAssignForStore. Since there isn&#39;t a dbg.assign</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to mark the assignment - and the store is going to be deleted - insert a</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dbg.value to do that now. An untracked store may be either one that</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cannot be represented using assignment tracking (non-const offset or</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// size) or one that is trackable but has had its DIAssignID attachment</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dropped accidentally.</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ConvertUnlinkedAssignToValue = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Assign) &#123;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VarHasDbgAssignForStore.<a href="/docs/api/classes/llvm/smallset/#ae04ad615dfdd885e85cbddda146787c6">contains</a>(<a href="/docs/api/classes/llvm/debugvariableaggregate">DebugVariableAggregate</a>(Assign)))</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(Assign, ToDelete, DIB);</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(DbgAssigns, ConvertUnlinkedAssignToValue);</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(DVRAssigns, ConvertUnlinkedAssignToValue);</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlightComment">  /// Update assignment tracking debug info given for the newly inserted PHI \\p</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlightComment">  /// NewPhi.</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#a56429811b5f786d2947ef28afce6b73e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#a56429811b5f786d2947ef28afce6b73e">updateForNewPhi</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPhi, <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;DIB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Regardless of the position of dbg.assigns relative to stores, the</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// incoming values into a new PHI should be the same for the (imaginary)</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// debug-phi.</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DAI : DbgAssigns)</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DAI, NewPhi, DIB);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DVR : DVRAssigns)</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DVR, NewPhi, DIB);</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#a60f37f9638cd763faec254fc8a46bdf2"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#a60f37f9638cd763faec254fc8a46bdf2">clear</a>() &#123;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">    DbgAssigns.clear();</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    DVRAssigns.clear();</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#abc3a4632779c2492c794b8df418b434e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo/#abc3a4632779c2492c794b8df418b434e">empty</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DbgAssigns.empty() &amp;&amp; DVRAssigns.empty(); &#125;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo">AllocaInfo</a> &#123;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#af92bd826e452bca7dd9a17645b0a9c86"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#af92bd826e452bca7dd9a17645b0a9c86">DbgUserVec</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 1&gt;</a>;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a7bda92b1076ceabc0f7dc0026215bca8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a7bda92b1076ceabc0f7dc0026215bca8">DPUserVec</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 1&gt;</a>;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a38629ecb438041843cbb54c99392af7d"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a38629ecb438041843cbb54c99392af7d">DefiningBlocks</a>;</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a1ccb40a621418ae685d490be9a883cd6"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a1ccb40a621418ae685d490be9a883cd6">UsingBlocks</a>;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a2e4a8667412a4827dafe780069e672a9"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a2e4a8667412a4827dafe780069e672a9">OnlyStore</a>;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a85738eb1a501216794d170a273c68309"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a85738eb1a501216794d170a273c68309">OnlyBlock</a>;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a5fb70e236519f5b4e4896c60610b175e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a5fb70e236519f5b4e4896c60610b175e">OnlyUsedInOneBlock</a>;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlightComment">  /// Debug users of the alloca - does not include dbg.assign intrinsics.</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aef169a6a4e10355b9647a624f28f79c1"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#af92bd826e452bca7dd9a17645b0a9c86">DbgUserVec</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aef169a6a4e10355b9647a624f28f79c1">DbgUsers</a>;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a47fd4faf1faf8974cb0e7873a01894d8"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a7bda92b1076ceabc0f7dc0026215bca8">DPUserVec</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a47fd4faf1faf8974cb0e7873a01894d8">DPUsers</a>;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlightComment">  /// Helper to update assignment tracking debug info.</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aba65788ec2b9209b64ebe06e3109c318"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/assignmenttrackinginfo">AssignmentTrackingInfo</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aba65788ec2b9209b64ebe06e3109c318">AssignmentTracking</a>;</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a4cbb30bd3251ea3883b81430e81ced46"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a4cbb30bd3251ea3883b81430e81ced46">clear</a>() &#123;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a38629ecb438041843cbb54c99392af7d">DefiningBlocks</a>.clear();</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a1ccb40a621418ae685d490be9a883cd6">UsingBlocks</a>.clear();</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a2e4a8667412a4827dafe780069e672a9">OnlyStore</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a85738eb1a501216794d170a273c68309">OnlyBlock</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a5fb70e236519f5b4e4896c60610b175e">OnlyUsedInOneBlock</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aef169a6a4e10355b9647a624f28f79c1">DbgUsers</a>.clear();</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a47fd4faf1faf8974cb0e7873a01894d8">DPUsers</a>.clear();</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aba65788ec2b9209b64ebe06e3109c318">AssignmentTracking</a>.clear();</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlightComment">  /// Scan the uses of the specified alloca, filling in the AllocaInfo used</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlightComment">  /// by the rest of the pass to reason about the uses of this alloca.</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aed57a9dd738a483f6ac02904b981c94d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aed57a9dd738a483f6ac02904b981c94d">AnalyzeAlloca</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI) &#123;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a4cbb30bd3251ea3883b81430e81ced46">clear</a>();</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// As we scan the uses of the alloca instruction, keep track of stores,</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and decide whether all of the loads and stores to the alloca are within</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the same basic block.</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remember the basic blocks which define new values for the alloca</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a38629ecb438041843cbb54c99392af7d">DefiningBlocks</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent());</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a2e4a8667412a4827dafe780069e672a9">OnlyStore</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>;</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Otherwise it must be a load instruction, keep track of variable</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// reads.</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a1ccb40a621418ae685d490be9a883cd6">UsingBlocks</a>.push&#95;back(LI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a5fb70e236519f5b4e4896c60610b175e">OnlyUsedInOneBlock</a>) &#123;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a85738eb1a501216794d170a273c68309">OnlyBlock</a>)</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a85738eb1a501216794d170a273c68309">OnlyBlock</a> = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a85738eb1a501216794d170a273c68309">OnlyBlock</a> != <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent())</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a5fb70e236519f5b4e4896c60610b175e">OnlyUsedInOneBlock</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#af92bd826e452bca7dd9a17645b0a9c86">DbgUserVec</a> AllDbgUsers;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;&gt;</a> AllDPUsers;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a26bad0f6e5435a5a4dc50850c5b8f628">findDbgUsers</a>(AllDbgUsers, AI, &amp;AllDPUsers);</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">    std::copy&#95;if(AllDbgUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), AllDbgUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>(),</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">                 std::back&#95;inserter(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aef169a6a4e10355b9647a624f28f79c1">DbgUsers</a>), &#91;&#93;(<a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42;DII) &#123;</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">                   return !isa&lt;DbgAssignIntrinsic&gt;(DII);</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">                 &#125;);</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">    std::copy&#95;if(AllDPUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), AllDPUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>(),</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">                 std::back&#95;inserter(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#a47fd4faf1faf8974cb0e7873a01894d8">DPUsers</a>),</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">                 &#91;&#93;(<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR) &#123; return !DVR-&gt;isDbgAssign(); &#125;);</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo/#aba65788ec2b9209b64ebe06e3109c318">AssignmentTracking</a>.init(AI);</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlightComment">/// Data package used by RenamePass().</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a915f29d785997f4266e64348c8a0e2b2">RenamePassData</a> &#123;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18e5b1dbb4e7b1463315c636b916abd0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18e5b1dbb4e7b1463315c636b916abd0">ValVector</a> = std::vector&lt;Value &#42;&gt;;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a81ba17b4e41561256ed0b2a82aaac8ce"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a81ba17b4e41561256ed0b2a82aaac8ce">LocationVector</a> = std::vector&lt;DebugLoc&gt;;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a915f29d785997f4266e64348c8a0e2b2"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a915f29d785997f4266e64348c8a0e2b2">RenamePassData</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18e5b1dbb4e7b1463315c636b916abd0">ValVector</a> V, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a81ba17b4e41561256ed0b2a82aaac8ce">LocationVector</a> L)</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ad93429799d281f5a6534821bc14fa36c">BB</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>), <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ab9573d1a944e1048e7fd1c0c488eced2">Pred</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>), <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#add5219f842875c33a4168bf4bb6b37f5">Values</a>(<a href="/docs/api/namespaces/std">std</a>::<a href="/docs/api/namespaces/llvm/#abfc9c7ecf70f66901e439f7c04ef3dbb">move</a>(V)), <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18184dbfe73aeba751307ac82f0e5209">Locations</a>(<a href="/docs/api/namespaces/std">std</a>::<a href="/docs/api/namespaces/llvm/#abfc9c7ecf70f66901e439f7c04ef3dbb">move</a>(L)) &#123;&#125;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ad93429799d281f5a6534821bc14fa36c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ad93429799d281f5a6534821bc14fa36c">BB</a>;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ab9573d1a944e1048e7fd1c0c488eced2"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ab9573d1a944e1048e7fd1c0c488eced2">Pred</a>;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#add5219f842875c33a4168bf4bb6b37f5"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18e5b1dbb4e7b1463315c636b916abd0">ValVector</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#add5219f842875c33a4168bf4bb6b37f5">Values</a>;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18184dbfe73aeba751307ac82f0e5209"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a81ba17b4e41561256ed0b2a82aaac8ce">LocationVector</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18184dbfe73aeba751307ac82f0e5209">Locations</a>;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlightComment">/// This assigns and keeps a per-bb relative ordering of load/store</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlightComment">/// instructions in the block that directly load or store an alloca.</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlightComment">/// This functionality is important because it avoids scanning large basic</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlightComment">/// blocks multiple times when promoting many allocas in the same block.</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo">LargeBlockInfo</a> &#123;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlightComment">  /// For each instruction that we track, keep the index of the</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlightComment">  /// instruction.</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlightComment">  /// The index starts out as the number of the instruction from the start of</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlightComment">  /// the block.</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const Instruction &#42;, unsigned&gt;</a> InstNumbers;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlightComment">  /// This code only looks at accesses to allocas.</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a2b18e650c4c4b6dc41e61693de3becfe"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a2b18e650c4c4b6dc41e61693de3becfe">isInterestingInstruction</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0))) ||</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">           (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)));</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlightComment">  /// Get or calculate the index of the specified instruction.</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a8a3a4e2d3963e7973fc5b3a22cc48dbd"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a8a3a4e2d3963e7973fc5b3a22cc48dbd">getInstructionIndex</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a2b18e650c4c4b6dc41e61693de3becfe">isInterestingInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Not a load/store to/from an alloca?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we already have this instruction number, return it.</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const Instruction &#42;, unsigned&gt;::iterator</a> It = InstNumbers.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It != InstNumbers.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It-&gt;second;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scan the whole block to get the instruction.  This accumulates</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// information for every interesting instruction in the block, in order to</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// avoid gratuitus rescans.</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InstNo = 0;</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;BBI : &#42;BB)</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a2b18e650c4c4b6dc41e61693de3becfe">isInterestingInstruction</a>(&amp;BBI))</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">        InstNumbers&#91;&amp;BBI&#93; = InstNo++;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">    It = InstNumbers.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != InstNumbers.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Didn&#39;t insert instruction?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It-&gt;second;</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a90a64837426065343ed5f7e751e7eb58"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a90a64837426065343ed5f7e751e7eb58">deleteValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123; InstNumbers.erase(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); &#125;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345" lineLink="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a66fc0bee6bbc4081ce7c2f5dc30a604a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a66fc0bee6bbc4081ce7c2f5dc30a604a">clear</a>() &#123; InstNumbers.clear(); &#125;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a721c66ae31a226c5f4244f7827ddbba2">PromoteMem2Reg</a> &#123;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlightComment">  /// The alloca instructions being promoted.</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2"><span class="doxyHighlight">  std::vector&lt;AllocaInst &#42;&gt; <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>;</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#af32428cc1cd9368e86984af8c7da8d55"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#af32428cc1cd9368e86984af8c7da8d55">DIB</a>;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlightComment">  /// A cache of @llvm.assume intrinsics used by SimplifyInstruction.</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a">AC</a>;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad0fce47906b1b2760ab7e533c04b864c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad0fce47906b1b2760ab7e533c04b864c">SQ</a>;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlightComment">  /// Reverse mapping of Allocas.</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80f3f320b61b0e000301e831da872a16"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;AllocaInst &#42;, unsigned&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80f3f320b61b0e000301e831da872a16">AllocaLookup</a>;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlightComment">  /// The PhiNodes we&#39;re adding.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlightComment">  /// That map is used to simplify some Phi nodes as we iterate over it, so</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlightComment">  /// it should have deterministic iterators.  We could use a MapVector, but</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlightComment">  /// since basic blocks have numbers, using these are more efficient.</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;unsigned, unsigned&gt;</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&gt; <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737">NewPhiNodes</a>;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlightComment">  /// For each PHI node, keep track of which entry in Allocas it corresponds</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlightComment">  /// to.</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a4f0b91643b65c8761c9eeeadc64492dc"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;PHINode &#42;, unsigned&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a4f0b91643b65c8761c9eeeadc64492dc">PhiToAllocaMap</a>;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlightComment">  /// For each alloca, we keep track of the dbg.declare intrinsic that</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlightComment">  /// describes it, if any, so that we can convert it to a dbg.value</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlightComment">  /// intrinsic if the alloca gets promoted.</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80bb056010ea690822b298854c4c4e1f"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AllocaInfo::DbgUserVec, 8&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80bb056010ea690822b298854c4c4e1f">AllocaDbgUsers</a>;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a8827ceeac0aefbbd0f0b75b0a25917bb"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AllocaInfo::DPUserVec, 8&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a8827ceeac0aefbbd0f0b75b0a25917bb">AllocaDPUsers</a>;</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlightComment">  /// For each alloca, keep an instance of a helper class that gives us an easy</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlightComment">  /// way to update assignment tracking debug info if the alloca is promoted.</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#aef98790a823ccff8c29fbe3364b40172"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AssignmentTrackingInfo, 8&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#aef98790a823ccff8c29fbe3364b40172">AllocaATInfo</a>;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlightComment">  /// A set of dbg.assigns to delete because they&#39;ve been demoted to</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlightComment">  /// dbg.values. Call cleanUpDbgAssigns to delete them.</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a67ec6009a3fa3761c566d7a3f23cd2dd"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgAssignIntrinsic &#42;, 8&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a67ec6009a3fa3761c566d7a3f23cd2dd">DbgAssignsToDelete</a>;</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad51cdfe53983ad12fef31954127d7930"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgVariableRecord &#42;, 8&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad51cdfe53983ad12fef31954127d7930">DVRAssignsToDelete</a>;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlightComment">  /// The set of basic blocks the renamer has already visited.</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a19d9b4f8f4591430966fdde73d6c3dfe"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitvector">BitVector</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a19d9b4f8f4591430966fdde73d6c3dfe">Visited</a>;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlightComment">  /// Lazily compute the number of predecessors a block has, indexed by block</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlightComment">  /// number.</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad3b28cf56cd977cfcc409819a699db01"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad3b28cf56cd977cfcc409819a699db01">BBNumPreds</a>;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlightComment">  /// Whether the function has the no-signed-zeros-fp-math attribute set.</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad6407cb982fe1adb61f80dc780208d79"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad6407cb982fe1adb61f80dc780208d79">NoSignedZeros</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a721c66ae31a226c5f4244f7827ddbba2"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a721c66ae31a226c5f4244f7827ddbba2">PromoteMem2Reg</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;AllocaInst &#42;&gt;</a> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>,</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a">AC</a>)</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.begin(), <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.end()), <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>),</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#af32428cc1cd9368e86984af8c7da8d55">DIB</a>(&#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>.<a href="/docs/api/files/lib/lib/support/deltatree-cpp/#ab590661425ca60ca82edfdb4cf22233d">getRoot</a>()-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>()-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>(), </span><span class="doxyHighlightComment">/&#42;AllowUnresolved&#42;/</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/false">false</a>),</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a">AC</a>(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a">AC</a>), <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad0fce47906b1b2760ab7e533c04b864c">SQ</a>(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>.<a href="/docs/api/files/lib/lib/support/deltatree-cpp/#ab590661425ca60ca82edfdb4cf22233d">getRoot</a>()-&gt;getDataLayout(),</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">                   nullptr, &amp;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a">AC</a>) &#123;&#125;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> run();</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> RemoveFromAllocasList(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;AllocaIdx) &#123;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    Allocas&#91;AllocaIdx&#93; = Allocas.back();</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">    Allocas.pop&#95;back();</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">    --AllocaIdx;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> getNumPreds(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BBNumPreds is resized to getMaxBlockNumber() at the beginning.</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;NP = BBNumPreds&#91;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0bf3a7e9bff209ef9f8d2eb194196848">getNumber</a>()&#93;;</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NP == 0)</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">      NP = <a href="/docs/api/namespaces/llvm/#a3f211484edf604716a6c80030b0a0375">pred&#95;size</a>(BB) + 1;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NP - 1;</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/ssaupdaterbulk-cpp/#ab90f4a46f63bfddff132d20866be2da2">ComputeLiveInBlocks</a>(AllocaInst &#42;AI, AllocaInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SmallPtrSetImpl&lt;BasicBlock &#42;&gt; &amp;DefBlocks,</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">                           SmallPtrSetImpl&lt;BasicBlock &#42;&gt; &amp;LiveInBlocks);</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> RenamePass(BasicBlock &#42;BB, BasicBlock &#42;Pred,</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">                  RenamePassData::ValVector &amp;IncVals,</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">                  RenamePassData::LocationVector &amp;IncLocs,</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">                  std::vector&lt;RenamePassData&gt; &amp;Worklist);</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> QueuePhiNode(BasicBlock &#42;BB, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AllocaIdx, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a689a023f54d38d41f6d952cac41ee538">Version</a>);</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlightComment">  /// Delete dbg.assigns that have been demoted to dbg.values.</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> cleanUpDbgAssigns() &#123;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DAI : <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a67ec6009a3fa3761c566d7a3f23cd2dd">DbgAssignsToDelete</a>)</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">      DAI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a67ec6009a3fa3761c566d7a3f23cd2dd">DbgAssignsToDelete</a>.clear();</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DVR : <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad51cdfe53983ad12fef31954127d7930">DVRAssignsToDelete</a>)</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      DVR-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad51cdfe53983ad12fef31954127d7930">DVRAssignsToDelete</a>.clear();</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlightComment">/// Given a LoadInst LI this adds assume(LI != null) after it.</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446" lineLink="#aebae63f31076e8c0dfe153c45a730497"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#aebae63f31076e8c0dfe153c45a730497">addAssumeNonNull</a>(<a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC, <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI) &#123;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;AssumeIntrinsic =</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), Intrinsic::assume);</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;LoadNotNull = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>, LI,</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  LoadNotNull-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(LI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(AssumeIntrinsic, &#123;LoadNotNull&#125;);</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(LoadNotNull-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">  AC-&gt;<a href="/docs/api/classes/llvm/assumptioncache/#a23187618f079555e127ba0e7b4581530">registerAssumption</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AssumeInst&gt;</a>(CI));</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457" lineLink="#a125e2946cdcc7555d8f5c383681d7097"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a125e2946cdcc7555d8f5c383681d7097">convertMetadataToAssumes</a>(<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val,</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val) &amp;&amp; LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a565f546ad95bd3a9bbe9a1e5040803f0">hasMetadata</a>(LLVMContext::MD&#95;noundef)) &#123;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert non-terminator unreachable.</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = LI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>();</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Ctx),</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(Ctx)),</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">                  </span><span class="doxyHighlightComment">/&#42;isVolatile=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/align">Align</a>(1), LI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the load was marked as nonnull we don&#39;t want to lose that information</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when we erase this Load. So we preserve it with an assume. As !nonnull</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// returns poison while assume violations are immediate undefined behavior,</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can only do this if the value is known non-poison.</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AC &amp;&amp; LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;nonnull) &amp;&amp;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">      LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;noundef) &amp;&amp;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(Val, <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, DT, AC, LI)))</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">    <a href="#aebae63f31076e8c0dfe153c45a730497">addAssumeNonNull</a>(AC, LI);</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479" lineLink="#a82f896385cac84a2e477159ad31ace74"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a82f896385cac84a2e477159ad31ace74">removeIntrinsicUsers</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI) &#123;</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Knowing that this alloca is promotable, we know that it&#39;s safe to kill all</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions except for load and store.</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(AI-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>())) &#123;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Drop the use of AI in droppable instructions.</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isDroppable()) &#123;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dropDroppableUse(U);</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isVoidTy()) &#123;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The only users of this bitcast/GEP instruction are lifetime intrinsics.</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Follow the use/def chain to erase them now instead of leaving it for</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dead code elimination later.</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;UU : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses())) &#123;</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(UU.getUser());</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Drop the use of I in droppable instructions.</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;<a href="/docs/api/classes/llvm/user/#af6a49991304b167c94f4a9756d3fd48f">isDroppable</a>()) &#123;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">          Inst-&gt;<a href="/docs/api/classes/llvm/value/#a44beb55f865ee8a8e42c3a9adeb599e2">dropDroppableUse</a>(UU);</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">        Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlightComment">/// Rewrite as many loads as possible given a single store.</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlightComment">/// When there is only a single store, we can use the domtree to trivially</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlightComment">/// replace all of the dominated loads with the stored value. Do so, and return</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">/// true if this has successfully promoted the alloca entirely. If this returns</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">/// false there were some loads which were not dominated by the single store</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlightComment">/// and thus must be phi-ed with undef. We fall back to the standard alloca</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlightComment">/// promotion algorithm in that case.</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522" lineLink="#aa231a7e6d411bd4797afdd6f0a1f8d6a"><span class="doxyHighlight"><a href="#aa231a7e6d411bd4797afdd6f0a1f8d6a">rewriteSingleStoreAlloca</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI, AllocaInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>, LargeBlockInfo &amp;LBI,</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT,</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgAssignIntrinsic &#42;, 8&gt;</a> &#42;DbgAssignsToDelete,</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgVariableRecord &#42;, 8&gt;</a> &#42;DVRAssignsToDelete) &#123;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;OnlyStore = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.OnlyStore;</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ReplVal = OnlyStore-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loads may either load the stored value or uninitialized memory (undef).</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the stored value may be poison, then replacing an uninitialized memory</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load with it would be incorrect. If the store dominates the load, we know</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it is always initialized.</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RequireDominatingStore =</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(ReplVal) || !<a href="/docs/api/namespaces/llvm/#ae058c4750de2c85f12a1f96841ac9ae3">isGuaranteedNotToBePoison</a>(ReplVal);</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;StoreBB = OnlyStore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> StoreIndex = -1;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clear out UsingBlocks.  We will reconstruct it here if needed.</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.UsingBlocks.clear();</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())) &#123;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserInst == OnlyStore)</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(UserInst);</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, if we have a load from the alloca, we want to replace it with the</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// only value stored to the alloca.  We can do this if the value is</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dominated by the store.  If not, we use the rest of the mem2reg machinery</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to insert the phi nodes as needed.</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RequireDominatingStore) &#123;</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == StoreBB) &#123;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we have a use that is in the same block as the store, compare the</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// indices of the two instructions to see which one came first.  If the</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// load came before the store, we can&#39;t handle it.</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreIndex == -1)</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">          StoreIndex = LBI.getInstructionIndex(OnlyStore);</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(StoreIndex) &gt; LBI.getInstructionIndex(LI)) &#123;</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Can&#39;t handle this load, bail out.</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.UsingBlocks.push&#95;back(StoreBB);</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(StoreBB, LI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())) &#123;</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the load and store are in different blocks, use BB dominance to</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// check their relationships.  If the store doesn&#39;t dom the use, bail</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// out.</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.UsingBlocks.push&#95;back(LI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, we &#42;can&#42; safely rewrite this load.</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the replacement value is the load, this must occur in unreachable</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// code.</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReplVal == LI)</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">      ReplVal = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">    <a href="#a125e2946cdcc7555d8f5c383681d7097">convertMetadataToAssumes</a>(LI, ReplVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AC, &amp;DT);</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">    LI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ReplVal);</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">    LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">    LBI.deleteValue(LI);</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, after the scan, check to see if the store is all that is left.</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.UsingBlocks.empty())</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// If not, we&#39;ll have to fall back for the remainder.</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> DIB(&#42;AI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), </span><span class="doxyHighlightComment">/&#42;AllowUnresolved&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update assignment tracking info for the store we&#39;re going to delete.</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.AssignmentTracking.updateForDeletedStore(</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.OnlyStore, DIB, DbgAssignsToDelete, DVRAssignsToDelete);</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record debuginfo for the store and remove the declaration&#39;s</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// debuginfo.</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ConvertDebugInfoForStore = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Container) &#123;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgItem : Container) &#123;</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;isAddressOfVariable()) &#123;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DbgItem, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.OnlyStore, DIB);</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">        DbgItem-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;isValueOfVariable() &amp;&amp;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">                 DbgItem-&gt;getExpression()-&gt;startsWithDeref()) &#123;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a2ffbb17abf202aabdbb70f00a84905c9">InsertDebugValueAtStoreLoc</a>(DbgItem, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.OnlyStore, DIB);</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">        DbgItem-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;getExpression()-&gt;startsWithDeref()) &#123;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">        DbgItem-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">  ConvertDebugInfoForStore(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DbgUsers);</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  ConvertDebugInfoForStore(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DPUsers);</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove dbg.assigns linked to the alloca as these are now redundant.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/at/#acac0a0a393ce41aadc29e623549b6bfa">at::deleteAssignmentMarkers</a>(AI);</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the (now dead) store and alloca.</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.OnlyStore-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">  LBI.deleteValue(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.OnlyStore);</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">  AI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlightComment">/// Many allocas are only used within a single basic block.  If this is the</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlightComment">/// case, avoid traversing the CFG and inserting a lot of potentially useless</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlightComment">/// PHI nodes by just performing a single linear pass over the basic block</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlightComment">/// using the Alloca.</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlightComment">/// If we cannot promote this alloca (because it is read before it is written),</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlightComment">/// return false.  This is necessary in cases where, due to control flow, the</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlightComment">/// alloca is undefined only on some control flow paths.  e.g. code like</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlightComment">/// this is correct in LLVM IR:</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlightComment">///  // A is an alloca with no stores so far</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlightComment">///  for (...) &#123;</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlightComment">///    int t = &#42;A;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlightComment">///    if (!first&#95;iteration)</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlightComment">///      use(t);</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlightComment">///    &#42;A = 42;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlightComment">///  &#125;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641" lineLink="#a6952450f0726bd9c26d303743522e227"><span class="doxyHighlight"><a href="#a6952450f0726bd9c26d303743522e227">promoteSingleBlockAlloca</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> AllocaInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">                         LargeBlockInfo &amp;LBI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgAssignIntrinsic &#42;, 8&gt;</a> &#42;DbgAssignsToDelete,</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DbgVariableRecord &#42;, 8&gt;</a> &#42;DVRAssignsToDelete) &#123;</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The trickiest case to handle is when we have large blocks. Because of this,</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this code is optimized assuming that large blocks happen.  This does not</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// significantly pessimize the small block case.  This uses LargeBlockInfo to</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// make it efficient to get the index of various operations in the block.</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the use-def list of the alloca, getting the locations of all stores.</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">StoresByIndexTy = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;unsigned, StoreInst &#42;&gt;</a>, 64&gt;;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">  StoresByIndexTy StoresByIndex;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U))</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">      StoresByIndex.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(std::make&#95;pair(LBI.getInstructionIndex(<a href="/docs/api/namespaces/llvm/si">SI</a>), <a href="/docs/api/namespaces/llvm/si">SI</a>));</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort the stores by their index, making it efficient to do a lookup with a</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// binary search.</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(StoresByIndex, <a href="/docs/api/structs/llvm/less-first">less&#95;first</a>());</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk all of the loads from this alloca, replacing them with the nearest</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store above them, if any.</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())) &#123;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U);</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI)</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LoadIdx = LBI.getInstructionIndex(LI);</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find the nearest store that has a lower index than this load.</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">    StoresByIndexTy::iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#aa81eb67f09ee4944eaeeddbc54c0c0de">llvm::lower&#95;bound</a>(</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">        StoresByIndex,</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">        std::make&#95;pair(LoadIdx, </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)),</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/less-first">less&#95;first</a>());</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ReplVal;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == StoresByIndex.begin()) &#123;</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoresByIndex.empty())</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If there are no stores, the load takes the undef value.</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">        ReplVal = <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// There is no store before this load, bail out (load may be affected</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// by the following stores - see main comment).</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise, there was a store before this load, the load takes its</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">      ReplVal = std::prev(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;second-&gt;getOperand(0);</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">    <a href="#a125e2946cdcc7555d8f5c383681d7097">convertMetadataToAssumes</a>(LI, ReplVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AC, &amp;DT);</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the replacement value is the load, this must occur in unreachable</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// code.</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReplVal == LI)</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">      ReplVal = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    LI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ReplVal);</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">    LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">    LBI.deleteValue(LI);</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the (now dead) stores and alloca.</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> DIB(&#42;AI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), </span><span class="doxyHighlightComment">/&#42;AllowUnresolved&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!AI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(AI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>());</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update assignment tracking info for the store we&#39;re going to delete.</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.AssignmentTracking.updateForDeletedStore(<a href="/docs/api/namespaces/llvm/si">SI</a>, DIB, DbgAssignsToDelete,</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">                                                  DVRAssignsToDelete);</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Record debuginfo for the store before removing it.</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DbgUpdateForStore = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Container) &#123;</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgItem : Container) &#123;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;isAddressOfVariable()) &#123;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DbgItem, <a href="/docs/api/namespaces/llvm/si">SI</a>, DIB);</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    DbgUpdateForStore(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DbgUsers);</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">    DbgUpdateForStore(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DPUsers);</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">    LBI.deleteValue(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove dbg.assigns linked to the alloca as these are now redundant.</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/at/#acac0a0a393ce41aadc29e623549b6bfa">at::deleteAssignmentMarkers</a>(AI);</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  AI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The alloca&#39;s debuginfo can be removed as well.</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DbgUpdateForAlloca = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Container) &#123;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgItem : Container)</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;isAddressOfVariable() ||</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">          DbgItem-&gt;getExpression()-&gt;startsWithDeref())</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">        DbgItem-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">  DbgUpdateForAlloca(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DbgUsers);</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  DbgUpdateForAlloca(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DPUsers);</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  ++NumLocalPromoted;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744" lineLink="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a31d32412508ee492e69d8695f88e6dcf"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a31d32412508ee492e69d8695f88e6dcf">PromoteMem2Reg::run</a>() &#123;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = &#42;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>.getRoot()-&gt;getParent();</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80bb056010ea690822b298854c4c4e1f">AllocaDbgUsers</a>.resize(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.size());</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#aef98790a823ccff8c29fbe3364b40172">AllocaATInfo</a>.resize(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.size());</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a8827ceeac0aefbbd0f0b75b0a25917bb">AllocaDPUsers</a>.resize(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.size());</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo">AllocaInfo</a> Info;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo">LargeBlockInfo</a> LBI;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9244cca1af4fa8be6df93278d8a191aa">ForwardIDFCalculator</a> IDF(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>);</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad6407cb982fe1adb61f80dc780208d79">NoSignedZeros</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFnAttribute(</span><span class="doxyHighlightStringLiteral">&quot;no-signed-zeros-fp-math&quot;</span><span class="doxyHighlight">).getValueAsBool();</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AllocaNum = 0; AllocaNum != <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.size(); ++AllocaNum) &#123;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>&#91;AllocaNum&#93;;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a5023b360abc7a5d1612061fba30003a6">isAllocaPromotable</a>(AI) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Cannot promote non-promotable alloca!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> &amp;&amp;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;All allocas should be in the same function, which is same as DF!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">    <a href="#a82f896385cac84a2e477159ad31ace74">removeIntrinsicUsers</a>(AI);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If there are no uses of the alloca, just delete it now.</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">      AI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove the alloca from the Allocas list, since it has been processed</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">      RemoveFromAllocasList(AllocaNum);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">      ++NumDeadAlloca;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Calculate the set of read and write-locations for each alloca.  This is</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// analogous to finding the &#39;uses&#39; and &#39;definitions&#39; of each variable.</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">    Info.AnalyzeAlloca(AI);</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is only a single store to this value, replace any loads of</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it that are directly dominated by the definition with the value stored.</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Info.DefiningBlocks.size() == 1) &#123;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa231a7e6d411bd4797afdd6f0a1f8d6a">rewriteSingleStoreAlloca</a>(AI, Info, LBI, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad0fce47906b1b2760ab7e533c04b864c">SQ</a>.DL, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a">AC</a>,</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">                                   &amp;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a67ec6009a3fa3761c566d7a3f23cd2dd">DbgAssignsToDelete</a>, &amp;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad51cdfe53983ad12fef31954127d7930">DVRAssignsToDelete</a>)) &#123;</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The alloca has been processed, move on.</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">        RemoveFromAllocasList(AllocaNum);</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">        ++NumSingleStore;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the alloca is only read and written in one basic block, just perform a</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// linear sweep over the block to eliminate it.</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Info.OnlyUsedInOneBlock &amp;&amp;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">        <a href="#a6952450f0726bd9c26d303743522e227">promoteSingleBlockAlloca</a>(AI, Info, LBI, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad0fce47906b1b2760ab7e533c04b864c">SQ</a>.DL, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a5654e9ce725c1e004e3c581755edbd8c">DT</a>, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a2df7a2d6c0b51ace59a4ac48bcec8b6a">AC</a>,</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">                                 &amp;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a67ec6009a3fa3761c566d7a3f23cd2dd">DbgAssignsToDelete</a>, &amp;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad51cdfe53983ad12fef31954127d7930">DVRAssignsToDelete</a>)) &#123;</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The alloca has been processed, move on.</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">      RemoveFromAllocasList(AllocaNum);</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Initialize BBNumPreds lazily</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad3b28cf56cd977cfcc409819a699db01">BBNumPreds</a>.empty())</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad3b28cf56cd977cfcc409819a699db01">BBNumPreds</a>.resize(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getMaxBlockNumber());</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remember the dbg.declare intrinsic describing this alloca, if any.</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Info.DbgUsers.empty())</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80bb056010ea690822b298854c4c4e1f">AllocaDbgUsers</a>&#91;AllocaNum&#93; = Info.DbgUsers;</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Info.AssignmentTracking.empty())</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#aef98790a823ccff8c29fbe3364b40172">AllocaATInfo</a>&#91;AllocaNum&#93; = Info.AssignmentTracking;</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Info.DPUsers.empty())</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a8827ceeac0aefbbd0f0b75b0a25917bb">AllocaDPUsers</a>&#91;AllocaNum&#93; = Info.DPUsers;</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep the reverse mapping of the &#39;Allocas&#39; array for the rename pass.</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80f3f320b61b0e000301e831da872a16">AllocaLookup</a>&#91;<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>&#91;AllocaNum&#93;&#93; = AllocaNum;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Unique the set of defining blocks for efficient lookup.</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> DefBlocks(Info.DefiningBlocks.begin(),</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">                                            Info.DefiningBlocks.end());</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine which blocks the value is live in.  These are blocks which lead</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to uses.</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> LiveInBlocks;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">    ComputeLiveInBlocks(AI, Info, DefBlocks, LiveInBlocks);</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// At this point, we&#39;re committed to promoting the alloca using IDF&#39;s, and</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the standard SSA construction algorithm.  Determine which blocks need phi</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// nodes and see if we can optimize out some work by avoiding insertion of</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dead phi nodes.</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">    IDF.<a href="/docs/api/classes/llvm/idfcalculatorbase/#a8efdd1ea3537e57552087a2767969557">setLiveInBlocks</a>(LiveInBlocks);</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">    IDF.<a href="/docs/api/classes/llvm/idfcalculatorbase/#a9180c82ceffac7e5586cc2d6f368f996">setDefiningBlocks</a>(DefBlocks);</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> PHIBlocks;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">    IDF.<a href="/docs/api/classes/llvm/idfcalculatorbase/#a714e5448566006046f747d9ec4df8241">calculate</a>(PHIBlocks);</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(PHIBlocks, &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getNumber() &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getNumber();</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CurrentVersion = 0;</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : PHIBlocks)</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">      QueuePhiNode(BB, AllocaNum, CurrentVersion);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.empty()) &#123;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    cleanUpDbgAssigns();</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// All of the allocas must have been trivial!</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">  LBI.<a href="/docs/api/classes/anonymous-namespace-promotememorytoregister-cpp-/largeblockinfo/#a66fc0bee6bbc4081ce7c2f5dc30a604a">clear</a>();</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the incoming values for the basic block to be null values for all of</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the alloca&#39;s.  We do this in case there is a load of a value that has not</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// been stored yet.  In this case, it will get this null value.</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18e5b1dbb4e7b1463315c636b916abd0">RenamePassData::ValVector</a> Values(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.size());</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.size(); i != e; ++i)</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">    Values&#91;i&#93; = <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>&#91;i&#93;-&gt;getAllocatedType());</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When handling debug info, treat all incoming values as if they have unknown</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// locations until proven otherwise.</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a81ba17b4e41561256ed0b2a82aaac8ce">RenamePassData::LocationVector</a> Locations(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>.size());</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The renamer uses the Visited set to avoid infinite loops.</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a19d9b4f8f4591430966fdde73d6c3dfe">Visited</a>.resize(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getMaxBlockNumber());</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walks all basic blocks in the function performing the SSA rename algorithm</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and inserting the phi nodes we marked as necessary</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">  std::vector&lt;RenamePassData&gt; RenamePassWorkList;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">  RenamePassWorkList.emplace&#95;back(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.front(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, std::move(Values),</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">                                  std::move(Locations));</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata">RenamePassData</a> RPD = std::move(RenamePassWorkList.back());</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">    RenamePassWorkList.pop&#95;back();</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// RenamePass may add new worklist entries.</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">    RenamePass(RPD.<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ad93429799d281f5a6534821bc14fa36c">BB</a>, RPD.<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#ab9573d1a944e1048e7fd1c0c488eced2">Pred</a>, RPD.<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#add5219f842875c33a4168bf4bb6b37f5">Values</a>, RPD.<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/renamepassdata/#a18184dbfe73aeba751307ac82f0e5209">Locations</a>, RenamePassWorkList);</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!RenamePassWorkList.empty());</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the allocas themselves from the function.</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a764c3a6c9b85fb9e84283d4f21ff4bd2">Allocas</a>) &#123;</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove dbg.assigns linked to the alloca as these are now redundant.</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/at/#acac0a0a393ce41aadc29e623549b6bfa">at::deleteAssignmentMarkers</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are any uses of the alloca instructions left, they must be in</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unreachable basic blocks that were not processed by walking the dominator</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// tree. Just delete the users now.</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;use&#95;empty())</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType()));</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove alloca&#39;s dbg.declare intrinsics from the function.</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RemoveDbgDeclares = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Container) &#123;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DbgUsers : Container) &#123;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgItem : DbgUsers)</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;isAddressOfVariable() ||</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">            DbgItem-&gt;getExpression()-&gt;startsWithDeref())</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">          DbgItem-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">  RemoveDbgDeclares(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a80bb056010ea690822b298854c4c4e1f">AllocaDbgUsers</a>);</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  RemoveDbgDeclares(<a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a8827ceeac0aefbbd0f0b75b0a25917bb">AllocaDPUsers</a>);</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop over all of the PHI nodes and see if there are any that we can get</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// rid of because they merge all of the same incoming values.  This can</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// happen due to undef values coming into the PHI nodes.  This process is</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterative, because eliminating one PHI node can cause others to be removed.</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EliminatedAPHI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (EliminatedAPHI) &#123;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">    EliminatedAPHI = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Iterating over NewPhiNodes is deterministic, so it is safe to try to</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simplify and RAUW them as we go.  If it was not, we could add uses to</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the values we replace with in a non-deterministic order, thus creating</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// non-deterministic def-&gt;use chains.</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;std::pair&lt;unsigned, unsigned&gt;, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&gt;<a href="/docs/api/classes/llvm/iplist">::iterator</a></span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737">NewPhiNodes</a>.begin(),</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">             E = <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737">NewPhiNodes</a>.end();</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;) &#123;</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this PHI node merges one value and/or undefs, get the value.</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(PN, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#ad0fce47906b1b2760ab7e533c04b864c">SQ</a>)) &#123;</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">        PN-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">        PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737">NewPhiNodes</a>.erase(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++);</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">        EliminatedAPHI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point, the renamer has added entries to PHI nodes for all reachable</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code.  Unfortunately, there may be unreachable blocks which the renamer</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hasn&#39;t traversed.  If this is the case, the PHI nodes may not</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have incoming values for all predecessors.  Loop over all PHI nodes we have</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// created, inserting poison values if they are missing any incoming values.</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;std::pair&lt;unsigned, unsigned&gt;, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&gt;<a href="/docs/api/classes/llvm/iplist">::iterator</a></span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737">NewPhiNodes</a>.begin(),</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">           E = <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737">NewPhiNodes</a>.end();</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We want to do this once per basic block.  As such, only process a block</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// when we find the PHI that is the first entry in the block.</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;SomePHI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = SomePHI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>() != SomePHI)</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only do work here if there the PHI nodes are missing incoming values.  We</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// know that all PHI nodes that were inserted in a block will have the same</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// number of incoming values, so we can just check any of them.</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SomePHI-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == getNumPreds(BB))</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the preds for BB.</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 16&gt;</a> Preds(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB));</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ok, now we know that all of the PHI nodes are missing entries for some</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// basic blocks.  Start by sorting the incoming predecessors for efficient</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// access.</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CompareBBNumbers = &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getNumber() &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getNumber();</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(Preds, CompareBBNumbers);</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now we loop through all BB&#39;s which have entries in SomePHI and remove</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// them from the Preds list.</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = SomePHI-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Do a log(n) search of the Preds list for the entry we want.</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl/#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;BasicBlock &#42;&gt;::iterator</a> EntIt = <a href="/docs/api/namespaces/llvm/#aa81eb67f09ee4944eaeeddbc54c0c0de">llvm::lower&#95;bound</a>(</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">          Preds, SomePHI-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i), CompareBBNumbers);</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EntIt != Preds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>() &amp;&amp; &#42;EntIt == SomePHI-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i) &amp;&amp;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;PHI node has entry for a block which is not a predecessor!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove the entry</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">      Preds.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(EntIt);</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// At this point, the blocks left in the preds list must have dummy</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// entries inserted into every PHI nodes for the block.  Update all the phi</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// nodes in this block that we are inserting (there could be phis before</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// mem2reg runs).</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumBadPreds = SomePHI-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> ((SomePHI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BBI++)) &amp;&amp;</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">           SomePHI-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == NumBadPreds) &#123;</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;PoisonVal = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(SomePHI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : Preds)</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">        SomePHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PoisonVal, Pred);</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a97a87b539cedba599f6314d804374737">NewPhiNodes</a>.clear();</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">  cleanUpDbgAssigns();</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlightComment">/// Determine which blocks the value is live in.</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlightComment">/// These are blocks which lead to uses.  Knowing this allows us to avoid</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlightComment">/// inserting PHI nodes into blocks which don&#39;t lead to uses (thus, the</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlightComment">/// inserted phi nodes would be dead).</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> PromoteMem2Reg::ComputeLiveInBlocks(</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI, <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/allocainfo">AllocaInfo</a> &amp;Info,</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;BasicBlock &#42;&gt;</a> &amp;DefBlocks,</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;BasicBlock &#42;&gt;</a> &amp;LiveInBlocks) &#123;</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// To determine liveness, we must iterate through the predecessors of blocks</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// where the def is live.  Blocks are added to the worklist if we need to</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// check their predecessors.  Start with all the using blocks.</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 64&gt;</a> LiveInBlockWorklist(Info.UsingBlocks.begin(),</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">                                                    Info.UsingBlocks.end());</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If any of the using blocks is also a definition block, check to see if the</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// definition occurs before or after the use.  If it happens before the use,</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the value isn&#39;t really live-in.</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = LiveInBlockWorklist.size(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = LiveInBlockWorklist&#91;i&#93;;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(BB))</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, this is a block that both uses and defines the value.  If the first</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reference to the alloca is a def (store), then we know it isn&#39;t live-in.</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(1) != AI)</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We found a store to the alloca before a load.  The alloca is not</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// actually live-in here.</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">        LiveInBlockWorklist&#91;i&#93; = LiveInBlockWorklist.back();</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">        LiveInBlockWorklist.pop&#95;back();</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">        --i;</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">        --e;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Okay, we found a load before a store to the alloca.  It is actually</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// live into this block.</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;getOperand(0) == AI)</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we have a set of blocks where the phi is live-in, recursively add</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// their predecessors until we find the full region the value is live.</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!LiveInBlockWorklist.empty()) &#123;</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = LiveInBlockWorklist.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The block really is live in here, insert it into the set.  If already in</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the set, then it has already been processed.</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LiveInBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BB).second)</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Since the value is live into BB, it is either defined in a predecessor or</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// live into it to.  Add the preds to the worklist unless they are a</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// defining block.</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The value is not live into a predecessor if it defines the value.</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>))</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise it is, add to the worklist.</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">      LiveInBlockWorklist.push&#95;back(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlightComment">/// Queue a phi-node to be added to a basic-block for a specific Alloca.</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlightComment">/// Returns true if there wasn&#39;t already a phi-node for that variable</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PromoteMem2Reg::QueuePhiNode(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AllocaNo,</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a689a023f54d38d41f6d952cac41ee538">Version</a>) &#123;</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look up the basic-block in question.</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp;PN = NewPhiNodes&#91;std::make&#95;pair(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0bf3a7e9bff209ef9f8d2eb194196848">getNumber</a>(), AllocaNo)&#93;;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the BB already has a phi node added for the i&#39;th alloca then we&#39;re done!</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN)</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a PhiNode using the dereferenced type... and add the phi-node to the</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BasicBlock.</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  PN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(Allocas&#91;AllocaNo&#93;-&gt;getAllocatedType(), getNumPreds(BB),</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">                       Allocas&#91;AllocaNo&#93;-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/provenanceanalysisevaluator-cpp/#a2ee79648e8bce3ddbb26358ff10e3e82">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(<a href="/docs/api/namespaces/llvm/#a689a023f54d38d41f6d952cac41ee538">Version</a>++));</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">  PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  ++NumPHIInsert;</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">  PhiToAllocaMap&#91;PN&#93; = AllocaNo;</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlightComment">/// Update the debug location of a phi. \\p ApplyMergedLoc indicates whether to</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlightComment">/// create a merged location incorporating \\p DL, or to set \\p DL directly.</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088" lineLink="#a957b517efddeb68617e18ffef3b64683"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a957b517efddeb68617e18ffef3b64683">updateForIncomingValueLocation</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ApplyMergedLoc) &#123;</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ApplyMergedLoc)</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae88ca601f663c55cafa95cf742076aad">applyMergedLocation</a>(PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlightComment">/// Recursively traverse the CFG of the function, renaming loads and</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlightComment">/// stores to the allocas which we are promoting.</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlightComment">/// IncomingVals indicates what value each Alloca contains on exit from the</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlightComment">/// predecessor block Pred.</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> PromoteMem2Reg::RenamePass(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred,</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">                                RenamePassData::ValVector &amp;IncomingVals,</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">                                RenamePassData::LocationVector &amp;IncomingLocs,</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">                                std::vector&lt;RenamePassData&gt; &amp;Worklist) &#123;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">NextIteration:</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are inserting any phi nodes into this BB, they will already be in the</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;APN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) &#123;</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have PHI nodes to update, compute the number of edges from Pred to</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BB.</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiToAllocaMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(APN)) &#123;</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We want to be able to distinguish between PHI nodes being inserted by</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this invocation of mem2reg from those phi nodes that already existed in</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the IR before mem2reg was run.  We determine that APN is being inserted</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// because it is missing incoming edges.  All other PHI nodes being</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// inserted by this pass of mem2reg will have the same number of incoming</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// operands so far.  Remember this count.</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewPHINumOperands = APN-&gt;getNumOperands();</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumEdges = <a href="/docs/api/namespaces/llvm/#ab1772fd431decccb7926d484ea223db7">llvm::count</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Pred), BB);</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumEdges &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must be at least one edge from Pred to BB!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add entries for all the phis.</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> PNI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AllocaNo = PhiToAllocaMap&#91;APN&#93;;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update the location of the phi node.</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">        <a href="#a957b517efddeb68617e18ffef3b64683">updateForIncomingValueLocation</a>(APN, IncomingLocs&#91;AllocaNo&#93;,</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">                                       APN-&gt;getNumIncomingValues() &gt; 0);</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Add N incoming values to the PHI node.</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != NumEdges; ++i)</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">          APN-&gt;addIncoming(IncomingVals&#91;AllocaNo&#93;, Pred);</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For the  sequence &#96;return X &gt; 0 ? X : -X&#96;, it is expected that this</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// results in fabs intrinsic. However, without no-signed-zeros(nsz) flag</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// on the phi node generated at this stage, fabs folding does not</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// happen. So, we try to infer nsz flag from the function attributes to</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// enable this fabs folding.</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPMathOperator&gt;</a>(APN) &amp;&amp; NoSignedZeros)</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">          APN-&gt;setHasNoSignedZeros(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The currently active variable for this block is now the PHI.</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">        IncomingVals&#91;AllocaNo&#93; = APN;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">        AllocaATInfo&#91;AllocaNo&#93;.updateForNewPhi(APN, DIB);</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ConvertDbgDeclares = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Container) &#123;</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgItem : Container)</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;isAddressOfVariable())</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DbgItem, APN, DIB);</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">        ConvertDbgDeclares(AllocaDbgUsers&#91;AllocaNo&#93;);</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">        ConvertDbgDeclares(AllocaDPUsers&#91;AllocaNo&#93;);</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Get the next phi node.</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">        ++PNI;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">        APN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(PNI);</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!APN)</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Verify that it is missing entries.  If not, it is not being inserted</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// by this mem2reg invocation so we want to ignore it.</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (APN-&gt;getNumOperands() == NewPHINumOperands);</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t revisit blocks.</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0bf3a7e9bff209ef9f8d2eb194196848">getNumber</a>()))</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">  Visited.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0bf3a7e9bff209ef9f8d2eb194196848">getNumber</a>());</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isTerminator();) &#123;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &amp;&#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>++; </span><span class="doxyHighlightComment">// get the instruction, increment iterator</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(LI-&gt;getPointerOperand());</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Src)</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;AllocaInst &#42;, unsigned&gt;::iterator</a> AI = AllocaLookup.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Src);</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI == AllocaLookup.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = IncomingVals&#91;AI-&gt;second&#93;;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">      <a href="#a125e2946cdcc7555d8f5c383681d7097">convertMetadataToAssumes</a>(LI, V, SQ.<a href="/docs/api/structs/llvm/simplifyquery/#a0ffb6d79f6befe2030328bd1d7110feb">DL</a>, AC, &amp;DT);</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Anything using the load now uses the current value.</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">      LI-&gt;replaceAllUsesWith(V);</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">      LI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Delete this instruction and mark the name as the current holder of the</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Dest = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Dest)</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;AllocaInst &#42;, unsigned&gt;::iterator</a> ai = AllocaLookup.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Dest);</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ai == AllocaLookup.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// what value were we writing?</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AllocaNo = ai-&gt;second;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">      IncomingVals&#91;AllocaNo&#93; = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record debuginfo for the store before removing it.</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">      IncomingLocs&#91;AllocaNo&#93; = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">      AllocaATInfo&#91;AllocaNo&#93;.updateForDeletedStore(<a href="/docs/api/namespaces/llvm/si">SI</a>, DIB, &amp;DbgAssignsToDelete,</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">                                                   &amp;DVRAssignsToDelete);</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ConvertDbgDeclares = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Container) &#123;</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgItem : Container)</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgItem-&gt;isAddressOfVariable())</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DbgItem, <a href="/docs/api/namespaces/llvm/si">SI</a>, DIB);</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">      ConvertDbgDeclares(AllocaDbgUsers&#91;ai-&gt;second&#93;);</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">      ConvertDbgDeclares(AllocaDPUsers&#91;ai-&gt;second&#93;);</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;Recurse&#39; to our successors.</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#acc56362e89d398a34b5da66ddedb5448">succ&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(BB), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/namespaces/llvm/#aa5684e4976198c1b64b694d3972ddf78">succ&#95;end</a>(BB);</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>)</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track of the successors so we don&#39;t visit the same successor twice</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 8&gt;</a> VisitedSuccs;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle the first successor without using the worklist.</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">  VisitedSuccs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">  Pred = BB;</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">  BB = &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VisitedSuccs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&#42;I).second)</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">      Worklist.emplace&#95;back(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Pred, IncomingVals, IncomingLocs);</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> NextIteration;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241" lineLink="/docs/api/namespaces/llvm/#a1a4cac84457299517e69ff9764fed2db"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1a4cac84457299517e69ff9764fed2db">llvm::PromoteMemToReg</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;AllocaInst &#42;&gt;</a> Allocas, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT,</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC) &#123;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is nothing to do, bail out...</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Allocas.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-promotememorytoregister-cpp-/promotemem2reg/#a721c66ae31a226c5f4244f7827ddbba2">PromoteMem2Reg</a>(Allocas, DT, AC).run();</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
