---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `InstCombinePHI.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="InstCombineInternal.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/InstCombine/InstCombiner.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombiner-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-instcombinephi-cpp-">anonymous&#123;InstCombinePHI.cpp&#125;</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord">PHIUsageRecord</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord">LoweredPHIRecord</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387">DenseMapInfo&lt;LoweredPHIRecord&gt;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a3ef88a20b7b51243e963ed25e0e0c30e">foldDependentIVs</a> (PHINode &amp;PN, IRBuilderBase &amp;Builder)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;</>}
  name={<><a href="#a2e25b4d49c29e587a6a408e19f57ab0e">getAnyNonZeroConstInt</a> (PHINode &amp;PN)</>}>
Return an existing non-zero constant if this phi node has one, otherwise return constant 1. <a href="#a2e25b4d49c29e587a6a408e19f57ab0e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6b46ea77082dda0b24b9fea490ae8fc8">isSafeAndProfitableToSinkLoad</a> (LoadInst &#42;L)</>}>
Return true if we know that it is safe to sink the load out of the block that defines it. <a href="#a6b46ea77082dda0b24b9fea490ae8fc8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad64d77ab93a00dbcc71e917573921ca9">PHIsEqualValue</a> (PHINode &#42;PN, Value &#42;&amp;NonPhiInVal, SmallPtrSetImpl&lt; PHINode &#42; &gt; &amp;ValueEqualPHIs)</>}>
Return true if this phi node is always equal to NonPhiInVal. <a href="#ad64d77ab93a00dbcc71e917573921ca9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a86ed982844e004af01652f203eda23c0">simplifyUsingControlFlow</a> (InstCombiner &amp;Self, PHINode &amp;PN, const DominatorTree &amp;DT)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa43815813042b12227a11c9aed8a12d9">STATISTIC</a> (NumPHIsOfInsertValues, &quot;Number of phi-of-insertvalue turned into insertvalue-of-phis&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a61754a2e497cc9a3acc02864d7241553">STATISTIC</a> (NumPHIsOfExtractValues, &quot;Number of phi-of-extractvalue turned into extractvalue-of-phi&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac3ea19a7d0181e0ce206ab75c05f563a">STATISTIC</a> (NumPHICSEs, &quot;Number of PHI&#39;s that got CSE&#39;d&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#afa34faf3a90b8e195116e9ae7097a406">MaxNumPhis</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### foldDependentIVs() {#a3ef88a20b7b51243e963ed25e0e0c30e}

<MemberDefinition
  prototype={<>static Value &#42; foldDependentIVs (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder)</>}
  labels = {["static"]}>

Definition at line <a href="#l01382">1382</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

### getAnyNonZeroConstInt() {#a2e25b4d49c29e587a6a408e19f57ab0e}

<MemberDefinition
  prototype={<>static ConstantInt &#42; getAnyNonZeroConstInt (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN)</>}
  labels = {["static"]}>
Return an existing non-zero constant if this phi node has one, otherwise return constant 1.

Definition at line <a href="#l01023">1023</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

### isSafeAndProfitableToSinkLoad() {#a6b46ea77082dda0b24b9fea490ae8fc8}

<MemberDefinition
  prototype={<>static bool isSafeAndProfitableToSinkLoad (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42; L)</>}
  labels = {["static"]}>
Return true if we know that it is safe to sink the load out of the block that defines it.

This means that it must be obvious the value of the load is not changed from the point of the load to the end of the block it is in.

Finally, it is safe, but not profitable, to sink a load targeting a non-address-taken alloca. Doing so will cause us to not promote the alloca to a register.

Definition at line <a href="#l00653">653</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

### PHIsEqualValue() {#ad64d77ab93a00dbcc71e917573921ca9}

<MemberDefinition
  prototype={<>static bool PHIsEqualValue (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; NonPhiInVal, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; &gt; &amp; ValueEqualPHIs)</>}
  labels = {["static"]}>
Return true if this phi node is always equal to NonPhiInVal.

This happens with mutually cyclic phi nodes like: z = some value; x = phi (y, z); y = phi (x, z)

Definition at line <a href="#l00995">995</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

### simplifyUsingControlFlow() {#a86ed982844e004af01652f203eda23c0}

<MemberDefinition
  prototype={<>static Value &#42; simplifyUsingControlFlow (<a href="/docs/api/classes/llvm/instcombiner">InstCombiner</a> &amp; Self, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT)</>}
  labels = {["static"]}>

Definition at line <a href="#l01279">1279</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aa43815813042b12227a11c9aed8a12d9}

<MemberDefinition
  prototype={<>STATISTIC (NumPHIsOfInsertValues, &quot;Number of phi-of-insertvalue turned into insertvalue-of-phis&quot;)</>}>

Definition at line <a href="#l00034">34</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a61754a2e497cc9a3acc02864d7241553}

<MemberDefinition
  prototype={<>STATISTIC (NumPHIsOfExtractValues, &quot;Number of phi-of-extractvalue turned into extractvalue-of-phi&quot;)</>}>

Definition at line <a href="#l00036">36</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac3ea19a7d0181e0ce206ab75c05f563a}

<MemberDefinition
  prototype={<>STATISTIC (NumPHICSEs, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>&#39;s that got <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/separateconstoffsetfromgep-cpp/#ac56c14d91bc69a17e4e5936093b3bc05">CSE</a>&#39;d&quot;)</>}>

Definition at line <a href="#l00038">38</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### MaxNumPhis {#afa34faf3a90b8e195116e9ae7097a406}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxNumPhis(&quot;instcombine-max-num-phis&quot;, cl::init(512), cl::desc(&quot;Maximum number phis to handle in intptr/ptrint folding&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00031">31</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>

Definition at line <a href="#l00028">28</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinephi-cpp">InstCombinePHI.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- InstCombinePHI.cpp -------------------------------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file implements the visitPHINode function.</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h">InstCombineInternal.h</a>&quot;</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombiner-h">llvm/Transforms/InstCombine/InstCombiner.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;instcombine&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31" lineLink="#afa34faf3a90b8e195116e9ae7097a406"><span class="doxyHighlight"><a href="#afa34faf3a90b8e195116e9ae7097a406">MaxNumPhis</a>(</span><span class="doxyHighlightStringLiteral">&quot;instcombine-max-num-phis&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(512),</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlight">           <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Maximum number phis to handle in intptr/ptrint folding&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34" lineLink="#aa43815813042b12227a11c9aed8a12d9"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPHIsOfInsertValues,</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of phi-of-insertvalue turned into insertvalue-of-phis&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36" lineLink="#a61754a2e497cc9a3acc02864d7241553"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPHIsOfExtractValues,</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of phi-of-extractvalue turned into extractvalue-of-phi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38" lineLink="#ac3ea19a7d0181e0ce206ab75c05f563a"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPHICSEs, </span><span class="doxyHighlightStringLiteral">&quot;Number of PHI&#39;s that got CSE&#39;d&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">/// The PHI arguments will be folded into a single operation with a PHI node</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">/// as input. The debug location of the single operation will be the merged</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightComment">/// locations of the original PHI node arguments.</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">InstCombinerImpl::PHIArgMergedDebugLoc</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FirstInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlight">  Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(FirstInst-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We do not expect a CallInst here, otherwise, N-way merging of DebugLoc</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will be inefficient.</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(Inst));</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlight">    Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#ae88ca601f663c55cafa95cf742076aad">applyMergedLocation</a>(Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightComment">/// If the phi is within a phi web, which is formed by the def-use chain</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightComment">/// of phis and all the phis in the web are only used in the other phis.</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightComment">/// In this case, these phis are dead and we will remove all of them.</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aabb5edbf6f79b04ce152f73869c1a4aa"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#aabb5edbf6f79b04ce152f73869c1a4aa">InstCombinerImpl::foldDeadPhiWeb</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 16&gt;</a> Stack;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode &#42;, 16&gt;</a> Visited;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlight">  Stack.push&#95;back(&amp;PN);</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Stack.empty()) &#123;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = Stack.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Phi).second)</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Early stop if the set of PHIs is large</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 16)</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;<a href="/docs/api/classes/llvm/use">Use</a> : Phi-&gt;users()) &#123;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PhiUse = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>))</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">        Stack.push&#95;back(PhiUse);</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi : Visited)</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;Phi, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Phi-&gt;getType()));</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi : Visited)</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;Phi);</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightComment">// Replace Integer typed PHI PN if the PHI&#39;s value is used as a pointer value.</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightComment">// If there is an existing pointer typed PHI that produces the same value as PN,</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightComment">// replace PN and the IntToPtr operation with it. Otherwise, synthesize a new</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightComment">// PHI node:</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightComment">// Case-1:</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightComment">// bb1:</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightComment">//     int&#95;init = PtrToInt(ptr&#95;init)</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlightComment">//     br label %bb2</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightComment">// bb2:</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlightComment">//    int&#95;val = PHI(&#91;int&#95;init, %bb1&#93;, &#91;int&#95;val&#95;inc, %bb2&#93;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightComment">//    ptr&#95;val = PHI(&#91;ptr&#95;init, %bb1&#93;, &#91;ptr&#95;val&#95;inc, %bb2&#93;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlightComment">//    ptr&#95;val2 = IntToPtr(int&#95;val)</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlightComment">//    ...</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlightComment">//    use(ptr&#95;val2)</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlightComment">//    ptr&#95;val&#95;inc = ...</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlightComment">//    inc&#95;val&#95;inc = PtrToInt(ptr&#95;val&#95;inc)</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlightComment">// ==&gt;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlightComment">// bb1:</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlightComment">//     br label %bb2</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlightComment">// bb2:</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlightComment">//    ptr&#95;val = PHI(&#91;ptr&#95;init, %bb1&#93;, &#91;ptr&#95;val&#95;inc, %bb2&#93;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlightComment">//    ...</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlightComment">//    use(ptr&#95;val)</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlightComment">//    ptr&#95;val&#95;inc = ...</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlightComment">// Case-2:</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightComment">// bb1:</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlightComment">//    int&#95;ptr = BitCast(ptr&#95;ptr)</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlightComment">//    int&#95;init = Load(int&#95;ptr)</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlightComment">//    br label %bb2</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlightComment">// bb2:</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlightComment">//    int&#95;val = PHI(&#91;int&#95;init, %bb1&#93;, &#91;int&#95;val&#95;inc, %bb2&#93;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightComment">//    ptr&#95;val2 = IntToPtr(int&#95;val)</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlightComment">//    ...</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightComment">//    use(ptr&#95;val2)</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightComment">//    ptr&#95;val&#95;inc = ...</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlightComment">//    inc&#95;val&#95;inc = PtrToInt(ptr&#95;val&#95;inc)</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlightComment">// ==&gt;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlightComment">// bb1:</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlightComment">//    ptr&#95;init = Load(ptr&#95;ptr)</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightComment">//    br label %bb2</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightComment">// bb2:</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightComment">//    ptr&#95;val = PHI(&#91;ptr&#95;init, %bb1&#93;, &#91;ptr&#95;val&#95;inc, %bb2&#93;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightComment">//    ...</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightComment">//    use(ptr&#95;val)</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightComment">//    ptr&#95;val&#95;inc = ...</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlightComment">//    ...</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aab1473644ffe7926032a4e01ed4bad78"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#aab1473644ffe7926032a4e01ed4bad78">InstCombinerImpl::foldIntegerTypedPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>())</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN.<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IntToPtr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntToPtrInst&gt;</a>(PN.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>());</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IntToPtr)</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the pointer is actually used as pointer:</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HasPointerUse = &#91;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IIP) &#123;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : IIP-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LoadI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = LoadI-&gt;getPointerOperand();</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand();</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;GI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = GI-&gt;getPointerOperand();</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> &amp;&amp; <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == IIP)</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasPointerUse(IntToPtr))</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getPointerSizeInBits(IntToPtr-&gt;getAddressSpace()) !=</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeSizeInBits(IntToPtr-&gt;getOperand(0)-&gt;getType()))</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> AvailablePtrVals;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Arg could be a constant, constant expr, etc., which we don&#39;t cover here.</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Arg) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(Arg))</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First look backward:</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PtrToIntInst&gt;</a>(Arg)) &#123;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">      AvailablePtrVals.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(PI-&gt;getOperand(0));</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Next look forward:</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ArgIntToPtr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Arg-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntToPtrInst&gt;</a>(U) &amp;&amp; U-&gt;getType() == IntToPtr-&gt;getType() &amp;&amp;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">          (<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U), BB) ||</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)-&gt;getParent() == BB)) &#123;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">        ArgIntToPtr = U;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgIntToPtr) &#123;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">      AvailablePtrVals.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(ArgIntToPtr);</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If Arg is defined by a PHI, allow it. This will also create</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// more opportunities iteratively.</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Arg)) &#123;</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">      AvailablePtrVals.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Arg);</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For a single use integer load:</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoadI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(Arg);</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadI)</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadI-&gt;hasOneUse())</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Push the integer typed Load instruction into the available</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value set, and fix it up later when the pointer typed PHI</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is synthesized.</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">    AvailablePtrVals.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(LoadI);</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now search for a matching PHI</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AvailablePtrVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() &amp;&amp;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Not enough available ptr typed incoming values&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;MatchingPtrPHI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPhis = 0;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PtrPHI : BB-&gt;phis()) &#123;</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: consider handling this in AggressiveInstCombine</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumPhis++ &gt; <a href="#afa34faf3a90b8e195116e9ae7097a406">MaxNumPhis</a>)</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;PtrPHI == &amp;PN || PtrPHI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != IntToPtr-&gt;getType())</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), AvailablePtrVals),</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">               &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BlockAndValue) &#123;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">                 BasicBlock &#42;BB = std::get&lt;0&gt;(BlockAndValue);</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">                 Value &#42;V = std::get&lt;1&gt;(BlockAndValue);</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">                 return PtrPHI.getIncomingValueForBlock(BB) != V;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">               &#125;))</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    MatchingPtrPHI = &amp;PtrPHI;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MatchingPtrPHI) &#123;</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MatchingPtrPHI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == IntToPtr-&gt;getType() &amp;&amp;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Phi&#39;s Type does not match with IntToPtr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Explicitly replace the inttoptr (rather than inserting a ptrtoint) here,</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to make sure another transform can&#39;t undo it in the meantime.</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;IntToPtr, MatchingPtrPHI);</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;IntToPtr);</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(PN);</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it requires a conversion for every PHI operand, do not do it.</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(AvailablePtrVals, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (V-&gt;getType() != IntToPtr-&gt;getType()) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntToPtrInst&gt;</a>(V);</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">      &#125;))</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If any of the operand that requires casting is a terminator</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction, do not do it. Similarly, do not do the transform if the value</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is PHI in a block with no insertion point, for example, a catchswitch</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block, since we will not be able to insert a cast after the PHI.</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(AvailablePtrVals, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V-&gt;getType() == IntToPtr-&gt;getType())</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst)</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;isTerminator())</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = Inst-&gt;getParent();</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Inst) &amp;&amp; BB-&gt;getFirstInsertionPt() == BB-&gt;end())</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">      &#125;))</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPtrPHI = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">      IntToPtr-&gt;getType(), PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(), PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewPtrPHI, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Value &#42;, Instruction &#42;&gt;</a> Casts;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), AvailablePtrVals)) &#123;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingBB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingVal = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncomingVal-&gt;getType() == IntToPtr-&gt;getType()) &#123;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">      NewPtrPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(IncomingVal, IncomingBB);</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LoadI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(IncomingVal);</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(IncomingVal) ||</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">            IncomingVal-&gt;getType()-&gt;isPointerTy() ||</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">            (LoadI &amp;&amp; LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())) &amp;&amp;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Can not replace LoadInst with multiple uses&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Need to insert a BitCast.</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For an integer Load instruction with a single use, the load + IntToPtr</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cast will be simplified into a pointer load:</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// %v = load i64, i64&#42; %a.ip, align 8</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// %v.cast = inttoptr i64 %v to float &#42;&#42;</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ==&gt;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// %v.ptrp = bitcast i64 &#42; %a.ip to float &#42;&#42;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// %v.cast = load float &#42;, float &#42;&#42; %v.ptrp, align 8</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;CI = Casts&#91;IncomingVal&#93;;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI) &#123;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">      CI = <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(IncomingVal, IntToPtr-&gt;getType(),</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">                                            IncomingVal-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.ptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(IncomingVal)) &#123;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos(IncomingI);</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">        InsertPos++;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = IncomingI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(IncomingI))</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">          InsertPos = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPos != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;should have checked above&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(CI, InsertPos);</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InsertBB = &amp;IncomingBB-&gt;getParent()-&gt;getEntryBlock();</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(CI, InsertBB-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">    NewPtrPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(CI, IncomingBB);</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Explicitly replace the inttoptr (rather than inserting a ptrtoint) here,</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to make sure another transform can&#39;t undo it in the meantime.</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;IntToPtr, NewPtrPHI);</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;IntToPtr);</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(PN);</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlightComment">// Remove RoundTrip IntToPtr/PtrToInt Cast on PHI-Operand and</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlightComment">// fold Phi-operand to bitcast.</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339" lineLink="/docs/api/classes/llvm/instcombinerimpl/#abd122b6678d6a8f14b6ab6bc18863b27"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#abd122b6678d6a8f14b6ab6bc18863b27">InstCombinerImpl::foldPHIArgIntToPtrToPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// convert ptr2int ( phi&#91; int2ptr(ptr2int(x))&#93; ) --&gt; ptr2int ( phi &#91; x &#93; )</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure all uses of phi are ptr2int.</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(PN.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>(), &#91;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123; return isa&lt;PtrToIntInst&gt;(U); &#125;))</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterating over all operands to check presence of target pointers for</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimization.</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OperandWithRoundTripCast = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNum = 0; OpNum != PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); ++OpNum) &#123;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewOp =</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">            simplifyIntToPtrRoundTripCast(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(OpNum))) &#123;</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(PN, OpNum, NewOp);</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">      OperandWithRoundTripCast = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OperandWithRoundTripCast)</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;PN;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlightComment">/// If we have something like phi &#91;insertvalue(a,b,0), insertvalue(c,d,0)&#93;,</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlightComment">/// turn this into a phi&#91;a,c&#93; and phi&#91;b,d&#93; and a single insertvalue.</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a29028fb86efd0ff0ea01f243f47684fc"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instcombinerimpl/#a29028fb86efd0ff0ea01f243f47684fc">InstCombinerImpl::foldPHIArgInsertValueInstructionIntoPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FirstIVI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InsertValueInst&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan to see if all operands are &#96;insertvalue&#96;&#39;s with the same indices,</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and all have a single use.</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertValueInst&gt;</a>(V);</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUser() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIndices() != FirstIVI-&gt;getIndices())</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each operand of an &#96;insertvalue&#96;</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">  std::array&lt;PHINode &#42;, 2&gt; NewOperands;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> OpIdx : &#123;0, 1&#125;) &#123;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;&amp;NewOperand = NewOperands&#91;OpIdx&#93;;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a new PHI node to receive the values the operand has in each</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// incoming basic block.</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">    NewOperand = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">        FirstIVI-&gt;getOperand(OpIdx)-&gt;getType(), PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">        FirstIVI-&gt;getOperand(OpIdx)-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.pn&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// And populate each operand&#39;s PHI with said values.</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">      NewOperand-&gt;addIncoming(</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InsertValueInst&gt;</a>(std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))-&gt;getOperand(OpIdx),</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">          std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>));</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewOperand, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And finally, create &#96;insertvalue&#96; over the newly-formed PHI nodes.</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewIVI = <a href="/docs/api/classes/llvm/insertvalueinst/#acc871ff3698895f1efc402d2482032b9">InsertValueInst::Create</a>(NewOperands&#91;0&#93;, NewOperands&#91;1&#93;,</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">                                         FirstIVI-&gt;getIndices(), PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewIVI, PN);</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  ++NumPHIsOfInsertValues;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewIVI;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlightComment">/// If we have something like phi &#91;extractvalue(a,0), extractvalue(b,0)&#93;,</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlightComment">/// turn this into a phi&#91;a,b&#93; and a single extractvalue.</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403" lineLink="/docs/api/classes/llvm/instcombinerimpl/#af4dbcb044eda11161781dfbf3f007f04"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instcombinerimpl/#af4dbcb044eda11161781dfbf3f007f04">InstCombinerImpl::foldPHIArgExtractValueInstructionIntoPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FirstEVI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ExtractValueInst&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan to see if all operands are &#96;extractvalue&#96;&#39;s with the same indices,</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and all have a single use.</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractValueInst&gt;</a>(V);</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUser() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIndices() != FirstEVI-&gt;getIndices() ||</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getAggregateOperand()-&gt;getType() !=</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">            FirstEVI-&gt;getAggregateOperand()-&gt;getType())</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a new PHI node to receive the values the aggregate operand has</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in each incoming basic block.</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewAggregateOperand = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">      FirstEVI-&gt;getAggregateOperand()-&gt;getType(), PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">      FirstEVI-&gt;getAggregateOperand()-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.pn&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And populate the PHI with said values.</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">    NewAggregateOperand-&gt;addIncoming(</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ExtractValueInst&gt;</a>(std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))-&gt;getAggregateOperand(),</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">        std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>));</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewAggregateOperand, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And finally, create &#96;extractvalue&#96; over the newly-formed PHI nodes.</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewEVI = <a href="/docs/api/classes/llvm/extractvalueinst/#a94c8c620b21236971c734ff2913e99f3">ExtractValueInst::Create</a>(NewAggregateOperand,</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">                                          FirstEVI-&gt;getIndices(), PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewEVI, PN);</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  ++NumPHIsOfExtractValues;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewEVI;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlightComment">/// If we have something like phi &#91;add (a,b), add(a,c)&#93; and if a/b/c and the</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlightComment">/// adds all have a single user, turn this into a phi and a single binop.</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a4df124d92129ffa8748086388a420b73"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a4df124d92129ffa8748086388a420b73">InstCombinerImpl::foldPHIArgBinOpIntoPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FirstInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(FirstInst) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(FirstInst));</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = FirstInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>();</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHSVal = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHSVal = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;LHSType = LHSVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RHSType = RHSVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan to see if all operands are the same opcode, and all have one user.</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() != Opc || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUser() ||</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Verify type of the LHS matches so we don&#39;t fold cmp&#39;s of different</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// types.</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType() != LHSType ||</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)-&gt;getType() != RHSType)</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If they are CmpInst instructions, check their predicates</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;getPredicate() != <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(FirstInst)-&gt;getPredicate())</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep track of which operand needs a phi node.</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0) != LHSVal) LHSVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1) != RHSVal) RHSVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If both LHS and RHS would need a PHI, don&#39;t do this transformation,</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because it would increase the number of PHIs entering the block,</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which leads to higher register pressure. This is especially</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bad when the PHIs are in the header of a loop.</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LHSVal &amp;&amp; !RHSVal)</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, this is safe to transform!</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InLHS = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InRHS = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewLHS = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;NewRHS = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LHSVal) &#123;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">    NewLHS = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(LHSType, PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">                             FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.pn&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">    NewLHS-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InLHS, PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(0));</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewLHS, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    LHSVal = NewLHS;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RHSVal) &#123;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">    NewRHS = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(RHSType, PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">                             FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.pn&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">    NewRHS-&gt;addIncoming(InRHS, PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(0));</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewRHS, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    RHSVal = NewRHS;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add all operands to the new PHIs.</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewLHS || NewRHS) &#123;</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))) &#123;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(InVal);</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewLHS) &#123;</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInLHS = InInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">        NewLHS-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewInLHS, InBB);</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewRHS) &#123;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInRHS = InInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">        NewRHS-&gt;addIncoming(NewInRHS, InBB);</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;CIOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(FirstInst)) &#123;</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;NewCI = <a href="/docs/api/classes/llvm/cmpinst/#a62e2cf3675b93f0e6c07a4a00852f7cd">CmpInst::Create</a>(CIOp-&gt;getOpcode(), CIOp-&gt;getPredicate(),</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">                                     LHSVal, RHSVal);</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewCI, PN);</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewCI;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BinOp = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(FirstInst);</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;NewBinOp =</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinOp-&gt;getOpcode(), LHSVal, RHSVal);</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  NewBinOp-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">    NewBinOp-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ea9acbe7fd20332ea6ccdb0183d6395">andIRFlags</a>(V);</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewBinOp, PN);</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewBinOp;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534" lineLink="/docs/api/classes/llvm/instcombinerimpl/#acc9feb478a72bb822133b6eec00bef9f"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#acc9feb478a72bb822133b6eec00bef9f">InstCombinerImpl::foldPHIArgGEPIntoPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;FirstInst =<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;, 16&gt;</a> FixedOperands(FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op&#95;begin</a>(),</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">                                        FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#af41f58e730804d10b91fcff39b035f74">op&#95;end</a>());</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is true if all GEP bases are allocas and if all indices into them are</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constants.</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllBasePointersAreAllocas = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t want to replace this phi if the replacement would require</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// more than one phi, which leads to higher register pressure. This is</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// especially bad when the PHIs are in the header of a loop.</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeededPhi = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remember flags of the first phi-operand getelementptr.</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a> NW = FirstInst-&gt;<a href="/docs/api/classes/llvm/getelementptrinst/#aebc354b6b8bd777fb2f1b952cf876bee">getNoWrapFlags</a>();</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan to see if all operands are the same opcode, and all have one user.</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(V);</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> || !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasOneUser() ||</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType() != FirstInst-&gt;<a href="/docs/api/classes/llvm/getelementptrinst/#a9fa1834df0fa59e97b016549cf8cf903">getSourceElementType</a>() ||</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands() != FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>())</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    NW &amp;= <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNoWrapFlags();</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep track of whether or not all GEPs are of alloca pointers.</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllBasePointersAreAllocas &amp;&amp;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">        (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(0)) ||</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">         !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllConstantIndices()))</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">      AllBasePointersAreAllocas = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compare the operand lists.</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = 0, E = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> != E; ++<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) == <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t merge two GEPs when two operands differ (introducing phi nodes)</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if one of the PHIs has a constant for the index.  The index may be</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// substantially cheaper to compute for the constants, so making it a</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// variable index could pessimize the path.  This also handles the case</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for struct indices, which must always be constant.</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) ||</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)))</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() !=</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)-&gt;getType())</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we already needed a PHI for an earlier operand, and another operand</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// also requires a PHI, we&#39;d be introducing more PHIs than we&#39;re</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// eliminating, which increases register pressure on entry to the PHI&#39;s</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeededPhi)</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      FixedOperands&#91;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>&#93; = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Needs a PHI.</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">      NeededPhi = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all of the base pointers of the PHI&#39;d GEPs are from allocas, don&#39;t</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bother doing this transformation.  At best, this will just save a bit of</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// offset calculation, but all the predecessors will have to materialize the</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack address into a register anyway.  We&#39;d actually rather &#42;clone&#42; the</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load up into the predecessors so that we have a load of a gep of an alloca,</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which can usually all be folded into the load.</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllBasePointersAreAllocas)</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, this is safe to transform.  Insert PHI nodes for each operand</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that is variable.</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode&#42;, 16&gt;</a> OperandPhis(FixedOperands.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasAnyPHIs = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = FixedOperands.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FixedOperands&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;)</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// operand doesn&#39;t need a phi.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FirstOp = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN =</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(FirstOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), E, FirstOp-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.pn&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewPN, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(FirstOp, PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(0));</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">    OperandPhis&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = NewPN;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">    FixedOperands&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = NewPN;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">    HasAnyPHIs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add all operands to the new PHIs.</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasAnyPHIs) &#123;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))) &#123;</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;InGEP = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(InVal);</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = 0, E = OperandPhis.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> != E; ++<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OpPhi = OperandPhis&#91;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>&#93;)</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">          OpPhi-&gt;addIncoming(InGEP-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>), InBB);</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = FixedOperands&#91;0&#93;;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;NewGEP =</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(FirstInst-&gt;<a href="/docs/api/classes/llvm/getelementptrinst/#a9fa1834df0fa59e97b016549cf8cf903">getSourceElementType</a>(), <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>(FixedOperands).slice(1), NW);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewGEP, PN);</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewGEP;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlightComment">/// Return true if we know that it is safe to sink the load out of the block</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlightComment">/// that defines it. This means that it must be obvious the value of the load is</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlightComment">/// not changed from the point of the load to the end of the block it is in.</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlightComment">/// Finally, it is safe, but not profitable, to sink a load targeting a</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlightComment">/// non-address-taken alloca.  Doing so will cause us to not promote the alloca</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlightComment">/// to a register.</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653" lineLink="#a6b46ea77082dda0b24b9fea490ae8fc8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a6b46ea77082dda0b24b9fea490ae8fc8">isSafeAndProfitableToSinkLoad</a>(<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;L) &#123;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = L-&gt;getIterator(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = L-&gt;getParent()-&gt;end();</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++BBI; BBI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++BBI)</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBI-&gt;mayWriteToMemory()) &#123;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Calls that only access inaccessible memory do not block sinking the</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// load.</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(BBI))</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB-&gt;onlyAccessesInaccessibleMemory())</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for non-address taken alloca.  If not address-taken already, it isn&#39;t</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// profitable to do this xform.</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(L-&gt;getOperand(0))) &#123;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsAddressTaken = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(U)) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If storing TO the alloca, then the address isn&#39;t taken.</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(1) == AI) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">      IsAddressTaken = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsAddressTaken &amp;&amp; AI-&gt;isStaticAlloca())</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this load is a load from a GEP with a constant offset from an alloca,</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then we don&#39;t want to sink it.  In its present form, it will be</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load &#91;constant stack offset&#93;.  Sinking it will cause us to have to</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// materialize the stack addresses in each predecessor in a register only to</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// do a shared load from register in the successor.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(L-&gt;getOperand(0)))</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(0)))</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI-&gt;isStaticAlloca() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllConstantIndices())</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aa8a186c50cdf60ac11ae1d0b884d468d"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#aa8a186c50cdf60ac11ae1d0b884d468d">InstCombinerImpl::foldPHIArgLoadIntoPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;FirstLI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can&#39;t forward swifterror through a phi.</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstLI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a98897a3d01f6a4d7f10a5ac8fe862c82">isSwiftError</a>())</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This is overconservative; this transform is allowed in some cases</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for atomic operations.</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstLI-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>())</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When processing loads, we need to propagate two bits of information to the</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sunk load: whether it is volatile, and what its alignment is.</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsVolatile = FirstLI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>();</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> LoadAlignment = FirstLI-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>();</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LoadAddrSpace = FirstLI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t sink the load if the loaded value could be modified between the</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load and the PHI.</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstLI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(0) ||</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">      !<a href="#a6b46ea77082dda0b24b9fea490ae8fc8">isSafeAndProfitableToSinkLoad</a>(FirstLI))</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the PHI is of volatile loads and the load block has multiple</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successors, sinking it would remove a load of the volatile value from</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the path through the other successor.</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsVolatile &amp;&amp;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">      FirstLI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getTerminator()-&gt;getNumSuccessors() != 1)</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))) &#123;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(InVal);</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI || !LI-&gt;<a href="/docs/api/classes/llvm/value/#a2e987c6af902aad6baa39bd5b7ef322c">hasOneUser</a>() || LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>())</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure all arguments are the same type of operation.</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>() != IsVolatile ||</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">        LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>() != LoadAddrSpace)</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t forward swifterror through a phi.</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a98897a3d01f6a4d7f10a5ac8fe862c82">isSwiftError</a>())</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can&#39;t sink the load if the loaded value could be modified between</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the load and the PHI.</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != InBB || !<a href="#a6b46ea77082dda0b24b9fea490ae8fc8">isSafeAndProfitableToSinkLoad</a>(LI))</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">    LoadAlignment = std::min(LoadAlignment, LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>());</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the PHI is of volatile loads and the load block has multiple</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// successors, sinking it would remove a load of the volatile value from</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the path through the other successor.</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsVolatile &amp;&amp; LI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getTerminator()-&gt;getNumSuccessors() != 1)</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, they are all the same operation.  Create a new PHI node of the</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// correct type, and PHI together all of the LHS&#39;s of the instructions.</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(FirstLI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">                                   PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">                                   PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()+</span><span class="doxyHighlightStringLiteral">&quot;.in&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = FirstLI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">  NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InVal, PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(0));</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;NewLI =</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a>(FirstLI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), NewPN, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, IsVolatile, LoadAlignment);</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">  NewLI-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;FirstLI);</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add all operands to the new PHI and combine TBAA metadata.</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))) &#123;</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(V);</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9b43098c569ea8289ed1ab70ee9a00af">combineMetadataForCSE</a>(NewLI, LI, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInVal = LI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewInVal != InVal)</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">      InVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewInVal, BB);</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InVal) &#123;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The new PHI unions all of the same values together.  This is really</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// common, so we handle it intelligently here for compile-time speed.</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">    NewLI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, InVal);</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">delete</span><span class="doxyHighlight"> NewPN;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewPN, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this was a volatile load that we are merging, make sure to loop through</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and mark all the input loads as non-volatile.  If we don&#39;t do this, we will</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// insert a new volatile load and the old ones will not be deletable.</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsVolatile)</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;IncValue : PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(IncValue)-&gt;setVolatile(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewLI, PN);</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewLI;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlightComment">/// TODO: This function could handle other cast types, but then it might</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlightComment">/// require special-casing a cast from the &#39;i1&#39; type. See the comment in</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlightComment">/// FoldPHIArgOpIntoPHI() about pessimizing illegal integer types.</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a84318f31145b081677697de64401238a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a84318f31145b081677697de64401238a">InstCombinerImpl::foldPHIArgZextsIntoPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi) &#123;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We cannot create a new instruction after the PHI if the terminator is an</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// EHPad because there is no valid insertion point.</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = Phi.getParent()-&gt;getTerminator())</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TI-&gt;isEHPad())</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Early exit for the common case of a phi with two operands. These are</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// handled elsewhere. See the comment below where we check the count of zexts</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and constants for more details.</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumIncomingValues = Phi.getNumIncomingValues();</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIncomingValues &lt; 3)</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the narrower type specified by the first zext.</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;NarrowType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : Phi.incoming&#95;values()) &#123;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Zext = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ZExtInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">      NarrowType = Zext-&gt;getSrcTy();</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NarrowType)</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the phi operands checking that we only have zexts or constants that</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can shrink for free. Store the new operands for the new phi.</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> NewIncoming;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumZexts = 0;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumConsts = 0;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : Phi.incoming&#95;values()) &#123;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Zext = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ZExtInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// All zexts must be identical and have one user.</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Zext-&gt;getSrcTy() != NarrowType || !Zext-&gt;hasOneUser())</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">      NewIncoming.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Zext-&gt;getOperand(0));</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">      NumZexts++;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure that constants can fit in the new type.</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Trunc = <a href="/docs/api/classes/llvm/instcombinerimpl/#a60fa7efbdcebf8c25c1dc58cc300a923">getLosslessUnsignedTrunc</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, NarrowType);</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Trunc)</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">      NewIncoming.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Trunc);</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">      NumConsts++;</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If it&#39;s not a cast or a constant, bail out.</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The more common cases of a phi with no constant operands or just one</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// variable operand are handled by FoldPHIArgOpIntoPHI() and foldOpIntoPhi()</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// respectively. foldOpIntoPhi() wants to do the opposite transform that is</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// performed here. It tries to replicate a cast in the phi operand&#39;s basic</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block to expose other folding opportunities. Thus, InstCombine will</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// infinite loop without this check.</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumConsts == 0 || NumZexts &lt; 2)</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All incoming values are zexts or constants that are safe to truncate.</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a new phi node of the narrow type, phi together all of the new</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operands, and zext the result back to the original type.</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPhi = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(NarrowType, NumIncomingValues,</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">                                    Phi.getName() + </span><span class="doxyHighlightStringLiteral">&quot;.shrunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != NumIncomingValues; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">    NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewIncoming&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, Phi.getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewPhi, Phi.getIterator());</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#ad120ee39de5a92d1581ba9a5e1072296">CastInst::CreateZExtOrBitCast</a>(NewPhi, Phi.getType());</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlightComment">/// If all operands to a PHI node are the same &quot;unary&quot; operator and they all are</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlightComment">/// only used by the PHI, PHI together their inputs, and do the operation once,</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlightComment">/// to the result of the PHI.</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a7a3e32edb65b5b1c216d4454f14df21c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a7a3e32edb65b5b1c216d4454f14df21c">InstCombinerImpl::foldPHIArgOpIntoPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We cannot create a new instruction after the PHI if the terminator is an</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// EHPad because there is no valid insertion point.</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getTerminator())</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TI-&gt;isEHPad())</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FirstInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(FirstInst))</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#acc9feb478a72bb822133b6eec00bef9f">foldPHIArgGEPIntoPHI</a>(PN);</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(FirstInst))</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#aa8a186c50cdf60ac11ae1d0b884d468d">foldPHIArgLoadIntoPHI</a>(PN);</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InsertValueInst&gt;</a>(FirstInst))</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a29028fb86efd0ff0ea01f243f47684fc">foldPHIArgInsertValueInstructionIntoPHI</a>(PN);</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractValueInst&gt;</a>(FirstInst))</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#af4dbcb044eda11161781dfbf3f007f04">foldPHIArgExtractValueInstructionIntoPHI</a>(PN);</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan the instruction, looking for input operations that can be folded away.</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all input operands to the phi are the same instruction (e.g. a cast from</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the same type or &quot;+42&quot;) we can pull the operation through the PHI, reducing</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code size and simplifying code.</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ConstantOp = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CastSrcTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CastInst&gt;</a>(FirstInst)) &#123;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">    CastSrcTy = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Be careful about transforming integer PHIs.  We don&#39;t want to pessimize</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the code by turning an i32 into an i1293.</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; CastSrcTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()) &#123;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!shouldChangeType(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), CastSrcTy))</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(FirstInst) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(FirstInst)) &#123;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can fold binop, compare or shift here if the RHS is a constant,</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// otherwise call FoldPHIArgBinOpIntoPHI.</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">    ConstantOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConstantOp)</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a4df124d92129ffa8748086388a420b73">foldPHIArgBinOpIntoPHI</a>(PN);</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// Cannot fold this operation.</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if all arguments are the same operation.</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUser() || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isSameOperationAs(FirstInst))</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CastSrcTy) &#123;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType() != CastSrcTy)</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Cast operation must match.</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1) != ConstantOp) &#123;</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, they are all the same operation.  Create a new PHI node of the</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// correct type, and PHI together all of the LHS&#39;s of the instructions.</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">                                   PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">                                   PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()+</span><span class="doxyHighlightStringLiteral">&quot;.in&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = FirstInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">  NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InVal, PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(0));</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add all operands to the new PHI.</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))) &#123;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInVal = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V)-&gt;getOperand(0);</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewInVal != InVal)</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">      InVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewInVal, BB);</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PhiVal;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InVal) &#123;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The new PHI unions all of the same values together.  This is really</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// common, so we handle it intelligently here for compile-time speed.</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">    PhiVal = InVal;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">delete</span><span class="doxyHighlight"> NewPN;</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewPN, PN.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">    PhiVal = NewPN;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert and return the new operation.</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;FirstCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(FirstInst)) &#123;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;NewCI = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(FirstCI-&gt;getOpcode(), PhiVal,</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">                                       PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewCI, PN);</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewCI;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(FirstInst)) &#123;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    BinOp = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinOp-&gt;getOpcode(), PhiVal, ConstantOp);</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">    BinOp-&gt;copyIRFlags(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()))</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">      BinOp-&gt;andIRFlags(V);</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(BinOp, PN);</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinOp;</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;CIOp = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(FirstInst);</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;NewCI = <a href="/docs/api/classes/llvm/cmpinst/#a62e2cf3675b93f0e6c07a4a00852f7cd">CmpInst::Create</a>(CIOp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#af4abe8e5b55577f35032131a6264fe4f">getOpcode</a>(), CIOp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(),</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">                                   PhiVal, ConstantOp);</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6c837ffd3a1932f53de13120ad1551a">PHIArgMergedDebugLoc</a>(NewCI, PN);</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewCI;</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlightComment">/// Return true if this phi node is always equal to NonPhiInVal.</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlightComment">/// This happens with mutually cyclic phi nodes like:</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlightComment">///   z = some value; x = phi (y, z); y = phi (x, z)</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995" lineLink="#ad64d77ab93a00dbcc71e917573921ca9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ad64d77ab93a00dbcc71e917573921ca9">PHIsEqualValue</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;NonPhiInVal,</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;PHINode &#42;&gt;</a> &amp;ValueEqualPHIs) &#123;</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we already saw this PHI node.</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ValueEqualPHIs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PN).second)</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t scan crazily complex things.</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ValueEqualPHIs.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 16)</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan the operands to see if they are either phi nodes or are equal to</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the value.</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()) &#123;</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OpPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ad64d77ab93a00dbcc71e917573921ca9">PHIsEqualValue</a>(OpPN, NonPhiInVal, ValueEqualPHIs)) &#123;</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NonPhiInVal)</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">        NonPhiInVal = OpPN;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> != NonPhiInVal)</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlightComment">/// Return an existing non-zero constant if this phi node has one, otherwise</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlightComment">/// return constant 1</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023" lineLink="#a2e25b4d49c29e587a6a408e19f57ab0e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="#a2e25b4d49c29e587a6a408e19f57ab0e">getAnyNonZeroConstInt</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expect only integer type phi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : PN.<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>())</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ConstVA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(V))</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConstVA-&gt;isZero())</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstVA;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstantInt::get(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), 1);</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032" lineLink="/docs/api/namespaces/anonymous-instcombinephi-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a961bd32671b22ca892bfee1c0d0770f2">PHIUsageRecord</a> &#123;</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a8d4dcaefaed880fd8e9fcd9810285655"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a8d4dcaefaed880fd8e9fcd9810285655">PHIId</a>;     </span><span class="doxyHighlightComment">// The ID # of the PHI (something determinstic to sort on)</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#af096b26ab19f3887556a6e679875b99b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#af096b26ab19f3887556a6e679875b99b">Shift</a>;     </span><span class="doxyHighlightComment">// The amount shifted.</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a467f7881f60d8e994200fe5a62ce12eb"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a467f7881f60d8e994200fe5a62ce12eb">Inst</a>;  </span><span class="doxyHighlightComment">// The trunc instruction.</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a961bd32671b22ca892bfee1c0d0770f2"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a961bd32671b22ca892bfee1c0d0770f2">PHIUsageRecord</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Pn, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Sh, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>)</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a8d4dcaefaed880fd8e9fcd9810285655">PHIId</a>(Pn), <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#af096b26ab19f3887556a6e679875b99b">Shift</a>(Sh), <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a467f7881f60d8e994200fe5a62ce12eb">Inst</a>(<a href="/docs/api/classes/llvm/user">User</a>) &#123;&#125;</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#ad7a7a076b3382ab93ae516269e0188ac"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#ad7a7a076b3382ab93ae516269e0188ac">operator&lt;</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a961bd32671b22ca892bfee1c0d0770f2">PHIUsageRecord</a> &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a8d4dcaefaed880fd8e9fcd9810285655">PHIId</a> &lt; RHS.PHIId) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a8d4dcaefaed880fd8e9fcd9810285655">PHIId</a> &gt; RHS.PHIId) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#af096b26ab19f3887556a6e679875b99b">Shift</a> &lt; RHS.Shift) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#af096b26ab19f3887556a6e679875b99b">Shift</a> &gt; RHS.Shift) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/phiusagerecord/#a467f7881f60d8e994200fe5a62ce12eb">Inst</a>-&gt;getType()-&gt;getPrimitiveSizeInBits() &lt;</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">           RHS.Inst-&gt;getType()-&gt;getPrimitiveSizeInBits();</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a87157ebad83822606563ef8c56cd6762">LoweredPHIRecord</a> &#123;</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a1b9ef1eb645cbf00a5e969d7f4e81d06"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a1b9ef1eb645cbf00a5e969d7f4e81d06">PN</a>;        </span><span class="doxyHighlightComment">// The PHI that was lowered.</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a7c524a65b03c7a66ff3e4d92aa67c956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a7c524a65b03c7a66ff3e4d92aa67c956">Shift</a>;     </span><span class="doxyHighlightComment">// The amount shifted.</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#af6bf6929ca61400b853c1d2833375a15"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#af6bf6929ca61400b853c1d2833375a15">Width</a>;     </span><span class="doxyHighlightComment">// The width extracted.</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a87157ebad83822606563ef8c56cd6762"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a87157ebad83822606563ef8c56cd6762">LoweredPHIRecord</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Sh, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty)</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a1b9ef1eb645cbf00a5e969d7f4e81d06">PN</a>(Phi), <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a7c524a65b03c7a66ff3e4d92aa67c956">Shift</a>(Sh), <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#af6bf6929ca61400b853c1d2833375a15">Width</a>(Ty-&gt;getPrimitiveSizeInBits()) &#123;&#125;</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ctor form used by DenseMap.</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060" lineLink="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a35e0e46e36c6d5a1992efdb8e4524eb8"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a35e0e46e36c6d5a1992efdb8e4524eb8">LoweredPHIRecord</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Sh) : <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a1b9ef1eb645cbf00a5e969d7f4e81d06">PN</a>(Phi), <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#a7c524a65b03c7a66ff3e4d92aa67c956">Shift</a>(Sh), <a href="/docs/api/structs/anonymous-namespace-instcombinephi-cpp-/loweredphirecord/#af6bf6929ca61400b853c1d2833375a15">Width</a>(0) &#123;&#125;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">llvm &#123;</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight">&lt;&gt;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066" lineLink="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/densemapinfo">DenseMapInfo</a>&lt;LoweredPHIRecord&gt; &#123;</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067" lineLink="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#ac14fca6703560f602ebe8d4a49b165ce"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> LoweredPHIRecord <a href="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#ac14fca6703560f602ebe8d4a49b165ce">getEmptyKey</a>() &#123;</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoweredPHIRecord(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, 0);</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070" lineLink="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#ad01126ce2b0450d630993b4211934894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> LoweredPHIRecord <a href="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#ad01126ce2b0450d630993b4211934894">getTombstoneKey</a>() &#123;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoweredPHIRecord(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, 1);</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073" lineLink="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#a7b37a8b69d44fe5ed9f17c311bcdc6ea"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#a7b37a8b69d44fe5ed9f17c311bcdc6ea">getHashValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LoweredPHIRecord &amp;Val) &#123;</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a86544e5fd2336905e43348d2fd546094">DenseMapInfo&lt;PHINode&#42;&gt;::getHashValue</a>(Val.PN) ^ (Val.Shift&gt;&gt;3) ^</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">             (Val.Width&gt;&gt;3);</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077" lineLink="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#a6bd456c628d8cee23d1640040d98e70f"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/densemapinfo-c9a0a95ddb70684cccffcc2c60e67387/#a6bd456c628d8cee23d1640040d98e70f">isEqual</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LoweredPHIRecord &amp;LHS,</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LoweredPHIRecord &amp;RHS) &#123;</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHS.PN == RHS.PN &amp;&amp; LHS.Shift == RHS.Shift &amp;&amp;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">             LHS.Width == RHS.Width;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace llvm</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlightComment">/// This is an integer PHI and we know that it has an illegal type: see if it is</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlightComment">/// only used by trunc or trunc(lshr) operations. If so, we split the PHI into</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlightComment">/// the various pieces being extracted. This sort of thing is introduced when</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlightComment">/// SROA promotes an aggregate to large integer values.</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlightComment">/// TODO: The user of the trunc may be an bitcast to float/double/vector or an</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlightComment">/// inttoptr.  We should produce new PHIs in the right type.</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ac8cb4401526dd424f15566e4501792f7"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#ac8cb4401526dd424f15566e4501792f7">InstCombinerImpl::SliceUpIllegalIntegerPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;FirstPhi) &#123;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHIUsers - Keep track of all of the truncated values extracted from a set</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of PHIs, along with their offset.  These are the things we want to rewrite.</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHIUsageRecord, 16&gt;</a> PHIUsers;</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHIs are often mutually cyclic, so we keep track of a whole set of PHI</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nodes which are extracted from. PHIsToSlice is a set we use to avoid</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// revisiting PHIs, PHIsInspected is a ordered list of PHIs that we need to</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// check the uses of (to ensure they are all extracts).</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode&#42;, 8&gt;</a> PHIsToSlice;</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode&#42;, 8&gt;</a> PHIsInspected;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">  PHIsToSlice.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;FirstPhi);</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">  PHIsInspected.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;FirstPhi);</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PHIId = 0; PHIId != PHIsToSlice.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++PHIId) &#123;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = PHIsToSlice&#91;PHIId&#93;;</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scan the input list of the PHI.  If any input is an invoke, and if the</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// input is defined in the predecessor, then we won&#39;t be split the critical</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// edge which is required to insert a truncate.  Because of this, we have to</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bail out.</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(V);</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent() != BB)</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we have a phi, and if it&#39;s directly in the predecessor, then we have</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a critical edge where we need to put the truncate.  Since we can&#39;t</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// split the edge in instcombine, we have to bail out.</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the incoming value is a PHI node before a catchswitch, we cannot</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// extract the value within that BB because we cannot insert any non-PHI</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions in the BB.</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>())</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred-&gt;getFirstInsertionPt() == Pred-&gt;end())</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : PN-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the user is a PHI, inspect its uses recursively.</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;UserPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(UserI)) &#123;</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIsInspected.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(UserPN).second)</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">          PHIsToSlice.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(UserPN);</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Truncates are always ok.</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(UserI)) &#123;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">        PHIUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PHIUsageRecord(PHIId, 0, UserI));</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise it must be a lshr which can only be used by one trunc.</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserI-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != Instruction::LShr ||</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">          !UserI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(UserI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()) ||</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">          !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(UserI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Bail on out of range shifts.</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SizeInBits = UserI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UserI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))-&gt;getValue().uge(SizeInBits))</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Shift = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UserI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))-&gt;getZExtValue();</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">      PHIUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PHIUsageRecord(PHIId, Shift, UserI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()));</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have no users, they must be all self uses, just nuke the PHI.</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FirstPhi, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(FirstPhi.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this phi node is transformable, create new PHIs for all the pieces</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// extracted out of it.  First, sort the users by their offset and size.</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(PHIUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), PHIUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SLICING UP PHI: &quot;</span><span class="doxyHighlight"> &lt;&lt; FirstPhi &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">             </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != PHIsToSlice.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AND USER PHI #&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PHIsToSlice&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredValues - This is a temporary used when rewriting PHI nodes.  It is</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hoisted out here to avoid construction/destruction thrashing.</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock&#42;, Value&#42;&gt;</a> PredValues;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ExtractedVals - Each new PHI we introduce is saved here so we don&#39;t</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// introduce redundant PHIs.</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;LoweredPHIRecord, PHINode&#42;&gt;</a> ExtractedVals;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UserI = 0, UserE = PHIUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); UserI != UserE; ++UserI) &#123;</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PHIId = PHIUsers&#91;UserI&#93;.PHIId;</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = PHIsToSlice&#91;PHIId&#93;;</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = PHIUsers&#91;UserI&#93;.Shift;</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = PHIUsers&#91;UserI&#93;.Inst-&gt;getType();</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;EltPHI;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;ve already lowered a user like this, reuse the previously lowered</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value.</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((EltPHI = ExtractedVals&#91;LoweredPHIRecord(PN, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, Ty)&#93;) == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise, Create the new PHI node for this user.</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">      EltPHI = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(Ty, PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">                               PN-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.off&quot;</span><span class="doxyHighlight"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>),</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">                               PN-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EltPHI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != PN-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Truncate didn&#39;t shrink phi?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/incoming">Incoming</a> : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())) &#123;</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = std::get&lt;0&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = std::get&lt;1&gt;(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;PredVal = PredValues&#91;Pred&#93;;</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we already have a value for this predecessor, reuse it.</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredVal) &#123;</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">          EltPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PredVal, Pred);</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Handle the PHI self-reuse case.</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InVal == PN) &#123;</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">          PredVal = EltPHI;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">          EltPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PredVal, Pred);</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;InPHI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(PN)) &#123;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the incoming value was a PHI, and if it was one of the PHIs we</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// already rewrote it, just use the lowered value.</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = ExtractedVals&#91;LoweredPHIRecord(InPHI, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, Ty)&#93;) &#123;</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">            PredVal = Res;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">            EltPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PredVal, Pred);</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Otherwise, do an extract in the predecessor.</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = InVal;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">          Res = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLShr(</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">              Res, ConstantInt::get(InVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>), </span><span class="doxyHighlightStringLiteral">&quot;extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">        Res = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(Res, Ty, </span><span class="doxyHighlightStringLiteral">&quot;extract.t&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">        PredVal = Res;</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">        EltPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Res, Pred);</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the incoming value was a PHI, and if it was one of the PHIs we are</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// rewriting, we will ultimately delete the code we inserted.  This</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// means we need to revisit that PHI to make sure we extract out the</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// needed piece.</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OldInVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(InVal))</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIsInspected.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OldInVal)) &#123;</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RefPHIId =</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/#a086e9fbdb06276db7753101a08a63adf">find</a>(PHIsToSlice, OldInVal) - PHIsToSlice.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>();</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">            PHIUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">                PHIUsageRecord(RefPHIId, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Res)));</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">            ++UserE;</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">      PredValues.clear();</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Made element PHI for offset &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: &quot;</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">                        &lt;&lt; &#42;EltPHI &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">      ExtractedVals&#91;LoweredPHIRecord(PN, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, Ty)&#93; = EltPHI;</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace the use of this piece with the PHI node.</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;PHIUsers&#91;UserI&#93;.Inst, EltPHI);</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace all the remaining uses of the PHI nodes (self uses and the lshrs)</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with poison.</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64asmprinter-cpp/#a434449d5a0f4b334aca9163b13b6286ba02b848adda8d7d33a2b25d87dbef1d75">Poison</a> = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(FirstPhi.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(PHIsToSlice))</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64asmprinter-cpp/#a434449d5a0f4b334aca9163b13b6286ba02b848adda8d7d33a2b25d87dbef1d75">Poison</a>);</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FirstPhi, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64asmprinter-cpp/#a434449d5a0f4b334aca9163b13b6286ba02b848adda8d7d33a2b25d87dbef1d75">Poison</a>);</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279" lineLink="#a86ed982844e004af01652f203eda23c0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a86ed982844e004af01652f203eda23c0">simplifyUsingControlFlow</a>(<a href="/docs/api/classes/llvm/instcombiner">InstCombiner</a> &amp;Self, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN,</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT) &#123;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Simplify the following patterns:</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       if (cond)</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       /       \\</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlightComment">  //      ...      ...</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       \\       /</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    phi &#91;true&#93; &#91;false&#93;</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        switch (cond)</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case v1: /       \\ case v2:</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         ...      ...</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//          \\       /</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       phi &#91;v1&#93; &#91;v2&#93;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure all inputs are constants.</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(PN.<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>(), &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123; return isa&lt;ConstantInt&gt;(V); &#125;))</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not bother with unreachable instructions.</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT.<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(BB))</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine which value the condition of the idom has for which successor.</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Context = PN.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>();</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IDom = DT.<a href="/docs/api/classes/llvm/dominatortreebase/#ad8295b9b507d1d847cd46856f8255eab">getNode</a>(BB)-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#a453de62c2dadf7b4b8df04e89f6ab4e0">getIDom</a>()-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#aab2bf365c9f4b976adc7479576dfd5bb">getBlock</a>();</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;ConstantInt &#42;, BasicBlock &#42;, 8&gt;</a> SuccForValue;</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, unsigned, 8&gt;</a> SuccCount;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AddSucc = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ) &#123;</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">    SuccForValue&#91;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>&#93; = Succ;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">    ++SuccCount&#91;Succ&#93;;</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(IDom-&gt;getTerminator())) &#123;</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;isUnconditional())</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI-&gt;getCondition();</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">    AddSucc(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Context), BI-&gt;getSuccessor(0));</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">    AddSucc(<a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(Context), BI-&gt;getSuccessor(1));</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(IDom-&gt;getTerminator())) &#123;</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">    ++SuccCount&#91;<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest()&#93;;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases())</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">      AddSucc(Case.getCaseValue(), Case.getCaseSuccessor());</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType() != PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that edges outgoing from the idom&#39;s terminators dominate respective</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inputs of the Phi.</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">  std::optional&lt;bool&gt; Invert;</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Pair : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>(), PN.<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>())) &#123;</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/input">Input</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(std::get&lt;0&gt;(Pair));</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = std::get&lt;1&gt;(Pair);</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsCorrectInput = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/classes/input">Input</a>) &#123;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The input needs to be dominated by the corresponding edge of the idom.</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This edge cannot be a multi-edge, as that would imply that multiple</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// different condition values follow the same edge.</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = SuccForValue.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/classes/input">Input</a>);</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It != SuccForValue.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; SuccCount&#91;It-&gt;second&#93; == 1 &amp;&amp;</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">             DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(<a href="/docs/api/classes/llvm/basicblockedge">BasicBlockEdge</a>(IDom, It-&gt;second),</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/basicblockedge">BasicBlockEdge</a>(Pred, BB));</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Depending on the constant, the condition may need to be inverted.</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsInvert;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsCorrectInput(<a href="/docs/api/classes/input">Input</a>))</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">      NeedsInvert = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsCorrectInput(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/classes/llvm/constantexpr/#a5b43a866f0fca605556f0f69f70c522a">ConstantExpr::getNot</a>(<a href="/docs/api/classes/input">Input</a>))))</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">      NeedsInvert = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure the inversion requirement is always the same.</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Invert &amp;&amp; &#42;Invert != NeedsInvert)</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">    Invert = NeedsInvert;</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!&#42;Invert)</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This Phi is actually opposite to branching condition of IDom. We invert</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the condition that will potentially open up some opportunities for</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sinking.</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertPt = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InsertPt != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()) &#123;</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">    Self.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;&#42;BB, InsertPt);</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Self.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlightComment">// Fold  iv = phi(start, iv.next = iv2.next op start)</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlightComment">// where iv2 = phi(iv2.start, iv2.next = iv2 + iv2.step)</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlightComment">// and   iv2.start op start = start</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlightComment">// to    iv = iv2 op start</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382" lineLink="#a3ef88a20b7b51243e963ed25e0e0c30e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a3ef88a20b7b51243e963ed25e0e0c30e">foldDependentIVs</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() != 2)</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Start;</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IvNext;</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Iv2Next;</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MatchOuterIV = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V1, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V2) &#123;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V2, <a href="/docs/api/namespaces/llvm/patternmatch/#ab3021d22d00a294cb59bd5067bc5c4b2">m&#95;c&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(V1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(Iv2Next))) ||</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V2, <a href="/docs/api/namespaces/llvm/patternmatch/#a6179666867cc3b3ad674e7e7f65ea37c">m&#95;GEP</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(V1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(Iv2Next)))) &#123;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">      Start = V1;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">      IvNext = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V2);</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MatchOuterIV(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0), PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(1)) &amp;&amp;</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">      !MatchOuterIV(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(1), PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0)))</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Iv2;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Iv2Start, &#42;Iv2Step;</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a5be4877e6cc76e0fe6f8a005c69aa7c2">matchSimpleRecurrence</a>(Iv2Next, Iv2, Iv2Start, Iv2Step) ||</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">      Iv2-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB)</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(IvNext);</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Identity =</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">      BO ? <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(BO-&gt;getOpcode(), Iv2Start-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">         : <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Iv2Start-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Iv2Start != Identity)</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;&#42;BB, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BO) &#123;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(IvNext);</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType(), Start, Iv2, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(IvNext)-&gt;getNoWrapFlags());</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BO-&gt;isCommutative() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must be commutative&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(BO-&gt;getOpcode(), Iv2, Start);</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Res)-&gt;copyIRFlags(BO);</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlightComment">// PHINode simplification</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a752efe4724ac3a97d07ee81d5f779c92"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a752efe4724ac3a97d07ee81d5f779c92">InstCombinerImpl::visitPHINode</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(&amp;PN, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;PN)))</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(PN, V);</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Result = <a href="/docs/api/classes/llvm/instcombinerimpl/#a84318f31145b081677697de64401238a">foldPHIArgZextsIntoPHI</a>(PN))</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Result = <a href="/docs/api/classes/llvm/instcombinerimpl/#abd122b6678d6a8f14b6ab6bc18863b27">foldPHIArgIntToPtrToPHI</a>(PN))</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all PHI operands are the same operation, pull them through the PHI,</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reducing code size.</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0));</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(1));</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst0 &amp;&amp; Inst1 &amp;&amp; Inst0-&gt;getOpcode() == Inst1-&gt;getOpcode() &amp;&amp;</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">      Inst0-&gt;hasOneUser())</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Result = <a href="/docs/api/classes/llvm/instcombinerimpl/#a7a3e32edb65b5b1c216d4454f14df21c">foldPHIArgOpIntoPHI</a>(PN))</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the incoming values are pointer casts of the same original value,</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replace the phi with a single cast iff we can insert a non-PHI instruction.</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">      PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstInsertionPt() != PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;end()) &#123;</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IV0 = PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0);</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IV0Stripped = IV0-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set to keep track of values known to be equal to IV0Stripped after</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// stripping pointer casts.</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 4&gt;</a> CheckedIVs;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">    CheckedIVs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(IV0);</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IV0 != IV0Stripped &amp;&amp;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>(), &#91;&amp;CheckedIVs, IV0Stripped&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>) &#123;</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">          return !CheckedIVs.insert(IV).second ||</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">                 IV0Stripped == IV-&gt;stripPointerCasts();</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">        &#125;)) &#123;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#ac120250caf531b58acce9d8cc34c7032">CastInst::CreatePointerCast</a>(IV0Stripped, PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombinerimpl/#aabb5edbf6f79b04ce152f73869c1a4aa">foldDeadPhiWeb</a>(PN))</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimization when the phi only has one use</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN.<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombinerimpl/#aab1473644ffe7926032a4e01ed4bad78">foldIntegerTypedPHI</a>(PN))</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this phi has a single use, and if that use just computes a value for</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the next iteration of a loop, delete the phi.  This occurs with unused</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// induction variables, e.g. &quot;for (int j = 0; ; ++j);&quot;.  Detecting this</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// common case here is good because the only other things that catch this</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// are induction variable analysis (sometimes) and ADCE, which is only run</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// late.</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PHIUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PN.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>());</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIUser-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">        (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(PHIUser) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnaryOperator&gt;</a>(PHIUser) ||</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(PHIUser)) &amp;&amp;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">        PHIUser-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>() == &amp;PN) &#123;</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(PN, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When a PHI is used only to be compared with zero, it is safe to replace</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// an incoming value proved as known nonzero with any non-zero constant.</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For example, in the code below, the incoming value %v can be replaced</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with any non-zero constant based on the fact that the PHI is only used to</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be compared with zero and %v is a known non-zero value:</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %v = select %cond, 1, 2</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %p = phi &#91;%v, BB&#93; ...</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      icmp eq, %p, 0</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: To be simple, handle only integer type for now.</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This handles a small number of uses to keep the complexity down, and an</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// icmp(or(phi)) can equally be replaced with any non-zero constant as the</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;or&quot; will only add bits.</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN.<a href="/docs/api/classes/llvm/value/#a72fb137716cff838d389e392b9729dc9">hasNUsesOrMore</a>(3)) &#123;</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;&gt;</a> DropPoisonFlags;</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllUsesOfPhiEndsInCmp = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(PN.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">      auto &#42;CmpInst = dyn&#95;cast&lt;ICmpInst&gt;(U);</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">      if (!CmpInst) &#123;</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This is always correct as OR only add bits and we are checking</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// against 0</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">        if (U-&gt;hasOneUse() &amp;&amp; match(U, m&#95;c&#95;Or(m&#95;Specific(&amp;PN), m&#95;Value()))) &#123;</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">          DropPoisonFlags.push&#95;back(cast&lt;Instruction&gt;(U));</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">          CmpInst = dyn&#95;cast&lt;ICmpInst&gt;(U-&gt;user&#95;back());</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (!<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) ||</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">          !<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/cmpinst/#a38d34fceda94c01af95b775632ba8299">isEquality</a>() || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>())) &#123;</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All uses of PHI results in a compare with zero.</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllUsesOfPhiEndsInCmp) &#123;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;NonZeroConst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CtxI = PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;VA = PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(VA, <a href="/docs/api/classes/llvm/instcombiner/#af56f7a148b00922368e55ab9c4948724">getSimplifyQuery</a>().getWithInstruction(CtxI))) &#123;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NonZeroConst)</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">            NonZeroConst = <a href="#a2e25b4d49c29e587a6a408e19f57ab0e">getAnyNonZeroConstInt</a>(PN);</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NonZeroConst != VA) &#123;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(PN, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NonZeroConst);</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// The &quot;disjoint&quot; flag may no longer hold after the transform.</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DropPoisonFlags)</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dropPoisonGeneratingFlags();</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">            MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MadeChange)</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;PN;</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We sometimes end up with phi cycles that non-obviously end up being the</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same value, for example:</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   z = some value; x = phi (y, z); y = phi (x, z)</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// where the phi nodes don&#39;t necessarily need to be in the same block.  Do a</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// quick check to see if the PHI node only contains a single non-phi value, if</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so, scan to see if the phi cycle is actually equal to that value. If the</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// phi has no non-phi values then allow the &quot;NonPhiInVal&quot; to be set later if</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one of the phis itself does not have a single input.</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InValNo = 0, NumIncomingVals = PN.getNumIncomingValues();</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scan for the first non-phi operand.</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (InValNo != NumIncomingVals &amp;&amp;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(PN.getIncomingValue(InValNo)))</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">      ++InValNo;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NonPhiInVal =</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">        InValNo != NumIncomingVals ? PN.getIncomingValue(InValNo) : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scan the rest of the operands to see if there are any conflicts, if so</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// there is no need to recursively scan other phis.</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NonPhiInVal)</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++InValNo; InValNo != NumIncomingVals; ++InValNo) &#123;</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;OpVal = PN.getIncomingValue(InValNo);</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpVal != NonPhiInVal &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(OpVal))</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we scanned over all operands, then we have one unique value plus</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// phi values.  Scan PHI nodes to see if they all merge in each other or</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the value.</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InValNo == NumIncomingVals) &#123;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode &#42;, 16&gt;</a> ValueEqualPHIs;</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ad64d77ab93a00dbcc71e917573921ca9">PHIsEqualValue</a>(&amp;PN, NonPhiInVal, ValueEqualPHIs))</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> replaceInstUsesWith(PN, NonPhiInVal);</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are multiple PHIs, sort their operands so that they all list</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the blocks in the same order. This will help identical PHIs be eliminated</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// by other passes. Other passes shouldn&#39;t depend on this for correctness</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// however.</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Res = PredOrder.try&#95;emplace(PN.getParent());</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Res.second) &#123;</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Preds = Res.first-&gt;second;</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PN.getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BBA = PN.getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BBB = Preds&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBA != BBB) &#123;</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;VA = PN.getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> J = PN.getBasicBlockIndex(BBB);</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/codeview/#af3d64ff2173fb2f45fdc714699cad09fa236ce469d991c10b68c9e2872f684779">VB</a> = PN.getIncomingValue(J);</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">        PN.setIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BBB);</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">        PN.setIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VB);</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">        PN.setIncomingBlock(J, BBA);</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">        PN.setIncomingValue(J, VA);</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// NOTE: Instcombine normally would want us to &quot;return &amp;PN&quot; if we</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// modified any of the operands of an instruction.  However, since we</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// aren&#39;t adding or removing uses (just rearranging them) we don&#39;t do</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// this in this case.</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remember the block order of the first encountered phi node.</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Res.first-&gt;second, PN.blocks());</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Is there an identical PHI node in this basic block?</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;IdenticalPN : PN.<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>()-&gt;phis()) &#123;</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore the PHI node itself.</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;IdenticalPN == &amp;PN)</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that even though we&#39;ve just canonicalized this PHI, due to the</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// worklist visitation order, there are no guarantess that &#42;every&#42; PHI</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// has been canonicalized, so we can&#39;t just compare operands ranges.</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN.isIdenticalToWhenDefined(&amp;IdenticalPN))</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Just use that PHI instead then.</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">    ++NumPHICSEs;</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> replaceInstUsesWith(PN, &amp;IdenticalPN);</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is an integer PHI and we know that it has an illegal type, see if</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it is only used by trunc or trunc(lshr) operations.  If so, we split the</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI into the various pieces being extracted.  This sort of thing is</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// introduced when SROA promotes an aggregate to a single large integer type.</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN.getType()-&gt;isIntegerTy() &amp;&amp;</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">      !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isLegalInteger(PN.getType()-&gt;getPrimitiveSizeInBits()))</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Res = SliceUpIllegalIntegerPHI(PN))</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ultimately, try to replace this Phi with a dominating condition.</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V = <a href="#a86ed982844e004af01652f203eda23c0">simplifyUsingControlFlow</a>(&#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, PN, DT))</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> replaceInstUsesWith(PN, V);</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = <a href="#a3ef88a20b7b51243e963ed25e0e0c30e">foldDependentIVs</a>(PN, Builder))</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> replaceInstUsesWith(PN, Res);</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
