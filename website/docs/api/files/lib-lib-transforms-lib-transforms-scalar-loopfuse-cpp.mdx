---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'
import CodeBlock from '@theme/CodeBlock'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import EnumerationList from '@xpack/docusaurus-plugin-doxygen/components/EnumerationList'
import EnumerationListItem from '@xpack/docusaurus-plugin-doxygen/components/EnumerationListItem'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `LoopFuse.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This file implements the loop fusion pass. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Scalar/LoopFuse.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/loopfuse-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/DependenceAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/dependenceanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/DomTreeUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/PostDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/postdominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolution.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolutionExpressions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Verifier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/CodeMoverUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codemoverutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopPeel.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looppeel-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopsimplify-h"
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-loopfuse-cpp-">anonymous&#123;LoopFuse.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate">FusionCandidate</a></>}>
This class is used to represent a candidate for loop fusion. <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidatecompare">FusionCandidateCompare</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree">LoopDepthTree</a></>}>
Collect all loops in function at the same nest level, starting at the outermost level. <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopfuser">LoopFuser</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-loopfuse-cpp-/loopfuser/addrecloopreplacer">AddRecLoopReplacer</a></>}>
Rewrite all additive recurrences in a <a href="/docs/api/classes/llvm/scev">SCEV</a> to use a new loop. <a href="/docs/api/classes/anonymous-namespace-loopfuse-cpp-/loopfuser/addrecloopreplacer/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Enumerations Index

<MembersIndex>

<MembersIndexItem
  type="enum"
  name={<>:  &#123; <a href="#ab2ce98edbf00ac5582eba4ec2630b50b">...</a> &#125;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#af25e5300161c9d3b28b99d498144921a">STATISTIC</a> (FuseCounter, &quot;Loops fused&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a77cf7695f4fc4a36cda60a209316d1ab">STATISTIC</a> (NumFusionCandidates, &quot;Number of candidates for loop fusion&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a67fd1cf349f1e6d7f93ac47e43c3ccc2">STATISTIC</a> (InvalidPreheader, &quot;Loop has invalid preheader&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa47aa787e5f445ae239ebfb678bea57f">STATISTIC</a> (InvalidHeader, &quot;Loop has invalid header&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#abaa433b5a1c5bc1d3464aaf2ad3fb599">STATISTIC</a> (InvalidExitingBlock, &quot;Loop has invalid exiting blocks&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac097c790de91900d4dee0165a138fcfc">STATISTIC</a> (InvalidExitBlock, &quot;Loop has invalid exit block&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af23374cc893cbd02304c83a14c9f0668">STATISTIC</a> (InvalidLatch, &quot;Loop has invalid latch&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac1a507c049c6ff1245e75195e492513b">STATISTIC</a> (InvalidLoop, &quot;Loop is invalid&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#adbae5a790555463014f0ef28057ec6f2">STATISTIC</a> (AddressTakenBB, &quot;Basic block has address taken&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aee9ee1018968beee2dfb8dee36c59850">STATISTIC</a> (MayThrowException, &quot;Loop may throw an exception&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad6eae7859ca370c7dbc8a71ca8cf6075">STATISTIC</a> (ContainsVolatileAccess, &quot;Loop contains a volatile access&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a7b11210dbe44a9cba5fd60a4484b4b73">STATISTIC</a> (NotSimplifiedForm, &quot;Loop is not in simplified form&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac9785158858f0a547b103c962336a261">STATISTIC</a> (InvalidDependencies, &quot;Dependencies prevent fusion&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a59b71ff3c7b3ba96ff1138c342e96931">STATISTIC</a> (UnknownTripCount, &quot;Loop has unknown trip count&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac18f71f17a0fa1675570671e375807a8">STATISTIC</a> (UncomputableTripCount, &quot;SCEV cannot compute trip count of loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a798f54407382f1d2e511b58c722b5c3d">STATISTIC</a> (NonEqualTripCount, &quot;Loop trip counts are not the same&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#adf178f9450cd52ccb88632ef14c88691">STATISTIC</a> (NonAdjacent, &quot;Loops are not adjacent&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#acd254a21792af653d3fa6e0fe34aba03">STATISTIC</a> (NonEmptyPreheader, &quot;Loop has a non-empty preheader with instructions that cannot be moved&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a650763e3353e9471c1f04211d678deb5">STATISTIC</a> (FusionNotBeneficial, &quot;Fusion is not beneficial&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a45a3fae061aed8a302ca20348d9ba63c">STATISTIC</a> (NonIdenticalGuards, &quot;Candidates have different guards&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab31d4f5a7d6dc9fd68a45598bb6cdf18">STATISTIC</a> (NonEmptyExitBlock, &quot;Candidate has a non-empty exit block with &quot; &quot;instructions that cannot be moved&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a386ed9e129c20c6dab79e889f1b03212">STATISTIC</a> (NonEmptyGuardBlock, &quot;Candidate has a non-empty guard block with &quot; &quot;instructions that cannot be moved&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a27e8a653f857506a3409efbf4ad62b1e">STATISTIC</a> (NotRotated, &quot;Candidate is not rotated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a1907928e54665ef8442054044603ee26">STATISTIC</a> (OnlySecondCandidateIsGuarded, &quot;The second candidate is guarded while the first one is not&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af998ca0f46d9903437ba804a2b49fd0b">STATISTIC</a> (NumHoistedInsts, &quot;Number of hoisted preheader instructions.&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a42fb67dacc8e161df30e38b00ee9b509">STATISTIC</a> (NumSunkInsts, &quot;Number of hoisted preheader instructions.&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="#ab2ce98edbf00ac5582eba4ec2630b50b">FusionDependenceAnalysisChoice</a> &gt;</>}
  name={<><a href="#a3940a750c02a84ee62d42113f72210a9">FusionDependenceAnalysis</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#ab7f49e3fad21f68d6d390bae88a74b46">FusionPeelMaxCount</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;loop-fusion&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This file implements the loop fusion pass.

The implementation is largely based on the following document: 

<CodeBlock>
  Code Transformations to Augment the Scope of Loop Fusion in a
    Production Compiler
  Christopher Mark Barton
  MSc Thesis
  https://webdocs.cs.ualberta.ca/~amaral/thesis/ChristopherBartonMSc.pdf
</CodeBlock>

The general approach taken is to collect sets of control flow equivalent loops and test whether they can be fused. The necessary conditions for fusion are:
<ul>
<li>The loops must be adjacent (there cannot be any statements between the two loops).</li>
<li>The loops must be conforming (they must execute the same number of iterations).</li>
<li>The loops must be control flow equivalent (if one loop executes, the other is guaranteed to execute).</li>
<li>There cannot be any negative distance dependencies between the loops. If all of these conditions are satisfied, it is safe to fuse the loops.</li>
</ul>


This implementation creates FusionCandidates that represent the loop and the necessary information needed by fusion. It then operates on the fusion candidates, first confirming that the candidate is eligible for fusion. The candidates are then collected into control flow equivalent sets, sorted in dominance order. Each set of control flow equivalent candidates is then traversed, attempting to fuse pairs of candidates in the set. If all requirements for fusion are met, the two candidates are fused, creating a new (fused) candidate which is then added back into the set to consider for additional fusion.

This implementation currently does not make any modifications to remove conditions for fusion. Code transformations to make loops conform to each of the conditions for fusion are discussed in more detail in the document above. These can be added to the current implementation in the future.

<SectionDefinition>

## Enumerations

### enum  {#ab2ce98edbf00ac5582eba4ec2630b50b}

<MemberDefinition
  prototype="enum FusionDependenceAnalysisChoice ">

<EnumerationList title="Enumeration values">

<Link id="ab2ce98edbf00ac5582eba4ec2630b50bae2968bc1b6d284f07e96fac3ce78bc54" />
<EnumerationListItem name="FUSION_DEPENDENCE_ANALYSIS_SCEV">

</EnumerationListItem>

<Link id="ab2ce98edbf00ac5582eba4ec2630b50ba88a2ef6139ee028e3fa8addb323b3917" />
<EnumerationListItem name="FUSION_DEPENDENCE_ANALYSIS_DA">

</EnumerationListItem>

<Link id="ab2ce98edbf00ac5582eba4ec2630b50ba9f38e26f008e10a2cd493e477865cf72" />
<EnumerationListItem name="FUSION_DEPENDENCE_ANALYSIS_ALL">

</EnumerationListItem>

</EnumerationList>

Definition at line <a href="#l00104">104</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### STATISTIC() {#af25e5300161c9d3b28b99d498144921a}

<MemberDefinition
  prototype={<>STATISTIC (FuseCounter, &quot;Loops fused&quot;)</>}>

Definition at line <a href="#l00072">72</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a77cf7695f4fc4a36cda60a209316d1ab}

<MemberDefinition
  prototype={<>STATISTIC (NumFusionCandidates, &quot;Number of candidates <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> loop fusion&quot;)</>}>

Definition at line <a href="#l00073">73</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a67fd1cf349f1e6d7f93ac47e43c3ccc2}

<MemberDefinition
  prototype={<>STATISTIC (InvalidPreheader, &quot;Loop has invalid preheader&quot;)</>}>

Definition at line <a href="#l00074">74</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aa47aa787e5f445ae239ebfb678bea57f}

<MemberDefinition
  prototype={<>STATISTIC (InvalidHeader, &quot;Loop has invalid header&quot;)</>}>

Definition at line <a href="#l00075">75</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#abaa433b5a1c5bc1d3464aaf2ad3fb599}

<MemberDefinition
  prototype={<>STATISTIC (InvalidExitingBlock, &quot;Loop has invalid exiting blocks&quot;)</>}>

Definition at line <a href="#l00076">76</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac097c790de91900d4dee0165a138fcfc}

<MemberDefinition
  prototype={<>STATISTIC (InvalidExitBlock, &quot;Loop has invalid exit block&quot;)</>}>

Definition at line <a href="#l00077">77</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#af23374cc893cbd02304c83a14c9f0668}

<MemberDefinition
  prototype={<>STATISTIC (InvalidLatch, &quot;Loop has invalid latch&quot;)</>}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac1a507c049c6ff1245e75195e492513b}

<MemberDefinition
  prototype={<>STATISTIC (InvalidLoop, &quot;Loop is invalid&quot;)</>}>

Definition at line <a href="#l00079">79</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#adbae5a790555463014f0ef28057ec6f2}

<MemberDefinition
  prototype={<>STATISTIC (AddressTakenBB, &quot;Basic <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> has address taken&quot;)</>}>

Definition at line <a href="#l00080">80</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aee9ee1018968beee2dfb8dee36c59850}

<MemberDefinition
  prototype={<>STATISTIC (MayThrowException, &quot;Loop may throw an exception&quot;)</>}>

Definition at line <a href="#l00081">81</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad6eae7859ca370c7dbc8a71ca8cf6075}

<MemberDefinition
  prototype={<>STATISTIC (ContainsVolatileAccess, &quot;Loop <a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a> a volatile access&quot;)</>}>

Definition at line <a href="#l00082">82</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a7b11210dbe44a9cba5fd60a4484b4b73}

<MemberDefinition
  prototype={<>STATISTIC (NotSimplifiedForm, &quot;Loop is not in simplified form&quot;)</>}>

Definition at line <a href="#l00083">83</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac9785158858f0a547b103c962336a261}

<MemberDefinition
  prototype={<>STATISTIC (InvalidDependencies, &quot;Dependencies prevent fusion&quot;)</>}>

Definition at line <a href="#l00084">84</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a59b71ff3c7b3ba96ff1138c342e96931}

<MemberDefinition
  prototype={<>STATISTIC (UnknownTripCount, &quot;Loop has unknown trip count&quot;)</>}>

Definition at line <a href="#l00085">85</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac18f71f17a0fa1675570671e375807a8}

<MemberDefinition
  prototype={<>STATISTIC (UncomputableTripCount, &quot;SCEV cannot compute trip count of loop&quot;)</>}>

Definition at line <a href="#l00086">86</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a798f54407382f1d2e511b58c722b5c3d}

<MemberDefinition
  prototype={<>STATISTIC (NonEqualTripCount, &quot;Loop trip counts are not the same&quot;)</>}>

Definition at line <a href="#l00087">87</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#adf178f9450cd52ccb88632ef14c88691}

<MemberDefinition
  prototype={<>STATISTIC (NonAdjacent, &quot;Loops are not adjacent&quot;)</>}>

Definition at line <a href="#l00088">88</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#acd254a21792af653d3fa6e0fe34aba03}

<MemberDefinition
  prototype={<>STATISTIC (NonEmptyPreheader, &quot;Loop has a non-empty <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#aecea88f231914d2a6dc7ecf19a57f583">preheader</a> with <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> that cannot be moved&quot;)</>}>

Definition at line <a href="#l00089">89</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a650763e3353e9471c1f04211d678deb5}

<MemberDefinition
  prototype={<>STATISTIC (FusionNotBeneficial, &quot;Fusion is not beneficial&quot;)</>}>

Definition at line <a href="#l00092">92</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a45a3fae061aed8a302ca20348d9ba63c}

<MemberDefinition
  prototype={<>STATISTIC (NonIdenticalGuards, &quot;Candidates have different guards&quot;)</>}>

Definition at line <a href="#l00093">93</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab31d4f5a7d6dc9fd68a45598bb6cdf18}

<MemberDefinition
  prototype={<>STATISTIC (NonEmptyExitBlock, &quot;Candidate has a non-empty exit <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> with &quot; &quot;<a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> that cannot be moved&quot;)</>}>

Definition at line <a href="#l00094">94</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a386ed9e129c20c6dab79e889f1b03212}

<MemberDefinition
  prototype={<>STATISTIC (NonEmptyGuardBlock, &quot;Candidate has a non-empty guard <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> with &quot; &quot;<a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> that cannot be moved&quot;)</>}>

Definition at line <a href="#l00096">96</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a27e8a653f857506a3409efbf4ad62b1e}

<MemberDefinition
  prototype={<>STATISTIC (NotRotated, &quot;Candidate is not rotated&quot;)</>}>

Definition at line <a href="#l00098">98</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a1907928e54665ef8442054044603ee26}

<MemberDefinition
  prototype={<>STATISTIC (OnlySecondCandidateIsGuarded, &quot;The second candidate is guarded <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmreflect-cpp/#a503c0214540e80733c0a0c53c067e6ee">while</a> the first one is not&quot;)</>}>

Definition at line <a href="#l00099">99</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#af998ca0f46d9903437ba804a2b49fd0b}

<MemberDefinition
  prototype={<>STATISTIC (NumHoistedInsts, &quot;Number of hoisted <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#aecea88f231914d2a6dc7ecf19a57f583">preheader</a> instructions.&quot;)</>}>

Definition at line <a href="#l00101">101</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a42fb67dacc8e161df30e38b00ee9b509}

<MemberDefinition
  prototype={<>STATISTIC (NumSunkInsts, &quot;Number of hoisted <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#aecea88f231914d2a6dc7ecf19a57f583">preheader</a> instructions.&quot;)</>}>

Definition at line <a href="#l00102">102</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### FusionDependenceAnalysis {#a3940a750c02a84ee62d42113f72210a9}

<MemberDefinition
  prototype={<>cl::opt&lt; FusionDependenceAnalysisChoice &gt; FusionDependenceAnalysis(&quot;loop-fusion-dependence-analysis&quot;, cl::desc(&quot;Which dependence analysis should loop fusion use?&quot;), cl::values(clEnumValN(FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;SCEV, &quot;scev&quot;, &quot;Use the scalar evolution interface&quot;), clEnumValN(FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;DA, &quot;da&quot;, &quot;Use the dependence analysis interface&quot;), clEnumValN(FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;ALL, &quot;all&quot;, &quot;Use all available analyses&quot;)), cl::Hidden, cl::init(FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;ALL))</>}
  labels = {["static"]}>

Definition at line <a href="#l00110">110</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### FusionPeelMaxCount {#ab7f49e3fad21f68d6d390bae88a74b46}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; FusionPeelMaxCount(&quot;loop-fusion-peel-max-count&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;Max number of iterations to be peeled from a loop, such that &quot; &quot;fusion can take place&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00121">121</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

### VerboseFusionDebugging {#ab393082393415266716b656010c0852a}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; VerboseFusionDebugging(&quot;loop-fusion-verbose-debug&quot;, cl::desc(&quot;Enable verbose debugging for Loop Fusion&quot;), cl::Hidden, cl::init(false))</>}
  labels = {["static"]}>

Definition at line <a href="#l00128">128</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;loop-fusion&quot;</>}>

Definition at line <a href="#l00070">70</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopfuse-cpp">LoopFuse.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- LoopFuse.cpp - Loop Fusion Pass ------------------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This file implements the loop fusion pass.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// The implementation is largely based on the following document:</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">///       Code Transformations to Augment the Scope of Loop Fusion in a</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">///         Production Compiler</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">///       Christopher Mark Barton</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">///       MSc Thesis</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">///       https://webdocs.cs.ualberta.ca/~amaral/thesis/ChristopherBartonMSc.pdf</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">/// The general approach taken is to collect sets of control flow equivalent</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">/// loops and test whether they can be fused. The necessary conditions for</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">/// fusion are:</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">///    1 The loops must be adjacent (there cannot be any statements between</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">///       the two loops).</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">///    2 The loops must be conforming (they must execute the same number of</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">///       iterations).</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">///    3 The loops must be control flow equivalent (if one loop executes, the</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">///       other is guaranteed to execute).</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">///    4 There cannot be any negative distance dependencies between the loops.</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">/// If all of these conditions are satisfied, it is safe to fuse the loops.</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightComment">/// This implementation creates FusionCandidates that represent the loop and the</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightComment">/// necessary information needed by fusion. It then operates on the fusion</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightComment">/// candidates, first confirming that the candidate is eligible for fusion. The</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightComment">/// candidates are then collected into control flow equivalent sets, sorted in</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightComment">/// dominance order. Each set of control flow equivalent candidates is then</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightComment">/// traversed, attempting to fuse pairs of candidates in the set. If all</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightComment">/// requirements for fusion are met, the two candidates are fused, creating a</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightComment">/// new (fused) candidate which is then added back into the set to consider for</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightComment">/// additional fusion.</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">/// This implementation currently does not make any modifications to remove</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightComment">/// conditions for fusion. Code transformations to make loops conform to each of</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightComment">/// the conditions for fusion are discussed in more detail in the document</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightComment">/// above. These can be added to the current implementation in the future.</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/loopfuse-h">llvm/Transforms/Scalar/LoopFuse.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/dependenceanalysis-h">llvm/Analysis/DependenceAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h">llvm/Analysis/DomTreeUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/postdominators-h">llvm/Analysis/PostDominators.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h">llvm/Analysis/ScalarEvolution.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h">llvm/IR/Verifier.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codemoverutils-h">llvm/Transforms/Utils/CodeMoverUtils.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looppeel-h">llvm/Transforms/Utils/LoopPeel.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopsimplify-h">llvm/Transforms/Utils/LoopSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;loop-fusion&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72" lineLink="#af25e5300161c9d3b28b99d498144921a"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(FuseCounter, </span><span class="doxyHighlightStringLiteral">&quot;Loops fused&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73" lineLink="#a77cf7695f4fc4a36cda60a209316d1ab"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFusionCandidates, </span><span class="doxyHighlightStringLiteral">&quot;Number of candidates for loop fusion&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74" lineLink="#a67fd1cf349f1e6d7f93ac47e43c3ccc2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(InvalidPreheader, </span><span class="doxyHighlightStringLiteral">&quot;Loop has invalid preheader&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75" lineLink="#aa47aa787e5f445ae239ebfb678bea57f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(InvalidHeader, </span><span class="doxyHighlightStringLiteral">&quot;Loop has invalid header&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76" lineLink="#abaa433b5a1c5bc1d3464aaf2ad3fb599"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(InvalidExitingBlock, </span><span class="doxyHighlightStringLiteral">&quot;Loop has invalid exiting blocks&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77" lineLink="#ac097c790de91900d4dee0165a138fcfc"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(InvalidExitBlock, </span><span class="doxyHighlightStringLiteral">&quot;Loop has invalid exit block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#af23374cc893cbd02304c83a14c9f0668"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(InvalidLatch, </span><span class="doxyHighlightStringLiteral">&quot;Loop has invalid latch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79" lineLink="#ac1a507c049c6ff1245e75195e492513b"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(InvalidLoop, </span><span class="doxyHighlightStringLiteral">&quot;Loop is invalid&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80" lineLink="#adbae5a790555463014f0ef28057ec6f2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(AddressTakenBB, </span><span class="doxyHighlightStringLiteral">&quot;Basic block has address taken&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81" lineLink="#aee9ee1018968beee2dfb8dee36c59850"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(MayThrowException, </span><span class="doxyHighlightStringLiteral">&quot;Loop may throw an exception&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82" lineLink="#ad6eae7859ca370c7dbc8a71ca8cf6075"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(ContainsVolatileAccess, </span><span class="doxyHighlightStringLiteral">&quot;Loop contains a volatile access&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83" lineLink="#a7b11210dbe44a9cba5fd60a4484b4b73"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NotSimplifiedForm, </span><span class="doxyHighlightStringLiteral">&quot;Loop is not in simplified form&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84" lineLink="#ac9785158858f0a547b103c962336a261"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(InvalidDependencies, </span><span class="doxyHighlightStringLiteral">&quot;Dependencies prevent fusion&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85" lineLink="#a59b71ff3c7b3ba96ff1138c342e96931"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(UnknownTripCount, </span><span class="doxyHighlightStringLiteral">&quot;Loop has unknown trip count&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="#ac18f71f17a0fa1675570671e375807a8"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(UncomputableTripCount, </span><span class="doxyHighlightStringLiteral">&quot;SCEV cannot compute trip count of loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="#a798f54407382f1d2e511b58c722b5c3d"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NonEqualTripCount, </span><span class="doxyHighlightStringLiteral">&quot;Loop trip counts are not the same&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88" lineLink="#adf178f9450cd52ccb88632ef14c88691"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NonAdjacent, </span><span class="doxyHighlightStringLiteral">&quot;Loops are not adjacent&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89" lineLink="#acd254a21792af653d3fa6e0fe34aba03"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">    NonEmptyPreheader,</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Loop has a non-empty preheader with instructions that cannot be moved&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92" lineLink="#a650763e3353e9471c1f04211d678deb5"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(FusionNotBeneficial, </span><span class="doxyHighlightStringLiteral">&quot;Fusion is not beneficial&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="#a45a3fae061aed8a302ca20348d9ba63c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NonIdenticalGuards, </span><span class="doxyHighlightStringLiteral">&quot;Candidates have different guards&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94" lineLink="#ab31d4f5a7d6dc9fd68a45598bb6cdf18"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NonEmptyExitBlock, </span><span class="doxyHighlightStringLiteral">&quot;Candidate has a non-empty exit block with &quot;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">                             </span><span class="doxyHighlightStringLiteral">&quot;instructions that cannot be moved&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96" lineLink="#a386ed9e129c20c6dab79e889f1b03212"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NonEmptyGuardBlock, </span><span class="doxyHighlightStringLiteral">&quot;Candidate has a non-empty guard block with &quot;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;instructions that cannot be moved&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="#a27e8a653f857506a3409efbf4ad62b1e"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NotRotated, </span><span class="doxyHighlightStringLiteral">&quot;Candidate is not rotated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="#a1907928e54665ef8442054044603ee26"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(OnlySecondCandidateIsGuarded,</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;The second candidate is guarded while the first one is not&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101" lineLink="#af998ca0f46d9903437ba804a2b49fd0b"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumHoistedInsts, </span><span class="doxyHighlightStringLiteral">&quot;Number of hoisted preheader instructions.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="#a42fb67dacc8e161df30e38b00ee9b509"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSunkInsts, </span><span class="doxyHighlightStringLiteral">&quot;Number of hoisted preheader instructions.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104" lineLink="#ab2ce98edbf00ac5582eba4ec2630b50b"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="#ab2ce98edbf00ac5582eba4ec2630b50b">FusionDependenceAnalysisChoice</a> &#123;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105" lineLink="#ab2ce98edbf00ac5582eba4ec2630b50bae2968bc1b6d284f07e96fac3ce78bc54"><span class="doxyHighlight">  <a href="#ab2ce98edbf00ac5582eba4ec2630b50bae2968bc1b6d284f07e96fac3ce78bc54">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;SCEV</a>,</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106" lineLink="#ab2ce98edbf00ac5582eba4ec2630b50ba88a2ef6139ee028e3fa8addb323b3917"><span class="doxyHighlight">  <a href="#ab2ce98edbf00ac5582eba4ec2630b50ba88a2ef6139ee028e3fa8addb323b3917">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;DA</a>,</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#ab2ce98edbf00ac5582eba4ec2630b50ba9f38e26f008e10a2cd493e477865cf72"><span class="doxyHighlight">  <a href="#ab2ce98edbf00ac5582eba4ec2630b50ba9f38e26f008e10a2cd493e477865cf72">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;ALL</a>,</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="#a3940a750c02a84ee62d42113f72210a9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;FusionDependenceAnalysisChoice&gt;</a> <a href="#a3940a750c02a84ee62d42113f72210a9">FusionDependenceAnalysis</a>(</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;loop-fusion-dependence-analysis&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Which dependence analysis should loop fusion use?&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a8fa743aa76b6902028f8a643dfb87171">cl::values</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="#ab2ce98edbf00ac5582eba4ec2630b50bae2968bc1b6d284f07e96fac3ce78bc54">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;SCEV</a>, </span><span class="doxyHighlightStringLiteral">&quot;scev&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;Use the scalar evolution interface&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">               <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="#ab2ce98edbf00ac5582eba4ec2630b50ba88a2ef6139ee028e3fa8addb323b3917">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;DA</a>, </span><span class="doxyHighlightStringLiteral">&quot;da&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;Use the dependence analysis interface&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">               <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="#ab2ce98edbf00ac5582eba4ec2630b50ba9f38e26f008e10a2cd493e477865cf72">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;ALL</a>, </span><span class="doxyHighlightStringLiteral">&quot;all&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;Use all available analyses&quot;</span><span class="doxyHighlight">)),</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<a href="#ab2ce98edbf00ac5582eba4ec2630b50ba9f38e26f008e10a2cd493e477865cf72">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;ALL</a>));</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121" lineLink="#ab7f49e3fad21f68d6d390bae88a74b46"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#ab7f49e3fad21f68d6d390bae88a74b46">FusionPeelMaxCount</a>(</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;loop-fusion-peel-max-count&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max number of iterations to be peeled from a loop, such that &quot;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;fusion can take place&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="#ab393082393415266716b656010c0852a"><span class="doxyHighlight">    <a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>(</span><span class="doxyHighlightStringLiteral">&quot;loop-fusion-verbose-debug&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">                           <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable verbose debugging for Loop Fusion&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">                           <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightComment">/// This class is used to represent a candidate for loop fusion. When it is</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlightComment">/// constructed, it checks the conditions for loop fusion to ensure that it</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlightComment">/// represents a valid candidate. It caches several parts of a loop that are</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlightComment">/// used throughout loop fusion (e.g., loop preheader, loop header, etc) instead</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlightComment">/// of continually querying the underlying Loop to retrieve these values. It is</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightComment">/// assumed these will not change throughout loop fusion.</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlightComment">/// The invalidate method should be used to indicate that the FusionCandidate is</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlightComment">/// no longer a valid candidate for fusion. Similarly, the isValid() method can</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlightComment">/// be used to ensure that the FusionCandidate is still valid for fusion.</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a0a8bbbf9ec7c7e88b08172862188e530">FusionCandidate</a> &#123;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightComment">  /// Cache of parts of the loop used throughout loop fusion. These should not</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightComment">  /// need to change throughout the analysis and transformation.</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlightComment">  /// These parts are cached to avoid repeatedly looking up in the Loop class.</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightComment">  /// Preheader of the loop this candidate represents</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a>;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlightComment">  /// Header of the loop this candidate represents</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a>;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">  /// Blocks in the loop that exit the loop</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a>;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">  /// The successor block of this loop (where the exiting blocks go to)</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a>;</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">  /// Latch of the loop</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a>;</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">  /// The loop that this fusion candidate represents</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>;</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightComment">  /// Vector of instructions in this loop that read from memory</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a385ce5cbf5dba34bbefaf04c2895d516"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 16&gt;</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a385ce5cbf5dba34bbefaf04c2895d516">MemReads</a>;</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightComment">  /// Vector of instructions in this loop that write to memory</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a460b3a88f2ee12615defbeed51ffa425"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 16&gt;</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a460b3a88f2ee12615defbeed51ffa425">MemWrites</a>;</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlightComment">  /// Are all of the members of this fusion candidate still valid</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac933e75323cc3809335d479ef4305898"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac933e75323cc3809335d479ef4305898">Valid</a>;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlightComment">  /// Guard branch of the loop, if it exists</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlightComment">  /// Peeling Paramaters of the Loop.</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a17f8aa5307907f3efaf56c2b2548f2aa"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/targettransforminfo/peelingpreferences">TTI::PeelingPreferences</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a17f8aa5307907f3efaf56c2b2548f2aa">PP</a>;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlightComment">  /// Can you Peel this Loop?</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ab44ba37ede787300af76d483de2cced2"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ab44ba37ede787300af76d483de2cced2">AbleToPeel</a>;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlightComment">  /// Has this loop been Peeled</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a232c3295dd67d2e2c2c758b3c8f4c04d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a232c3295dd67d2e2c2c758b3c8f4c04d">Peeled</a>;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlightComment">  /// Dominator and PostDominator trees are needed for the</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlightComment">  /// FusionCandidateCompare function, required by FusionCandidateSet to</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlightComment">  /// determine where the FusionCandidate should be inserted into the set. These</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlightComment">  /// are used to establish ordering of the FusionCandidates based on dominance.</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac9e172dbe8ae6427270033a0864a9fcb"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac9e172dbe8ae6427270033a0864a9fcb">DT</a>;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a83ead8eb312bdb4310bfab1487d623dc"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/postdominatortree">PostDominatorTree</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a83ead8eb312bdb4310bfab1487d623dc">PDT</a>;</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a7db53013438babe322cef241c773389a"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a7db53013438babe322cef241c773389a">ORE</a>;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a0a8bbbf9ec7c7e88b08172862188e530"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a0a8bbbf9ec7c7e88b08172862188e530">FusionCandidate</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac9e172dbe8ae6427270033a0864a9fcb">DT</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/postdominatortree">PostDominatorTree</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a83ead8eb312bdb4310bfab1487d623dc">PDT</a>,</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a7db53013438babe322cef241c773389a">ORE</a>, <a href="/docs/api/structs/llvm/targettransforminfo/peelingpreferences">TTI::PeelingPreferences</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a17f8aa5307907f3efaf56c2b2548f2aa">PP</a>)</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getLoopPreheader()), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getHeader()),</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getExitingBlock()), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getExitBlock()),</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getLoopLatch()), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac933e75323cc3809335d479ef4305898">Valid</a>(<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>),</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getLoopGuardBranch()), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a17f8aa5307907f3efaf56c2b2548f2aa">PP</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a17f8aa5307907f3efaf56c2b2548f2aa">PP</a>), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ab44ba37ede787300af76d483de2cced2">AbleToPeel</a>(<a href="/docs/api/namespaces/llvm/#a3aea1e78510aa7469457aade10808e51">canPeel</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>)),</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a232c3295dd67d2e2c2c758b3c8f4c04d">Peeled</a>(<a href="/docs/api/namespaces/false">false</a>), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac9e172dbe8ae6427270033a0864a9fcb">DT</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac9e172dbe8ae6427270033a0864a9fcb">DT</a>), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a83ead8eb312bdb4310bfab1487d623dc">PDT</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a83ead8eb312bdb4310bfab1487d623dc">PDT</a>), <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a7db53013438babe322cef241c773389a">ORE</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a7db53013438babe322cef241c773389a">ORE</a>) &#123;</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Walk over all blocks in the loop and check for conditions that may</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// prevent fusion. For each block, walk over all instructions and collect</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the memory reads and writes If any instructions that prevent fusion are</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// found, invalidate this object and return.</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">      if (BB-&gt;hasAddressTaken()) &#123;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">        invalidate();</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">        reportInvalidCandidate(AddressTakenBB);</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">        return;</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayThrow()) &#123;</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">          invalidate();</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codemoverutils-cpp/#a134ee84d052b18522fd2d6bca5cf0778">reportInvalidCandidate</a>(MayThrowException);</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isVolatile()) &#123;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">            invalidate();</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codemoverutils-cpp/#a134ee84d052b18522fd2d6bca5cf0778">reportInvalidCandidate</a>(ContainsVolatileAccess);</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;isVolatile()) &#123;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">            invalidate();</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codemoverutils-cpp/#a134ee84d052b18522fd2d6bca5cf0778">reportInvalidCandidate</a>(ContainsVolatileAccess);</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayWriteToMemory())</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a460b3a88f2ee12615defbeed51ffa425">MemWrites</a>.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadFromMemory())</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a385ce5cbf5dba34bbefaf04c2895d516">MemReads</a>.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlightComment">  /// Check if all members of the class are valid.</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a516640cfe68e1b63251dd7d87c3adaa1"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a516640cfe68e1b63251dd7d87c3adaa1">isValid</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a> &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a> &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a> &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a> &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a> &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a> &amp;&amp;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">           !<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;isInvalid() &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac933e75323cc3809335d479ef4305898">Valid</a>;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlightComment">  /// Verify that all members are in sync with the Loop object.</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a3d79b9453c59df95d134afd2902af5b2"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a3d79b9453c59df95d134afd2902af5b2">verify</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a516640cfe68e1b63251dd7d87c3adaa1">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Candidate is not valid!!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;isInvalid() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop is invalid!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a> == <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getLoopPreheader() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Preheader is out of sync&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a> == <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getHeader() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Header is out of sync&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a> == <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getExitingBlock() &amp;&amp;</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Exiting Blocks is out of sync&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a> == <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getExitBlock() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Exit block is out of sync&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a> == <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getLoopLatch() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Latch is out of sync&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlightComment">  /// Get the entry block for this fusion candidate.</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlightComment">  /// If this fusion candidate represents a guarded loop, the entry block is the</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlightComment">  /// loop guard block. If it represents an unguarded loop, the entry block is</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlightComment">  /// the preheader of the loop.</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#af05db6896587c2826dd97fa443a8e260"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#af05db6896587c2826dd97fa443a8e260">getEntryBlock</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>)</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>-&gt;getParent();</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a>;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlightComment">  /// After Peeling the loop is modified quite a bit, hence all of the Blocks</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlightComment">  /// need to be updated accordingly.</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a8bfc82c01ea0b8dc8261f4017d429287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a8bfc82c01ea0b8dc8261f4017d429287">updateAfterPeeling</a>() &#123;</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a> = <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a> = <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getHeader();</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a> = <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getExitingBlock();</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a> = <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getExitBlock();</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a> = <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getLoopLatch();</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a3d79b9453c59df95d134afd2902af5b2">verify</a>();</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlightComment">  /// Given a guarded loop, get the successor of the guard that is not in the</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlightComment">  /// loop.</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlightComment">  /// This method returns the successor of the loop guard that is not located</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlightComment">  /// within the loop (i.e., the successor of the guard that is not the</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlightComment">  /// preheader).</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlightComment">  /// This method is only valid for guarded loops.</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a3f9422bc7988a8d974f4477d56a94b58"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a3f9422bc7988a8d974f4477d56a94b58">getNonLoopBlock</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Only valid on guarded loops.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>-&gt;isConditional() &amp;&amp;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expecting guard to be a conditional branch.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a232c3295dd67d2e2c2c758b3c8f4c04d">Peeled</a>)</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>-&gt;getSuccessor(1);</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>-&gt;getSuccessor(0) == <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a>)</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">               ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>-&gt;getSuccessor(1)</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">               : <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a4392517c22c653d59c5deead6ccfffb7"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a4392517c22c653d59c5deead6ccfffb7">dump</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tGuardBranch: &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>)</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; &#42;<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a> ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ac941dd6cb39bf15cf131fdb815204058">GuardBranch</a>-&gt;getName() : </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tPreheader: &quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a> ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a>-&gt;getName() : </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tHeader: &quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a> ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a>-&gt;getName() : </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tExitingBB: &quot;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a> ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a>-&gt;getName() : </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tExitBB: &quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a> ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a>-&gt;getName() : </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tLatch: &quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a> ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a>-&gt;getName() : </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tEntryBlock: &quot;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#af05db6896587c2826dd97fa443a8e260">getEntryBlock</a>() ? <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#af05db6896587c2826dd97fa443a8e260">getEntryBlock</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() : </span><span class="doxyHighlightStringLiteral">&quot;nullptr&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlightComment">  /// Determine if a fusion candidate (representing a loop) is eligible for</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlightComment">  /// fusion. Note that this only checks whether a single loop can be fused - it</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlightComment">  /// does not check whether it is &#42;legal&#42; to fuse two loops together.</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1f677960b0a306e237ee9fa3b838639d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1f677960b0a306e237ee9fa3b838639d">isEligibleForFusion</a>(<a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a516640cfe68e1b63251dd7d87c3adaa1">isValid</a>()) &#123;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;FC has invalid CFG requirements!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a>)</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">        ++InvalidPreheader;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ca41b3283414bbe68b662ea7afacafb">Header</a>)</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">        ++InvalidHeader;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1ef066e3bf3c078c1a230bcb65860219">ExitingBlock</a>)</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">        ++InvalidExitingBlock;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#aa216f276b8d0c8a38aa269b0087d98ea">ExitBlock</a>)</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">        ++InvalidExitBlock;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#a1cf4116319c12ae1bd66f99b21137070">Latch</a>)</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">        ++InvalidLatch;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;isInvalid())</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">        ++InvalidLoop;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Require ScalarEvolution to be able to determine a trip count.</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE.<a href="/docs/api/classes/llvm/scalarevolution/#a91ac801aa45c78e0d0edbc36115ef054">hasLoopInvariantBackedgeTakenCount</a>(<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>)) &#123;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Loop &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getName()</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; trip count not computable!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> reportInvalidCandidate(UnknownTripCount);</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;isLoopSimplifyForm()) &#123;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Loop &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getName()</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is not in simplified form!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> reportInvalidCandidate(NotSimplifiedForm);</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;isRotatedForm()) &#123;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Loop &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#ad4cd533fe25fea3f12356b39ebd7922c">L</a>-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is not rotated!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> reportInvalidCandidate(NotRotated);</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is only used internally for now, to clear the MemWrites and MemReads</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// list and setting Valid to false. I can&#39;t envision other uses of this right</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// now, since once FusionCandidates are put into the FusionCandidateSet they</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are immutable. Thus, any time we need to change/update a FusionCandidate,</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we must create a new one and insert it into the FusionCandidateSet to</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ensure the FusionCandidateSet remains ordered correctly.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> invalidate() &#123;</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    MemWrites.clear();</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">    MemReads.clear();</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    Valid = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codemoverutils-cpp/#a134ee84d052b18522fd2d6bca5cf0778">reportInvalidCandidate</a>(<a href="/docs/api/namespaces/llvm/#a6412c3ea6550f1aeab7571b6d38a2bf3">llvm::Statistic</a> &amp;Stat)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/ore">ore</a>;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L &amp;&amp; Preheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Fusion candidate not initialized properly!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlightPreprocessor">#if LLVM&#95;ENABLE&#95;STATS</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">    ++Stat;</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    ORE.emit(<a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, Stat.getName(),</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">                                        L-&gt;getStartLoc(), Preheader)</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; Preheader-&gt;getParent()-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;: &quot;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Loop is not a candidate for fusion: &quot;</span><span class="doxyHighlight"> &lt;&lt; Stat.getDesc());</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidatecompare"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidatecompare">FusionCandidateCompare</a> &#123;</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlightComment">  /// Comparison functor to sort two Control Flow Equivalent fusion candidates</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlightComment">  /// into dominance order.</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlightComment">  /// If LHS dominates RHS and RHS post-dominates LHS, return true;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlightComment">  /// If RHS dominates LHS and LHS post-dominates RHS, return false;</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlightComment">  /// If both LHS and RHS are not dominating each other then, non-strictly</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlightComment">  /// post dominate check will decide the order of candidates. If RHS</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlightComment">  /// non-strictly post dominates LHS then, return true. If LHS non-strictly</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlightComment">  /// post dominates RHS then, return false. If both are non-strictly post</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlightComment">  /// dominate each other then, level in the post dominator tree will decide</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlightComment">  /// the order of candidates.</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidatecompare/#aea9f11701fcbd34a98f7da033c725845"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidatecompare/#aea9f11701fcbd34a98f7da033c725845">operator()</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate">FusionCandidate</a> &amp;LHS,</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate">FusionCandidate</a> &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT = &amp;(LHS.DT);</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LHSEntryBlock = LHS.getEntryBlock();</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RHSEntryBlock = RHS.getEntryBlock();</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not save PDT to local variable as it is only used in asserts and thus</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will trigger an unused variable warning if building without asserts.</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT &amp;&amp; LHS.PDT &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting valid dominator tree&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do this compare first so if LHS == RHS, function returns false.</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(RHSEntryBlock, LHSEntryBlock)) &#123;</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// RHS dominates LHS</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Verify LHS post-dominates RHS</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LHS.PDT-&gt;dominates(LHSEntryBlock, RHSEntryBlock));</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(LHSEntryBlock, RHSEntryBlock)) &#123;</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Verify RHS Postdominates LHS</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LHS.PDT-&gt;dominates(RHSEntryBlock, LHSEntryBlock));</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If two FusionCandidates are in the same level of dominator tree,</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// they will not dominate each other, but may still be control flow</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// equivalent. To sort those FusionCandidates, nonStrictlyPostDominate()</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function is needed.</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> WrongOrder =</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a90896a5c2c14e27297f4fdb0196e24b3">nonStrictlyPostDominate</a>(LHSEntryBlock, RHSEntryBlock, DT, LHS.PDT);</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RightOrder =</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a90896a5c2c14e27297f4fdb0196e24b3">nonStrictlyPostDominate</a>(RHSEntryBlock, LHSEntryBlock, DT, LHS.PDT);</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WrongOrder &amp;&amp; RightOrder) &#123;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If common predecessor of LHS and RHS post dominates both</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FusionCandidates then, Order of FusionCandidate can be</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// identified by its level in post dominator tree.</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;LNode = LHS.PDT-&gt;getNode(LHSEntryBlock);</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;RNode = LHS.PDT-&gt;getNode(RHSEntryBlock);</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LNode-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#ab73bfd7dc4d5a446db965380e340810e">getLevel</a>() &gt; RNode-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#ab73bfd7dc4d5a446db965380e340810e">getLevel</a>();</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WrongOrder)</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RightOrder)</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If LHS does not non-strict Postdominate RHS and RHS does not non-strict</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Postdominate LHS then, there is no dominance relationship between the</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// two FusionCandidates. Thus, they should not be in the same set together.</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;No dominance relationship between these fusion candidates!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a9d85c23b999467640f95976e638879c5"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a9d85c23b999467640f95976e638879c5">LoopVector</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Loop &#42;, 4&gt;</a>;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlightComment">// Set of Control Flow Equivalent (CFE) Fusion Candidates, sorted in dominance</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlightComment">// order. Thus, if FC0 comes &#42;before&#42; FC1 in a FusionCandidateSet, then FC0</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlightComment">// dominates FC1 and FC1 post-dominates FC0.</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlightComment">// std::set was chosen because we want a sorted data structure with stable</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlightComment">// iterators. A subsequent patch to loop fusion will enable fusing non-adjacent</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlightComment">// loops by moving intervening code around. When this intervening code contains</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlightComment">// loops, those loops will be moved also. The corresponding FusionCandidates</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlightComment">// will also need to be moved accordingly. As this is done, having stable</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlightComment">// iterators will simplify the logic. Similarly, having an efficient insert that</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlightComment">// keeps the FusionCandidateSet sorted will also simplify the implementation.</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a8974eb1cd0d99da470c576c3b3388bf6"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a8974eb1cd0d99da470c576c3b3388bf6">FusionCandidateSet</a> = std::set&lt;FusionCandidate, FusionCandidateCompare&gt;;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a44fb48936a12b31b5ea5ee46a68bdb5b"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a44fb48936a12b31b5ea5ee46a68bdb5b">FusionCandidateCollection</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;FusionCandidateSet, 4&gt;</a>;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG)</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-/#aa506097a36d959420dac669534698de9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/raw-ostream">llvm::raw&#95;ostream</a> &amp;<a href="/docs/api/namespaces/llvm/#ab89f1db02887aa569176f0e29622eb47">operator&lt;&lt;</a>(<a href="/docs/api/classes/llvm/raw-ostream">llvm::raw&#95;ostream</a> &amp;OS,</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate">FusionCandidate</a> &amp;FC) &#123;</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC.isValid())</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">    OS &lt;&lt; FC.Preheader-&gt;getName();</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">    OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&lt;Invalid&gt;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OS;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a0bb91e2be2b82decfeba4bb0fad02bc0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/raw-ostream">llvm::raw&#95;ostream</a> &amp;<a href="/docs/api/namespaces/llvm/#ab89f1db02887aa569176f0e29622eb47">operator&lt;&lt;</a>(<a href="/docs/api/classes/llvm/raw-ostream">llvm::raw&#95;ostream</a> &amp;OS,</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a8974eb1cd0d99da470c576c3b3388bf6">FusionCandidateSet</a> &amp;CandSet) &#123;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate">FusionCandidate</a> &amp;FC : CandSet)</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    OS &lt;&lt; FC &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OS;</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a994216a333a1422e927cbb273707237d"><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a994216a333a1422e927cbb273707237d">printFusionCandidates</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a44fb48936a12b31b5ea5ee46a68bdb5b">FusionCandidateCollection</a> &amp;FusionCandidates) &#123;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion Candidates: \\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;CandidateSet : FusionCandidates) &#123;</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42; Fusion Candidate Set &#42;&#42;&#42;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; CandidateSet;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlightComment">/// Collect all loops in function at the same nest level, starting at the</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlightComment">/// outermost level.</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlightComment">/// This data structure collects all loops at the same nest level for a</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlightComment">/// given function (specified by the LoopInfo object). It starts at the</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlightComment">/// outermost level.</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aefbd5c664bf130202e94d489f76d7999">LoopDepthTree</a> &#123;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a63094738a24dc06e244bb55f4d1325b0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a63094738a24dc06e244bb55f4d1325b0">LoopsOnLevelTy</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;LoopVector, 4&gt;</a>;</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a43a4ed05b4bc4ea80c838e66589bd032"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a43a4ed05b4bc4ea80c838e66589bd032">iterator</a> = <a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a9eae7ba1448d9866beca95a042de2e11">LoopsOnLevelTy::iterator</a>;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a107e863d5cbf94d99f7fae537c848269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a107e863d5cbf94d99f7fae537c848269">const&#95;iterator</a> = <a href="/docs/api/classes/llvm/smallvectortemplatecommon/#aa11b903431c1931920939bac6b5293a2">LoopsOnLevelTy::const&#95;iterator</a>;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aefbd5c664bf130202e94d489f76d7999"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aefbd5c664bf130202e94d489f76d7999">LoopDepthTree</a>(<a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI) : Depth(1) &#123;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI.<a href="/docs/api/classes/llvm/loopinfobase/#a83d8036930a033b196409ced5c9409e5">empty</a>())</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">      LoopsOnLevel.emplace&#95;back(<a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a9d85c23b999467640f95976e638879c5">LoopVector</a>(LI.<a href="/docs/api/classes/llvm/loopinfobase/#ad491e953f7f6ef6129f2dfcc51a4b3da">rbegin</a>(), LI.<a href="/docs/api/classes/llvm/loopinfobase/#a4b3bd736cc047e31bab2291e2b1d4767">rend</a>()));</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlightComment">  /// Test whether a given loop has been removed from the function, and thus is</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlightComment">  /// no longer valid.</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a4ae59aef4fdbedd53fde205c8ca864ce"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a4ae59aef4fdbedd53fde205c8ca864ce">isRemovedLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RemovedLoops.count(L); &#125;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlightComment">  /// Record that a given loop has been removed from the function and is no</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlightComment">  /// longer valid.</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aa93014b4e347bf6ff3fcb95a87e08193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aa93014b4e347bf6ff3fcb95a87e08193">removeLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123; RemovedLoops.insert(L); &#125;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">  /// Descend the tree to the next (inner) nesting level</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aea0d9800d14f08ba6d3597be21a1159c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aea0d9800d14f08ba6d3597be21a1159c">descend</a>() &#123;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a63094738a24dc06e244bb55f4d1325b0">LoopsOnLevelTy</a> LoopsOnNextLevel;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a9d85c23b999467640f95976e638879c5">LoopVector</a> &amp;LV : &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L : LV)</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a4ae59aef4fdbedd53fde205c8ca864ce">isRemovedLoop</a>(L) &amp;&amp; L-&gt;begin() != L-&gt;end())</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">          LoopsOnNextLevel.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(<a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a9d85c23b999467640f95976e638879c5">LoopVector</a>(L-&gt;begin(), L-&gt;end()));</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">    LoopsOnLevel = LoopsOnNextLevel;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">    RemovedLoops.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">    Depth++;</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#abcbd121c0c4a872933dca6722d4da55e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#abcbd121c0c4a872933dca6722d4da55e">empty</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmreflect-cpp/#ac934769d93af95250952646a3829df4c">size</a>() == 0; &#125;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a0a98a66eeba1bbd96c8901911915dd77"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a0a98a66eeba1bbd96c8901911915dd77">size</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopsOnLevel.size() - RemovedLoops.size(); &#125;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a7e65ac34c6aeb1be70e195c98219d273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a7e65ac34c6aeb1be70e195c98219d273">getDepth</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Depth; &#125;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#af5c258b97c11da0fe95ee9d0e343e701"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a43a4ed05b4bc4ea80c838e66589bd032">iterator</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#af5c258b97c11da0fe95ee9d0e343e701">begin</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopsOnLevel.begin(); &#125;</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aa5d8729e589a1823e84bfbdcac99d244"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a43a4ed05b4bc4ea80c838e66589bd032">iterator</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#aa5d8729e589a1823e84bfbdcac99d244">end</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopsOnLevel.end(); &#125;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a98aa1de64a9ad7239e59686f7979d23c"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a107e863d5cbf94d99f7fae537c848269">const&#95;iterator</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a98aa1de64a9ad7239e59686f7979d23c">begin</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopsOnLevel.begin(); &#125;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#ac18a185392d3611e6ecce4afb05ecf77"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#a107e863d5cbf94d99f7fae537c848269">const&#95;iterator</a> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree/#ac18a185392d3611e6ecce4afb05ecf77">end</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopsOnLevel.end(); &#125;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlightComment">  /// Set of loops that have been removed from the function and are no longer</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlightComment">  /// valid.</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Loop &#42;, 8&gt;</a> RemovedLoops;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlightComment">  /// Depth of the current level, starting at 1 (outermost loops).</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlightComment">  /// Vector of loops at the current depth level that have the same parent loop</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  LoopsOnLevelTy LoopsOnLevel;</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553" lineLink="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a8186e787c97d26329af95c09c8a14949"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a8186e787c97d26329af95c09c8a14949">printLoopVector</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a9d85c23b999467640f95976e638879c5">LoopVector</a> &amp;LV) &#123;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;L : LV)</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#af74d55b9091c302365e3af53f446a2a2">printLoop</a>(&#42;L, <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopfuser"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopfuser/#aa45e97b4464564abfedc01683fcbef5d">LoopFuser</a> &#123;</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sets of control flow equivalent fusion candidates for a given nest level.</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a44fb48936a12b31b5ea5ee46a68bdb5b">FusionCandidateCollection</a> FusionCandidates;</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopdepthtree">LoopDepthTree</a> LDT;</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> DTU;</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dependenceinfo">DependenceInfo</a> &amp;DI;</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/postdominatortree">PostDominatorTree</a> &amp;PDT;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;ORE;</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &amp;AC;</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopfuser/#aa45e97b4464564abfedc01683fcbef5d"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopfuser/#aa45e97b4464564abfedc01683fcbef5d">LoopFuser</a>(<a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT, <a href="/docs/api/classes/llvm/dependenceinfo">DependenceInfo</a> &amp;DI,</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE, <a href="/docs/api/classes/llvm/postdominatortree">PostDominatorTree</a> &amp;PDT,</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;ORE, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &amp;AC, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI)</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">      : LDT(LI), DTU(DT, PDT, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a>::UpdateStrategy::Lazy), LI(LI),</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">        DT(DT), DI(DI), SE(SE), PDT(PDT), ORE(ORE), AC(AC), TTI(TTI) &#123;&#125;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlightComment">  /// This is the main entry point for loop fusion. It will traverse the</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlightComment">  /// specified function and collect candidate loops to fuse, starting at the</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlightComment">  /// outermost nesting level and working inwards.</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589" lineLink="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopfuser/#a3ce251220e1d2d9ea7bcc51ffa076a22"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/loopfuser/#a3ce251220e1d2d9ea7bcc51ffa076a22">fuseLoops</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>) &#123;</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      LI.print(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Performing Loop Fusion on function &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!LDT.empty()) &#123;</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Got &quot;</span><span class="doxyHighlight"> &lt;&lt; LDT.size() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; loop sets for depth &quot;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">                        &lt;&lt; LDT.getDepth() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;);</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a9d85c23b999467640f95976e638879c5">LoopVector</a> &amp;LV : LDT) &#123;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LV.size() &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Empty loop set was build!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Skip singleton loop sets as they do not offer fusion opportunities on</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// this level.</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LV.size() == 1)</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>) &#123;</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Visit loop set (#&quot;</span><span class="doxyHighlight"> &lt;&lt; LV.size() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;):\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">            <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a8186e787c97d26329af95c09c8a14949">printLoopVector</a>(LV);</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">          &#125;);</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">        collectFusionCandidates(LV);</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= fuseCandidates();</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Finished analyzing candidates at this level.</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Descend to the next level and clear all of the candidates currently</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// collected. Note that it will not be possible to fuse any of the</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// existing candidates with new candidates because the new candidates will</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// be at a different nest level and thus not be control flow equivalent</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// with all of the candidates collected so far.</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Descend one level!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      LDT.descend();</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">      FusionCandidates.clear();</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Function after Loop Fusion: \\n&quot;</span><span class="doxyHighlight">; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.dump(););</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.verify());</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PDT.verify());</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">    LI.verify(DT);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">    SE.verify();</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Loop Fusion complete\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlightComment">  /// Determine if two fusion candidates are control flow equivalent.</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlightComment">  /// Two fusion candidates are control flow equivalent if when one executes,</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlightComment">  /// the other is guaranteed to execute. This is determined using dominators</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlightComment">  /// and post-dominators: if A dominates B and B post-dominates A then A and B</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlightComment">  /// are control-flow equivalent.</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a86a71a2b6a39dfb4ddb69ab4ed006eac">isControlFlowEquivalent</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate">FusionCandidate</a> &amp;FC0,</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate">FusionCandidate</a> &amp;FC1)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0.<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a> &amp;&amp; FC1.<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#adc8c271beba911eb5fa45d229afc43c7">Preheader</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting valid preheaders&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    return ::isControlFlowEquivalent(&#42;FC0.<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#af05db6896587c2826dd97fa443a8e260">getEntryBlock</a>(), &#42;FC1.<a href="/docs/api/structs/anonymous-namespace-loopfuse-cpp-/fusioncandidate/#af05db6896587c2826dd97fa443a8e260">getEntryBlock</a>(),</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">                                     DT, PDT);</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlightComment">  /// Iterate over all loops in the given loop set and identify the loops that</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlightComment">  /// are eligible for fusion. Place all eligible fusion candidates into Control</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlightComment">  /// Flow Equivalent sets, sorted by dominance.</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> collectFusionCandidates(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LoopVector &amp;LV) &#123;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L : LV) &#123;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/targettransforminfo/peelingpreferences">TTI::PeelingPreferences</a> PP =</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a6e86d0ac2e968adc60290ca52da02e42">gatherPeelingPreferences</a>(L, SE, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, std::nullopt, std::nullopt);</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">      FusionCandidate CurrCand(L, DT, &amp;PDT, ORE, PP);</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurrCand.isEligibleForFusion(SE))</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Go through each list in FusionCandidates and determine if L is control</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// flow equivalent with the first loop in that list. If it is, append LV.</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If not, go to the next list.</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If no suitable list is found, start another list and add it to</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FusionCandidates.</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoundSet = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;CurrCandSet : FusionCandidates) &#123;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a86a71a2b6a39dfb4ddb69ab4ed006eac">isControlFlowEquivalent</a>(&#42;CurrCandSet.begin(), CurrCand)) &#123;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">          CurrCandSet.insert(CurrCand);</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">          FoundSet = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>)</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrCand</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">                              &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to existing candidate set\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FoundSet) &#123;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// No set was found. Create a new set and add to FusionCandidates</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>)</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrCand &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to new set\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">        <a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a8974eb1cd0d99da470c576c3b3388bf6">FusionCandidateSet</a> NewCandSet;</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">        NewCandSet.insert(CurrCand);</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">        FusionCandidates.push&#95;back(NewCandSet);</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">      NumFusionCandidates++;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlightComment">  /// Determine if it is beneficial to fuse two loops.</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlightComment">  /// For now, this method simply returns true because we want to fuse as much</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlightComment">  /// as possible (primarily to test the pass). This method will evolve, over</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlightComment">  /// time, to add heuristics for profitability of fusion.</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isBeneficialFusion(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1) &#123;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlightComment">  /// Determine if two fusion candidates have the same trip count (i.e., they</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlightComment">  /// execute the same number of iterations).</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlightComment">  /// This function will return a pair of values. The first is a boolean,</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlightComment">  /// stating whether or not the two candidates are known at compile time to</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlightComment">  /// have the same TripCount. The second is the difference in the two</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlightComment">  /// TripCounts. This information can be used later to determine whether or not</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlightComment">  /// peeling can be performed on either one of the candidates.</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  std::pair&lt;bool, std::optional&lt;unsigned&gt;&gt;</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  haveIdenticalTripCounts(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;TripCount0 = SE.getBackedgeTakenCount(FC0.L);</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(TripCount0)) &#123;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">      UncomputableTripCount++;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Trip count of first loop could not be computed!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, std::nullopt&#125;;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;TripCount1 = SE.getBackedgeTakenCount(FC1.L);</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(TripCount1)) &#123;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">      UncomputableTripCount++;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Trip count of second loop could not be computed!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, std::nullopt&#125;;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tTrip counts: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TripCount0 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &amp; &quot;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">                      &lt;&lt; &#42;TripCount1 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; are &quot;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">                      &lt;&lt; (TripCount0 == TripCount1 ? </span><span class="doxyHighlightStringLiteral">&quot;identical&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;different&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TripCount0 == TripCount1)</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, 0&#125;;</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;The loops do not have the same tripcount, &quot;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;determining the difference between trip counts\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Currently only considering loops with a single exit point</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and a non-constant trip count.</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TC0 = SE.getSmallConstantTripCount(FC0.L);</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TC1 = SE.getSmallConstantTripCount(FC1.L);</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If any of the tripcounts are zero that means that loop(s) do not have</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a single exit or a constant tripcount.</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TC0 == 0 || TC1 == 0) &#123;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Loop(s) do not have a single exit point or do not &quot;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;have a constant number of iterations. Peeling &quot;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;is not benefical\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, std::nullopt&#125;;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; Difference;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Diff = TC0 - TC1;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Diff &gt; 0)</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">      Difference = Diff;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Difference is less than 0 FC1 (second loop) has more &quot;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;iterations than the first one. Currently not supported\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Difference in loop trip count is: &quot;</span><span class="doxyHighlight"> &lt;&lt; Difference</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, Difference&#125;;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> peelFusionCandidate(FusionCandidate &amp;FC0, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1,</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PeelCount) &#123;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0.AbleToPeel &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should be able to peel loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Attempting to peel first &quot;</span><span class="doxyHighlight"> &lt;&lt; PeelCount</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; iterations of the first loop. \\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> VMap;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    FC0.Peeled = <a href="/docs/api/namespaces/llvm/#afdb3eec2f46233c924c30c0838a3c8fe">peelLoop</a>(FC0.L, PeelCount, &amp;LI, &amp;SE, DT, &amp;AC, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, VMap);</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.Peeled) &#123;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Done Peeling\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IdenticalTripCount = haveIdenticalTripCounts(FC0, FC1);</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IdenticalTripCount.first &amp;&amp; &#42;IdenticalTripCount.second == 0 &amp;&amp;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Loops should have identical trip counts after peeling&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      FC0.PP.PeelCount += PeelCount;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Peeling does not update the PDT</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">      PDT.recalculate(&#42;FC0.Preheader-&gt;getParent());</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">      FC0.updateAfterPeeling();</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// In this case the iterations of the loop are constant, so the first</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// loop will execute completely (will not jump from one of</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the peeled blocks to the second loop). Here we are updating the</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// branch conditions of each of the peeled blocks, such that it will</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// branch to its successor which is not the preheader of the second loop</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in the case of unguarded loops, or the succesors of the exit block of</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the first loop otherwise. Doing this update will ensure that the entry</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// block of the first loop dominates the entry block of the second loop.</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BB =</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">          FC0.GuardBranch ? FC0.ExitBlock-&gt;getUniqueSuccessor() : FC1.Preheader;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB) &#123;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;DominatorTree::UpdateType, 8&gt;</a> TreeUpdates;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">        SmallVector&lt;Instruction &#42;, 8&gt; WorkList;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != FC0.ExitBlock) &#123;</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">            WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">            TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">                DominatorTree::UpdateType(DominatorTree::Delete, Pred, BB));</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Cannot modify the predecessors inside the above loop as it will cause</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the iterators to be nullptrs, causing memory errors.</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;CurrentBranch : WorkList) &#123;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Succ = CurrentBranch-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == BB)</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">            Succ = CurrentBranch-&gt;getSuccessor(1);</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(CurrentBranch, <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Succ));</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">        DTU.applyUpdates(TreeUpdates);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">        DTU.flush();</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sucessfully peeled &quot;</span><span class="doxyHighlight"> &lt;&lt; FC0.PP.PeelCount</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">                 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; iterations from the first loop.\\n&quot;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;Both Loops have the same number of iterations now.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlightComment">  /// Walk each set of control flow equivalent fusion candidates and attempt to</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlightComment">  /// fuse them. This does a single linear traversal of all candidates in the</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlightComment">  /// set. The conditions for legal fusion are checked at this point. If a pair</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlightComment">  /// of fusion candidates passes all legality checks, they are fused together</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlightComment">  /// and a new fusion candidate is created and added to the FusionCandidateSet.</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlightComment">  /// The original fusion candidates are then removed, as they are no longer</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlightComment">  /// valid.</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> fuseCandidates() &#123;</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Fused = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/anonymous-loopfuse-cpp-/#a994216a333a1422e927cbb273707237d">printFusionCandidates</a>(FusionCandidates));</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;CandidateSet : FusionCandidates) &#123;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CandidateSet.size() &lt; 2)</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Attempting fusion on Candidate Set:\\n&quot;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">                        &lt;&lt; CandidateSet &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FC0 = CandidateSet.begin(); FC0 != CandidateSet.end(); ++FC0) &#123;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LDT.isRemovedLoop(FC0-&gt;L) &amp;&amp;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Should not have removed loops in CandidateSet!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FC1 = FC0;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++FC1; FC1 != CandidateSet.end(); ++FC1) &#123;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LDT.isRemovedLoop(FC1-&gt;L) &amp;&amp;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;Should not have removed loops in CandidateSet!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Attempting to fuse candidate \\n&quot;</span><span class="doxyHighlight">; FC0-&gt;dump();</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">                     <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with\\n&quot;</span><span class="doxyHighlight">; FC1-&gt;dump(); <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">          FC0-&gt;verify();</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">          FC1-&gt;verify();</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Check if the candidates have identical tripcounts (first value of</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// pair), and if not check the difference in the tripcounts between</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// the loops (second value of pair). The difference is not equal to</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// std::nullopt iff the loops iterate a constant number of times, and</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// have a single exit.</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">          std::pair&lt;bool, std::optional&lt;unsigned&gt;&gt; IdenticalTripCountRes =</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">              haveIdenticalTripCounts(&#42;FC0, &#42;FC1);</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SameTripCount = IdenticalTripCountRes.first;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">          std::optional&lt;unsigned&gt; TCDifference = IdenticalTripCountRes.second;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Here we are checking that FC0 (the first loop) can be peeled, and</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// both loops have different tripcounts.</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0-&gt;AbleToPeel &amp;&amp; !SameTripCount &amp;&amp; TCDifference) &#123;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;TCDifference &gt; <a href="#ab7f49e3fad21f68d6d390bae88a74b46">FusionPeelMaxCount</a>) &#123;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">                         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Difference in loop trip counts: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TCDifference</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">                         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is greater than maximum peel count specificed: &quot;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">                         &lt;&lt; <a href="#ab7f49e3fad21f68d6d390bae88a74b46">FusionPeelMaxCount</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">            &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// Dependent on peeling being performed on the first loop, and</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// assuming all other conditions for fusion return true.</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">              SameTripCount = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SameTripCount) &#123;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion candidates do not have identical trip &quot;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;counts. Not fusing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">            reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1,</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">                                                       NonEqualTripCount);</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isAdjacent(&#42;FC0, &#42;FC1)) &#123;</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">                       &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion candidates are not adjacent. Not fusing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">            reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1, NonAdjacent);</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!FC0-&gt;GuardBranch &amp;&amp; FC1-&gt;GuardBranch) ||</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">              (FC0-&gt;GuardBranch &amp;&amp; !FC1-&gt;GuardBranch)) &#123;</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;The one of candidate is guarded while the &quot;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;another one is not. Not fusing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">            reportLoopFusion&lt;OptimizationRemarkMissed&gt;(</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">                &#42;FC0, &#42;FC1, OnlySecondCandidateIsGuarded);</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Ensure that FC0 and FC1 have identical guards.</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If one (or both) are not guarded, this check is not necessary.</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0-&gt;GuardBranch &amp;&amp; FC1-&gt;GuardBranch &amp;&amp;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">              !haveIdenticalGuards(&#42;FC0, &#42;FC1) &amp;&amp; !TCDifference) &#123;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion candidates do not have identical &quot;</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;guards. Not Fusing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">            reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1,</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">                                                       NonIdenticalGuards);</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0-&gt;GuardBranch) &#123;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC1-&gt;GuardBranch &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting valid FC1 guard branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#adffe8dd96d1c957f04909ca9c2cd79ba">isSafeToMoveBefore</a>(&#42;FC0-&gt;ExitBlock,</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">                                    &#42;FC1-&gt;ExitBlock-&gt;getFirstNonPHIOrDbg(), DT,</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">                                    &amp;PDT, &amp;DI)) &#123;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion candidate contains unsafe &quot;</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">                                   </span><span class="doxyHighlightStringLiteral">&quot;instructions in exit block. Not fusing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">              reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1,</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">                                                         NonEmptyExitBlock);</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#adffe8dd96d1c957f04909ca9c2cd79ba">isSafeToMoveBefore</a>(</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">                    &#42;FC1-&gt;GuardBranch-&gt;getParent(),</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">                    &#42;FC0-&gt;GuardBranch-&gt;getParent()-&gt;getTerminator(), DT, &amp;PDT,</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">                    &amp;DI)) &#123;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">                         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion candidate contains unsafe &quot;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;instructions in guard block. Not fusing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">              reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1,</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">                                                         NonEmptyGuardBlock);</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Check the dependencies across the loops and do not fuse if it would</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// violate them.</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!dependencesAllowFusion(&#42;FC0, &#42;FC1)) &#123;</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Memory dependencies do not allow fusion!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">            reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1,</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">                                                       InvalidDependencies);</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the second loop has instructions in the pre-header, attempt to</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// hoist them up to the first loop&#39;s pre-header or sink them into the</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// body of the second loop.</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">          SmallVector&lt;Instruction &#42;, 4&gt; SafeToHoist;</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">          SmallVector&lt;Instruction &#42;, 4&gt; SafeToSink;</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// At this point, this is the last remaining legality check.</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Which means if we can make this pre-header empty, we can fuse</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// these loops</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isEmptyPreheader(&#42;FC1)) &#123;</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion candidate does not have empty &quot;</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;preheader.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// If it is not safe to hoist/sink all instructions in the</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// pre-header, we cannot fuse these loops.</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!collectMovablePreheaderInsts(&#42;FC0, &#42;FC1, SafeToHoist,</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">                                              SafeToSink)) &#123;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Could not hoist/sink all instructions in &quot;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">                                   </span><span class="doxyHighlightStringLiteral">&quot;Fusion Candidate Pre-header.\\n&quot;</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">                                &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Not Fusing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">              reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1,</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">                                                         NonEmptyPreheader);</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BeneficialToFuse = isBeneficialFusion(&#42;FC0, &#42;FC1);</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">                     &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tFusion appears to be &quot;</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">                     &lt;&lt; (BeneficialToFuse ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;un&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;profitable!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BeneficialToFuse) &#123;</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">            reportLoopFusion&lt;OptimizationRemarkMissed&gt;(&#42;FC0, &#42;FC1,</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">                                                       FusionNotBeneficial);</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// All analysis has completed and has determined that fusion is legal</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// and profitable. At this point, start transforming the code and</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// perform fusion.</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Execute the hoist/sink operations on preheader instructions</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">          movePreheaderInsts(&#42;FC0, &#42;FC1, SafeToHoist, SafeToSink);</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tFusion is performed: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;FC0 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; and &quot;</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">                            &lt;&lt; &#42;FC1 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">          FusionCandidate FC0Copy = &#42;FC0;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Peel the loop after determining that fusion is legal. The Loops</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// will still be safe to fuse after the peeling is performed.</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Peel = TCDifference &amp;&amp; &#42;TCDifference &gt; 0;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Peel)</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">            peelFusionCandidate(FC0Copy, &#42;FC1, &#42;TCDifference);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Report fusion to the Optimization Remarks.</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Note this needs to be done &#42;before&#42; performFusion because</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// performFusion will change the original loops, making it not</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// possible to identify them after fusion is complete.</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">          reportLoopFusion&lt;OptimizationRemark&gt;((Peel ? FC0Copy : &#42;FC0), &#42;FC1,</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">                                               FuseCounter);</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">          FusionCandidate FusedCand(</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">              performFusion((Peel ? FC0Copy : &#42;FC0), &#42;FC1), DT, &amp;PDT, ORE,</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">              FC0Copy.PP);</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">          FusedCand.verify();</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FusedCand.isEligibleForFusion(SE) &amp;&amp;</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;Fused candidate should be eligible for fusion!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Notify the loop-depth-tree that these loops are not valid objects</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">          LDT.removeLoop(FC1-&gt;L);</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">          CandidateSet.erase(FC0);</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">          CandidateSet.erase(FC1);</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertPos = CandidateSet.insert(FusedCand);</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPos.second &amp;&amp;</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;Unable to insert TargetCandidate in CandidateSet!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Reset FC0 and FC1 the new (fused) candidate. Subsequent iterations</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// of the FC1 loop will attempt to fuse the new (fused) loop with the</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// remaining candidates in the current candidate set.</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">          FC0 = FC1 = InsertPos.first;</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Candidate Set (after fusion): &quot;</span><span class="doxyHighlight"> &lt;&lt; CandidateSet</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">                            &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">          Fused = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Fused;</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns true if the instruction \\p I can be hoisted to the end of the</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preheader of \\p FC0. \\p SafeToHoist contains the instructions that are</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// known to be safe to hoist. The instructions encountered that cannot be</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hoisted are in \\p NotHoisting.</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Move functionality into CodeMoverUtils</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canHoistInst(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SmallVector&lt;Instruction &#42;, 4&gt; &amp;SafeToHoist,</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SmallVector&lt;Instruction &#42;, 4&gt; &amp;NotHoisting,</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FC0PreheaderTarget = FC0.Preheader-&gt;getSingleSuccessor();</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0PreheaderTarget &amp;&amp;</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expected single successor for loop preheader.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OpHoisted = <a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(SafeToHoist, OpInst);</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Check if we have already decided to hoist this operand. In this</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// case, it does not dominate FC0 &#42;yet&#42;, but will after we hoist it.</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(OpHoisted || DT.dominates(OpInst, FC0PreheaderTarget))) &#123;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PHIs in FC1&#39;s header only have FC0 blocks as predecessors. PHIs</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cannot be hoisted and should be sunk to the exit of the fused loop.</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this isn&#39;t a memory inst, hoisting is safe</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Checking if this mem inst can be hoisted.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;NotHoistedInst : NotHoisting) &#123;</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = DI.depends(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NotHoistedInst, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Dependency is not read-before-write, write-before-read or</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// write-before-write</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isFlow() || <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isAnti() || <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isOutput()) &#123;</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inst depends on an instruction in FC1&#39;s &quot;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;preheader that is not being hoisted.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;ReadInst : FC0.MemReads) &#123;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = DI.depends(ReadInst, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Dependency is not read-before-write</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isAnti()) &#123;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inst depends on a read instruction in FC0.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;WriteInst : FC0.MemWrites) &#123;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = DI.depends(WriteInst, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Dependency is not write-before-read or write-before-write</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isFlow() || <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isOutput()) &#123;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inst depends on a write instruction in FC0.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns true if the instruction \\p I can be sunk to the top of the exit</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block of \\p FC1.</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Move functionality into CodeMoverUtils</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canSinkInst(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users()) &#123;</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI&#123;<a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U)&#125;) &#123;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Cannot sink if user in loop</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If FC1 has phi users of this value, we cannot sink it into FC1.</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC1.L-&gt;contains(UI)) &#123;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Cannot hoist or sink this instruction. No hoisting/sinking</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// should take place, loops should not fuse</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this isn&#39;t a memory inst, sinking is safe</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;ReadInst : FC1.MemReads) &#123;</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = DI.depends(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ReadInst, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Dependency is not write-before-read</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isFlow()) &#123;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inst depends on a read instruction in FC1.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;WriteInst : FC1.MemWrites) &#123;</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = DI.depends(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, WriteInst, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Dependency is not write-before-write or read-before-write</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isOutput() || <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;isAnti()) &#123;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inst depends on a write instruction in FC1.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlightComment">  /// Collect instructions in the \\p FC1 Preheader that can be hoisted</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlightComment">  /// to the \\p FC0 Preheader or sunk into the \\p FC1 Body</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> collectMovablePreheaderInsts(</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1,</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">      SmallVector&lt;Instruction &#42;, 4&gt; &amp;SafeToHoist,</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">      SmallVector&lt;Instruction &#42;, 4&gt; &amp;SafeToSink)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FC1Preheader = FC1.Preheader;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the instructions that are not being hoisted, so we know not to hoist</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// mem insts that they dominate.</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">    SmallVector&lt;Instruction &#42;, 4&gt; NotHoisting;</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;FC1Preheader) &#123;</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Can&#39;t move a branch</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == FC1Preheader-&gt;getTerminator())</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the instruction has side-effects, give up.</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: The case of mayReadFromMemory we can handle but requires</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// additional work with a dependence analysis so for now we give</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// up on memory reads.</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayThrow() || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.willReturn()) &#123;</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inst: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; may throw or won&#39;t return.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Checking Inst: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isAtomic() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isVolatile()) &#123;</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tInstruction is volatile or atomic. Cannot move it.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (canHoistInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SafeToHoist, NotHoisting, FC0)) &#123;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">        SafeToHoist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tSafe to hoist.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tCould not hoist. Trying to sink...\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">        NotHoisting.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (canSinkInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, FC1)) &#123;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">          SafeToSink.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tSafe to sink.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tCould not sink.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;All preheader instructions could be sunk or hoisted!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlightComment">  /// Rewrite all additive recurrences in a SCEV to use a new loop.</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">AddRecLoopReplacer : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> SCEVRewriteVisitor&lt;AddRecLoopReplacer&gt; &#123;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">    AddRecLoopReplacer(ScalarEvolution &amp;<a href="/docs/api/classes/llvm/scevrewritevisitor/#a1f75cac3a0eec736a85d996723c70e64">SE</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Loop &amp;OldL, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Loop &amp;NewL,</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">                       </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseMax = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">        : <a href="/docs/api/classes/llvm/scevrewritevisitor/#a402d133bc2a8069432f15be4dd517589">SCEVRewriteVisitor</a>(<a href="/docs/api/classes/llvm/scevrewritevisitor/#a1f75cac3a0eec736a85d996723c70e64">SE</a>), Valid(<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>), UseMax(UseMax), OldL(OldL),</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">          NewL(NewL) &#123;&#125;</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;visitAddRecExpr(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEVAddRecExpr &#42;Expr) &#123;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Loop &#42;ExprL = Expr-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>();</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;const SCEV &#42;, 2&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExprL == &amp;OldL) &#123;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, Expr-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ae77d0f7b81cbde08d5fd75fcf2fcf36b">operands</a>());</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevrewritevisitor/#a1f75cac3a0eec736a85d996723c70e64">SE</a>.getAddRecExpr(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, &amp;NewL, Expr-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#a7275347a4dce174f4fecd548fd3255dc">getNoWrapFlags</a>());</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldL.contains(ExprL)) &#123;</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Pos = <a href="/docs/api/classes/llvm/scevrewritevisitor/#a1f75cac3a0eec736a85d996723c70e64">SE</a>.isKnownPositive(Expr-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a4049f7040a4628b15f182c3c9aaf802a">getStepRecurrence</a>(<a href="/docs/api/classes/llvm/scevrewritevisitor/#a1f75cac3a0eec736a85d996723c70e64">SE</a>));</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UseMax || !Pos || !Expr-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a54bb7394d874cbbef1d81e6bea89d4f3">isAffine</a>()) &#123;</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">          Valid = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Expr;</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevrewritevisitor/#a242a71a1c3d798925fbaa9faba8bb5a8">visit</a>(Expr-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a19c13fe96d59c787e900b7bbf7173263">getStart</a>());</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : Expr-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ae77d0f7b81cbde08d5fd75fcf2fcf36b">operands</a>())</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push&#95;back(<a href="/docs/api/classes/llvm/scevrewritevisitor/#a242a71a1c3d798925fbaa9faba8bb5a8">visit</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>));</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevrewritevisitor/#a1f75cac3a0eec736a85d996723c70e64">SE</a>.getAddRecExpr(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, ExprL, Expr-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#a7275347a4dce174f4fecd548fd3255dc">getNoWrapFlags</a>());</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> wasValidSCEV()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Valid; &#125;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Valid, UseMax;</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Loop &amp;OldL, &amp;NewL;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlightComment">  /// Return false if the access functions of \\p I0 and \\p I1 could cause</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlightComment">  /// a negative dependence.</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> accessDiffIsPositive(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Loop &amp;L0, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Loop &amp;L1, Instruction &amp;I0,</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">                            Instruction &amp;I1, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EqualIsInvalid) &#123;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ptr0 = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;I0);</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ptr1 = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;I1);</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ptr0 || !Ptr1)</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;SCEVPtr0 = SE.getSCEVAtScope(Ptr0, &amp;L0);</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;SCEVPtr1 = SE.getSCEVAtScope(Ptr1, &amp;L1);</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>)</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Access function check: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SCEVPtr0 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; vs &quot;</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">                        &lt;&lt; &#42;SCEVPtr1 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">    AddRecLoopReplacer <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>(SE, L0, L1);</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">    SCEVPtr0 = <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.visit(SCEVPtr0);</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>)</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Access function after rewrite: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SCEVPtr0</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#91;Valid: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.wasValidSCEV() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.wasValidSCEV())</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: isKnownPredicate doesnt work well when one SCEV is loop carried (by</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//       L0) and the other is not. We could check if it is monotone and test</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//       the beginning and end value instead.</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;L0Header = L0.<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HasNonLinearDominanceRelation = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;S) &#123;</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEVAddRecExpr &#42;AddRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(S);</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddRec)</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !DT.dominates(L0Header, AddRec-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>()-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">             !DT.dominates(AddRec-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>()-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>(), L0Header);</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#affb88623037a9864e030154052747ba1">SCEVExprContains</a>(SCEVPtr1, HasNonLinearDominanceRelation))</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">    ICmpInst::Predicate Pred =</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">        EqualIsInvalid ? ICmpInst::ICMP&#95;SGT : ICmpInst::ICMP&#95;SGE;</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsAlwaysGE = SE.isKnownPredicate(Pred, SCEVPtr0, SCEVPtr1);</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>)</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Relation: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SCEVPtr0</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">                        &lt;&lt; (IsAlwaysGE ? </span><span class="doxyHighlightStringLiteral">&quot;  &gt;=  &quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;  may &lt;  &quot;</span><span class="doxyHighlight">) &lt;&lt; &#42;SCEVPtr1</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsAlwaysGE;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlightComment">  /// Return true if the dependences between @p I0 (in @p L0) and @p I1 (in</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlightComment">  /// @p L1) allow loop fusion of @p L0 and @p L1. The dependence analyses</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlightComment">  /// specified by @p DepChoice are used to determine this.</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> dependencesAllowFusion(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1, Instruction &amp;I0,</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">                              Instruction &amp;I1, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyDep,</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">                              <a href="#ab2ce98edbf00ac5582eba4ec2630b50b">FusionDependenceAnalysisChoice</a> DepChoice) &#123;</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>) &#123;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Check dep: &quot;</span><span class="doxyHighlight"> &lt;&lt; I0 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; vs &quot;</span><span class="doxyHighlight"> &lt;&lt; I1 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; : &quot;</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">                        &lt;&lt; DepChoice &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (DepChoice) &#123;</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="#ab2ce98edbf00ac5582eba4ec2630b50bae2968bc1b6d284f07e96fac3ce78bc54">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;SCEV</a>:</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> accessDiffIsPositive(&#42;FC0.L, &#42;FC1.L, I0, I1, AnyDep);</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="#ab2ce98edbf00ac5582eba4ec2630b50ba88a2ef6139ee028e3fa8addb323b3917">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;DA</a>: &#123;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DepResult = DI.depends(&amp;I0, &amp;I1, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DepResult)</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>) &#123;</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;DA res: &quot;</span><span class="doxyHighlight">; DepResult-&gt;dump(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">                   <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#91;#l: &quot;</span><span class="doxyHighlight"> &lt;&lt; DepResult-&gt;getLevels() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;&#91;Ordered: &quot;</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">                          &lt;&lt; (DepResult-&gt;isOrdered() ? </span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;DepResult Levels: &quot;</span><span class="doxyHighlight"> &lt;&lt; DepResult-&gt;getLevels()</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DepResult-&gt;getNextPredecessor() || DepResult-&gt;getNextSuccessor())</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;TODO: Implement pred/succ dependence handling!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Can we actually use the dependence info analysis here?</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="#ab2ce98edbf00ac5582eba4ec2630b50ba9f38e26f008e10a2cd493e477865cf72">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;ALL</a>:</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> dependencesAllowFusion(FC0, FC1, I0, I1, AnyDep,</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">                                    <a href="#ab2ce98edbf00ac5582eba4ec2630b50bae2968bc1b6d284f07e96fac3ce78bc54">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;SCEV</a>) ||</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">             dependencesAllowFusion(FC0, FC1, I0, I1, AnyDep,</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">                                    <a href="#ab2ce98edbf00ac5582eba4ec2630b50ba88a2ef6139ee028e3fa8addb323b3917">FUSION&#95;DEPENDENCE&#95;ANALYSIS&#95;DA</a>);</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unknown fusion dependence analysis choice!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlightComment">  /// Perform a dependence check and return if @p FC0 and @p FC1 can be fused.</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> dependencesAllowFusion(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1) &#123;</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Check if &quot;</span><span class="doxyHighlight"> &lt;&lt; FC0 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; can be fused with &quot;</span><span class="doxyHighlight"> &lt;&lt; FC1</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0.L-&gt;getLoopDepth() == FC1.L-&gt;getLoopDepth());</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.dominates(FC0.getEntryBlock(), FC1.getEntryBlock()));</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;WriteL0 : FC0.MemWrites) &#123;</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;WriteL1 : FC1.MemWrites)</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!dependencesAllowFusion(FC0, FC1, &#42;WriteL0, &#42;WriteL1,</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">                                    </span><span class="doxyHighlightComment">/&#42; AnyDep &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">                                    <a href="#a3940a750c02a84ee62d42113f72210a9">FusionDependenceAnalysis</a>)) &#123;</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">          InvalidDependencies++;</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;ReadL1 : FC1.MemReads)</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!dependencesAllowFusion(FC0, FC1, &#42;WriteL0, &#42;ReadL1,</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">                                    </span><span class="doxyHighlightComment">/&#42; AnyDep &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">                                    <a href="#a3940a750c02a84ee62d42113f72210a9">FusionDependenceAnalysis</a>)) &#123;</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">          InvalidDependencies++;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;WriteL1 : FC1.MemWrites) &#123;</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;WriteL0 : FC0.MemWrites)</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!dependencesAllowFusion(FC0, FC1, &#42;WriteL0, &#42;WriteL1,</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">                                    </span><span class="doxyHighlightComment">/&#42; AnyDep &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">                                    <a href="#a3940a750c02a84ee62d42113f72210a9">FusionDependenceAnalysis</a>)) &#123;</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">          InvalidDependencies++;</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;ReadL0 : FC0.MemReads)</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!dependencesAllowFusion(FC0, FC1, &#42;ReadL0, &#42;WriteL1,</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">                                    </span><span class="doxyHighlightComment">/&#42; AnyDep &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">                                    <a href="#a3940a750c02a84ee62d42113f72210a9">FusionDependenceAnalysis</a>)) &#123;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">          InvalidDependencies++;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Walk through all uses in FC1. For each use, find the reaching def. If the</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// def is located in FC0 then it is not safe to fuse.</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;BB : FC1.L-&gt;blocks())</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands())</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;Def = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.L-&gt;contains(<a href="/docs/api/namespaces/llvm/rdf/#a10793004faece2bb74d3363b5f6ce96f">Def</a>-&gt;getParent())) &#123;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">              InvalidDependencies++;</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlightComment">  /// Determine if two fusion candidates are adjacent in the CFG.</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlightComment">  /// This method will determine if there are additional basic blocks in the CFG</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlightComment">  /// between the exit of \\p FC0 and the entry of \\p FC1.</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlightComment">  /// If the two candidates are guarded loops, then it checks whether the</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlightComment">  /// non-loop successor of the \\p FC0 guard branch is the entry block of \\p</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlightComment">  /// FC1. If not, then the loops are not adjacent. If the two candidates are</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlightComment">  /// not guarded loops, then it checks whether the exit block of \\p FC0 is the</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlightComment">  /// preheader of \\p FC1.</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isAdjacent(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the successor of the guard branch is FC1, then the loops are adjacent</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.GuardBranch)</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FC0.getNonLoopBlock() == FC1.getEntryBlock();</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FC0.ExitBlock == FC1.getEntryBlock();</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isEmptyPreheader(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/r600-instflag/#a23106439cc906be24dc8953eedd3940da8949a42ff4563a29d1e70e18338fd522">FC</a>.Preheader-&gt;size() == 1;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlightComment">  /// Hoist \\p FC1 Preheader instructions to \\p FC0 Preheader</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlightComment">  /// and sink others into the body of \\p FC1.</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> movePreheaderInsts(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1,</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">                          SmallVector&lt;Instruction &#42;, 4&gt; &amp;HoistInsts,</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">                          SmallVector&lt;Instruction &#42;, 4&gt; &amp;SinkInsts)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All preheader instructions except the branch must be hoisted or sunk</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HoistInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() + SinkInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == FC1.Preheader-&gt;size() - 1 &amp;&amp;</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Attempting to sink and hoist preheader instructions, but not all &quot;</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;the preheader instructions are accounted for.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">    NumHoistedInsts += HoistInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">    NumSunkInsts += SinkInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab393082393415266716b656010c0852a">VerboseFusionDebugging</a>) &#123;</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HoistInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Hoisting: \\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : HoistInsts)</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SinkInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sinking: \\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SinkInsts)</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : HoistInsts) &#123;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == FC1.Preheader);</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(&#42;FC0.Preheader,</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">                    FC0.Preheader-&gt;getTerminator()-&gt;getIterator());</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// insert instructions in reverse order to maintain dominance relationship</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(SinkInsts)) &#123;</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == FC1.Preheader);</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(&#42;FC1.ExitBlock, FC1.ExitBlock-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlightComment">  /// Determine if two fusion candidates have identical guards</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlightComment">  /// This method will determine if two fusion candidates have the same guards.</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlightComment">  /// The guards are considered the same if:</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlightComment">  ///   1 The instructions to compute the condition used in the compare are</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlightComment">  ///      identical.</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlightComment">  ///   2 The successors of the guard have the same flow into/around the loop.</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlightComment">  /// If the compare instructions are identical, then the first successor of the</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlightComment">  /// guard must go to the same place (either the preheader of the loop or the</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlightComment">  /// NonLoopBlock). In other words, the first successor of both loops must</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlightComment">  /// both go into the loop (i.e., the preheader) or go around the loop (i.e.,</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlightComment">  /// the NonLoopBlock). The same must be true for the second successor.</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> haveIdenticalGuards(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0.GuardBranch &amp;&amp; FC1.GuardBranch &amp;&amp;</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expecting FC0 and FC1 to be guarded loops.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FC0CmpInst =</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(FC0.GuardBranch-&gt;getCondition()))</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FC1CmpInst =</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(FC1.GuardBranch-&gt;getCondition()))</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FC0CmpInst-&gt;isIdenticalTo(FC1CmpInst))</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The compare instructions are identical.</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now make sure the successor of the guards have the same flow into/around</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the loop</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.GuardBranch-&gt;getSuccessor(0) == FC0.Preheader)</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (FC1.GuardBranch-&gt;getSuccessor(0) == FC1.Preheader);</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (FC1.GuardBranch-&gt;getSuccessor(1) == FC1.Preheader);</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlightComment">  /// Modify the latch branch of FC to be unconditional since successors of the</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlightComment">  /// branch are the same.</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> simplifyLatchBranch(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">    BranchInst &#42;FCLatchBranch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/r600-instflag/#a23106439cc906be24dc8953eedd3940da8949a42ff4563a29d1e70e18338fd522">FC</a>.Latch-&gt;getTerminator());</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FCLatchBranch) &#123;</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FCLatchBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp;</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">             FCLatchBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == FCLatchBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) &amp;&amp;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expecting the two successors of FCLatchBranch to be the same&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">      BranchInst &#42;NewBranch =</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(FCLatchBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0));</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(FCLatchBranch, NewBranch);</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlightComment">  /// Move instructions from FC0.Latch to FC1.Latch. If FC0.Latch has an unique</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlightComment">  /// successor, then merge FC0.Latch with its unique successor.</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> mergeLatch(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1) &#123;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9cfb65e6e11fa2b005afc1680a7756df">moveInstructionsToTheBeginning</a>(&#42;FC0.Latch, &#42;FC1.Latch, DT, PDT, DI);</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BasicBlock &#42;Succ = FC0.Latch-&gt;getUniqueSuccessor()) &#123;</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(Succ, &amp;DTU, &amp;LI);</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">      DTU.flush();</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlightComment">  /// Fuse two fusion candidates, creating a new fused loop.</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlightComment">  /// This method contains the mechanics of fusing two loops, represented by \\p</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlightComment">  /// FC0 and \\p FC1. It is assumed that \\p FC0 dominates \\p FC1 and \\p FC1</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlightComment">  /// postdominates \\p FC0 (making them control flow equivalent). It also</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlightComment">  /// assumes that the other conditions for fusion have been met: adjacent,</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlightComment">  /// identical trip counts, and no negative distance dependencies exist that</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlightComment">  /// would prevent fusion. Thus, there is no checking for these conditions in</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlightComment">  /// this method.</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlightComment">  /// Fusion is performed by rewiring the CFG to update successor blocks of the</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlightComment">  /// components of tho loop. Specifically, the following changes are done:</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlightComment">  ///   1 The preheader of \\p FC1 is removed as it is no longer necessary</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlightComment">  ///   (because it is currently only a single statement block).</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlightComment">  ///   2 The latch of \\p FC0 is modified to jump to the header of \\p FC1.</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlightComment">  ///   3 The latch of \\p FC1 i modified to jump to the header of \\p FC0.</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlightComment">  ///   4 All blocks from \\p FC1 are removed from FC1 and added to FC0.</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlightComment">  /// All of these modifications are done with dominator tree updates, thus</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlightComment">  /// keeping the dominator (and post dominator) information up-to-date.</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlightComment">  /// This can be improved in the future by actually merging blocks during</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlightComment">  /// fusion. For example, the preheader of \\p FC1 can be merged with the</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlightComment">  /// preheader of \\p FC0. This would allow loops with more than a single</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlightComment">  /// statement in the preheader to be fused. Similarly, the latch blocks of the</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlightComment">  /// two loops could also be fused into a single block. This will require</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlightComment">  /// analysis to prove it is safe to move the contents of the block past</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlightComment">  /// existing code, which currently has not been implemented.</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">  Loop &#42;performFusion(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1) &#123;</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0.isValid() &amp;&amp; FC1.isValid() &amp;&amp;</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expecting valid fusion candidates&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion Candidate 0: \\n&quot;</span><span class="doxyHighlight">; FC0.dump();</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion Candidate 1: \\n&quot;</span><span class="doxyHighlight">; FC1.dump(););</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move instructions from the preheader of FC1 to the end of the preheader</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of FC0.</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a4972d73b274f1c9bb08ff314cba26522">moveInstructionsToTheEnd</a>(&#42;FC1.Preheader, &#42;FC0.Preheader, DT, PDT, DI);</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fusing guarded loops is handled slightly differently than non-guarded</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loops and has been broken out into a separate method instead of trying to</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// intersperse the logic within a single method.</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.GuardBranch)</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> fuseGuardedLoops(FC0, FC1);</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC1.Preheader ==</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">           (FC0.Peeled ? FC0.ExitBlock-&gt;getUniqueSuccessor() : FC0.ExitBlock));</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC1.Preheader-&gt;size() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">           FC1.Preheader-&gt;getSingleSuccessor() == FC1.Header);</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remember the phi nodes originally in the header of FC0 in order to rewire</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// them later. However, this is only necessary if the new loop carried</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// values might not dominate the exiting branch. While we do not generally</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// test if this is the case but simply insert intermediate phi nodes, we</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// need to make sure these intermediate phi nodes have different</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessors. To this end, we filter the special case where the exiting</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block is the latch block of the first loop. Nothing needs to be done</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// anyway as all loop carried values dominate the latch and thereby also the</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exiting branch.</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">    SmallVector&lt;PHINode &#42;, 8&gt; OriginalFC0PHIs;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.ExitingBlock != FC0.Latch)</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : FC0.Header-&gt;phis())</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">        OriginalFC0PHIs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace incoming blocks for header PHIs first.</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">    FC1.Preheader-&gt;replaceSuccessorsPhiUsesWith(FC0.Preheader);</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">    FC0.Latch-&gt;replaceSuccessorsPhiUsesWith(FC1.Latch);</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Then modify the control flow and update DT and PDT.</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;DominatorTree::UpdateType, 8&gt;</a> TreeUpdates;</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The old exiting block of the first loop (FC0) has to jump to the header</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the second as we need to execute the code in the second header block</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// regardless of the trip count. That is, if the trip count is 0, so the</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// back edge is never taken, we still have to execute both loop headers,</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// especially (but not only!) if the second is a do-while style loop.</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// However, doing so might invalidate the phi nodes of the first loop as</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the new values do only need to dominate their latch and not the exiting</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predicate. To remedy this potential problem we always introduce phi</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// nodes in the header of the second loop later that select the loop carried</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value, if the second header was reached through an old latch of the</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// first, or undef otherwise. This is sound as exiting the first implies the</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// second will exit too, &#95;&#95;without&#95;&#95; taking the back-edge. &#91;Their</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trip-counts are equal after all.</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// KB: Would this sequence be simpler to just make FC0.ExitingBlock go</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to FC1.Header? I think this is basically what the three sequences are</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trying to accomplish; however, doing this directly in the CFG may mean</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the DT/PDT becomes invalid</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FC0.Peeled) &#123;</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">      FC0.ExitingBlock-&gt;getTerminator()-&gt;replaceUsesOfWith(FC1.Preheader,</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">                                                           FC1.Header);</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">          DominatorTree::Delete, FC0.ExitingBlock, FC1.Preheader));</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">          DominatorTree::Insert, FC0.ExitingBlock, FC1.Header));</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">          DominatorTree::Delete, FC0.ExitBlock, FC1.Preheader));</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove the ExitBlock of the first Loop (also not needed)</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">      FC0.ExitingBlock-&gt;getTerminator()-&gt;replaceUsesOfWith(FC0.ExitBlock,</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">                                                           FC1.Header);</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">          DominatorTree::Delete, FC0.ExitingBlock, FC0.ExitBlock));</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">      FC0.ExitBlock-&gt;getTerminator()-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">          DominatorTree::Insert, FC0.ExitingBlock, FC1.Header));</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(FC0.ExitBlock-&gt;getContext(), FC0.ExitBlock);</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The pre-header of L1 is not necessary anymore.</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(FC1.Preheader));</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">    FC1.Preheader-&gt;getTerminator()-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(FC1.Preheader-&gt;getContext(), FC1.Preheader);</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">        DominatorTree::Delete, FC1.Preheader, FC1.Header));</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Moves the phi nodes from the second to the first loops header block.</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;FC1.Header-&gt;front())) &#123;</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE.isSCEVable(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getType()))</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">        SE.forgetValue(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;hasNUsesOrMore(1))</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;moveBefore(FC0.Header-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Introduce new phi nodes in the second loop header to ensure</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exiting the first and jumping to the header of the second does not break</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the SSA property of the phis originally in the first loop. See also the</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// comment above.</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> L1HeaderIP = FC1.Header-&gt;begin();</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &#42;LCPHI : OriginalFC0PHIs) &#123;</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> L1LatchBBIdx = LCPHI-&gt;getBasicBlockIndex(FC1.Latch);</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L1LatchBBIdx &gt;= 0 &amp;&amp;</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected loop carried value to be rewired at this point!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LCV = LCPHI-&gt;getIncomingValue(L1LatchBBIdx);</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">      PHINode &#42;L1HeaderPHI =</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(LCV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 2, LCPHI-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.afterFC0&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">      L1HeaderPHI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(L1HeaderIP);</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">      L1HeaderPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LCV, FC0.Latch);</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">      L1HeaderPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(LCV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()),</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">                               FC0.ExitingBlock);</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">      LCPHI-&gt;setIncomingValue(L1LatchBBIdx, L1HeaderPHI);</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace latch terminator destinations.</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">    FC0.Latch-&gt;getTerminator()-&gt;replaceUsesOfWith(FC0.Header, FC1.Header);</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">    FC1.Latch-&gt;getTerminator()-&gt;replaceUsesOfWith(FC1.Header, FC0.Header);</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Modify the latch branch of FC0 to be unconditional as both successors of</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the branch are the same.</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">    simplifyLatchBranch(FC0);</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If FC0.Latch and FC0.ExitingBlock are the same then we have already</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// performed the updates above.</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.Latch != FC0.ExitingBlock)</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">          DominatorTree::Insert, FC0.Latch, FC1.Header));</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(DominatorTree::Delete,</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">                                                       FC0.Latch, FC0.Header));</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(DominatorTree::Insert,</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">                                                       FC1.Latch, FC0.Header));</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(DominatorTree::Delete,</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">                                                       FC1.Latch, FC1.Header));</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update DT/PDT</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">    DTU.applyUpdates(TreeUpdates);</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">    LI.removeBlock(FC1.Preheader);</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">    DTU.deleteBB(FC1.Preheader);</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.Peeled) &#123;</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">      LI.removeBlock(FC0.ExitBlock);</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">      DTU.deleteBB(FC0.ExitBlock);</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    DTU.flush();</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Is there a way to keep SE up-to-date so we don&#39;t need to forget the loops</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and rebuild the information in subsequent passes of fusion?</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: Need to forget the loops before merging the loop latches, as</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// mergeLatch may remove the only block in FC1.</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">    SE.forgetLoop(FC1.L);</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">    SE.forgetLoop(FC0.L);</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Forget block dispositions as well, so that there are no dangling</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointers to erased/free&#39;ed blocks.</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">    SE.forgetBlockAndLoopDispositions();</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move instructions from FC0.Latch to FC1.Latch.</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: mergeLatch requires an updated DT.</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">    mergeLatch(FC0, FC1);</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Merge the loops.</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">    SmallVector&lt;BasicBlock &#42;, 8&gt; Blocks(FC1.L-&gt;blocks());</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;BB : Blocks) &#123;</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">      FC0.L-&gt;addBlockEntry(BB);</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">      FC1.L-&gt;removeBlockFromLoop(BB);</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI.getLoopFor(BB) != FC1.L)</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">      LI.changeLoopFor(BB, FC0.L);</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!FC1.L-&gt;isInnermost()) &#123;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ChildLoopIt = FC1.L-&gt;begin();</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">      Loop &#42;ChildLoop = &#42;ChildLoopIt;</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">      FC1.L-&gt;removeChildLoop(ChildLoopIt);</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">      FC0.L-&gt;addChildLoop(ChildLoop);</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Delete the now empty loop L1.</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">    LI.erase(FC1.L);</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;FC0.Header-&gt;getParent(), &amp;<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>()));</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.verify(DominatorTree::VerificationLevel::Fast));</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PDT.verify());</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">    LI.verify(DT);</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">    SE.verify();</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion done:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FC0.L;</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlightComment">  /// Report details on loop fusion opportunities.</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlightComment">  /// This template function can be used to report both successful and missed</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlightComment">  /// loop fusion opportunities, based on the RemarkKind. The RemarkKind should</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlightComment">  /// be one of:</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlightComment">  ///   - OptimizationRemarkMissed to report when loop fusion is unsuccessful</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlightComment">  ///     given two valid fusion candidates.</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlightComment">  ///   - OptimizationRemark to report successful fusion of two fusion</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlightComment">  ///     candidates.</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlightComment">  /// The remarks will be printed using the form:</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlightComment">  ///    &lt;path/filename&gt;:&lt;line number&gt;:&lt;column number&gt;: &#91;&lt;function name&gt;&#93;:</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlightComment">  ///       &lt;Cand1 Preheader&gt; and &lt;Cand2 Preheader&gt;: &lt;Stat Description&gt;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> RemarkKind&gt;</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> reportLoopFusion(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1,</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/#a6412c3ea6550f1aeab7571b6d38a2bf3">llvm::Statistic</a> &amp;Stat) &#123;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0.Preheader &amp;&amp; FC1.Preheader &amp;&amp;</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expecting valid fusion candidates&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight">ore;</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlightPreprocessor">#if LLVM&#95;ENABLE&#95;STATS</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">    ++Stat;</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">    ORE.emit(RemarkKind(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, Stat.getName(), FC0.L-&gt;getStartLoc(),</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">                        FC0.Preheader)</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; FC0.Preheader-&gt;getParent()-&gt;getName()</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Cand1&quot;</span><span class="doxyHighlight">, StringRef(FC0.Preheader-&gt;getName()))</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; and &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Cand2&quot;</span><span class="doxyHighlight">, StringRef(FC1.Preheader-&gt;getName()))</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: &quot;</span><span class="doxyHighlight"> &lt;&lt; Stat.getDesc());</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlightComment">  /// Fuse two guarded fusion candidates, creating a new fused loop.</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlightComment">  /// Fusing guarded loops is handled much the same way as fusing non-guarded</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlightComment">  /// loops. The rewiring of the CFG is slightly different though, because of</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlightComment">  /// the presence of the guards around the loops and the exit blocks after the</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlightComment">  /// loop body. As such, the new loop is rewired as follows:</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlightComment">  ///    1 Keep the guard branch from FC0 and use the non-loop block target</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlightComment">  /// from the FC1 guard branch.</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlightComment">  ///    2 Remove the exit block from FC0 (this exit block should be empty</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlightComment">  /// right now).</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlightComment">  ///    3 Remove the guard branch for FC1</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlightComment">  ///    4 Remove the preheader for FC1.</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlightComment">  /// The exit block successor for the latch of FC0 is updated to be the header</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlightComment">  /// of FC1 and the non-exit block successor of the latch of FC1 is updated to</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlightComment">  /// be the header of FC0, thus creating the fused loop.</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">  Loop &#42;fuseGuardedLoops(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC0,</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FusionCandidate &amp;FC1) &#123;</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0.GuardBranch &amp;&amp; FC1.GuardBranch &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting guarded loops&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FC0GuardBlock = FC0.GuardBranch-&gt;getParent();</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FC1GuardBlock = FC1.GuardBranch-&gt;getParent();</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FC0NonLoopBlock = FC0.getNonLoopBlock();</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FC1NonLoopBlock = FC1.getNonLoopBlock();</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FC0ExitBlockSuccessor = FC0.ExitBlock-&gt;getUniqueSuccessor();</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move instructions from the exit block of FC0 to the beginning of the exit</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block of FC1, in the case that the FC0 loop has not been peeled. In the</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// case that FC0 loop is peeled, then move the instructions of the successor</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the FC0 Exit block to the beginning of the exit block of FC1.</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9cfb65e6e11fa2b005afc1680a7756df">moveInstructionsToTheBeginning</a>(</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">        (FC0.Peeled ? &#42;FC0ExitBlockSuccessor : &#42;FC0.ExitBlock), &#42;FC1.ExitBlock,</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">        DT, PDT, DI);</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move instructions from the guard block of FC1 to the end of the guard</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block of FC0.</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a4972d73b274f1c9bb08ff314cba26522">moveInstructionsToTheEnd</a>(&#42;FC1GuardBlock, &#42;FC0GuardBlock, DT, PDT, DI);</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FC0NonLoopBlock == FC1GuardBlock &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loops are not adjacent&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;DominatorTree::UpdateType, 8&gt;</a> TreeUpdates;</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlightComment">    ////////////////////////////////////////////////////////////////////////////</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update the Loop Guard</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlightComment">    ////////////////////////////////////////////////////////////////////////////</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The guard for FC0 is updated to guard both FC0 and FC1. This is done by</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// changing the NonLoopGuardBlock for FC0 to the NonLoopGuardBlock for FC1.</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Thus, one path from the guard goes to the preheader for FC0 (and thus</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// executes the new fused loop) and the other path goes to the NonLoopBlock</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for FC1 (where FC1 guard would have gone if FC1 was not executed).</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">    FC1NonLoopBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a7349a5d6bf71f3d3344b37104dc25bf4">replacePhiUsesWith</a>(FC1GuardBlock, FC0GuardBlock);</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">    FC0.GuardBranch-&gt;replaceUsesOfWith(FC0NonLoopBlock, FC1NonLoopBlock);</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BBToUpdate = FC0.Peeled ? FC0ExitBlockSuccessor : FC0.ExitBlock;</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">    BBToUpdate-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(FC1GuardBlock, FC1.Header);</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The guard of FC1 is not necessary anymore.</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">    FC1.GuardBranch-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(FC1GuardBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), FC1GuardBlock);</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">        DominatorTree::Delete, FC1GuardBlock, FC1.Preheader));</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">        DominatorTree::Delete, FC1GuardBlock, FC1NonLoopBlock));</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">        DominatorTree::Delete, FC0GuardBlock, FC1GuardBlock));</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">        DominatorTree::Insert, FC0GuardBlock, FC1NonLoopBlock));</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.Peeled) &#123;</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove the Block after the ExitBlock of FC0</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">          DominatorTree::Delete, FC0ExitBlockSuccessor, FC1GuardBlock));</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">      FC0ExitBlockSuccessor-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(FC0ExitBlockSuccessor-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(),</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">                          FC0ExitBlockSuccessor);</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(FC1GuardBlock) &amp;&amp;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expecting guard block to have no predecessors&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a126a78caf2176eb39d879c899bdd749c">succ&#95;empty</a>(FC1GuardBlock) &amp;&amp;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expecting guard block to have no successors&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remember the phi nodes originally in the header of FC0 in order to rewire</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// them later. However, this is only necessary if the new loop carried</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// values might not dominate the exiting branch. While we do not generally</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// test if this is the case but simply insert intermediate phi nodes, we</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// need to make sure these intermediate phi nodes have different</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessors. To this end, we filter the special case where the exiting</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block is the latch block of the first loop. Nothing needs to be done</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// anyway as all loop carried values dominate the latch and thereby also the</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exiting branch.</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// KB: This is no longer necessary because FC0.ExitingBlock == FC0.Latch</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (because the loops are rotated. Thus, nothing will ever be added to</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// OriginalFC0PHIs.</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">    SmallVector&lt;PHINode &#42;, 8&gt; OriginalFC0PHIs;</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.ExitingBlock != FC0.Latch)</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : FC0.Header-&gt;phis())</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">        OriginalFC0PHIs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OriginalFC0PHIs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting OriginalFC0PHIs to be empty!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace incoming blocks for header PHIs first.</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">    FC1.Preheader-&gt;replaceSuccessorsPhiUsesWith(FC0.Preheader);</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">    FC0.Latch-&gt;replaceSuccessorsPhiUsesWith(FC1.Latch);</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The old exiting block of the first loop (FC0) has to jump to the header</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the second as we need to execute the code in the second header block</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// regardless of the trip count. That is, if the trip count is 0, so the</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// back edge is never taken, we still have to execute both loop headers,</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// especially (but not only!) if the second is a do-while style loop.</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// However, doing so might invalidate the phi nodes of the first loop as</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the new values do only need to dominate their latch and not the exiting</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predicate. To remedy this potential problem we always introduce phi</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// nodes in the header of the second loop later that select the loop carried</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value, if the second header was reached through an old latch of the</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// first, or undef otherwise. This is sound as exiting the first implies the</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// second will exit too, &#95;&#95;without&#95;&#95; taking the back-edge (their</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trip-counts are equal after all).</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">    FC0.ExitingBlock-&gt;getTerminator()-&gt;replaceUsesOfWith(FC0.ExitBlock,</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">                                                         FC1.Header);</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">        DominatorTree::Delete, FC0.ExitingBlock, FC0.ExitBlock));</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">        DominatorTree::Insert, FC0.ExitingBlock, FC1.Header));</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove FC0 Exit Block</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The exit block for FC0 is no longer needed since control will flow</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// directly to the header of FC1. Since it is an empty block, it can be</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// removed at this point.</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: In the future, we can handle non-empty exit blocks my merging any</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions from FC0 exit block into FC1 exit block prior to removing</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the block.</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(FC0.ExitBlock) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting exit block to be empty&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">    FC0.ExitBlock-&gt;getTerminator()-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(FC0.ExitBlock-&gt;getContext(), FC0.ExitBlock);</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove FC1 Preheader</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The pre-header of L1 is not necessary anymore.</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(FC1.Preheader));</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">    FC1.Preheader-&gt;getTerminator()-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(FC1.Preheader-&gt;getContext(), FC1.Preheader);</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">        DominatorTree::Delete, FC1.Preheader, FC1.Header));</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Moves the phi nodes from the second to the first loops header block.</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;FC1.Header-&gt;front())) &#123;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE.isSCEVable(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getType()))</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">        SE.forgetValue(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;hasNUsesOrMore(1))</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;moveBefore(FC0.Header-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Introduce new phi nodes in the second loop header to ensure</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exiting the first and jumping to the header of the second does not break</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the SSA property of the phis originally in the first loop. See also the</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// comment above.</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> L1HeaderIP = FC1.Header-&gt;begin();</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &#42;LCPHI : OriginalFC0PHIs) &#123;</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> L1LatchBBIdx = LCPHI-&gt;getBasicBlockIndex(FC1.Latch);</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L1LatchBBIdx &gt;= 0 &amp;&amp;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected loop carried value to be rewired at this point!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LCV = LCPHI-&gt;getIncomingValue(L1LatchBBIdx);</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">      PHINode &#42;L1HeaderPHI =</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(LCV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 2, LCPHI-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.afterFC0&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">      L1HeaderPHI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(L1HeaderIP);</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">      L1HeaderPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LCV, FC0.Latch);</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">      L1HeaderPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(LCV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()),</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">                               FC0.ExitingBlock);</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">      LCPHI-&gt;setIncomingValue(L1LatchBBIdx, L1HeaderPHI);</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update the latches</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace latch terminator destinations.</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">    FC0.Latch-&gt;getTerminator()-&gt;replaceUsesOfWith(FC0.Header, FC1.Header);</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">    FC1.Latch-&gt;getTerminator()-&gt;replaceUsesOfWith(FC1.Header, FC0.Header);</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Modify the latch branch of FC0 to be unconditional as both successors of</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the branch are the same.</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">    simplifyLatchBranch(FC0);</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If FC0.Latch and FC0.ExitingBlock are the same then we have already</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// performed the updates above.</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.Latch != FC0.ExitingBlock)</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">      TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">          DominatorTree::Insert, FC0.Latch, FC1.Header));</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(DominatorTree::Delete,</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">                                                       FC0.Latch, FC0.Header));</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(DominatorTree::Insert,</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">                                                       FC1.Latch, FC0.Header));</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">    TreeUpdates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DominatorTree::UpdateType(DominatorTree::Delete,</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">                                                       FC1.Latch, FC1.Header));</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All done</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Apply the updates to the Dominator Tree and cleanup.</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a126a78caf2176eb39d879c899bdd749c">succ&#95;empty</a>(FC1GuardBlock) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;FC1GuardBlock has successors!!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(FC1GuardBlock) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;FC1GuardBlock has predecessors!!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update DT/PDT</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">    DTU.applyUpdates(TreeUpdates);</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">    LI.removeBlock(FC1GuardBlock);</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">    LI.removeBlock(FC1.Preheader);</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">    LI.removeBlock(FC0.ExitBlock);</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FC0.Peeled) &#123;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">      LI.removeBlock(FC0ExitBlockSuccessor);</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">      DTU.deleteBB(FC0ExitBlockSuccessor);</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">    DTU.deleteBB(FC1GuardBlock);</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">    DTU.deleteBB(FC1.Preheader);</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">    DTU.deleteBB(FC0.ExitBlock);</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">    DTU.flush();</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Is there a way to keep SE up-to-date so we don&#39;t need to forget the loops</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and rebuild the information in subsequent passes of fusion?</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: Need to forget the loops before merging the loop latches, as</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// mergeLatch may remove the only block in FC1.</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">    SE.forgetLoop(FC1.L);</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">    SE.forgetLoop(FC0.L);</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Forget block dispositions as well, so that there are no dangling</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointers to erased/free&#39;ed blocks.</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">    SE.forgetBlockAndLoopDispositions();</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move instructions from FC0.Latch to FC1.Latch.</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: mergeLatch requires an updated DT.</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">    mergeLatch(FC0, FC1);</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Merge the loops.</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">    SmallVector&lt;BasicBlock &#42;, 8&gt; Blocks(FC1.L-&gt;blocks());</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;BB : Blocks) &#123;</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">      FC0.L-&gt;addBlockEntry(BB);</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">      FC1.L-&gt;removeBlockFromLoop(BB);</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI.getLoopFor(BB) != FC1.L)</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">      LI.changeLoopFor(BB, FC0.L);</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!FC1.L-&gt;isInnermost()) &#123;</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ChildLoopIt = FC1.L-&gt;begin();</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">      Loop &#42;ChildLoop = &#42;ChildLoopIt;</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">      FC1.L-&gt;<a href="/docs/api/classes/llvm/loopbase/#afd824d78def66604189ab07c6266572d">removeChildLoop</a>(ChildLoopIt);</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">      FC0.L-&gt;<a href="/docs/api/classes/llvm/loopbase/#a990a86b0de7a84a9f489d2034878e330">addChildLoop</a>(ChildLoop);</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Delete the now empty loop L1.</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">    LI.erase(FC1.L);</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;FC0.Header-&gt;getParent(), &amp;<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>()));</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.verify(DominatorTree::VerificationLevel::Fast));</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PDT.verify());</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">    LI.verify(DT);</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">    SE.verify();</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fusion done:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FC0.L;</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069" lineLink="/docs/api/classes/llvm/loopfusepass/#a971f40ada3f1410759faede02bfbace7"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/loopfusepass/#a971f40ada3f1410759faede02bfbace7">LoopFusePass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LI = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DT = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DI = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dependenceanalysis">DependenceAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SE = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PDT = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/postdominatortreeanalysis">PostDominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ORE = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/optimizationremarkemitteranalysis">OptimizationRemarkEmitterAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;AC = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/assumptionanalysis">AssumptionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure loops are in simplifed form which is a pre-requisite for loop fusion</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pass. Added only for new PM since the legacy PM has already added</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LoopSimplify pass as a dependency.</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;L : LI) &#123;</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |=</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0083a69883e0f97e111dbff064c60f42">simplifyLoop</a>(L, &amp;DT, &amp;LI, &amp;SE, &amp;AC, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; PreserveLCSSA &#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">    PDT.recalculate(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">  LoopFuser LF(LI, DT, DI, SE, PDT, ORE, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AC, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= LF.fuseLoops(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;();</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/postdominatortreeanalysis">PostDominatorTreeAnalysis</a>&gt;();</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a>&gt;();</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;();</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
