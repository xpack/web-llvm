---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `LICM.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Scalar/LICM.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/licm-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PriorityWorklist.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/priorityworklist-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetOperations.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setoperations-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasSetTracker.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliassettracker-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CaptureTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/capturetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/DomTreeUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GuardUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/guardutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LazyBlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/lazyblockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/Loads.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopNestAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopnestanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/looppass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSA.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSAUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MustExecute.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/mustexecute-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolution.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PredIteratorCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/prediteratorcache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Scalar.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/scalar-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/AssumeBundleBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/assumebundlebuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SSAUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ssaupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-licm-cpp-">anonymous&#123;LICM.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion">LoopInvariantCodeMotion</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass">LegacyLICMPass</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister">ControlFlowHoister</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter">LoopPromoter</a></>}>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#ad8f672710e1f206d9f187070e3c6058e">PointersAndHasReadsOutsideSet</a> = std::pair&lt; <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, 8 &gt;, bool &gt;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a425e6fe374356efd05a49cab7e020166">canSplitPredecessors</a> (PHINode &#42;PN, LoopSafetyInfo &#42;SafetyInfo)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a25f0b41add9507b8eafadfbc4a090d6c">cloneInstructionInExitBlock</a> (Instruction &amp;I, BasicBlock &amp;ExitBlock, PHINode &amp;PN, const LoopInfo &#42;LI, const LoopSafetyInfo &#42;SafetyInfo, MemorySSAUpdater &amp;MSSAU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="#ad8f672710e1f206d9f187070e3c6058e">PointersAndHasReadsOutsideSet</a>, 0 &gt;</>}
  name={<><a href="#a37ddbdd8cb4efa5072282498fdc1ac65">collectPromotionCandidates</a> (MemorySSA &#42;MSSA, AliasAnalysis &#42;AA, Loop &#42;L)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a> (Instruction &amp;I, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8046d863469d9c33287fa4a673d00571">foreachMemoryAccess</a> (MemorySSA &#42;MSSA, Loop &#42;L, function&#95;ref&lt; void(Instruction &#42;)&gt; Fn)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;</>}
  name={<><a href="#a329ad21a549f7f43ad50b65f4d3ca487">getClobberingMemoryAccess</a> (MemorySSA &amp;MSSA, BatchAAResults &amp;BAA, SinkAndHoistLICMFlags &amp;Flags, MemoryUseOrDef &#42;MA)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a3a3a3183a327e1186dbe900032390ec6">hoist</a> (Instruction &amp;I, const DominatorTree &#42;DT, const Loop &#42;CurLoop, BasicBlock &#42;Dest, ICFLoopSafetyInfo &#42;SafetyInfo, MemorySSAUpdater &amp;MSSAU, ScalarEvolution &#42;SE, OptimizationRemarkEmitter &#42;ORE)</>}>
When an instruction is found to only use loop invariant operands that is safe to hoist, this instruction is called to do the dirty work. <a href="#a3a3a3183a327e1186dbe900032390ec6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a2f46552f3c07dc30e7acc64cdab53056">hoistAdd</a> (ICmpInst::Predicate Pred, Value &#42;VariantLHS, Value &#42;InvariantRHS, ICmpInst &amp;ICmp, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, AssumptionCache &#42;AC, DominatorTree &#42;DT)</>}>
Try to turn things like &quot;LV + C1 &lt; C2&quot; into &quot;LV &lt; C2 - C1&quot;. <a href="#a2f46552f3c07dc30e7acc64cdab53056">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a66f8120f59f3970d1c0a554a8f7c3e2e">hoistAddSub</a> (Instruction &amp;I, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, AssumptionCache &#42;AC, DominatorTree &#42;DT)</>}>
Reassociate and hoist add/sub expressions. <a href="#a66f8120f59f3970d1c0a554a8f7c3e2e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ac33f359fcea1152130e9e51c95256d0c">hoistArithmetics</a> (Instruction &amp;I, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, AssumptionCache &#42;AC, DominatorTree &#42;DT)</>}>
Aggregates various functions for hoisting computations out of loop. <a href="#ac33f359fcea1152130e9e51c95256d0c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aebac730a26c607cea825366afca2d8b1">hoistBOAssociation</a> (Instruction &amp;I, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, AssumptionCache &#42;AC, DominatorTree &#42;DT)</>}>
Reassociate associative binary expressions of the form. <a href="#aebac730a26c607cea825366afca2d8b1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a062c93def88f99e93047ba86970c4eab">hoistGEP</a> (Instruction &amp;I, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, AssumptionCache &#42;AC, DominatorTree &#42;DT)</>}>
Reassociate gep (gep ptr, idx1), idx2 to gep (gep ptr, idx2), idx1 if this allows hoisting the inner GEP. <a href="#a062c93def88f99e93047ba86970c4eab">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1f669cc640bda295e6c2e2b3c90babb9">hoistMinMax</a> (Instruction &amp;I, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU)</>}>
Try to simplify things like (A &lt; INV&#95;1 AND icmp A &lt; INV&#95;2) into (A &lt; min(INV&#95;1, INV&#95;2)), if INV&#95;1 and INV&#95;2 are both loop invariants and their minimun can be computed outside of loop, and X is not a loop-invariant. <a href="#a1f669cc640bda295e6c2e2b3c90babb9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a697cde840957bbc0b2848a593c3e0d5a">hoistMulAddAssociation</a> (Instruction &amp;I, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, AssumptionCache &#42;AC, DominatorTree &#42;DT)</>}>
Try to reassociate expressions like ((A1 &#42; B1) + (A2 &#42; B2) + ...) &#42; C where A1, A2, ... and C are loop invariants into expressions like ((A1 &#42; C &#42; B1) + (A2 &#42; C &#42; B2) + ...) and hoist the (A1 &#42; C), (A2 &#42; C), ... invariant expressions. <a href="#a697cde840957bbc0b2848a593c3e0d5a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aabf61131f4fe5c83b4f3dccf4adb5e96">hoistSub</a> (ICmpInst::Predicate Pred, Value &#42;VariantLHS, Value &#42;InvariantRHS, ICmpInst &amp;ICmp, Loop &amp;L, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, AssumptionCache &#42;AC, DominatorTree &#42;DT)</>}>
Try to reassociate and hoist the following two patterns: LV - C1 &lt; C2 --&gt; LV &lt; C1 + C2, C1 - LV &lt; C2 --&gt; LV &gt; C1 - C2. <a href="#aabf61131f4fe5c83b4f3dccf4adb5e96">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aea8a4c201b5630473d49bddbb5f5c221">INITIALIZE&#95;PASS&#95;BEGIN</a> (LegacyLICMPass, &quot;licm&quot;, &quot;Loop Invariant Code Motion&quot;, false, false) INITIALIZE&#95;PASS&#95;END(LegacyLICMPass</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aabae34d2dbed5dde1865f19ccbe4cb81">inSubLoop</a> (BasicBlock &#42;BB, Loop &#42;CurLoop, LoopInfo &#42;LI)</>}>
Little predicate that returns true if the specified basic block is in a subloop of the current one, not the current one itself. <a href="#aabae34d2dbed5dde1865f19ccbe4cb81">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1a0282efdd962c35bc840b90bafeb35b">isFoldableInLoop</a> (const Instruction &amp;I, const Loop &#42;CurLoop, const TargetTransformInfo &#42;TTI)</>}>
Return true if the instruction is foldable in the loop. <a href="#a1a0282efdd962c35bc840b90bafeb35b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a831a5dec04e512d616fccb6e1f474e79">isLoadInvariantInLoop</a> (LoadInst &#42;LI, DominatorTree &#42;DT, Loop &#42;CurLoop)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0581d6d5dc280ba2a39087a557050a6a">isNotUsedOrFoldableInLoop</a> (const Instruction &amp;I, const Loop &#42;CurLoop, const LoopSafetyInfo &#42;SafetyInfo, TargetTransformInfo &#42;TTI, bool &amp;FoldableInLoop, bool LoopNestMode)</>}>
Return true if the only users of this instruction are outside of the loop. <a href="#a0581d6d5dc280ba2a39087a557050a6a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0504a04476327cd645600bb33f7862e9">isReassociableOp</a> (Instruction &#42;I, unsigned IntOpcode, unsigned FPOpcode)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab63d5eb7a9919d4e5f2c8d614e9bda97">isSafeToExecuteUnconditionally</a> (Instruction &amp;Inst, const DominatorTree &#42;DT, const TargetLibraryInfo &#42;TLI, const Loop &#42;CurLoop, const LoopSafetyInfo &#42;SafetyInfo, OptimizationRemarkEmitter &#42;ORE, const Instruction &#42;CtxI, AssumptionCache &#42;AC, bool AllowSpeculation)</>}>
Only sink or hoist an instruction if it is not a trapping instruction, or if the instruction is known not to trap when moved to the preheader. <a href="#ab63d5eb7a9919d4e5f2c8d614e9bda97">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad0eaec807c54661058d9a1aed11195d9">isTriviallyReplaceablePHI</a> (const PHINode &amp;PN, const Instruction &amp;I)</>}>
Returns true if a <a href="/docs/api/classes/llvm/phinode">PHINode</a> is a trivially replaceable with an <a href="/docs/api/classes/llvm/instruction">Instruction</a>. <a href="#ad0eaec807c54661058d9a1aed11195d9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a22d7cc599c50e811dff1546c5ccb8794">moveInstructionBefore</a> (Instruction &amp;I, BasicBlock::iterator Dest, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU, ScalarEvolution &#42;SE)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aed7e046ac6f7dd5ff0edb6e7b7a30e2e">pointerInvalidatedByBlock</a> (BasicBlock &amp;BB, MemorySSA &amp;MSSA, MemoryUse &amp;MU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a28d9fc94843828b60459abd31b7e82c6">pointerInvalidatedByLoop</a> (MemorySSA &#42;MSSA, MemoryUse &#42;MU, Loop &#42;CurLoop, Instruction &amp;I, SinkAndHoistLICMFlags &amp;Flags, bool InvariantGroup)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a52b8b307321627e612e77041260ece84">sink</a> (Instruction &amp;I, LoopInfo &#42;LI, DominatorTree &#42;DT, const Loop &#42;CurLoop, ICFLoopSafetyInfo &#42;SafetyInfo, MemorySSAUpdater &amp;MSSAU, OptimizationRemarkEmitter &#42;ORE)</>}>
When an instruction is found to only be used outside of the loop, this function moves it to the exit blocks and patches up SSA form as needed. <a href="#a52b8b307321627e612e77041260ece84">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a9a7faaf4dae6e940d419a57c39cd5d98">sinkThroughTriviallyReplaceablePHI</a> (PHINode &#42;TPN, Instruction &#42;I, LoopInfo &#42;LI, SmallDenseMap&lt; BasicBlock &#42;, Instruction &#42;, 32 &gt; &amp;SunkCopies, const LoopSafetyInfo &#42;SafetyInfo, const Loop &#42;CurLoop, MemorySSAUpdater &amp;MSSAU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a0bb855d418108ea53140e71d7b35a2cd">splitPredecessorsOfLoopExit</a> (PHINode &#42;PN, DominatorTree &#42;DT, LoopInfo &#42;LI, const Loop &#42;CurLoop, LoopSafetyInfo &#42;SafetyInfo, MemorySSAUpdater &#42;MSSAU)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a45fc14ff56c52942c30f44602a634cd6">STATISTIC</a> (NumCreatedBlocks, &quot;Number of blocks created&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac71346eda47536b5dad25bf96ae9d967">STATISTIC</a> (NumClonedBranches, &quot;Number of branches cloned&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a8ab29be4bd7be711c51309b7600f39d5">STATISTIC</a> (NumSunk, &quot;Number of instructions sunk out of loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a71572cd280491dbe39de10f2c594d899">STATISTIC</a> (NumHoisted, &quot;Number of instructions hoisted out of loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a229336856c0c49796c9799050e1bd5af">STATISTIC</a> (NumMovedLoads, &quot;Number of load insts hoisted or sunk&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a02828d8acc81b8b904bf6b2c75c9035d">STATISTIC</a> (NumMovedCalls, &quot;Number of call insts hoisted or sunk&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4b4018ad6701dfeb3525234895d398fb">STATISTIC</a> (NumPromotionCandidates, &quot;Number of promotion candidates&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a86e14a51df2457965f2e9d4ae5ffaa21">STATISTIC</a> (NumLoadPromoted, &quot;Number of load-only promotions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a21b6d215c7e3e0a6731f0439a9489f3e">STATISTIC</a> (NumLoadStorePromoted, &quot;Number of load and store promotions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a32a173fad8474a7cc2d875a5ab798201">STATISTIC</a> (NumMinMaxHoisted, &quot;Number of min/max expressions hoisted out of the loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab0a5d3c1f04cc4283a55e43c961de82d">STATISTIC</a> (NumGEPsHoisted, &quot;Number of geps reassociated and hoisted out of the loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a176063aaa653dab209ff072e26c0f6b1">STATISTIC</a> (NumAddSubHoisted, &quot;Number of add/subtract expressions reassociated &quot; &quot;and hoisted out of the loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3ecfbc0e53ed739a59174190d712b86c">STATISTIC</a> (NumFPAssociationsHoisted, &quot;Number of invariant FP expressions &quot; &quot;reassociated and hoisted out of the loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a459334bbfc499f6b04cbb6dca86fedce">STATISTIC</a> (NumIntAssociationsHoisted, &quot;Number of invariant int expressions &quot; &quot;reassociated and hoisted out of the loop&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aded553a858cd162a5466c0a2c919f816">STATISTIC</a> (NumBOAssociationsHoisted, &quot;Number of invariant BinaryOp expressions &quot; &quot;reassociated and hoisted out of the loop&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a260c812c38e9c3fb8663ad8418f49990">ControlFlowHoisting</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ae779d27a69e1a53dab0c657f206e9527">DisablePromotion</a></>}>
<a href="/docs/api/classes/llvm/sys/memory">Memory</a> promotion is enabled by default. <a href="#ae779d27a69e1a53dab0c657f206e9527">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/loop">Loop</a> Invariant Code</>}
  name={<><a href="#a37badf0d674adf27a6c95db110df6f71">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a184889de0db5db92331f4b625b1d967e">FPAssociationUpperLimit</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a73f55e27d558de45459e584ff664f468">IntAssociationUpperLimit</a></>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a9daa918c2c6be9aa9ca401f69cc75302">licm</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; uint32&#95;t &gt;</>}
  name={<><a href="#a71198b8e987ea074eb3faa3d5adbd6c9">MaxNumUsesTraversed</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/loop">Loop</a> Invariant Code</>}
  name={<><a href="#a7db10a6ced2f9a67bd4f40d5ed05489d">Motion</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a06ee6708a8f92c5b0ba2220d8bb3aef9">SingleThread</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;licm&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### PointersAndHasReadsOutsideSet {#ad8f672710e1f206d9f187070e3c6058e}

<MemberDefinition
  prototype={<>using PointersAndHasReadsOutsideSet = 
    std::pair&lt;SmallSetVector&lt;Value &#42;, 8&gt;, bool&gt;</>}>

Definition at line <a href="#l00213">213</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### canSplitPredecessors() {#a425e6fe374356efd05a49cab7e020166}

<MemberDefinition
  prototype={<>static bool canSplitPredecessors (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42; SafetyInfo)</>}
  labels = {["static"]}>

Definition at line <a href="#l01544">1544</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### cloneInstructionInExitBlock() {#a25f0b41add9507b8eafadfbc4a090d6c}

<MemberDefinition
  prototype={<>static Instruction &#42; cloneInstructionInExitBlock (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; ExitBlock, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU)</>}
  labels = {["static"]}>

Definition at line <a href="#l01427">1427</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### collectPromotionCandidates() {#a37ddbdd8cb4efa5072282498fdc1ac65}

<MemberDefinition
  prototype={<>static SmallVector&lt; PointersAndHasReadsOutsideSet, 0 &gt; collectPromotionCandidates (<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42; MSSA, <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42; AA, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L)</>}
  labels = {["static"]}>

Definition at line <a href="#l02297">2297</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### eraseInstruction() {#ab0cfc793d55940eac67854827dd365e9}

<MemberDefinition
  prototype={<>static void eraseInstruction (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU)</>}
  labels = {["static"]}>

Definition at line <a href="#l01504">1504</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### foreachMemoryAccess() {#a8046d863469d9c33287fa4a673d00571}

<MemberDefinition
  prototype={<>static void foreachMemoryAccess (<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42; MSSA, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; void(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;)&gt; Fn)</>}
  labels = {["static"]}>

Definition at line <a href="#l02285">2285</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### getClobberingMemoryAccess() {#a329ad21a549f7f43ad50b65f4d3ca487}

<MemberDefinition
  prototype={<>static MemoryAccess &#42; getClobberingMemoryAccess (<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &amp; MSSA, <a href="/docs/api/classes/llvm/batchaaresults">BatchAAResults</a> &amp; BAA, <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp; Flags, <a href="/docs/api/classes/llvm/memoryuseordef">MemoryUseOrDef</a> &#42; MA)</>}
  labels = {["static"]}>

Definition at line <a href="#l01147">1147</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoist() {#a3a3a3183a327e1186dbe900032390ec6}

<MemberDefinition
  prototype={<>static void hoist (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Dest, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE)</>}
  labels = {["static"]}>
When an instruction is found to only use loop invariant operands that is safe to hoist, this instruction is called to do the dirty work.

Definition at line <a href="#l01742">1742</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistAdd() {#a2f46552f3c07dc30e7acc64cdab53056}

<MemberDefinition
  prototype={<>static bool hoistAdd (ICmpInst::Predicate Pred, <a href="/docs/api/classes/llvm/value">Value</a> &#42; VariantLHS, <a href="/docs/api/classes/llvm/value">Value</a> &#42; InvariantRHS, <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &amp; ICmp, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Try to turn things like &quot;LV + C1 &lt; C2&quot; into &quot;LV &lt; C2 - C1&quot;.

Here C1 and C2 are loop invariants and LV is a loop-variant.

Definition at line <a href="#l02550">2550</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistAddSub() {#a66f8120f59f3970d1c0a554a8f7c3e2e}

<MemberDefinition
  prototype={<>static bool hoistAddSub (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Reassociate and hoist add/sub expressions.

Definition at line <a href="#l02681">2681</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistArithmetics() {#ac33f359fcea1152130e9e51c95256d0c}

<MemberDefinition
  prototype={<>static bool hoistArithmetics (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Aggregates various functions for hoisting computations out of loop.

Definition at line <a href="#l02889">2889</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistBOAssociation() {#aebac730a26c607cea825366afca2d8b1}

<MemberDefinition
  prototype={<>static bool hoistBOAssociation (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Reassociate associative binary expressions of the form.

<ul>
<li>&quot;(LV op C1) op C2&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</li>
<li>&quot;(C1 op LV) op C2&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</li>
<li>&quot;C2 op (C1 op LV)&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</li>
<li>&quot;C2 op (LV op C1)&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</li>
</ul>


where op is an associative BinOp, LV is a loop variant, and C1 and C2 are loop invariants that we want to hoist, noting that associativity implies commutativity.

Definition at line <a href="#l02828">2828</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistGEP() {#a062c93def88f99e93047ba86970c4eab}

<MemberDefinition
  prototype={<>static bool hoistGEP (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Reassociate gep (gep ptr, idx1), idx2 to gep (gep ptr, idx2), idx1 if this allows hoisting the inner GEP.

Definition at line <a href="#l02499">2499</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistMinMax() {#a1f669cc640bda295e6c2e2b3c90babb9}

<MemberDefinition
  prototype={<>static bool hoistMinMax (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU)</>}
  labels = {["static"]}>
Try to simplify things like (A &lt; INV&#95;1 AND icmp A &lt; INV&#95;2) into (A &lt; min(INV&#95;1, INV&#95;2)), if INV&#95;1 and INV&#95;2 are both loop invariants and their minimun can be computed outside of loop, and X is not a loop-invariant.

Definition at line <a href="#l02422">2422</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistMulAddAssociation() {#a697cde840957bbc0b2848a593c3e0d5a}

<MemberDefinition
  prototype={<>static bool hoistMulAddAssociation (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Try to reassociate expressions like ((A1 &#42; B1) + (A2 &#42; B2) + ...) &#42; C where A1, A2, ... and C are loop invariants into expressions like ((A1 &#42; C &#42; B1) + (A2 &#42; C &#42; B2) + ...) and hoist the (A1 &#42; C), (A2 &#42; C), ... invariant expressions.

This functions returns true only if any hoisting has actually occured.

Definition at line <a href="#l02726">2726</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### hoistSub() {#aabf61131f4fe5c83b4f3dccf4adb5e96}

<MemberDefinition
  prototype={<>static bool hoistSub (ICmpInst::Predicate Pred, <a href="/docs/api/classes/llvm/value">Value</a> &#42; VariantLHS, <a href="/docs/api/classes/llvm/value">Value</a> &#42; InvariantRHS, <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &amp; ICmp, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Try to reassociate and hoist the following two patterns: LV - C1 &lt; C2 --&gt; LV &lt; C1 + C2, C1 - LV &lt; C2 --&gt; LV &gt; C1 - C2.

Definition at line <a href="#l02605">2605</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#aea8a4c201b5630473d49bddbb5f5c221}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (LegacyLICMPass, &quot;licm&quot;, &quot;Loop Invariant Code Motion&quot;, false, false)</>}>

Definition at line <a href="#l00371">371</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### inSubLoop() {#aabae34d2dbed5dde1865f19ccbe4cb81}

<MemberDefinition
  prototype={<>static bool inSubLoop (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI)</>}
  labels = {["static"]}>
Little predicate that returns true if the specified basic block is in a subloop of the current one, not the current one itself.

Definition at line <a href="#l02938">2938</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### isFoldableInLoop() {#a1a0282efdd962c35bc840b90bafeb35b}

<MemberDefinition
  prototype={<>static bool isFoldableInLoop (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI)</>}
  labels = {["static"]}>
Return true if the instruction is foldable in the loop.

Definition at line <a href="#l01355">1355</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### isLoadInvariantInLoop() {#a831a5dec04e512d616fccb6e1f474e79}

<MemberDefinition
  prototype={<>static bool isLoadInvariantInLoop (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42; LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop)</>}
  labels = {["static"]}>

Definition at line <a href="#l01053">1053</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### isNotUsedOrFoldableInLoop() {#a0581d6d5dc280ba2a39087a557050a6a}

<MemberDefinition
  prototype={<>static bool isNotUsedOrFoldableInLoop (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42; SafetyInfo, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, bool &amp; FoldableInLoop, bool LoopNestMode)</>}
  labels = {["static"]}>
Return true if the only users of this instruction are outside of the loop.

If this is true, we can sink the instruction to the exit blocks of the loop.

We also return true if the instruction could be folded away in lowering. (e.g., a GEP can be folded into a load as an addressing mode in the loop).

Definition at line <a href="#l01385">1385</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### isReassociableOp() {#a0504a04476327cd645600bb33f7862e9}

<MemberDefinition
  prototype={<>static bool isReassociableOp (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, unsigned IntOpcode, unsigned FPOpcode)</>}
  labels = {["static"]}>

Definition at line <a href="#l02711">2711</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### isSafeToExecuteUnconditionally() {#ab63d5eb7a9919d4e5f2c8d614e9bda97}

<MemberDefinition
  prototype={<>static bool isSafeToExecuteUnconditionally (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; Inst, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42; SafetyInfo, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; CtxI, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, bool AllowSpeculation)</>}
  labels = {["static"]}>
Only sink or hoist an instruction if it is not a trapping instruction, or if the instruction is known not to trap when moved to the preheader.

or if it is a trapping instruction and is guaranteed to execute.

Definition at line <a href="#l01788">1788</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### isTriviallyReplaceablePHI() {#ad0eaec807c54661058d9a1aed11195d9}

<MemberDefinition
  prototype={<>static bool isTriviallyReplaceablePHI (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I)</>}
  labels = {["static"]}>
Returns true if a <a href="/docs/api/classes/llvm/phinode">PHINode</a> is a trivially replaceable with an <a href="/docs/api/classes/llvm/instruction">Instruction</a>.

This is true when all incoming values are that instruction. This pattern occurs most often with LCSSA PHI nodes.

Definition at line <a href="#l01346">1346</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### moveInstructionBefore() {#a22d7cc599c50e811dff1546c5ccb8794}

<MemberDefinition
  prototype={<>static void moveInstructionBefore (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Dest, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE)</>}
  labels = {["static"]}>

Definition at line <a href="#l01511">1511</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### pointerInvalidatedByBlock() {#aed7e046ac6f7dd5ff0edb6e7b7a30e2e}

<MemberDefinition
  prototype={<>bool pointerInvalidatedByBlock (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; BB, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &amp; MSSA, <a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &amp; MU)</>}
  labels = {["static"]}>

Definition at line <a href="#l02410">2410</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### pointerInvalidatedByLoop() {#a28d9fc94843828b60459abd31b7e82c6}

<MemberDefinition
  prototype={<>static bool pointerInvalidatedByLoop (<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42; MSSA, <a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &#42; MU, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp; Flags, bool InvariantGroup)</>}
  labels = {["static"]}>

Definition at line <a href="#l02359">2359</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### sink() {#a52b8b307321627e612e77041260ece84}

<MemberDefinition
  prototype={<>static bool sink (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE)</>}
  labels = {["static"]}>
When an instruction is found to only be used outside of the loop, this function moves it to the exit blocks and patches up SSA form as needed.

This method is guaranteed to remove the original instruction from its position, and may either delete it or move it to outside of the loop.

Definition at line <a href="#l01635">1635</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### sinkThroughTriviallyReplaceablePHI() {#a9a7faaf4dae6e940d419a57c39cd5d98}

<MemberDefinition
  prototype={<>static Instruction &#42; sinkThroughTriviallyReplaceablePHI (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; TPN, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, 32 &gt; &amp; SunkCopies, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42; SafetyInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp; MSSAU)</>}
  labels = {["static"]}>

Definition at line <a href="#l01526">1526</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### splitPredecessorsOfLoopExit() {#a0bb855d418108ea53140e71d7b35a2cd}

<MemberDefinition
  prototype={<>static void splitPredecessorsOfLoopExit (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42; SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42; MSSAU)</>}
  labels = {["static"]}>

Definition at line <a href="#l01562">1562</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a45fc14ff56c52942c30f44602a634cd6}

<MemberDefinition
  prototype={<>STATISTIC (NumCreatedBlocks, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a> created&quot;)</>}>

Definition at line <a href="#l00096">96</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac71346eda47536b5dad25bf96ae9d967}

<MemberDefinition
  prototype={<>STATISTIC (NumClonedBranches, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/arc/arcbranchfinalize-cpp/#a14311558a7445776def2d5bc13161ba3">branches</a> cloned&quot;)</>}>

Definition at line <a href="#l00097">97</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a8ab29be4bd7be711c51309b7600f39d5}

<MemberDefinition
  prototype={<>STATISTIC (NumSunk, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> sunk out of loop&quot;)</>}>

Definition at line <a href="#l00098">98</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a71572cd280491dbe39de10f2c594d899}

<MemberDefinition
  prototype={<>STATISTIC (NumHoisted, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> hoisted out of loop&quot;)</>}>

Definition at line <a href="#l00099">99</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a229336856c0c49796c9799050e1bd5af}

<MemberDefinition
  prototype={<>STATISTIC (NumMovedLoads, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a> insts hoisted or sunk&quot;)</>}>

Definition at line <a href="#l00100">100</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a02828d8acc81b8b904bf6b2c75c9035d}

<MemberDefinition
  prototype={<>STATISTIC (NumMovedCalls, &quot;Number of call insts hoisted or sunk&quot;)</>}>

Definition at line <a href="#l00101">101</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4b4018ad6701dfeb3525234895d398fb}

<MemberDefinition
  prototype={<>STATISTIC (NumPromotionCandidates, &quot;Number of promotion candidates&quot;)</>}>

Definition at line <a href="#l00102">102</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a86e14a51df2457965f2e9d4ae5ffaa21}

<MemberDefinition
  prototype={<>STATISTIC (NumLoadPromoted, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a>-<a href="/docs/api/files/lib/lib/analysis/regionprinter-cpp/#a5782a8740ff1e91516b41b3726a3168c">only</a> promotions&quot;)</>}>

Definition at line <a href="#l00103">103</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a21b6d215c7e3e0a6731f0439a9489f3e}

<MemberDefinition
  prototype={<>STATISTIC (NumLoadStorePromoted, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a> and store promotions&quot;)</>}>

Definition at line <a href="#l00104">104</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a32a173fad8474a7cc2d875a5ab798201}

<MemberDefinition
  prototype={<>STATISTIC (NumMinMaxHoisted, &quot;Number of min/max expressions hoisted out of the loop&quot;)</>}>

Definition at line <a href="#l00105">105</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab0a5d3c1f04cc4283a55e43c961de82d}

<MemberDefinition
  prototype={<>STATISTIC (NumGEPsHoisted, &quot;Number of geps reassociated and hoisted out of the loop&quot;)</>}>

Definition at line <a href="#l00107">107</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a176063aaa653dab209ff072e26c0f6b1}

<MemberDefinition
  prototype={<>STATISTIC (NumAddSubHoisted, &quot;Number of add/subtract expressions reassociated &quot; &quot;and hoisted out of the loop&quot;)</>}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3ecfbc0e53ed739a59174190d712b86c}

<MemberDefinition
  prototype={<>STATISTIC (NumFPAssociationsHoisted, &quot;Number of invariant <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a> expressions &quot; &quot;reassociated and hoisted out of the loop&quot;)</>}>

Definition at line <a href="#l00111">111</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a459334bbfc499f6b04cbb6dca86fedce}

<MemberDefinition
  prototype={<>STATISTIC (NumIntAssociationsHoisted, &quot;Number of invariant int expressions &quot; &quot;reassociated and hoisted out of the loop&quot;)</>}>

Definition at line <a href="#l00113">113</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aded553a858cd162a5466c0a2c919f816}

<MemberDefinition
  prototype={<>STATISTIC (NumBOAssociationsHoisted, &quot;Number of invariant BinaryOp expressions &quot; &quot;reassociated and hoisted out of the loop&quot;)</>}>

Definition at line <a href="#l00116">116</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### ControlFlowHoisting {#a260c812c38e9c3fb8663ad8418f49990}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ControlFlowHoisting(&quot;licm-control-flow-hoisting&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable control flow (and PHI) hoisting in LICM&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00124">124</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### DisablePromotion {#ae779d27a69e1a53dab0c657f206e9527}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisablePromotion(&quot;disable-licm-promotion&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable memory promotion in LICM pass&quot;))</>}
  labels = {["static"]}>
<a href="/docs/api/classes/llvm/sys/memory">Memory</a> promotion is enabled by default.

Definition at line <a href="#l00121">121</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### false {#a37badf0d674adf27a6c95db110df6f71}

<MemberDefinition
  prototype="Loop Invariant Code false">

Definition at line <a href="#l00378">378</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### FPAssociationUpperLimit {#a184889de0db5db92331f4b625b1d967e}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; FPAssociationUpperLimit(&quot;licm-max-num-fp-reassociations&quot;, cl::init(5U), cl::Hidden, cl::desc( &quot;Set upper limit for the number of transformations performed &quot; &quot;during a single round of hoisting the reassociated expressions.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00137">137</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### IntAssociationUpperLimit {#a73f55e27d558de45459e584ff664f468}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; IntAssociationUpperLimit(&quot;licm-max-num-int-reassociations&quot;, cl::init(5U), cl::Hidden, cl::desc( &quot;Set upper limit for the number of transformations performed &quot; &quot;during a single round of hoisting the reassociated expressions.&quot;))</>}>

Definition at line <a href="#l00143">143</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### licm {#a9daa918c2c6be9aa9ca401f69cc75302}

<MemberDefinition
  prototype="licm">

Definition at line <a href="#l00378">378</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### MaxNumUsesTraversed {#a71198b8e987ea074eb3faa3d5adbd6c9}

<MemberDefinition
  prototype={<>cl::opt&lt; uint32&#95;t &gt; MaxNumUsesTraversed(&quot;licm-max-num-uses-traversed&quot;, cl::Hidden, cl::init(8), cl::desc(&quot;Max num uses visited for identifying load &quot; &quot;invariance in loop using invariant start (default = 8)&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00132">132</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### Motion {#a7db10a6ced2f9a67bd4f40d5ed05489d}

<MemberDefinition
  prototype="Loop Invariant Code Motion">

Definition at line <a href="#l00378">378</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

### SingleThread {#a06ee6708a8f92c5b0ba2220d8bb3aef9}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; SingleThread(&quot;licm-force-thread-model-single&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Force thread model single in LICM pass&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00129">129</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;licm&quot;</>}>

Definition at line <a href="#l00094">94</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp">LICM.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===-- LICM.cpp - Loop Invariant Code Motion Pass ------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This pass performs loop invariant code motion, attempting to remove as much</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// code from the body of a loop as possible.  It does this by either hoisting</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// code into the preheader block, or by sinking code to the exit blocks if it is</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// safe.  This pass also promotes must-aliased memory locations in the loop to</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// live in registers, thus hoisting and sinking &quot;invariant&quot; loads and stores.</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// Hoisting operations out of loops is a canonicalization transform.  It</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">// enables and simplifies subsequent optimizations in the middle-end.</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">// Rematerialization of hoisted instructions to reduce register pressure is the</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">// responsibility of the back-end, which has more accurate information about</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">// register pressure and also handles other optimizations than LICM that</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">// increase live-ranges.</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">// This pass uses alias analysis for two purposes:</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">//  1 Moving loop invariant loads and calls out of loops.  If we can determine</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">//     that a load or call inside of a loop never aliases anything stored to,</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">//     we can hoist it or sink it like any other instruction.</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">//  2 Scalar Promotion of Memory - If there is a store instruction inside of</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">//     the loop, we try to move the store to happen AFTER the loop instead of</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">//     inside of the loop.  This can only happen if a few conditions are true:</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightComment">//       A. The pointer stored through is loop invariant</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightComment">//       B. There are no stores or loads in the loop which &#95;may&#95; alias the</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightComment">//          pointer.  There are no calls in the loop which mod/ref the pointer.</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightComment">//     If these conditions are true, we can promote the loads and stores in the</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightComment">//     loop of the pointer to use a temporary alloca&#39;d variable.  We then use</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightComment">//     the SSAUpdater to construct the appropriate SSA form for the value.</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/licm-h">llvm/Transforms/Scalar/LICM.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/priorityworklist-h">llvm/ADT/PriorityWorklist.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setoperations-h">llvm/ADT/SetOperations.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h">llvm/Analysis/AliasAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliassettracker-h">llvm/Analysis/AliasSetTracker.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/capturetracking-h">llvm/Analysis/CaptureTracking.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h">llvm/Analysis/DomTreeUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/guardutils-h">llvm/Analysis/GuardUtils.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/lazyblockfrequencyinfo-h">llvm/Analysis/LazyBlockFrequencyInfo.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h">llvm/Analysis/Loads.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopiterator-h">llvm/Analysis/LoopIterator.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopnestanalysis-h">llvm/Analysis/LoopNestAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/looppass-h">llvm/Analysis/LoopPass.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h">llvm/Analysis/MemorySSA.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h">llvm/Analysis/MemorySSAUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/mustexecute-h">llvm/Analysis/MustExecute.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h">llvm/Analysis/ScalarEvolution.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/prediteratorcache-h">llvm/IR/PredIteratorCache.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/scalar-h">llvm/Transforms/Scalar.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/assumebundlebuilder-h">llvm/Transforms/Utils/AssumeBundleBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h">llvm/Transforms/Utils/LoopUtils.h</a>&quot;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ssaupdater-h">llvm/Transforms/Utils/SSAUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/lpmupdater">LPMUpdater</a>;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace llvm</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;licm&quot;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96" lineLink="#a45fc14ff56c52942c30f44602a634cd6"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCreatedBlocks, </span><span class="doxyHighlightStringLiteral">&quot;Number of blocks created&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97" lineLink="#ac71346eda47536b5dad25bf96ae9d967"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumClonedBranches, </span><span class="doxyHighlightStringLiteral">&quot;Number of branches cloned&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="#a8ab29be4bd7be711c51309b7600f39d5"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSunk, </span><span class="doxyHighlightStringLiteral">&quot;Number of instructions sunk out of loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="#a71572cd280491dbe39de10f2c594d899"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumHoisted, </span><span class="doxyHighlightStringLiteral">&quot;Number of instructions hoisted out of loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100" lineLink="#a229336856c0c49796c9799050e1bd5af"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMovedLoads, </span><span class="doxyHighlightStringLiteral">&quot;Number of load insts hoisted or sunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101" lineLink="#a02828d8acc81b8b904bf6b2c75c9035d"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMovedCalls, </span><span class="doxyHighlightStringLiteral">&quot;Number of call insts hoisted or sunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="#a4b4018ad6701dfeb3525234895d398fb"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPromotionCandidates, </span><span class="doxyHighlightStringLiteral">&quot;Number of promotion candidates&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103" lineLink="#a86e14a51df2457965f2e9d4ae5ffaa21"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLoadPromoted, </span><span class="doxyHighlightStringLiteral">&quot;Number of load-only promotions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104" lineLink="#a21b6d215c7e3e0a6731f0439a9489f3e"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLoadStorePromoted, </span><span class="doxyHighlightStringLiteral">&quot;Number of load and store promotions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105" lineLink="#a32a173fad8474a7cc2d875a5ab798201"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMinMaxHoisted,</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of min/max expressions hoisted out of the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#ab0a5d3c1f04cc4283a55e43c961de82d"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumGEPsHoisted,</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of geps reassociated and hoisted out of the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#a176063aaa653dab209ff072e26c0f6b1"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAddSubHoisted, </span><span class="doxyHighlightStringLiteral">&quot;Number of add/subtract expressions reassociated &quot;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;and hoisted out of the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111" lineLink="#a3ecfbc0e53ed739a59174190d712b86c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFPAssociationsHoisted, </span><span class="doxyHighlightStringLiteral">&quot;Number of invariant FP expressions &quot;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">                                    </span><span class="doxyHighlightStringLiteral">&quot;reassociated and hoisted out of the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="#a459334bbfc499f6b04cbb6dca86fedce"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumIntAssociationsHoisted,</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of invariant int expressions &quot;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;reassociated and hoisted out of the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116" lineLink="#aded553a858cd162a5466c0a2c919f816"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumBOAssociationsHoisted, </span><span class="doxyHighlightStringLiteral">&quot;Number of invariant BinaryOp expressions &quot;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">                                    </span><span class="doxyHighlightStringLiteral">&quot;reassociated and hoisted out of the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlightComment">/// Memory promotion is enabled by default.</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121" lineLink="#ae779d27a69e1a53dab0c657f206e9527"><span class="doxyHighlight">    <a href="#ae779d27a69e1a53dab0c657f206e9527">DisablePromotion</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-licm-promotion&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">                     <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable memory promotion in LICM pass&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124" lineLink="#a260c812c38e9c3fb8663ad8418f49990"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a260c812c38e9c3fb8663ad8418f49990">ControlFlowHoisting</a>(</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;licm-control-flow-hoisting&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable control flow (and PHI) hoisting in LICM&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129" lineLink="#a06ee6708a8f92c5b0ba2220d8bb3aef9"><span class="doxyHighlight">    <a href="#a06ee6708a8f92c5b0ba2220d8bb3aef9">SingleThread</a>(</span><span class="doxyHighlightStringLiteral">&quot;licm-force-thread-model-single&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">                 <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Force thread model single in LICM pass&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132" lineLink="#a71198b8e987ea074eb3faa3d5adbd6c9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;uint32&#95;t&gt;</a> <a href="#a71198b8e987ea074eb3faa3d5adbd6c9">MaxNumUsesTraversed</a>(</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;licm-max-num-uses-traversed&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(8),</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max num uses visited for identifying load &quot;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;invariance in loop using invariant start (default = 8)&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137" lineLink="#a184889de0db5db92331f4b625b1d967e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a184889de0db5db92331f4b625b1d967e">FPAssociationUpperLimit</a>(</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;licm-max-num-fp-reassociations&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(5U), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Set upper limit for the number of transformations performed &quot;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;during a single round of hoisting the reassociated expressions.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143" lineLink="#a73f55e27d558de45459e584ff664f468"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a73f55e27d558de45459e584ff664f468">IntAssociationUpperLimit</a>(</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;licm-max-num-int-reassociations&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(5U), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Set upper limit for the number of transformations performed &quot;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;during a single round of hoisting the reassociated expressions.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightComment">// Experimental option to allow imprecision in LICM in pathological cases, in</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightComment">// exchange for faster compile. This is to be removed if MemorySSA starts to</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlightComment">// address the same issue. LICM calls MemorySSAWalker&#39;s</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlightComment">// getClobberingMemoryAccess, up to the value of the Cap, getting perfect</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">// accuracy. Afterwards, LICM will call into MemorySSA&#39;s getDefiningAccess,</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightComment">// which may not be precise, since optimizeUses is capped. The result is</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">// correct, but we may not get as &quot;far up&quot; as possible to get which access is</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightComment">// clobbering the one queried.</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="/docs/api/namespaces/llvm/#af0eea3fd894969f858eee273ba9f0b9b">llvm::SetLicmMssaOptCap</a>(</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;licm-mssa-optimization-cap&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(100), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable imprecision in LICM in pathological cases, in exchange &quot;</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;for faster compile. Caps the MemorySSA clobbering calls.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightComment">// Experimentally, memory promotion carries less importance than sinking and</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightComment">// hoisting. Limit when we do promotion when using MemorySSA, in order to save</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlightComment">// compile time.</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="/docs/api/namespaces/llvm/#ad9c3fae5a25cf9c407f7b07a86067ab5">llvm::SetLicmMssaNoAccForPromotionCap</a>(</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;licm-mssa-max-acc-promotion&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(250), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#91;LICM &amp; MemorySSA&#93; When MSSA in LICM is disabled, this has no &quot;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;effect. When MSSA in LICM is enabled, then this is the maximum &quot;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;number of accesses allowed to be present in a loop in order to &quot;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;enable memory promotion.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aabae34d2dbed5dde1865f19ccbe4cb81">inSubLoop</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI);</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a0581d6d5dc280ba2a39087a557050a6a">isNotUsedOrFoldableInLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;FoldableInLoop, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopNestMode);</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a3a3a3183a327e1186dbe900032390ec6">hoist</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dest, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE,</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE);</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a52b8b307321627e612e77041260ece84">sink</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE);</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab63d5eb7a9919d4e5f2c8d614e9bda97">isSafeToExecuteUnconditionally</a>(</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CtxI,</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowSpeculation);</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a28d9fc94843828b60459abd31b7e82c6">pointerInvalidatedByLoop</a>(<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA, <a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &#42;MU,</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvariantGroup);</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aed7e046ac6f7dd5ff0edb6e7b7a30e2e">pointerInvalidatedByBlock</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &amp;MSSA,</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &amp;MU);</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlightComment">/// Aggregates various functions for hoisting computations out of loop.</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ac33f359fcea1152130e9e51c95256d0c">hoistArithmetics</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L,</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT);</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a25f0b41add9507b8eafadfbc4a090d6c">cloneInstructionInExitBlock</a>(</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;ExitBlock, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU);</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU);</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a22d7cc599c50e811dff1546c5ccb8794">moveInstructionBefore</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Dest,</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE);</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8046d863469d9c33287fa4a673d00571">foreachMemoryAccess</a>(<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;)&gt; Fn);</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213" lineLink="#ad8f672710e1f206d9f187070e3c6058e"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="#ad8f672710e1f206d9f187070e3c6058e">PointersAndHasReadsOutsideSet</a> =</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">    std::pair&lt;SmallSetVector&lt;Value &#42;, 8&gt;, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">&gt;;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PointersAndHasReadsOutsideSet, 0&gt;</a></span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight"><a href="#a37ddbdd8cb4efa5072282498fdc1ac65">collectPromotionCandidates</a>(<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA, <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L);</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218" lineLink="/docs/api/namespaces/anonymous-licm-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion/#ab145ec5cb2a7641ead001398fdb17022">LoopInvariantCodeMotion</a> &#123;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion/#a2cb39ddab08a9e701785bd369e2e16db">runOnLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA,</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopNestMode = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion/#ab145ec5cb2a7641ead001398fdb17022"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion/#ab145ec5cb2a7641ead001398fdb17022">LoopInvariantCodeMotion</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LicmMssaOptCap,</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LicmMssaNoAccForPromotionCap,</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LicmAllowSpeculation)</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">      : LicmMssaOptCap(LicmMssaOptCap),</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">        LicmMssaNoAccForPromotionCap(LicmMssaNoAccForPromotionCap),</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">        LicmAllowSpeculation(LicmAllowSpeculation) &#123;&#125;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LicmMssaOptCap;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LicmMssaNoAccForPromotionCap;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LicmAllowSpeculation;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a4ca93bfd48742106afe0a529f3032a22">LegacyLICMPass</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/looppass/#a4d5799624e630ba03cb9133168951e8a">LoopPass</a> &#123;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a66d2fcfe873c504417abd1d3aa2b51fb"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a66d2fcfe873c504417abd1d3aa2b51fb">ID</a>; </span><span class="doxyHighlightComment">// Pass identification, replacement for typeid</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a4ca93bfd48742106afe0a529f3032a22"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a4ca93bfd48742106afe0a529f3032a22">LegacyLICMPass</a>(</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LicmMssaOptCap = <a href="/docs/api/namespaces/llvm/#af0eea3fd894969f858eee273ba9f0b9b">SetLicmMssaOptCap</a>,</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LicmMssaNoAccForPromotionCap = <a href="/docs/api/namespaces/llvm/#ad9c3fae5a25cf9c407f7b07a86067ab5">SetLicmMssaNoAccForPromotionCap</a>,</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LicmAllowSpeculation = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/looppass/#a4d5799624e630ba03cb9133168951e8a">LoopPass</a>(<a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a66d2fcfe873c504417abd1d3aa2b51fb">ID</a>), LICM(LicmMssaOptCap, LicmMssaNoAccForPromotionCap,</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">                           LicmAllowSpeculation) &#123;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a2d13a2fc9f1e7b66fb65014013f41614">initializeLegacyLICMPassPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#adfe3debfb083aea25b34a2f09c1b3132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#adfe3debfb083aea25b34a2f09c1b3132">runOnLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/lppassmanager">LPPassManager</a> &amp;LPM)</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/looppass/#ac97db8f0e4f4a0946dddf617f45f6c8b">skipLoop</a>(L))</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Perform LICM on Loop with header at block &quot;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">                      &lt;&lt; L-&gt;getHeader()-&gt;getNameOrAsOperand() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = L-&gt;getHeader()-&gt;getParent();</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SE = <a href="/docs/api/classes/llvm/pass/#af94c014e968489e96c7d4353a84ad7f5">getAnalysisIfAvailable&lt;ScalarEvolutionWrapperPass&gt;</a>();</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MemorySSAWrapperPass&gt;</a>().getMSSA();</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For the old PM, we can&#39;t use OptimizationRemarkEmitter as an analysis</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pass. Function analyses need to be preserved across loop transformations</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// but ORE cannot be preserved (see comment before the pass definition).</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> ORE(L-&gt;getHeader()-&gt;getParent());</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LICM.runOnLoop(</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">        L, &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;AAResultsWrapperPass&gt;</a>().getAAResults(),</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">        &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;LoopInfoWrapperPass&gt;</a>().getLoopInfo(),</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">        &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;DominatorTreeWrapperPass&gt;</a>().getDomTree(),</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">        &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;AssumptionCacheTracker&gt;</a>().getAssumptionCache(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>),</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">        &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;</a>().getTLI(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>),</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">        &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetTransformInfoWrapperPass&gt;</a>().getTTI(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>),</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">        SE ? &amp;SE-&gt;getSE() : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, MSSA, &amp;ORE);</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlightComment">  /// This transformation requires natural loop information &amp; requires that</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlightComment">  /// loop preheaders be inserted into the CFG...</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a8c00ffe14e3127e04bc1f74c02d42079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a8c00ffe14e3127e04bc1f74c02d42079">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/loopinfowrapperpass">LoopInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/memoryssawrapperpass">MemorySSAWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/memoryssawrapperpass">MemorySSAWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/assumptioncachetracker">AssumptionCacheTracker</a>&gt;();</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a92caae34bfacc63bda0f23d5d005a89e">getLoopAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/lazyblockfrequencyinfopass/#a8969b22606511eb0e2b2e028a3c0f332">LazyBlockFrequencyInfoPass::getLazyBFIAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/lazyblockfrequencyinfopass">LazyBlockFrequencyInfoPass</a>&gt;();</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/lazybranchprobabilityinfopass">LazyBranchProbabilityInfoPass</a>&gt;();</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion">LoopInvariantCodeMotion</a> LICM;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296" lineLink="/docs/api/classes/llvm/licmpass/#aa540c3d95adfef29cc520491ce4ebdab"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/licmpass/#aa540c3d95adfef29cc520491ce4ebdab">LICMPass::run</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/namespaces/llvm/#a58dde534a0ea2a23cb6c779c5c283f75">LoopAnalysisManager</a> &amp;AM,</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">                                <a href="/docs/api/structs/llvm/loopstandardanalysisresults">LoopStandardAnalysisResults</a> &amp;AR, <a href="/docs/api/classes/llvm/lpmupdater">LPMUpdater</a> &amp;) &#123;</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>)</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;LICM requires MemorySSA (loop-mssa)&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">                       </span><span class="doxyHighlightComment">/&#42;GenCrashDiag&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For the new PM, we also can&#39;t use OptimizationRemarkEmitter as an analysis</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pass.  Function analyses need to be preserved across loop transformations</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// but ORE cannot be preserved (see comment before the pass definition).</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> ORE(L.getHeader()-&gt;getParent());</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  LoopInvariantCodeMotion LICM(Opts.MssaOptCap, Opts.MssaNoAccForPromotionCap,</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">                               Opts.AllowSpeculation);</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LICM.runOnLoop(&amp;L, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#abd7da877be8576011299f4fcaaf299be">AA</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aa09379aa4435be95eb717dd9b5d8b4c5">LI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aaa96df870a1b3d7ffc56bec3eb0b0cff">DT</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a902b4712394a3b3450893634b3302893">AC</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a9e363c1eaf112166372e2d52704981fb">TLI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a3444a9359f5f17f1694f82c41d5fd574">TTI</a>,</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">                      &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a124376878e24aef4252795ba9fea420f">SE</a>, AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>, &amp;ORE))</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PA = <a href="/docs/api/namespaces/llvm/#ac7294ba4e105807674fe3a394437fcc1">getLoopPassPreservedAnalyses</a>();</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  PA.preserve&lt;<a href="/docs/api/classes/llvm/memoryssaanalysis">MemorySSAAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319" lineLink="/docs/api/classes/llvm/licmpass/#a60cd761f9058b8203f4a4d8fbb31fb98"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/licmpass/#a60cd761f9058b8203f4a4d8fbb31fb98">LICMPass::printPipeline</a>(</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/stringref">StringRef</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a>)&gt; MapClassName2PassName) &#123;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/passinfomixin">PassInfoMixin&lt;LICMPass&gt;</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)-&gt;<a href="/docs/api/classes/llvm/licmpass/#a60cd761f9058b8203f4a4d8fbb31fb98">printPipeline</a>(</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">      OS, MapClassName2PassName);</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;&lt;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">  OS &lt;&lt; (Opts.AllowSpeculation ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;no-&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;allowspeculation&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;&gt;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329" lineLink="/docs/api/classes/llvm/lnicmpass/#a1ddd3ffe6782be6b893dcf33dcf4e3c0"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/lnicmpass/#a1ddd3ffe6782be6b893dcf33dcf4e3c0">LNICMPass::run</a>(<a href="/docs/api/classes/llvm/loopnest">LoopNest</a> &amp;LN, <a href="/docs/api/namespaces/llvm/#a58dde534a0ea2a23cb6c779c5c283f75">LoopAnalysisManager</a> &amp;AM,</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">                                 <a href="/docs/api/structs/llvm/loopstandardanalysisresults">LoopStandardAnalysisResults</a> &amp;AR,</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/lpmupdater">LPMUpdater</a> &amp;) &#123;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>)</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;LNICM requires MemorySSA (loop-mssa)&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">                       </span><span class="doxyHighlightComment">/&#42;GenCrashDiag&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For the new PM, we also can&#39;t use OptimizationRemarkEmitter as an analysis</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pass.  Function analyses need to be preserved across loop transformations</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// but ORE cannot be preserved (see comment before the pass definition).</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> ORE(LN.<a href="/docs/api/classes/llvm/loopnest/#accc0fffa89a787bcc12e5db7a603006c">getParent</a>());</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  LoopInvariantCodeMotion LICM(Opts.MssaOptCap, Opts.MssaNoAccForPromotionCap,</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">                               Opts.AllowSpeculation);</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;OutermostLoop = LN.<a href="/docs/api/classes/llvm/loopnest/#aeb26e0f4ad96cecfa73f0abbed21b61f">getOutermostLoop</a>();</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = LICM.runOnLoop(&amp;OutermostLoop, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#abd7da877be8576011299f4fcaaf299be">AA</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aa09379aa4435be95eb717dd9b5d8b4c5">LI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aaa96df870a1b3d7ffc56bec3eb0b0cff">DT</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a902b4712394a3b3450893634b3302893">AC</a>,</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">                                &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a9e363c1eaf112166372e2d52704981fb">TLI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a3444a9359f5f17f1694f82c41d5fd574">TTI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a124376878e24aef4252795ba9fea420f">SE</a>, AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>, &amp;ORE, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PA = <a href="/docs/api/namespaces/llvm/#ac7294ba4e105807674fe3a394437fcc1">getLoopPassPreservedAnalyses</a>();</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  PA.preserve&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  PA.preserve&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  PA.preserve&lt;<a href="/docs/api/classes/llvm/memoryssaanalysis">MemorySSAAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360" lineLink="/docs/api/classes/llvm/lnicmpass/#aac0763a4080e98e1e198ea76b2d0ccc5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/lnicmpass/#aac0763a4080e98e1e198ea76b2d0ccc5">LNICMPass::printPipeline</a>(</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/stringref">StringRef</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a>)&gt; MapClassName2PassName) &#123;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/passinfomixin">PassInfoMixin&lt;LNICMPass&gt;</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)-&gt;<a href="/docs/api/classes/llvm/lnicmpass/#aac0763a4080e98e1e198ea76b2d0ccc5">printPipeline</a>(</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">      OS, MapClassName2PassName);</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;&lt;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  OS &lt;&lt; (Opts.AllowSpeculation ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;no-&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;allowspeculation&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;&gt;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/legacylicmpass/#a66d2fcfe873c504417abd1d3aa2b51fb">LegacyLICMPass::ID</a> = 0;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371" lineLink="#aea8a4c201b5630473d49bddbb5f5c221"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(LegacyLICMPass, </span><span class="doxyHighlightStringLiteral">&quot;licm&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;Loop Invariant Code Motion&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/looppass">LoopPass</a>)</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/memoryssawrapperpass">MemorySSAWrapperPass</a>)</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(LazyBFIPass)</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378" lineLink="#a37badf0d674adf27a6c95db110df6f71"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(LegacyLICMPass, </span><span class="doxyHighlightStringLiteral">&quot;licm&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;Loop Invariant Code Motion&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/false">false</a>,</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381" lineLink="/docs/api/namespaces/llvm/#a52fe42f45635485443c10aa9de4e7825"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/pass">Pass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a52fe42f45635485443c10aa9de4e7825">createLICMPass</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> LegacyLICMPass(); &#125;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383" lineLink="/docs/api/classes/llvm/sinkandhoistlicmflags/#a622954918dc5a78614a5a41decb22e36"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a30d4121b007bf8064374e069fd2de689">llvm::SinkAndHoistLICMFlags::SinkAndHoistLICMFlags</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a4fde88a1ecbe3e54c70e1afde5597553">IsSink</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L,</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &amp;MSSA)</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">    : <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a30d4121b007bf8064374e069fd2de689">SinkAndHoistLICMFlags</a>(<a href="/docs/api/namespaces/llvm/#af0eea3fd894969f858eee273ba9f0b9b">SetLicmMssaOptCap</a>, <a href="/docs/api/namespaces/llvm/#ad9c3fae5a25cf9c407f7b07a86067ab5">SetLicmMssaNoAccForPromotionCap</a>,</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a4fde88a1ecbe3e54c70e1afde5597553">IsSink</a>, L, MSSA) &#123;&#125;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388" lineLink="/docs/api/classes/llvm/sinkandhoistlicmflags/#a30d4121b007bf8064374e069fd2de689"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a30d4121b007bf8064374e069fd2de689">llvm::SinkAndHoistLICMFlags::SinkAndHoistLICMFlags</a>(</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a695919bf72f47dde7bea8d12532d1ce5">LicmMssaOptCap</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a5b17bcf5d3d17fb80bc652430ef0dc7d">LicmMssaNoAccForPromotionCap</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a4fde88a1ecbe3e54c70e1afde5597553">IsSink</a>,</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &amp;MSSA)</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">    : <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a695919bf72f47dde7bea8d12532d1ce5">LicmMssaOptCap</a>(<a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a695919bf72f47dde7bea8d12532d1ce5">LicmMssaOptCap</a>),</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a5b17bcf5d3d17fb80bc652430ef0dc7d">LicmMssaNoAccForPromotionCap</a>(<a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a5b17bcf5d3d17fb80bc652430ef0dc7d">LicmMssaNoAccForPromotionCap</a>),</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a4fde88a1ecbe3e54c70e1afde5597553">IsSink</a>(<a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a4fde88a1ecbe3e54c70e1afde5597553">IsSink</a>) &#123;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AccessCapCount = 0;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : L.getBlocks())</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Accesses = MSSA.<a href="/docs/api/classes/llvm/memoryssa/#a183ce8029c259d7f9edacadcc7448f06">getBlockAccesses</a>(BB))</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MA : &#42;Accesses) &#123;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">        (void)MA;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">        ++AccessCapCount;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AccessCapCount &gt; <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a5b17bcf5d3d17fb80bc652430ef0dc7d">LicmMssaNoAccForPromotionCap</a>) &#123;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/sinkandhoistlicmflags/#a000032fb000f184a0e40d407d3c68a9b">NoOfMemAccTooLarge</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlightComment">/// Hoist expressions out of the specified loop. Note, alias info for inner</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlightComment">/// loop is not preserved so it is not a good idea to run LICM multiple</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlightComment">/// times on one loop.</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410" lineLink="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion/#a2cb39ddab08a9e701785bd369e2e16db"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-licm-cpp-/loopinvariantcodemotion/#a2cb39ddab08a9e701785bd369e2e16db">LoopInvariantCodeMotion::runOnLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA,</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE,</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopNestMode) &#123;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isLCSSAForm(&#42;DT) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop is not in LCSSA form.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this loop has metadata indicating that LICM is not to be performed then</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// just exit.</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa61b7b49f32233419331f8132b39e77d">hasDisableLICMTransformsHint</a>(L)) &#123;</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t sink stores from loops with coroutine suspend instructions.</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LICM would sink instructions into the default destination of</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the coroutine switch. The default destination of the switch is to</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// handle the case where the coroutine is suspended, by which point the</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// coroutine frame may have been destroyed. No instruction can be sunk there.</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This would unfortunately hurt the performance of coroutines, however</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// there is currently no general solution for this. Similar issues could also</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// potentially happen in other passes where instructions are being moved</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// across that edge.</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasCoroSuspendInst = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">llvm::any&#95;of</a>(L-&gt;getBlocks(), &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    return llvm::any&#95;of(&#42;BB, &#91;&#93;(Instruction &amp;I) &#123;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      IntrinsicInst &#42;II = dyn&#95;cast&lt;IntrinsicInst&gt;(&amp;I);</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">      return II &amp;&amp; II-&gt;getIntrinsicID() == Intrinsic::coro&#95;suspend;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> MSSAU(MSSA);</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> Flags(LicmMssaOptCap, LicmMssaNoAccForPromotionCap,</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;IsSink=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, &#42;L, &#42;MSSA);</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the preheader block to move instructions into...</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = L-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute loop safety information.</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> SafetyInfo;</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  SafetyInfo.<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#aca2badb4637a1c884bebc80828feac0a">computeLoopSafetyInfo</a>(L);</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to visit all of the instructions in this loop... that are not parts</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of our subloops (they have already had their invariants hoisted out of</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// their loop, into this loop, so there is no need to process the BODIES of</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the subloops).</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse the body of the loop in depth first order on the dominator tree so</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that we are guaranteed to see definitions before we see uses.  This allows</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// us to sink instructions in one pass, without iteration.  After sinking</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions, we perform another pass to hoist them out of the loop.</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L-&gt;hasDedicatedExits())</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |=</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">        LoopNestMode</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">            ? <a href="/docs/api/namespaces/llvm/#af1236d17bc9dd1041e95f1724eb9cfa6">sinkRegionForLoopNest</a>(DT-&gt;getNode(L-&gt;getHeader()), <a href="/docs/api/namespaces/llvm/aa">AA</a>, LI, DT,</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">                                    TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, L, MSSAU, &amp;SafetyInfo, Flags, ORE)</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">            : <a href="/docs/api/namespaces/llvm/#ad30fb60072e2996200ea591628e33c5a">sinkRegion</a>(DT-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/lib/target/amdgpu/utils/amdgpudelayedmcexpr-cpp/#a3b9e43a5529fa7d4adb2bad70198c9bd">getNode</a>(L-&gt;getHeader()), <a href="/docs/api/namespaces/llvm/aa">AA</a>, LI, DT, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, L,</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">                         MSSAU, &amp;SafetyInfo, Flags, ORE);</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  Flags.setIsSink(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Preheader)</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#a5efa2c3e00054566f1baaebc766461a4">hoistRegion</a>(DT-&gt;getNode(L-&gt;getHeader()), <a href="/docs/api/namespaces/llvm/aa">AA</a>, LI, DT, AC, TLI, L,</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">                           MSSAU, SE, &amp;SafetyInfo, Flags, ORE, LoopNestMode,</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">                           LicmAllowSpeculation);</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that all loop invariants have been removed from the loop, promote any</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// memory references to scalars that we can.</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t sink stores from loops without dedicated block exits. Exits</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// containing indirect branches are not transformed by loop simplify,</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// make sure we catch that. An additional load may be generated in the</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preheader for SSA updater, so also avoid sinking when no preheader</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is available.</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (!<a href="/docs/api/files/lib/lib/codegen/typepromotion-cpp/#a84af6334fea86701def418c5d5257266">DisablePromotion</a> &amp;&amp; Preheader &amp;&amp; L-&gt;hasDedicatedExits() &amp;&amp;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">      !Flags.tooManyMemoryAccesses() &amp;&amp; !HasCoroSuspendInst) &#123;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Figure out the loop exits and their insertion points</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    SmallVector&lt;BasicBlock &#42;, 8&gt; ExitBlocks;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    L-&gt;getUniqueExitBlocks(ExitBlocks);</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can&#39;t insert into a catchswitch.</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">    bool HasCatchSwitch = llvm::any&#95;of(ExitBlocks, &#91;&#93;(BasicBlock &#42;Exit) &#123;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">      return isa&lt;CatchSwitchInst&gt;(Exit-&gt;getTerminator());</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasCatchSwitch) &#123;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock::iterator, 8&gt;</a> InsertPts;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MemoryAccess &#42;, 8&gt;</a> MSSAInsertPts;</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">      InsertPts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(ExitBlocks.size());</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">      MSSAInsertPts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(ExitBlocks.size());</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBlock : ExitBlocks) &#123;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">        InsertPts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ExitBlock-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">        MSSAInsertPts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/prediteratorcache">PredIteratorCache</a> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#ad4d247df65c12507f447383be37d7ccb">PIC</a>;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Promoting one set of accesses may make the pointers for another set</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// loop invariant, so run this in a loop.</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Promoted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LocalPromoted;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">        LocalPromoted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;PointerMustAliases, HasReadsOutsideSet&#93; :</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">             <a href="#a37ddbdd8cb4efa5072282498fdc1ac65">collectPromotionCandidates</a>(MSSA, <a href="/docs/api/namespaces/llvm/aa">AA</a>, L)) &#123;</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">          LocalPromoted |= <a href="/docs/api/namespaces/llvm/#ae8cc923f4e20540201f1cd1225811b9f">promoteLoopAccessesToScalars</a>(</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">              PointerMustAliases, ExitBlocks, InsertPts, MSSAInsertPts, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#ad4d247df65c12507f447383be37d7ccb">PIC</a>, LI,</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">              DT, AC, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, L, MSSAU, &amp;SafetyInfo, ORE,</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">              LicmAllowSpeculation, HasReadsOutsideSet);</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">        Promoted |= LocalPromoted;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (LocalPromoted);</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Once we have promoted values across the loop body we have to</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// recursively reform LCSSA as any nested loop may now have values defined</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// within the loop used in the outer loop.</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: This is really heavy handed. It would be a bit better to use an</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// SSAUpdater strategy during promotion that was LCSSA aware and reformed</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it as it went.</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Promoted)</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a30e47ae014eb35bea24e45097c2bd731">formLCSSARecursively</a>(&#42;L, &#42;DT, LI, SE);</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= Promoted;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that neither this loop nor its parent have had LCSSA broken. LICM is</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// specifically moving instructions across the loop boundary and so it is</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// especially in need of basic functional correctness checking here.</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLCSSAForm(&#42;DT) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop not left in LCSSA form after LICM!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isOutermost() || <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getParentLoop()-&gt;isLCSSAForm(&#42;DT)) &amp;&amp;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Parent loop not left in LCSSA form after LICM!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a>)</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">    MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a88b10d37f671e58cf138ac84a8257c17">verifyMemorySSA</a>();</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> &amp;&amp; SE)</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    SE-&gt;forgetLoopDispositions();</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlightComment">/// Walk the specified region of the CFG (defined by all blocks dominated by</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlightComment">/// the specified block, and that are in the current loop) in reverse depth</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlightComment">/// first order w.r.t the DominatorTree.  This allows us to visit uses before</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlightComment">/// definitions, allowing us to sink a loop body in one pass without iteration.</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555" lineLink="/docs/api/namespaces/llvm/#ad30fb60072e2996200ea591628e33c5a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ad30fb60072e2996200ea591628e33c5a">llvm::sinkRegion</a>(<a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OutermostLoop) &#123;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verify inputs.</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; <a href="/docs/api/namespaces/llvm/aa">AA</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; LI != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; DT != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">         CurLoop != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; SafetyInfo != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp;</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected input to sinkRegion.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to visit children before parents. We will enqueue all the parents</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// before their children in the worklist and process the worklist in reverse</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// order.</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 16&gt;</a> Worklist =</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a544a0723e20148ceb9a3bb3210f45270">collectChildrenInLoop</a>(DT, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, CurLoop);</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(Worklist)) &#123;</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// subloop (which would already have been processed).</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aabae34d2dbed5dde1865f19ccbe4cb81">inSubLoop</a>(BB, CurLoop, LI))</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = BB-&gt;end(); <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> != BB-&gt;begin();) &#123;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &#42;--<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The instruction is not used in the loop if it is dead.  In this case,</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we just delete it instead of sinking it.</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLI)) &#123;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM deleting dead inst: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aa5df9c7cb06c08a066a30482d77cc1d9">salvageKnowledge</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>;</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">        <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#42;SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check to see if we can sink this instruction to the exit blocks</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of the loop.  We can do this if the all users of the instruction are</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// outside of the loop.  In this case, it doesn&#39;t even matter if the</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// operands of the instruction are loop invariant.</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoldableInLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopNestMode = OutermostLoop != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayHaveSideEffects() &amp;&amp;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">          <a href="#a0581d6d5dc280ba2a39087a557050a6a">isNotUsedOrFoldableInLoop</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LoopNestMode ? OutermostLoop : CurLoop,</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">                                    SafetyInfo, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, FoldableInLoop,</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">                                    LoopNestMode) &amp;&amp;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a158e2caed73e4b5d2ad70c1b2a0e0cc8">canSinkOrHoistInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/aa">AA</a>, DT, CurLoop, MSSAU, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, Flags, ORE)) &#123;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a52b8b307321627e612e77041260ece84">sink</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LI, DT, CurLoop, SafetyInfo, MSSAU, ORE)) &#123;</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FoldableInLoop) &#123;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">            ++<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">            <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#42;SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a>)</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">    MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a88b10d37f671e58cf138ac84a8257c17">verifyMemorySSA</a>();</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622" lineLink="/docs/api/namespaces/llvm/#af1236d17bc9dd1041e95f1724eb9cfa6"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#af1236d17bc9dd1041e95f1724eb9cfa6">llvm::sinkRegionForLoopNest</a>(<a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU,</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallpriorityworklist">SmallPriorityWorklist&lt;Loop &#42;, 4&gt;</a> Worklist;</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/priorityworklist/#af74058cc2f8163b1d7128b467432a09b">insert</a>(CurLoop);</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab7a106c600cf32852298d9041e8c8044">appendLoopsToWorklist</a>(&#42;CurLoop, Worklist);</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/priorityworklist/#adc2ef5f0964becc28dfa58a7abc2f1e7">empty</a>()) &#123;</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = Worklist.<a href="/docs/api/classes/llvm/priorityworklist/#ab89ceb7695256590499de818b5360c54">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#ad30fb60072e2996200ea591628e33c5a">sinkRegion</a>(DT-&gt;<a href="/docs/api/classes/llvm/dominatortreebase/#ad8295b9b507d1d847cd46856f8255eab">getNode</a>(L-&gt;getHeader()), <a href="/docs/api/namespaces/llvm/aa">AA</a>, LI, DT, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, L,</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">                          MSSAU, SafetyInfo, Flags, ORE, CurLoop);</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlightComment">// This is a helper class for hoistRegion to make it able to hoist control flow</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlightComment">// in order to be able to hoist phis. The way this works is that we initially</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlightComment">// start hoisting to the loop preheader, and when we see a loop invariant branch</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlightComment">// we make note of this. When we then come to hoist an instruction that&#39;s</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlightComment">// conditional on such a branch we duplicate the branch and the relevant control</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlightComment">// flow, then hoist the instruction into the block corresponding to its original</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlightComment">// block in the duplicated control flow.</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#a2db4e96ba77211b7d574dbefc86fa9ae">ControlFlowHoister</a> &#123;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Information about the loop we are hoisting from</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT;</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A map of blocks in the loop to the block their instructions will be hoisted</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to.</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BasicBlock &#42;&gt;</a> HoistDestinationMap;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The branches that we can hoist, mapped to the block that marks a</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// convergence point of their control flow.</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BranchInst &#42;, BasicBlock &#42;&gt;</a> HoistableBranches;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#a2db4e96ba77211b7d574dbefc86fa9ae"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#a2db4e96ba77211b7d574dbefc86fa9ae">ControlFlowHoister</a>(<a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU)</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">      : LI(LI), DT(DT), CurLoop(CurLoop), MSSAU(MSSAU) &#123;&#125;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#a90cb1c8c28c96b3e0abcd1dc070a7d87"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#a90cb1c8c28c96b3e0abcd1dc070a7d87">registerPossiblyHoistableBranch</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI) &#123;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can only hoist conditional branches with loop invariant operands.</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a260c812c38e9c3fb8663ad8418f49990">ControlFlowHoisting</a> || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() ||</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">        !CurLoop-&gt;hasLoopInvariantOperands(BI))</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The branch destinations need to be in the loop, and we don&#39;t gain</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// anything by duplicating conditional branches with duplicate successors,</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as it&#39;s essentially the same as an unconditional branch.</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurLoop-&gt;contains(TrueDest) || !CurLoop-&gt;contains(FalseDest) ||</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">        TrueDest == FalseDest)</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can hoist BI if one branch destination is the successor of the other,</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or both have common successor which we check by seeing if the</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// intersection of their successors is non-empty.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: This could be expanded to allowing branches where both ends</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// eventually converge to a single block.</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 4&gt;</a> TrueDestSucc, FalseDestSucc;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">    TrueDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(TrueDest), <a href="/docs/api/namespaces/llvm/#aa5684e4976198c1b64b694d3972ddf78">succ&#95;end</a>(TrueDest));</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">    FalseDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(FalseDest), <a href="/docs/api/namespaces/llvm/#aa5684e4976198c1b64b694d3972ddf78">succ&#95;end</a>(FalseDest));</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonSucc = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(FalseDest)) &#123;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">      CommonSucc = FalseDest;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FalseDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(TrueDest)) &#123;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">      CommonSucc = TrueDest;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a2162d123f222998300d308bdefdb38b9">set&#95;intersect</a>(TrueDestSucc, FalseDestSucc);</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If there&#39;s one common successor use that.</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 1)</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">        CommonSucc = &#42;TrueDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>();</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If there&#39;s more than one pick whichever appears first in the block list</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (we can&#39;t use the value returned by TrueDestSucc.begin() as it&#39;s</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// unpredicatable which element gets returned).</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TrueDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>()) &#123;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = TrueDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsSucc = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TrueDestSucc.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;BB); &#125;;</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">llvm::find&#95;if</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, IsSucc);</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;end() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find successor in function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">        CommonSucc = &amp;&#42;It;</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The common successor has to be dominated by the branch, as otherwise</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// there will be some other path to the successor that will not be</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// controlled by this branch so any phi we hoist would be controlled by the</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// wrong condition. This also takes care of avoiding hoisting of loop back</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// edges.</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: In some cases this could be relaxed if the successor is dominated</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// by another block that&#39;s been hoisted and we can guarantee that the</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// control flow has been replicated exactly.</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonSucc &amp;&amp; DT-&gt;dominates(BI, CommonSucc))</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">      HoistableBranches&#91;BI&#93; = CommonSucc;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#a1e57f3f08dc49d529ce37ad63d844528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#a1e57f3f08dc49d529ce37ad63d844528">canHoistPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123;</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The phi must have loop invariant operands.</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a260c812c38e9c3fb8663ad8418f49990">ControlFlowHoisting</a> || !CurLoop-&gt;hasLoopInvariantOperands(PN))</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can hoist phis if the block they are in is the target of hoistable</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branches which cover all of the predecessors of the block.</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 8&gt;</a> PredecessorBlocks;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">      PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PredBB);</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have less predecessor blocks than predecessors then the phi will</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have more than one incoming value for the same block which we can&#39;t</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// handle.</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: This could be handled be erasing some of the duplicate incoming</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() != <a href="/docs/api/namespaces/llvm/#a3f211484edf604716a6c80030b0a0375">pred&#95;size</a>(BB))</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : HoistableBranches) &#123;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pair.second == BB) &#123;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Which blocks are predecessors via this branch depends on if the</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// branch is triangle-like or diamond-like.</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pair.first-&gt;getSuccessor(0) == BB) &#123;</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">          PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(Pair.first-&gt;getParent());</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">          PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(Pair.first-&gt;getSuccessor(1));</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pair.first-&gt;getSuccessor(1) == BB) &#123;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">          PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(Pair.first-&gt;getParent());</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">          PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(Pair.first-&gt;getSuccessor(0));</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">          PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(Pair.first-&gt;getSuccessor(0));</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">          PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(Pair.first-&gt;getSuccessor(1));</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PredecessorBlocks will now be empty if for every predecessor of BB we</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// found a hoistable branch source.</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PredecessorBlocks.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>();</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#ac2231bda91f0fdd79e476cb36e48d33b"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#ac2231bda91f0fdd79e476cb36e48d33b">getOrCreateHoistedBlock</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a260c812c38e9c3fb8663ad8418f49990">ControlFlowHoisting</a>)</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CurLoop-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If BB has already been hoisted, return that</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HoistDestinationMap.count(BB))</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HoistDestinationMap&#91;BB&#93;;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if this block is conditional based on a pending branch</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HasBBAsSuccessor =</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">        &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BranchInst &#42;, BasicBlock &#42;&gt;::value&#95;type</a> &amp;Pair) &#123;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BB != Pair.second &amp;&amp; (Pair.first-&gt;getSuccessor(0) == BB ||</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">                                       Pair.first-&gt;getSuccessor(1) == BB);</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">llvm::find&#95;if</a>(HoistableBranches, HasBBAsSuccessor);</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If not involved in a pending branch, hoist to preheader</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InitialPreheader = CurLoop-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It == HoistableBranches.end()) &#123;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM using &quot;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">                        &lt;&lt; InitialPreheader-&gt;<a href="/docs/api/classes/llvm/value/#a391ffe96dd8c686b0d2620c7fb25f8a5">getNameOrAsOperand</a>()</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; as hoist destination for &quot;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">                        &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#a391ffe96dd8c686b0d2620c7fb25f8a5">getNameOrAsOperand</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">      HoistDestinationMap&#91;BB&#93; = InitialPreheader;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> InitialPreheader;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = It-&gt;first;</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(std::find&#95;if(++It, HoistableBranches.end(), HasBBAsSuccessor) ==</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">               HoistableBranches.end() &amp;&amp;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;BB is expected to be the target of at most one branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>();</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonSucc = HoistableBranches&#91;BI&#93;;</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HoistTarget = <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/controlflowhoister/#ac2231bda91f0fdd79e476cb36e48d33b">getOrCreateHoistedBlock</a>(BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create hoisted versions of blocks that currently don&#39;t have them</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CreateHoistedBlock = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Orig) &#123;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HoistDestinationMap.count(Orig))</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HoistDestinationMap&#91;Orig&#93;;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;New =</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, Orig-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.licm&quot;</span><span class="doxyHighlight">, Orig-&gt;getParent());</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">      HoistDestinationMap&#91;Orig&#93; = New;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">      DT-&gt;addNewBlock(New, HoistTarget);</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;getParentLoop())</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">        CurLoop-&gt;getParentLoop()-&gt;addBasicBlockToLoop(New, &#42;LI);</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">      ++NumCreatedBlocks;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM created &quot;</span><span class="doxyHighlight"> &lt;&lt; New-&gt;getName()</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; as hoist destination for &quot;</span><span class="doxyHighlight"> &lt;&lt; Orig-&gt;getName()</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> New;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HoistTrueDest = CreateHoistedBlock(TrueDest);</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HoistFalseDest = CreateHoistedBlock(FalseDest);</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HoistCommonSucc = CreateHoistedBlock(CommonSucc);</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Link up these blocks with branches.</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HoistCommonSucc-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) &#123;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The new common successor we&#39;ve generated will branch to whatever that</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// hoist target branched to.</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TargetSucc = HoistTarget-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>();</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TargetSucc &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected hoist target to have a single successor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      HoistCommonSucc-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac1fd6437bbfce263b87f01767d950ce5">moveBefore</a>(TargetSucc);</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(TargetSucc, HoistCommonSucc);</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HoistTrueDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) &#123;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">      HoistTrueDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac1fd6437bbfce263b87f01767d950ce5">moveBefore</a>(HoistCommonSucc);</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(HoistCommonSucc, HoistTrueDest);</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HoistFalseDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) &#123;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">      HoistFalseDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac1fd6437bbfce263b87f01767d950ce5">moveBefore</a>(HoistCommonSucc);</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(HoistCommonSucc, HoistFalseDest);</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If BI is being cloned to what was originally the preheader then</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// HoistCommonSucc will now be the new preheader.</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HoistTarget == InitialPreheader) &#123;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Phis in the loop header now need to use the new preheader.</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">      InitialPreheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a089e003bb688e55b9a91ed4e7fed3678">replaceSuccessorsPhiUsesWith</a>(HoistCommonSucc);</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">      MSSAU.wireOldPredecessorsToNewImmediatePredecessor(</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">          HoistTarget-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>(), HoistCommonSucc, &#123;HoistTarget&#125;);</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The new preheader dominates the loop header.</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;PreheaderNode = DT-&gt;getNode(HoistCommonSucc);</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;HeaderNode = DT-&gt;getNode(CurLoop-&gt;getHeader());</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">      DT-&gt;changeImmediateDominator(HeaderNode, PreheaderNode);</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The preheader hoist destination is now the new preheader, with the</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// exception of the hoist destination of this branch.</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : HoistDestinationMap)</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pair.second == InitialPreheader &amp;&amp; Pair.first != BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">          Pair.second = HoistCommonSucc;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now finally clone BI.</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">        HoistTarget-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(HoistTrueDest, HoistFalseDest, BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()));</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">    ++NumClonedBranches;</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurLoop-&gt;getLoopPreheader() &amp;&amp;</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Hoisting blocks should not have destroyed preheader&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HoistDestinationMap&#91;BB&#93;;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlightComment">/// Walk the specified region of the CFG (defined by all blocks dominated by</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlightComment">/// the specified block, and that are in the current loop) in depth first</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlightComment">/// order w.r.t the DominatorTree.  This allows us to visit definitions before</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlightComment">/// uses, allowing us to hoist a loop body in one pass without iteration.</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875" lineLink="/docs/api/namespaces/llvm/#a5efa2c3e00054566f1baaebc766461a4"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a5efa2c3e00054566f1baaebc766461a4">llvm::hoistRegion</a>(<a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE,</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopNestMode,</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">                       </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowSpeculation) &#123;</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verify inputs.</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; <a href="/docs/api/namespaces/llvm/aa">AA</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; LI != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; DT != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">         CurLoop != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; SafetyInfo != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected input to hoistRegion.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  ControlFlowHoister CFH(LI, DT, CurLoop, MSSAU);</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track of instructions that have been hoisted, as they may need to be</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// re-hoisted if they end up not dominating all of their uses.</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 16&gt;</a> HoistedInstructions;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For PHI hoisting to work we need to hoist blocks before their successors.</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can do this by iterating through the blocks in the loop in reverse</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// post-order.</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopblocksrpo">LoopBlocksRPO</a> Worklist(CurLoop);</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/loopblocksrpo/#aeab06fd248333b13725e55754883b570">perform</a>(LI);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : Worklist) &#123;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only need to process the contents of this block if it is not part of a</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// subloop (which would already have been processed).</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoopNestMode &amp;&amp; <a href="#aabae34d2dbed5dde1865f19ccbe4cb81">inSubLoop</a>(BB, CurLoop, LI))</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Try hoisting the instruction out to the preheader.  We can only do</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this if all of the operands of the instruction are loop invariant and</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if it is safe to hoist the instruction. We also check block frequency</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to make sure instruction only gets hoisted into colder blocks.</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: It may be safe to hoist if we are hoisting to a conditional block</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and we have accurately duplicated the control flow from the loop header</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to that block.</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a54e82aea5fab8cf3a878003444f25ee7">hasLoopInvariantOperands</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a158e2caed73e4b5d2ad70c1b2a0e0cc8">canSinkOrHoistInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/aa">AA</a>, DT, CurLoop, MSSAU, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, Flags, ORE) &amp;&amp;</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">          <a href="#ab63d5eb7a9919d4e5f2c8d614e9bda97">isSafeToExecuteUnconditionally</a>(</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DT, TLI, CurLoop, SafetyInfo, ORE,</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">              Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), AC, AllowSpeculation)) &#123;</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">        <a href="#a3a3a3183a327e1186dbe900032390ec6">hoist</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DT, CurLoop, CFH.getOrCreateHoistedBlock(BB), SafetyInfo,</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">              MSSAU, SE, ORE);</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">        HoistedInstructions.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Attempt to remove floating point division out of the loop by</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// converting it to a reciprocal multiplication.</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == Instruction::FDiv &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.hasAllowReciprocal() &amp;&amp;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">          CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1))) &#123;</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Divisor = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> One = llvm::ConstantFP::get(Divisor-&gt;getType(), 1.0);</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ReciprocalDivisor = BinaryOperator::CreateFDiv(One, Divisor);</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">        ReciprocalDivisor-&gt;setFastMathFlags(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFastMathFlags());</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">        SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#acaf635590a74bf4fdc2822b6f877afb7">insertInstructionTo</a>(ReciprocalDivisor, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent());</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">        ReciprocalDivisor-&gt;insertBefore(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIterator());</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">        ReciprocalDivisor-&gt;setDebugLoc(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc());</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Product =</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">            BinaryOperator::CreateFMul(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), ReciprocalDivisor);</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">        Product-&gt;setFastMathFlags(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFastMathFlags());</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">        SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#acaf635590a74bf4fdc2822b6f877afb7">insertInstructionTo</a>(Product, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent());</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">        Product-&gt;insertAfter(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIterator());</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">        Product-&gt;setDebugLoc(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc());</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.replaceAllUsesWith(Product);</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">        <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#42;SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">        <a href="#a3a3a3183a327e1186dbe900032390ec6">hoist</a>(&#42;ReciprocalDivisor, DT, CurLoop, CFH.getOrCreateHoistedBlock(BB),</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">              SafetyInfo, MSSAU, SE, ORE);</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">        HoistedInstructions.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ReciprocalDivisor);</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsInvariantStart = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.use&#95;empty() &amp;&amp;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::invariant&#95;start&gt;</a>());</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MustExecuteWithoutWritesBefore = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#ab40701961745d6467fa8e23b1e451c12">isGuaranteedToExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DT, CurLoop) &amp;&amp;</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">               SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#a639eff65ee8e468b3891fbe67db54788">doesNotWriteMemoryBefore</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CurLoop);</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((IsInvariantStart(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a656efdcee3deb029763304d3e741a2d1">isGuard</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">          CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a54e82aea5fab8cf3a878003444f25ee7">hasLoopInvariantOperands</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">          MustExecuteWithoutWritesBefore(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">        <a href="#a3a3a3183a327e1186dbe900032390ec6">hoist</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DT, CurLoop, CFH.getOrCreateHoistedBlock(BB), SafetyInfo,</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">              MSSAU, SE, ORE);</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">        HoistedInstructions.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CFH.canHoistPHI(PN)) &#123;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Redirect incoming blocks first to ensure that we create hoisted</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// versions of those blocks before we hoist the phi.</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0; i &lt; PN-&gt;getNumIncomingValues(); ++i)</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">            PN-&gt;setIncomingBlock(</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">                i, CFH.getOrCreateHoistedBlock(PN-&gt;getIncomingBlock(i)));</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">          <a href="#a3a3a3183a327e1186dbe900032390ec6">hoist</a>(&#42;PN, DT, CurLoop, CFH.getOrCreateHoistedBlock(BB), SafetyInfo,</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">                MSSAU, SE, ORE);</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(PN, BB) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Conditional PHIs not expected&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Try to reassociate instructions so that part of computations can be</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// done out of loop.</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ac33f359fcea1152130e9e51c95256d0c">hoistArithmetics</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#42;CurLoop, &#42;SafetyInfo, MSSAU, AC, DT)) &#123;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remember possibly hoistable branches so we can actually hoist them</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// later if needed.</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">        CFH.registerPossiblyHoistableBranch(BI);</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we hoisted instructions to a conditional block they may not dominate</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// their uses that weren&#39;t hoisted (such as phis where some operands are not</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop invariant). If so make them unconditional by moving them to their</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// immediate dominator. We iterate through the instructions in reverse order</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which ensures that when we rehoist an instruction we rehoist its operands,</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and also keep track of where in the block we are rehoisting to make sure</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that we rehoist instructions before the instructions that use them.</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;HoistPoint = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a260c812c38e9c3fb8663ad8418f49990">ControlFlowHoisting</a>) &#123;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(HoistedInstructions)) &#123;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses(),</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">                        &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123; return DT-&gt;dominates(I, U); &#125;)) &#123;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dominator =</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">            DT-&gt;<a href="/docs/api/classes/llvm/dominatortreebase/#ad8295b9b507d1d847cd46856f8255eab">getNode</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#a453de62c2dadf7b4b8df04e89f6ab4e0">getIDom</a>()-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#aab2bf365c9f4b976adc7479576dfd5bb">getBlock</a>();</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HoistPoint || !DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(HoistPoint-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), Dominator)) &#123;</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HoistPoint)</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(Dominator, HoistPoint-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;New hoist point expected to dominate old hoist point&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">          HoistPoint = Dominator-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM rehoisting to &quot;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">                          &lt;&lt; HoistPoint-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getNameOrAsOperand()</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">        <a href="#a22d7cc599c50e811dff1546c5ccb8794">moveInstructionBefore</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, HoistPoint-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), &#42;SafetyInfo, MSSAU,</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">                              SE);</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">        HoistPoint = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a>)</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">    MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a88b10d37f671e58cf138ac84a8257c17">verifyMemorySSA</a>();</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now that we&#39;ve finished hoisting make sure that LI and DT are still</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// valid.</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlightPreprocessor">#ifdef EXPENSIVE&#95;CHECKS</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>) &#123;</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;<a href="/docs/api/classes/llvm/dominatortreebase/#a1f08f2925fec05b265e540d29066b9c8">verify</a>(DominatorTree::VerificationLevel::Fast) &amp;&amp;</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Dominator tree verification failed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">    LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a17a8f7aba5cca5c7f9faa779a3c4bc37">verify</a>(&#42;DT);</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlightComment">// Return true if LI is invariant within scope of the loop. LI is invariant if</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlightComment">// CurLoop is dominated by an invariant.start representing the same memory</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlightComment">// location and size as the memory location LI loads from, and also the</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlightComment">// invariant.start has no uses.</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053" lineLink="#a831a5dec04e512d616fccb6e1f474e79"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a831a5dec04e512d616fccb6e1f474e79">isLoadInvariantInLoop</a>(<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop) &#123;</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Addr = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = LI-&gt;<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/typesize">TypeSize</a> LocSizeInBits = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is not currently possible for clang to generate an invariant.start</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsic with scalable vector types because we don&#39;t support thread local</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sizeless types and we don&#39;t permit sizeless types in structs or classes.</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Furthermore, even if support is added for this in future the intrinsic</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// itself is defined to have a size of -1 for variable sized objects. This</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// makes it impossible to verify if the intrinsic envelops our region of</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// interest. For example, both &lt;vscale x 32 x i8&gt; and &lt;vscale x 16 x i8&gt;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// types would have a -1 parameter, but the former is clearly double the size</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the latter.</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LocSizeInBits.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;ve ended up at a global/constant, bail. We shouldn&#39;t be looking at</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// uselists for non-local Values in a loop pass.</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Addr))</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UsesVisited = 0;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse all uses of the load operand value, to see if invariant.start is</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one of the uses, and whether it dominates the load instruction.</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : Addr-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Avoid traversing for Load operand with high number of users.</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (++UsesVisited &gt; <a href="#a71198b8e987ea074eb3faa3d5adbd6c9">MaxNumUsesTraversed</a>)</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(U);</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are escaping uses of invariant.start instruction, the load maybe</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// non-invariant.</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> || <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() != Intrinsic::invariant&#95;start ||</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">        !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;use&#95;empty())</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;InvariantSize = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0));</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The intrinsic supports having a -1 argument for variable sized objects</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// so we should check for that here.</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvariantSize-&gt;<a href="/docs/api/classes/llvm/constantint/#a2a8c8be274f3bd351e083ab3828c14c7">isNegative</a>())</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">    uint64&#95;t InvariantSizeInBits = InvariantSize-&gt;<a href="/docs/api/classes/llvm/constantint/#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>() &#42; 8;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Confirm the invariant.start location size contains the load operand size</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in bits. Also, the invariant.start should dominate the load, and we</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// should not hoist the load out of a loop that contains this dominating</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// invariant.start.</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LocSizeInBits.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &lt;= InvariantSizeInBits &amp;&amp;</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">        DT-&gt;<a href="/docs/api/classes/llvm/dominatortreebase/#ade6d93f9485649bade540a37ec163058">properlyDominates</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent(), CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()))</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlightComment">/// Return true if-and-only-if we know how to (mechanically) both hoist and</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlightComment">/// sink a given instruction out of a loop.  Does not address legality</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlightComment">/// concerns such as aliasing or speculation safety.</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111" lineLink="/docs/api/namespaces/anonymous-licm-cpp-/#a0f285ef5614fb7ba29a97615149a8f4d"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-licm-cpp-/#a0f285ef5614fb7ba29a97615149a8f4d">isHoistableAndSinkableInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only these instructions are hoistable/sinkable.</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FenceInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InsertElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractValueInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InsertValueInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FreezeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlightComment">/// Return true if MSSA knows there are no MemoryDefs in the loop.</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122" lineLink="/docs/api/namespaces/anonymous-licm-cpp-/#a9d7f9cdd2e085f1453ac2f3186255fdc"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-licm-cpp-/#a9d7f9cdd2e085f1453ac2f3186255fdc">isReadOnly</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : L-&gt;getBlocks())</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ad586af665c013c65c83a31294555f996">getBlockDefs</a>(BB))</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlightComment">/// Return true if I is the only Instruction with a MemoryAccess in L.</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130" lineLink="/docs/api/namespaces/anonymous-licm-cpp-/#af11bb20a72885fc6999bfbcb21bd39fe"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-licm-cpp-/#af11bb20a72885fc6999bfbcb21bd39fe">isOnlyMemoryAccess</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU) &#123;</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : L-&gt;getBlocks())</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Accs = MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a183ce8029c259d7f9edacadcc7448f06">getBlockAccesses</a>(BB)) &#123;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> NotAPhi = 0;</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Acc : &#42;Accs) &#123;</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;MemoryPhi&gt;</a>(&amp;Acc))</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MUD = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryUseOrDef&gt;</a>(&amp;Acc);</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MUD-&gt;getMemoryInst() != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || NotAPhi++ == 1)</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147" lineLink="#a329ad21a549f7f43ad50b65f4d3ca487"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;<a href="#a329ad21a549f7f43ad50b65f4d3ca487">getClobberingMemoryAccess</a>(<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &amp;MSSA,</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/batchaaresults">BatchAAResults</a> &amp;BAA,</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/memoryuseordef">MemoryUseOrDef</a> &#42;MA) &#123;</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See declaration of SetLicmMssaOptCap for usage details.</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Flags.tooManyClobberingCalls())</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MA-&gt;<a href="/docs/api/classes/llvm/memoryuseordef/#a20455da69cab73871b8c0111f0afe712">getDefiningAccess</a>();</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;Source =</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">      MSSA.<a href="/docs/api/classes/llvm/memoryssa/#a2ef6f9107316d963f20b9003b7668c4e">getSkipSelfWalker</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssawalker/#a2783df47072c5951e94299a35bc39848">getClobberingMemoryAccess</a>(MA, BAA);</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  Flags.incrementClobberingCalls();</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Source;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161" lineLink="/docs/api/namespaces/llvm/#a158e2caed73e4b5d2ad70c1b2a0e0cc8"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a158e2caed73e4b5d2ad70c1b2a0e0cc8">llvm::canSinkOrHoistInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU,</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TargetExecutesOncePerLoop,</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we don&#39;t understand the instruction, bail early.</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isHoistableAndSinkableInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA = MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>();</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loads have extra constraints we have to verify before we can hoist them.</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI-&gt;isUnordered())</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Don&#39;t sink/hoist volatile or ordered atomic loads!</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Loads from constant memory are always safe to move, even if they end up</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in the same alias set as something that ends up being modified.</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a728f79528ca8659e15d00c1e6818b316">isModSet</a>(<a href="/docs/api/namespaces/llvm/aa">AA</a>-&gt;getModRefInfoMask(LI-&gt;getOperand(0))))</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;hasMetadata(LLVMContext::MD&#95;invariant&#95;load))</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;isAtomic() &amp;&amp; !TargetExecutesOncePerLoop)</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Don&#39;t risk duplicating unordered loads</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This checks for an invariant.start dominating the load.</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a831a5dec04e512d616fccb6e1f474e79">isLoadInvariantInLoop</a>(LI, DT, CurLoop))</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MU = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryUse&gt;</a>(MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ab15de610fca1c900038bf3c333919e45">getMemoryAccess</a>(LI));</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvariantGroup = LI-&gt;hasMetadata(LLVMContext::MD&#95;invariant&#95;group);</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa29a29047cd211a4eb34dd1129b3db135">Invalidated</a> = <a href="#a28d9fc94843828b60459abd31b7e82c6">pointerInvalidatedByLoop</a>(</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">        MSSA, MU, CurLoop, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Flags, InvariantGroup);</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check loop-invariant address because this may also be a sinkable load</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// whose address is not necessarily loop-invariant.</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ORE &amp;&amp; <a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa29a29047cd211a4eb34dd1129b3db135">Invalidated</a> &amp;&amp; CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(LI-&gt;getPointerOperand()))</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">      ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">                   <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;LoadWithLoopInvariantAddressInvalidated&quot;</span><span class="doxyHighlight">, LI)</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;failed to move load with loop-invariant address &quot;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot;because the loop may invalidate its value&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa29a29047cd211a4eb34dd1129b3db135">Invalidated</a>;</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t sink or hoist dbg info; it&#39;s legal, but not useful.</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t sink calls which can throw.</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;mayThrow())</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Convergent attribute has been used on operations that involve</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// inter-thread communication which results are implicitly affected by the</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// enclosing control flows. It is not safe to hoist or sink such operations</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// across control flow.</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;isConvergent())</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Current LLVM IR semantics don&#39;t work well with coroutines and</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// thread local globals. We currently treat getting the address of a thread</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// local global as not accessing memory, even though it may not be a</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// constant throughout a function with coroutines. Remove this check after</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we better model semantics of thread local globals.</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;getFunction()-&gt;isPresplitCoroutine())</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CI, <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::assume&gt;</a>()))</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Assumes don&#39;t actually alias anything or throw</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle simple cases by querying alias analysis.</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a44ad2b29af9ebe3d12a99843a7594757">MemoryEffects</a> Behavior = <a href="/docs/api/namespaces/llvm/aa">AA</a>-&gt;getMemoryEffects(CI);</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Behavior.doesNotAccessMemory())</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Behavior.onlyReadsMemory()) &#123;</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// A readonly argmemonly function only reads from memory pointed to by</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it&#39;s arguments with arbitrary offsets.  If we can prove there are no</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// writes to this memory in the loop, we can hoist or sink.</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Behavior.onlyAccessesArgPointees()) &#123;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: expand to writeable arguments</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : CI-&gt;args())</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType()-&gt;isPointerTy() &amp;&amp;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">              <a href="#a28d9fc94843828b60459abd31b7e82c6">pointerInvalidatedByLoop</a>(</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">                  MSSA, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryUse&gt;</a>(MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ab15de610fca1c900038bf3c333919e45">getMemoryAccess</a>(CI)), CurLoop, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">                  Flags, </span><span class="doxyHighlightComment">/&#42;InvariantGroup=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this call only reads from memory and there are no writes to memory</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in the loop, we can hoist or sink the call as appropriate.</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isReadOnly(MSSAU, CurLoop))</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: This should use mod/ref information to see if we can hoist or</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sink the call.</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FenceInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fences alias (most) everything to provide ordering.  For the moment,</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// just give up if there are any other memory operations in the loop.</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> isOnlyMemoryAccess(FI, CurLoop, MSSAU);</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isUnordered())</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Don&#39;t sink/hoist volatile or ordered atomic store!</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can only hoist a store that we can prove writes a value which is not</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// read or overwritten within the loop.  For those cases, we fallback to</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// load store promotion instead.  TODO: We can extend this to cases where</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// there is exactly one write to the location and that write dominates an</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// arbitrary number of reads in the loop.</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isOnlyMemoryAccess(<a href="/docs/api/namespaces/llvm/si">SI</a>, CurLoop, MSSAU))</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are more accesses than the Promotion cap, then give up as we&#39;re</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// not walking a list that long.</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Flags.tooManyMemoryAccesses())</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SIMD = MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ab15de610fca1c900038bf3c333919e45">getMemoryAccess</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/batchaaresults">BatchAAResults</a> BAA(&#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>);</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Source = <a href="#a329ad21a549f7f43ad50b65f4d3ca487">getClobberingMemoryAccess</a>(&#42;MSSA, BAA, Flags, SIMD);</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure there are no clobbers inside the loop.</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ae3b89ffde42778289bcbd8a187199420">isLiveOnEntryDef</a>(Source) &amp;&amp;</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">           CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(Source-&gt;getBlock()))</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are interfering Uses (i.e. their defining access is in the</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop), or ordered loads (stored as Defs!), don&#39;t move this store.</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Could do better here, but this is conservatively correct.</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Cache set of Uses on the first walk in runOnLoop, update when</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// moving accesses. Can also extend to dominating uses.</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac94e1f7398df9df2508957f58a82279a">getBlocks</a>())</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Accesses = MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a183ce8029c259d7f9edacadcc7448f06">getBlockAccesses</a>(BB)) &#123;</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MA : &#42;Accesses)</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MU = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemoryUse&gt;</a>(&amp;MA)) &#123;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MD = <a href="#a329ad21a549f7f43ad50b65f4d3ca487">getClobberingMemoryAccess</a>(&#42;MSSA, BAA, Flags,</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">                </span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(MU));</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ae3b89ffde42778289bcbd8a187199420">isLiveOnEntryDef</a>(MD) &amp;&amp;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">                CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(MD-&gt;getBlock()))</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Disable hoisting past potentially interfering loads. Optimized</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Uses may point to an access outside the loop, as getClobbering</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// checks the previous iteration when walking the backedge.</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// FIXME: More precise: no Uses that alias SI.</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Flags.getIsSink() &amp;&amp; !MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a56004f54560e9950f6eb148cb5dfa0a3">dominates</a>(SIMD, MU))</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemoryDef&gt;</a>(&amp;MA)) &#123;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(MD-&gt;getMemoryInst())) &#123;</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">              (void)LI; </span><span class="doxyHighlightComment">// Silence warning.</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LI-&gt;isUnordered() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected unordered load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Any call, while it may not be clobbering SI, it may be a use.</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(MD-&gt;getMemoryInst())) &#123;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// Check if the call may read from the memory location written</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// to by SI. Check CI&#39;s attributes and arguments; the number of</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// such checks performed is limited above by NoOfMemAccTooLarge.</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2e">ModRefInfo</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = BAA.<a href="/docs/api/classes/llvm/batchaaresults/#adfa0be41805b25d9577d6f15d148a0d7">getModRefInfo</a>(CI, <a href="/docs/api/classes/llvm/memorylocation/#a18e5a3f1d71ba10a624f2a8e5121cf1f">MemoryLocation::get</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>));</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a854abfc88bcd24e3878e2c9ab1f70fd3">isModOrRefSet</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>))</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;unhandled aliasing&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;ve established mechanical ability and aliasing, it&#39;s up to the caller</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to check fault safety</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlightComment">/// Returns true if a PHINode is a trivially replaceable with an</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlightComment">/// Instruction.</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlightComment">/// This is true when all incoming values are that instruction.</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlightComment">/// This pattern occurs most often with LCSSA PHI nodes.</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346" lineLink="#ad0eaec807c54661058d9a1aed11195d9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ad0eaec807c54661058d9a1aed11195d9">isTriviallyReplaceablePHI</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncValue : PN.<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncValue != &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlightComment">/// Return true if the instruction is foldable in the loop.</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355" lineLink="#a1a0282efdd962c35bc840b90bafeb35b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a1a0282efdd962c35bc840b90bafeb35b">isFoldableInLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> CostI =</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getInstructionCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>);</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostI != <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">TargetTransformInfo::TCC&#95;Free</a>)</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For a GEP, we cannot simply use getInstructionCost because currently</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it optimistically assumes that a GEP will fold into addressing mode</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// regardless of its users.</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getParent();</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(UI) &amp;&amp;</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">          (BB != UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() ||</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">           (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(UI) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(UI))))</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlightComment">/// Return true if the only users of this instruction are outside of</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlightComment">/// the loop. If this is true, we can sink the instruction to the exit</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlightComment">/// blocks of the loop.</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlightComment">/// We also return true if the instruction could be folded away in lowering.</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlightComment">/// (e.g.,  a GEP can be folded into a load as an addressing mode in the loop).</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385" lineLink="#a0581d6d5dc280ba2a39087a557050a6a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a0581d6d5dc280ba2a39087a557050a6a">isNotUsedOrFoldableInLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;FoldableInLoop, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopNestMode) &#123;</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BlockColors = SafetyInfo-&gt;<a href="/docs/api/classes/llvm/loopsafetyinfo/#a59204639c099ab5d774e8f5cf929ed9d">getBlockColors</a>();</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFoldable = <a href="#a1a0282efdd962c35bc840b90bafeb35b">isFoldableInLoop</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CurLoop, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users()) &#123;</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(UI)) &#123;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We cannot sink uses in catchswitches.</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We need to sink a callsite to a unique funclet.  Avoid sinking if the</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// phi use is too muddled.</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BlockColors.empty() &amp;&amp;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">            BlockColors.find(</span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(BB))-&gt;second.size() != 1)</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopNestMode) &#123;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI) &amp;&amp; UI-&gt;<a href="/docs/api/classes/llvm/value/#a2e987c6af902aad6baa39bd5b7ef322c">hasOneUser</a>() &amp;&amp;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">               UI-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>() == 1) &#123;</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(UI))</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">          UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(UI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>());</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(UI)) &#123;</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFoldable) &#123;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">        FoldableInLoop = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427" lineLink="#a25f0b41add9507b8eafadfbc4a090d6c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a25f0b41add9507b8eafadfbc4a090d6c">cloneInstructionInExitBlock</a>(</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;ExitBlock, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU) &#123;</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;New;</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BlockColors = SafetyInfo-&gt;<a href="/docs/api/classes/llvm/loopsafetyinfo/#a59204639c099ab5d774e8f5cf929ed9d">getBlockColors</a>();</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Sinking call-sites need to be handled differently from other</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions.  The cloned call-site needs a funclet bundle operand</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// appropriate for its location in the CFG.</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BundleIdx = 0, BundleEnd = CI-&gt;getNumOperandBundles();</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">         BundleIdx != BundleEnd; ++BundleIdx) &#123;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/operandbundleuse">OperandBundleUse</a> Bundle = CI-&gt;getOperandBundleAt(BundleIdx);</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bundle.<a href="/docs/api/structs/llvm/operandbundleuse/#a6386ca6c50ec4ef5d9a0f13e7fe8f0c9">getTagID</a>() == <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca8997c6b0930e2c05209e95e7172c6cf3">LLVMContext::OB&#95;funclet</a>)</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">      OpBundles.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Bundle);</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BlockColors.empty()) &#123;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac16c24df0637600996c9c6081da170a2">ColorVector</a> &amp;CV = BlockColors.find(&amp;ExitBlock)-&gt;second;</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CV.<a href="/docs/api/classes/llvm/tinyptrvector/#aac784c7664f3f6b8076756c6fb0eed74">size</a>() == 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;non-unique color for exit block!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BBColor = CV.<a href="/docs/api/classes/llvm/tinyptrvector/#a3a26404d33061e8aaeab39c490181389">front</a>();</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> EHPad = BBColor-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EHPad-&gt;isEHPad())</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">        OpBundles.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(</span><span class="doxyHighlightStringLiteral">&quot;funclet&quot;</span><span class="doxyHighlight">, &amp;&#42;EHPad);</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">    New = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(CI, OpBundles);</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">    New-&gt;copyMetadata(&#42;CI);</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">    New = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.clone();</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">  New-&gt;insertInto(&amp;ExitBlock, ExitBlock.<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getName().empty())</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">    New-&gt;setName(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getName() + </span><span class="doxyHighlightStringLiteral">&quot;.le&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ab15de610fca1c900038bf3c333919e45">getMemoryAccess</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a new MemoryAccess and let MemorySSA set its defining access.</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// After running some passes, MemorySSA might be outdated, and the</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction &#96;I&#96; may have become a non-memory touching instruction.</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;NewMemAcc = MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#ab23ba05c48e8be4a29c36d83deba9146">createMemoryAccessInBB</a>(</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">        New, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, New-&gt;getParent(), <a href="/docs/api/classes/llvm/memoryssa/#a9773fde54683945b9e34a0f2e5c1a5a5ad02ebd2ab52855a8e9fb8082c9530085">MemorySSA::Beginning</a>,</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;CreationMustSucceed=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewMemAcc) &#123;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MemDef = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemoryDef&gt;</a>(NewMemAcc))</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">        MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a21fc5eae685ef3e2dce4403a75d5ff2f">insertDef</a>(MemDef, </span><span class="doxyHighlightComment">/&#42;RenameUses=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MemUse = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryUse&gt;</a>(NewMemAcc);</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">        MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a9ab9d33dbeb44b5ba49ab27201e6bd76">insertUse</a>(MemUse, </span><span class="doxyHighlightComment">/&#42;RenameUses=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build LCSSA PHI nodes for any in-loop operands (if legal).  Note that</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this is particularly cheap because we can rip off the PHI node that we&#39;re</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replacing for the number and blocks of the predecessors.</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OPT: If this shows up in a profile, we can instead finish sinking all</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// invariant instructions, and then walk their operands to re-establish</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LCSSA. That will eliminate creating PHI nodes just to nuke them when</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sinking bottom-up.</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : New-&gt;operands())</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loopinfo/#a3aec1235e89c8e7a3d6f60ba97071b65">wouldBeOutOfLoopUseRequiringLCSSA</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.get(), PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())) &#123;</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.get());</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OpPN =</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(OInst-&gt;getType(), PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">                          OInst-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.lcssa&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">      OpPN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(ExitBlock.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i)</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">        OpPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(OInst, PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i));</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = OpPN;</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> New;</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504" lineLink="#ab0cfc793d55940eac67854827dd365e9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU) &#123;</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">  MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#abcf78af37d56a9b72a49c65428210758">removeMemoryAccess</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">  SafetyInfo.<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#aac2d5ff012ca10eb45c8b8cbca188dd6">removeInstruction</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.eraseFromParent();</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511" lineLink="#a22d7cc599c50e811dff1546c5ccb8794"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a22d7cc599c50e811dff1546c5ccb8794">moveInstructionBefore</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Dest,</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU,</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE) &#123;</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">  SafetyInfo.<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#aac2d5ff012ca10eb45c8b8cbca188dd6">removeInstruction</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  SafetyInfo.<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#acaf635590a74bf4fdc2822b6f877afb7">insertInstructionTo</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Dest-&gt;getParent());</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.moveBefore(&#42;Dest-&gt;getParent(), Dest);</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/memoryuseordef">MemoryUseOrDef</a> &#42;OldMemAcc = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;MemoryUseOrDef&gt;</a>(</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">          MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ab15de610fca1c900038bf3c333919e45">getMemoryAccess</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">    MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#ae26e0fb4a78dc439a03ac42c4ba6e674">moveToPlace</a>(OldMemAcc, Dest-&gt;getParent(),</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/memoryssa/#a9773fde54683945b9e34a0f2e5c1a5a5a7806c120eb87aea9fbb52fed327e09de">MemorySSA::BeforeTerminator</a>);</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE)</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a830ba09d5969cd66878b05c17fdf66b6">forgetBlockAndLoopDispositions</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526" lineLink="#a9a7faaf4dae6e940d419a57c39cd5d98"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a9a7faaf4dae6e940d419a57c39cd5d98">sinkThroughTriviallyReplaceablePHI</a>(</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;TPN, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, Instruction &#42;, 32&gt;</a> &amp;SunkCopies,</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU) &#123;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#ad0eaec807c54661058d9a1aed11195d9">isTriviallyReplaceablePHI</a>(&#42;TPN, &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expect only trivially replaceable PHI&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBlock = TPN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;New;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = SunkCopies.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(ExitBlock);</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It != SunkCopies.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">    New = It-&gt;second;</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">    New = SunkCopies&#91;ExitBlock&#93; = <a href="#a25f0b41add9507b8eafadfbc4a090d6c">cloneInstructionInExitBlock</a>(</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">        &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#42;ExitBlock, &#42;TPN, LI, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> New;</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544" lineLink="#a425e6fe374356efd05a49cab7e020166"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a425e6fe374356efd05a49cab7e020166">canSplitPredecessors</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo) &#123;</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#acf79d516b188e20e18034e5bbfcf6c69">canSplitPredecessors</a>())</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s not impossible to split EHPad blocks, but if BlockColors already exist</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it require updating BlockColors for all offspring blocks accordingly. By</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// skipping such corner case, we can make updating BlockColors after splitting</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor fairly simple.</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SafetyInfo-&gt;<a href="/docs/api/classes/llvm/loopsafetyinfo/#a59204639c099ab5d774e8f5cf929ed9d">getBlockColors</a>().<a href="/docs/api/classes/llvm/densemapbase/#a49c487a9395a6c384be8544cfb2cfccf">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>()-&gt;isEHPad())</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BBPred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(BBPred-&gt;getTerminator()))</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562" lineLink="#a0bb855d418108ea53140e71d7b35a2cd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a0bb855d418108ea53140e71d7b35a2cd">splitPredecessorsOfLoopExit</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42;MSSAU) &#123;</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> ExitBlocks;</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">  CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ae069a12f0a2d2deb69e30b439a91190e">getUniqueExitBlocks</a>(ExitBlocks);</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> ExitBlockSet(ExitBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">                                             ExitBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitBlockSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(ExitBB) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expect the PHI is in an exit block.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Split predecessors of the loop exit to make instructions in the loop are</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exposed to exit blocks through trivially replaceable PHIs while keeping the</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop in the canonical form where each predecessor of each exit block should</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be contained within the loop. For example, this will convert the loop below</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LB1:</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %v1 =</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br %LE, %LB2</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LB2:</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %v2 =</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br %LE, %LB1</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LE:</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %p = phi &#91;%v1, %LB1&#93;, &#91;%v2, %LB2&#93; &lt;-- non-trivially replaceable</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LB1:</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %v1 =</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br %LE.split, %LB2</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LB2:</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %v2 =</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br %LE.split2, %LB1</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LE.split:</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %p1 = phi &#91;%v1, %LB1&#93;  &lt;-- trivially replaceable</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br %LE</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LE.split2:</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %p2 = phi &#91;%v2, %LB2&#93;  &lt;-- trivially replaceable</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br %LE</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LE:</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %p = phi &#91;%p1, %LE.split&#93;, &#91;%p2, %LE.split2&#93;</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BlockColors = SafetyInfo-&gt;<a href="/docs/api/classes/llvm/loopsafetyinfo/#a59204639c099ab5d774e8f5cf929ed9d">getBlockColors</a>();</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 8&gt;</a> PredBBs(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(ExitBB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(ExitBB));</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> DTU(DT, DomTreeUpdater::UpdateStrategy::Lazy);</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!PredBBs.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>()) &#123;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = &#42;PredBBs.<a href="/docs/api/classes/llvm/setvector/#ad0bf95396cec46a41371341460d14a1c">begin</a>();</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(PredBB) &amp;&amp;</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expect all predecessors are in the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ae9562b96f6f3fa41bd36538c080035ee">getBasicBlockIndex</a>(PredBB) &gt;= 0) &#123;</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewPred = <a href="/docs/api/namespaces/llvm/#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">          ExitBB, PredBB, </span><span class="doxyHighlightStringLiteral">&quot;.split.loop.exit&quot;</span><span class="doxyHighlight">, &amp;DTU, LI, MSSAU, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Since we do not allow splitting EH-block with BlockColors in</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// canSplitPredecessors(), we can simply assign predecessor&#39;s color to</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the new block.</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BlockColors.empty())</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Grab a reference to the ColorVector to be inserted before getting the</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// reference to the vector we are copying because inserting the new</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// element in BlockColors might cause the map to be reallocated.</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">        SafetyInfo-&gt;<a href="/docs/api/classes/llvm/loopsafetyinfo/#a0df7330d9f0c855c85a81c0fcf8844a7">copyColors</a>(NewPred, PredBB);</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">    PredBBs.<a href="/docs/api/classes/llvm/setvector/#a0ddd27a8bb9aa02671ef487de0c6f5ca">remove</a>(PredBB);</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlightComment">/// When an instruction is found to only be used outside of the loop, this</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlightComment">/// function moves it to the exit blocks and patches up SSA form as needed.</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlightComment">/// This method is guaranteed to remove the original instruction from its</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlightComment">/// position, and may either delete it or move it to outside of the loop.</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635" lineLink="#a52b8b307321627e612e77041260ece84"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a52b8b307321627e612e77041260ece84">sink</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM sinking instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over users to be ready for actual sinking. Replace users via</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unreachable blocks with undef and make all user PHIs trivially replaceable.</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> VisitedUsers;</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.user&#95;begin(), UE = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.user&#95;end(); UI != UE;) &#123;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI);</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;U = UI.getUse();</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">    ++UI;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VisitedUsers.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/classes/llvm/user">User</a>) || CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent())) &#123;</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">      U = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType());</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The user must be a PHI node.</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Surprisingly, instructions can be used outside of loops without any</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exits.  This can only happen in PHI nodes if the incoming block is</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unreachable.</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(U);</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(BB)) &#123;</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">      U = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType());</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">    VisitedUsers.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PN);</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ad0eaec807c54661058d9a1aed11195d9">isTriviallyReplaceablePHI</a>(&#42;PN, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a425e6fe374356efd05a49cab7e020166">canSplitPredecessors</a>(PN, SafetyInfo))</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Split predecessors of the PHI so that we can make users trivially</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// replaceable.</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">    <a href="#a0bb855d418108ea53140e71d7b35a2cd">splitPredecessorsOfLoopExit</a>(PN, DT, LI, CurLoop, SafetyInfo, &amp;MSSAU);</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Should rebuild the iterators, as they may be invalidated by</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// splitPredecessorsOfLoopExit().</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">    UI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.user&#95;begin();</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">    UE = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.user&#95;end();</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VisitedUsers.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>())</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;InstSunk&quot;</span><span class="doxyHighlight">, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;sinking &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Inst&quot;</span><span class="doxyHighlight">, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">    ++NumMovedLoads;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">    ++NumMovedCalls;</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  ++NumSunk;</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> ExitBlocks;</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">  CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ae069a12f0a2d2deb69e30b439a91190e">getUniqueExitBlocks</a>(ExitBlocks);</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> ExitBlockSet(ExitBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">                                             ExitBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clones of this instruction. Don&#39;t create more than one per exit block!</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, Instruction &#42;, 32&gt;</a> SunkCopies;</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this instruction is only used outside of the loop, then all users are</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI nodes in exit blocks due to LCSSA form. Just RAUW them with clones of</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the instruction.</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First check if I is worth sinking for all uses. Sink only when it is worth</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// across all uses.</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;User&#42;, 8&gt;</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.user&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.user&#95;end());</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI : <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>) &#123;</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(UI);</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitBlockSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;The LCSSA PHI is not in an exit block!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The PHI must be trivially replaceable.</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;New = <a href="#a9a7faaf4dae6e940d419a57c39cd5d98">sinkThroughTriviallyReplaceablePHI</a>(</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">        PN, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LI, SunkCopies, SafetyInfo, CurLoop, MSSAU);</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// As we sink the instruction out of the BB, drop its debug location.</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">    New-&gt;dropLocation();</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">    <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;PN, &#42;SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlightComment">/// When an instruction is found to only use loop invariant operands that</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlightComment">/// is safe to hoist, this instruction is called to do the dirty work.</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742" lineLink="#a3a3a3183a327e1186dbe900032390ec6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a3a3a3183a327e1186dbe900032390ec6">hoist</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dest, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE,</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM hoisting to &quot;</span><span class="doxyHighlight"> &lt;&lt; Dest-&gt;<a href="/docs/api/classes/llvm/value/#a391ffe96dd8c686b0d2620c7fb25f8a5">getNameOrAsOperand</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: &quot;</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">                    &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;Hoisted&quot;</span><span class="doxyHighlight">, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;hoisting &quot;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">                                                         &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Inst&quot;</span><span class="doxyHighlight">, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Metadata can be dependent on conditions we are hoisting above.</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Conservatively strip all metadata on the instruction unless we were</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// guaranteed to execute I if we entered the loop, in which case the metadata</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is valid in the loop preheader.</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Similarly, If I is a call and it is not guaranteed to execute in the loop,</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then moving to the preheader means we should strip attributes on the call</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that can cause UB since we may be hoisting above conditions that allowed</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inferring those attributes. They may not be valid at the preheader.</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.hasMetadataOtherThanDebugLoc() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The check on hasMetadataOtherThanDebugLoc is to prevent us from burning</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// time in isGuaranteedToExecute if we don&#39;t actually have anything to</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// drop.  It is a compile time optimization, not required for correctness.</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">      !SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#ab40701961745d6467fa8e23b1e451c12">isGuaranteedToExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DT, CurLoop))</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.dropUBImplyingAttrsAndMetadata();</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move the new node to the end of the phi list in the destination block.</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">    <a href="#a22d7cc599c50e811dff1546c5ccb8794">moveInstructionBefore</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Dest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>(), &#42;SafetyInfo, MSSAU, SE);</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move the new node to the destination block, before its terminator.</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">    <a href="#a22d7cc599c50e811dff1546c5ccb8794">moveInstructionBefore</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Dest-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), &#42;SafetyInfo,</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">                          MSSAU, SE);</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.updateLocationAfterHoist();</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">    ++NumMovedLoads;</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">    ++NumMovedCalls;</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">  ++NumHoisted;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlightComment">/// Only sink or hoist an instruction if it is not a trapping instruction,</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlightComment">/// or if the instruction is known not to trap when moved to the preheader.</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlightComment">/// or if it is a trapping instruction and is guaranteed to execute.</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788" lineLink="#ab63d5eb7a9919d4e5f2c8d614e9bda97"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab63d5eb7a9919d4e5f2c8d614e9bda97">isSafeToExecuteUnconditionally</a>(</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopsafetyinfo">LoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CtxI,</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowSpeculation) &#123;</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllowSpeculation &amp;&amp;</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(&amp;Inst, CtxI, AC, DT, TLI))</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> GuaranteedToExecute =</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">      SafetyInfo-&gt;<a href="/docs/api/classes/llvm/loopsafetyinfo/#ade3159656909189106a047b76935827b">isGuaranteedToExecute</a>(Inst, DT, CurLoop);</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GuaranteedToExecute) &#123;</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;Inst);</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI &amp;&amp; CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(LI-&gt;getPointerOperand()))</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">      ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">                   <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;LoadWithLoopInvariantAddressCondExecuted&quot;</span><span class="doxyHighlight">, LI)</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;failed to hoist load with loop-invariant address &quot;</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot;because load is conditionally executed&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> GuaranteedToExecute;</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a87b154d8853b7d1fa59b6ecf9b007820">LoopPromoter</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loadandstorepromoter/#a5a4040326a09f994f2b5481cf5c8da82">LoadAndStorePromoter</a> &#123;</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SomePtr; </span><span class="doxyHighlightComment">// Designated pointer to store to.</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;LoopExitBlocks;</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock::iterator&gt;</a> &amp;LoopInsertPts;</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MemoryAccess &#42;&gt;</a> &amp;MSSAInsertPts;</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/prediteratorcache">PredIteratorCache</a> &amp;PredCache;</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU;</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI;</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL;</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> Alignment;</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UnorderedAtomic;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> AATags;</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanInsertStoresInExitBlocks;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;const Instruction &#42;&gt;</a> Uses;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;re about to add a use of V in a loop exit block.  Insert an LCSSA phi</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (if legal) if doing so would add an out-of-loop use to an instruction</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// defined in-loop.</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;maybeInsertLCSSAPHI(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI.wouldBeOutOfLoopUseRequiringLCSSA(V, BB))</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to create an LCSSA PHI node for the incoming value and</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// store that.</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), PredCache.size(BB),</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">                                  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.lcssa&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : PredCache.get(BB))</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">      PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Pred);</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PN;</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a87b154d8853b7d1fa59b6ecf9b007820"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a87b154d8853b7d1fa59b6ecf9b007820">LoopPromoter</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;SP, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;const Instruction &#42;&gt;</a> Insts, <a href="/docs/api/classes/llvm/ssaupdater">SSAUpdater</a> &amp;S,</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;LEB,</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock::iterator&gt;</a> &amp;LIP,</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MemoryAccess &#42;&gt;</a> &amp;MSSAIP, <a href="/docs/api/classes/llvm/prediteratorcache">PredIteratorCache</a> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#ad4d247df65c12507f447383be37d7ccb">PIC</a>,</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;li, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> dl,</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">               <a href="/docs/api/structs/llvm/align">Align</a> Alignment, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UnorderedAtomic, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> &amp;AATags,</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanInsertStoresInExitBlocks)</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/loadandstorepromoter/#a5a4040326a09f994f2b5481cf5c8da82">LoadAndStorePromoter</a>(Insts, S), SomePtr(SP), LoopExitBlocks(LEB),</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">        LoopInsertPts(LIP), MSSAInsertPts(MSSAIP), PredCache(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#ad4d247df65c12507f447383be37d7ccb">PIC</a>), MSSAU(MSSAU),</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">        LI(li), DL(<a href="/docs/api/namespaces/std">std</a>::<a href="/docs/api/namespaces/llvm/#abfc9c7ecf70f66901e439f7c04ef3dbb">move</a>(dl)), Alignment(Alignment),</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">        UnorderedAtomic(UnorderedAtomic), AATags(AATags),</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">        SafetyInfo(SafetyInfo),</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">        CanInsertStoresInExitBlocks(CanInsertStoresInExitBlocks), Uses(Insts) &#123;&#125;</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#afdbe575a191d9f3b5b6cef8212745dc0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#afdbe575a191d9f3b5b6cef8212745dc0">insertStoresInLoopExitBlocks</a>() &#123;</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert stores after in the loop exit blocks.  Each exit block gets a</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// store of the live-out values that feed them.  Since we&#39;ve already told</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the SSA updater about the defs in the loop and the preheader</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// definition, it is all set and we can start using it.</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/diassignid">DIAssignID</a> &#42;NewID = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = LoopExitBlocks.size(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBlock = LoopExitBlocks&#91;i&#93;;</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;LiveInValue = <a href="/docs/api/classes/llvm/loadandstorepromoter/#adbfdd1721b153d96672de12d3ec06637">SSA</a>.GetValueInMiddleOfBlock(ExitBlock);</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">      LiveInValue = maybeInsertLCSSAPHI(LiveInValue, ExitBlock);</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = maybeInsertLCSSAPHI(SomePtr, ExitBlock);</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos = LoopInsertPts&#91;i&#93;;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;NewSI = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a>(LiveInValue, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, InsertPos);</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnorderedAtomic)</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">        NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#a731befae7b8a9a1a2efda559c5420a7f">setOrdering</a>(<a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603">AtomicOrdering::Unordered</a>);</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">      NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#a55195fa18cf783fe74de0cced1ca6eb3">setAlignment</a>(Alignment);</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">      NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(DL);</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Attach DIAssignID metadata to the new store, generating it on the</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// first loop iteration.</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (i == 0) &#123;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// NewSI will have its DIAssignID set here if there are any stores in</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Uses with a DIAssignID attachment. This merged ID will then be</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// attached to the other inserted stores (in the branch below).</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">        NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#a2711d3bc7c6c769a8f34c7fc3937169d">mergeDIAssignID</a>(Uses);</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">        NewID = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;DIAssignID&gt;</a>(</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">            NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;DIAssignID));</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Attach the DIAssignID (or nullptr) merged from Uses in the branch</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// above.</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">        NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;DIAssignID, NewID);</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">        NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(AATags);</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;MSSAInsertPoint = MSSAInsertPts&#91;i&#93;;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;NewMemAcc;</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MSSAInsertPoint) &#123;</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">        NewMemAcc = MSSAU.createMemoryAccessInBB(</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">            NewSI, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, NewSI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), <a href="/docs/api/classes/llvm/memoryssa/#a9773fde54683945b9e34a0f2e5c1a5a5ad02ebd2ab52855a8e9fb8082c9530085">MemorySSA::Beginning</a>);</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">        NewMemAcc =</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">            MSSAU.createMemoryAccessAfter(NewSI, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, MSSAInsertPoint);</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">      MSSAInsertPts&#91;i&#93; = NewMemAcc;</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">      MSSAU.insertDef(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryDef&gt;</a>(NewMemAcc), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: true for safety, false may still be correct.</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a95aa35a1229abad2bb7f82a2f67c1c02"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a95aa35a1229abad2bb7f82a2f67c1c02">doExtraRewritesBeforeFinalDeletion</a>()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanInsertStoresInExitBlocks)</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#afdbe575a191d9f3b5b6cef8212745dc0">insertStoresInLoopExitBlocks</a>();</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a6b1d3696c0772db659b58dce95a071ae"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a6b1d3696c0772db659b58dce95a071ae">instructionDeleted</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">    SafetyInfo.removeInstruction(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">    MSSAU.removeMemoryAccess(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924" lineLink="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a8e5569c31c2e0231627eb9948dd4c2ae"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-licm-cpp-/looppromoter/#a8e5569c31c2e0231627eb9948dd4c2ae">shouldDelete</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CanInsertStoresInExitBlocks;</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931" lineLink="/docs/api/namespaces/anonymous-licm-cpp-/#aa306df5a74eb7312a0f3b922e4b3796d"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-licm-cpp-/#aa306df5a74eb7312a0f3b922e4b3796d">isNotCapturedBeforeOrInLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can perform the captured-before check against any instruction in the</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop header, as the loop header is reachable from any instruction inside</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop.</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: ReturnCaptures=true shouldn&#39;t be necessary here.</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#a3693cec8e936224ad3e5748debe73b75">PointerMayBeCapturedBefore</a>(V, </span><span class="doxyHighlightComment">/&#42; ReturnCaptures &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">                                     </span><span class="doxyHighlightComment">/&#42; StoreCaptures &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">                                     L-&gt;getHeader()-&gt;getTerminator(), DT);</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlightComment">/// Return true if we can prove that a caller cannot inspect the object if an</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlightComment">/// unwind occurs inside the loop.</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944" lineLink="/docs/api/namespaces/anonymous-licm-cpp-/#a7289f9dee74d88bffcc0e08a8252fc04"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-licm-cpp-/#a7289f9dee74d88bffcc0e08a8252fc04">isNotVisibleOnUnwindInLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Object, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RequiresNoCaptureBeforeUnwind;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a894b02a1122caccc0ed5eb9b321d22bb">isNotVisibleOnUnwind</a>(Object, RequiresNoCaptureBeforeUnwind))</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !RequiresNoCaptureBeforeUnwind ||</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">         <a href="/docs/api/namespaces/anonymous-licm-cpp-/#aa306df5a74eb7312a0f3b922e4b3796d">isNotCapturedBeforeOrInLoop</a>(Object, L, DT);</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954" lineLink="/docs/api/namespaces/anonymous-licm-cpp-/#ae1633171bc9cece01819608c2d7d820d"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-licm-cpp-/#ae1633171bc9cece01819608c2d7d820d">isThreadLocalObject</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Object, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The object must be function-local to start with, and then not captured</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// before/in the loop.</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#abe71bc4610a9dc7aa3a6c6e0e28fc14a">isIdentifiedFunctionLocal</a>(Object) &amp;&amp;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">          <a href="/docs/api/namespaces/anonymous-licm-cpp-/#aa306df5a74eb7312a0f3b922e4b3796d">isNotCapturedBeforeOrInLoop</a>(Object, L, DT)) ||</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">         (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;isSingleThreaded() || <a href="#a06ee6708a8f92c5b0ba2220d8bb3aef9">SingleThread</a>);</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlightComment">/// Try to promote memory values to scalars by sinking stores out of the</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlightComment">/// loop and moving loads to before the loop.  We do this by looping over</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlightComment">/// the stores in the loop, looking for stores to Must pointers which are</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlightComment">/// loop invariant.</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970" lineLink="/docs/api/namespaces/llvm/#ae8cc923f4e20540201f1cd1225811b9f"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ae8cc923f4e20540201f1cd1225811b9f">llvm::promoteLoopAccessesToScalars</a>(</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Value &#42;, 8&gt;</a> &amp;PointerMustAliases,</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;ExitBlocks,</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock::iterator&gt;</a> &amp;InsertPts,</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MemoryAccess &#42;&gt;</a> &amp;MSSAInsertPts, <a href="/docs/api/classes/llvm/prediteratorcache">PredIteratorCache</a> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#ad4d247df65c12507f447383be37d7ccb">PIC</a>,</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &#42;SafetyInfo,</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowSpeculation,</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasReadsOutsideSet) &#123;</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verify inputs.</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; DT != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; CurLoop != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">         SafetyInfo != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp;</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected Input to promoteLoopAccessesToScalars&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Trying to promote set of must-aliased pointers:\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> : PointerMustAliases)</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">  ++NumPromotionCandidates;</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SomePtr = &#42;PointerMustAliases.<a href="/docs/api/classes/llvm/setvector/#ad0bf95396cec46a41371341460d14a1c">begin</a>();</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is not safe to promote a load/store from the loop if the load/store is</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conditional.  For example, turning:</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    for () &#123; if (c) &#42;P += 1; &#125;</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into:</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    tmp = &#42;P;  for () &#123; if (c) tmp +=1; &#125; &#42;P = tmp;</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is not safe, because &#42;P may only be valid to access if &#39;c&#39; is true.</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The safety property divides into two parts:</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// p1) The memory may not be dereferenceable on entry to the loop.  In this</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    case, we can&#39;t insert the required load in the preheader.</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// p2) The memory model does not allow us to insert a store along any dynamic</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    path which did not originally have one.</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If at least one store is guaranteed to execute, both properties are</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// satisfied, and promotion is legal.</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This, however, is not a necessary condition. Even if no store/load is</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// guaranteed to execute, we can still establish these properties.</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can establish (p1) by proving that hoisting the load into the preheader</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is safe (i.e. proving dereferenceability on all paths through the loop). We</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can use any access within the alias set to prove dereferenceability,</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// since they&#39;re all must alias.</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There are two ways establish (p2):</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a) Prove the location is thread-local. In this case the memory model</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// requirement does not apply, and stores are safe to insert.</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// b) Prove a store dominates every exit block. In this case, if an exit</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks is reached, the original dynamic path would have taken us through</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the store, so inserting a store into the exit block is safe. Note that this</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is different from the store being guaranteed to execute. For instance,</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if an exception is thrown on the first iteration of the loop, the original</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store is never executed, but the exit blocks are not executed either.</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DereferenceableInPH = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> StoreIsGuanteedToExecute = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoadIsGuaranteedToExecute = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoundLoadToPromote = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Goes from Unknown to either Safe or Unsafe, but can&#39;t switch between them.</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">    StoreSafe,</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">    StoreUnsafe,</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">    StoreSafetyUnknown,</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">  &#125; StoreSafety = StoreSafetyUnknown;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 64&gt;</a> LoopUses;</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We start with an alignment of one and try to find instructions that allow</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// us to prove better alignment.</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> Alignment;</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track of which types of access we see</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SawUnorderedAtomic = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SawNotAtomic = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> AATags;</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;MDL = Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are reads outside the promoted set, then promoting stores is</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// definitely not safe.</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasReadsOutsideSet)</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">    StoreSafety = StoreUnsafe;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSafety == StoreSafetyUnknown &amp;&amp; SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#ac037c7db5068a141e231cab8b2daeef2">anyBlockMayThrow</a>()) &#123;</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If a loop can throw, we have to insert a store along each unwind edge.</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// That said, we can&#39;t actually make the unwind edge explicit. Therefore,</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we have to prove that the store is dead along the unwind edge.  We do</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this by proving that the caller can&#39;t have a reference to the object</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// after return and thus can&#39;t possibly load from the object.</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Object = <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(SomePtr);</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isNotVisibleOnUnwindInLoop(Object, CurLoop, DT))</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">      StoreSafety = StoreUnsafe;</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that all accesses to pointers in the alias set use the same type.</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We cannot (yet) promote a memory location that is loaded and stored in</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// different sizes.  While we are at it, collect alignment and AA info.</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;ASIV : PointerMustAliases) &#123;</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : ASIV-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ignore instructions that are outside the loop.</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UI || !CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(UI))</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If there is an non-load/store instruction in the loop, we can&#39;t promote</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it.</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(UI)) &#123;</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Load-&gt;isUnordered())</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">        SawUnorderedAtomic |= Load-&gt;isAtomic();</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">        SawNotAtomic |= !Load-&gt;isAtomic();</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">        FoundLoadToPromote = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/align">Align</a> InstAlignment = Load-&gt;getAlign();</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadIsGuaranteedToExecute)</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">          LoadIsGuaranteedToExecute =</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">              SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#ab40701961745d6467fa8e23b1e451c12">isGuaranteedToExecute</a>(&#42;UI, DT, CurLoop);</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Note that proving a load safe to speculate requires proving</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// sufficient alignment at the target location.  Proving it guaranteed</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to execute does as well.  Thus we can increase our guaranteed</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// alignment as well.</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DereferenceableInPH || (InstAlignment &gt; Alignment))</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab63d5eb7a9919d4e5f2c8d614e9bda97">isSafeToExecuteUnconditionally</a>(</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">                  &#42;Load, DT, TLI, CurLoop, SafetyInfo, ORE,</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">                  Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), AC, AllowSpeculation)) &#123;</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">            DereferenceableInPH = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">            Alignment = std::max(Alignment, InstAlignment);</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(UI)) &#123;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Stores &#42;of&#42; the pointer are not interesting, only stores &#42;to&#42; the</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// pointer.</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (U.getOperandNo() != <a href="/docs/api/classes/llvm/storeinst/#add13b402166ae4d70f5b93c3c4cfba99">StoreInst::getPointerOperandIndex</a>())</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Store-&gt;isUnordered())</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">        SawUnorderedAtomic |= Store-&gt;isAtomic();</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">        SawNotAtomic |= !Store-&gt;isAtomic();</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the store is guaranteed to execute, both properties are satisfied.</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We may want to check if a store is guaranteed to execute even if we</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// already know that promotion is safe, since it may have higher</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// alignment than any other guaranteed stores, in which case we can</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// raise the alignment on the promoted store.</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/align">Align</a> InstAlignment = Store-&gt;getAlign();</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> GuaranteedToExecute =</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">            SafetyInfo-&gt;<a href="/docs/api/classes/llvm/icfloopsafetyinfo/#ab40701961745d6467fa8e23b1e451c12">isGuaranteedToExecute</a>(&#42;UI, DT, CurLoop);</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">        StoreIsGuanteedToExecute |= GuaranteedToExecute;</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GuaranteedToExecute) &#123;</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">          DereferenceableInPH = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSafety == StoreSafetyUnknown)</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">            StoreSafety = StoreSafe;</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">          Alignment = std::max(Alignment, InstAlignment);</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If a store dominates all exit blocks, it is safe to sink.</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// As explained above, if an exit block was executed, a dominating</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// store must have been executed at least once, so we are not</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// introducing stores on paths that did not have them.</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Note that this only looks at explicit exit blocks. If we ever</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// start sinking stores into unwind edges (see above), this will break.</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSafety == StoreSafetyUnknown &amp;&amp;</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(ExitBlocks, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Exit) &#123;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(Store-&gt;getParent(), Exit);</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">            &#125;))</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">          StoreSafety = StoreSafe;</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the store is not guaranteed to execute, we may still get</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// deref info through it.</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DereferenceableInPH) &#123;</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">          DereferenceableInPH = <a href="/docs/api/namespaces/llvm/#a2da012cb3e5534bbee33563d309bc354">isDereferenceableAndAlignedPointer</a>(</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">              Store-&gt;getPointerOperand(), Store-&gt;getValueOperand()-&gt;getType(),</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">              Store-&gt;getAlign(), MDL, Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), AC, DT, TLI);</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Not a load or store.</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AccessTy)</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">        AccessTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(UI);</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AccessTy != <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(UI))</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Merge the AA tags.</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopUses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// On the first load/store, just take its AA tags.</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">        AATags = UI-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags) &#123;</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">        AATags = AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a6b173e97523275314f3f2b433a5f71a9">merge</a>(UI-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>());</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">      LoopUses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(UI);</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we found both an unordered atomic instruction and a non-atomic memory</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// access, bail.  We can&#39;t blindly promote non-atomic to atomic since we</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// might not be able to lower the result.  We can&#39;t downgrade since that</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would violate memory model.  Also, align 0 is an error for atomics.</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SawUnorderedAtomic &amp;&amp; SawNotAtomic)</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;re inserting an atomic load in the preheader, we must be able to</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lower it.  We&#39;re only guaranteed to be able to lower naturally aligned</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// atomics.</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SawUnorderedAtomic &amp;&amp; Alignment &lt; MDL.<a href="/docs/api/classes/llvm/datalayout/#acfcd22eb38dbfe1acbf138754297437a">getTypeStoreSize</a>(AccessTy))</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we couldn&#39;t prove we can hoist the load, bail.</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DereferenceableInPH) &#123;</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Not promoting: Not dereferenceable in preheader\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know we can hoist the load, but don&#39;t have a guaranteed store.</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check whether the location is writable and thread-local. If it is, then we</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can insert stores along paths which originally didn&#39;t have them without</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// violating the memory model.</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSafety == StoreSafetyUnknown) &#123;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Object = <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(SomePtr);</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ExplicitlyDereferenceableOnly;</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#af8127f6185ab47ac50a4ad6127d0c77f">isWritableObject</a>(Object, ExplicitlyDereferenceableOnly) &amp;&amp;</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">        (!ExplicitlyDereferenceableOnly ||</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#abf1028e2af158aae1e00d3288ca013bb">isDereferenceablePointer</a>(SomePtr, AccessTy, MDL)) &amp;&amp;</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">        isThreadLocalObject(Object, CurLoop, DT, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">      StoreSafety = StoreSafe;</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;ve still failed to prove we can sink the store, hoist the load</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only, if possible.</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSafety != StoreSafe &amp;&amp; !FoundLoadToPromote)</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we cannot hoist the load either, give up.</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lets do the promotion!</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSafety == StoreSafe) &#123;</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM: Promoting load/store of the value: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SomePtr</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">    ++NumLoadStorePromoted;</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LICM: Promoting load of the value: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SomePtr</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">    ++NumLoadPromoted;</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;PromoteLoopAccessesToScalar&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">                              LoopUses&#91;0&#93;)</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Moving accesses to memory location out of the loop&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look at all the loop uses, and try to merge their locations.</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">  std::vector&lt;DILocation &#42;&gt; LoopUsesLocs;</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : LoopUses)</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">    LoopUsesLocs.push&#95;back(U-&gt;getDebugLoc().get());</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>(<a href="/docs/api/classes/llvm/dilocation/#a30a7ce961d5d90ff2fb6c9cee4576e5a">DILocation::getMergedLocations</a>(LoopUsesLocs));</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We use the SSAUpdater interface to insert phi nodes as required.</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 16&gt;</a> NewPHIs;</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/ssaupdater">SSAUpdater</a> <a href="/docs/api/files/lib/lib/analysis/memoryssa-cpp/#a20a60bdac22b099d87d8cb0c1d554120">SSA</a>(&amp;NewPHIs);</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">  LoopPromoter Promoter(SomePtr, LoopUses, <a href="/docs/api/files/lib/lib/analysis/memoryssa-cpp/#a20a60bdac22b099d87d8cb0c1d554120">SSA</a>, ExitBlocks, InsertPts,</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">                        MSSAInsertPts, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#ad4d247df65c12507f447383be37d7ccb">PIC</a>, MSSAU, &#42;LI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Alignment,</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">                        SawUnorderedAtomic,</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">                        StoreIsGuanteedToExecute ? AATags : <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a>(),</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">                        &#42;SafetyInfo, StoreSafety == StoreSafe);</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set up the preheader to have a definition of the value.  It is the live-out</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value from the preheader that uses in the loop will use.</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;PreheaderLoad = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FoundLoadToPromote || !StoreIsGuanteedToExecute) &#123;</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">    PreheaderLoad =</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a>(AccessTy, SomePtr, SomePtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.promoted&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">                     Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SawUnorderedAtomic)</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">      PreheaderLoad-&gt;<a href="/docs/api/classes/llvm/loadinst/#a46adba111f7580ebfbb869a008de1818">setOrdering</a>(<a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603">AtomicOrdering::Unordered</a>);</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">    PreheaderLoad-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2b1268b642e9bf4373b6fb31c482c9ca">setAlignment</a>(Alignment);</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">    PreheaderLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags &amp;&amp; LoadIsGuaranteedToExecute)</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">      PreheaderLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(AATags);</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;PreheaderLoadMemoryAccess = MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#ab23ba05c48e8be4a29c36d83deba9146">createMemoryAccessInBB</a>(</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">        PreheaderLoad, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, PreheaderLoad-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), <a href="/docs/api/classes/llvm/memoryssa/#a9773fde54683945b9e34a0f2e5c1a5a5a542e7b754a1b868794fa2f47256a1d97">MemorySSA::End</a>);</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &#42;NewMemUse = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryUse&gt;</a>(PreheaderLoadMemoryAccess);</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">    MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a9ab9d33dbeb44b5ba49ab27201e6bd76">insertUse</a>(NewMemUse, </span><span class="doxyHighlightComment">/&#42;RenameUses=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/memoryssa-cpp/#a20a60bdac22b099d87d8cb0c1d554120">SSA</a>.AddAvailableValue(Preheader, PreheaderLoad);</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/memoryssa-cpp/#a20a60bdac22b099d87d8cb0c1d554120">SSA</a>.AddAvailableValue(Preheader, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(AccessTy));</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a>)</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">    MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a88b10d37f671e58cf138ac84a8257c17">verifyMemorySSA</a>();</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rewrite all the loads in the loop and remember all the definitions from</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores in the loop.</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">  Promoter.run(LoopUses);</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a>)</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">    MSSAU.<a href="/docs/api/classes/llvm/memoryssaupdater/#a01a350909e784d6fa43181a72de61529">getMemorySSA</a>()-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a88b10d37f671e58cf138ac84a8257c17">verifyMemorySSA</a>();</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the SSAUpdater didn&#39;t use the load in the preheader, just zap it now.</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreheaderLoad &amp;&amp; PreheaderLoad-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">    <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;PreheaderLoad, &#42;SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285" lineLink="#a8046d863469d9c33287fa4a673d00571"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8046d863469d9c33287fa4a673d00571">foreachMemoryAccess</a>(<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;)&gt; Fn) &#123;</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : L-&gt;blocks())</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Accesses = MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a183ce8029c259d7f9edacadcc7448f06">getBlockAccesses</a>(BB))</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/directx/dxilresourceaccess-cpp/#adb4fa2b9065093d32736f78ea43a8c8a">Access</a> : &#42;Accesses)</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MUD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemoryUseOrDef&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/directx/dxilresourceaccess-cpp/#adb4fa2b9065093d32736f78ea43a8c8a">Access</a>))</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">          Fn(MUD-&gt;getMemoryInst());</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlightComment">// The bool indicates whether there might be reads outside the set, in which</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlightComment">// case only loads may be promoted.</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PointersAndHasReadsOutsideSet, 0&gt;</a></span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297" lineLink="#a37ddbdd8cb4efa5072282498fdc1ac65"><span class="doxyHighlight"><a href="#a37ddbdd8cb4efa5072282498fdc1ac65">collectPromotionCandidates</a>(<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA, <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/batchaaresults">BatchAAResults</a> BatchAA(&#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>);</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/aliassettracker">AliasSetTracker</a> AST(BatchAA);</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsPotentiallyPromotable = &#91;L&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> L-&gt;isLoopInvariant(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> L-&gt;isLoopInvariant(LI-&gt;getPointerOperand());</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate AST with potentially promotable accesses.</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 16&gt;</a> AttemptingPromotion;</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">  <a href="#a8046d863469d9c33287fa4a673d00571">foreachMemoryAccess</a>(MSSA, L, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsPotentiallyPromotable(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">      AttemptingPromotion.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">      AST.<a href="/docs/api/classes/llvm/aliassettracker/#aacb988af7b411325fc0f2cf38461d2b1">add</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;re only interested in must-alias sets that contain a mod.</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PointerIntPair&lt;const AliasSet &#42;, 1, bool&gt;</a>, 8&gt; Sets;</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/aliasset">AliasSet</a> &amp;AS : AST)</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AS.isForwardingAliasSet() &amp;&amp; AS.isMod() &amp;&amp; AS.isMustAlias())</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">      Sets.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;&amp;AS, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Sets.empty())</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#125;; </span><span class="doxyHighlightComment">// Nothing to promote...</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Discard any sets for which there is an aliasing non-promotable access.</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">  <a href="#a8046d863469d9c33287fa4a673d00571">foreachMemoryAccess</a>(MSSA, L, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AttemptingPromotion.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(Sets, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/pointerintpair">PointerIntPair&lt;const AliasSet &#42;, 1, bool&gt;</a> &amp;Pair) &#123;</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2e">ModRefInfo</a> MR = Pair.<a href="/docs/api/classes/llvm/pointerintpair/#ac8b55437ca130fe0c826e94e669e5d99">getPointer</a>()-&gt;aliasesUnknownInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BatchAA);</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Cannot promote if there are writes outside the set.</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a728f79528ca8659e15d00c1e6818b316">isModSet</a>(MR))</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#af7787f6b577cd7a63f043b87301b8e81">isRefSet</a>(MR)) &#123;</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remember reads outside the set.</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlight">        Pair.<a href="/docs/api/classes/llvm/pointerintpair/#a60c0e4f0ed13c971edabd76dceada467">setInt</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this is a mod-only set and there are reads outside the set,</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we will not be able to promote, so bail out early.</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Pair.<a href="/docs/api/classes/llvm/pointerintpair/#ac8b55437ca130fe0c826e94e669e5d99">getPointer</a>()-&gt;isRef();</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;SmallSetVector&lt;Value &#42;, 8&gt;</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">&gt;, 0&gt; Result;</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;Set, HasReadsOutsideSet&#93; : Sets) &#123;</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Value &#42;, 8&gt;</a> PointerMustAliases;</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MemLoc : &#42;Set)</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">      PointerMustAliases.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(</span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(MemLoc.Ptr));</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><span class="doxyHighlight">    Result.emplace&#95;back(std::move(PointerMustAliases), HasReadsOutsideSet);</span></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359" lineLink="#a28d9fc94843828b60459abd31b7e82c6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a28d9fc94843828b60459abd31b7e82c6">pointerInvalidatedByLoop</a>(<a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA, <a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &#42;MU,</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/sinkandhoistlicmflags">SinkAndHoistLICMFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvariantGroup) &#123;</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For hoisting, use the walker to determine safety</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Flags.getIsSink()) &#123;</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If hoisting an invariant group, we only need to check that there</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is no store to the loaded pointer between the start of the loop,</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and the load (since all values must be the same).</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This can be checked in two conditions:</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 1) if the memoryaccess is outside the loop</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 2) the earliest access is at the loop header,</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if the memory loaded is the phi node</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/batchaaresults">BatchAAResults</a> BAA(MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#a09b19c342a68cda17cb92c8fd9804cc4">getAA</a>());</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;Source = <a href="#a329ad21a549f7f43ad50b65f4d3ca487">getClobberingMemoryAccess</a>(&#42;MSSA, BAA, Flags, MU);</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !MSSA-&gt;<a href="/docs/api/classes/llvm/memoryssa/#ae3b89ffde42778289bcbd8a187199420">isLiveOnEntryDef</a>(Source) &amp;&amp;</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">           CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(Source-&gt;getBlock()) &amp;&amp;</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><span class="doxyHighlight">           !(InvariantGroup &amp;&amp; Source-&gt;getBlock() == CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;MemoryPhi&gt;</a>(Source));</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For sinking, we&#39;d need to check all Defs below this use. The getClobbering</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call will look on the backedge of the loop, but will check aliasing with</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the instructions on the previous iteration.</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For example:</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for (i ... )</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   load a&#91;i&#93; ( Use (LoE)</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   store a&#91;i&#93; ( 1 = Def (2), with 2 = Phi for the loop.</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   i++;</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The load sees no clobbering inside the loop, as the backedge alias check</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// does phi translation, and will check aliasing against store a&#91;i-1&#93;.</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// However sinking the load outside the loop, below the store is incorrect.</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For now, only sink if there are no Defs in the loop, and the existing ones</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// precede the use and are in the same block.</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Increase precision: Safe to sink if Use post dominates the Def;</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// needs PostDominatorTreeAnalysis.</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: More precise: no Defs that alias this Use.</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Flags.tooManyMemoryAccesses())</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac94e1f7398df9df2508957f58a82279a">getBlocks</a>())</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aed7e046ac6f7dd5ff0edb6e7b7a30e2e">pointerInvalidatedByBlock</a>(&#42;BB, &#42;MSSA, &#42;MU))</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When sinking, the source block may not be part of the loop so check it.</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aed7e046ac6f7dd5ff0edb6e7b7a30e2e">pointerInvalidatedByBlock</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent(), &#42;MSSA, &#42;MU);</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410" lineLink="#aed7e046ac6f7dd5ff0edb6e7b7a30e2e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aed7e046ac6f7dd5ff0edb6e7b7a30e2e">pointerInvalidatedByBlock</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &amp;MSSA, <a href="/docs/api/classes/llvm/memoryuse">MemoryUse</a> &amp;MU) &#123;</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Accesses = MSSA.<a href="/docs/api/classes/llvm/memoryssa/#ad586af665c013c65c83a31294555f996">getBlockDefs</a>(&amp;BB))</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MA : &#42;Accesses)</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemoryDef&gt;</a>(&amp;MA))</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MU.<a href="/docs/api/classes/llvm/memoryaccess/#a9a9c59da949d32a269725b6e254d426f">getBlock</a>() != MD-&gt;getBlock() || !MSSA.<a href="/docs/api/classes/llvm/memoryssa/#ade88aedcbd2b55711000cf3e36c0fc91">locallyDominates</a>(MD, &amp;MU))</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlightComment">/// Try to simplify things like (A &lt; INV&#95;1 AND icmp A &lt; INV&#95;2) into (A &lt;</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlightComment">/// min(INV&#95;1, INV&#95;2)), if INV&#95;1 and INV&#95;2 are both loop invariants and their</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlightComment">/// minimun can be computed outside of loop, and X is not a loop-invariant.</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422" lineLink="#a1f669cc640bda295e6c2e2b3c90babb9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a1f669cc640bda295e6c2e2b3c90babb9">hoistMinMax</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU) &#123;</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/inverse">Inverse</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cond1, &#42;Cond2;</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond2)))) &#123;</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/inverse">Inverse</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cond2)))) &#123;</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do nothing</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MatchICmpAgainstInvariant = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)))))</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getType()-&gt;isIntegerTy())</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/icmpinst/#ae955171baab3d9254f3ffb089c082206">ICmpInst::isRelational</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>))</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>)) &#123;</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">ICmpInst::getSwappedPredicate</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) || !L.isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/inverse">Inverse</a>)</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">ICmpInst::getInversePredicate</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> P1, P2;</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS1, &#42;LHS2, &#42;RHS1, &#42;RHS2;</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MatchICmpAgainstInvariant(Cond1, P1, LHS1, RHS1) ||</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">      !MatchICmpAgainstInvariant(Cond2, P2, LHS2, RHS2))</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MatchingPred = <a href="/docs/api/classes/llvm/cmppredicate/#a1c29fdc79aad7e92c7f850bbd0faa208">CmpPredicate::getMatching</a>(P1, P2);</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MatchingPred || LHS1 != LHS2)</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Everything is fine, we can do the transform.</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseMin = <a href="/docs/api/classes/llvm/icmpinst/#a5a5f1a2e8e2ab96bad265dfbddd41e09">ICmpInst::isLT</a>(&#42;MatchingPred) || <a href="/docs/api/classes/llvm/icmpinst/#afc5ae5e45df2c40564929779114e8afa">ICmpInst::isLE</a>(&#42;MatchingPred);</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">      (UseMin || <a href="/docs/api/classes/llvm/icmpinst/#a8295e869b64b0c77ba2c917eeb5f530d">ICmpInst::isGT</a>(&#42;MatchingPred) ||</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/icmpinst/#a4db9c79611d8a0a8cfad3e190b9206fc">ICmpInst::isGE</a>(&#42;MatchingPred)) &amp;&amp;</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Relational predicate is either less (or equal) or greater (or equal)!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> </span><span class="doxyHighlightKeywordType">id</span><span class="doxyHighlight"> = <a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">ICmpInst::isSigned</a>(&#42;MatchingPred)</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">                         ? (UseMin ? Intrinsic::smin : Intrinsic::smax)</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">                         : (UseMin ? Intrinsic::umin : Intrinsic::umax);</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Preheader = L.getLoopPreheader();</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop is not in simplify form?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are about to create a new guaranteed use for RHS2 which might not exist</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// before (if it was a non-taken input of logical and/or instruction). If it</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// was poison, we need to freeze it. Note that no new use for LHS and RHS1 are</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// introduced, so they don&#39;t need this.</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlight">    RHS2 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a563ec77bbc82ad22aab9621dd14c01cd">CreateFreeze</a>(RHS2, RHS2-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.fr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewRHS = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7e0a0c76340ba1fc52863f538f3e703d">CreateBinaryIntrinsic</a>(</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">id</span><span class="doxyHighlight">, RHS1, RHS2, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/stringref">StringRef</a>(</span><span class="doxyHighlightStringLiteral">&quot;invariant.&quot;</span><span class="doxyHighlight">) +</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">          (<a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">ICmpInst::isSigned</a>(&#42;MatchingPred) ? </span><span class="doxyHighlightStringLiteral">&quot;s&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;u&quot;</span><span class="doxyHighlight">) +</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">          (UseMin ? </span><span class="doxyHighlightStringLiteral">&quot;min&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;max&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = &#42;MatchingPred;</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/inverse">Inverse</a>)</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">ICmpInst::getInversePredicate</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCond = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, LHS1, NewRHS);</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">  NewCond-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.replaceAllUsesWith(NewCond);</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Cond1), SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Cond2), SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlightComment">/// Reassociate gep (gep ptr, idx1), idx2 to gep (gep ptr, idx2), idx1 if</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlightComment">/// this allows hoisting the inner GEP.</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499" lineLink="#a062c93def88f99e93047ba86970c4eab"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a062c93def88f99e93047ba86970c4eab">hoistGEP</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Src = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Src || !Src-&gt;hasOneUse() || !L.contains(Src))</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcPtr = Src-&gt;getPointerOperand();</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LoopInvariant = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> L.isLoopInvariant(V); &#125;;</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L.isLoopInvariant(SrcPtr) || !<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;indices(), LoopInvariant))</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This can only happen if !AllowSpeculation, otherwise this would already be</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// handled.</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Should we respect AllowSpeculation in these reassociation folds?</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The flag exists to prevent metadata dropping, which is not relevant here.</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Src-&gt;indices(), LoopInvariant))</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The swapped GEPs are inbounds if both original GEPs are inbounds</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the sign of the offsets is the same. For simplicity, only</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// handle both offsets being non-negative.</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getDataLayout();</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/correlatedvaluepropagation-cpp/#aad75d6f4f14a7b791076c6785aa59be4a16cb7fb563099bff249482f3a050bad8">NonNegative</a> = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(V, <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, DT, AC, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>));</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsInBounds = Src-&gt;isInBounds() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;isInBounds() &amp;&amp;</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Src-&gt;indices(), <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/correlatedvaluepropagation-cpp/#aad75d6f4f14a7b791076c6785aa59be4a16cb7fb563099bff249482f3a050bad8">NonNegative</a>) &amp;&amp;</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;indices(), <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/correlatedvaluepropagation-cpp/#aad75d6f4f14a7b791076c6785aa59be4a16cb7fb563099bff249482f3a050bad8">NonNegative</a>);</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = L.getLoopPreheader();</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewSrc = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType(), SrcPtr,</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;indices()),</span></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">                                    </span><span class="doxyHighlightStringLiteral">&quot;invariant.gep&quot;</span><span class="doxyHighlight">, IsInBounds);</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewGEP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(Src-&gt;getSourceElementType(), NewSrc,</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a>(Src-&gt;indices()), </span><span class="doxyHighlightStringLiteral">&quot;gep&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">                                    IsInBounds);</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;replaceAllUsesWith(NewGEP);</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;Src, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlightComment">/// Try to turn things like &quot;LV + C1 &lt; C2&quot; into &quot;LV &lt; C2 - C1&quot;. Here</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlightComment">/// C1 and C2 are loop invariants and LV is a loop-variant.</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550" lineLink="#a2f46552f3c07dc30e7acc64cdab53056"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a2f46552f3c07dc30e7acc64cdab53056">hoistAdd</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred, <a href="/docs/api/classes/llvm/value">Value</a> &#42;VariantLHS,</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;InvariantRHS, <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &amp;ICmp, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L,</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU,</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!L.isLoopInvariant(VariantLHS) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Precondition.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L.isLoopInvariant(InvariantRHS) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Precondition.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned = <a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">ICmpInst::isSigned</a>(Pred);</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to represent VariantLHS as sum of invariant and variant operands.</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VariantOp, &#42;InvariantOp;</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSigned &amp;&amp;</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VariantLHS, <a href="/docs/api/namespaces/llvm/patternmatch/#ab65bddcf2ef369ad6d5678882800a7da">m&#95;NSWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VariantOp), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(InvariantOp))))</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSigned &amp;&amp;</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VariantLHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a0c7ef38b3e115873246f1d5e491d80c3">m&#95;NUWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VariantOp), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(InvariantOp))))</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LHS itself is a loop-variant, try to represent it in the form:</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;VariantOp + InvariantOp&quot;. If it is possible, then we can reassociate.</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(VariantOp))</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(VariantOp, InvariantOp);</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(VariantOp) || !L.isLoopInvariant(InvariantOp))</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In order to turn &quot;LV + C1 &lt; C2&quot; into &quot;LV &lt; C2 - C1&quot;, we need to be able to</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// freely move values from left side of inequality to right side (just as in</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// normal linear arithmetics). Overflows make things much more complicated, so</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we want to avoid this.</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = L.getHeader()-&gt;getDataLayout();</span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> SQ(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, DT, AC, &amp;ICmp);</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSigned &amp;&amp; <a href="/docs/api/namespaces/llvm/#a6b72ea7b10ac690e8f1bcdf144c7e5d4">computeOverflowForSignedSub</a>(InvariantRHS, InvariantOp, SQ) !=</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/#a06c60fef11885eadbda4026c83ae9a13a56624a95592b438e05ab500a6a200a03">llvm::OverflowResult::NeverOverflows</a>)</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSigned &amp;&amp;</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#abfdf10a69ac9839f2ae92515b969b77e">computeOverflowForUnsignedSub</a>(InvariantRHS, InvariantOp, SQ) !=</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a06c60fef11885eadbda4026c83ae9a13a56624a95592b438e05ab500a6a200a03">llvm::OverflowResult::NeverOverflows</a>)</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Preheader = L.getLoopPreheader();</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop is not in simplify form?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCmpOp =</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(InvariantRHS, InvariantOp, </span><span class="doxyHighlightStringLiteral">&quot;invariant.op&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;HasNUW&#42;/</span><span class="doxyHighlight"> !IsSigned, </span><span class="doxyHighlightComment">/&#42;HasNSW&#42;/</span><span class="doxyHighlight"> IsSigned);</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><span class="doxyHighlight">  ICmp.<a href="/docs/api/classes/llvm/cmpinst/#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(Pred);</span></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">  ICmp.<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, VariantOp);</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">  ICmp.<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, NewCmpOp);</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;VariantLHS), SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlightComment">/// Try to reassociate and hoist the following two patterns:</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlightComment">/// LV - C1 &lt; C2 --&gt; LV &lt; C1 + C2,</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlightComment">/// C1 - LV &lt; C2 --&gt; LV &gt; C1 - C2.</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605" lineLink="#aabf61131f4fe5c83b4f3dccf4adb5e96"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aabf61131f4fe5c83b4f3dccf4adb5e96">hoistSub</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred, <a href="/docs/api/classes/llvm/value">Value</a> &#42;VariantLHS,</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;InvariantRHS, <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &amp;ICmp, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L,</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU,</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!L.isLoopInvariant(VariantLHS) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Precondition.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L.isLoopInvariant(InvariantRHS) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Precondition.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned = <a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">ICmpInst::isSigned</a>(Pred);</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to represent VariantLHS as sum of invariant and variant operands.</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VariantOp, &#42;InvariantOp;</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSigned &amp;&amp;</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VariantLHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a23c5e47e887d354a1e7a9db9cb48187c">m&#95;NSWSub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VariantOp), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(InvariantOp))))</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSigned &amp;&amp;</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VariantLHS, <a href="/docs/api/namespaces/llvm/patternmatch/#aa7ccc4b69ee025f62e15e1c6b0c468f0">m&#95;NUWSub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VariantOp), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(InvariantOp))))</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VariantSubtracted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LHS itself is a loop-variant, try to represent it in the form:</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;VariantOp + InvariantOp&quot;. If it is possible, then we can reassociate. If</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the variant operand goes with minus, we use a slightly different scheme.</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(VariantOp)) &#123;</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(VariantOp, InvariantOp);</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">    VariantSubtracted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">ICmpInst::getSwappedPredicate</a>(Pred);</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(VariantOp) || !L.isLoopInvariant(InvariantOp))</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In order to turn &quot;LV - C1 &lt; C2&quot; into &quot;LV &lt; C2 + C1&quot;, we need to be able to</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// freely move values from left side of inequality to right side (just as in</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// normal linear arithmetics). Overflows make things much more complicated, so</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we want to avoid this. Likewise, for &quot;C1 - LV &lt; C2&quot; we need to prove that</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;C1 - C2&quot; does not overflow.</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = L.getHeader()-&gt;getDataLayout();</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> SQ(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, DT, AC, &amp;ICmp);</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VariantSubtracted &amp;&amp; IsSigned) &#123;</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// C1 - LV &lt; C2 --&gt; LV &gt; C1 - C2</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a6b72ea7b10ac690e8f1bcdf144c7e5d4">computeOverflowForSignedSub</a>(InvariantOp, InvariantRHS, SQ) !=</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a06c60fef11885eadbda4026c83ae9a13a56624a95592b438e05ab500a6a200a03">llvm::OverflowResult::NeverOverflows</a>)</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VariantSubtracted &amp;&amp; !IsSigned) &#123;</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// C1 - LV &lt; C2 --&gt; LV &gt; C1 - C2</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#abfdf10a69ac9839f2ae92515b969b77e">computeOverflowForUnsignedSub</a>(InvariantOp, InvariantRHS, SQ) !=</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a06c60fef11885eadbda4026c83ae9a13a56624a95592b438e05ab500a6a200a03">llvm::OverflowResult::NeverOverflows</a>)</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VariantSubtracted &amp;&amp; IsSigned) &#123;</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// LV - C1 &lt; C2 --&gt; LV &lt; C1 + C2</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa7790033a75bbc8568fcf887ada7ae05">computeOverflowForSignedAdd</a>(InvariantOp, InvariantRHS, SQ) !=</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a06c60fef11885eadbda4026c83ae9a13a56624a95592b438e05ab500a6a200a03">llvm::OverflowResult::NeverOverflows</a>)</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123; </span><span class="doxyHighlightComment">// !VariantSubtracted &amp;&amp; !IsSigned</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// LV - C1 &lt; C2 --&gt; LV &lt; C1 + C2</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ad7fabe65a8d4b9b26a17c87317461c58">computeOverflowForUnsignedAdd</a>(InvariantOp, InvariantRHS, SQ) !=</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a06c60fef11885eadbda4026c83ae9a13a56624a95592b438e05ab500a6a200a03">llvm::OverflowResult::NeverOverflows</a>)</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Preheader = L.getLoopPreheader();</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop is not in simplify form?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCmpOp =</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">      VariantSubtracted</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">          ? Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(InvariantOp, InvariantRHS, </span><span class="doxyHighlightStringLiteral">&quot;invariant.op&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;HasNUW&#42;/</span><span class="doxyHighlight"> !IsSigned, </span><span class="doxyHighlightComment">/&#42;HasNSW&#42;/</span><span class="doxyHighlight"> IsSigned)</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">          : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(InvariantOp, InvariantRHS, </span><span class="doxyHighlightStringLiteral">&quot;invariant.op&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;HasNUW&#42;/</span><span class="doxyHighlight"> !IsSigned, </span><span class="doxyHighlightComment">/&#42;HasNSW&#42;/</span><span class="doxyHighlight"> IsSigned);</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">  ICmp.<a href="/docs/api/classes/llvm/cmpinst/#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(Pred);</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">  ICmp.<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, VariantOp);</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">  ICmp.<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, NewCmpOp);</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;VariantLHS), SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlightComment">/// Reassociate and hoist add/sub expressions.</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681" lineLink="#a66f8120f59f3970d1c0a554a8f7c3e2e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a66f8120f59f3970d1c0a554a8f7c3e2e">hoistAddSub</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>;</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))))</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Put variant operand to LHS position.</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>)) &#123;</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">ICmpInst::getSwappedPredicate</a>(Pred);</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to delete the initial operation after reassociation, so only do it</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if it has no other uses.</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) || !L.isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) || !<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We could go with smarter context, taking common dominator of all I&#39;s</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// users instead of I itself.</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a2f46552f3c07dc30e7acc64cdab53056">hoistAdd</a>(Pred, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), L, SafetyInfo, MSSAU, AC, DT))</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aabf61131f4fe5c83b4f3dccf4adb5e96">hoistSub</a>(Pred, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), L, SafetyInfo, MSSAU, AC, DT))</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711" lineLink="#a0504a04476327cd645600bb33f7862e9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a0504a04476327cd645600bb33f7862e9">isReassociableOp</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IntOpcode,</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FPOpcode) &#123;</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == IntOpcode)</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == FPOpcode &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasAllowReassoc() &amp;&amp;</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasNoSignedZeros())</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlightComment">/// Try to reassociate expressions like ((A1 &#42; B1) + (A2 &#42; B2) + ...) &#42; C where</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlightComment">/// A1, A2, ... and C are loop invariants into expressions like</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlightComment">/// ((A1 &#42; C &#42; B1) + (A2 &#42; C &#42; B2) + ...) and hoist the (A1 &#42; C), (A2 &#42; C), ...</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlightComment">/// invariant expressions. This functions returns true only if any hoisting has</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlightComment">/// actually occured.</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726" lineLink="#a697cde840957bbc0b2848a593c3e0d5a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a697cde840957bbc0b2848a593c3e0d5a">hoistMulAddAssociation</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L,</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a0504a04476327cd645600bb33f7862e9">isReassociableOp</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Instruction::Mul, Instruction::FMul))</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VariantOp = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0);</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InvariantOp = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(VariantOp))</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(VariantOp, InvariantOp);</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(VariantOp) || !L.isLoopInvariant(InvariantOp))</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Factor = InvariantOp;</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, we need to make sure we should do the transformation.</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Use &#42;&gt;</a> Changes;</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BinaryOperator &#42;&gt;</a> Adds;</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BinaryOperator &#42;&gt;</a> Worklist;</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;VariantBinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(VariantOp))</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VariantBinOp);</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BO-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a0504a04476327cd645600bb33f7862e9">isReassociableOp</a>(BO, Instruction::Add, Instruction::FAdd) &amp;&amp;</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)) &amp;&amp;</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))) &#123;</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)));</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)));</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">      Adds.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(BO);</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a0504a04476327cd645600bb33f7862e9">isReassociableOp</a>(BO, Instruction::Mul, Instruction::FMul) ||</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">        L.isLoopInvariant(BO))</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;U0 = BO-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(0);</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;U1 = BO-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(1);</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(U0))</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">      Changes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;U0);</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(U1))</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">      Changes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;U1);</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Limit = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isIntOrIntVectorTy()</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">                         ? <a href="#a73f55e27d558de45459e584ff664f468">IntAssociationUpperLimit</a></span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">                         : <a href="#a184889de0db5db92331f4b625b1d967e">FPAssociationUpperLimit</a>;</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Changes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; Limit)</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Changes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Drop the poison flags for any adds we looked through.</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isIntOrIntVectorTy()) &#123;</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a> : Adds)</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">Add</a>-&gt;dropPoisonGeneratingFlags();</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know we should do it so let&#39;s do the transformation.</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Preheader = L.getLoopPreheader();</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop is not in simplify form?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : Changes) &#123;</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L.isLoopInvariant(U-&gt;get()));</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ins = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U-&gt;getUser());</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a>;</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isIntOrIntVectorTy()) &#123;</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aecd40f9a16dc0ef1e0bc416599f89277">CreateMul</a>(U-&gt;get(), Factor, </span><span class="doxyHighlightStringLiteral">&quot;factor.op.mul&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Drop the poison flags on the original multiply.</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">      Ins-&gt;dropPoisonGeneratingFlags();</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aec0517c3f23ebbd05772964b3d4ab793">CreateFMulFMF</a>(U-&gt;get(), Factor, Ins, </span><span class="doxyHighlightStringLiteral">&quot;factor.op.fmul&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Rewrite the reassociable instruction.</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpIdx = U-&gt;getOperandNo();</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = OpIdx == 0 ? <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a> : Ins-&gt;getOperand(0);</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = OpIdx == 1 ? <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a> : Ins-&gt;getOperand(1);</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewBO =</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(Ins-&gt;getOpcode(), <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>,</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">                               Ins-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.reass&quot;</span><span class="doxyHighlight">, Ins-&gt;getIterator());</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">    NewBO-&gt;copyIRFlags(Ins);</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VariantOp == Ins)</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">      VariantOp = NewBO;</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">    Ins-&gt;replaceAllUsesWith(NewBO);</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlight">    <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;Ins, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.replaceAllUsesWith(VariantOp);</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlightComment">/// Reassociate associative binary expressions of the form</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlightComment">/// 1 &quot;(LV op C1) op C2&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlightComment">/// 2 &quot;(C1 op LV) op C2&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlightComment">/// 3 &quot;C2 op (C1 op LV)&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlightComment">/// 4 &quot;C2 op (LV op C1)&quot; ==&gt; &quot;LV op (C1 op C2)&quot;</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlightComment">/// where op is an associative BinOp, LV is a loop variant, and C1 and C2 are</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlightComment">/// loop invariants that we want to hoist, noting that associativity implies</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlightComment">/// commutativity.</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828" lineLink="#aebac730a26c607cea825366afca2d8b1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aebac730a26c607cea825366afca2d8b1">hoistBOAssociation</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L,</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BO || !BO-&gt;isAssociative())</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opcode = BO-&gt;getOpcode();</span></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LVInRHS = L.isLoopInvariant(BO-&gt;getOperand(0));</span></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BO0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(BO-&gt;getOperand(LVInRHS));</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BO0 || BO0-&gt;getOpcode() != Opcode || !BO0-&gt;isAssociative() ||</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">      BO0-&gt;hasNUsesOrMore(3))</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LV = BO0-&gt;getOperand(0);</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;C1 = BO0-&gt;getOperand(1);</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;C2 = BO-&gt;getOperand(!LVInRHS);</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BO-&gt;isCommutative() &amp;&amp; BO0-&gt;isCommutative() &amp;&amp;</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Associativity implies commutativity&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(LV) &amp;&amp; !L.isLoopInvariant(C1))</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(LV, C1);</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isLoopInvariant(LV) || !L.isLoopInvariant(C1) || !L.isLoopInvariant(C2))</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Preheader = L.getLoopPreheader();</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop is not in simplify form?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inv = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(Opcode, C1, C2, </span><span class="doxyHighlightStringLiteral">&quot;invariant.op&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewBO = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">      Opcode, LV, Inv, BO-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.reass&quot;</span><span class="doxyHighlight">, BO-&gt;getIterator());</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy NUW for ADDs if both instructions have it.</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opcode == Instruction::Add &amp;&amp; BO-&gt;hasNoUnsignedWrap() &amp;&amp;</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">      BO0-&gt;hasNoUnsignedWrap()) &#123;</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If &#96;Inv&#96; was not constant-folded, a new Instruction has been created.</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Inv))</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;setHasNoUnsignedWrap(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">    NewBO-&gt;setHasNoUnsignedWrap(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opcode == Instruction::FAdd || Opcode == Instruction::FMul) &#123;</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Intersect FMF flags for FADD and FMUL.</span></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/fastmathflags">FastMathFlags</a> Intersect = BO-&gt;getFastMathFlags() &amp; BO0-&gt;getFastMathFlags();</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Inv))</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;setFastMathFlags(Intersect);</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">    NewBO-&gt;setFastMathFlags(Intersect);</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">  BO-&gt;replaceAllUsesWith(NewBO);</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">  <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;BO, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (LV op C1) might not be erased if it has more uses than the one we just</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replaced.</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO0-&gt;use&#95;empty())</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">    <a href="#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&#42;BO0, SafetyInfo, MSSAU);</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889" lineLink="#ac33f359fcea1152130e9e51c95256d0c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ac33f359fcea1152130e9e51c95256d0c">hoistArithmetics</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L,</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/icfloopsafetyinfo">ICFLoopSafetyInfo</a> &amp;SafetyInfo,</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &amp;MSSAU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimize complex patterns, such as (x &lt; INV1 &amp;&amp; x &lt; INV2), turning them</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into (x &lt; min(INV1, INV2)), and hoisting the invariant part of this</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expression out of the loop.</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a1f669cc640bda295e6c2e2b3c90babb9">hoistMinMax</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, L, SafetyInfo, MSSAU)) &#123;</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">    ++NumHoisted;</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlight">    ++NumMinMaxHoisted;</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to hoist GEPs by reassociation.</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a062c93def88f99e93047ba86970c4eab">hoistGEP</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, L, SafetyInfo, MSSAU, AC, DT)) &#123;</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlight">    ++NumHoisted;</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">    ++NumGEPsHoisted;</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to hoist add/sub&#39;s by reassociation.</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a66f8120f59f3970d1c0a554a8f7c3e2e">hoistAddSub</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, L, SafetyInfo, MSSAU, AC, DT)) &#123;</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlight">    ++NumHoisted;</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">    ++NumAddSubHoisted;</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsInt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isIntOrIntVectorTy();</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a697cde840957bbc0b2848a593c3e0d5a">hoistMulAddAssociation</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, L, SafetyInfo, MSSAU, AC, DT)) &#123;</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><span class="doxyHighlight">    ++NumHoisted;</span></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsInt)</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">      ++NumIntAssociationsHoisted;</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">      ++NumFPAssociationsHoisted;</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aebac730a26c607cea825366afca2d8b1">hoistBOAssociation</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, L, SafetyInfo, MSSAU, AC, DT)) &#123;</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">    ++NumHoisted;</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">    ++NumBOAssociationsHoisted;</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlightComment">/// Little predicate that returns true if the specified basic block is in</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlightComment">/// a subloop of the current one, not the current one itself.</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938" lineLink="#aabae34d2dbed5dde1865f19ccbe4cb81"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aabae34d2dbed5dde1865f19ccbe4cb81">inSubLoop</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI) &#123;</span></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(BB) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Only valid if BB is IN the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(BB) != CurLoop;</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
