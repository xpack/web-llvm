---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/machinesink-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `MachineSink.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/ADT/DenseSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/denseset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DepthFirstIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/depthfirstiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PointerIntPair.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineblockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBranchProbabilityInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebranchprobabilityinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineCycleAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinecycleanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineDomTreeUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedomtreeupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunctionPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineInstr.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineLoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineOperand.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachinePostDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinepostdominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineRegisterInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineregisterinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineSizeOpts.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinesizeopts-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/RegisterClassInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/registerclassinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/RegisterPressure.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/registerpressure-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetInstrInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetPassConfig.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetRegisterInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetregisterinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetSchedule.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetschedule-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetSubtargetInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-machinesink-cpp-">anonymous&#123;MachineSink.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking">MachineSinking</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking">PostRAMachineSinking</a></>}>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#a1f5758149387a098afa23bf386888618">MIRegs</a> = std::pair&lt; <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; unsigned, 2 &gt; &gt;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="using"
  name={<><a href="#a16005492b382a6a76abae848b4af2b83">RegSubRegPair</a> = <a href="/docs/api/structs/llvm/targetinstrinfo/regsubregpair">TargetInstrInfo::RegSubRegPair</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="LiveInRegUnits"
  name={<><a href="#a074843b524f0a9bfd420219cd3cb10cd">addLiveIns</a> (MBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab07fa640d6b044c04371e8cc8bde6a02">attemptDebugCopyProp</a> (MachineInstr &amp;SinkInst, MachineInstr &amp;DbgMI, Register Reg)</>}>
If the sunk instruction is a copy, try to forward the copy instead of leaving an &#39;undef&#39; DBG&#95;VALUE in the original location. <a href="#ab07fa640d6b044c04371e8cc8bde6a02">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="return !LiveInRegUnits"
  name={<><a href="#a40cc6a0e0895fa564ee013923209aa85">available</a> (Reg)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a2e16e55de32fe349f3e8242166918205">Machine</a> code static false bool</>}
  name={<><a href="#a854df6024334d02ea223f70a543940fc">blockPrologueInterferes</a> (const MachineBasicBlock &#42;BB, MachineBasicBlock::const&#95;iterator End, const MachineInstr &amp;MI, const TargetRegisterInfo &#42;TRI, const TargetInstrInfo &#42;TII, const MachineRegisterInfo &#42;MRI)</>}>
Return true if a target defined block prologue instruction interferes with a sink candidate. <a href="#a854df6024334d02ea223f70a543940fc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a084d504a7f8b42657e1c910ba098ad94">clearKillFlags</a> (MachineInstr &#42;MI, MachineBasicBlock &amp;CurBB, SmallVectorImpl&lt; unsigned &gt; &amp;UsedOpsInCopy, LiveRegUnits &amp;UsedRegUnits, const TargetRegisterInfo &#42;TRI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#acf8fc7aec1c211309bcfdadf5471efc5">getSingleLiveInSuccBB</a> (MachineBasicBlock &amp;CurBB, const SmallPtrSetImpl&lt; MachineBasicBlock &#42; &gt; &amp;SinkableBBs, unsigned Reg, const TargetRegisterInfo &#42;TRI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#a760cd0801dd2ecf5d8951c3c1db40ca8">getSingleLiveInSuccBB</a> (MachineBasicBlock &amp;CurBB, const SmallPtrSetImpl&lt; MachineBasicBlock &#42; &gt; &amp;SinkableBBs, ArrayRef&lt; unsigned &gt; DefedRegsInCopy, const TargetRegisterInfo &#42;TRI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a5523ffd2d5ced60566f3493c2b48e0e3">hasRegisterDependency</a> (MachineInstr &#42;MI, SmallVectorImpl&lt; unsigned &gt; &amp;UsedOpsInCopy, SmallVectorImpl&lt; unsigned &gt; &amp;DefedRegsInCopy, LiveRegUnits &amp;ModifiedRegUnits, LiveRegUnits &amp;UsedRegUnits)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa1a94d15096ac1fd1fd21d1af9187761">INITIALIZE&#95;PASS</a> (PostRAMachineSinking, &quot;postra-machine-sink&quot;, &quot;PostRA Machine Sink&quot;, false, false) static bool aliasWithRegsInLiveIn(MachineBasicBlock &amp;MBB</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a8ecbf0fad9948bab3c145b46cbf244f4">INITIALIZE&#95;PASS&#95;BEGIN</a> (MachineSinking, DEBUG&#95;TYPE, &quot;Machine code sinking&quot;, false, false) INITIALIZE&#95;PASS&#95;END(MachineSinking</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a304f762123a019d38d531483c00c796b">mayLoadFromGOTOrConstantPool</a> (MachineInstr &amp;MI)</>}>
Return true if this machine instruction loads from global offset table or constant pool. <a href="#a304f762123a019d38d531483c00c796b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a1e64ed92fc7b343fa59c28105e16b794">performSink</a> (MachineInstr &amp;MI, MachineBasicBlock &amp;SuccToSinkTo, MachineBasicBlock::iterator InsertPos, ArrayRef&lt; MIRegs &gt; DbgValuesToSink)</>}>
Sink an instruction and its associated debug instructions. <a href="#a1e64ed92fc7b343fa59c28105e16b794">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a316803c463af8ba2c38182332fb3c8a4">SinkingPreventsImplicitNullCheck</a> (MachineInstr &amp;MI, const TargetInstrInfo &#42;TII, const TargetRegisterInfo &#42;TRI)</>}>
Return true if MI is likely to be usable as a memory operation by the implicit null check optimization. <a href="#a316803c463af8ba2c38182332fb3c8a4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3d1eec7baf4531f508771c495a4b07b3">STATISTIC</a> (NumSunk, &quot;Number of machine instructions sunk&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa73fca6bc11b2eeecbad426a56359ceb">STATISTIC</a> (NumCycleSunk, &quot;Number of machine instructions sunk into a cycle&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac0b2bd388e695f08c38030c6892a183b">STATISTIC</a> (NumSplit, &quot;Number of critical edges split&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a0e5a26098d540497ef0e5df892f774ba">STATISTIC</a> (NumCoalesces, &quot;Number of copies coalesced&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2a52f2b42a1961a70cd0a2a12e5ad278">STATISTIC</a> (NumPostRACopySink, &quot;Number of copies sunk after RA&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a6c1da13a967ff01e9076c55b0b6d158c">updateLiveIn</a> (MachineInstr &#42;MI, MachineBasicBlock &#42;SuccBB, SmallVectorImpl&lt; unsigned &gt; &amp;UsedOpsInCopy, SmallVectorImpl&lt; unsigned &gt; &amp;DefedRegsInCopy)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a030569d5a541b6110f2ae1b6a3413a58">DEBUG&#95;TYPE</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a2e16e55de32fe349f3e8242166918205">Machine</a> code</>}
  name={<><a href="#add1b68e45590816c3156869e7915c269">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a2e16e55de32fe349f3e8242166918205">Machine</a> code</>}
  name={<><a href="#a3b48f4c83665c4a2ece4938ffc9ffbcd">sinking</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a33ac72ad86d97fe56d3ef6668df30680">SinkInstsIntoCycle</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a084ec12a6f4a9e62a9fef7d321250c12">SinkIntoCycleLimit</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a341405fd2cb2dfad3d03b4f76b1a577b">SinkLoadBlocksThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a001e53bb2ff322656f27e267f2409a06">SinkLoadInstsPerBlockThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a9e692ddc4d0481e2ca501d7600f8b328">SplitEdgeProbabilityThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a222c2bec99b5fc7d68f675248e085cd2">SplitEdges</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>unsigned <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;</>}
  name={<><a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> &#123;
  <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> LiveInRegUnits(&#42;TRI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ae8a57b53e1029a66423f1c8beeee72b8">UseBlockFreqInfo</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;machine-sink&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### MIRegs {#a1f5758149387a098afa23bf386888618}

<MemberDefinition
  prototype={<>using MIRegs =  std::pair&lt;MachineInstr &#42;, SmallVector&lt;unsigned, 2&gt;&gt;</>}>

Definition at line <a href="#l01521">1521</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### RegSubRegPair {#a16005492b382a6a76abae848b4af2b83}

<MemberDefinition
  prototype="using RegSubRegPair =  TargetInstrInfo::RegSubRegPair">

Definition at line <a href="#l00117">117</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### addLiveIns() {#a074843b524f0a9bfd420219cd3cb10cd}

<MemberDefinition
  prototype={<>LiveInRegUnits addLiveIns (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</>}>

Definition at line <a href="#l02031">2031</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### attemptDebugCopyProp() {#ab07fa640d6b044c04371e8cc8bde6a02}

<MemberDefinition
  prototype={<>static bool attemptDebugCopyProp (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; SinkInst, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; DbgMI, <a href="/docs/api/classes/llvm/register">Register</a> Reg)</>}
  labels = {["static"]}>
If the sunk instruction is a copy, try to forward the copy instead of leaving an &#39;undef&#39; DBG&#95;VALUE in the original location.

Don&#39;t do this if there&#39;s any subregister weirdness involved. Returns true if copy propagation occurred.

Definition at line <a href="#l01471">1471</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### available() {#a40cc6a0e0895fa564ee013923209aa85}

<MemberDefinition
  prototype={<>return !LiveInRegUnits available (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</>}>

Definition at line <a href="#l02032">2032</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### blockPrologueInterferes() {#a854df6024334d02ea223f70a543940fc}

<MemberDefinition
  prototype={<>Machine code static false bool blockPrologueInterferes (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> End, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42; TII, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &#42; MRI)</>}
  labels = {["static"]}>
Return true if a target defined block prologue instruction interferes with a sink candidate.

Definition at line <a href="#l00311">311</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### clearKillFlags() {#a084d504a7f8b42657e1c910ba098ad94}

<MemberDefinition
  prototype={<>static void clearKillFlags (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; MI, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; CurBB, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; unsigned &gt; &amp; UsedOpsInCopy, <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> &amp; UsedRegUnits, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02078">2078</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### getSingleLiveInSuccBB() {#acf8fc7aec1c211309bcfdadf5471efc5}

<MemberDefinition
  prototype={<>static MachineBasicBlock &#42; getSingleLiveInSuccBB (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; CurBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; &gt; &amp; SinkableBBs, unsigned Reg, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02036">2036</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### getSingleLiveInSuccBB() {#a760cd0801dd2ecf5d8951c3c1db40ca8}

<MemberDefinition
  prototype={<>static MachineBasicBlock &#42; getSingleLiveInSuccBB (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; CurBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; &gt; &amp; SinkableBBs, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; unsigned &gt; DefedRegsInCopy, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02063">2063</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### hasRegisterDependency() {#a5523ffd2d5ced60566f3493c2b48e0e3}

<MemberDefinition
  prototype={<>static bool hasRegisterDependency (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; MI, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; unsigned &gt; &amp; UsedOpsInCopy, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; unsigned &gt; &amp; DefedRegsInCopy, <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> &amp; ModifiedRegUnits, <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> &amp; UsedRegUnits)</>}
  labels = {["static"]}>

Definition at line <a href="#l02111">2111</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS() {#aa1a94d15096ac1fd1fd21d1af9187761}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS (PostRAMachineSinking, &quot;postra-machine-sink&quot;, &quot;PostRA <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a2e16e55de32fe349f3e8242166918205">Machine</a> Sink&quot;, false, false)</>}>

Definition at line <a href="#l02025">2025</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#a8ecbf0fad9948bab3c145b46cbf244f4}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (MachineSinking, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Machine code sinking&quot;, false, false)</>}>

Definition at line <a href="#l00299">299</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### mayLoadFromGOTOrConstantPool() {#a304f762123a019d38d531483c00c796b}

<MemberDefinition
  prototype={<>static bool mayLoadFromGOTOrConstantPool (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI)</>}
  labels = {["static"]}>
Return true if this machine instruction loads from global offset table or constant pool.

Definition at line <a href="#l00674">674</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### performSink() {#a1e64ed92fc7b343fa59c28105e16b794}

<MemberDefinition
  prototype={<>static void performSink (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; SuccToSinkTo, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> InsertPos, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="#a1f5758149387a098afa23bf386888618">MIRegs</a> &gt; DbgValuesToSink)</>}
  labels = {["static"]}>
Sink an instruction and its associated debug instructions.

Definition at line <a href="#l01523">1523</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### SinkingPreventsImplicitNullCheck() {#a316803c463af8ba2c38182332fb3c8a4}

<MemberDefinition
  prototype={<>static bool SinkingPreventsImplicitNullCheck (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42; TII, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI)</>}
  labels = {["static"]}>
Return true if MI is likely to be usable as a memory operation by the implicit null check optimization.

This is a &quot;best effort&quot; heuristic, and should not be relied upon for correctness. This returning true does not guarantee that the implicit null check optimization is legal over MI, and this returning false does not guarantee MI cannot possibly be used to do a null check.

Definition at line <a href="#l01426">1426</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3d1eec7baf4531f508771c495a4b07b3}

<MemberDefinition
  prototype={<>STATISTIC (NumSunk, &quot;Number of machine <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> sunk&quot;)</>}>

Definition at line <a href="#l00111">111</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aa73fca6bc11b2eeecbad426a56359ceb}

<MemberDefinition
  prototype={<>STATISTIC (NumCycleSunk, &quot;Number of machine <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> sunk into a cycle&quot;)</>}>

Definition at line <a href="#l00112">112</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac0b2bd388e695f08c38030c6892a183b}

<MemberDefinition
  prototype={<>STATISTIC (NumSplit, &quot;Number of critical edges split&quot;)</>}>

Definition at line <a href="#l00113">113</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a0e5a26098d540497ef0e5df892f774ba}

<MemberDefinition
  prototype={<>STATISTIC (NumCoalesces, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sifixsgprcopies-cpp/#a1d5e606e23fdf432583aa8dc1f17ff55">copies</a> coalesced&quot;)</>}>

Definition at line <a href="#l00114">114</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2a52f2b42a1961a70cd0a2a12e5ad278}

<MemberDefinition
  prototype={<>STATISTIC (NumPostRACopySink, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sifixsgprcopies-cpp/#a1d5e606e23fdf432583aa8dc1f17ff55">copies</a> sunk after RA&quot;)</>}>

Definition at line <a href="#l00115">115</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### updateLiveIn() {#a6c1da13a967ff01e9076c55b0b6d158c}

<MemberDefinition
  prototype={<>static void updateLiveIn (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; MI, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; SuccBB, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; unsigned &gt; &amp; UsedOpsInCopy, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; unsigned &gt; &amp; DefedRegsInCopy)</>}
  labels = {["static"]}>

Definition at line <a href="#l02098">2098</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### DEBUG&#95;TYPE {#a030569d5a541b6110f2ae1b6a3413a58}

<MemberDefinition
  prototype={<>DEBUG&#95;TYPE</>}>

Definition at line <a href="#l00306">306</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### false {#add1b68e45590816c3156869e7915c269}

<MemberDefinition
  prototype="Machine code false">

Definition at line <a href="#l00306">306</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### Reg {#a359e1ff26f6d466d927a61aae45b05c3}

<MemberDefinition
  prototype="unsigned Reg">

Definition at line <a href="#l02028">2028</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### sinking {#a3b48f4c83665c4a2ece4938ffc9ffbcd}

<MemberDefinition
  prototype="Machine code sinking">

Definition at line <a href="#l00306">306</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### SinkInstsIntoCycle {#a33ac72ad86d97fe56d3ef6668df30680}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; SinkInstsIntoCycle(&quot;sink-insts-to-avoid-spills&quot;, cl::desc(&quot;Sink instructions into cycles to avoid &quot; &quot;register spills&quot;), cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00100">100</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### SinkIntoCycleLimit {#a084ec12a6f4a9e62a9fef7d321250c12}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; SinkIntoCycleLimit(&quot;machine-sink-cycle-limit&quot;, cl::desc( &quot;The maximum number of instructions considered for cycle sinking.&quot;), cl::init(50), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00105">105</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### SinkLoadBlocksThreshold {#a341405fd2cb2dfad3d03b4f76b1a577b}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; SinkLoadBlocksThreshold(&quot;machine-sink-load-blocks-threshold&quot;, cl::desc(&quot;Do not try to find alias store for a load if the block number in &quot; &quot;the straight line is higher than this threshold.&quot;), cl::init(20), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00093">93</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### SinkLoadInstsPerBlockThreshold {#a001e53bb2ff322656f27e267f2409a06}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; SinkLoadInstsPerBlockThreshold(&quot;machine-sink-load-instrs-threshold&quot;, cl::desc(&quot;Do not try to find alias store for a load if there is a in-path &quot; &quot;block whose instruction number is higher than this threshold.&quot;), cl::init(2000), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00087">87</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### SplitEdgeProbabilityThreshold {#a9e692ddc4d0481e2ca501d7600f8b328}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; SplitEdgeProbabilityThreshold(&quot;machine-sink-split-probability-threshold&quot;, cl::desc( &quot;Percentage threshold for splitting single-instruction critical edge. &quot; &quot;If the branch threshold is higher than this threshold, we allow &quot; &quot;speculative execution of up to 1 instruction to avoid branching to &quot; &quot;splitted critical edge&quot;), cl::init(40), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### SplitEdges {#a222c2bec99b5fc7d68f675248e085cd2}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; SplitEdges(&quot;machine-sink-split&quot;, cl::desc(&quot;Split critical edges during machine sinking&quot;), cl::init(true), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00069">69</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### TRI {#a0f36ed1bc17fc1aa97fe291c439a0698}

<MemberDefinition
  prototype={<>unsigned const TargetRegisterInfo&#42; TRI &#123;
  <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> LiveInRegUnits(&#42;TRI)</>}>

Definition at line <a href="#l02029">2029</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

### UseBlockFreqInfo {#ae8a57b53e1029a66423f1c8beeee72b8}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseBlockFreqInfo(&quot;machine-sink-bfi&quot;, cl::desc(&quot;Use block frequency info to find successors to sink&quot;), cl::init(true), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00073">73</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;machine-sink&quot;</>}>

Definition at line <a href="#l00066">66</a> of file <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp">MachineSink.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- MachineSink.cpp - Sinking for machine instructions -----------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This pass moves instructions into successor blocks when possible, so that</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// they aren&#39;t executed on paths where their results aren&#39;t needed.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// This pass is not intended to be a replacement or a complete alternative</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// for an LLVM-IR-level sinking pass. It is only designed to sink simple</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// constructs that are not exposed before lowering and instruction selection.</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/denseset-h">llvm/ADT/DenseSet.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/depthfirstiterator-h">llvm/ADT/DepthFirstIterator.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h">llvm/ADT/PointerIntPair.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h">llvm/ADT/SmallSet.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h">llvm/Analysis/AliasAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h">llvm/Analysis/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineblockfrequencyinfo-h">llvm/CodeGen/MachineBlockFrequencyInfo.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebranchprobabilityinfo-h">llvm/CodeGen/MachineBranchProbabilityInfo.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinecycleanalysis-h">llvm/CodeGen/MachineCycleAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedomtreeupdater-h">llvm/CodeGen/MachineDomTreeUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedominators-h">llvm/CodeGen/MachineDominators.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h">llvm/CodeGen/MachineInstr.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h">llvm/CodeGen/MachineLoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h">llvm/CodeGen/MachineOperand.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinepostdominators-h">llvm/CodeGen/MachinePostDominators.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineregisterinfo-h">llvm/CodeGen/MachineRegisterInfo.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinesizeopts-h">llvm/CodeGen/MachineSizeOpts.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/registerclassinfo-h">llvm/CodeGen/RegisterClassInfo.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/registerpressure-h">llvm/CodeGen/RegisterPressure.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h">llvm/CodeGen/TargetInstrInfo.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetregisterinfo-h">llvm/CodeGen/TargetRegisterInfo.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetschedule-h">llvm/CodeGen/TargetSchedule.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &lt;vector&gt;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;machine-sink&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69" lineLink="#a222c2bec99b5fc7d68f675248e085cd2"><span class="doxyHighlight">    <a href="#a222c2bec99b5fc7d68f675248e085cd2">SplitEdges</a>(</span><span class="doxyHighlightStringLiteral">&quot;machine-sink-split&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">               <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Split critical edges during machine sinking&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73" lineLink="#ae8a57b53e1029a66423f1c8beeee72b8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ae8a57b53e1029a66423f1c8beeee72b8">UseBlockFreqInfo</a>(</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;machine-sink-bfi&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Use block frequency info to find successors to sink&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#a9e692ddc4d0481e2ca501d7600f8b328"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a9e692ddc4d0481e2ca501d7600f8b328">SplitEdgeProbabilityThreshold</a>(</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;machine-sink-split-probability-threshold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Percentage threshold for splitting single-instruction critical edge. &quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;If the branch threshold is higher than this threshold, we allow &quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;speculative execution of up to 1 instruction to avoid branching to &quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;splitted critical edge&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(40), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="#a001e53bb2ff322656f27e267f2409a06"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a001e53bb2ff322656f27e267f2409a06">SinkLoadInstsPerBlockThreshold</a>(</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;machine-sink-load-instrs-threshold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Do not try to find alias store for a load if there is a in-path &quot;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;block whose instruction number is higher than this threshold.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2000), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="#a341405fd2cb2dfad3d03b4f76b1a577b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a341405fd2cb2dfad3d03b4f76b1a577b">SinkLoadBlocksThreshold</a>(</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;machine-sink-load-blocks-threshold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Do not try to find alias store for a load if the block number in &quot;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;the straight line is higher than this threshold.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(20), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100" lineLink="#a33ac72ad86d97fe56d3ef6668df30680"><span class="doxyHighlight">    <a href="#a33ac72ad86d97fe56d3ef6668df30680">SinkInstsIntoCycle</a>(</span><span class="doxyHighlightStringLiteral">&quot;sink-insts-to-avoid-spills&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">                       <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Sink instructions into cycles to avoid &quot;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">                                </span><span class="doxyHighlightStringLiteral">&quot;register spills&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">                       <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105" lineLink="#a084ec12a6f4a9e62a9fef7d321250c12"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a084ec12a6f4a9e62a9fef7d321250c12">SinkIntoCycleLimit</a>(</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;machine-sink-cycle-limit&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;The maximum number of instructions considered for cycle sinking.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(50), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111" lineLink="#a3d1eec7baf4531f508771c495a4b07b3"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSunk, </span><span class="doxyHighlightStringLiteral">&quot;Number of machine instructions sunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112" lineLink="#aa73fca6bc11b2eeecbad426a56359ceb"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCycleSunk, </span><span class="doxyHighlightStringLiteral">&quot;Number of machine instructions sunk into a cycle&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="#ac0b2bd388e695f08c38030c6892a183b"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSplit, </span><span class="doxyHighlightStringLiteral">&quot;Number of critical edges split&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="#a0e5a26098d540497ef0e5df892f774ba"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCoalesces, </span><span class="doxyHighlightStringLiteral">&quot;Number of copies coalesced&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115" lineLink="#a2a52f2b42a1961a70cd0a2a12e5ad278"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPostRACopySink, </span><span class="doxyHighlightStringLiteral">&quot;Number of copies sunk after RA&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117" lineLink="#a16005492b382a6a76abae848b4af2b83"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="#a16005492b382a6a76abae848b4af2b83">RegSubRegPair</a> = <a href="/docs/api/structs/llvm/targetinstrinfo/regsubregpair">TargetInstrInfo::RegSubRegPair</a>;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="/docs/api/namespaces/anonymous-machinesink-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#a7eaa892247782f8364a7924e675e1ab7">MachineSinking</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetsubtargetinfo">TargetSubtargetInfo</a> &#42;STI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;TII = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;TRI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &#42;MRI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;      </span><span class="doxyHighlightComment">// Machine register information</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinedominatortree">MachineDominatorTree</a> &#42;DT = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;      </span><span class="doxyHighlightComment">// Machine dominator tree</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinepostdominatortree">MachinePostDominatorTree</a> &#42;PDT = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Machine post dominator tree</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aee433bfa58b17266f2cff728e02fba26">MachineCycleInfo</a> &#42;CI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineblockfrequencyinfo">MachineBlockFrequencyInfo</a> &#42;MBFI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebranchprobabilityinfo">MachineBranchProbabilityInfo</a> &#42;MBPI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42;AA = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/registerclassinfo">RegisterClassInfo</a> RegClassInfo;</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetschedmodel">TargetSchedModel</a> SchedModel;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remember which edges have been considered for breaking.</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;std::pair&lt;MachineBasicBlock &#42;, MachineBasicBlock &#42;&gt;</a>, 8&gt;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">      CEBCandidates;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Memorize the register that also wanted to sink into the same block along</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a different critical edge.</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#123;register to sink, sink-to block&#125; -&gt; the first sink-from block.</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;re recording the first sink-from block because that (critical) edge</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// was deferred until we see another register that&#39;s going to sink into the</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same block.</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;Register, MachineBasicBlock &#42;&gt;</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;&gt;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">      CEMergeCandidates;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remember which edges we are about to split.</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is different from CEBCandidates since those edges</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will be split.</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;std::pair&lt;MachineBasicBlock &#42;, MachineBasicBlock &#42;&gt;</a>&gt; ToSplit;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Register&gt;</a> RegsToClearKillFlags;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">AllSuccsCache =</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;MachineBasicBlock &#42;, SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a>&gt;;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">  /// DBG&#95;VALUE pointer and flag. The flag is true if this DBG&#95;VALUE is</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlightComment">  /// post-dominated by another DBG&#95;VALUE of the same variable location.</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">  /// This is necessary to detect sequences such as:</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlightComment">  ///     %0 = someinst</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightComment">  ///     DBG&#95;VALUE %0, !123, !DIExpression()</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightComment">  ///     %1 = anotherinst</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightComment">  ///     DBG&#95;VALUE %1, !123, !DIExpression()</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlightComment">  /// Where if %0 were to sink, the DBG&#95;VAUE should not sink with it, as that</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlightComment">  /// would re-order assignments.</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">SeenDbgUser = <a href="/docs/api/classes/llvm/pointerintpair">PointerIntPair&lt;MachineInstr &#42;, 1&gt;</a>;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">SinkItem = std::pair&lt;MachineInstr &#42;, MachineBasicBlock &#42;&gt;;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlightComment">  /// Record of DBG&#95;VALUE uses of vregs in a block, so that we can identify</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlightComment">  /// debug instructions to sink.</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;unsigned, TinyPtrVector&lt;SeenDbgUser&gt;</a>&gt; SeenDbgUsers;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlightComment">  /// Record of debug variables that have had their locations set in the</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlightComment">  /// current block.</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;DebugVariable&gt;</a> SeenDbgVars;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;MachineBasicBlock &#42;, MachineBasicBlock &#42;&gt;</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">&gt;</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">      HasStoreCache;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;MachineBasicBlock &#42;, MachineBasicBlock &#42;&gt;</a>,</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineInstr &#42;&gt;</a>&gt;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">      StoreInstrCache;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlightComment">  /// Cached BB&#39;s register pressure.</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, std::vector&lt;unsigned&gt;</a>&gt;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">      CachedRegisterPressure;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EnableSinkAndFold;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#adf042164222d2988000298fad4c7aea3"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#adf042164222d2988000298fad4c7aea3">ID</a>; </span><span class="doxyHighlightComment">// Pass identification</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#a7eaa892247782f8364a7924e675e1ab7"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#a7eaa892247782f8364a7924e675e1ab7">MachineSinking</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#adf042164222d2988000298fad4c7aea3">ID</a>) &#123;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a910d02b9b941c7232f370a3f7c345621">initializeMachineSinkingPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnMachineFunction(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#aa7678b365028630e8b51cb7b43988523"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#aa7678b365028630e8b51cb7b43988523">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/aaresultswrapperpass">AAResultsWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinedominatortreewrapperpass">MachineDominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinepostdominatortreewrapperpass">MachinePostDominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinecycleinfowrapperpass">MachineCycleInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinebranchprobabilityinfowrapperpass">MachineBranchProbabilityInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/machinecycleinfowrapperpass">MachineCycleInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/machineloopinfowrapperpass">MachineLoopInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ae8a57b53e1029a66423f1c8beeee72b8">UseBlockFreqInfo</a>)</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">      AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machineblockfrequencyinfowrapperpass">MachineBlockFrequencyInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a>&gt;();</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#a033b5a952489a6832d846fac0ec2a9e6"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#a033b5a952489a6832d846fac0ec2a9e6">releaseMemory</a>()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    CEBCandidates.clear();</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">    CEMergeCandidates.clear();</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sink-cpp/#a7a59feca56f2ecfe5c74d6c04b0c45c7">ProcessBlock</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> ProcessDbgInst(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isLegalToBreakCriticalEdge(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;From,</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;To, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BreakPHIEdge);</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isWorthBreakingCriticalEdge(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;From,</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;To,</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;&amp;DeferredFromBlock);</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> hasStoreBetween(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;From, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;To,</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlightComment">  /// Postpone the splitting of the given critical</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlightComment">  /// edge (\\p From, \\p To).</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlightComment">  /// We do not split the edges on the fly. Indeed, this invalidates</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlightComment">  /// the dominance information and thus triggers a lot of updates</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlightComment">  /// of that information underneath.</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlightComment">  /// Instead, we postpone all the splits after each iteration of</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlightComment">  /// the main loop. That way, the information is at least valid</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlightComment">  /// for the lifetime of an iteration.</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlightComment">  /// \\return True if the edge is marked as toSplit, false otherwise.</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlightComment">  /// False can be returned if, for instance, this is not profitable.</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PostponeSplitCriticalEdge(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;From,</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;To, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BreakPHIEdge);</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sink-cpp/#afa4c018bf923954bfd4ce5b6bf15b68b">SinkInstruction</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;SawStore,</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">                       AllSuccsCache &amp;AllSuccessors);</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlightComment">  /// If we sink a COPY inst, some debug users of it&#39;s destination may no</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlightComment">  /// longer be dominated by the COPY, and will eventually be dropped.</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlightComment">  /// This is easily rectified by forwarding the non-dominated debug uses</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlightComment">  /// to the copy source.</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> SalvageUnsunkDebugUsersOfCopy(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;,</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;TargetBlock);</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllUsesDominatedByBlock(<a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;DefMBB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;BreakPHIEdge,</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;LocalUse) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;FindSuccToSinkTo(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;BreakPHIEdge,</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">                                      AllSuccsCache &amp;AllSuccessors);</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> FindCycleSinkCandidates(<a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;Candidates);</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">  aggressivelySinkIntoCycle(<a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SinkItem, MachineInstr &#42;&gt;</a> &amp;SunkInstrs);</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isProfitableToSinkTo(<a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccToSinkTo,</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">                            AllSuccsCache &amp;AllSuccessors);</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PerformTrivialForwardCoalescing(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PerformSinkAndFold(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> &amp;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  GetAllSortedSuccessors(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">                         AllSuccsCache &amp;AllSuccessors) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  std::vector&lt;unsigned&gt; &amp;getBBRegisterPressure(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseCache = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> registerPressureSetExceedsLimit(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NRegs,</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RC,</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> registerPressureExceedsLimit(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#adf042164222d2988000298fad4c7aea3">MachineSinking::ID</a> = 0;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297" lineLink="/docs/api/namespaces/llvm/#a2a307065c6152b458d2b8ceaea1823d7"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a2a307065c6152b458d2b8ceaea1823d7">llvm::MachineSinkingID</a> = <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#adf042164222d2988000298fad4c7aea3">MachineSinking::ID</a>;</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299" lineLink="#a8ecbf0fad9948bab3c145b46cbf244f4"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#a7eaa892247782f8364a7924e675e1ab7">MachineSinking</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;Machine code sinking&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machinebranchprobabilityinfowrapperpass">MachineBranchProbabilityInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machinedominatortreewrapperpass">MachineDominatorTreeWrapperPass</a>)</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machinecycleinfowrapperpass">MachineCycleInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/aaresultswrapperpass">AAResultsWrapperPass</a>)</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306" lineLink="#a030569d5a541b6110f2ae1b6a3413a58"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#a7eaa892247782f8364a7924e675e1ab7">MachineSinking</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;Machine code sinking&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/false">false</a>,</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlightComment">/// Return true if a target defined block prologue instruction interferes</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlightComment">/// with a sink candidate.</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311" lineLink="#a854df6024334d02ea223f70a543940fc"><span class="doxyHighlight">static </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a854df6024334d02ea223f70a543940fc">blockPrologueInterferes</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a>::<a href="/docs/api/classes/llvm/smallvectorimpl">const&#95;iterator</a> End,</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>,</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>) &#123;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> PI = BB-&gt;getFirstNonPHI(); PI != End;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">       ++PI) &#123;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only check target defined prologue instructions</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    if (!TII-&gt;isBasicBlockPrologue(&#42;PI))</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">      continue;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">    for (auto &amp;MO : MI.operands()) &#123;</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">      if (!MO.isReg())</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">        continue;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">      Register Reg = MO.getReg();</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">      if (!Reg)</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">        continue;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">      if (MO.isUse()) &#123;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">        if (Reg.isPhysical() &amp;&amp;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">            (TII-&gt;isIgnorableUse(MO) || (MRI &amp;&amp; MRI-&gt;isConstantPhysReg(Reg))))</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">          continue;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">        if (PI-&gt;modifiesRegister(Reg, TRI))</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">          return true;</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">      &#125; else &#123;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">        if (PI-&gt;readsRegister(Reg, TRI))</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">          return true;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Check for interference with non-dead defs</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">        auto &#42;DefOp = PI-&gt;findRegisterDefOperand(Reg, TRI, false, true);</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">        if (DefOp &amp;&amp; !DefOp-&gt;isDead())</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">          return true;</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::PerformTrivialForwardCoalescing(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCopy())</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> SrcReg = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(1).getReg();</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> DstReg = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(0).getReg();</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SrcReg.<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>() || !DstReg.<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>() ||</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">      !<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;hasOneNonDBGUse(SrcReg))</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;SRC = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(SrcReg);</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;DRC = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(DstReg);</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SRC != DRC)</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getVRegDef(SrcReg);</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>-&gt;isCopyLike())</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Coalescing: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>);</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42; to: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;replaceRegWith(DstReg, SrcReg);</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.eraseFromParent();</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Conservatively, clear any kill flags, since it&#39;s possible that they are no</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// longer correct.</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;clearKillFlags(SrcReg);</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  ++NumCoalesces;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::PerformSinkAndFold(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCopy() || <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayLoadOrStore() ||</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::REG&#95;SEQUENCE)</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t sink instructions that the target prefers not to sink.</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;shouldSink(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if it&#39;s safe to move the instruction.</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SawStore = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isSafeToMove(SawStore))</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convergent operations may not be made control-dependent on additional</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isConvergent())</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t sink defs/uses of hard registers or if the instruction defines more</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// than one register.</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t sink more than two register uses - it&#39;ll cover most of the cases and</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// greatly simplifies the register pressure checks.</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> DefReg;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> UsedRegA, UsedRegB;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isImm() || MO.isRegMask() || MO.isRegLiveOut() || MO.isMetadata() ||</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">        MO.isMCSymbol() || MO.isDbgInstrRef() || MO.isCFIIndex() ||</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">        MO.isIntrinsicID() || MO.isPredicate() || MO.isShuffleMask())</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg())</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == 0)</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isVirtual()) &#123;</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isDef()) &#123;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefReg)</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">        DefReg = <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>;</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedRegA == 0)</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">        UsedRegA = <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>;</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedRegB == 0)</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">        UsedRegB = <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>;</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical() &amp;&amp; MO.isUse() &amp;&amp;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">        (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;isConstantPhysReg(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>) || <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isIgnorableUse(MO)))</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan uses of the destination register. Every use, except the last, must be</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a copy, with a chain of copies terminating with either a copy into a hard</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register, or a load/store instruction where the use is part of the</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// address (&#42;not&#42; the stored value).</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">SinkInfo = std::pair&lt;MachineInstr &#42;, ExtAddrMode&gt;;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SinkInfo&gt;</a> SinkInto;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Register&gt;</a> Worklist;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RC = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(DefReg);</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RCA =</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">      UsedRegA == 0 ? nullptr : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(UsedRegA);</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RCB =</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">      UsedRegB == 0 ? nullptr : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(UsedRegB);</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DefReg);</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;use&#95;nodbg&#95;operands(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/extaddrmode">ExtAddrMode</a> MaybeAM;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;UseInst = &#42;MO.<a href="/docs/api/classes/llvm/machineinstr/#a1e855100f407ca4be098d0050be403b0">getParent</a>();</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst.<a href="/docs/api/classes/llvm/machineinstr/#a1912d4fbc40c61a12b1f770ad54dfd74">isCopy</a>()) &#123;</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/register">Register</a> DstReg;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;O = UseInst.<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(0); <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>.isReg())</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">          DstReg = <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>.getReg();</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DstReg == 0)</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DstReg.<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>()) &#123;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DstReg);</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we are going to replace a copy, the original instruction must be</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// as cheap as a copy.</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isAsCheapAsAMove(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The hard register must be in the register class of the original</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// instruction&#39;s destination register.</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RC-&gt;<a href="/docs/api/classes/llvm/targetregisterclass/#a60b6974966381f08079722f2258a0039">contains</a>(DstReg))</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst.<a href="/docs/api/classes/llvm/machineinstr/#a17f5d15a7320dec2cfefb6617f711ab7">mayLoadOrStore</a>()) &#123;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/extaddrmode">ExtAddrMode</a> AM;</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;canFoldIntoAddrMode(UseInst, <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, AM))</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">        MaybeAM = AM;</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst.<a href="/docs/api/classes/llvm/machineinstr/#a1e855100f407ca4be098d0050be403b0">getParent</a>() != <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent()) &#123;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the register class of the register we are replacing is a superset</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// of any of the register classes of the operands of the materialized</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// instruction don&#39;t consider that live range extended.</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RCS = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RCA &amp;&amp; RCA-&gt;<a href="/docs/api/classes/llvm/targetregisterclass/#abee1c3236731101b249f6eeffd8cd7ba">hasSuperClassEq</a>(RCS))</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">          RCA = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RCB &amp;&amp; RCB-&gt;<a href="/docs/api/classes/llvm/targetregisterclass/#abee1c3236731101b249f6eeffd8cd7ba">hasSuperClassEq</a>(RCS))</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">          RCB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RCA || RCB) &#123;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RCA == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">            RCA = RCB;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">            RCB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NRegs = !!RCA + !!RCB;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RCA == RCB)</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">            RCB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Check we don&#39;t exceed register pressure at the destination.</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = &#42;UseInst.<a href="/docs/api/classes/llvm/machineinstr/#a1e855100f407ca4be098d0050be403b0">getParent</a>();</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RCB == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (registerPressureSetExceedsLimit(NRegs, RCA, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>))</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (registerPressureSetExceedsLimit(1, RCA, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) ||</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">                     registerPressureSetExceedsLimit(1, RCB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &#123;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">      SinkInto.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(&amp;UseInst, MaybeAM);</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkInto.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we know we can fold the instruction in all its users.</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;SinkDst, MaybeAM&#93; : SinkInto) &#123;</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sinking copy of&quot;</span><span class="doxyHighlight">; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.dump(); <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;into&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">               SinkDst-&gt;dump());</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkDst-&gt;isCopy()) &#123;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: After performing the sink-and-fold, the original instruction is</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// deleted. Its value is still available (in a hard register), so if there</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// are debug instructions which refer to the (now deleted) virtual</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// register they could be updated to refer to the hard register, in</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// principle. However, it&#39;s not clear how to do that, moreover in some</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// cases the debug instructions may need to be replicated proportionally</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to the number of the COPY instructions replaced and in some extreme</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// cases we can end up with quadratic increase in the number of debug</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instructions.</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Sink a copy of the instruction, replacing a COPY instruction.</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> InsertPt = SinkDst-&gt;getIterator();</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> DstReg = SinkDst-&gt;getOperand(0).getReg();</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;reMaterialize(&#42;SinkDst-&gt;getParent(), InsertPt, DstReg, 0, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = &amp;&#42;std::prev(InsertPt);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;getDebugLoc())</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;setDebugLoc(SinkDst-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The operand registers of the &quot;sunk&quot; instruction have their live range</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// extended and their kill flags may no longer be correct. Conservatively</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// clear the kill flags.</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedRegA)</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;clearKillFlags(UsedRegA);</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedRegB)</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;clearKillFlags(UsedRegB);</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Fold instruction into the addressing mode of a memory instruction.</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;emitLdStWithAddr(&#42;SinkDst, MaybeAM);</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The registers of the addressing mode may have their live range extended</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and their kill flags may no longer be correct. Conservatively clear the</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// kill flags.</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/register">Register</a> R = MaybeAM.<a href="/docs/api/structs/llvm/extaddrmode/#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>; <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isValid() &amp;&amp; <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isVirtual())</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;clearKillFlags(R);</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/register">Register</a> R = MaybeAM.<a href="/docs/api/structs/llvm/extaddrmode/#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>; <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isValid() &amp;&amp; <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isVirtual())</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;clearKillFlags(R);</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;yielding&quot;</span><span class="doxyHighlight">; <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;dump());</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clear the StoreInstrCache, since we may invalidate it by erasing.</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkDst-&gt;mayStore() &amp;&amp; !SinkDst-&gt;hasOrderedMemoryRef())</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">      StoreInstrCache.clear();</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">    SinkDst-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect operands that need to be cleaned up because the registers no longer</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exist (in COPYs and debug instructions). We cannot delete instructions or</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// clear operands while traversing register uses.</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand &#42;&gt;</a> <a href="/docs/api/files/lib/lib/debuginfod/httpclient-cpp/#a0b91b2b50d54e38aa1e8e31e56c31357">Cleanup</a>;</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DefReg);</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;use&#95;operands(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;U = MO.<a href="/docs/api/classes/llvm/machineinstr/#a1e855100f407ca4be098d0050be403b0">getParent</a>();</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((U-&gt;isCopy() || U-&gt;isDebugInstr()) &amp;&amp;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Only debug uses and copies must remain&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (U-&gt;isCopy())</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(U-&gt;getOperand(0).getReg());</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/debuginfod/httpclient-cpp/#a0b91b2b50d54e38aa1e8e31e56c31357">Cleanup</a>.push&#95;back(&amp;MO);</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete the dead COPYs and clear operands in debug instructions</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &#42;MO : <a href="/docs/api/files/lib/lib/debuginfod/httpclient-cpp/#a0b91b2b50d54e38aa1e8e31e56c31357">Cleanup</a>) &#123;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MO-&gt;getParent();</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isCopy()) &#123;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">      MO-&gt;setReg(0);</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">      MO-&gt;setSubReg(0);</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.eraseFromParent();</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlightComment">/// AllUsesDominatedByBlock - Return true if all uses of the specified register</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlightComment">/// occur in blocks dominated by the specified block. If any use is in the</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlightComment">/// definition block, then return false since it is never legal to move def</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlightComment">/// after uses.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::AllUsesDominatedByBlock(<a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>,</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;DefMBB,</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;BreakPHIEdge,</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;LocalUse)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isVirtual() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Only makes sense for vregs&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignore debug uses because debug info doesn&#39;t affect the code.</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;use&#95;nodbg&#95;empty(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>))</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BreakPHIEdge is true if all the uses are in the successor MBB being sunken</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into and they are all PHI nodes. In this case, machine-sink must break</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the critical edge first. e.g.</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.1:</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Predecessors according to CFG: %bb.0</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ...</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %def = DEC64&#95;32r %x, implicit-def dead %eflags</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ...</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     JE&#95;4 &lt;%bb.37&gt;, implicit %eflags</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Successors according to CFG: %bb.37 %bb.2</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.2:</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %p = PHI %y, %bb.0, %def, %bb.1</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;use&#95;nodbg&#95;operands(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO) &#123;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">        MachineInstr &#42;UseInst = MO.getParent();</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">        unsigned OpNo = MO.getOperandNo();</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">        MachineBasicBlock &#42;UseBlock = UseInst-&gt;getParent();</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">        return UseBlock == MBB &amp;&amp; UseInst-&gt;isPHI() &amp;&amp;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">               UseInst-&gt;getOperand(OpNo + 1).getMBB() == DefMBB;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">      &#125;)) &#123;</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">    BreakPHIEdge = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;use&#95;nodbg&#95;operands(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine the block of the use.</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;UseInst = MO.<a href="/docs/api/classes/llvm/machineoperand/#a9719077fcba2cd439e84897257a47bb0">getParent</a>();</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo = &amp;MO - &amp;UseInst-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(0);</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;UseBlock = UseInst-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a1e855100f407ca4be098d0050be403b0">getParent</a>();</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad43bf1af480830a4d6604e969e3f38e9">isPHI</a>()) &#123;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// PHI nodes use the operand in the predecessor block, not the block with</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the PHI.</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">      UseBlock = UseInst-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(OpNo + 1).<a href="/docs/api/classes/llvm/machineoperand/#a57e64b633278df75c699e6b98ce15031">getMBB</a>();</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseBlock == DefMBB) &#123;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">      LocalUse = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that it dominates.</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;dominates(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, UseBlock))</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlightComment">/// Return true if this machine instruction loads from global offset table or</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlightComment">/// constant pool.</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674" lineLink="#a304f762123a019d38d531483c00c796b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a304f762123a019d38d531483c00c796b">mayLoadFromGOTOrConstantPool</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayLoad() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected MI that loads!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we lost memory operands, conservatively assume that the instruction</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reads from everything..</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.memoperands&#95;empty())</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42;<a href="/docs/api/structs/llvm/memop">MemOp</a> : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.memoperands())</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/pseudosourcevalue">PseudoSourceValue</a> &#42;PSV = <a href="/docs/api/structs/llvm/memop">MemOp</a>-&gt;getPseudoValue())</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PSV-&gt;isGOT() || PSV-&gt;isConstantPool())</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MachineSinking::FindCycleSinkCandidates(</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;Candidates) &#123;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: Analysing candidate: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isMetaInstruction()) &#123;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: not sinking meta instruction\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;shouldSink(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: Instruction not a candidate for this &quot;</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;target\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a186cd7587b668062d1cbf36fd03c24da">isCycleInvariant</a>(<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: Instruction is not cycle invariant\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DontMoveAcrossStore = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isSafeToMove(DontMoveAcrossStore)) &#123;</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: Instruction not safe to move.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayLoad() &amp;&amp; !<a href="/docs/api/files/lib/lib/codegen/machinelicm-cpp/#a304f762123a019d38d531483c00c796b">mayLoadFromGOTOrConstantPool</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: Dont sink GOT or constant pool loads\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isConvergent())</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(0);</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() || !MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>() || !MO.<a href="/docs/api/classes/llvm/machineoperand/#a75eb135014670ce946e78739cdc9b51b">isDef</a>())</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;hasOneDef(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>()))</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: Instruction added as candidate.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">    Candidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#af56efb8509ab5b039fe9dcf0c4f5eccd"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/machinesinking/#af56efb8509ab5b039fe9dcf0c4f5eccd">MachineSinking::runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>()))</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42; Machine Sinking &#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">  STI = &amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>();</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  TII = STI-&gt;<a href="/docs/api/classes/llvm/targetsubtargetinfo/#acd858ed72f11db9444617740c3622608">getInstrInfo</a>();</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">  TRI = STI-&gt;getRegisterInfo();</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  MRI = &amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>();</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  DT = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineDominatorTreeWrapperPass&gt;</a>().getDomTree();</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">  PDT = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachinePostDominatorTreeWrapperPass&gt;</a>().getPostDomTree();</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">  CI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineCycleInfoWrapperPass&gt;</a>().getCycleInfo();</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">  PSI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;</a>().getPSI();</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  MBFI = <a href="#ae8a57b53e1029a66423f1c8beeee72b8">UseBlockFreqInfo</a></span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">             ? &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineBlockFrequencyInfoWrapperPass&gt;</a>().getMBFI()</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">             : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">  MBPI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineBranchProbabilityInfoWrapperPass&gt;</a>().getMBPI();</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">  AA = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;AAResultsWrapperPass&gt;</a>().getAAResults();</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  RegClassInfo.runOnMachineFunction(MF);</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a> &#42;PassConfig = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetPassConfig&gt;</a>();</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  EnableSinkAndFold = PassConfig-&gt;<a href="/docs/api/classes/llvm/targetpassconfig/#a49fdb99198ddc005e696a35f7abc7d22">getEnableSinkAndFold</a>();</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EverMadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Process all basic blocks.</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">    CEBCandidates.clear();</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    CEMergeCandidates.clear();</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">    ToSplit.clear();</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF)</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">      MadeChange |= ProcessBlock(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have anything we marked as toSplit, split it now.</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinedomtreeupdater">MachineDomTreeUpdater</a> MDTU(DT, PDT,</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">                               MachineDomTreeUpdater::UpdateStrategy::Lazy);</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : ToSplit) &#123;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NewSucc =</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">          Pair.first-&gt;SplitCriticalEdge(Pair.second, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &amp;MDTU);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewSucc != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; Splitting critical edge: &quot;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">                          &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;Pair.first) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; -- &quot;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">                          &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;NewSucc) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; -- &quot;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">                          &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;Pair.second) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBFI)</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">          MBFI-&gt;onEdgeSplit(&#42;Pair.first, &#42;NewSucc, &#42;MBPI);</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">        MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">        ++NumSplit;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">        CI-&gt;splitCriticalEdge(Pair.first, Pair.second, NewSucc);</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; Not legal to break critical edge\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this iteration over the code changed anything, keep iterating.</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MadeChange)</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    EverMadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a33ac72ad86d97fe56d3ef6668df30680">SinkInstsIntoCycle</a>) &#123;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineCycle &#42;, 8&gt;</a> Cycles(CI-&gt;toplevel&#95;cycles());</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    SchedModel.init(STI);</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasHighPressure;</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SinkItem, MachineInstr &#42;&gt;</a> SunkInstrs;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> CycleSinkStage &#123; COPY, LOW&#95;LATENCY, AGGRESSIVE, END &#125;;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Stage = CycleSinkStage::COPY; Stage != CycleSinkStage::END;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">         ++Stage, SunkInstrs.<a href="/docs/api/classes/llvm/densemapbase/#adf4e7878fc0b3b8dcde545178564190d">clear</a>()) &#123;</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">      HasHighPressure = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a> : Cycles) &#123;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Preheader = <a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>-&gt;getCyclePreheader();</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Preheader) &#123;</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink: Can&#39;t find preheader\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineInstr &#42;, 8&gt;</a> Candidates;</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">        FindCycleSinkCandidates(<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>, Preheader, Candidates);</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0;</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Walk the candidates in reverse order so that we start with the use</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// of a def-use chain, if there is any.</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: Sort the candidates using a cost-model.</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(Candidates)) &#123;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// CycleSinkStage::COPY: Sink a limited number of copies</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Stage == CycleSinkStage::COPY) &#123;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (i++ == <a href="#a084ec12a6f4a9e62a9fef7d321250c12">SinkIntoCycleLimit</a>) &#123;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">                         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CycleSink:   Limit reached of instructions to &quot;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;be analyzed.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isCopy())</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// CycleSinkStage::LOW&#95;LATENCY: sink unlimited number of instructions</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// which the target specifies as low-latency</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Stage == CycleSinkStage::LOW&#95;LATENCY &amp;&amp;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">              !TII-&gt;hasLowDefLatency(SchedModel, &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0))</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!aggressivelySinkIntoCycle(<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>, &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SunkInstrs))</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">          EverMadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">          ++NumCycleSunk;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Recalculate the pressure after sinking</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasHighPressure)</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">          HasHighPressure = registerPressureExceedsLimit(&#42;Preheader);</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasHighPressure)</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">  HasStoreCache.clear();</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">  StoreInstrCache.clear();</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now clear any kill flags for recorded registers.</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : RegsToClearKillFlags)</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    MRI-&gt;clearKillFlags(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">  RegsToClearKillFlags.clear();</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EverMadeChange;</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::ProcessBlock(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!EnableSinkAndFold &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.succ&#95;size() &lt;= 1) || <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.empty())</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t bother sinking code out of unreachable blocks. In addition to being</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unprofitable, it can also lead to infinite looping, because in an</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unreachable cycle there may be nowhere to stop.</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;isReachableFromEntry(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>))</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cache all successors, sorted by frequency info and cycle depth.</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">  AllSuccsCache AllSuccessors;</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the basic block bottom-up.  Remember if we saw a store.</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end();</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">  --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ProcessedBegin, SawStore = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>; </span><span class="doxyHighlightComment">// The instruction to sink.</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Predecrement I (if it&#39;s not begin) so that it isn&#39;t invalidated by</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sinking.</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">    ProcessedBegin = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin();</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ProcessedBegin)</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">      --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugOrPseudoInstr() || <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isFakeUse()) &#123;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugValue())</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">        ProcessDbgInst(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EnableSinkAndFold &amp;&amp; PerformSinkAndFold(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &#123;</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t sink anything out of a block that has less than two successors.</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.succ&#95;size() &lt;= 1)</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PerformTrivialForwardCoalescing(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &#123;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sink-cpp/#afa4c018bf923954bfd4ce5b6bf15b68b">SinkInstruction</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, SawStore, AllSuccessors)) &#123;</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">      ++NumSunk;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we just processed the first instruction in the block, we&#39;re done.</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!ProcessedBegin);</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">  SeenDbgUsers.clear();</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  SeenDbgVars.clear();</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// recalculate the bb register pressure after sinking one BB.</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  CachedRegisterPressure.clear();</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MachineSinking::ProcessDbgInst(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When we see DBG&#95;VALUEs for registers, record any vreg it reads, so that</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we know what to sink if the vreg def sinks.</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugValue() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected DBG&#95;VALUE for processing&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a> Var(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getDebugVariable(), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getDebugExpression(),</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">                    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getDebugLoc()-&gt;getInlinedAt());</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SeenBefore = SeenDbgVars.contains(Var);</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.debug&#95;operands()) &#123;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() &amp;&amp; MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>().<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>())</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">      SeenDbgUsers&#91;MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>()&#93;.push&#95;back(SeenDbgUser(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, SeenBefore));</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record the variable for any DBG&#95;VALUE, to avoid re-ordering any of them.</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  SeenDbgVars.insert(Var);</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::isWorthBreakingCriticalEdge(</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;From, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;To,</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;&amp;DeferredFromBlock) &#123;</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Need much better heuristics.</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the pass has already considered breaking this edge (during this pass</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// through the function), then let&#39;s go ahead and break it. This means</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sinking multiple &quot;cheap&quot; instructions into the same block.</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CEBCandidates.insert(std::make&#95;pair(From, To)).second)</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCopy() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isAsCheapAsAMove(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check and record the register and the destination block we want to sink</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into. Note that we want to do the following before the next check on branch</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// probability. Because we want to record the initial candidate even if it&#39;s</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// on hot edge, so that other candidates that might not on hot edges can be</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sinked as well.</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;defs()) &#123;</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> SrcReg = <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isVirtual() ? <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;lookThruCopyLike(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>) : <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a> = std::make&#95;pair(SrcReg, To);</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Res = CEMergeCandidates.try&#95;emplace(<a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>, From);</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We wanted to sink the same register into the same block, consider it to</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be profitable.</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Res.second) &#123;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Return the source block that was previously held off.</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">      DeferredFromBlock = Res.first-&gt;second;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (From-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(To) &amp;&amp;</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">      MBPI-&gt;getEdgeProbability(From, To) &lt;=</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(<a href="#a9e692ddc4d0481e2ca501d7600f8b328">SplitEdgeProbabilityThreshold</a>, 100))</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// MI is cheap, we probably don&#39;t want to break the critical edge for it.</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// However, if this would allow some definitions of its source operands</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to be sunk then it&#39;s probably worth it.</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;uses()) &#123;</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == 0)</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We don&#39;t move live definitions of physical registers,</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// so sinking their uses won&#39;t enable any opportunities.</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical())</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this instruction is the only user of a virtual register,</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// check if breaking the edge will enable sinking</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// both this instruction and the defining instruction.</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;hasOneNonDBGUse(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the definition resides in same MBB,</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// claim it&#39;s likely we can sink these together.</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If definition resides elsewhere, we aren&#39;t</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// blocking it from being sunk so don&#39;t break the edge.</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getVRegDef(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>-&gt;getParent() == <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent())</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Let the target decide if it&#39;s worth breaking this</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// critical edge for a &quot;cheap&quot; instruction.</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;shouldBreakCriticalEdgeToSink(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::isLegalToBreakCriticalEdge(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;FromBB,</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ToBB,</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">                                                </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BreakPHIEdge) &#123;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid breaking back edge. From == To means backedge for single BB cycle.</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a222c2bec99b5fc7d68f675248e085cd2">SplitEdges</a> || FromBB == ToBB || !FromBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(ToBB))</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;FromCycle = CI-&gt;getCycle(FromBB);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;ToCycle = CI-&gt;getCycle(ToBB);</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for backedges of more &quot;complex&quot; cycles.</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FromCycle == ToCycle &amp;&amp; FromCycle &amp;&amp;</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">      (!FromCycle-&gt;isReducible() || FromCycle-&gt;getHeader() == ToBB))</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s not always legal to break critical edges and sink the computation</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the edge.</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.1:</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// v1024</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Beq %bb.3</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &lt;fallthrough&gt;</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.2:</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ... no uses of v1024</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &lt;fallthrough&gt;</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.3:</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       = v1024</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If %bb.1 -&gt; %bb.3 edge is broken and computation of v1024 is inserted:</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.1:</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bne %bb.2</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.4:</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// v1024 =</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// B %bb.3</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.2:</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ... no uses of v1024</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &lt;fallthrough&gt;</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %bb.3:</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       = v1024</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is incorrect since v1024 is not computed along the %bb.1-&gt;%bb.2-&gt;%bb.3</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// flow. We need to ensure the new basic block where the computation is</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sunk to dominates all the uses.</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s only legal to break critical edge and sink the computation to the</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// new block if all the predecessors of &quot;To&quot;, except for &quot;From&quot;, are</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not dominated by &quot;From&quot;. Given SSA property, this means these</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors are dominated by &quot;To&quot;.</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There is no need to do this check if all the uses are PHI nodes. PHI</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sources are only defined on the specific predecessor edges.</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BreakPHIEdge) &#123;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : ToBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>())</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != FromBB &amp;&amp; !DT-&gt;dominates(ToBB, Pred))</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::PostponeSplitCriticalEdge(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;FromBB,</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ToBB,</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BreakPHIEdge) &#123;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/status">Status</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;DeferredFromBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isWorthBreakingCriticalEdge(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, FromBB, ToBB, DeferredFromBB)) &#123;</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is a DeferredFromBB, we consider FromBB only if &#95;both&#95;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of them are legal to split.</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!DeferredFromBB ||</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">         ToSplit.count(std::make&#95;pair(DeferredFromBB, ToBB)) ||</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">         isLegalToBreakCriticalEdge(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, DeferredFromBB, ToBB, BreakPHIEdge)) &amp;&amp;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">        isLegalToBreakCriticalEdge(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, FromBB, ToBB, BreakPHIEdge)) &#123;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">      ToSplit.insert(std::make&#95;pair(FromBB, ToBB));</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DeferredFromBB)</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">        ToSplit.insert(std::make&#95;pair(DeferredFromBB, ToBB));</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">      <a href="/docs/api/structs/status">Status</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/status">Status</a>;</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">std::vector&lt;unsigned&gt; &amp;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">MachineSinking::getBBRegisterPressure(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseCache) &#123;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Currently to save compiling time, MBB&#39;s register pressure will not change</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in one ProcessBlock iteration because of CachedRegisterPressure. but MBB&#39;s</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register pressure is changed after sinking any instructions into it.</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: need a accurate and cheap register pressure estiminate model here.</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/aarch64/#a2a1421dcee7067c8a9c69752bd8ec566ac401e282e73314903acd9d817e07bde4">RP</a> = CachedRegisterPressure.find(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseCache &amp;&amp; RP != CachedRegisterPressure.end())</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/aarch64/#a2a1421dcee7067c8a9c69752bd8ec566ac401e282e73314903acd9d817e07bde4">RP</a>-&gt;second;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/regionpressure">RegionPressure</a> Pressure;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/regpressuretracker">RegPressureTracker</a> RPTracker(Pressure);</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize the register pressure tracker.</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">  RPTracker.init(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent(), &amp;RegClassInfo, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end(),</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">                 </span><span class="doxyHighlightComment">/&#42;TrackLaneMasks&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;TrackUntiedDefs=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> MII = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.instr&#95;end(),</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">                                         MIE = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.instr&#95;begin();</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">       MII != MIE; --MII) &#123;</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = &#42;std::prev(MII);</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr() || <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isPseudoProbe())</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/registeroperands">RegisterOperands</a> RegOpers;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">    RegOpers.<a href="/docs/api/classes/llvm/registeroperands/#a74e0a918c9705f23a1e5b66f68cc97e9">collect</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    RPTracker.recedeSkipDebugValues();</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;&#42;RPTracker.getPos() == &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;RPTracker sync error!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">    RPTracker.recede(RegOpers);</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">  RPTracker.closeRegion();</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RP != CachedRegisterPressure.end()) &#123;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    CachedRegisterPressure&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93; = RPTracker.getPressure().MaxSetPressure;</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CachedRegisterPressure&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = CachedRegisterPressure.insert(</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">      std::make&#95;pair(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, RPTracker.getPressure().MaxSetPressure));</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It.first-&gt;second;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::registerPressureSetExceedsLimit(</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NRegs, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RC,</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#aede9c090bfa516420939d4240fad8248">Weight</a> = NRegs &#42; <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;getRegClassWeight(RC).RegWeight;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> &#42;PS = <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;getRegClassPressureSets(RC);</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">  std::vector&lt;unsigned&gt; BBRegisterPressure = getBBRegisterPressure(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; &#42;PS != -1; PS++)</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Weight + BBRegisterPressure&#91;&#42;PS&#93; &gt;=</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">        RegClassInfo.getRegPressureSetLimit(&#42;PS))</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlightComment">// Recalculate RP and check if any pressure set exceeds the set limit.</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::registerPressureExceedsLimit(</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">  std::vector&lt;unsigned&gt; BBRegisterPressure = getBBRegisterPressure(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PS = 0; PS &lt; BBRegisterPressure.size(); ++PS) &#123;</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBRegisterPressure&#91;PS&#93; &gt;=</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">        <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;getRegPressureSetLimit(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent(), PS)) &#123;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlightComment">/// isProfitableToSinkTo - Return true if it is profitable to sink MI.</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::isProfitableToSinkTo(<a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccToSinkTo,</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">                                          AllSuccsCache &amp;AllSuccessors) &#123;</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SuccToSinkTo &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid SinkTo Candidate BB&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> == SuccToSinkTo)</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is profitable if SuccToSinkTo does not post dominate current block.</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PDT-&gt;dominates(SuccToSinkTo, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>))</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is profitable to sink an instruction from a deeper cycle to a shallower</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cycle, even if the latter post-dominates the former (PR21115).</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;getCycleDepth(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &gt; CI-&gt;getCycleDepth(SuccToSinkTo))</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if only use in post dominated block is PHI instruction.</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NonPHIUse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;UseInst : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;use&#95;nodbg&#95;instructions(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;UseBlock = UseInst.<a href="/docs/api/classes/llvm/machineinstr/#a1e855100f407ca4be098d0050be403b0">getParent</a>();</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseBlock == SuccToSinkTo &amp;&amp; !UseInst.<a href="/docs/api/classes/llvm/machineinstr/#ad43bf1af480830a4d6604e969e3f38e9">isPHI</a>())</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">      NonPHIUse = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NonPHIUse)</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If SuccToSinkTo post dominates then also it may be profitable if MI</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can further profitably sinked into another block in next round.</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BreakPHIEdge = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME - If finding successor is compile time expensive then cache results.</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBB2 =</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">          FindSuccToSinkTo(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, SuccToSinkTo, BreakPHIEdge, AllSuccessors))</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> isProfitableToSinkTo(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, SuccToSinkTo, MBB2, AllSuccessors);</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;MCycle = CI-&gt;getCycle(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the instruction is not inside a cycle, it is not profitable to sink MI</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to a post dominate block SuccToSinkTo.</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MCycle)</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this instruction is inside a Cycle and sinking this instruction can make</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// more registers live range shorten, it is still prifitable.</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore non-register operands.</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>())</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == 0)</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical()) &#123;</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t handle non-constant and non-ignorable physical register uses.</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a69544ec8658eadeed98245dc37c3a541">isUse</a>() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;isConstantPhysReg(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>) &amp;&amp;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">          !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isIgnorableUse(MO))</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Users for the defs are all dominated by SuccToSinkTo.</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a75eb135014670ce946e78739cdc9b51b">isDef</a>()) &#123;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This def register&#39;s live range is shortened after sinking.</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LocalUse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllUsesDominatedByBlock(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, SuccToSinkTo, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BreakPHIEdge,</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">                                   LocalUse))</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getVRegDef(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>)</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a> = CI-&gt;getCycle(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>-&gt;getParent());</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// DefMI is defined outside of cycle. There should be no live range</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// impact for this operand. Defination outside of cycle means:</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// 1: defination is outside of cycle.</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// 2: defination is in this cycle, but it is a PHI in the cycle header.</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a> != MCycle || (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>-&gt;isPHI() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>-&gt;isReducible() &amp;&amp;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">                              <a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>-&gt;getHeader() == <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>-&gt;getParent()))</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The DefMI is defined inside the cycle.</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If sinking this operand makes some register pressure set exceed limit,</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it is not profitable.</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (registerPressureSetExceedsLimit(1, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>),</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">                                          &#42;SuccToSinkTo)) &#123;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;register pressure exceed limit, not profitable.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If MI is in cycle and all its operands are alive across the whole cycle or</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if no operand sinking make register pressure set exceed limit, it is</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// profitable to sink MI.</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlightComment">/// Get the sorted sequence of successors for this MachineBasicBlock, possibly</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlightComment">/// computing it if it was not already cached.</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> &amp;</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">MachineSinking::GetAllSortedSuccessors(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">                                       AllSuccsCache &amp;AllSuccessors)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do we have the sorted successors in cache ?</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Succs = AllSuccessors.find(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succs != AllSuccessors.end())</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Succs-&gt;second;</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> AllSuccs(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;successors());</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle cases where sinking can happen but where the sink point isn&#39;t a</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor. For example:</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   x = computation</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   if () &#123;&#125; else &#123;&#125;</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   use x</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a94b65b831ad8756f7d3a029a1e599f75">MachineDomTreeNode</a> &#42;DTChild : DT-&gt;getNode(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)-&gt;children()) &#123;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// DomTree children of MBB that have MBB as immediate dominator are added.</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTChild-&gt;getIDom()-&gt;getBlock() == <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent() &amp;&amp;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Skip MBBs already added to the AllSuccs vector above.</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">        !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;isSuccessor(DTChild-&gt;getBlock()))</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">      AllSuccs.push&#95;back(DTChild-&gt;getBlock());</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort Successors according to their cycle depth or block frequency info.</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">      AllSuccs, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;L, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;R) &#123;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">        uint64&#95;t LHSFreq = MBFI ? MBFI-&gt;getBlockFreq(L).getFrequency() : 0;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">        uint64&#95;t RHSFreq = MBFI ? MBFI-&gt;getBlockFreq(R).getFrequency() : 0;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, PSI, MBFI) ||</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">            (!LHSFreq &amp;&amp; !RHSFreq))</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CI-&gt;getCycleDepth(L) &lt; CI-&gt;getCycleDepth(R);</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHSFreq &lt; RHSFreq;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> it = AllSuccessors.insert(std::make&#95;pair(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, AllSuccs));</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> it.first-&gt;second;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlightComment">/// FindSuccToSinkTo - Find a successor to sink this instruction to.</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">MachineSinking::FindSuccToSinkTo(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;BreakPHIEdge,</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">                                 AllSuccsCache &amp;AllSuccessors) &#123;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid MachineBasicBlock!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop over all the operands of the specified instruction.  If there is</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// anything we can&#39;t handle, bail out.</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SuccToSinkTo - This is the successor to sink this instruction to, once we</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// decide.</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccToSinkTo = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>())</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Ignore non-register operands.</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == 0)</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical()) &#123;</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a69544ec8658eadeed98245dc37c3a541">isUse</a>()) &#123;</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the physreg has no defs anywhere, it&#39;s just an ambient register</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// and we can freely move its uses. Alternatively, if it&#39;s allocatable,</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// it could get allocated to something with a def during allocation.</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;isConstantPhysReg(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>) &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isIgnorableUse(MO))</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#aaee820701392c55ad54235d3d7201206">isDead</a>()) &#123;</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// A def that isn&#39;t dead. We can&#39;t move it.</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Virtual register uses are always safe to sink.</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a69544ec8658eadeed98245dc37c3a541">isUse</a>())</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If it&#39;s not safe to move defs of the register class, then abort.</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isSafeToMoveRegClassDefs(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)))</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Virtual register defs can only be sunk if all their uses are in blocks</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dominated by one of the successors.</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccToSinkTo) &#123;</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If a previous operand picked a block to sink to, then this operand</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// must be sinkable to the same block.</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LocalUse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllUsesDominatedByBlock(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, SuccToSinkTo, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BreakPHIEdge,</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">                                     LocalUse))</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise, we should look at all the successors and decide which one</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we should sink to. If we have reliable block frequency information</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (frequency != 0) available, give successors with smaller frequencies</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// higher priority, otherwise prioritize smaller cycle depths.</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccBlock :</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">           GetAllSortedSuccessors(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, AllSuccessors)) &#123;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LocalUse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllUsesDominatedByBlock(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, SuccBlock, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BreakPHIEdge,</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">                                    LocalUse)) &#123;</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">          SuccToSinkTo = SuccBlock;</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LocalUse)</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Def is used locally, it&#39;s never safe to move this def.</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we couldn&#39;t find a block to sink to, ignore this instruction.</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccToSinkTo)</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isProfitableToSinkTo(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, SuccToSinkTo, AllSuccessors))</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is not possible to sink an instruction into its own block.  This can</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// happen with cycles.</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> == SuccToSinkTo)</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s not safe to sink instructions to EH landing pad. Control flow into</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// landing pad is implicitly defined.</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccToSinkTo &amp;&amp; SuccToSinkTo-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>())</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It ought to be okay to sink instructions into an INLINEASM&#95;BR target, but</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only if we make sure that MI occurs &#95;before&#95; an INLINEASM&#95;BR instruction in</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the source block (which this code does not yet do). So for now, forbid</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// doing so.</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccToSinkTo &amp;&amp; SuccToSinkTo-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a00e55a6b6b44b739e9da1d62f1d8a5b3">isInlineAsmBrIndirectTarget</a>())</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccToSinkTo &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isSafeToSink(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, SuccToSinkTo, CI))</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SuccToSinkTo;</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlightComment">/// Return true if MI is likely to be usable as a memory operation by the</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlightComment">/// implicit null check optimization.</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlightComment">/// This is a &quot;best effort&quot; heuristic, and should not be relied upon for</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlightComment">/// correctness.  This returning true does not guarantee that the implicit null</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlightComment">/// check optimization is legal over MI, and this returning false does not</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlightComment">/// guarantee MI cannot possibly be used to do a null check.</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426" lineLink="#a316803c463af8ba2c38182332fb3c8a4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a316803c463af8ba2c38182332fb3c8a4">SinkingPreventsImplicitNullCheck</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>,</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) &#123;</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">MachineBranchPredicate = <a href="/docs/api/structs/llvm/targetinstrinfo/machinebranchpredicate">TargetInstrInfo::MachineBranchPredicate</a>;</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent();</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;pred&#95;size() != 1)</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredMBB = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;pred&#95;begin();</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredBB = PredMBB-&gt;getBasicBlock();</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Frontends that don&#39;t use implicit null checks have no reason to emit</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branches with make.implicit metadata, and this function should always</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return false for them.</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredBB ||</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">      !PredBB-&gt;getTerminator()-&gt;getMetadata(LLVMContext::MD&#95;make&#95;implicit))</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &#42;BaseOp;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OffsetIsScalable;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getMemOperandWithOffset(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, BaseOp, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, OffsetIsScalable, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>))</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BaseOp-&gt;<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>())</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayLoad() &amp;&amp; !<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isPredicable()))</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">  MachineBranchPredicate MBP;</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranchPredicate(&#42;PredMBB, MBP, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MBP.LHS.isReg() &amp;&amp; MBP.RHS.isImm() &amp;&amp; MBP.RHS.getImm() == 0 &amp;&amp;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">         (MBP.Predicate == MachineBranchPredicate::PRED&#95;NE ||</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">          MBP.Predicate == MachineBranchPredicate::PRED&#95;EQ) &amp;&amp;</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">         MBP.LHS.getReg() == BaseOp-&gt;<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlightComment">/// If the sunk instruction is a copy, try to forward the copy instead of</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlightComment">/// leaving an &#39;undef&#39; DBG&#95;VALUE in the original location. Don&#39;t do this if</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlightComment">/// there&#39;s any subregister weirdness involved. Returns true if copy</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlightComment">/// propagation occurred.</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471" lineLink="#ab07fa640d6b044c04371e8cc8bde6a02"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab07fa640d6b044c04371e8cc8bde6a02">attemptDebugCopyProp</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;SinkInst, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;DbgMI,</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>) &#123;</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = SinkInst.<a href="/docs/api/classes/llvm/machineinstr/#ab05719438bdf4b46871e5ecd9730caeb">getMF</a>()-&gt;<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>();</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a> = &#42;SinkInst.<a href="/docs/api/classes/llvm/machineinstr/#ab05719438bdf4b46871e5ecd9730caeb">getMF</a>()-&gt;<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#acd858ed72f11db9444617740c3622608">getInstrInfo</a>();</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy DBG&#95;VALUE operand and set the original to undef. We then check to</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// see whether this is something that can be copy-forwarded. If it isn&#39;t,</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// continue around the loop.</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &#42;SrcMO = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;DstMO = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CopyOperands = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>.isCopyInstr(SinkInst);</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CopyOperands)</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">  SrcMO = CopyOperands-&gt;Source;</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  DstMO = CopyOperands-&gt;Destination;</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check validity of forwarding this copy.</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PostRA = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.getNumVirtRegs() == 0;</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Trying to forward between physical and virtual registers is too hard.</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isVirtual() != SrcMO-&gt;<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>().<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>())</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only try virtual register copy-forwarding before regalloc, and physical</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register copy-forwarding after regalloc.</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> arePhysRegs = !<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isVirtual();</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (arePhysRegs != PostRA)</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pre-regalloc, only forward if all subregisters agree (or there are no</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// subregs at all). More analysis might recover some forwardable copies.</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PostRA)</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DbgMO : DbgMI.<a href="/docs/api/classes/llvm/machineinstr/#a05c54bfb75dbb555ab457e768bbcfe73">getDebugOperandsForReg</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>))</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgMO.getSubReg() != SrcMO-&gt;<a href="/docs/api/classes/llvm/machineoperand/#a028a8c5113d40d8c3f4427053bf36738">getSubReg</a>() ||</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">          DbgMO.getSubReg() != DstMO-&gt;getSubReg())</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Post-regalloc, we may be sinking a DBG&#95;VALUE of a sub or super-register</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of this copy. Only forward the copy if the DBG&#95;VALUE operand exactly</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// matches the copy destination.</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PostRA &amp;&amp; <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> != DstMO-&gt;getReg())</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DbgMO : DbgMI.<a href="/docs/api/classes/llvm/machineinstr/#a05c54bfb75dbb555ab457e768bbcfe73">getDebugOperandsForReg</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">    DbgMO.setReg(SrcMO-&gt;<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>());</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">    DbgMO.setSubReg(SrcMO-&gt;<a href="/docs/api/classes/llvm/machineoperand/#a028a8c5113d40d8c3f4427053bf36738">getSubReg</a>());</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521" lineLink="#a1f5758149387a098afa23bf386888618"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="#a1f5758149387a098afa23bf386888618">MIRegs</a> = std::pair&lt;MachineInstr &#42;, SmallVector&lt;unsigned, 2&gt;&gt;;</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlightComment">/// Sink an instruction and its associated debug instructions.</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523" lineLink="#a1e64ed92fc7b343fa59c28105e16b794"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a1e64ed92fc7b343fa59c28105e16b794">performSink</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;SuccToSinkTo,</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> InsertPos,</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;MIRegs&gt;</a> DbgValuesToSink) &#123;</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we cannot find a location to use (merge with), then we erase the debug</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// location to prevent debug-info driven tools from potentially reporting</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// wrong location information.</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccToSinkTo.<a href="/docs/api/classes/llvm/machinebasicblock/#a095ce2d870dadf620a4c887ecc0efef8">empty</a>() &amp;&amp; InsertPos != SuccToSinkTo.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>())</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.setDebugLoc(<a href="/docs/api/classes/llvm/dilocation/#a78cc51c415c7e64b5efe2c8458fbd35a">DILocation::getMergedLocation</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getDebugLoc(),</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">                                                 InsertPos-&gt;getDebugLoc()));</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.setDebugLoc(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move the instruction.</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ParentBlock = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent();</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">  SuccToSinkTo.<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(InsertPos, ParentBlock, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">                      ++<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>));</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sink a copy of debug users to the insert position. Mark the original</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DBG&#95;VALUE location as &#39;undef&#39;, indicating that any earlier variable</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// location should be terminated as we&#39;ve optimised away the value at this</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// point.</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DbgValueToSink : DbgValuesToSink) &#123;</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;DbgMI = DbgValueToSink.first;</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;NewDbgMI = DbgMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ab05719438bdf4b46871e5ecd9730caeb">getMF</a>()-&gt;CloneMachineInstr(DbgMI);</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">    SuccToSinkTo.<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(InsertPos, NewDbgMI);</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PropagatedAllSunkOps = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> : DbgValueToSink.second) &#123;</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DbgMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a067c1c89704407541cbed8d65ac8dd66">hasDebugOperandForReg</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ab07fa640d6b044c04371e8cc8bde6a02">attemptDebugCopyProp</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &#42;DbgMI, <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">          PropagatedAllSunkOps = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PropagatedAllSunkOps)</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">      DbgMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a0cf83915bd66f2a610c72f3d028f8704">setDebugValueUndef</a>();</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlightComment">/// hasStoreBetween - check if there is store betweeen straight line blocks From</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlightComment">/// and To.</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::hasStoreBetween(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;From,</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;To, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure From and To are in straight line which means From dominates To</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and To post dominates From.</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;dominates(From, To) || !PDT-&gt;dominates(To, From))</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BlockPair = std::make&#95;pair(From, To);</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Does these two blocks pair be queried before and have a definite cached</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// result?</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = HasStoreCache.find(BlockPair); It != HasStoreCache.end())</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It-&gt;second;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = StoreInstrCache.find(BlockPair); It != StoreInstrCache.end())</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">llvm::any&#95;of</a>(It-&gt;second, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">      return I-&gt;mayAlias(AA, MI, false);</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SawStore = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasAliasedStore = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;MachineBasicBlock &#42;&gt;</a> HandledBlocks;</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;MachineBasicBlock &#42;&gt;</a> HandledDomBlocks;</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Go through all reachable blocks from From.</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#ad6e19a09aeed4c56617c284e099c81de">depth&#95;first</a>(From)) &#123;</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We insert the instruction at the start of block To, so no need to worry</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// about stores inside To.</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Store in block From should be already considered when just enter function</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SinkInstruction.</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB == To || BB == From)</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We already handle this BB in previous iteration.</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HandledBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(BB))</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">    HandledBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(BB);</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// To post dominates BB, it must be a path from block From.</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PDT-&gt;dominates(To, BB)) &#123;</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HandledDomBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(BB))</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">        HandledDomBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(BB);</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this BB is too big or the block number in straight line between From</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and To is too big, stop searching to save compiling time.</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;sizeWithoutDebugLargerThan(<a href="#a001e53bb2ff322656f27e267f2409a06">SinkLoadInstsPerBlockThreshold</a>) ||</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">          HandledDomBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>() &gt; <a href="#a341405fd2cb2dfad3d03b4f76b1a577b">SinkLoadBlocksThreshold</a>) &#123;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DomBB : HandledDomBlocks) &#123;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DomBB != BB &amp;&amp; DT-&gt;dominates(DomBB, BB))</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">            HasStoreCache&#91;std::make&#95;pair(DomBB, To)&#93; = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DomBB != BB &amp;&amp; DT-&gt;dominates(BB, DomBB))</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">            HasStoreCache&#91;std::make&#95;pair(From, DomBB)&#93; = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">        HasStoreCache&#91;BlockPair&#93; = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Treat as alias conservatively for a call or an ordered memory</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// operation.</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isCall() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.hasOrderedMemoryRef()) &#123;</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DomBB : HandledDomBlocks) &#123;</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DomBB != BB &amp;&amp; DT-&gt;dominates(DomBB, BB))</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">              HasStoreCache&#91;std::make&#95;pair(DomBB, To)&#93; = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DomBB != BB &amp;&amp; DT-&gt;dominates(BB, DomBB))</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">              HasStoreCache&#91;std::make&#95;pair(From, DomBB)&#93; = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">          HasStoreCache&#91;BlockPair&#93; = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayStore()) &#123;</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">          SawStore = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// We still have chance to sink MI if all stores between are not</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// aliased to MI.</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Cache all store instructions, so that we don&#39;t need to go through</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// all From reachable blocks for next load instruction.</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayAlias(<a href="/docs/api/namespaces/llvm/aa">AA</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">            HasAliasedStore = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">          StoreInstrCache&#91;BlockPair&#93;.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is no store at all, cache the result.</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SawStore)</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">    HasStoreCache&#91;BlockPair&#93; = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HasAliasedStore;</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlightComment">/// Aggressively sink instructions into cycles. This will aggressively try to</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlightComment">/// sink all instructions in the top-most preheaders in an attempt to reduce RP.</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlightComment">/// In particular, it will sink into multiple successor blocks without limits</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlightComment">/// based on the amount of sinking, or the type of ops being sunk (so long as</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlightComment">/// they are safe to sink).</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::aggressivelySinkIntoCycle(</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#af2582bc073a57bab10916632073e24cd">MachineCycle</a> &#42;<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SinkItem, MachineInstr &#42;&gt;</a> &amp;SunkInstrs) &#123;</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: support instructions with multiple defs</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumDefs() &gt; 1)</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AggressiveCycleSink: Finding sink block for: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>-&gt;getCyclePreheader() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Cycle sink needs a preheader block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;RegSubRegPair, MachineInstr &#42;&gt;</a>&gt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;DefMO = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0);</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;use&#95;instructions(DefMO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>())) &#123;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(&#123;&#123;DefMO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>(), DefMO.<a href="/docs/api/classes/llvm/machineoperand/#a028a8c5113d40d8c3f4427053bf36738">getSubReg</a>()&#125;, &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>&#125;);</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;RegSubRegPair, MachineInstr &#42;&gt; Entry : <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>) &#123;</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.second;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AggressiveCycleSink:   Analysing use: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;isPHI()) &#123;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AggressiveCycleSink:   Not attempting to sink for PHI.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We cannot sink before the prologue</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;isPosition() || <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isBasicBlockPrologue(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AggressiveCycleSink:   Use is BasicBlock prologue, &quot;</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;can&#39;t sink.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a60dc5ae8be8d73033ce099677e645b9b">Cycle</a>-&gt;contains(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent())) &#123;</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AggressiveCycleSink:   Use not in cycle, can&#39;t sink.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SinkBlock = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent();</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;NewMI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">    SinkItem MapEntry(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SinkBlock);</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/si">SI</a> = SunkInstrs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(MapEntry);</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check for the case in which we have already sunk a copy of this</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction into the user block.</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a> != SunkInstrs.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AggressiveCycleSink:   Already sunk to block: &quot;</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;SinkBlock) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">      NewMI = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;second;</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a copy of the instruction in the use block.</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewMI) &#123;</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AggressiveCycleSink: Sinking instruction to block: &quot;</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;SinkBlock) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">      NewMI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMF()-&gt;CloneMachineInstr(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefMO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>().<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>()) &#123;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;TRC = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getRegClass(DefMO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>());</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/register">Register</a> DestReg = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;createVirtualRegister(TRC);</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">        NewMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a9f59e1f6dd6677348ba082a10fc09061">substituteRegister</a>(DefMO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>(), DestReg, DefMO.<a href="/docs/api/classes/llvm/machineoperand/#a028a8c5113d40d8c3f4427053bf36738">getSubReg</a>(),</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">                                  &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">      SinkBlock-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(SinkBlock-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3be7d94076d328797ab57ce09cefab33">SkipPHIsAndLabels</a>(SinkBlock-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>()),</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">                        NewMI);</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">      SunkInstrs.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;MapEntry, NewMI&#125;);</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Conservatively clear any kill flags on uses of sunk instruction</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : NewMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a3daf8e155bf0aa3e65b5260bfe3698c5">all&#95;uses</a>()) &#123;</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() &amp;&amp; MO.<a href="/docs/api/classes/llvm/machineoperand/#a69544ec8658eadeed98245dc37c3a541">isUse</a>());</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">      RegsToClearKillFlags.insert(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>());</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The instruction is moved from its basic block, so do not retain the</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// debug information.</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!NewMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a42020afbcac5113c831c00294a0ac37f">isDebugInstr</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should not sink debug inst&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">    NewMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#af2641f071128da26317fab5b9594ec71">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace the use with the newly created virtual register.</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">    <a href="#a16005492b382a6a76abae848b4af2b83">RegSubRegPair</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a02230ca194a9c8e52170cc7c426decb2">UseReg</a> = <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first;</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;substituteRegister(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a02230ca194a9c8e52170cc7c426decb2">UseReg</a>.Reg, NewMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(0).<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>(),</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">                           <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a02230ca194a9c8e52170cc7c426decb2">UseReg</a>.SubReg, &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have replaced all uses, then delete the dead instruction</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isDead(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>))</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.eraseFromParent();</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlightComment">/// SinkInstruction - Determine whether it is safe to sink the specified machine</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlightComment">/// instruction out of its current block into a successor.</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MachineSinking::SinkInstruction(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;SawStore,</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">                                     AllSuccsCache &amp;AllSuccessors) &#123;</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t sink instructions that the target prefers not to sink.</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;shouldSink(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if it&#39;s safe to move the instruction.</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isSafeToMove(SawStore))</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convergent operations may not be made control-dependent on additional</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isConvergent())</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t break implicit null checks.  This is a performance heuristic, and not</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// required for correctness.</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a316803c463af8ba2c38182332fb3c8a4">SinkingPreventsImplicitNullCheck</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>))</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This should include support for sinking instructions within the</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block they are currently in to shorten the live ranges.  We often get</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions sunk into the top of a large block, but it would be better to</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// also sink them down before their first use in the block.  This xform has to</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be careful not to &#42;increase&#42; register pressure though, e.g. sinking</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;x = y + z&quot; down if it kills y and z would increase the live ranges of y</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and z and only shrink the live range of x.</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BreakPHIEdge = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ParentBlock = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent();</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccToSinkTo =</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">      FindSuccToSinkTo(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ParentBlock, BreakPHIEdge, AllSuccessors);</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are no outputs, it must have side-effects.</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccToSinkTo)</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the instruction to move defines a dead physical register which is live</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when leaving the basic block, don&#39;t move it because it could turn into a</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;zombie&quot; define of that preg. E.g., EFLAGS.</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;defs()) &#123;</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == 0 || !<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical())</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccToSinkTo-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#af9745f59d6647bd43f9f7959ca1a9971">isLiveIn</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>))</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sink instr &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tinto block &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SuccToSinkTo);</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the block has multiple predecessors, this is a critical edge.</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Decide if we can sink along it or need to break the edge.</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccToSinkTo-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>() &gt; 1) &#123;</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We cannot sink a load across a critical edge - there may be stores in</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other code paths.</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TryBreak = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a> =</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayLoad() ? hasStoreBetween(ParentBlock, SuccToSinkTo, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) : <a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isSafeToMove(Store)) &#123;</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; NOTE: Won&#39;t sink load along critical edge.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">      TryBreak = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We don&#39;t want to sink across a critical edge if we don&#39;t dominate the</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// successor. We could be introducing calculations to new code paths.</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TryBreak &amp;&amp; !DT-&gt;dominates(ParentBlock, SuccToSinkTo)) &#123;</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; NOTE: Critical edge found\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">      TryBreak = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t sink instructions into a cycle.</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TryBreak &amp;&amp; CI-&gt;getCycle(SuccToSinkTo) &amp;&amp;</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">        (!CI-&gt;getCycle(SuccToSinkTo)-&gt;isReducible() ||</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">         CI-&gt;getCycle(SuccToSinkTo)-&gt;getHeader() == SuccToSinkTo)) &#123;</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; NOTE: cycle header found\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">      TryBreak = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise we are OK with sinking along a critical edge.</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TryBreak)</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sinking along critical edge.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark this edge as to be split.</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the edge can actually be split, the next iteration of the main loop</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// will sink MI in the newly created block.</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/status">Status</a> = PostponeSplitCriticalEdge(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ParentBlock, SuccToSinkTo,</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">                                              BreakPHIEdge);</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/status">Status</a>)</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; PUNTING: Not legal or profitable to &quot;</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">                             </span><span class="doxyHighlightStringLiteral">&quot;break critical edge\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The instruction will not be sunk this time.</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BreakPHIEdge) &#123;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BreakPHIEdge is true if all the uses are in the successor MBB being</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sunken into and they are all PHI nodes. In this case, machine-sink must</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// break the critical edge first.</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/status">Status</a> =</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">        PostponeSplitCriticalEdge(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ParentBlock, SuccToSinkTo, BreakPHIEdge);</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/status">Status</a>)</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; PUNTING: Not legal or profitable to &quot;</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;break critical edge\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The instruction will not be sunk this time.</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine where to insert into. Skip phi nodes.</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> InsertPos =</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">      SuccToSinkTo-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3be7d94076d328797ab57ce09cefab33">SkipPHIsAndLabels</a>(SuccToSinkTo-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>());</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a854df6024334d02ea223f70a543940fc">blockPrologueInterferes</a>(SuccToSinkTo, InsertPos, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>)) &#123;</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; Not sinking: prologue interference\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect debug users of any vreg that this inst defines.</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MIRegs, 4&gt;</a> DbgUsersToSink;</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;defs()) &#123;</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>().<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>())</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = SeenDbgUsers.find(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>());</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It == SeenDbgUsers.end())</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Sink any users that don&#39;t pass any other DBG&#95;VALUEs for this variable.</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a> = It-&gt;second;</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/user">User</a> : <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>) &#123;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;DbgMI = <a href="/docs/api/classes/llvm/user">User</a>.getPointer();</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a>.getInt()) &#123;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This DBG&#95;VALUE would re-order assignments. If we can&#39;t copy-propagate</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// it, it can&#39;t be recovered. Set it undef.</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ab07fa640d6b044c04371e8cc8bde6a02">attemptDebugCopyProp</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &#42;DbgMI, MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>()))</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">          DbgMI-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a0cf83915bd66f2a610c72f3d028f8704">setDebugValueUndef</a>();</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">        DbgUsersToSink.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">            &#123;DbgMI, <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a>(1, MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>())&#125;);</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After sinking, some debug users may not be dominated any more. If possible,</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// copy-propagate their operands. As it&#39;s expensive, don&#39;t do this if there&#39;s</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// no debuginfo in the program.</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getMF()-&gt;getFunction().getSubprogram() &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCopy())</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">    SalvageUnsunkDebugUsersOfCopy(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, SuccToSinkTo);</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">  <a href="#a1e64ed92fc7b343fa59c28105e16b794">performSink</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &#42;SuccToSinkTo, InsertPos, DbgUsersToSink);</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Conservatively, clear any kill flags, since it&#39;s possible that they are no</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// longer correct.</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that we have to clear the kill flags for any register this instruction</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// uses as we may sink over another instruction which currently kills the</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// used registers.</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;uses())</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">    RegsToClearKillFlags.insert(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>()); </span><span class="doxyHighlightComment">// Remember to clear kill flags.</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MachineSinking::SalvageUnsunkDebugUsersOfCopy(</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;TargetBlock) &#123;</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCopy());</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(1).isReg());</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Enumerate all users of vreg operands that are def&#39;d. Skip those that will</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be sunk. For the rest, if they are not dominated by the block we will sink</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// MI into, propagate the copy source to them.</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineInstr &#42;, 4&gt;</a> DbgDefUsers;</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Register, 4&gt;</a> DbgUseRegs;</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getMF()-&gt;getRegInfo();</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;defs()) &#123;</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>().<a href="/docs/api/classes/llvm/register/#ab203bbcbc320180b1da9e9a92ee0c784">isVirtual</a>())</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">    DbgUseRegs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>());</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/user">User</a> : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.use&#95;instructions(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>())) &#123;</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/user">User</a>.isDebugValue() || DT-&gt;dominates(TargetBlock, <a href="/docs/api/classes/llvm/user">User</a>.getParent()))</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If is in same block, will either sink or be use-before-def.</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a>.getParent() == <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent())</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/user">User</a>.hasDebugOperandForReg(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;DBG&#95;VALUE user of vreg, but has no operand for it?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">      DbgDefUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Point the users of this copy that are no longer dominated, at the source</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the copy.</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/user">User</a> : DbgDefUsers) &#123;</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> : DbgUseRegs) &#123;</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/structs/livedebugvalues/dbgop">DbgOp</a> : <a href="/docs/api/classes/llvm/user">User</a>-&gt;getDebugOperandsForReg(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">        <a href="/docs/api/structs/livedebugvalues/dbgop">DbgOp</a>.setReg(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(1).getReg());</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">        <a href="/docs/api/structs/livedebugvalues/dbgop">DbgOp</a>.setSubReg(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(1).getSubReg());</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlightComment">// This pass is not intended to be a replacement or a complete alternative</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlightComment">// for the pre-ra machine sink pass. It is only designed to sink COPY</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlightComment">// instructions which should be handled after RA.</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlightComment">// This pass sinks COPY instructions into a successor block, if the COPY is not</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlightComment">// used in the current block and the COPY is live-in to a single successor</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlightComment">// (i.e., doesn&#39;t require the COPY to be duplicated).  This avoids executing the</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlightComment">// copy on paths where their results aren&#39;t needed.  This also exposes</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlightComment">// additional opportunites for dead copy elimination and shrink wrapping.</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlightComment">// These copies were either not handled by or are inserted after the MachineSink</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlightComment">// pass. As an example of the former case, the MachineSink pass cannot sink</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlightComment">// COPY instructions with allocatable source registers; for AArch64 these type</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlightComment">// of copy instructions are frequently used to move function parameters (PhyReg)</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlightComment">// into virtual registers in the entry block.</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlightComment">// For the machine IR below, this pass will sink %w19 in the entry into its</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlightComment">// successor (%bb.1) because %w19 is only live-in in %bb.1.</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlightComment">// %bb.0:</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlightComment">//   %wzr = SUBSWri %w1, 1</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlightComment">//   %w19 = COPY %w0</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlightComment">//   Bcc 11, %bb.2</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlightComment">// %bb.1:</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlightComment">//   Live Ins: %w19</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlightComment">//   BL @fun</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlightComment">//   %w0 = ADDWrr %w0, %w19</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlightComment">//   RET %w0</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlightComment">// %bb.2:</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlightComment">//   %w0 = COPY %wzr</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlightComment">//   RET %w0</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlightComment">// As we sink %w19 (CSR in AArch64) into %bb.1, the shrink-wrapping pass will be</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlightComment">// able to see %bb.0 as a candidate.</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a53b3ee5230ccda9f23ce692e4d3c77fc">PostRAMachineSinking</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a1f860254ea2183299eecbd087f61d405">runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a6526f65de7091f693483e9169558057a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a6526f65de7091f693483e9169558057a">ID</a>;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a53b3ee5230ccda9f23ce692e4d3c77fc"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a53b3ee5230ccda9f23ce692e4d3c77fc">PostRAMachineSinking</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a6526f65de7091f693483e9169558057a">ID</a>) &#123;&#125;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#ae348e955190549f2484c385ab057b03b"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#ae348e955190549f2484c385ab057b03b">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;PostRA Machine Sink&quot;</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a62d3eccd9992d21281a8a354bfe4074b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a62d3eccd9992d21281a8a354bfe4074b">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a3b73158cd3f0c7068d84d401ff29edf3"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a3b73158cd3f0c7068d84d401ff29edf3">getRequiredProperties</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a>().<a href="/docs/api/classes/llvm/machinefunctionproperties/#aa7780563d7ca260d0ae67d957b56427f">set</a>(</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinefunctionproperties/#ad85237c6c667e4713efe8921e9c32ac1a72f7d830dd5ddb30f06d8e9639558ac3">MachineFunctionProperties::Property::NoVRegs</a>);</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlightComment">  /// Track which register units have been modified and used.</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> ModifiedRegUnits, UsedRegUnits;</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlightComment">  /// Track DBG&#95;VALUEs of (unmodified) register units. Each DBG&#95;VALUE has an</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlightComment">  /// entry in this map for each unit it touches. The DBG&#95;VALUE&#39;s entry</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlightComment">  /// consists of a pointer to the instruction itself, and a vector of registers</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlightComment">  /// referred to by the instruction that overlap the key register unit.</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, SmallVector&lt;MIRegs, 2&gt;</a>&gt; SeenDbgInstrs;</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlightComment">  /// Sink Copy instructions unused in the same block close to their uses in</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlightComment">  /// successors.</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> tryToSinkCopy(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;BB, <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>);</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a6526f65de7091f693483e9169558057a">PostRAMachineSinking::ID</a> = 0;</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023" lineLink="/docs/api/namespaces/llvm/#a8d5462b10402ee83291fda8b0b74f437"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#a8d5462b10402ee83291fda8b0b74f437">llvm::PostRAMachineSinkingID</a> = <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a6526f65de7091f693483e9169558057a">PostRAMachineSinking::ID</a>;</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025" lineLink="#aa1a94d15096ac1fd1fd21d1af9187761"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#af807c9595d50b45c0008924c4679c85c">INITIALIZE&#95;PASS</a>(<a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a53b3ee5230ccda9f23ce692e4d3c77fc">PostRAMachineSinking</a>, </span><span class="doxyHighlightStringLiteral">&quot;postra-machine-sink&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;PostRA Machine Sink&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028" lineLink="#a359e1ff26f6d466d927a61aae45b05c3"><span class="doxyHighlight">static </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> aliasWithRegsInLiveIn(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>,</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029" lineLink="#a0f36ed1bc17fc1aa97fe291c439a0698"><span class="doxyHighlight">                                  <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) &#123;</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> LiveInRegUnits(&#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031" lineLink="#a074843b524f0a9bfd420219cd3cb10cd"><span class="doxyHighlight">  LiveInRegUnits.<a href="/docs/api/classes/llvm/liveregunits/#ae06ac34235924f41c0072e7f895b3605">addLiveIns</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032" lineLink="#a40cc6a0e0895fa564ee013923209aa85"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !LiveInRegUnits.<a href="/docs/api/classes/llvm/liveregunits/#a3996f7c3774880bfe32422602fe34f9c">available</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036" lineLink="#acf8fc7aec1c211309bcfdadf5471efc5"><span class="doxyHighlight"><a href="#acf8fc7aec1c211309bcfdadf5471efc5">getSingleLiveInSuccBB</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;CurBB,</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;SinkableBBs,</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) &#123;</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to find a single sinkable successor in which Reg is live-in.</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> : SinkableBBs) &#123;</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (aliasWithRegsInLiveIn(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>)) &#123;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If BB is set here, Reg is live-in to at least two sinkable successors,</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// so quit.</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB)</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">      BB = <a href="/docs/api/namespaces/llvm/si">SI</a>;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reg is not live-in to any sinkable successors.</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB)</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if any register aliased with Reg is live-in in other successors.</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> : CurBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SinkableBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>) &amp;&amp; aliasWithRegsInLiveIn(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>))</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BB;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063" lineLink="#a760cd0801dd2ecf5d8951c3c1db40ca8"><span class="doxyHighlight"><a href="#acf8fc7aec1c211309bcfdadf5471efc5">getSingleLiveInSuccBB</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;CurBB,</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;SinkableBBs,</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;unsigned&gt;</a> DefedRegsInCopy,</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) &#123;</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SingleBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DefReg : DefedRegsInCopy) &#123;</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB =</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">        <a href="#acf8fc7aec1c211309bcfdadf5471efc5">getSingleLiveInSuccBB</a>(CurBB, SinkableBBs, DefReg, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB || (SingleBB &amp;&amp; SingleBB != BB))</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">    SingleBB = BB;</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SingleBB;</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078" lineLink="#a084d504a7f8b42657e1c910ba098ad94"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a084d504a7f8b42657e1c910ba098ad94">clearKillFlags</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;CurBB,</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;unsigned&gt;</a> &amp;UsedOpsInCopy,</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> &amp;UsedRegUnits,</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) &#123;</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> U : UsedOpsInCopy) &#123;</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(U);</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> SrcReg = MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UsedRegUnits.<a href="/docs/api/classes/llvm/liveregunits/#a3996f7c3774880bfe32422602fe34f9c">available</a>(SrcReg)) &#123;</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> NI = std::next(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getIterator());</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;UI : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(NI, CurBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>())) &#123;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI.killsRegister(SrcReg, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>)) &#123;</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">          UI.clearRegisterKills(SrcReg, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">          MO.<a href="/docs/api/classes/llvm/machineoperand/#a8a82683fccdef8a5ef772ef03277aee7">setIsKill</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098" lineLink="#a6c1da13a967ff01e9076c55b0b6d158c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a6c1da13a967ff01e9076c55b0b6d158c">updateLiveIn</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccBB,</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;unsigned&gt;</a> &amp;UsedOpsInCopy,</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;unsigned&gt;</a> &amp;DefedRegsInCopy) &#123;</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#a43c530c830206ecf5ad3359364634c75">getRegisterInfo</a>();</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DefReg : DefedRegsInCopy)</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aad72cfbb210808985a9dc19f4e5d8542">MCPhysReg</a> S : <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;subregs&#95;inclusive(DefReg))</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">      SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a668e2f48294f63416c8f28072e531c33">removeLiveIn</a>(S);</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> U : UsedOpsInCopy)</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">    SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(U).getReg());</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">  SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a9ff557f73ac8f2608369d70b3c73e525">sortUniqueLiveIns</a>();</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111" lineLink="#a5523ffd2d5ced60566f3493c2b48e0e3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a5523ffd2d5ced60566f3493c2b48e0e3">hasRegisterDependency</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;unsigned&gt;</a> &amp;UsedOpsInCopy,</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;unsigned&gt;</a> &amp;DefedRegsInCopy,</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> &amp;ModifiedRegUnits,</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/liveregunits">LiveRegUnits</a> &amp;UsedRegUnits) &#123;</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasRegDependency = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getNumOperands(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(i);</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>())</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>();</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a75eb135014670ce946e78739cdc9b51b">isDef</a>()) &#123;</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ModifiedRegUnits.<a href="/docs/api/classes/llvm/liveregunits/#a3996f7c3774880bfe32422602fe34f9c">available</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>) || !UsedRegUnits.<a href="/docs/api/classes/llvm/liveregunits/#a3996f7c3774880bfe32422602fe34f9c">available</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">        HasRegDependency = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">      DefedRegsInCopy.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: instead of isUse(), readsReg() would be a better fix here,</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For example, we can ignore modifications in reg with undef. However,</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it&#39;s not perfectly clear if skipping the internal read is safe in all</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// other targets.</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a69544ec8658eadeed98245dc37c3a541">isUse</a>()) &#123;</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ModifiedRegUnits.<a href="/docs/api/classes/llvm/liveregunits/#a3996f7c3774880bfe32422602fe34f9c">available</a>(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">        HasRegDependency = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">      UsedOpsInCopy.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(i);</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HasRegDependency;</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PostRAMachineSinking::tryToSinkCopy(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;CurBB,</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>) &#123;</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;MachineBasicBlock &#42;, 2&gt;</a> SinkableBBs;</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: For now, we sink only to a successor which has a single predecessor</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so that we can directly sink COPY instructions to the successor without</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// adding any new block or branch instruction.</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> : CurBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>())</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;livein&#95;empty() &amp;&amp; <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;pred&#95;size() == 1)</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">      SinkableBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkableBBs.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>())</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Track which registers have been modified and used between the end of the</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block and the current instruction.</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">  ModifiedRegUnits.clear();</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">  UsedRegUnits.clear();</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">  SeenDbgInstrs.clear();</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(CurBB))) &#123;</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Track the operand index for use in Copy.</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a> UsedOpsInCopy;</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Track the register number defed in Copy.</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a> DefedRegsInCopy;</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We must sink this DBG&#95;VALUE if its operand is sunk. To avoid searching</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for DBG&#95;VALUEs later, record them when they&#39;re encountered.</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugValue() &amp;&amp; !<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugRef()) &#123;</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;MCRegister, SmallVector&lt;unsigned, 2&gt;</a>, 4&gt; MIUnits;</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsValid = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.debug&#95;operands()) &#123;</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() &amp;&amp; MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>().<a href="/docs/api/classes/llvm/register/#affdbf5b92ed7e01352e2f39466efbe21">isPhysical</a>()) &#123;</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Bail if we can already tell the sink would be rejected, rather</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// than needlessly accumulating lots of DBG&#95;VALUEs.</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a5523ffd2d5ced60566f3493c2b48e0e3">hasRegisterDependency</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, UsedOpsInCopy, DefedRegsInCopy,</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">                                    ModifiedRegUnits, UsedRegUnits)) &#123;</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">            IsValid = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Record debug use of each reg unit.</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a8adc81fee7f9e66260dd2b626660c9c9">MCRegUnit</a> Unit : <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;regunits(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>()))</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">            MIUnits&#91;<a href="/docs/api/namespaces/anonymous-rustdemangle-cpp-/#a76a6de3bfe4b34e80479b5139aae1ab7a19c562a36aeb455d09534f93b4f5236f">Unit</a>&#93;.push&#95;back(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>());</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsValid) &#123;</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RegOps : MIUnits)</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">          SeenDbgInstrs&#91;RegOps.first&#93;.emplace&#95;back(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">                                                   std::move(RegOps.second));</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugOrPseudoInstr())</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not move any instruction across function call.</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCall())</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCopy() || !<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(0).isRenamable()) &#123;</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/liveregunits/#a06c3c14971a6414e21bf3a0a2652de0f">LiveRegUnits::accumulateUsedDefed</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ModifiedRegUnits, UsedRegUnits,</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">                                        <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t sink the COPY if it would violate a register dependency.</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a5523ffd2d5ced60566f3493c2b48e0e3">hasRegisterDependency</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, UsedOpsInCopy, DefedRegsInCopy,</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">                              ModifiedRegUnits, UsedRegUnits)) &#123;</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/liveregunits/#a06c3c14971a6414e21bf3a0a2652de0f">LiveRegUnits::accumulateUsedDefed</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ModifiedRegUnits, UsedRegUnits,</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">                                        <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!UsedOpsInCopy.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; !DefedRegsInCopy.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &amp;&amp;</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unexpect SrcReg or DefReg&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccBB =</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">        <a href="#acf8fc7aec1c211309bcfdadf5471efc5">getSingleLiveInSuccBB</a>(CurBB, SinkableBBs, DefedRegsInCopy, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t sink if we cannot find a single sinkable successor in which Reg</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is live-in.</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccBB) &#123;</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/liveregunits/#a06c3c14971a6414e21bf3a0a2652de0f">LiveRegUnits::accumulateUsedDefed</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ModifiedRegUnits, UsedRegUnits,</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">                                        <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>() == 1 &amp;&amp; &#42;SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab644fcf07a4c2708333cf66276282357">pred&#95;begin</a>() == &amp;CurBB) &amp;&amp;</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unexpected predecessor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect DBG&#95;VALUEs that must sink with this copy. We&#39;ve previously</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// recorded which reg units that DBG&#95;VALUEs read, if this instruction</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// writes any of those units then the corresponding DBG&#95;VALUEs must sink.</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;MachineInstr &#42;, MIRegs::second&#95;type&gt;</a> DbgValsToSinkMap;</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;defs()) &#123;</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a8adc81fee7f9e66260dd2b626660c9c9">MCRegUnit</a> Unit : <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;regunits(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>())) &#123;</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="#a1f5758149387a098afa23bf386888618">MIRegs</a> : SeenDbgInstrs.lookup(Unit)) &#123;</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Regs = DbgValsToSinkMap&#91;<a href="#a1f5758149387a098afa23bf386888618">MIRegs</a>.first&#93;;</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> : <a href="#a1f5758149387a098afa23bf386888618">MIRegs</a>.second)</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">            Regs.push&#95;back(<a href="#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DbgValsToSink = DbgValsToSinkMap.<a href="/docs/api/classes/llvm/mapvector/#a48284a35966b520c1da3a34a112726f5">takeVector</a>();</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Sink instr &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tinto block &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SuccBB);</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> InsertPos =</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">        SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3be7d94076d328797ab57ce09cefab33">SkipPHIsAndLabels</a>(SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>());</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a854df6024334d02ea223f70a543940fc">blockPrologueInterferes</a>(SuccBB, InsertPos, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/liveregunits/#a06c3c14971a6414e21bf3a0a2652de0f">LiveRegUnits::accumulateUsedDefed</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ModifiedRegUnits, UsedRegUnits,</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">                                        <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#42;&#42;&#42; Not sinking: prologue interference\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clear the kill flag if SrcReg is killed between MI and the end of the</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    <a href="#a084d504a7f8b42657e1c910ba098ad94">clearKillFlags</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, CurBB, UsedOpsInCopy, UsedRegUnits, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">    <a href="#a1e64ed92fc7b343fa59c28105e16b794">performSink</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &#42;SuccBB, InsertPos, DbgValsToSink);</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">    <a href="#a6c1da13a967ff01e9076c55b0b6d158c">updateLiveIn</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, SuccBB, UsedOpsInCopy, DefedRegsInCopy);</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">    ++NumPostRACopySink;</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275" lineLink="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a1f860254ea2183299eecbd087f61d405"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-machinesink-cpp-/postramachinesinking/#a1f860254ea2183299eecbd087f61d405">PostRAMachineSinking::runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>()))</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#a43c530c830206ecf5ad3359364634c75">getRegisterInfo</a>();</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#acd858ed72f11db9444617740c3622608">getInstrInfo</a>();</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">  ModifiedRegUnits.init(&#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">  UsedRegUnits.init(&#42;<a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>);</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : MF)</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= tryToSinkCopy(BB, MF, <a href="#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>);</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
