---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `DivRemPairs.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Scalar/DivRemPairs.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/divrempairs-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GlobalsModRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/DebugCounter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debugcounter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BypassSlowDivision.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/bypassslowdivision-h"
  isLocal="true" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-divrempairs-cpp-">anonymous&#123;DivRemPairs.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/expandedmatch">ExpandedMatch</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry">DivRemPairWorklistEntry</a></>}>
A thin wrapper to store two values that we matched as div-rem pair. <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#a52666b84652fc277b8a53aea9a4a2be0">DivRemWorklistTy</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; DivRemPairWorklistEntry, 4 &gt;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#aa89aea3953264c7ce68749d157ec1dd3">DEBUG&#95;COUNTER</a> (DRPCounter, &quot;div-rem-pairs-transform&quot;, &quot;Controls transformations in div-rem-pairs pass&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="#a52666b84652fc277b8a53aea9a4a2be0">DivRemWorklistTy</a></>}
  name={<><a href="#a4ea228d1a2a12e3dc0542b388e3e3492">getWorklist</a> (Function &amp;F)</>}>
Find matching pairs of integer div/rem ops (they have the same numerator, denominator, and signedness). <a href="#a4ea228d1a2a12e3dc0542b388e3e3492">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; ExpandedMatch &gt;</>}
  name={<><a href="#ad762896b80c211f6d9cacfe6f8438732">matchExpandedRem</a> (Instruction &amp;I)</>}>
See if we can match: (which is the form we expand into) X - ((X ? <a href="#ad762896b80c211f6d9cacfe6f8438732">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6e3883483a49e3be2520667d933b25f8">optimizeDivRem</a> (Function &amp;F, const TargetTransformInfo &amp;TTI, const DominatorTree &amp;DT)</>}>
Find matching pairs of integer div/rem ops (they have the same numerator, denominator, and signedness). <a href="#a6e3883483a49e3be2520667d933b25f8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2dce93455da9adba7bf8bcd3f1da1d2c">STATISTIC</a> (NumPairs, &quot;Number of div/rem pairs&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a67cf64501da50834568b8facf2db83d9">STATISTIC</a> (NumRecomposed, &quot;Number of instructions recomposed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a0fcd3873e0c9636a4519024a74e8bf73">STATISTIC</a> (NumHoisted, &quot;Number of instructions hoisted&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a8f08e4162fbf26db1595ed5cf7c2a235">STATISTIC</a> (NumDecomposed, &quot;Number of instructions decomposed&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;div-<a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#ac7752c64c2d688b882808f06328ad521">rem</a>-pairs&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### DivRemWorklistTy {#a52666b84652fc277b8a53aea9a4a2be0}

<MemberDefinition
  prototype={<>using DivRemWorklistTy =  SmallVector&lt;DivRemPairWorklistEntry, 4&gt;</>}>

Definition at line <a href="#l00115">115</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### DEBUG&#95;COUNTER() {#aa89aea3953264c7ce68749d157ec1dd3}

<MemberDefinition
  prototype={<>DEBUG&#95;COUNTER (DRPCounter, &quot;div-<a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#ac7752c64c2d688b882808f06328ad521">rem</a>-pairs-transform&quot;, &quot;Controls transformations in div-<a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#ac7752c64c2d688b882808f06328ad521">rem</a>-pairs pass&quot;)</>}>

Definition at line <a href="#l00036">36</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

### getWorklist() {#a4ea228d1a2a12e3dc0542b388e3e3492}

<MemberDefinition
  prototype={<>static DivRemWorklistTy getWorklist (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F)</>}
  labels = {["static"]}>
Find matching pairs of integer div/rem ops (they have the same numerator, denominator, and signedness).

Place those pairs into a worklist for further processing. This indirection is needed because we have to use <a href="/docs/api/classes/llvm/trackingvh">TrackingVH&lt;&gt;</a> because we will be doing RAUW, and if one of the rem instructions we change happens to be an input to another div/rem in the maps, we&#39;d have problems.

Definition at line <a href="#l00122">122</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

### matchExpandedRem() {#ad762896b80c211f6d9cacfe6f8438732}

<MemberDefinition
  prototype={<>static std::optional&lt; ExpandedMatch &gt; matchExpandedRem (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I)</>}
  labels = {["static"]}>
See if we can match: (which is the form we expand into) X - ((X ?

/ Y) &#42; Y) which is equivalent to: X ?% Y

Definition at line <a href="#l00050">50</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

### optimizeDivRem() {#a6e3883483a49e3be2520667d933b25f8}

<MemberDefinition
  prototype={<>static bool optimizeDivRem (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT)</>}
  labels = {["static"]}>
Find matching pairs of integer div/rem ops (they have the same numerator, denominator, and signedness).

If they exist in different basic blocks, bring them together by hoisting or replace the common division operation that is implicit in the remainder: X % Y &lt;--&gt; X - ((X / Y) &#42; Y).

We can largely ignore the normal safety and cost constraints on speculation of these ops when we find a matching pair. This is because we are already guaranteed that any exceptions and most cost are already incurred by the first member of the pair.

Note: This transform could be an oddball enhancement to EarlyCSE, GVN, or SimplifyCFG, but it&#39;s split off on its own because it&#39;s different enough that it doesn&#39;t quite match the stated objectives of those passes.

Definition at line <a href="#l00181">181</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2dce93455da9adba7bf8bcd3f1da1d2c}

<MemberDefinition
  prototype={<>STATISTIC (NumPairs, &quot;Number of div/<a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#ac7752c64c2d688b882808f06328ad521">rem</a> pairs&quot;)</>}>

Definition at line <a href="#l00032">32</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a67cf64501da50834568b8facf2db83d9}

<MemberDefinition
  prototype={<>STATISTIC (NumRecomposed, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> recomposed&quot;)</>}>

Definition at line <a href="#l00033">33</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a0fcd3873e0c9636a4519024a74e8bf73}

<MemberDefinition
  prototype={<>STATISTIC (NumHoisted, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> hoisted&quot;)</>}>

Definition at line <a href="#l00034">34</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a8f08e4162fbf26db1595ed5cf7c2a235}

<MemberDefinition
  prototype={<>STATISTIC (NumDecomposed, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> decomposed&quot;)</>}>

Definition at line <a href="#l00035">35</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;div-<a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#ac7752c64c2d688b882808f06328ad521">rem</a>-pairs&quot;</>}>

Definition at line <a href="#l00031">31</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/divrempairs-cpp">DivRemPairs.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- DivRemPairs.cpp - Hoist/&#91;dr&#93;ecompose division and remainder --------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This pass hoists and/or decomposes/recomposes integer division and remainder</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instructions to enable CFG improvements and better codegen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/divrempairs-h">llvm/Transforms/Scalar/DivRemPairs.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h">llvm/Analysis/GlobalsModRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debugcounter-h">llvm/Support/DebugCounter.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/bypassslowdivision-h">llvm/Transforms/Utils/BypassSlowDivision.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;optional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;div-rem-pairs&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32" lineLink="#a2dce93455da9adba7bf8bcd3f1da1d2c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPairs, </Highlight><Highlight kind="stringliteral">&quot;Number of div/rem pairs&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33" lineLink="#a67cf64501da50834568b8facf2db83d9"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumRecomposed, </Highlight><Highlight kind="stringliteral">&quot;Number of instructions recomposed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34" lineLink="#a0fcd3873e0c9636a4519024a74e8bf73"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumHoisted, </Highlight><Highlight kind="stringliteral">&quot;Number of instructions hoisted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35" lineLink="#a8f08e4162fbf26db1595ed5cf7c2a235"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDecomposed, </Highlight><Highlight kind="stringliteral">&quot;Number of instructions decomposed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36" lineLink="#aa89aea3953264c7ce68749d157ec1dd3"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/support/debugcounter-h/#a0a175e0c17c3f2a0570e919ab68da2a4">DEBUG&#95;COUNTER</a>(DRPCounter, </Highlight><Highlight kind="stringliteral">&quot;div-rem-pairs-transform&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal">              </Highlight><Highlight kind="stringliteral">&quot;Controls transformations in div-rem-pairs pass&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39" lineLink="/docs/api/namespaces/anonymous-divrempairs-cpp-"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/expandedmatch"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/expandedmatch">ExpandedMatch</a> &#123;</Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/expandedmatch/#a75d4aa84d042d1257063a41d51d543f2"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/divremmapkey">DivRemMapKey</a> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/expandedmatch/#a75d4aa84d042d1257063a41d51d543f2">Key</a>;</Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/expandedmatch/#a04d7bd8a1dc1d18b3e51541718e1831c"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/expandedmatch/#a04d7bd8a1dc1d18b3e51541718e1831c">Value</a>;</Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="comment">/// See if we can match: (which is the form we expand into)</Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="comment">///   X - ((X ?/ Y) &#42; Y)</Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="comment">/// which is equivalent to:</Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="comment">///   X ?% Y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50" lineLink="#ad762896b80c211f6d9cacfe6f8438732"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;ExpandedMatch&gt; <a href="#ad762896b80c211f6d9cacfe6f8438732">matchExpandedRem</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Dividend, &#42;XroundedDownToMultipleOfY;</Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Dividend), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(XroundedDownToMultipleOfY))))</Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Divisor;</Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Div;</Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look for  ((X / Y) &#42; Y)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal">          XroundedDownToMultipleOfY,</Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/patternmatch/#af10813bee5ce9c7b412807aac434deef">m&#95;c&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a469c3ed35e782000933c996ccd2d2333">m&#95;CombineAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a25e68280ed348917cd4b8657cac2be84">m&#95;IDiv</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Dividend), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Divisor)),</Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal">                               <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Div)),</Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal">                  <a href="/docs/api/namespaces/llvm/patternmatch/#a53fc7d443cf6412add6dfddd11652e5d">m&#95;Deferred</a>(Divisor))))</Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal">  ExpandedMatch M;</Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal">  M.Key.SignedOp = Div-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::SDiv;</Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal">  M.Key.Dividend = Dividend;</Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal">  M.Key.Divisor = Divisor;</Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal">  M.<a href="/docs/api/classes/llvm/value/#a18dbfcb332af7515599ee795cf462843">Value</a> = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> M;</Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="comment">/// A thin wrapper to store two values that we matched as div-rem pair.</Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="comment">/// We want this extra indirection to avoid dealing with RAUW&#39;ing the map keys.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a7bf99e89bd3b2fb202ce45b47f937f5f">DivRemPairWorklistEntry</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="comment">  /// The actual udiv/sdiv instruction. Source of truth.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/assertingvh">AssertingVH&lt;Instruction&gt;</a> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>;</Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="comment">  /// The instruction that we have matched as a remainder instruction.</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="comment">  /// Should only be used as Value, don&#39;t introspect it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a6707b2a44c7037ebc9ddc78d077d3033"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/assertingvh">AssertingVH&lt;Instruction&gt;</a> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a6707b2a44c7037ebc9ddc78d077d3033">RemInst</a>;</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a7bf99e89bd3b2fb202ce45b47f937f5f"><Highlight kind="normal">  <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a7bf99e89bd3b2fb202ce45b47f937f5f">DivRemPairWorklistEntry</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DivInst&#95;, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RemInst&#95;)</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal">      : <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>(DivInst&#95;), <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a6707b2a44c7037ebc9ddc78d077d3033">RemInst</a>(RemInst&#95;) &#123;</Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>-&gt;getOpcode() == Instruction::UDiv ||</Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal">            <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>-&gt;getOpcode() == Instruction::SDiv) &amp;&amp;</Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Not a division.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>-&gt;getType() == <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a6707b2a44c7037ebc9ddc78d077d3033">RemInst</a>-&gt;getType() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Types should match.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We can&#39;t check anything else about remainder instruction,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// it&#39;s not strictly required to be a urem/srem.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="comment">  /// The type for this pair, identical for both the div and rem.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a3eb82af2a28a92ba7ba5052d33d3636b"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a3eb82af2a28a92ba7ba5052d33d3636b">getType</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>-&gt;getType(); &#125;</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="comment">  /// Is this pair signed or unsigned?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ac56e5ffdf57413f50d194286bd10a5ee"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ac56e5ffdf57413f50d194286bd10a5ee">isSigned</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>-&gt;getOpcode() == Instruction::SDiv; &#125;</Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="comment">  /// In this pair, what are the divident and divisor?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a958d7088b97d7c24397301cb3acdda6a"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a958d7088b97d7c24397301cb3acdda6a">getDividend</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>-&gt;getOperand(0); &#125;</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a40942d9805e28d07cc6757498a249df9"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a40942d9805e28d07cc6757498a249df9">getDivisor</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#ab6af806f9720754bc375629980e66b0a">DivInst</a>-&gt;getOperand(1); &#125;</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104" lineLink="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a0008307062b6882f356b931cf143ba14"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a0008307062b6882f356b931cf143ba14">isRemExpanded</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a6707b2a44c7037ebc9ddc78d077d3033">RemInst</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// single &#39;rem&#39; instruction - unexpanded form.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// anything else means we have remainder in expanded form.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115" lineLink="#a52666b84652fc277b8a53aea9a4a2be0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="#a52666b84652fc277b8a53aea9a4a2be0">DivRemWorklistTy</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DivRemPairWorklistEntry, 4&gt;</a>;</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="comment">/// Find matching pairs of integer div/rem ops (they have the same numerator,</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="comment">/// denominator, and signedness). Place those pairs into a worklist for further</Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="comment">/// processing. This indirection is needed because we have to use TrackingVH&lt;&gt;</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="comment">/// because we will be doing RAUW, and if one of the rem instructions we change</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="comment">/// happens to be an input to another div/rem in the maps, we&#39;d have problems.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122" lineLink="#a4ea228d1a2a12e3dc0542b388e3e3492"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="#a52666b84652fc277b8a53aea9a4a2be0">DivRemWorklistTy</a> <a href="#a4ea228d1a2a12e3dc0542b388e3e3492">getWorklist</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert all divide and remainder instructions into maps keyed by their</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operands and opcode (signed or unsigned).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;DivRemMapKey, Instruction &#42;&gt;</a> DivMap;</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use a MapVector for RemMap so that instructions are moved/inserted in a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// deterministic order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;DivRemMapKey, Instruction &#42;&gt;</a> RemMap;</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == Instruction::SDiv)</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal">        DivMap&#91;<a href="/docs/api/structs/llvm/divremmapkey">DivRemMapKey</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1))&#93; = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == Instruction::UDiv)</Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal">        DivMap&#91;<a href="/docs/api/structs/llvm/divremmapkey">DivRemMapKey</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1))&#93; = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == Instruction::SRem)</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">        RemMap&#91;<a href="/docs/api/structs/llvm/divremmapkey">DivRemMapKey</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1))&#93; = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == Instruction::URem)</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">        RemMap&#91;<a href="/docs/api/structs/llvm/divremmapkey">DivRemMapKey</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1))&#93; = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a313a633eb3049b90e931206183e1251ea6da89265a9a8b0b28eb4946bb2ec0c6d">Match</a> = <a href="#ad762896b80c211f6d9cacfe6f8438732">matchExpandedRem</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">        RemMap&#91;<a href="/docs/api/namespaces/llvm/#a313a633eb3049b90e931206183e1251ea6da89265a9a8b0b28eb4946bb2ec0c6d">Match</a>-&gt;Key&#93; = <a href="/docs/api/namespaces/llvm/#a313a633eb3049b90e931206183e1251ea6da89265a9a8b0b28eb4946bb2ec0c6d">Match</a>-&gt;Value;</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We&#39;ll accumulate the matching pairs of div-rem instructions here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal">  <a href="#a52666b84652fc277b8a53aea9a4a2be0">DivRemWorklistTy</a> Worklist;</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can iterate over either map because we are only looking for matched</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// pairs. Choose remainders for efficiency because they are usually even more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// rare than division.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;RemPair : RemMap) &#123;</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find the matching division instruction from the division map.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = DivMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RemPair.first);</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It == DivMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We have a matching pair of div/rem instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">    NumPairs++;</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RemInst = RemPair.second;</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Place it in the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(It-&gt;second, RemInst);</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Worklist;</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="comment">/// Find matching pairs of integer div/rem ops (they have the same numerator,</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="comment">/// denominator, and signedness). If they exist in different basic blocks, bring</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="comment">/// them together by hoisting or replace the common division operation that is</Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="comment">/// implicit in the remainder:</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="comment">/// X % Y &lt;--&gt; X - ((X / Y) &#42; Y).</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="comment">/// We can largely ignore the normal safety and cost constraints on speculation</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="comment">/// of these ops when we find a matching pair. This is because we are already</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="comment">/// guaranteed that any exceptions and most cost are already incurred by the</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="comment">/// first member of the pair.</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="comment">/// Note: This transform could be an oddball enhancement to EarlyCSE, GVN, or</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="comment">/// SimplifyCFG, but it&#39;s split off on its own because it&#39;s different enough</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="comment">/// that it doesn&#39;t quite match the stated objectives of those passes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181" lineLink="#a6e3883483a49e3be2520667d933b25f8"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a6e3883483a49e3be2520667d933b25f8">optimizeDivRem</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT) &#123;</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the matching pairs of div-rem instructions. We want this extra</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// indirection to avoid dealing with having to RAUW the keys of the maps.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">  <a href="#a52666b84652fc277b8a53aea9a4a2be0">DivRemWorklistTy</a> Worklist = <a href="#a4ea228d1a2a12e3dc0542b388e3e3492">getWorklist</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Process each entry in the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/anonymous-namespace-divrempairs-cpp-/divrempairworklistentry/#a7bf99e89bd3b2fb202ce45b47f937f5f">DivRemPairWorklistEntry</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : Worklist) &#123;</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/debugcounter/#a5aace8653ce3726ef07194dcf6bce2bf">DebugCounter::shouldExecute</a>(DRPCounter))</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasDivRemOp = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.hasDivRemOp(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getType(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.isSigned());</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DivInst = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.DivInst;</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;RemInst = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.RemInst;</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RemOriginallyWasInExpandedForm = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.isRemExpanded();</Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">    (void)RemOriginallyWasInExpandedForm; </Highlight><Highlight kind="comment">// suppress unused variable warning</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasDivRemOp &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.isRemExpanded()) &#123;</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The target supports div+rem but the rem is expanded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We should recompose it first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getDividend();</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getDivisor();</Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RealRem = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.isSigned() ? BinaryOperator::CreateSRem(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">                                          : BinaryOperator::CreateURem(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Note that we place it right next to the original expanded instruction,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// and letting further handling to move it if needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">      RealRem-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(RemInst-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.recomposed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">      RealRem-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(RemInst-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OrigRemInst = RemInst;</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Update AssertingVH&lt;&gt; with new instruction so it doesn&#39;t assert.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">      RemInst = RealRem;</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// And replace the original instruction with the new one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal">      OrigRemInst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(RealRem);</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">      RealRem-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(OrigRemInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">      OrigRemInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">      NumRecomposed++;</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Note that we have left ((X / Y) &#42; Y) around.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If it had other uses we could rewrite it as X - X % Y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.isRemExpanded() || !HasDivRemOp) &amp;&amp;</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;&#42;If&#42; the target supports div-rem, then by now the RemInst &#42;is&#42; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Instruction::&#91;US&#93;Rem.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the target supports div+rem and the instructions are in the same block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// already, there&#39;s nothing to do. The backend should handle this. If the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// target does not support div+rem, then we will decompose the rem.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasDivRemOp &amp;&amp; RemInst-&gt;getParent() == DivInst-&gt;getParent())</Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> DivDominates = DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(DivInst, RemInst);</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DivDominates &amp;&amp; !DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(RemInst, DivInst)) &#123;</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We have matching div-rem pair, but they are in two different blocks,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// neither of which dominates one another.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DivBB = DivInst-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RemBB = RemInst-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It&#39;s only safe to hoist if every instruction before the Div/Rem in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// basic block is guaranteed to transfer execution.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsSafeToHoist = &#91;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DivOrRem, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ParentBB) &#123;</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ParentBB-&gt;begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = DivOrRem-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;</Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">             ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">      &#125;;</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Look for something like this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// PredBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   |  \\</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="comment">      //   |  Rem</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   |  /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//  Div</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the Rem block has a single predecessor and successor, and all paths</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// from PredBB go to either RemBB or DivBB, and execution of RemBB and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// DivBB will always reach the Div/Rem, we can hoist Div to PredBB. If</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we have a DivRem operation we can also hoist Rem. Otherwise we&#39;ll leave</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Rem where it is and rewrite it to mul/sub.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RemBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == DivBB) &#123;</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">        PredBB = RemBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>();</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Look for something like this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//     PredBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//     /    \\</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="comment">        //   Div   Rem</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the Rem and Din blocks share a unique predecessor, and all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// paths from PredBB go to either RemBB or DivBB, and execution of RemBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// and DivBB will always reach the Div/Rem, we can hoist Div to PredBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we have a DivRem operation we can also hoist Rem. By hoisting both</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// ops to the same block, we reduce code size and allow the DivRem to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// issue sooner. Without a DivRem op, this transformation is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// unprofitable because we would end up performing an extra Mul+Sub on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the Rem path.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RemPredBB = RemBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>()) &#123;</Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This hoist is only profitable when the target has a DivRem op.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasDivRemOp &amp;&amp; RemPredBB == DivBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>())</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">          PredBB = RemPredBB;</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// FIXME: We could handle more hoisting cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PredBB &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">          IsSafeToHoist(RemInst, RemBB) &amp;&amp; IsSafeToHoist(DivInst, DivBB) &amp;&amp;</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(PredBB),</Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">                 &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BB == DivBB || BB == RemBB; &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(DivBB),</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">                 &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BB == RemBB || BB == PredBB; &#125;)) &#123;</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">        DivDominates = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">        DivInst-&gt;moveBefore(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasDivRemOp) &#123;</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">          RemInst-&gt;moveBefore(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The target does not have a single div/rem operation,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and the rem is already in expanded form. Nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HasDivRemOp &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.isRemExpanded())</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasDivRemOp) &#123;</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The target has a single div/rem operation. Hoist the lower instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to make the matched pair visible to the backend.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DivDominates)</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal">        RemInst-&gt;moveAfter(DivInst);</Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">        DivInst-&gt;moveAfter(RemInst);</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">      NumHoisted++;</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The target does not have a single div/rem operation,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// and the rem is &#42;not&#42; in a already-expanded form.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Decompose the remainder calculation as:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// X % Y --&gt; X - ((X / Y) &#42; Y).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!RemOriginallyWasInExpandedForm &amp;&amp;</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;We should not be expanding if the rem was in expanded form to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;begin with.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getDividend();</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getDivisor();</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a> = BinaryOperator::CreateMul(DivInst, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Sub = BinaryOperator::CreateSub(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a>);</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the remainder dominates, then hoist the division up to that block:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bb1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %rem = srem %x, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bb2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %div = sdiv %x, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bb1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %div = sdiv %x, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %mul = mul %div, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %rem = sub %x, %mul</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the division dominates, it&#39;s already in the right place. The mul+sub</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// will be in a different block because we don&#39;t assume that they are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// cheap to speculatively execute:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bb1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %div = sdiv %x, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bb2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %rem = srem %x, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bb1:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %div = sdiv %x, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// bb2:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %mul = mul %div, %y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %rem = sub %x, %mul</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the div and rem are in the same block, we do the same transform,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// but any code movement would be within the same block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DivDominates)</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">        DivInst-&gt;moveBefore(RemInst-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a>-&gt;insertAfter(RemInst-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a>-&gt;setDebugLoc(RemInst-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">      Sub-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">      Sub-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(RemInst-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If DivInst has the exact flag, remove it. Otherwise this optimization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// may replace a well-defined value &#39;X % Y&#39; with poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">      DivInst-&gt;dropPoisonGeneratingFlags();</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If X can be undef, X should be frozen first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For example, let&#39;s assume that Y = 1 &amp; X = undef:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %div = sdiv undef, 1 // %div = undef</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %rem = srem undef, 1 // %rem = 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// =&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %div = sdiv undef, 1 // %div = undef</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %mul = mul %div, 1   // %mul = undef</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %rem = sub %x, %mul  // %rem = undef - undef = undef</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If X is not frozen, %rem becomes undef after transformation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a517c714fcc004112e359c1d4782dc021">isGuaranteedNotToBeUndef</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, DivInst, &amp;DT)) &#123;</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FrX =</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.frozen&quot;</Highlight><Highlight kind="normal">, DivInst-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">        FrX-&gt;setDebugLoc(DivInst-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">        DivInst-&gt;setOperand(0, FrX);</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal">        Sub-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, FrX);</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Same for Y. If X = 1 and Y = (undef | 1), %rem in src is either 1 or 0,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// but %rem in tgt can be one of many integer values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a517c714fcc004112e359c1d4782dc021">isGuaranteedNotToBeUndef</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, DivInst, &amp;DT)) &#123;</Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FrY =</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.frozen&quot;</Highlight><Highlight kind="normal">, DivInst-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">        FrY-&gt;setDebugLoc(DivInst-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">        DivInst-&gt;setOperand(1, FrY);</Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#ae0f503db91504a3f3440ab81260e4134">Mul</a>-&gt;setOperand(1, FrY);</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Now kill the explicit remainder. We have replaced it with:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// (sub X, (mul (div X, Y), Y)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">      Sub-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(RemInst-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.decomposed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OrigRemInst = RemInst;</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Update AssertingVH&lt;&gt; with new instruction so it doesn&#39;t assert.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">      RemInst = Sub;</Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// And replace the original instruction with the new one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">      OrigRemInst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Sub);</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal">      OrigRemInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">      NumDecomposed++;</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Pass manager boilerplate below here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423" lineLink="/docs/api/structs/llvm/divrempairspass/#a4247592199f0303b2d61eb171b2acdd1"><Highlight kind="normal"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/structs/llvm/divrempairspass/#a4247592199f0303b2d61eb171b2acdd1">DivRemPairsPass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">                                       <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>) &#123;</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT = <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a6e3883483a49e3be2520667d933b25f8">optimizeDivRem</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DT))</Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This pass just hoists/replaces math ops - all analyses are preserved?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PA;</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>

</DoxygenPage>
