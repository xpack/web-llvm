---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/anonymous-namespace-valuemapper-cpp-/mdnodemapper
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `MDNodeMapper` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Declaration

<CodeBlock>class anonymous_namespace{ValueMapper.cpp}::MDNodeMapper</CodeBlock>

## Public Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a332d6883ae1fe5af9bda81416f7bfbe0">MDNodeMapper</a> (Mapper &amp;M)</>}>
</MembersIndexItem>

</MembersIndex>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;</>}
  name={<><a href="#a19e14dd6bf8fd49e43925ade95aab06d">map</a> (const MDNode &amp;N)</>}>
Map a metadata node (and its transitive operands). <a href="#a19e14dd6bf8fd49e43925ade95aab06d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  template={<>template &lt;class OperandMapper&gt;</>}
  type="void"
  name={<><a href="#a7c38ca83c916472e5580992d97616ba9">remapOperands</a> (MDNode &amp;N, OperandMapper mapOperand)</>}>
</MembersIndexItem>

</MembersIndex>

## Private Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9dace28a02e57b477f817c9f9030a5fc">createPOT</a> (UniquedGraph &amp;G, const MDNode &amp;FirstN)</>}>
Create a post-order traversal of an unmapped uniqued node subgraph. <a href="#a9dace28a02e57b477f817c9f9030a5fc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &gt;</>}
  name={<><a href="#a8f0af01bf4f2f7b7a63d5789c1607495">getMappedOp</a> (const Metadata &#42;Op) const</>}>
Get a previously mapped node. <a href="#a8f0af01bf4f2f7b7a63d5789c1607495">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;</>}
  name={<><a href="#ab062c4f5119fb7b9a647d4f300b2d1c5">mapDistinctNode</a> (const MDNode &amp;N)</>}>
Map a distinct node. <a href="#ab062c4f5119fb7b9a647d4f300b2d1c5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a62b664997f960985542ef30c564ec861">mapNodesInPOT</a> (UniquedGraph &amp;G)</>}>
Map all the nodes in the given uniqued graph. <a href="#a62b664997f960985542ef30c564ec861">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;</>}
  name={<><a href="#a7e7ef8eee51633a39f3cab453baa7ff0">mapTopLevelUniquedNode</a> (const MDNode &amp;FirstN)</>}>
Map a top-level uniqued node and the uniqued subgraph underneath it. <a href="#a7e7ef8eee51633a39f3cab453baa7ff0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  template={<>template &lt;class OperandMapper&gt;</>}
  type="void"
  name={<><a href="#a7c38ca83c916472e5580992d97616ba9">remapOperands</a> (MDNode &amp;N, OperandMapper mapOperand)</>}>
Remap a node&#39;s operands using the given functor. <a href="#a7c38ca83c916472e5580992d97616ba9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &gt;</>}
  name={<><a href="#a80f5a8ab4da21b753ff41987e1b5741a">tryToMapOperand</a> (const Metadata &#42;Op)</>}>
Try to map the operand of an <em><a href="/docs/api/classes/llvm/mdnode">MDNode</a></em>. <a href="#a80f5a8ab4da21b753ff41987e1b5741a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;</>}
  name={<><a href="#af69f6d67917f647af69d6ba7bb126ca9">visitOperands</a> (UniquedGraph &amp;G, MDNode::op&#95;iterator &amp;I, MDNode::op&#95;iterator E, bool &amp;HasChanged)</>}>
Visit the operands of a uniqued node in the POT. <a href="#af69f6d67917f647af69d6ba7bb126ca9">More...</a>
</MembersIndexItem>

</MembersIndex>

## Private Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;, 16 &gt;</>}
  name={<><a href="#ae239bcf674a7148aa155af2d184a7902">DistinctWorklist</a></>}>
Worklist of distinct nodes whose operands need to be remapped. <a href="#ae239bcf674a7148aa155af2d184a7902">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;, Data, 32 &gt;</>}
  name={<><a href="#af58edfe4b549831024e107cc071bf271">InfoStorage</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/anonymous-namespace-valuemapper-cpp-/mapper">Mapper</a> &amp;</>}
  name={<><a href="#a9f495df041166b52263e1bee5dc4a59f">M</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;, 16 &gt;</>}
  name={<><a href="#a482f4c0b884d200b1efc83bb42c51693">POTStorage</a></>}>
</MembersIndexItem>

</MembersIndex>


Definition at line 192 of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.

<SectionDefinition>

## Public Constructors

### MDNodeMapper() {#a332d6883ae1fe5af9bda81416f7bfbe0}

<MemberDefinition
  prototype={<>anonymous&#95;namespace&#123;ValueMapper.cpp&#125;::MDNodeMapper::MDNodeMapper (<a href="/docs/api/classes/anonymous-namespace-valuemapper-cpp-/mapper">Mapper</a> &amp; M)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00225">225</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Member Functions

### map() {#a19e14dd6bf8fd49e43925ade95aab06d}

<MemberDefinition
  prototype={<>Metadata &#42; MDNodeMapper::map (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &amp; N)</>}>
Map a metadata node (and its transitive operands).

Map all the (unmapped) nodes in the subgraph under <code>N</code>. The iterative algorithm handles distinct nodes and uniqued node subgraphs using different strategies.

Distinct nodes are immediately mapped and added to <em>DistinctWorklist</em> using <em>mapDistinctNode()</em>. Their mapping can always be computed immediately without visiting operands, even if their operands change.

The mapping for uniqued nodes depends on whether their operands change. <em>mapTopLevelUniquedNode()</em> traverses the transitive uniqued subgraph of a node to calculate uniqued node mappings in bulk. Distinct leafs are added to <em>DistinctWorklist</em> with <em>mapDistinctNode()</em>.

After mapping <code>N</code> itself, this function remaps the operands of the distinct nodes in <em>DistinctWorklist</em> until the entire subgraph under <code>N</code> has been mapped.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00245">245</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### remapOperands() {#a7c38ca83c916472e5580992d97616ba9}

<MemberDefinition
  template={<>template &lt;class OperandMapper&gt;</>}
  prototype={<>void anonymous&#95;namespace&#123;ValueMapper.cpp&#125;::MDNodeMapper::remapOperands (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &amp; N, OperandMapper mapOperand)</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00696">696</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Functions

### createPOT() {#a9dace28a02e57b477f817c9f9030a5fc}

<MemberDefinition
  prototype={<>bool MDNodeMapper::createPOT (UniquedGraph &amp; G, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &amp; FirstN)</>}>
Create a post-order traversal of an unmapped uniqued node subgraph.

This traverses the metadata graph deeply enough to map <code>FirstN</code>. It uses <em>tryToMapOperand()</em> (via <em>Mapper::mapSimplifiedNode()</em>), so any metadata that has already been mapped will not be part of the POT.

Each node that has a changed operand from outside the graph (e.g., a distinct node, an already-mapped uniqued node, or <em><a href="/docs/api/classes/llvm/constantasmetadata">ConstantAsMetadata</a></em>) is marked with <em>Data::HasChanged</em>.


<SectionUser title="Returns">
<code>true</code> if any nodes in <code>G</code> have <em>Data::HasChanged</em>.
</SectionUser>


<SectionUser title="Postcondition">
<code>G.POT</code> is a post-order traversal ending with <code>FirstN</code>.
</SectionUser>


<SectionUser title="Postcondition">
<em>Data::hasChanged</em> in <code>G.Info</code> indicates whether any node needs to change because of operands outside the graph.
</SectionUser>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00306">306</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### getMappedOp() {#a8f0af01bf4f2f7b7a63d5789c1607495}

<MemberDefinition
  prototype={<>std::optional&lt; Metadata &#42; &gt; MDNodeMapper::getMappedOp (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; Op) const</>}>
Get a previously mapped node.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00290">290</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### mapDistinctNode() {#ab062c4f5119fb7b9a647d4f300b2d1c5}

<MemberDefinition
  prototype={<>MDNode &#42; MDNodeMapper::mapDistinctNode (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &amp; N)</>}>
Map a distinct node.

Return the mapping for the distinct node <code>N</code>, saving the result in <em>DistinctWorklist</em> for later remapping.


<SectionUser title="Precondition">
<code>N</code> is not yet mapped.
</SectionUser>


<SectionUser title="Precondition">
<code>N.isDistinct()</code>.
</SectionUser>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00287">287</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### mapNodesInPOT() {#a62b664997f960985542ef30c564ec861}

<MemberDefinition
  prototype={<>void MDNodeMapper::mapNodesInPOT (UniquedGraph &amp; G)</>}>
Map all the nodes in the given uniqued graph.

This visits all the nodes in <code>G</code> in post-order, using the identity mapping or creating a new node depending on <em>Data::HasChanged</em>.


<SectionUser title="Precondition">
<em>getMappedOp()</em> returns std::nullopt for nodes in <code>G</code>, but not for any of their operands outside of <code>G</code>.
</SectionUser>


<SectionUser title="Precondition">
<em>Data::HasChanged</em> is true for a node in <code>G</code> iff any of its operands have changed.
</SectionUser>


<SectionUser title="Postcondition">
<em>getMappedOp()</em> returns the mapped node for every node in <code>G</code>.
</SectionUser>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00327">327</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### mapTopLevelUniquedNode() {#a7e7ef8eee51633a39f3cab453baa7ff0}

<MemberDefinition
  prototype={<>Metadata &#42; MDNodeMapper::mapTopLevelUniquedNode (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &amp; FirstN)</>}>
Map a top-level uniqued node and the uniqued subgraph underneath it.

This builds up a post-order traversal of the (unmapped) uniqued subgraph underneath <code>FirstN</code> and calculates the nodes&#39; mapping. Each node uses the identity mapping (<em>Mapper::mapToSelf()</em>) as long as all of its operands uses the identity mapping.

The algorithm works as follows:


<ul>
<li><em>createPOT()</em>: traverse the uniqued subgraph under <code>FirstN</code> and save the post-order traversal in the given <em>UniquedGraph</em>, tracking nodes&#39; operands change.</li>
<li><em>UniquedGraph::propagateChanges()</em>: propagate changed operands through the <em>UniquedGraph</em> until fixed point, following the rule that if a node changes, any node that references must also change.</li>
<li><em>mapNodesInPOT()</em>: map the uniqued nodes, creating new uniqued nodes (referencing new operands) where necessary.</li>
</ul>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00267">267</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### remapOperands() {#a7c38ca83c916472e5580992d97616ba9}

<MemberDefinition
  template={<>template &lt;class OperandMapper&gt;</>}
  prototype={<>void anonymous&#95;namespace&#123;ValueMapper.cpp&#125;::MDNodeMapper::remapOperands (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &amp; N, OperandMapper mapOperand)</>}>
Remap a node&#39;s operands using the given functor.

Iterate through the operands of <code>N</code> and update them in place using <code>mapOperand</code>.


<SectionUser title="Precondition">
N.isDistinct() or N.isTemporary().
</SectionUser>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00336">336</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### tryToMapOperand() {#a80f5a8ab4da21b753ff41987e1b5741a}

<MemberDefinition
  prototype={<>std::optional&lt; Metadata &#42; &gt; MDNodeMapper::tryToMapOperand (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; Op)</>}>
Try to map the operand of an <em><a href="/docs/api/classes/llvm/mdnode">MDNode</a></em>.

If <code><a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a></code> is already mapped, return the mapping. If it&#39;s not an <em><a href="/docs/api/classes/llvm/mdnode">MDNode</a></em>, compute and return the mapping. If it&#39;s a distinct <em><a href="/docs/api/classes/llvm/mdnode">MDNode</a></em>, return the result of <em>mapDistinctNode()</em>.


<SectionUser title="Returns">
std::nullopt if <code><a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a></code> is an unmapped uniqued <em><a href="/docs/api/classes/llvm/mdnode">MDNode</a></em>.
</SectionUser>


<SectionUser title="Postcondition">
getMappedOp(Op) only returns std::nullopt if this returns std::nullopt.
</SectionUser>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00278">278</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### visitOperands() {#af69f6d67917f647af69d6ba7bb126ca9}

<MemberDefinition
  prototype={<>MDNode &#42; MDNodeMapper::visitOperands (UniquedGraph &amp; G, <a href="/docs/api/classes/llvm/mdnode/#af4fe559b6ceafad40f7144063ef2afd2">MDNode::op&#95;iterator</a> &amp; I, <a href="/docs/api/classes/llvm/mdnode/#af4fe559b6ceafad40f7144063ef2afd2">MDNode::op&#95;iterator</a> E, bool &amp; HasChanged)</>}>
Visit the operands of a uniqued node in the POT.

Visit the operands in the range from <code>I</code> to <code>E</code>, returning the first uniqued node we find that isn&#39;t yet in <code>G</code>. <code>I</code> is always advanced to where to continue the loop through the operands.

This sets <code>HasChanged</code> if any of the visited operands change.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00315">315</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Attributes

### DistinctWorklist {#ae239bcf674a7148aa155af2d184a7902}

<MemberDefinition
  prototype={<>SmallVector&lt;MDNode &#42;, 16&gt; anonymous&#95;namespace&#123;ValueMapper.cpp&#125;::MDNodeMapper::DistinctWorklist</>}>
Worklist of distinct nodes whose operands need to be remapped.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00218">218</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### InfoStorage {#af58edfe4b549831024e107cc071bf271}

<MemberDefinition
  prototype={<>SmallDenseMap&lt;const Metadata &#42;, Data, 32&gt; anonymous&#95;namespace&#123;ValueMapper.cpp&#125;::MDNodeMapper::InfoStorage</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00221">221</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### M {#a9f495df041166b52263e1bee5dc4a59f}

<MemberDefinition
  prototype={<>Mapper&amp; anonymous&#95;namespace&#123;ValueMapper.cpp&#125;::MDNodeMapper::M</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00193">193</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

### POTStorage {#a482f4c0b884d200b1efc83bb42c51693}

<MemberDefinition
  prototype={<>SmallVector&lt;MDNode &#42;, 16&gt; anonymous&#95;namespace&#123;ValueMapper.cpp&#125;::MDNodeMapper::POTStorage</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp/#l00222">222</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following file:

<ul>
<li><a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/valuemapper-cpp">ValueMapper.cpp</a></li>
</ul>

</DoxygenPage>
