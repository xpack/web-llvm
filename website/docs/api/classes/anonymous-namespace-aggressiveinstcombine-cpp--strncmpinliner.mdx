---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/anonymous-namespace-aggressiveinstcombine-cpp-/strncmpinliner
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `StrNCmpInliner` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Declaration

<CodeBlock>class anonymous_namespace{AggressiveInstCombine.cpp}::StrNCmpInliner</CodeBlock>

## Public Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a6a98f71dd14d83355b08b9921c3899d1">StrNCmpInliner</a> (CallInst &#42;CI, LibFunc Func, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL)</>}>
</MembersIndexItem>

</MembersIndex>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#ac9d71bcb73b24374e675d3ac3b8f5e8b">optimizeStrNCmp</a> ()</>}>
First we normalize calls to strncmp/strcmp to the form of compare(s1, s2, N), which means comparing first N bytes of s1 and s2 (without considering &#39;\\0&#39;). <a href="#ac9d71bcb73b24374e675d3ac3b8f5e8b">More...</a>
</MembersIndexItem>

</MembersIndex>

## Private Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#aa45bb97a2545ac411b158bdbedf2ebef">inlineCompare</a> (Value &#42;LHS, StringRef RHS, uint64&#95;t N, bool Swapped)</>}>
Convert. <a href="#aa45bb97a2545ac411b158bdbedf2ebef">More...</a>
</MembersIndexItem>

</MembersIndex>

## Private Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="#ab1a5fd8274376225fe26ac5b37c0a99b">CI</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;</>}
  name={<><a href="#a92c2c92b98b8317dd087aba95ed14786">DL</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;</>}
  name={<><a href="#a52389dd1d83f6c60e5a84502e59a8769">DTU</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a></>}
  name={<><a href="#ab2e04927d045bbc52de719210778a8ef">Func</a></>}>
</MembersIndexItem>

</MembersIndex>


Definition at line 919 of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.

<SectionDefinition>

## Public Constructors

### StrNCmpInliner() {#a6a98f71dd14d83355b08b9921c3899d1}

<MemberDefinition
  prototype={<>anonymous&#95;namespace&#123;AggressiveInstCombine.cpp&#125;::StrNCmpInliner::StrNCmpInliner (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI, <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> Func, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp/#l00921">921</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Member Functions

### optimizeStrNCmp() {#ac9d71bcb73b24374e675d3ac3b8f5e8b}

<MemberDefinition
  prototype="bool StrNCmpInliner::optimizeStrNCmp ()">
First we normalize calls to strncmp/strcmp to the form of compare(s1, s2, N), which means comparing first N bytes of s1 and s2 (without considering &#39;\\0&#39;).

Examples:


<ProgramListing>

<CodeLine><Highlight kind="normal">strncmp(s, </Highlight><Highlight kind="stringliteral">&quot;a&quot;</Highlight><Highlight kind="normal">, 3) -&gt; <a href="/docs/api/namespaces/llvm/scalednumbers/#a0651aa0a52c69c4fe12cf730e7ed65ab">compare</a>(s, </Highlight><Highlight kind="stringliteral">&quot;a&quot;</Highlight><Highlight kind="normal">, 2)</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">strncmp(s, </Highlight><Highlight kind="stringliteral">&quot;abc&quot;</Highlight><Highlight kind="normal">, 3) -&gt; compare(s, </Highlight><Highlight kind="stringliteral">&quot;abc&quot;</Highlight><Highlight kind="normal">, 3)</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">strncmp(s, </Highlight><Highlight kind="stringliteral">&quot;a\\0b&quot;</Highlight><Highlight kind="normal">, 3) -&gt; compare(s, </Highlight><Highlight kind="stringliteral">&quot;a\\0b&quot;</Highlight><Highlight kind="normal">, 2)</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">strcmp(s, </Highlight><Highlight kind="stringliteral">&quot;a&quot;</Highlight><Highlight kind="normal">) -&gt; compare(s, </Highlight><Highlight kind="stringliteral">&quot;a&quot;</Highlight><Highlight kind="normal">, 2)</Highlight></CodeLine>
<CodeLine><Highlight kind="normal"></Highlight></CodeLine>
<CodeLine><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> s2&#91;&#93; = &#123;</Highlight><Highlight kind="charliteral">&#39;a&#39;</Highlight><Highlight kind="normal">&#125;</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">strncmp(s, s2, 3) -&gt; <a href="/docs/api/namespaces/llvm/scalednumbers/#a0651aa0a52c69c4fe12cf730e7ed65ab">compare</a>(s, s2, 3)</Highlight></CodeLine>
<CodeLine><Highlight kind="normal"></Highlight></CodeLine>
<CodeLine><Highlight kind="normal">char s2&#91;&#93; = &#123;</Highlight><Highlight kind="charliteral">&#39;a&#39;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="charliteral">&#39;b&#39;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="charliteral">&#39;c&#39;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="charliteral">&#39;d&#39;</Highlight><Highlight kind="normal">&#125;</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">strncmp(s, s2, 3) -&gt; <a href="/docs/api/namespaces/llvm/scalednumbers/#a0651aa0a52c69c4fe12cf730e7ed65ab">compare</a>(s, s2, 3)</Highlight></CodeLine>

</ProgramListing>

We only handle cases where N and exactly one of s1 and s2 are constant. Cases that s1 and s2 are both constant are already handled by the instcombine pass.

We do not handle cases where N &gt; StrNCmpInlineThreshold.

We also do not handles cases where N &lt; 2, which are already handled by the instcombine pass.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp/#l00925">925</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Functions

### inlineCompare() {#aa45bb97a2545ac411b158bdbedf2ebef}

<MemberDefinition
  prototype={<>void StrNCmpInliner::inlineCompare (<a href="/docs/api/classes/llvm/value">Value</a> &#42; LHS, <a href="/docs/api/classes/llvm/stringref">StringRef</a> RHS, uint64&#95;t N, bool Swapped)</>}>
Convert.

<ProgramListing>

<CodeLine><Highlight kind="normal">ret = <a href="/docs/api/namespaces/llvm/scalednumbers/#a0651aa0a52c69c4fe12cf730e7ed65ab">compare</a>(s1, s2, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>)</Highlight></CodeLine>

</ProgramListing>

into


<ProgramListing>

<CodeLine><Highlight kind="normal">ret = (int)s1&#91;0&#93; - (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)s2&#91;0&#93;</Highlight></CodeLine>
<CodeLine><Highlight kind="normal"></Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ret != 0)</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">goto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28a191e89dbc4939ebd0b572cae44aac05f">NE</a></Highlight></CodeLine>
<CodeLine><Highlight kind="normal">...</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">ret = (int)s1&#91;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-2&#93; - (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)s2&#91;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-2&#93;</Highlight></CodeLine>
<CodeLine><Highlight kind="normal"></Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ret != 0)</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">goto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28a191e89dbc4939ebd0b572cae44aac05f">NE</a></Highlight></CodeLine>
<CodeLine><Highlight kind="normal">ret = (int)s1&#91;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-1&#93; - (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)s2&#91;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-1&#93;</Highlight></CodeLine>
<CodeLine><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28a191e89dbc4939ebd0b572cae44aac05f">NE</a>:</Highlight></CodeLine>

</ProgramListing>

CFG before and after the transformation:

(before) BBCI

(after) BBCI -&gt; BBSubs&#91;0&#93; (sub,icmp) –NE-&gt; BBNE -&gt; BBTail | ^ E | | | BBSubs&#91;1&#93; (sub,icmp) –NE--—+ ... | BBSubs&#91;N-1&#93; (sub) ------—+

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp/#l00928">928</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Attributes

### CI {#ab1a5fd8274376225fe26ac5b37c0a99b}

<MemberDefinition
  prototype={<>CallInst&#42; anonymous&#95;namespace&#123;AggressiveInstCombine.cpp&#125;::StrNCmpInliner::CI</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp/#l00930">930</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.
</MemberDefinition>

### DL {#a92c2c92b98b8317dd087aba95ed14786}

<MemberDefinition
  prototype={<>const DataLayout&amp; anonymous&#95;namespace&#123;AggressiveInstCombine.cpp&#125;::StrNCmpInliner::DL</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp/#l00933">933</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.
</MemberDefinition>

### DTU {#a52389dd1d83f6c60e5a84502e59a8769}

<MemberDefinition
  prototype={<>DomTreeUpdater&#42; anonymous&#95;namespace&#123;AggressiveInstCombine.cpp&#125;::StrNCmpInliner::DTU</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp/#l00932">932</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.
</MemberDefinition>

### Func {#ab2e04927d045bbc52de719210778a8ef}

<MemberDefinition
  prototype={<>LibFunc anonymous&#95;namespace&#123;AggressiveInstCombine.cpp&#125;::StrNCmpInliner::Func</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp/#l00931">931</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following file:

<ul>
<li><a href="/docs/api/files/lib/lib/transforms/lib/transforms/aggressiveinstcombine/aggressiveinstcombine-cpp">AggressiveInstCombine.cpp</a></li>
</ul>

</DoxygenPage>
