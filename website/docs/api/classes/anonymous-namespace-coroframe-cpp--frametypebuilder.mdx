---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `FrameTypeBuilder` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Declaration

<CodeBlock>class anonymous_namespace{CoroFrame.cpp}::FrameTypeBuilder</CodeBlock>

## Public Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a092114fb63cfb76b89bd59081681814b">FrameTypeBuilder</a> (LLVMContext &amp;Context, const DataLayout &amp;DL, std::optional&lt; Align &gt; MaxFrameAlignment)</>}>
</MembersIndexItem>

</MembersIndex>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a></>}
  name={<><a href="#a5c96118e25d97e97ae778fb8084e4154">addField</a> (Type &#42;Ty, MaybeAlign MaybeFieldAlignment, bool IsHeader=false, bool IsSpillOfValue=false)</>}>
Add a field to this structure. <a href="#a5c96118e25d97e97ae778fb8084e4154">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a></>}
  name={<><a href="#a0644a32bfd97560ac89c5d6e9b0bf7ac">addFieldForAlloca</a> (AllocaInst &#42;AI, bool IsHeader=false)</>}>
Add a field to this structure for the storage of an <code>alloca</code> instruction. <a href="#a0644a32bfd97560ac89c5d6e9b0bf7ac">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a0ee1f18526ee78ef18612b6a86dc16fc">addFieldForAllocas</a> (const Function &amp;F, FrameDataInfo &amp;FrameData, coro::Shape &amp;Shape, bool OptimizeFrame)</>}>
We want to put the allocas whose lifetime-ranges are not overlapped into one slot of coroutine frame. <a href="#a0ee1f18526ee78ef18612b6a86dc16fc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;</>}
  name={<><a href="#abe0dacfb2237ff8fb43d5ad22ac45d5f">finish</a> (StringRef Name)</>}>
Finish the layout and create the struct type with the given name. <a href="#abe0dacfb2237ff8fb43d5ad22ac45d5f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a></>}
  name={<><a href="#aae731f5966fd5aaaa3fd5960eebeba7c">getLayoutField</a> (FieldIDType Id) const</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a></>}
  name={<><a href="#a51952520c42ce359fa2835786a5de411">getLayoutFieldIndex</a> (FieldIDType Id) const</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/structs/llvm/align">Align</a></>}
  name={<><a href="#a3db2416990d9de790ecc02fc6370941a">getStructAlign</a> () const</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint64&#95;t</>}
  name={<><a href="#ad6161377f5a2114ed00d462f609aeeca">getStructSize</a> () const</>}>
</MembersIndexItem>

</MembersIndex>

## Private Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;</>}
  name={<><a href="#af12ccf669f1d1c07c46e3b16bba7d761">Context</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;</>}
  name={<><a href="#a723606257352ebdc40a1ee88298a675a">DL</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, unsigned &gt;</>}
  name={<><a href="#ab67d2ccadded49a624493d658b62ab24">FieldIndexByKey</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>, 8 &gt;</>}
  name={<><a href="#a8b33d0958600cff477ad18891f4a9bf1">Fields</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1119ecab03c330a0e30f00e2b6aaf5ef">IsFinished</a> = false</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; <a href="/docs/api/structs/llvm/align">Align</a> &gt;</>}
  name={<><a href="#a01cde1560e4c29d4b2946e39fa472827">MaxFrameAlignment</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/structs/llvm/align">Align</a></>}
  name={<><a href="#ae6e778706cd3daf4867b9477f0ace811">StructAlign</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint64&#95;t</>}
  name={<><a href="#a3e457ff5f5c70b9b28321767ba1f17f4">StructSize</a> = 0</>}>
</MembersIndexItem>

</MembersIndex>


Definition at line 164 of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.

<SectionDefinition>

## Public Constructors

### FrameTypeBuilder() {#a092114fb63cfb76b89bd59081681814b}

<MemberDefinition
  prototype={<>anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::FrameTypeBuilder (<a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp; Context, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, std::optional&lt; <a href="/docs/api/structs/llvm/align">Align</a> &gt; MaxFrameAlignment)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00188">188</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Member Functions

### addField() {#a5c96118e25d97e97ae778fb8084e4154}

<MemberDefinition
  prototype={<>FieldIDType anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::addField (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> MaybeFieldAlignment, bool IsHeader=false, bool IsSpillOfValue=false)</>}
  labels = {["inline", "nodiscard"]}>
Add a field to this structure.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00240">240</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### addFieldForAlloca() {#a0644a32bfd97560ac89c5d6e9b0bf7ac}

<MemberDefinition
  prototype={<>FieldIDType anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::addFieldForAlloca (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; AI, bool IsHeader=false)</>}
  labels = {["inline", "nodiscard"]}>
Add a field to this structure for the storage of an <code>alloca</code> instruction.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00194">194</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### addFieldForAllocas() {#a0ee1f18526ee78ef18612b6a86dc16fc}

<MemberDefinition
  prototype={<>void FrameTypeBuilder::addFieldForAllocas (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo">FrameDataInfo</a> &amp; FrameData, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape, bool OptimizeFrame)</>}>
We want to put the allocas whose lifetime-ranges are not overlapped into one slot of coroutine frame.

Consider the example at:https://bugs.llvm.org/show&#95;bug.cgi?id=45566 <CodeBlock>cppcoro::task&lt;void&gt; alternative&#95;paths(bool cond) &#123;
    if (cond) &#123;
        big&#95;structure a;
        process(a);
        co&#95;await something();
    &#125; else &#123;
        big&#95;structure b;
        process2(b);
        co&#95;await something();
    &#125;
&#125;
</CodeBlock>

We want to put variable a and variable b in the same slot to reduce the size of coroutine frame.

This function use <a href="/docs/api/classes/llvm/stacklifetime">StackLifetime</a> algorithm to partition the AllocaInsts in Spills to non-overlapped sets in order to put Alloca in the same non-overlapped set into the same slot in the Coroutine Frame. Then add field for the allocas in the same non-overlapped set by using the largest type as the field type.

Side Effects: Because We sort the allocas, the order of allocas in the frame may be different with the order in the source code.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00236">236</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### finish() {#abe0dacfb2237ff8fb43d5ad22ac45d5f}

<MemberDefinition
  prototype={<>StructType &#42; FrameTypeBuilder::finish (<a href="/docs/api/classes/llvm/stringref">StringRef</a> Name)</>}>
Finish the layout and create the struct type with the given name.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00293">293</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### getLayoutField() {#aae731f5966fd5aaaa3fd5960eebeba7c}

<MemberDefinition
  prototype={<>Field anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::getLayoutField (<a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> Id) const</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00310">310</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### getLayoutFieldIndex() {#a51952520c42ce359fa2835786a5de411}

<MemberDefinition
  prototype={<>FieldIDType anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::getLayoutFieldIndex (<a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> Id) const</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00305">305</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### getStructAlign() {#a3db2416990d9de790ecc02fc6370941a}

<MemberDefinition
  prototype={<>Align anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::getStructAlign () const</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00300">300</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### getStructSize() {#ad6161377f5a2114ed00d462f609aeeca}

<MemberDefinition
  prototype={<>uint64&#95;t anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::getStructSize () const</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00295">295</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Attributes

### Context {#af12ccf669f1d1c07c46e3b16bba7d761}

<MemberDefinition
  prototype={<>LLVMContext&amp; anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::Context</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00177">177</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### DL {#a723606257352ebdc40a1ee88298a675a}

<MemberDefinition
  prototype={<>const DataLayout&amp; anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::DL</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00176">176</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### FieldIndexByKey {#ab67d2ccadded49a624493d658b62ab24}

<MemberDefinition
  prototype={<>DenseMap&lt;Value&#42;, unsigned&gt; anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::FieldIndexByKey</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00185">185</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### Fields {#a8b33d0958600cff477ad18891f4a9bf1}

<MemberDefinition
  prototype={<>SmallVector&lt;Field, 8&gt; anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::Fields</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00184">184</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### IsFinished {#a1119ecab03c330a0e30f00e2b6aaf5ef}

<MemberDefinition
  prototype={<>bool anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::IsFinished = false</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00180">180</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### MaxFrameAlignment {#a01cde1560e4c29d4b2946e39fa472827}

<MemberDefinition
  prototype={<>std::optional&lt;Align&gt; anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::MaxFrameAlignment</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00182">182</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### StructAlign {#ae6e778706cd3daf4867b9477f0ace811}

<MemberDefinition
  prototype={<>Align anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::StructAlign</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00179">179</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### StructSize {#a3e457ff5f5c70b9b28321767ba1f17f4}

<MemberDefinition
  prototype={<>uint64&#95;t anonymous&#95;namespace&#123;CoroFrame.cpp&#125;::FrameTypeBuilder::StructSize = 0</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp/#l00178">178</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following file:

<ul>
<li><a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a></li>
</ul>

</DoxygenPage>
