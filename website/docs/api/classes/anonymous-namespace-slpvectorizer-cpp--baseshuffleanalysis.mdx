---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/anonymous-namespace-slpvectorizer-cpp-/baseshuffleanalysis
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ParametersList from '@xpack/docusaurus-plugin-doxygen/components/ParametersList'
import ParametersListItem from '@xpack/docusaurus-plugin-doxygen/components/ParametersListItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `BaseShuffleAnalysis` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>

The base class for shuffle instruction emission and shuffle cost estimation. <a href="#details">More...</a>

## Declaration

<CodeBlock>class anonymous_namespace{SLPVectorizer.cpp}::BaseShuffleAnalysis</CodeBlock>

## Protected Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a7fd09f63f0ce151157634df88fb3357f">BaseShuffleAnalysis</a> (Type &#42;ScalarTy)</>}>
</MembersIndexItem>

</MembersIndex>

## Protected Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a330cf3a6980af7480c8de1c2dd643769">getVF</a> (Value &#42;V) const</>}>
V is expected to be a vectorized value. <a href="#a330cf3a6980af7480c8de1c2dd643769">More...</a>
</MembersIndexItem>

</MembersIndex>

## Protected Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#a38be1769f45f965483df70afee3e7715">ScalarTy</a> = nullptr</>}>
</MembersIndexItem>

</MembersIndex>

## Protected Static Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#af8efd31679b2381827db95f3cad5ba44">combineMasks</a> (unsigned LocalVF, SmallVectorImpl&lt; int &gt; &amp;Mask, ArrayRef&lt; int &gt; ExtMask)</>}>
Tries to combine 2 different masks into single one. <a href="#af8efd31679b2381827db95f3cad5ba44">More...</a>
</MembersIndexItem>

<MembersIndexItem
  template={<>template &lt;typename T, typename ShuffleBuilderTy&gt;</>}
  type="T"
  name={<><a href="#a8437f11cfb708e9bb288796d123e84dc">createShuffle</a> (Value &#42;V1, Value &#42;V2, ArrayRef&lt; int &gt; Mask, ShuffleBuilderTy &amp;Builder, Type &#42;ScalarTy)</>}>
Smart shuffle instruction emission, walks through shuffles trees and tries to find the best matching vector for the actual shuffle instruction. <a href="#a8437f11cfb708e9bb288796d123e84dc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7c6c1a7f00536e9ea11d05420bda55cd">isIdentityMask</a> (ArrayRef&lt; int &gt; Mask, const FixedVectorType &#42;VecTy, bool IsStrict)</>}>
Checks if the mask is an identity mask. <a href="#a7c6c1a7f00536e9ea11d05420bda55cd">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a047b7995a79492824633a62540717492">peekThroughShuffles</a> (Value &#42;&amp;V, SmallVectorImpl&lt; int &gt; &amp;Mask, bool SinglePermute)</>}>
Looks through shuffles trying to reduce final number of shuffles in the code. <a href="#a047b7995a79492824633a62540717492">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a75f6ee141c70a7f17fefb2706f5cf6ac">transformMaskAfterShuffle</a> (MutableArrayRef&lt; int &gt; CommonMask, ArrayRef&lt; int &gt; Mask)</>}>
Transforms mask <code>CommonMask</code> per given <code>Mask</code> to make proper set after shuffle emission. <a href="#a75f6ee141c70a7f17fefb2706f5cf6ac">More...</a>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

The base class for shuffle instruction emission and shuffle cost estimation.

Definition at line 9168 of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.

<SectionDefinition>

## Protected Constructors

### BaseShuffleAnalysis() {#a7fd09f63f0ce151157634df88fb3357f}

<MemberDefinition
  prototype={<>anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::BaseShuffleAnalysis (<a href="/docs/api/classes/llvm/type">Type</a> &#42; ScalarTy)</>}
  labels = {["inline", "protected"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09172">9172</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Protected Member Functions

### getVF() {#a330cf3a6980af7480c8de1c2dd643769}

<MemberDefinition
  prototype={<>unsigned anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::getVF (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V) const</>}
  labels = {["inline", "protected"]}>
V is expected to be a vectorized value.

When REVEC is disabled, there is no difference between VF and VNumElements. When REVEC is enabled, VF is VNumElements / ScalarTyNumElements. e.g., if ScalarTy is &lt;4 x Ty&gt; and V1 is &lt;8 x Ty&gt;, 2 is returned instead of 8.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09180">9180</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Protected Member Attributes

### ScalarTy {#a38be1769f45f965483df70afee3e7715}

<MemberDefinition
  prototype={<>Type&#42; anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::ScalarTy = nullptr</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09170">9170</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Protected Static Functions

### combineMasks() {#af8efd31679b2381827db95f3cad5ba44}

<MemberDefinition
  prototype={<>static void anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::combineMasks (unsigned LocalVF, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; int &gt; &amp; Mask, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int &gt; ExtMask)</>}
  labels = {["inline", "protected", "static"]}>
Tries to combine 2 different masks into single one.

<ParametersList title="Parameters">
<ParametersListItem name="LocalVF">Vector length of the permuted input vector. <code>Mask</code> may change the size of the vector, <code>LocalVF</code> is the original size of the shuffled vector.</ParametersListItem>
</ParametersList>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09226">9226</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

### createShuffle() {#a8437f11cfb708e9bb288796d123e84dc}

<MemberDefinition
  template={<>template &lt;typename T, typename ShuffleBuilderTy&gt;</>}
  prototype={<>static T anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::createShuffle (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V1, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V2, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int &gt; Mask, ShuffleBuilderTy &amp; Builder, <a href="/docs/api/classes/llvm/type">Type</a> &#42; ScalarTy)</>}
  labels = {["inline", "protected", "static"]}>
Smart shuffle instruction emission, walks through shuffles trees and tries to find the best matching vector for the actual shuffle instruction.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09388">9388</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

### isIdentityMask() {#a7c6c1a7f00536e9ea11d05420bda55cd}

<MemberDefinition
  prototype={<>static bool anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::isIdentityMask (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int &gt; Mask, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/fixedvectortype">FixedVectorType</a> &#42; VecTy, bool IsStrict)</>}
  labels = {["inline", "protected", "static"]}>
Checks if the mask is an identity mask.

<ParametersList title="Parameters">
<ParametersListItem name="IsStrict">if is true the function returns false if mask size does not match vector size.</ParametersListItem>
</ParametersList>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09198">9198</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

### peekThroughShuffles() {#a047b7995a79492824633a62540717492}

<MemberDefinition
  prototype={<>static bool anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::peekThroughShuffles (<a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; V, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; int &gt; &amp; Mask, bool SinglePermute)</>}
  labels = {["inline", "protected", "static"]}>
Looks through shuffles trying to reduce final number of shuffles in the code.

The function looks through the previously emitted shuffle instructions and properly mark indices in mask as undef. For example, given the code 
<ProgramListing>

<CodeLine><Highlight kind="normal">%s1 = shufflevector &lt;2 x ty&gt; %0, poison, &lt;1, 0&gt;</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">%s2 = shufflevector &lt;2 x ty&gt; %1, poison, &lt;1, 0&gt;</Highlight></CodeLine>

</ProgramListing> and if need to emit shuffle of s1 and s2 with mask &lt;1, 0, 3, 2&gt;, it will look through s1 and s2 and select vectors %0 and %1 with mask &lt;0, 1, 2, 3&gt; for the shuffle. If 2 operands are of different size, the smallest one will be resized and the mask recalculated properly. For example, given the code 
<ProgramListing>

<CodeLine><Highlight kind="normal">%s1 = shufflevector &lt;2 x ty&gt; %0, poison, &lt;1, 0, 1, 0&gt;</Highlight></CodeLine>
<CodeLine><Highlight kind="normal">%s2 = shufflevector &lt;2 x ty&gt; %1, poison, &lt;1, 0, 1, 0&gt;</Highlight></CodeLine>

</ProgramListing> and if need to emit shuffle of s1 and s2 with mask &lt;1, 0, 5, 4&gt;, it will look through s1 and s2 and select vectors %0 and %1 with mask &lt;0, 1, 2, 3&gt; for the shuffle. So, it tries to transform permutations to simple vector merge, if possible. 
<ParametersList title="Parameters">
<ParametersListItem name="V">The input vector which must be shuffled using the given <code>Mask</code>. If the better candidate is found, <code>V</code> is set to this best candidate vector.</ParametersListItem>
<ParametersListItem name="Mask">The input mask for the shuffle. If the best candidate is found during looking-through-shuffles attempt, it is updated accordingly.</ParametersListItem>
<ParametersListItem name="SinglePermute">true if the shuffle operation is originally a single-value-permutation. In this case the look-through-shuffles procedure may look for resizing shuffles as the best candidates.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if the shuffle results in the non-resizing identity shuffle (and thus can be ignored), false - otherwise.
</SectionUser>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09273">9273</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

### transformMaskAfterShuffle() {#a75f6ee141c70a7f17fefb2706f5cf6ac}

<MemberDefinition
  prototype={<>static void anonymous&#95;namespace&#123;SLPVectorizer.cpp&#125;::BaseShuffleAnalysis::transformMaskAfterShuffle (<a href="/docs/api/classes/llvm/mutablearrayref">MutableArrayRef</a>&lt; int &gt; CommonMask, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int &gt; Mask)</>}
  labels = {["inline", "protected", "static"]}>
Transforms mask <code>CommonMask</code> per given <code>Mask</code> to make proper set after shuffle emission.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#l09510">9510</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following file:

<ul>
<li><a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp">SLPVectorizer.cpp</a></li>
</ul>

</DoxygenPage>
