---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/anonymous-namespace-codegenprepare-cpp-/typepromotiontransaction
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `TypePromotionTransaction` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>

This class provides transaction based operation on the IR. <a href="#details">More...</a>

## Declaration

<CodeBlock>class anonymous_namespace{CodeGenPrepare.cpp}::TypePromotionTransaction</CodeBlock>

## Public Member Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#ae9342a9ab343b347e3d043d1568aaff9">ConstRestorationPt</a> = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> TypePromotionAction &#42;</>}>
Restoration point. <a href="#ae9342a9ab343b347e3d043d1568aaff9">More...</a>
</MembersIndexItem>

</MembersIndex>

## Public Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a3f64f3705ad6de53221d46f95196acb7">TypePromotionTransaction</a> (SetOfInstrs &amp;RemovedInsts)</>}>
</MembersIndexItem>

</MembersIndex>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a990fcc2525f7ebe5d3dae3aa10434fa0">commit</a> ()</>}>
Advocate every changes made in that transaction. <a href="#a990fcc2525f7ebe5d3dae3aa10434fa0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="#ae9342a9ab343b347e3d043d1568aaff9">ConstRestorationPt</a></>}
  name={<><a href="#a09325594fe227adf9958691601147da9">getRestorationPoint</a> () const</>}>
Get the current restoration point. <a href="#a09325594fe227adf9958691601147da9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a7bba09bd30b547542b3316d2c93a5647">rollback</a> (ConstRestorationPt Point)</>}>
Undo all the changes made after the given point. <a href="#a7bba09bd30b547542b3316d2c93a5647">More...</a>
</MembersIndexItem>

</MembersIndex>

## API for IR modification with state keeping to support rollback. Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; std::unique&#95;ptr&lt; TypePromotionAction &gt;, 16 &gt;</>}
  name={<><a href="#af510ad8cdbad86335e6da17a210ca192">Actions</a></>}>
The ordered list of actions made so far. <a href="#af510ad8cdbad86335e6da17a210ca192">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="using"
  name={<><a href="#afb72d7bb23b2dae3af50c9f82f1f3859">CommitPt</a> = <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::unique&#95;ptr&lt; TypePromotionAction &gt; &gt;<a href="/docs/api/classes/llvm/iplist">::iterator</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a377ef6bb6c1215b043f7835ac91f04c0">createSExt</a> (Instruction &#42;Inst, Value &#42;Opnd, Type &#42;Ty)</>}>
Same as IRBuilder::createSExt. <a href="#a377ef6bb6c1215b043f7835ac91f04c0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#aa69a48966533c3b656b4ac37819bdcca">createTrunc</a> (Instruction &#42;Opnd, Type &#42;Ty)</>}>
Same as IRBuilder::createTrunc. <a href="#aa69a48966533c3b656b4ac37819bdcca">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a40e7a7b00ec46903a6a39e28b30da046">createZExt</a> (Instruction &#42;Inst, Value &#42;Opnd, Type &#42;Ty)</>}>
Same as IRBuilder::createZExt. <a href="#a40e7a7b00ec46903a6a39e28b30da046">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a6057042016e6c71b9df4b820eed07a0a">eraseInstruction</a> (Instruction &#42;Inst, Value &#42;NewVal=nullptr)</>}>
Same as <a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">Instruction::eraseFromParent</a>. <a href="#a6057042016e6c71b9df4b820eed07a0a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a78fd7692f642fa4792119f0eabf67c12">mutateType</a> (Instruction &#42;Inst, Type &#42;NewTy)</>}>
Same as Value::mutateType. <a href="#a78fd7692f642fa4792119f0eabf67c12">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp;</>}
  name={<><a href="#a78f48b3d6373c7236e29a8a75b0fc88d">RemovedInsts</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ad7595fd2ce173a5034cbc5f2376978e6">replaceAllUsesWith</a> (Instruction &#42;Inst, Value &#42;New)</>}>
Same as Value::replaceAllUsesWith. <a href="#ad7595fd2ce173a5034cbc5f2376978e6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5a651fca694e060abd7d17d6cf34fe51">setOperand</a> (Instruction &#42;Inst, unsigned Idx, Value &#42;NewVal)</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This class provides transaction based operation on the IR.

Every change made through this class is recorded in the internal state and can be undone (rollback) until commit is called. CGP does not check if instructions could be speculatively executed when moved. Preserving the original location would pessimize the debugging experience, as well as negatively impact the quality of sample PGO.

Definition at line 3239 of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.

<SectionDefinition>

## Public Member Typedefs

### ConstRestorationPt {#ae9342a9ab343b347e3d043d1568aaff9}

<MemberDefinition
  prototype={<>using anonymous&#95;namespace&#123;CodeGenPrepare.cpp&#125;::TypePromotionTransaction::ConstRestorationPt =  const TypePromotionAction &#42;</>}>
Restoration point.

The restoration point is a pointer to an action instead of an iterator because the iterator may be invalidated but not the pointer.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03621">3621</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Constructors

### TypePromotionTransaction() {#a3f64f3705ad6de53221d46f95196acb7}

<MemberDefinition
  prototype={<>anonymous&#95;namespace&#123;CodeGenPrepare.cpp&#125;::TypePromotionTransaction::TypePromotionTransaction (<a href="/docs/api/namespaces/anonymous-codegenprepare-cpp-/#af2dad33e47a12a0b01b11d97d390f7ee">SetOfInstrs</a> &amp; RemovedInsts)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03623">3623</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Member Functions

### commit() {#a990fcc2525f7ebe5d3dae3aa10434fa0}

<MemberDefinition
  prototype="bool TypePromotionTransaction::commit ()">
Advocate every changes made in that transaction.

Return true if any change happen.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03628">3628</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### getRestorationPoint() {#a09325594fe227adf9958691601147da9}

<MemberDefinition
  prototype="TypePromotionTransaction::ConstRestorationPt TypePromotionTransaction::getRestorationPoint () const">
Get the current restoration point.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03634">3634</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### rollback() {#a7bba09bd30b547542b3316d2c93a5647}

<MemberDefinition
  prototype={<>void TypePromotionTransaction::rollback (<a href="#ae9342a9ab343b347e3d043d1568aaff9">ConstRestorationPt</a> Point)</>}>
Undo all the changes made after the given point.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03631">3631</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## API for IR modification with state keeping to support rollback.


Same as Instruction::setOperand.

### Actions {#af510ad8cdbad86335e6da17a210ca192}

<MemberDefinition
  prototype={<>SmallVector&lt;std::unique&#95;ptr&lt;TypePromotionAction&gt;, 16&gt; anonymous&#95;namespace&#123;CodeGenPrepare.cpp&#125;::TypePromotionTransaction::Actions</>}>
The ordered list of actions made so far.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03661">3661</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### CommitPt {#afb72d7bb23b2dae3af50c9f82f1f3859}

<MemberDefinition
  prototype={<>using anonymous&#95;namespace&#123;CodeGenPrepare.cpp&#125;::TypePromotionTransaction::CommitPt = 
      SmallVectorImpl&lt;std::unique&#95;ptr&lt;TypePromotionAction&gt;&gt;::iterator</>}>

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03663">3663</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### createSExt {#a377ef6bb6c1215b043f7835ac91f04c0}

<MemberDefinition
  prototype={<>Value &#42; TypePromotionTransaction::createSExt (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}>
Same as IRBuilder::createSExt.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03654">3654</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### createTrunc {#aa69a48966533c3b656b4ac37819bdcca}

<MemberDefinition
  prototype={<>Value &#42; TypePromotionTransaction::createTrunc (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}>
Same as IRBuilder::createTrunc.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03651">3651</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### createZExt {#a40e7a7b00ec46903a6a39e28b30da046}

<MemberDefinition
  prototype={<>Value &#42; TypePromotionTransaction::createZExt (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Opnd, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}>
Same as IRBuilder::createZExt.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03657">3657</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### eraseInstruction {#a6057042016e6c71b9df4b820eed07a0a}

<MemberDefinition
  prototype={<>void TypePromotionTransaction::eraseInstruction (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42; NewVal=nullptr)</>}>
Same as <a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">Instruction::eraseFromParent</a>.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03642">3642</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### mutateType {#a78fd7692f642fa4792119f0eabf67c12}

<MemberDefinition
  prototype={<>void TypePromotionTransaction::mutateType (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, <a href="/docs/api/classes/llvm/type">Type</a> &#42; NewTy)</>}>
Same as Value::mutateType.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03648">3648</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### RemovedInsts {#a78f48b3d6373c7236e29a8a75b0fc88d}

<MemberDefinition
  prototype={<>SetOfInstrs&amp; anonymous&#95;namespace&#123;CodeGenPrepare.cpp&#125;::TypePromotionTransaction::RemovedInsts</>}>

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03666">3666</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### replaceAllUsesWith {#ad7595fd2ce173a5034cbc5f2376978e6}

<MemberDefinition
  prototype={<>void TypePromotionTransaction::replaceAllUsesWith (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42; New)</>}>
Same as Value::replaceAllUsesWith.

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03645">3645</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

### setOperand {#a5a651fca694e060abd7d17d6cf34fe51}

<MemberDefinition
  prototype={<>void TypePromotionTransaction::setOperand (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, unsigned Idx, <a href="/docs/api/classes/llvm/value">Value</a> &#42; NewVal)</>}>

Definition at line <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp/#l03639">3639</a> of file <a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following file:

<ul>
<li><a href="/docs/api/files/lib/lib/codegen/codegenprepare-cpp">CodeGenPrepare.cpp</a></li>
</ul>

</DoxygenPage>
