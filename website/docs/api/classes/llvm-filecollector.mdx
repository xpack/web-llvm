---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/llvm/filecollector
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `FileCollector` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>

Captures file system interaction and generates data to be later replayed with the RedirectingFileSystem. <a href="#details">More...</a>

## Declaration

<CodeBlock>class llvm::FileCollector</CodeBlock>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Support/FileCollector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h"
  isLocal="true" />
</IncludesList>

## Base class

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/filecollectorbase">FileCollectorBase</a></>}>
</MembersIndexItem>

</MembersIndex>

## Public Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a2da94c8c4b02f2361f1add04a67b0a47">FileCollector</a> (std::string Root, std::string OverlayRoot)</>}>
<code>Root</code> is the directory where collected files are will be stored. <a href="#a2da94c8c4b02f2361f1add04a67b0a47">More...</a>
</MembersIndexItem>

</MembersIndex>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type={<>std::error&#95;code</>}
  name={<><a href="#a71730785a9649e84e7680eaf77d0095c">copyFiles</a> (bool StopOnError=true)</>}>
Copy the files into the root directory. <a href="#a71730785a9649e84e7680eaf77d0095c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::error&#95;code</>}
  name={<><a href="#a139707bb03616dd63549f3734ce8a71a">writeMapping</a> (StringRef MappingFile)</>}>
Write the yaml mapping (for the VFS) to the given file. <a href="#a139707bb03616dd63549f3734ce8a71a">More...</a>
</MembersIndexItem>

</MembersIndex>

## Protected Member Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vfs/directory-iterator">llvm::vfs::directory&#95;iterator</a></>}
  name={<><a href="#a045f98bf82edccad8ca80e5a233584a7">addDirectoryImpl</a> (const llvm::Twine &amp;Dir, IntrusiveRefCntPtr&lt; vfs::FileSystem &gt; FS, std::error&#95;code &amp;EC) override</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ace0419c07a92964cb26904561edc7203">addFileImpl</a> (StringRef SrcPath) override</>}>
</MembersIndexItem>

</MembersIndex>

## Private Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a5562f23f45b2c3112dc8e172306e536b">addFileToMapping</a> (StringRef VirtualPath, StringRef RealPath)</>}>
</MembersIndexItem>

</MembersIndex>

## Protected Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/filecollector/pathcanonicalizer">PathCanonicalizer</a></>}
  name={<><a href="#a87ed48aba24052e1fffbca44b37fe6a6">Canonicalizer</a></>}>
Helper utility for canonicalizing paths. <a href="#a87ed48aba24052e1fffbca44b37fe6a6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> std::string</>}
  name={<><a href="#a84f5443c248164ed63e454ea00ecb356">OverlayRoot</a></>}>
The root directory where the VFS overlay lives. <a href="#a84f5443c248164ed63e454ea00ecb356">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> std::string</>}
  name={<><a href="#aace40749449142a325fdad80ea0d6611">Root</a></>}>
The directory where collected files are copied to in <a href="#a71730785a9649e84e7680eaf77d0095c">copyFiles()</a>. <a href="#aace40749449142a325fdad80ea0d6611">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vfs/yamlvfswriter">vfs::YAMLVFSWriter</a></>}
  name={<><a href="#ac8c37afef3ccf4635d955de9b09b4480">VFSWriter</a></>}>
The yaml mapping writer. <a href="#ac8c37afef3ccf4635d955de9b09b4480">More...</a>
</MembersIndexItem>

</MembersIndex>

## Private Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type="friend"
  name={<><a href="#a7192f778f7c5c4da705b3da8e52c7129">FileCollectorFileSystem</a></>}>
</MembersIndexItem>

</MembersIndex>

## Public Static Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/intrusiverefcntptr">IntrusiveRefCntPtr</a>&lt; <a href="/docs/api/classes/llvm/vfs/filesystem">vfs::FileSystem</a> &gt;</>}
  name={<><a href="#aef90d74b908382e0d81ae5ba389471dc">createCollectorVFS</a> (IntrusiveRefCntPtr&lt; vfs::FileSystem &gt; BaseFS, std::shared&#95;ptr&lt; FileCollector &gt; Collector)</>}>
Create a VFS that uses <code>Collector</code> to collect files accessed via <code>BaseFS</code>. <a href="#aef90d74b908382e0d81ae5ba389471dc">More...</a>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

Captures file system interaction and generates data to be later replayed with the RedirectingFileSystem.

For any file that gets accessed we eventually create:
<ul>
<li>a copy of the file inside Root</li>
<li>a record in RedirectingFileSystem mapping that maps: current real path -&gt; path to the copy in Root</li>
</ul>


That intent is that later when the mapping is used by RedirectingFileSystem it simulates the state of FS that we collected.

We generate file copies and mapping lazily - see writeMapping and copyFiles. We don&#39;t try to capture the state of the file at the exact time when it&#39;s accessed. Files might get changed, deleted ... we record only the &quot;final&quot; state.

In order to preserve the relative topology of files we use their real paths as relative paths inside of the Root.

Definition at line 69 of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>.

<SectionDefinition>

## Public Constructors

### FileCollector() {#a2da94c8c4b02f2361f1add04a67b0a47}

<MemberDefinition
  prototype="FileCollector::FileCollector (std::string Root, std::string OverlayRoot)">
<code>Root</code> is the directory where collected files are will be stored.

<code>OverlayRoot</code> is VFS mapping root. <code>Root</code> directory gets created in copyFiles unless it already exists.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00095">95</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>, definition at line <a href="/docs/api/files/lib/lib/support/filecollector-cpp/#l00052">52</a> of file <a href="/docs/api/files/lib/lib/support/filecollector-cpp">FileCollector.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Member Functions

### copyFiles() {#a71730785a9649e84e7680eaf77d0095c}

<MemberDefinition
  prototype={<>std::error&#95;code FileCollector::copyFiles (bool StopOnError=<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>)</>}>
Copy the files into the root directory.

When StopOnError is true (the default) we abort as soon as one file cannot be copied. This is relatively common, for example when a file was removed after it was added to the mapping.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00105">105</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>, definition at line <a href="/docs/api/files/lib/lib/support/filecollector-cpp/#l00178">178</a> of file <a href="/docs/api/files/lib/lib/support/filecollector-cpp">FileCollector.cpp</a>.
</MemberDefinition>

### writeMapping() {#a139707bb03616dd63549f3734ce8a71a}

<MemberDefinition
  prototype={<>std::error&#95;code FileCollector::writeMapping (<a href="/docs/api/classes/llvm/stringref">StringRef</a> MappingFile)</>}>
Write the yaml mapping (for the VFS) to the given file.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00098">98</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>, definition at line <a href="/docs/api/files/lib/lib/support/filecollector-cpp/#l00238">238</a> of file <a href="/docs/api/files/lib/lib/support/filecollector-cpp">FileCollector.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Protected Member Functions

### addDirectoryImpl() {#a045f98bf82edccad8ca80e5a233584a7}

<MemberDefinition
  prototype={<>llvm::vfs::directory&#95;iterator FileCollector::addDirectoryImpl (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">llvm::Twine</a> &amp; Dir, <a href="/docs/api/classes/llvm/intrusiverefcntptr">IntrusiveRefCntPtr</a>&lt; <a href="/docs/api/classes/llvm/vfs/filesystem">vfs::FileSystem</a> &gt; FS, std::error&#95;code &amp; EC)</>}
  labels = {["protected", "virtual"]}>

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00127">127</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>, definition at line <a href="/docs/api/files/lib/lib/support/filecollector-cpp/#l00137">137</a> of file <a href="/docs/api/files/lib/lib/support/filecollector-cpp">FileCollector.cpp</a>.
</MemberDefinition>

### addFileImpl() {#ace0419c07a92964cb26904561edc7203}

<MemberDefinition
  prototype={<>void FileCollector::addFileImpl (<a href="/docs/api/classes/llvm/stringref">StringRef</a> SrcPath)</>}
  labels = {["protected", "virtual"]}>

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00124">124</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>, definition at line <a href="/docs/api/files/lib/lib/support/filecollector-cpp/#l00122">122</a> of file <a href="/docs/api/files/lib/lib/support/filecollector-cpp">FileCollector.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Functions

### addFileToMapping() {#a5562f23f45b2c3112dc8e172306e536b}

<MemberDefinition
  prototype={<>void llvm::FileCollector::addFileToMapping (<a href="/docs/api/classes/llvm/stringref">StringRef</a> VirtualPath, <a href="/docs/api/classes/llvm/stringref">StringRef</a> RealPath)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00116">116</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Protected Member Attributes

### Canonicalizer {#a87ed48aba24052e1fffbca44b37fe6a6}

<MemberDefinition
  prototype="PathCanonicalizer llvm::FileCollector::Canonicalizer"
  labels = {["protected"]}>
Helper utility for canonicalizing paths.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00141">141</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>.
</MemberDefinition>

### OverlayRoot {#a84f5443c248164ed63e454ea00ecb356}

<MemberDefinition
  prototype="const std::string llvm::FileCollector::OverlayRoot"
  labels = {["protected"]}>
The root directory where the VFS overlay lives.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00135">135</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>.
</MemberDefinition>

### Root {#aace40749449142a325fdad80ea0d6611}

<MemberDefinition
  prototype="const std::string llvm::FileCollector::Root"
  labels = {["protected"]}>
The directory where collected files are copied to in <a href="#a71730785a9649e84e7680eaf77d0095c">copyFiles()</a>.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00132">132</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>.
</MemberDefinition>

### VFSWriter {#ac8c37afef3ccf4635d955de9b09b4480}

<MemberDefinition
  prototype="vfs::YAMLVFSWriter llvm::FileCollector::VFSWriter"
  labels = {["protected"]}>
The yaml mapping writer.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00138">138</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Attributes

### FileCollectorFileSystem {#a7192f778f7c5c4da705b3da8e52c7129}

<MemberDefinition
  prototype="friend llvm::FileCollector::FileCollectorFileSystem">

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00114">114</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Static Functions

### createCollectorVFS() {#aef90d74b908382e0d81ae5ba389471dc}

<MemberDefinition
  prototype={<>IntrusiveRefCntPtr&lt; vfs::FileSystem &gt; FileCollector::createCollectorVFS (<a href="/docs/api/classes/llvm/intrusiverefcntptr">IntrusiveRefCntPtr</a>&lt; <a href="/docs/api/classes/llvm/vfs/filesystem">vfs::FileSystem</a> &gt; BaseFS, std::shared&#95;ptr&lt; <a href="/docs/api/classes/llvm/filecollector">FileCollector</a> &gt; Collector)</>}
  labels = {["static"]}>
Create a VFS that uses <code>Collector</code> to collect files accessed via <code>BaseFS</code>.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h/#l00110">110</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a>, definition at line <a href="/docs/api/files/lib/lib/support/filecollector-cpp/#l00314">314</a> of file <a href="/docs/api/files/lib/lib/support/filecollector-cpp">FileCollector.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following files:

<ul>
<li><a href="/docs/api/files/include/include/llvm/include/llvm/support/filecollector-h">FileCollector.h</a></li>
<li><a href="/docs/api/files/lib/lib/support/filecollector-cpp">FileCollector.cpp</a></li>
</ul>

</DoxygenPage>
