---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/anonymous-namespace-siloweri1copies-cpp-/loopfinder
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `LoopFinder` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>

Helper class that detects loops which require us to lower an i1 COPY into bitwise manipulation. <a href="#details">More...</a>

## Declaration

<CodeBlock>class anonymous_namespace{SILowerI1Copies.cpp}::LoopFinder</CodeBlock>

## Public Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#ad5b0bdd3a466adacd81540baaa80f08d">LoopFinder</a> (MachineDominatorTree &amp;DT, MachinePostDominatorTree &amp;PDT)</>}>
</MembersIndexItem>

</MembersIndex>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a2386e395c05803dc5a92d85297b9d6a1">addLoopEntries</a> (unsigned LoopLevel, MachineSSAUpdater &amp;SSAUpdater, MachineRegisterInfo &amp;MRI, MachineRegisterInfo::VRegAttrs LaneMaskRegAttrs, ArrayRef&lt; Incoming &gt; Incomings=&#123;&#125;)</>}>
Add undef values dominating the loop and the optionally given additional blocks, so that the SSA updater doesn&#39;t have to search all the way to the function entry. <a href="#a2386e395c05803dc5a92d85297b9d6a1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ac7e76dcb7cf9c36d512e2c8b2056f55e">findLoop</a> (MachineBasicBlock &#42;PostDom)</>}>
Check whether a backward edge can be reached without going through the given <code>PostDom</code> of the def block. <a href="#ac7e76dcb7cf9c36d512e2c8b2056f55e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a0cf63cd3280918e038371b0ba86571cc">initialize</a> (MachineBasicBlock &amp;MBB)</>}>
</MembersIndexItem>

</MembersIndex>

## Private Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a5bf1b587fc19e6fde3996d4a4b3bcc75">advanceLevel</a> ()</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8b7a778623494c0afe98322b9283e054">inLoopLevel</a> (MachineBasicBlock &amp;MBB, unsigned LoopLevel, ArrayRef&lt; Incoming &gt; Incomings) const</>}>
</MembersIndexItem>

</MembersIndex>

## Private Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, 4 &gt;</>}
  name={<><a href="#a7cf210b7619517b6b4467cdad6e415e6">CommonDominators</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#a8bef895a483a3421950fcaebedb798a8">DefBlock</a> = nullptr</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinedominatortree">MachineDominatorTree</a> &amp;</>}
  name={<><a href="#a944c8f48c0cb300b994e5de475d75598">DT</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ad1814e27d2a8faedc127db9eb1a1d81b">FoundLoopLevel</a> = ~0u</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, 4 &gt;</>}
  name={<><a href="#a78e677e609d86787554e1ffb902e835e">NextLevel</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinepostdominatortree">MachinePostDominatorTree</a> &amp;</>}
  name={<><a href="#a33900ef461adfb0b0221dc2c285e40e8">PDT</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, 4 &gt;</>}
  name={<><a href="#a8033d7b3af27799d4a5fb3be4421fb5a">Stack</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, unsigned &gt;</>}
  name={<><a href="#ae2fc6959370f0573b882c11fef8ab517">Visited</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#a61a2a79bd2338b63c44b94eb8fc8a394">VisitedPostDom</a> = nullptr</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

Helper class that detects loops which require us to lower an i1 COPY into bitwise manipulation.

Unfortunately, we cannot use <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> because <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> does not distinguish between loops with the same header. Consider this example:

A-+-+ | | | B-+ | | | Câ€”+

A is the header of a loop containing A, B, and C as far as <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> is concerned. However, an i1 COPY in B that is used in C must be lowered to bitwise operations to combine results from different loop iterations when B has a divergent branch (since by default we will compile this code such that threads in a wave are merged at the entry of C).

The following rule is implemented to determine whether bitwise operations are required: use the bitwise lowering for a def in block B if a backward edge to B is reachable without going through the nearest common post-dominator of B and all uses of the def.

TODO: This rule is conservative because it does not check whether the relevant branches are actually divergent.

The class is designed to cache the CFG traversal so that it can be re-used for multiple defs within the same basic block.

TODO: We could use region analysis to quickly skip over SESE regions during the traversal.

Definition at line 219 of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.

<SectionDefinition>

## Public Constructors

### LoopFinder() {#ad5b0bdd3a466adacd81540baaa80f08d}

<MemberDefinition
  prototype={<>anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::LoopFinder (<a href="/docs/api/classes/llvm/machinedominatortree">MachineDominatorTree</a> &amp; DT, <a href="/docs/api/classes/llvm/machinepostdominatortree">MachinePostDominatorTree</a> &amp; PDT)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00245">245</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Member Functions

### addLoopEntries() {#a2386e395c05803dc5a92d85297b9d6a1}

<MemberDefinition
  prototype={<>void anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::addLoopEntries (unsigned LoopLevel, <a href="/docs/api/classes/llvm/machinessaupdater">MachineSSAUpdater</a> &amp; SSAUpdater, <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &amp; MRI, <a href="/docs/api/structs/llvm/machineregisterinfo/vregattrs">MachineRegisterInfo::VRegAttrs</a> LaneMaskRegAttrs, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/structs/llvm/incoming">Incoming</a> &gt; Incomings=&#123;&#125;)</>}
  labels = {["inline"]}>
Add undef values dominating the loop and the optionally given additional blocks, so that the SSA updater doesn&#39;t have to search all the way to the function entry.

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00285">285</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### findLoop() {#ac7e76dcb7cf9c36d512e2c8b2056f55e}

<MemberDefinition
  prototype={<>unsigned anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::findLoop (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; PostDom)</>}
  labels = {["inline"]}>
Check whether a backward edge can be reached without going through the given <code>PostDom</code> of the def block.

Return the level of <code>PostDom</code> if a loop was found, or 0 otherwise.

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00263">263</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### initialize() {#a0cf63cd3280918e038371b0ba86571cc}

<MemberDefinition
  prototype={<>void anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::initialize (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00248">248</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Functions

### advanceLevel() {#a5bf1b587fc19e6fde3996d4a4b3bcc75}

<MemberDefinition
  prototype={<>void anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::advanceLevel ()</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00323">323</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### inLoopLevel() {#a8b7a778623494c0afe98322b9283e054}

<MemberDefinition
  prototype={<>bool anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::inLoopLevel (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB, unsigned LoopLevel, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/structs/llvm/incoming">Incoming</a> &gt; Incomings) const</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00310">310</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Attributes

### CommonDominators {#a7cf210b7619517b6b4467cdad6e415e6}

<MemberDefinition
  prototype={<>SmallVector&lt;MachineBasicBlock &#42;, 4&gt; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::CommonDominators</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00230">230</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### DefBlock {#a8bef895a483a3421950fcaebedb798a8}

<MemberDefinition
  prototype={<>MachineBasicBlock&#42; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::DefBlock = nullptr</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00240">240</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### DT {#a944c8f48c0cb300b994e5de475d75598}

<MemberDefinition
  prototype={<>MachineDominatorTree&amp; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::DT</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00220">220</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### FoundLoopLevel {#ad1814e27d2a8faedc127db9eb1a1d81b}

<MemberDefinition
  prototype={<>unsigned anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::FoundLoopLevel = ~0u</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00238">238</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### NextLevel {#a78e677e609d86787554e1ffb902e835e}

<MemberDefinition
  prototype={<>SmallVector&lt;MachineBasicBlock &#42;, 4&gt; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::NextLevel</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00242">242</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### PDT {#a33900ef461adfb0b0221dc2c285e40e8}

<MemberDefinition
  prototype={<>MachinePostDominatorTree&amp; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::PDT</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00221">221</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### Stack {#a8033d7b3af27799d4a5fb3be4421fb5a}

<MemberDefinition
  prototype={<>SmallVector&lt;MachineBasicBlock &#42;, 4&gt; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::Stack</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00241">241</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### Visited {#ae2fc6959370f0573b882c11fef8ab517}

<MemberDefinition
  prototype={<>DenseMap&lt;MachineBasicBlock &#42;, unsigned&gt; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::Visited</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00226">226</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

### VisitedPostDom {#a61a2a79bd2338b63c44b94eb8fc8a394}

<MemberDefinition
  prototype={<>MachineBasicBlock&#42; anonymous&#95;namespace&#123;SILowerI1Copies.cpp&#125;::LoopFinder::VisitedPostDom = nullptr</>}>

Definition at line <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp/#l00233">233</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following file:

<ul>
<li><a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siloweri1copies-cpp">SILowerI1Copies.cpp</a></li>
</ul>

</DoxygenPage>
