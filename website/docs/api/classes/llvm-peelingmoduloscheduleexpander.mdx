---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/llvm/peelingmoduloscheduleexpander
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `PeelingModuloScheduleExpander` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>

A reimplementation of <a href="/docs/api/classes/llvm/moduloscheduleexpander">ModuloScheduleExpander</a>. <a href="#details">More...</a>

## Declaration

<CodeBlock>class llvm::PeelingModuloScheduleExpander</CodeBlock>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/CodeGen/ModuloSchedule.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h"
  isLocal="true" />
</IncludesList>

## Public Constructors Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#aae9b96399674b041327d5ac1170f96e1">PeelingModuloScheduleExpander</a> (MachineFunction &amp;MF, ModuloSchedule &amp;S, LiveIntervals &#42;LIS)</>}>
</MembersIndexItem>

</MembersIndex>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a134f4cf4ad60c97b1d23e9d1e465031a">expand</a> ()</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae67a99405a40814d2261e31f11fe7a38">validateAgainstModuloScheduleExpander</a> ()</>}>
Runs <a href="/docs/api/classes/llvm/moduloscheduleexpander">ModuloScheduleExpander</a> and treats it as a golden input to validate aspects of the code generated by <a href="/docs/api/classes/llvm/peelingmoduloscheduleexpander">PeelingModuloScheduleExpander</a>. <a href="#ae67a99405a40814d2261e31f11fe7a38">More...</a>
</MembersIndexItem>

</MembersIndex>

## Protected Member Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#ae5fdb7e682e1d04dab7282c473a3641b">CreateLCSSAExitingBlock</a> ()</>}>
Create a poor-man&#39;s LCSSA by cloning only the PHIs from the kernel block to a block dominated by all prologs and epilogs. <a href="#ae5fdb7e682e1d04dab7282c473a3641b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ad8d9864fc2d6dd085102d0999ce27aa1">filterInstructions</a> (MachineBasicBlock &#42;MB, int MinStage)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ade77f3d7ddbf542604f38d867287876f">fixupBranches</a> ()</>}>
Insert branches between prologs, kernel and epilogs. <a href="#ade77f3d7ddbf542604f38d867287876f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/register">Register</a></>}
  name={<><a href="#aa400a4a2da47d3d5803c8c8e706f47e0">getEquivalentRegisterIn</a> (Register Reg, MachineBasicBlock &#42;BB)</>}>
All prolog and epilog blocks are clones of the kernel, so any produced register in one block has an corollary in all other blocks. <a href="#aa400a4a2da47d3d5803c8c8e706f47e0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/register">Register</a></>}
  name={<><a href="#af30efc6374f891c0dd222ed8610919fd">getPhiCanonicalReg</a> (MachineInstr &#42;CanonicalPhi, MachineInstr &#42;Phi)</>}>
Helper function to find the right canonical register for a phi instruction coming from a peeled out prologue. <a href="#af30efc6374f891c0dd222ed8610919fd">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a61e63afbefafa76305f32ea8c4d89feb">getStage</a> (MachineInstr &#42;MI)</>}>
Helper to get the stage of an instruction in the schedule. <a href="#a61e63afbefafa76305f32ea8c4d89feb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#afe809699537758032938bea41ea44bb7">moveStageBetweenBlocks</a> (MachineBasicBlock &#42;DestBB, MachineBasicBlock &#42;SourceBB, unsigned Stage)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#a32e5399895869ed336d4d279c20b5f9c">peelKernel</a> (LoopPeelDirection LPD)</>}>
Peels one iteration of the rewritten kernel (BB) in the specified direction. <a href="#a32e5399895869ed336d4d279c20b5f9c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#adc90ef1bf034dfb4446b910d3795d218">peelPrologAndEpilogs</a> ()</>}>
Peel the kernel forwards and backwards to produce prologs and epilogs, and stitch them together. <a href="#adc90ef1bf034dfb4446b910d3795d218">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aaea52c313d4e1c65fd6240d0fb2d775d">rewriteKernel</a> ()</>}>
Converts BB from the original loop body to the rewritten, pipelined steady-state. <a href="#aaea52c313d4e1c65fd6240d0fb2d775d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a62ce7ffa7758a2203d98c3f40caa5f89">rewriteUsesOf</a> (MachineInstr &#42;MI)</>}>
Change all users of MI, if MI is predicated out (LiveStages&#91;MI-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent()</a>&#93; == false). <a href="#a62ce7ffa7758a2203d98c3f40caa5f89">More...</a>
</MembersIndexItem>

</MembersIndex>

## Protected Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/bitvector">BitVector</a> &gt;</>}
  name={<><a href="#a8591900a7378c95e5875f531330085c1">AvailableStages</a></>}>
For every block, the stages that are available. <a href="#a8591900a7378c95e5875f531330085c1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#adc9121612a5b5ebbb0daa72dc10f93fc">BB</a> = nullptr</>}>
The original loop block that gets rewritten in-place. <a href="#adc9121612a5b5ebbb0daa72dc10f93fc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; &gt;, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; &gt;</>}
  name={<><a href="#aa22d8bc6b37ba1758e74ffc321329406">BlockMIs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; &gt;</>}
  name={<><a href="#a204bcaf1d861d4a8ca7752113627f396">CanonicalMIs</a></>}>
CanonicalMIs and BlockMIs form a bidirectional map between any of the loop kernel clones. <a href="#a204bcaf1d861d4a8ca7752113627f396">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, 4 &gt;</>}
  name={<><a href="#a775cdb9631c5c88444dbaaedf0291a8a">Epilogs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;, 4 &gt;</>}
  name={<><a href="#a11191c870480b6663126986151cb04cc">IllegalPhisToDelete</a></>}>
Illegal phis that need to be deleted once we re-link stages. <a href="#a11191c870480b6663126986151cb04cc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/liveintervals">LiveIntervals</a> &#42;</>}
  name={<><a href="#adfe8c38288fa03fa12d20f67262d19b5">LIS</a> = nullptr</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/bitvector">BitVector</a> &gt;</>}
  name={<><a href="#ac2aebb9955ce8bf7e7787ea8a40e8453">LiveStages</a></>}>
For every block, the stages that are produced. <a href="#ac2aebb9955ce8bf7e7787ea8a40e8453">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::unique&#95;ptr&lt; <a href="/docs/api/classes/llvm/targetinstrinfo/pipelinerloopinfo">TargetInstrInfo::PipelinerLoopInfo</a> &gt;</>}
  name={<><a href="#a9357ad432be24622dd254b420a65a5b9">LoopInfo</a></>}>
<a href="/docs/api/classes/llvm/target">Target</a> loop info before kernel peeling. <a href="#a9357ad432be24622dd254b420a65a5b9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;</>}
  name={<><a href="#a00b42bde6a514187881b6a37cd3e808b">MF</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &amp;</>}
  name={<><a href="#af50b833f06c9dbd8c5eb4712028e9c76">MRI</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::deque&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; &gt;</>}
  name={<><a href="#a0d349ad679cbe6d6b7482736ff24e884">PeeledBack</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::deque&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; &gt;</>}
  name={<><a href="#a61d57b22d69ae8671a396f9bee8a2197">PeeledFront</a></>}>
State passed from peelKernel to <a href="#adc90ef1bf034dfb4446b910d3795d218">peelPrologAndEpilogs()</a>. <a href="#a61d57b22d69ae8671a396f9bee8a2197">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;, unsigned &gt;</>}
  name={<><a href="#ab79470c1892b46558441fe05f14c6e27">PhiNodeLoopIteration</a></>}>
When peeling the epilogue keep track of the distance between the phi nodes and the kernel. <a href="#ab79470c1892b46558441fe05f14c6e27">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#aa8f9ca83057f67121b6b3b13478a12ab">Preheader</a> = nullptr</>}>
The original loop preheader. <a href="#aa8f9ca83057f67121b6b3b13478a12ab">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, 4 &gt;</>}
  name={<><a href="#a22dff30982ebb1744a112b4b99b43245">Prologs</a></>}>
All prolog and epilog blocks. <a href="#a22dff30982ebb1744a112b4b99b43245">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/moduloschedule">ModuloSchedule</a> &amp;</>}
  name={<><a href="#a36381ff531e2753fd519d1e4e77cf5ec">Schedule</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetsubtargetinfo">TargetSubtargetInfo</a> &amp;</>}
  name={<><a href="#a04ee90960aeee5a1ae9732f2d94a6d9d">ST</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;</>}
  name={<><a href="#ac94f7166804b35c9458642169c7b125f">TII</a> = nullptr</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

A reimplementation of <a href="/docs/api/classes/llvm/moduloscheduleexpander">ModuloScheduleExpander</a>.

It works by generating a standalone kernel loop and peeling out the prologs and epilogs.

Definition at line 283 of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.

<SectionDefinition>

## Public Constructors

### PeelingModuloScheduleExpander() {#aae9b96399674b041327d5ac1170f96e1}

<MemberDefinition
  prototype={<>llvm::PeelingModuloScheduleExpander::PeelingModuloScheduleExpander (<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; MF, <a href="/docs/api/classes/llvm/moduloschedule">ModuloSchedule</a> &amp; S, <a href="/docs/api/classes/llvm/liveintervals">LiveIntervals</a> &#42; LIS)</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00285">285</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Public Member Functions

### expand() {#a134f4cf4ad60c97b1d23e9d1e465031a}

<MemberDefinition
  prototype="void PeelingModuloScheduleExpander::expand ()">

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00290">290</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l02026">2026</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### validateAgainstModuloScheduleExpander() {#ae67a99405a40814d2261e31f11fe7a38}

<MemberDefinition
  prototype="void PeelingModuloScheduleExpander::validateAgainstModuloScheduleExpander ()">
Runs <a href="/docs/api/classes/llvm/moduloscheduleexpander">ModuloScheduleExpander</a> and treats it as a golden input to validate aspects of the code generated by <a href="/docs/api/classes/llvm/peelingmoduloscheduleexpander">PeelingModuloScheduleExpander</a>.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00294">294</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l02038">2038</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Protected Member Functions

### CreateLCSSAExitingBlock() {#ae5fdb7e682e1d04dab7282c473a3641b}

<MemberDefinition
  prototype={<>MachineBasicBlock &#42; PeelingModuloScheduleExpander::CreateLCSSAExitingBlock ()</>}
  labels = {["protected"]}>
Create a poor-man&#39;s LCSSA by cloning only the PHIs from the kernel block to a block dominated by all prologs and epilogs.

This allows us to treat the loop exiting block as any other kernel clone.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00359">359</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01880">1880</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### filterInstructions() {#ad8d9864fc2d6dd085102d0999ce27aa1}

<MemberDefinition
  prototype={<>void PeelingModuloScheduleExpander::filterInstructions (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MB, int MinStage)</>}
  labels = {["protected"]}>

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00340">340</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01631">1631</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### fixupBranches() {#ade77f3d7ddbf542604f38d867287876f}

<MemberDefinition
  prototype="void PeelingModuloScheduleExpander::fixupBranches ()"
  labels = {["protected"]}>
Insert branches between prologs, kernel and epilogs.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00355">355</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01974">1974</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### getEquivalentRegisterIn() {#aa400a4a2da47d3d5803c8c8e706f47e0}

<MemberDefinition
  prototype={<>Register PeelingModuloScheduleExpander::getEquivalentRegisterIn (<a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; BB)</>}
  labels = {["protected"]}>
All prolog and epilog blocks are clones of the kernel, so any produced register in one block has an corollary in all other blocks.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00350">350</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01924">1924</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### getPhiCanonicalReg() {#af30efc6374f891c0dd222ed8610919fd}

<MemberDefinition
  prototype={<>Register PeelingModuloScheduleExpander::getPhiCanonicalReg (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; CanonicalPhi, <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; Phi)</>}
  labels = {["protected"]}>
Helper function to find the right canonical register for a phi instruction coming from a peeled out prologue.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00368">368</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01746">1746</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### getStage() {#a61e63afbefafa76305f32ea8c4d89feb}

<MemberDefinition
  prototype={<>unsigned llvm::PeelingModuloScheduleExpander::getStage (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; MI)</>}
  labels = {["inline", "protected"]}>
Helper to get the stage of an instruction in the schedule.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00361">361</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### moveStageBetweenBlocks() {#afe809699537758032938bea41ea44bb7}

<MemberDefinition
  prototype={<>void PeelingModuloScheduleExpander::moveStageBetweenBlocks (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; DestBB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; SourceBB, unsigned Stage)</>}
  labels = {["protected"]}>

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00343">343</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01660">1660</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### peelKernel() {#a32e5399895869ed336d4d279c20b5f9c}

<MemberDefinition
  prototype={<>MachineBasicBlock &#42; PeelingModuloScheduleExpander::peelKernel (<a href="/docs/api/namespaces/llvm/#af33723efd6d9a4cf2146113c13888664">LoopPeelDirection</a> LPD)</>}
  labels = {["protected"]}>
Peels one iteration of the rewritten kernel (BB) in the specified direction.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00337">337</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01615">1615</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### peelPrologAndEpilogs() {#adc90ef1bf034dfb4446b910d3795d218}

<MemberDefinition
  prototype="void PeelingModuloScheduleExpander::peelPrologAndEpilogs ()"
  labels = {["protected"]}>
Peel the kernel forwards and backwards to produce prologs and epilogs, and stitch them together.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00347">347</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01763">1763</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### rewriteKernel() {#aaea52c313d4e1c65fd6240d0fb2d775d}

<MemberDefinition
  prototype="void PeelingModuloScheduleExpander::rewriteKernel ()"
  labels = {["protected"]}>
Converts BB from the original loop body to the rewritten, pipelined steady-state.

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00333">333</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l02021">2021</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

### rewriteUsesOf() {#a62ce7ffa7758a2203d98c3f40caa5f89}

<MemberDefinition
  prototype={<>void PeelingModuloScheduleExpander::rewriteUsesOf (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42; MI)</>}
  labels = {["protected"]}>
Change all users of MI, if MI is predicated out (LiveStages&#91;MI-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent()</a>&#93; == false).

Declaration at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00353">353</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>, definition at line <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp/#l01931">1931</a> of file <a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Protected Member Attributes

### AvailableStages {#a8591900a7378c95e5875f531330085c1}

<MemberDefinition
  prototype={<>DenseMap&lt;MachineBasicBlock &#42;, BitVector&gt; llvm::PeelingModuloScheduleExpander::AvailableStages</>}
  labels = {["protected"]}>
For every block, the stages that are available.

A stage can be available but not produced (in the epilog) or produced but not available (in the prolog).

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00315">315</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### BB {#adc9121612a5b5ebbb0daa72dc10f93fc}

<MemberDefinition
  prototype={<>MachineBasicBlock&#42; llvm::PeelingModuloScheduleExpander::BB = nullptr</>}
  labels = {["protected"]}>
The original loop block that gets rewritten in-place.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00305">305</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### BlockMIs {#aa22d8bc6b37ba1758e74ffc321329406}

<MemberDefinition
  prototype={<>DenseMap&lt;std::pair&lt;MachineBasicBlock &#42;, MachineInstr &#42;&gt;, MachineInstr &#42;&gt; llvm::PeelingModuloScheduleExpander::BlockMIs</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00324">324</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### CanonicalMIs {#a204bcaf1d861d4a8ca7752113627f396}

<MemberDefinition
  prototype={<>DenseMap&lt;MachineInstr &#42;, MachineInstr &#42;&gt; llvm::PeelingModuloScheduleExpander::CanonicalMIs</>}
  labels = {["protected"]}>
CanonicalMIs and BlockMIs form a bidirectional map between any of the loop kernel clones.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00322">322</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### Epilogs {#a775cdb9631c5c88444dbaaedf0291a8a}

<MemberDefinition
  prototype={<>SmallVector&lt;MachineBasicBlock &#42;, 4&gt; llvm::PeelingModuloScheduleExpander::Epilogs</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00309">309</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### IllegalPhisToDelete {#a11191c870480b6663126986151cb04cc}

<MemberDefinition
  prototype={<>SmallVector&lt;MachineInstr &#42;, 4&gt; llvm::PeelingModuloScheduleExpander::IllegalPhisToDelete</>}
  labels = {["protected"]}>
Illegal phis that need to be deleted once we re-link stages.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00329">329</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### LIS {#adfe8c38288fa03fa12d20f67262d19b5}

<MemberDefinition
  prototype={<>LiveIntervals&#42; llvm::PeelingModuloScheduleExpander::LIS = nullptr</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00302">302</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### LiveStages {#ac2aebb9955ce8bf7e7787ea8a40e8453}

<MemberDefinition
  prototype={<>DenseMap&lt;MachineBasicBlock &#42;, BitVector&gt; llvm::PeelingModuloScheduleExpander::LiveStages</>}
  labels = {["protected"]}>
For every block, the stages that are produced.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00311">311</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### LoopInfo {#a9357ad432be24622dd254b420a65a5b9}

<MemberDefinition
  prototype={<>std::unique&#95;ptr&lt;TargetInstrInfo::PipelinerLoopInfo&gt; llvm::PeelingModuloScheduleExpander::LoopInfo</>}
  labels = {["protected"]}>
<a href="/docs/api/classes/llvm/target">Target</a> loop info before kernel peeling.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00370">370</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### MF {#a00b42bde6a514187881b6a37cd3e808b}

<MemberDefinition
  prototype={<>MachineFunction&amp; llvm::PeelingModuloScheduleExpander::MF</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00298">298</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### MRI {#af50b833f06c9dbd8c5eb4712028e9c76}

<MemberDefinition
  prototype={<>MachineRegisterInfo&amp; llvm::PeelingModuloScheduleExpander::MRI</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00300">300</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### PeeledBack {#a0d349ad679cbe6d6b7482736ff24e884}

<MemberDefinition
  prototype={<>std::deque&lt;MachineBasicBlock &#42;&gt; llvm::PeelingModuloScheduleExpander::PeeledBack</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00327">327</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### PeeledFront {#a61d57b22d69ae8671a396f9bee8a2197}

<MemberDefinition
  prototype={<>std::deque&lt;MachineBasicBlock &#42;&gt; llvm::PeelingModuloScheduleExpander::PeeledFront</>}
  labels = {["protected"]}>
State passed from peelKernel to <a href="#adc90ef1bf034dfb4446b910d3795d218">peelPrologAndEpilogs()</a>.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00327">327</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### PhiNodeLoopIteration {#ab79470c1892b46558441fe05f14c6e27}

<MemberDefinition
  prototype={<>DenseMap&lt;MachineInstr &#42;, unsigned&gt; llvm::PeelingModuloScheduleExpander::PhiNodeLoopIteration</>}
  labels = {["protected"]}>
When peeling the epilogue keep track of the distance between the phi nodes and the kernel.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00318">318</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### Preheader {#aa8f9ca83057f67121b6b3b13478a12ab}

<MemberDefinition
  prototype={<>MachineBasicBlock&#42; llvm::PeelingModuloScheduleExpander::Preheader = nullptr</>}
  labels = {["protected"]}>
The original loop preheader.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00307">307</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### Prologs {#a22dff30982ebb1744a112b4b99b43245}

<MemberDefinition
  prototype={<>SmallVector&lt;MachineBasicBlock &#42;, 4&gt; llvm::PeelingModuloScheduleExpander::Prologs</>}
  labels = {["protected"]}>
All prolog and epilog blocks.

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00309">309</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### Schedule {#a36381ff531e2753fd519d1e4e77cf5ec}

<MemberDefinition
  prototype={<>ModuloSchedule&amp; llvm::PeelingModuloScheduleExpander::Schedule</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00297">297</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### ST {#a04ee90960aeee5a1ae9732f2d94a6d9d}

<MemberDefinition
  prototype={<>const TargetSubtargetInfo&amp; llvm::PeelingModuloScheduleExpander::ST</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00299">299</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

### TII {#ac94f7166804b35c9458642169c7b125f}

<MemberDefinition
  prototype={<>const TargetInstrInfo&#42; llvm::PeelingModuloScheduleExpander::TII = nullptr</>}
  labels = {["protected"]}>

Definition at line <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h/#l00301">301</a> of file <a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following files:

<ul>
<li><a href="/docs/api/files/include/include/llvm/include/llvm/codegen/moduloschedule-h">ModuloSchedule.h</a></li>
<li><a href="/docs/api/files/lib/lib/codegen/moduloschedule-cpp">ModuloSchedule.cpp</a></li>
</ul>

</DoxygenPage>
