---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/classes/anonymous-namespace-objcarccontract-cpp-/objcarccontract
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - class
toc_max_heading_level: 3

---

import CodeBlock from '@theme/CodeBlock'

import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `ObjCARCContract` Class Reference

<DoxygenPage pluginConfig={pluginConfig}>

Late ARC optimizations. <a href="#details">More...</a>

## Declaration

<CodeBlock>class anonymous_namespace{ObjCARCContract.cpp}::ObjCARCContract</CodeBlock>

## Public Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4a5a18d67ed34c256cc2a666d9b2ce5e">hasCFGChanged</a> () const</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a570e40ac0ef6ab8c6da15e3670a50371">init</a> (Module &amp;M)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6b6cfbee1f1d7c9f17eb52722c89564d">run</a> (Function &amp;F, AAResults &#42;AA, DominatorTree &#42;DT)</>}>
</MembersIndexItem>

</MembersIndex>

## Private Member Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae3a45dc49e811f4701890d20a462bd46">contractAutorelease</a> (Function &amp;F, Instruction &#42;Autorelease, ARCInstKind Class)</>}>
Merge an autorelease with a retain into a fused call. <a href="#ae3a45dc49e811f4701890d20a462bd46">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9f0fde9cd5b3738974c06d706cba0a7a">optimizeRetainCall</a> (Function &amp;F, Instruction &#42;Retain)</>}>
Turn objc&#95;retain into objc&#95;retainAutoreleasedReturnValue if the operand is a return value. <a href="#a9f0fde9cd5b3738974c06d706cba0a7a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aebaa7a1552e9e558ba84e8f8c41e78d2">tryToContractReleaseIntoStoreStrong</a> (Instruction &#42;Release, inst&#95;iterator &amp;Iter, const DenseMap&lt; BasicBlock &#42;, ColorVector &gt; &amp;BlockColors)</>}>
Attempt to merge an objc&#95;release with a store, load, and objc&#95;retain to form an objc&#95;storeStrong. <a href="#aebaa7a1552e9e558ba84e8f8c41e78d2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a741117ce671a025330b97e5604cf4d00">tryToPeepholeInstruction</a> (Function &amp;F, Instruction &#42;Inst, inst&#95;iterator &amp;Iter, bool &amp;TailOkForStoreStrong, const DenseMap&lt; BasicBlock &#42;, ColorVector &gt; &amp;BlockColors)</>}>
Returns true if we eliminated Inst. <a href="#a741117ce671a025330b97e5604cf4d00">More...</a>
</MembersIndexItem>

</MembersIndex>

## Private Member Attributes Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;</>}
  name={<><a href="#a9e218f690b3ac45c120f4926f4390a13">AA</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/objcarc/bundledretainclaimrvs">BundledRetainClaimRVs</a> &#42;</>}
  name={<><a href="#a076cc92802ae4830a9655e1e098811b3">BundledInsts</a> = nullptr</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a063e9c6432635c82aaaea4b1e188b387">CFGChanged</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ac93441ebcef865bff0fad2d1f650a165">Changed</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;</>}
  name={<><a href="#ac8d86c226d6b6635742d79e9a7bb2ca5">DT</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/objcarc/arcruntimeentrypoints">ARCRuntimeEntryPoints</a></>}
  name={<><a href="#a0c6ae7f033213dbf824528d819fd4321">EP</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/provenanceanalysis">ProvenanceAnalysis</a></>}
  name={<><a href="#af4ba6cf634c0ebc116e4d46210739167">PA</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aa3a74c90f201291adc48f60f9b98344e">Run</a></>}>
A flag indicating whether this optimization pass should run. <a href="#aa3a74c90f201291adc48f60f9b98344e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/mdstring">MDString</a> &#42;</>}
  name={<><a href="#a44cb0da724be23e39cd769ad7bb0b739">RVInstMarker</a></>}>
The inline asm string to insert between calls and RetainRV calls to make the optimization work on targets which need it. <a href="#a44cb0da724be23e39cd769ad7bb0b739">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;, 8 &gt;</>}
  name={<><a href="#a9fd807d0971ac37d2cf2a3465a905a41">StoreStrongCalls</a></>}>
The set of inserted objc&#95;storeStrong calls. <a href="#a9fd807d0971ac37d2cf2a3465a905a41">More...</a>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

Late ARC optimizations.

These change the IR in a way that makes it difficult to be analyzed by ObjCARCOpt, so it&#39;s run late.

Definition at line 65 of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.

<SectionDefinition>

## Public Member Functions

### hasCFGChanged() {#a4a5a18d67ed34c256cc2a666d9b2ce5e}

<MemberDefinition
  prototype={<>bool anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::hasCFGChanged () const</>}
  labels = {["inline"]}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00104">104</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### init() {#a570e40ac0ef6ab8c6da15e3670a50371}

<MemberDefinition
  prototype={<>bool ObjCARCContract::init (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M)</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00102">102</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### run() {#a6b6cfbee1f1d7c9f17eb52722c89564d}

<MemberDefinition
  prototype={<>bool ObjCARCContract::run (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42; AA, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00103">103</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Functions

### contractAutorelease() {#ae3a45dc49e811f4701890d20a462bd46}

<MemberDefinition
  prototype={<>bool ObjCARCContract::contractAutorelease (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Autorelease, <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> Class)</>}>
Merge an autorelease with a retain into a fused call.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00094">94</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### optimizeRetainCall() {#a9f0fde9cd5b3738974c06d706cba0a7a}

<MemberDefinition
  prototype={<>bool ObjCARCContract::optimizeRetainCall (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Retain)</>}>
Turn objc&#95;retain into objc&#95;retainAutoreleasedReturnValue if the operand is a return value.

We do this late so we do not disrupt the dataflow analysis in ObjCARCOpt.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00092">92</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### tryToContractReleaseIntoStoreStrong() {#aebaa7a1552e9e558ba84e8f8c41e78d2}

<MemberDefinition
  prototype={<>void ObjCARCContract::tryToContractReleaseIntoStoreStrong (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Release, <a href="/docs/api/namespaces/llvm/#a0c27cc387928f22d241825cf0fb67ade">inst&#95;iterator</a> &amp; Iter, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, <a href="/docs/api/namespaces/llvm/#ac16c24df0637600996c9c6081da170a2">ColorVector</a> &gt; &amp; BlockColors)</>}>
Attempt to merge an objc&#95;release with a store, load, and objc&#95;retain to form an objc&#95;storeStrong.

An objc&#95;storeStrong:

objc&#95;storeStrong(i8&#42;&#42; old&#95;ptr, i8&#42; new&#95;value)

is equivalent to the following IR sequence:

; Load old value. old&#95;value = load i8&#42;&#42; old&#95;ptr (1)

; Increment the new value and then release the old value. This must occur ; in order in case old&#95;value releases new&#95;value in its destructor causing ; us to potentially have a dangling ptr. tail call i8&#42; @objc&#95;retain(i8&#42; new&#95;value) (2) tail call void @objc&#95;release(i8&#42; old&#95;value) (3)

; Store the new&#95;value into old&#95;ptr store i8&#42; new&#95;value, i8&#42;&#42; old&#95;ptr (4)

The safety of this optimization is based around the following considerations:


<ul>
<li>We are forming the store strong at the store. Thus to perform this optimization it must be safe to move the retain, load, and release to (4).</li>
<li>We need to make sure that any re-orderings of (1), (2), (3), (4) are safe.</li>
</ul>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00097">97</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### tryToPeepholeInstruction() {#a741117ce671a025330b97e5604cf4d00}

<MemberDefinition
  prototype={<>bool ObjCARCContract::tryToPeepholeInstruction (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, <a href="/docs/api/namespaces/llvm/#a0c27cc387928f22d241825cf0fb67ade">inst&#95;iterator</a> &amp; Iter, bool &amp; TailOkForStoreStrong, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, <a href="/docs/api/namespaces/llvm/#ac16c24df0637600996c9c6081da170a2">ColorVector</a> &gt; &amp; BlockColors)</>}>
Returns true if we eliminated Inst.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00087">87</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Private Member Attributes

### AA {#a9e218f690b3ac45c120f4926f4390a13}

<MemberDefinition
  prototype={<>AAResults&#42; anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::AA</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00068">68</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### BundledInsts {#a076cc92802ae4830a9655e1e098811b3}

<MemberDefinition
  prototype={<>BundledRetainClaimRVs&#42; anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::BundledInsts = nullptr</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00072">72</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### CFGChanged {#a063e9c6432635c82aaaea4b1e188b387}

<MemberDefinition
  prototype={<>bool anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::CFGChanged</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00067">67</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### Changed {#ac93441ebcef865bff0fad2d1f650a165}

<MemberDefinition
  prototype={<>bool anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::Changed</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00066">66</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### DT {#ac8d86c226d6b6635742d79e9a7bb2ca5}

<MemberDefinition
  prototype={<>DominatorTree&#42; anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::DT</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00069">69</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### EP {#a0c6ae7f033213dbf824528d819fd4321}

<MemberDefinition
  prototype={<>ARCRuntimeEntryPoints anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::EP</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00071">71</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### PA {#af4ba6cf634c0ebc116e4d46210739167}

<MemberDefinition
  prototype={<>ProvenanceAnalysis anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::PA</>}>

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00070">70</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### Run {#aa3a74c90f201291adc48f60f9b98344e}

<MemberDefinition
  prototype={<>bool anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::Run</>}>
A flag indicating whether this optimization pass should run.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00075">75</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### RVInstMarker {#a44cb0da724be23e39cd769ad7bb0b739}

<MemberDefinition
  prototype={<>const MDString&#42; anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::RVInstMarker</>}>
The inline asm string to insert between calls and RetainRV calls to make the optimization work on targets which need it.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00079">79</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

### StoreStrongCalls {#a9fd807d0971ac37d2cf2a3465a905a41}

<MemberDefinition
  prototype={<>SmallPtrSet&lt;CallInst &#42;, 8&gt; anonymous&#95;namespace&#123;ObjCARCContract.cpp&#125;::ObjCARCContract::StoreStrongCalls</>}>
The set of inserted objc&#95;storeStrong calls.

If at the end of walking the function we have found no alloca instructions, these calls can be marked &quot;tail&quot;.

Definition at line <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp/#l00084">84</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<hr/>

The documentation for this class was generated from the following file:

<ul>
<li><a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarccontract-cpp">ObjCARCContract.cpp</a></li>
</ul>

</DoxygenPage>
